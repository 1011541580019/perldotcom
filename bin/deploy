#!/usr/bin/bash
ROOT_DIR="perldotcom"
DEST_DIR="tpf.github.io"

ROOT_LEN=${#ROOT_DIR}
WD=$(pwd)
CURRENT_DIR=${WD: -$ROOT_LEN}

if test "$CURRENT_DIR" != "$ROOT_DIR"
  then
    echo "$0 must be run from the root project directory"
    exit 0;
fi

hugo -d $DEST_DIR
cd $DEST_DIR
git add *
git commit -m 'Generate site'
git fetch -p
git rebase origin master
git push origin master
cd ..
git add $DEST_DIR
git commit -m 'Deploy site'
