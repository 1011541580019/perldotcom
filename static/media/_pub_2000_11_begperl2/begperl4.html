<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/2000/12/begperl4.html">
<dc:title>Beginners Intro to Perl - Part 4</dc:title>
<dc:description> Editor&apos;s note: this venerable series is undergoing updates. You might be interested in the newer versions, available at: A Beginner&apos;s Introduction to Perl 5.10 A Beginner&apos;s Introduction to Files and Strings with Perl 5.10 A Beginner&apos;s Introduction to Regular...</dc:description>
<dc:creator>Doug Sheppard</dc:creator>
<dc:date>2000-12-06T00:00:00-08:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    
    <link rel="prev bookmark" href="/pub/2000/12/p5pdigest/THISWEEK-20001203.html" title="This Week on p5p 2000/12/03" />
    <link rel="next bookmark" href="/pub/2000/12/p5pdigest/THISWEEK-20001217.html" title="This Week on p5p 2000/12/17" />
    
    
    <title>Beginners Intro to Perl - Part 4 - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1764" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Beginners Intro to Perl - Part 4</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Doug Sheppard</span> on <abbr class="published" title="2000-12-06T00:00:00-08:00">December  6, 2000 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        <!-- Beginner's Introduction to Perl - Part 4 -->
<!- :field::id-author::before=by+::>

<p><em>Editor's note: this venerable series is undergoing updates.  You might be interested in the newer versions, available at:</em></p>

<ul>
<li><a href="/pub/a/2008/04/23/a-beginners-introduction-to-perl-510.html">A Beginner's Introduction to Perl 5.10</a>
<li><a href="/pub/a/2008/05/07/beginners-introduction-to-perl-510-part-2.html">A
Beginner's Introduction to Files and Strings with Perl 5.10</a>
<li><a href="http://news.oreilly.com/2008/06/a-beginners-introduction-to-pe.html">A
Beginner's Introduction to Regular Expressions with Perl 5.10</a></li>
<li><a href="http://broadcast.oreilly.com/2008/09/a-beginners-introduction-to-pe.html">A Beginner's Introduction to Perl Web Programming</a></li>

</ul>

<h3>It's CGI time</h3>

<p><table width="180" cellspacing="0" cellpadding="4" align="right" border="1">
<tr>
<td align="center" valign="top" bgcolor="#6699cc">
<font color="#ffffff"><b>Beginners Intro to Perl</b></td>
</tr>

<tr>
<td>
<p class="fine">
&#149;<b><a href="/pub/2000/10/begperl1.html">Part 1 of this series</a></b><br />
&#149;<b><a href="/pub/2000/11/begperl2.html">Part 2 of this series</a></b><br />
&#149;<b><a href="/pub/2000/11/begperl3.html">Part 3 of this series</a></b><br />
&#149;<b><a href="/pub/2000/12/begperl5.html">Part 5 of this series</a></b><br />
&#149;<b><a href="/pub/a/2001/01/begperl6.html">Part 6 of this series</a></b><br /><br />

&#149;<a href="#cgi">What is CGI?</a><br />
&#149;<a href="#cgi_program">A Real CGI Program</a><br />
&#149;<a href="#uhoh">Uh-Oh!</a><br />

&#149;<a href="#second_script">Our Second Script</a><br />

&#149;<a href="#sorting">Sorting</a><br />


&#149;<a href="#trust">Trust No One</a><br />

&#149;<a href="#play_around">Play Around!</a>


</td>
</tr>
</p>
</table>

<p>So far, we've talked about Perl as a language for mangling numbers, strings,
and files - the original purpose of the language.  Now it's time to talk
about what Perl does on the Web.  In this installment, we're going
to talk about CGI programming.</p>


<h3><a name="cgi">What is CGI?</a></h3>

<p>The Web is based on a client-server model: your browser (the client) making
requests to a Web server.  Most of these are simple requests for
documents or images, which the server delivers to the browser for display.

</p><p>Of course, sometimes you want the server to do more than just dump the
contents of a file.  You'd like to do something with a server-side program -
whether that "something" is using Web-based e-mail, looking up a phone number in
a database or ordering a copy of <i>Evil Geniuses in a Nutshell</i> for your
favorite techie.  This means the browser must be able to send
information (an e-mail address, a name to look up, shipping information for
a book) to the server, and the server must be able to use that information
and return the results to the user.

</p><p>The standard for communication between a user's Web browser and a server-side
program running on the Web server is called <b>CGI</b>, or Common Gateway
Interface.  It is supported by all popular Web server software.
To get the most out of this article, you will need to have a server that
supports CGI.  This may be a server running on your desktop machine or
an account with your ISP (though probably not a free Web-page service).  If
you don't know whether you have CGI capabilities, ask your ISP or a local
sysadmin how to set things up.

</p><p>Notice that I haven't described how CGI works; that's because you
don't <i>need</i> to know.  There's a standard Perl module
called <code>CGI.pm</code> that will handle the CGI protocol for you.  CGI.pm is part of
the core Perl distribution, and any properly installed Perl should have it
available.

</p><p>Telling your CGI program that you want to use the CGI module is as simple
as this:</p>
<pre><code>use CGI ':standard';</code></pre>
<p>The <code>use CGI ':standard';</code> statement tells Perl that you want to use the
CGI.pm module in your program.  This will load the module and make a set
of CGI functions available for your code.  
</p>

<h3><a name="cgi_program">A Real CGI Program</a></h3>

<p>Let's write our first real CGI program.  Instead of doing something complex,
we'll write something that will simply throw back whatever we throw
at it.  We'll call this script <code>backatcha.cgi</code>:</p>

<pre><code>#!/usr/local/bin/perl

use CGI ':standard';

print header();
print start_html();

for $i (param()) {
    print "&lt;b>", $i, "&lt;/b>: ", param($i), "&lt;br>\n";
}

print end_html();</code></pre>

<p>If you've never used HTML, the pair of &lt;b> and &lt;/b> tags mean
"begin bold" and "end bold", respectively, and the &lt;br> tag means "line
break."  (A good paper reference to HTML is O'Reilly's <i>HTML & XHTML: The
Definitive Guide</i>, and online, I like <A HREF="http://www.htmlhelp.com/">the
Web Design Group</A>.)

</p><p>Install this program on your server and do a test run.  (If you
don't have a Web server of your own, we've put a copy online for you
<a href="/cgi-bin/backatcha.pl">here</a>.)  Here's a short list of what
you do to install a CGI program:

<ol>
<li>Make sure the program is placed where your Web server will
recognize it as a CGI script.  This may be a special <code>cgi-bin</code> directory
or making sure the program's filename ends in <code>.pl</code> or <code>.cgi</code>.
If you don't know where to place the program, your ISP or sysadmin should.</li>

<li>Make sure the program can be run by the server.  If you are
using a Unix system, you may have to give the Web-server user read and
execute permission for the program.  It's easiest to give these permissions
to everybody by using <code>chmod <i>filename</i> 755</code>.</li>

<li>Make a note of the program's URL, which will probably be something like
http://<i>server name</i>/cgi-bin/backatcha.cgi) and go to that URL in your 
browser.  (Take a guess what you should do if you don't know what the URL
of the program is.  Hint: It involves the words "ask," "your" and "ISP.")</li>
</ol>
</p><p>If this works, you will see in your browser ... a blank page!
Don't worry, this is what is <i>supposed</i> to happen.  The <code>backatcha.cgi</code>
script throws back what you throw at it, and we haven't thrown anything at it
yet.  We'll give it something to show us in a moment.

</p><p>If it <i>didn't</i> work, you probably saw either an error message or
the source code of the script.  We'll try to diagnose these problems in
the next section.</p>

<h3><a name="uhoh">Uh-Oh!</a></h3>

<p>If you saw an error message, your Web server had a problem running
the CGI program.  This may be a problem with the program or the file permissions.

</p><p>First, are you <i>sure</i> the program has the correct file permissions?  Did
you set the file permissions on your program to 755?  If not, do it now. 
(Windows Web servers will have a different way of doing this.)  Try it again;
if you see a blank page now, you're good.

</p><p>Second, are you <i>sure</i> the program actually works?  (Don't worry,
it happens to the best of us.)  Change the <code>use CGI</code> line in the program
to read:</p>
<pre><code>use CGI ':standard', '-debug';</code></pre>
<p>Now run the program from the command line.  You should see the following:</p>
<pre><code>(offline mode: enter name=value pairs on standard input)</code></pre>
<p>This message indicates that you're <i>testing</i> the script.  You can now
press Ctrl-D to tell the script to continue running without telling
it any form items.

</p><p>If Perl reports any errors in the script, you can fix them now.

</p><p>(The <code>-debug</code> option is incredibly useful.  Use it whenever you have
problems with a CGI program, and ignore it at your peril.)

</p><p>The other common problem is that you're seeing the source code of your
program, not the result of running your program.  There are two simple
problems that can cause this.

</p><p>First, are you <i>sure</i> you're going through your Web server?  If you
use your browser's "load local file" option (to look at something like
<code>/etc/httpd/cgi-bin/backatcha.cgi</code> instead of something like
<code>http://localhost/cgi-bin/backatcha.cgi</code>), you aren't even touching the
Web server!  Your browser is doing what you "wanted" to do: loading the
contents of a local file and displaying them.

</p><p>Second, are you <i>sure</i> the Web server knows it's a CGI program?
Most Web server software will have a special way of designating a file
as a CGI program, whether it's a special <code>cgi-bin</code> directory, the <code>.cgi</code> or <code>.pl</code> extension on a file, or something else.  Unless you
live up to these expectations, the Web server will think the program is
a text file, and serve up your program's source code in plain-text form.
Ask your ISP for help.

</p><p>CGI programs are unruly beasts at the best of times; don't worry if it
takes a bit of work to make them run properly.
</p>

<h3>Making the Form Talk Back</h3>

<p>At this point, you should have a working copy of <code>backatcha.cgi</code> 
spitting out blank pages from a Web server.  Let's make it actually tell
us something.  Take the following HTML code and put it in a file:</p>
<pre><code>&lt;FORM ACTION="putyourURLhere" METHOD=GET>
    &lt;P>What is your favorite color? &lt;INPUT NAME="favcolor">&lt;/P>
&lt;INPUT TYPE=submit VALUE="Send form">
lt;/FORM></code></pre>
<p>
Be sure to replace <code>putyourURLhere</code> with the actual URL of your copy of
<code>backatcha.cgi</code>!  If you want, you can use the <a href="/cgi-bin/backatcha.pl">copy installed here</a> at
Perl.com.

</p><p>This is a simple form.  It will show a text box where you can enter
your favorite color and a "submit" button that sends your information
to the server.  Load this form in your browser and submit a favorite color.
You should see this returned from the server:</p>
<pre><code>favcolor: green</code></pre>
<h3>CGI functions</h3>

<p>The CGI.pm module loads several special CGI functions for you.  What are
these functions?

</p><p>The first one, <code>header()</code>, is used to output any necessary HTTP headers
before the script can display HTML output.  Try taking this line out;
you'll get an error from the Web server when you try to run it.  This
is <i>another</i> common source of bugs!

</p><p>The <code>start_html()</code> function is there for convenience.  It returns a simple
HTML header for you.  You can pass parameters to it by using a hash, like this:</p>
<pre><code>print $cgi->start_html( -title => "My document" );</code></pre>
<p>(The <code>end_html()</code> method is similar, but outputs the footers for your
page.)

</p><p>Finally, the most important CGI function is <code>param()</code>.  Call it with the
name of a form item, and a list of all the values
of that form item will be returned.  (If you ask for a scalar, you'll only get the
first value, no matter how many there are in the list.)</p>

<pre><code>$yourname = param("firstname");
print "&lt;P>Hi, $yourname!&lt;/P>\n";</code></pre>

<p>If you call <code>param()</code> without giving it the name of a form item, it will
return a list of <i>all</i> the form items that are available.  This form
of <code>param()</code> is the core of our backatcha script:</p>
<pre><code>for $i (param()) {
    print "&lt;b>$i&lt;/b>: ", param($i), "&lt;br>\n";
}</code></pre>
<p>Remember, a single form item can have more than one value.  You might encounter
code like this on the Web site of a pizza place that takes orders over
the Web:</p>
<pre>
    &lt;P>Pick your toppings!&lt;BR>
       &lt;INPUT TYPE=checkbox NAME=top VALUE=pepperoni> Pepperoni &lt;BR>
       &lt;INPUT TYPE=checkbox NAME=top VALUE=mushrooms> Mushrooms &lt;BR>
       &lt;INPUT TYPE=checkbox NAME=top VALUE=ham> Ham &lt;BR>
    &lt;/P>
</pre>
<p>Someone who wants all three toppings would submit a form where the form
item <code>top</code> has three values: "pepperoni," "mushrooms" and "ham."  The
server-side code might include this:</p>
<pre>
    print "&lt;P>You asked for the following pizza toppings: ";
    @top = param("top");
    for $i (@top) {
        print $i, ". ";
    }
    print "&lt;/P>";
</pre>

<p>Now, here's something to watch out for.  Take another look at the pizza-topping HTML code.  Try pasting that little fragment into the backatcha form,
just above the <code>&lt;INPUT TYPE=submit...></code> tag.  Enter a favorite color, and check
all three toppings.  You'll see this:</p>
<pre>
    favcolor: burnt sienna
    top: pepperonimushroomsham
</pre>
<p>Why did this happens?  When you call <code>param('name')</code>, you get back
a <i>list</i> of all of the values for that form item.  This could be considered
a bug in the <code>backatcha.cgi</code> script, but it's easily fixed - use <code>join()</code> to
separate the item values:</p>
<pre>
    print "&lt;b>$i&lt;/b>: ", join(', ', param($i)), "&lt;br>\n";
</pre>
<p>or call C&lt;param()> in a scalar context first to get only the first value:</p>
<pre>
    $j = param($i);
    print "&lt;b>$i&lt;/b>: $j<br>\n";
</pre>
<p>Always keep in mind that form items can have more than one value!
</p>

<h3><a name="second_script">Our Second Script</a></h3>

<p>So now we know how to build a CGI program, and we've seen a simple example.
Let's write something useful.  In the last article, we wrote a
pretty good HTTP log analyzer.  Why not Web-enable it?  This will allow you
to look at your usage figures from anywhere you can get to a browser.

<p><a href="/2000/12/httpreport.pl">Download the source code for the HTTP log analyzer</a></p>

</p><p>First, let's decide what we want to do with our analyzer.  Instead of
showing all of the reports we generate at once, we'll show only those
the user selects.  Second, we'll let the user choose whether each report
shows the entire list of items, or the top 10, 20 or 50 sorted by
access count.</p>

<p>We'll use a form such as this for our user interface:</p>
<pre>
    &lt;FORM ACTION="/cgi-bin/http-report.pl" METHOD=POST>
        &lt;P>Select the reports you want to see:&lt;/P>

 &lt;P>&lt;INPUT TYPE=checkbox NAME=report VALUE=url>URLs requested&lt;BR>
    &lt;INPUT TYPE=checkbox NAME=report VALUE=status>Status codes&lt;BR>
    &lt;INPUT TYPE=checkbox NAME=report VALUE=hour>Requests by hour&lt;BR>
    &lt;INPUT TYPE=checkbox NAME=report VALUE=type>File types
 &lt;/P>

 &lt;P>&lt;SELECT NAME="number">
     &lt;OPTION VALUE="ALL">Show all
     &lt;OPTION VALUE="10">Show top 10
     &lt;OPTION VALUE="20">Show top 20
     &lt;OPTION VALUE="50">Show top 50
 &lt;/SELECT>&lt;/P>

 &lt;INPUT TYPE=submit VALUE="Show report">
    &lt;/FORM>
</pre>
<p>(Remember that you may need to change the URL!)

</p><p>We're sending two different types of form item in this HTML page.
One is a series of checkbox widgets, which set values for the form
item <code>report</code>.  The other is a single drop-down list which will
assign a single value to <code>number</code>: either ALL, 10, 20 or 50.

</p><p>Take a look at the original HTTP log analyzer.  We'll start with two
simple changes.  First, the original program gets the filename of the
usage log from a command-line argument:</p>
<pre>
      # We will use a command line argument to determine the log filename.
      $logfile = $ARGV[0];
</pre>
<p>We obviously can't do that now, since the Web server won't allow us to enter
a command line for our CGI program!  Instead, we'll hard-code the
value of <code>$logfile</code>.  I'll use "/var/log/httpd/access_log" as a sample
value.</p>
<pre>
      $logfile = "/var/log/httpd/access_log";
</pre>
<p>Second, we must make sure that we output all the necessary headers to
our Web server before we print anything else:</p>
<pre>
      print header();
      print start_html( -title => "HTTP Log report" );
</pre>
<p>Now look at the <code>report()</code> sub from our original program.  It has
one problem, relative to our new goals: It outputs all the reports instead
of only the ones we've selected.  We'll rewrite <code>report()</code> so that it will
cycle through all the values of the <code>report</code> form item and show the
appropriate report for each.</p>
<pre>
 sub report {
    for $i (param('report')) {
 if ($i eq 'url') {
     report_section("URL requests", %url_requests);
 } elsif ($i eq 'status') {
     report_section("Status code requests", %status_requests);
 } elsif ($i eq 'hour') {
     report_section("Requests by hour", %hour_requests);
 } elsif ($i eq 'type') {
     report_section("Requests by file type", %type_requests);
 }
    }
 }
</pre>
<p>Finally, we rewrite the <code>report_section()</code> sub to output HTML instead
of plain text.  (We'll discuss the new way we're using <code>sort</code> in a moment.)</p>
<pre>
    sub report_section {
 my ($header, %type) = @_;
 my (@type_keys);

 # Are we sorting by the KEY, or by the NUMBER of accesses?
 if (param('number') ne 'ALL') {
     @type_keys = sort { $type{$b} <=> $type{$a}; } keys %type;

     # Chop the list if we have too many results
     if ($#type_keys > param('number') - 1) {
         $#type_keys = param('number') - 1;
     }
 } else {
     @type_keys = sort keys %type;
 }

 # Begin a HTML table
 print "&lt;TABLE>\n";

 # Print a table row containing a header for the table
 print "&lt;TR>&lt;TH COLSPAN=2>", $header, "&lt;/TH>&lt;/TR>\n";

 # Print a table row containing each item and its value
 for $i (@type_keys) {
     print "&lt;TR>&lt;TD>", $i, "&lt;/TD>&lt;TD>", $type{$i}, "&lt;/TD>&lt;/TR>\n";
 }

 # Finish the table
 print "&lt;/TABLE>\n";
    }
</pre>
<h3><a name="sorting">Sorting</a></h3>

<p>Perl allows you to sort lists with the <code>sort</code> keyword.
By default, the sort will happen alphanumerically: numbers before letters,
uppercase before lowercase.  This is sufficient 99 percent of the time.  The
other 1 percent of the time, you can write a custom sorting routine for Perl to use.

</p><p>This sorting routine is just like a small sub.  In it, you compare
two special variables, <code>$a</code> and <code>$b</code>, and return one of three values
depending on how you want them to show up in the list.  Returning
-1 means "<code>$a</code> should come before <code>$b</code> in the sorted list," 1 means
"<code>$b</code> should come before <code>$a</code> in the sorted list" and 0 means
"they're equal, so I don't care which comes first."  Perl will run this
routine to compare each pair of items in your list and produce the sorted
result.
</p><p>
For example, if you have a hash called <code>%type</code>, here's how you might sort
its keys in descending order of their <i>values</i> in the hash.</p>
<pre>
    sort {
        if ($type{$b} > $type{$a}) { return 1; }
 if ($type{$b} &lt; $type{$a}) { return -1; }
 return 0;
    } keys %type;
</pre>
<p>In fact, numeric sorting happens so often, Perl gives you a convenient
shorthand for it: the &lt;=> operator.  This operator will perform the above
comparison between two values for you and return the appropriate value.
That means we can rewrite that test as:</p>
<pre>
    sort { $type{$b} &lt;=> $type{$a}; } keys %type
</pre>
<p>(And this, in fact, is what we use in our log analyzer.)

</p><p>You can also compare strings with <code>sort</code>.  The <code>lt</code> and <code>gt</code> operators
are the string equivalents of <code>&lt;</code> and <code>&gt;</code>, and <code>cmp</code> will perform
the same test as <code>&lt;=&gt;</code>.  (Remember, string comparisons will sort
numbers before letters and uppercase before lowercase.)

</p><p>For example, you have a list of names and phone numbers in the
format "John Doe 555-1212."  You want to sort this list by the person's
last name, and sort by first name when the last names are the same.
This is a job made for <code>cmp</code>!</p>
<pre>
     @sorted = sort {
         ($c) = ($a =~ / (\w+)/);
  ($d) = ($b =~ / (\w+)/);
  if ($c eq $d) {   # Last names are the same, sort on first name
      ($c) = ($a =~ /^(\w+)/);
      ($d) = ($b =~ /^(\w+)/);
      return $c cmp $d;
  } else {
      return $c cmp $d;
  }
     } @phone_numbers;
     for $i (@sorted) { print $i, "\n"; }
</pre>
<h3><a name="trust">Trust No One</a></h3>

<p>Now that we know how CGI programs can do what you want, let's make sure
they won't do what you <i>don't</i> want.  This is harder than it looks,
because you can't trust anyone to do what you expect.

</p><p>Here's a simple example: You want to make sure the HTTP log analyzer
will never show more than 50 items per report, because it takes too long to
send larger reports to the user.  The easy thing to do would be to eliminate
the "ALL" line from our HTML form, so that the only remaining options
are 10, 20 and 50.  It would be very easy - and wrong.

<p><a href="/2000/12/httpsecured.pl">Download the source code for the HTTP analyzer with security enhancements</a>.</p>

</p><p>We saw that you can modify HTML forms when we pasted the pizza-topping
sample code into our backatcha page.  You can also use the URL
to pass form items to a script - try going to
<code>http://www.perl.com/2000/12/backatcha.cgi?itemsource=URL&amp;typedby=you</code>
in your browser.  Obviously, if someone can do this with the backatcha script,
they can also do it with your log analyzer and stick any value for <code>number</code>
in that they want: "ALL" or "25000", or "four score and seven years ago."

</p><p>Your form doesn't allow this, you say.  Who cares?  People will write custom
HTML forms to exploit weaknesses in your programs, or will just pass bad form
items to your script directly.  You cannot trust anything users or
their browsers tell you.

</p><p>You eliminate these problems by knowing what you expect from the user, and
<i>disallowing</i> everything else.  Whatever you do not expressly permit is
totally forbidden.  Secure CGI programs consider everything guilty until it
is <i>made</i> innocent.

</p><p>For example, we want to limit the size of reports from our HTTP log analyzer.
We decide that means the <code>number</code> form item must have a value that is
between 10 and 50.  We'll verify it like this:</p>
<pre>
    # Make sure that the "number" form item has a reasonable value
    ($number) = (param('number') =~ /(\d+)/);
    if ($number &lt; 10) {
        $number = 10;
    } elsif ($number > 50) {
        $number = 50;
    }
</pre>
<p>Of course, we also have to change the <code>report_section()</code> sub so it uses
the <code>$number</code> variable.  Now, whether your user tries to tell your log analyzer that the value of
<code>number</code> is "10," "200," "432023," "ALL" or "redrum," your program
will restrict it to a reasonable value.

</p><p>We don't need to do anything with <code>report</code>, because we only act when one
of its values is something we expected.  If the user tries to enter something
other than our expressly permitted values ("url," "status," "hour" or "type"),
we just ignore it.

</p><p>Use this sort of logic everywhere you know what the user <i>should</i>
enter.  You might use <code>s/\D//g</code> to remove non-numeric characters from items
that should be numbers (and then test to make sure what's left is
within your range of allowable numbers!), or <code>/^\w+$/</code> to make sure
that the user entered a single word.

</p><p>All of this has two significant benefits.  First, you simplify your
error-handling code, because you make sure as early in your program as
possible that you're working with valid data.  Second, you increase
security by reducing the number of "impossible" values that might help
an attacker compromise your system or mess with other users of your Web
server.

</p><p>Don't just take my word for it, though.  The <A HREF="http://www.w3.org/Security/Faq/">CGI Security FAQ</A>
has more information about safe CGI programming in Perl than you ever
thought could possibly exist, including a section listing some
<A HREF="http://www.w3.org/Security/Faq/wwwsf4.html#Q35">security holes</A> in real CGI programs.
</p>

<h3><a name="play_around">Play Around!</a></h3>

<p>You should now know enough about CGI programming to write a useful Web
application.  (Oh, and you learned a little bit more about sorting
and comparison.)
<ol>
<li>Write the quintessential CGI program: a guestbook.  Users enter
their name, e-mail address and a short message, which is appended to
an HTML file for all to see.

<p>Be careful!  Never trust the user!  A good beginning precaution is to
<i>disallow all HTML</i> by either removing &lt; and > characters from all of the
user's information or replacing them with the <code>&lt;</code> and <code>&gt;</code> character
entities.

<p>Use <code>substr()</code>, too, to cut anything the user enters down to
a reasonable size.  Asking for a "short" message will do nothing to prevent
the user dumping a 500k file into the message field!</li>

<li>Write a program that plays tic-tac-toe against the user.  Be sure that
the computer AI is in a sub so it can be easily upgraded.  (You'll probably
need to study HTML a bit to see how to output the tic-tac-toe board.)
</li>
</ol>









                                    </div>


                                </div>
                                <div class="asset-footer">


                                    <div class="entry-tags">
                                        <h4>Tags<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=CGI&amp;limit=20';return false;" rel="tag">CGI</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=s\criptingg&amp;limit=20';return false;" rel="tag">scriptingg</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=security&amp;limit=20';return false;" rel="tag">security</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=web&amp;limit=20';return false;" rel="tag">web</a></li>
                                        </ul>
                                    </div>

                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
