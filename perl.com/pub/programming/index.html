<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.02" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
    <title>Perl.com: Programming Archives</title>


</head>
<body id="perl-com" class="mt-archive-listing mt-category-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <div id="top_advert"> 
<!-- Put any landscape advert in here -->
<a href="http://www.perlfoundation.org/" target="_new">
<img src="/i/tpf_banner.png" width="468" height="60" /></a>
        </div> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description"></div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">

                            
                            <h1 id="page-title" class="archive-title">Recently in <em>Programming</em> Category</h1>






                            
                            <div id="entry-854" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/12/15/perl_prolog.html" rel="bookmark">Logic Programming with Perl and Prolog</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Robert Pratte</span> on <abbr class="published" title="2005-12-15T00:00:00-08:00">December 15, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<p>Computing languages can be addictive; developers sometimes blame themselves for perceived inadequacies, making apologies for them. That is the case, at least, when one defends his or her language of choice against the criticism of another language's devotee. Regardless, many programmers prefer one language, and typically ground that preference in a respect for that language's strengths.</p>

<p>Perl has many strengths, but two most often cited are its adaptability and propensity to work as a "glue" between applications and/or data. However, Perl isn't the only advantageous language: programmers have used C or even assembly to gain speed for years, and intelligent use of SQL allows the keen coder to offload difficult data manipulations onto a database, for example. Prolog is an often overlooked gem that, when combined with the flexibility of Perl, affords the coder powerful ways to address logical relationships and rules. In this article, I hope to provide a glimpse of the benefits that embedded Prolog offers to Perl programmers. Moreover, I hope that my example implementation demonstrates the ease with which one can address complex logical relationships.</p>

<h4>A Bit About Prolog</h4>

<p>For the sake of demonstration, I would like to frame a simple problem and solution that illustrate the individual strengths of Perl and Prolog, respectively. However, while I anticipate that the average reader will be familiar with the former, he or she may not be as familiar with the latter. <a href="http://en.wikipedia.org/wiki/Prolog">Prolog</a> is a logic programming language often used in AI work, based upon predicate calculus and first developed in 1972. There are several excellent, free versions of Prolog available today, including <a href="http://gnu-prolog.inria.fr">GNU Prolog</a> and the popular <a href="http://www.swi-prolog.org">SWI Prolog</a>. For the Prolog initiate, I recommend checking out some of the free Prolog tutorials, either those linked from Wikipedia or from <a href="http://oopweb.com/Prolog/Files/Prolog.html">OOPWeb</a>.</p>

<p>Prolog and Perl aren't exactly strangers, however. There are several excellent Perl modules available to allow the coder to access the power of Prolog quite easily, including the <a href="http://search.cpan.org/perldoc?Language::Prolog::SWI">SWI</a> module developed by Robert Barta, the <a href="http://search.cpan.org/perldoc?Language::Prolog::Interpreter">Interpreter</a> module by Lee Goddard, the <a href="http://search.cpan.org/perldoc?Language::Prolog::Yaswi">Yaswi</a> modules developed by Salvador Fandino Garcia, and the <a href="http://search.cpan.org/perldoc?AI::Prolog">AI::Prolog</a> module written by Curtis "Ovid" Poe. Poe has also recently provided a rather nice <a href="http://users.easystreet.com/ovid/presentations/logic">introduction to Prolog-in-Perl</a> in an online-accessible format.</p>

<h4>The Problem</h4>

<p>There are many advantages to using Prolog within Perl. In the general sense, each language has its own advantages, and can thus complement the other. Suppose that I am building a testing harness or a logic-based query engine for a web application, where neither language easily provides all of the features I need. In cases such as these, I could use Prolog to provide the logic "muscle," and Perl to "glue" things together with its flexibility and varied, readily available modules on CPAN.</p>

<p>In my simple demonstration, I am going to posit the requirement that I take genealogical information built by another application and test relationships based upon a set of rules. In this case, the rules are defined in a Prolog file (an interesting intersection here is that both Perl and Prolog typically use the suffix <em>.pl</em>), while the genealogical information is contained in a <a href="http://www.graphviz.org/Documentation.php">Dot</a> file readable by Graphviz. As such, I am going to make certain assumptions about the format of the data. Next, I am going to assume that I will have a query (web-based, or from yet another application) that will allow users to identify relationships (such as brothers, cousins, etc.).</p>

<p>Here are my Prolog rules:</p>

<pre><code>is_father(Person)        :- is_parent(Person, _),
                            is_male(Person).
is_father(Person, Child) :- is_parent(Person, Child),
                            is_male(Person).

is_mother(Person)        :- is_parent(Person, _),
                            is_female(Person).
is_mother(Person, Child) :- is_parent(Person, Child),
                            is_female(Person).

ancestor(Ancestor, Person) :- is_parent(Ancestor, Person).
ancestor(Ancestor, Person) :- is_parent(Ancestor, Child),
                              ancestor(Child, Person).

is_sibling(Person, Sibling) :- is_parent(X, Person),
                               is_parent(X, Sibling).

is_cousin(Person, Cousin) :- is_parent(X, Person),
                             is_parent(Y, Cousin),
                             is_sibling(X, Y).</code></pre>

<p>One advantage to separating my logic is that I can troubleshoot it before I even write the Perl code, loading the rules into a Prolog interpreter or IDE such as <a href="http://xgp.sourceforge.net">XGP</a> (for Macintosh users) and testing them. However, AI::Prolog conveniently provides its own solution: by typing <code>aiprolog</code> at the command line, I can access a Prolog shell, load in my file, and run some tests.</p>

<p>At this point, however, I am mostly interested in accessing these rules from Perl. While there are several options for accessing Prolog from within Perl, the <code>AI::Prolog</code> module is perhaps the easiest with which to start. Moreover, it is quite simple to use, the rules used to build the Prolog database being fed in when creating the <code>AI::Prolog</code> object. The ability to hand the object constructor a filehandle is not currently supported, but would indeed be a nice improvement. While there are other ways to accomplish the task of reading in the data, such as calling the Prolog command <code>consult</code>, I will read in the Prolog file (<a href="/2005/12/15/examples/ancestry.pl"><em>ancestry.pl</em></a>) and provide a string representation of the contents.</p>

<pre><code>open( PROLOGFILE, 'ancestry.pl' ) or die "$! \n";
local $/;
my $prologRules = &lt;PROLOGFILE&gt;;
close( PROLOGFILE );

my $prologDB = AI::Prolog-&gt;new( $prologRules );</code></pre>

<csperl file="grab" domain="on" record="b/1714" template="b/article_sidebar2.view">













<p>Now that I have loaded my Prolog database, I need to feed it some more information. I need to take my data, in Dot format, and translate it into something that my Prolog interpreter will understand. There are some modules out there that may be helpful, such as <a href="/pub/a/2004/09/23/fsms.html">DFA::Simple</a>, but since I can assume that my data will look a certain way--having written it from my other application--I will build my own simple parser. First, I am going to take a look at the data.</p>

<p>The visualization program created the diagram in Figure 1 from the code:</p>

<pre><code>digraph family_tree {
   { jill [ color = pink ]
     rob  [ color = blue ] } -&gt; { ann [ color = pink ]
                                  joe [ color = blue ] } ;

   { sue [ color = pink ] 
     dan [ color = blue ] } -&gt; { sara [ color = pink ]
                                 mike [ color = blue ] } ;

   { nan [ color = pink ]
     tom [ color = blue ] } -&gt; sue ;

   { nan
     jim [ color = blue ] } -&gt; rob ;

   { kate  [ color = pink ]
     steve [ color = blue ] } -&gt; dan ;

   { lucy  [ color = pink ]
     chris [ color = blue ] } -&gt; jill ;
}</code></pre>

<p><img src="/pub/2005/12/15/graphics/family_tree.gif" width="500" height="192" alt="a family tree" /><br />
<em>Figure 1. A family tree from the sample data</em>
</p>

<p>There are a few peculiarities worth mentioning here. First, it may seem that the all-lower-case names are a bit strange, but I am already preparing for the convention that data in Prolog is typically lower-case. Also, I inserted an extra space before the semicolons in an effort to make matching them easier. While both of these conventions are easy to code around, they seems to create extra questions when illustrating a point. Therefore, assume that the above Dot snippet illustrates the range of possible formats in the example. While the "real-world examples" may provide a richer set of possibilities, the fact that applications with defined behavior generated this data will limit the edge cases.</p>

<p>Returning to the data, it will be easiest to parse the Dot data using a simple state machine. Previously, I had defined some constants to represent states:</p>

<pre><code>use constant { modInit   =&gt; 0,
               modTag    =&gt; 1,
               modValue  =&gt; 2 };</code></pre>

<p>Basically, I assume that anything on the left-hand side of the <code>=</code> is a parent and anything on the right is a child. Additionally, modifiers (in this case only color) begin with a left square-bracket and males have the <code>blue</code> modifier, whereas females are <code>pink</code>. I know that I have completed a parent-child relationship "block" when I hit the semicolon. Past these stipulations, if it isn't a character I know that I can safely ignore, then it must be a noun.</p>

<pre><code>sub parse_dotFile {
   ##----------------------------------------
   ##  Examine data a word at a time
   ##----------------------------------------
   my @dotData = split( /\s+/, shift() );

   my ( $familyBlock, $personName, @prologQry ) = ();
   my $personModPosition                        = modInit;
   my $relationship                             = 'parent';

   for ( my $idx = 3; $idx &lt; @dotData; $idx++ ) {
      chomp( $dotData[$idx] );

      SWITCH: {

         ## ignore
         if ( $dotData[ $idx ] =~ /[{}=\]]/ ) {
            last SWITCH; }

         ## begin adding attributes
         if ( $dotData[ $idx ] eq '[' ) {
            $personModPosition = modTag;
            last SWITCH; }

         ## switch from parents to children
         if ( $dotData[ $idx ] eq '-&gt;' ) {
            $relationship = 'child';
            last SWITCH; }

         ## end of this block
         if ( $dotData[ $idx ] =~ /\;/ ) {
           ##-----------------------------------------
           ##  Generate is_parent rules for Prolog
           ##-----------------------------------------
            foreach my $parentInBlock ( @{ $familyBlock-&gt;{ parent } } ) {
               foreach my $childInBlock ( @{ $familyBlock-&gt;{ child } } ) {
                  push( @prologQry,
                      "is_parent(${parentInBlock}, ${childInBlock})" );
               }
            }
            $familyBlock = ();
            $relationship = 'parent';
            last SWITCH; }

         ## I have a noun, need to set something
         else {

            ## I have a modifier tag, next is the value
            if ( $personModPosition == modTag ) {
               $personModPosition = modValue;
               last SWITCH;

            } elsif ( $personModPosition == modValue ) {
                 ##--------------------------------------
                 ##  Set modifier value and reset
                 ##  We currently assume it is color
                 ##--------------------------------------
               if ( $dotData[ $idx ] eq 'blue' ) {

                  push( @prologQry, "is_male(${personName})" );
               } else {
                  push( @prologQry, "is_female(${personName})" );
               }
               $personModPosition = modInit;
               $personName        = ();
               last SWITCH;
            } else {
                 ##--------------------------------------
                 ##  Grab the name and id as parent or child
                 ##--------------------------------------
               $personName = $dotData[ $idx ];
               push( @{ $familyBlock-&gt;{ $relationship } }, $personName );
            }
         }
      }
   }

   return( \@prologQry );
}</code></pre>

<p>Rather than simply pushing my new rules into the Prolog interpreter directly, I return an array that contains the full ruleset. I am doing this so that I can easily dump it to a file for troubleshooting purposes. I can simply write the rules to a file, and consult this file in a Prolog shell.</p>

<p>With a subroutine to parse my Dot file into Prolog rules, I can now push those rules into the interpreter:</p>

<pre><code>   ##-------------------------------------------
   ##  Read in Dot file containing relations
   ##  and feed it into the Prolog instance
   ##-------------------------------------------
   open( DOTFILE, '<a href="/2005/12/15/examples/family_tree.dot">family_tree.dot</a>' ) or die "$! \n";
   my $parsedDigraph = parse_dotFile( &lt;DOTFILE&gt; );
   close( DOTFILE );

   foreach ( @$parsedDigraph ) {
      $prologDB-&gt;do("assert($_).");
   }</code></pre>

<p>Now I can easily query my Prolog database using the query method in <code>AI::Prolog</code>:</p>

<pre><code>   ##-------------------------------------------
   ##  Run the query
   ##-------------------------------------------
   $prologDB-&gt;query( "is_cousin(joe, sara)." );
   while (my $results = $prologDB-&gt;results) { print "@$results\n"; }</code></pre>

<h3>What Next?</h3>

<p>Even though this is a trivial example, I think that it provides an idea of the powerful ways in which Perl can be supplemented with Prolog. Just within the context of evaluating genealogical data (a mainstay of Prolog tutorials and examples), it seems that a Perl/Prolog application that uses genealogical data from open source genealogical software or websites would be a killer application. The possibilities seem endless: rules based upon Google maps, mining information from online auctions or news services, or even harvesting information for that new test harness are all tremendous opportunities for the marriage of Perl and Prolog.</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-842" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/11/03/subroutines.html" rel="bookmark">Making Sense of Subroutines</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Rob Kinyon</span> on <abbr class="published" title="2005-11-03T00:00:00-08:00">November  3, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />

<p><em>Editor's Note:  This article has a followup in <a href="/pub/a/2006/02/23/advanced_subroutines.html">Advanced Subroutine Techniques</a>.</em></p>

<p>A subroutine (or routine, function, procedure, macro, etc.) is, at its heart, a named chunk of work. It's shorthand that allows you to think about your problem in bigger chunks. Bigger chunks means two things:</p>

<ul>
<li>You can break the problem up into smaller problems that you can solve independently.</li>

<li>You can use these solutions to solve your overall problem with greater confidence.</li>
</ul>

<p>Well-written subroutines will make your programs smaller (in lines and memory), faster (both in writing and executing), less buggy, and easier to modify.</p>

<h3>You're Kidding, Right?</h3>

<p>Consider this: when you lift your sandwich to take a bite, you don't think about all the work that goes into contracting your muscles and coordinating your movements so that the mayo doesn't end up in your hair. You, in essence, execute a series of subroutines that say "Lift the sandwich up to my mouth and take a bite of it, then put it back down on the plate." If you had to think about all of your muscle contractions and coordinating them every time you wanted to take a bite, you'd starve to death.</p>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1714" template="b/article_sidebar.view">
<!-- sidebar ends -->

<p>The same is true for your code. We write programs for a human's benefit. The computer doesn't care how complicated or simple your code is to read--it converts everything to the same 1s and 0s whether it has perfect indentation or is all on one line. Programming guidelines, and nearly every single programming language feature, exist for human benefit.</p>

<h3>Tell Me More</h3>

<p>Subroutines truly are the magical cure for all that ails your programs. When done right, you will find that you write your programs in half the time, you have more confidence in what you've written, and you can explain it to others more easily.</p>

<h4>Naming</h4>

<p>A subroutine provides a name for a series of steps. This is especially important when dealing with complicated processes (or algorithms). While this includes ivory-tower solutions such as the Guttler-Rossman transformation (for sorting), this also includes the overly complicated way your company does accounts receivables. By putting a name on it, you're making it easier to work with.</p>

<h4>Code Reuse</h4>

<p>Face it--you're going to need to do the same thing over and over in different parts of your code. If you have the same 30 lines of code in 40 places, it's much harder to apply a bugfix or a requirements change. Even better, if your code uses subroutines, it's much easier to optimize just that one little bit that's slowing the whole application down. Studies have shown that 80 percent of the application's runtime generally occurs within one percent of an application's code. If that one percent is in a few subroutines, you can optimize it and hide the nasty details from the rest of your code.</p>

<h4>Testability</h4>

<p>To many people, "test" is a four-letter word. I firmly believe this is because they don't have enough interfaces to test against. A subroutine provides a way of grabbing a section of your code and testing it independently of all the rest of your code. This independence is key to having confidence in your tests, both now and in the future.</p>

<p>In addition, when someone finds a bug, the bug will usually occur in a single subroutine. When this happens, you can alter that one subroutine, leaving the rest of the system unchanged. The fewer changes made to an application, the more confidence there is in the fix not introducing new bugs along with the bugfix.</p>

<h4>Ease of Development</h4>

<p>No one argues that subroutines are bad when there are ten developers working on a project. They allow different developers to work on different parts of the application in parallel. (If there are dependencies, one developer can <em>stub</em> the missing subroutines.) However, they provide an equal amount of benefit for the solo developer: they allow you to focus on one specific part of the application without having to build all of the pieces up together. You will be happy for the good names you chose when you have to read code you wrote six months ago.</p>













<p>Consider the following example of a convoluted conditional:</p>

<pre><code>if ((($x &gt; 3 &amp;&amp; $x&lt;12) || ($x&gt;15 &amp;&amp; $x&lt;23)) &amp;&amp;
    (($y&lt;2260 &amp;&amp; $y&gt;2240) || ($z&gt;foo_bar() &amp;&amp; $z&lt;bar_foo()))) {</code></pre>

<p>It's very hard to exactly what's going on. Some judicious white space can help, as can improved layout. That leaves:</p>

<pre><code>if (
     (
       ( $x &gt; 3 &amp;&amp; $x &lt; 12) || ($x &gt; 15 &amp;&amp; $x &lt; 23)
     )
     &amp;&amp;
     (
       ($y &lt; 2260 &amp;&amp; $y &gt; 2240) || ($z &gt; foo_bar() &amp;&amp; $z &lt; bar_foo())
     )
   )
{</code></pre>

<p>Gah, that's almost worse. Enter a subroutine to the rescue:</p>

<pre><code>sub is_between {
    my ($value, $left, $right) = @_;

    return ( $left &lt; $value &amp;&amp; $value &lt; $right );
}

if (
    ( is_between( $x, 3, 12 ) ||
      is_between( $x, 15, 23 )
    ) &amp;&amp; (
      is_between( $y, 2240, 2260 ) ||
      is_between( $z, foo_bar(), bar_foo() )
    ) {</code></pre>

<p>That's so much easier to read. One thing to notice is that, in this case, the rewrite doesn't actually save any characters. In fact, this is slightly longer than the original version. Yet, it's easier to read, which makes it easier to both validate for correctness as well as to modify safely. (When writing this subroutine for the article, I actually found an error I had made--I had flipped the values for comparing <code>$y</code> so that the <code>$y</code> conditional could never be true.)</p>

<h3>How Do I Know if I'm Doing It Right?</h3>

<p>Just as there are good sandwiches (turkey club on dark rye) and bad sandwiches (peanut butter and banana on Wonder bread), there are also good and bad subroutines. While writing good subroutines is very much an art form, there are several characteristics you can look for when writing good subroutines. A good subroutine is readable and has a well-defined interface, strong internal cohesion, and loose external coupling.</p>

<h4>Readability</h4>

<p>The best subroutines are concise--usually 25-50 lines long, which is one or two average screens in height. (While <em>your</em> screen might be 110 lines high, you will one day have to debug your code on a VT100 terminal at 3 a.m. on a Sunday.)</p>

<p>Part of being readable also means that the code isn't overly indented. The guidelines for the Linux kernel code include a statement that all code should be less 80 characters wide and that indentations should be eight characters wide. This is to discourage more than three levels of indentation. It's too hard to follow the logic flows with any more than that.</p>

<h4>Well-Defined Interfaces</h4>

<p>This means that you know all of the inputs and all of the outputs. Doing this allows you to muck with either side of this wall and, so long as you keep to the contract, you have a <em>guarantee</em> that the code on the other side of the interface will be safe from harm. This is also critical to good testing. By having a solid interface, you can write test suites to validate both the subroutine and to mock the subroutine to test the code that uses it.</p>

<h4>Strong Internal Cohesion</h4>

<p>Internal cohesion is about how strongly the lines of code within the subroutine relate to one another. Ideally, a subroutine does one thing and only one thing. This means that someone calling the subroutine can be confident that it will do only what they want to have done.</p>

<h4>Loose External Coupling</h4>

<p>This means that changes to code outside of the subroutine will not affect how the subroutine performs, and vice versa. This allows you to make changes within the subroutine safely. This is also known as having no side effects.</p>

<p>As an example, a loosely coupled subroutine should not access global variables unnecessarily. Proper scoping is critical for any variables you create in your subroutine, using the <code>my</code> keyword.</p>

<p>This also means that a subroutine should be able to run without depending upon other subroutines to be run before or after it. In functional programming, this means that the function is <em>stateless</em>.</p>

<p>Perl has global special variables (such as <code>$_</code>, <code>@_</code>, <code>$?</code>, <code>$@</code>, and <code>$!</code>). If you modify them, be sure to localize them with the <code>local</code> keyword.</p>













<h3>What Should I Call It?</h3>

<p>Naming things well is important for all parts of your code. With subroutines, it's even more important. A subroutine is a chunk of work described to the reader only by its name. If the name is too short, no one knows what it means. If the name is too long, then it's too hard to understand and potentially difficult to type. If the name is too specific, you will confuse the reader when you call it for more general circumstances.</p>

<p>Subroutine names should flow when read out loud: <code>doThis()</code> for actions and <code>is_that()</code> for Boolean checks. Ideally, a subroutine name should be <code><em>verbNoun</em>()</code> (or <code><em>verb_noun</em>()</code>). To test this, take a section of your code and read it out loud to your closest non-geek friend. When you're done, ask them what that piece of code should do. If they have no idea, your subroutines (and variables) may have poor names. (I've provided examples in two forms, "camelCase" and "under_score." Some people prefer one way and some prefer the other. As long as you're consistent, it doesn't matter which you choose.)</p>

<h3>What Else Can I Do?</h3>

<p>(This section assumes a strong grasp of Perl fundamentals, especially hashes and references.)</p>

<p>Perl is one of a class of languages that allows you to treat subroutines as first-class objects. This means you can use subroutines in nearly every place you can use a variable. This concept comes from functional programming (FP), and is a very powerful technique.</p>

<p>The basic building block of FP in Perl is the reference to a subroutine, or <code><em>subref</em></code>. For a named subroutine, you can say <code>my $subref = \&amp;foobar;</code>. You can then say <code>$subref-&gt;(1, 2)</code> and it will be as if you said <code>foobar(1, 2)</code>. A subref is a regular scalar, so you can pass it around as you can any other reference (say, to an array or hash) and you can put them into arrays and hashes. You can also construct them anonymously by saying <code>my $subref = sub { ... };</code> (where the <code>...</code> is the body of the subroutine).</p>

<p>This provides several very neat options.</p>

<h4>Closures</h4>

<p>Closures are the main building blocks for using subroutines in functional programming. A closure is a subroutine that remembers its lexical scratchpad. In English, this means that if you take a reference to a subroutine that uses a <code>my</code> variable defined outside of it, it will remember the value of that variable when it was defined and be able to access it, even if you use the subroutine outside of the scope of that variable.</p>

<p>There are two main variations of closures you see in normal code. The first is a named closure.</p>

<pre><code>{
    my $counter = 0;
    sub inc_counter { return $counter++ }
}</code></pre>

<p>When you call <code>inc_counter()</code>, you're obviously out of scope for the <code>$counter</code> variable. Yet, it will increment the counter and return the value as if it were in scope.</p>

<p>This is a very good way to handle global state, if you're uncomfortable with object-oriented programming. Just extend the idea to multiple variables and have a getter and setter for each one.</p>

<p>The second is an anonymous closure.</p>

<h4>Recursion</h4>

<p>Many recursive functions are simple enough that they do not need to keep any state. Those that do are more complicated, especially if you want to be able to call the function more than once at a time. Enter anonymous subroutines.</p>

<pre><code>sub recursionSetup {
    my ($x, $y) = @_;

    my @stack;

    my $_recurse = sub {
        my ($foo, $bar) = @_;

        # Do stuff here with $x, $y, and @stack;
    };
    my $val = $_recurse-&gt;( $x, $y );

    return $val;
}</code></pre>

<h4>Inner Subroutines</h4>

<p>Subroutine definitions are global in Perl. This means that Perl doesn't have inner subroutines.</p>

<pre><code>sub foo {
    sub bar {
    }

    # This bar() should only be accessible from within foo(),
    # but it is accessible from everywhere
    bar():
}</code></pre>

<p>Enter anonymous subroutines again.</p>

<pre><code>sub foo {
    my $bar = sub {
    };

    # This $bar is only accessible from within foo()
    $bar-&gt;();
}</code></pre>













<h4>Dispatch Tables</h4>

<p>Often, you need to call a specific subroutine based some user input. The first attempts to do this usually look like this:</p>

<pre><code>if ( $input eq 'foo' ) {
    foo( @params );
}
elsif ( $input eq 'bar' ) {
    bar( @params );
}
else {
    die "Cannot find the subroutine '$input'\n";
}</code></pre>

<p>Then, some enterprising soul learns about soft references and tries something like this:</p>

<pre><code>&amp;{ $input }( @params );</code></pre>

<p>That's unsafe, because you don't know what <code>$input</code> will to contain. You cannot guarantee <em>anything</em> about it, even with taint and all that jazz on. It's much safer just to use dispatch tables:</p>

<pre><code>my %dispatch = (
    foo =&gt; sub { ... },
    bar =&gt; \&amp;bar,
);

if ( exists $dispatch{ $input } ) {
    $dispatch{ $input }-&gt;( @params );
}
else {
    die "Cannot find the subroutine '$input'\n";
}</code></pre>

<p>Adding and removing available subroutines is simpler than the <code>if</code>-<code>elsif</code>-<code>else</code> scenario, and this is much safer than the soft references scenario. It's the best of both worlds.</p>

<h4>Subroutine Factories</h4>

<p>Often, you will have many subroutines that look very similar. You might have accessors for an object that differ only in which attribute they access. Alternately, you might have a group of mathematical functions that differ only in the constants they use.</p>

<pre><code>sub make_multiplier { 
    my ($multiplier) = @_;

    return sub {
        my ($value) = @_;
        return $value * $multiplier;
    };
}

my $times_two  = make_multiplier( 2 );
my $times_four = make_multiplier( 4 );

print $times_two-&gt;( 6 ), "\n";
print $times_four-&gt;( 3 ), "\n";

----

12
12</code></pre>

<p>Try that code and see what it does. You should see the values below the dotted line.</p>

<h3>Conclusion</h3>

<p>Subroutines are arguably the most powerful tool in a programmer's toolbox. They provide the ability to reuse sections of code, validate those sections, and create new algorithms that solve problems in novel ways. They will reduce the amount of time you spend programming, yet allow you to do more in that time. They will reduce the number of bugs in your code ten-fold, and allow other people to work with you while feeling safe about it. They truly are programming's super-tool.</p>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-838" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/10/06/wxperl_menus.html" rel="bookmark">Making Menus with wxPerl</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Roberto Alamos</span> on <abbr class="published" title="2005-10-06T00:00:00-08:00">October  6, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>In a previous article about wxPerl published on Perl.com, Jouke Visser taught <a href="/pub/a/2001/09/12/wxtutorial1.html">the very basics of wxPerl programming</a>. In this article, I will continue with Jouke's work, explaining how to add menus in our wxPerl applications. I will cover the creation, editing, and erasure of menus with the <a href="http://search.cpan.org/perldoc?Wx::Menu">Wx::Menu</a> and Wx::MenuBar modules, and also will show examples of their use.</p>

<h3>Conventions</h3>

<p>I assume that you understand the wxPerl approach to GUI programming, so I won't explain it here. The following code is the base for the examples in this article:</p>

<pre><code>use strict;
use Wx;

package WxPerlComExample;

use base qw(Wx::App);

sub OnInit {
    my $self  = shift;
    my $frame = WxPerlComExampleFrame-&gt;new(undef, -1, "WxPerl Example");

    $frame-&gt;Show(1);
    $self-&gt;SetTopWindow($frame);

    return 1;
}

package WxPerlComExampleFrame;

use base qw(Wx::Frame);

use Wx qw( 
    wxDefaultPosition wxDefaultSize wxDefaultPosition wxDefaultSize wxID_EXIT
);

use Wx::Event qw(EVT_MENU);

our @id = (0 .. 100); # IDs array

sub new {
    my $class = shift;
    my $self  = $class-&gt;SUPER::new( @_ );

    ### CODE GOES HERE ###

    return $self;
}

### PUT SUBROUTINES HERE ###

package main;

my($app) = WxPerlComExample-&gt;new();

$app-&gt;MainLoop();</code></pre>

<p><code>@id</code> is an array of integer numbers to use as unique identifier numbers. In addition, the following definitions are important:</p>

<ul>
<li><b>Menu bar</b>: The bar located at the top of the window where menus will appear. This is a particular instance of Wx::MenuBar.</li>

<li><b>Menu</b>: A particular instance of Wx::Menu.</li>

<li><b>Item</b>: An option inside of a (sub)menu.</li>
</ul>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1714" template="b/article_sidebar2.view">
<!-- sidebar ends -->













<h3>A Quick Example</h3>

<p>Instead of wading through several pages of explanation before the first example, here is a short example that serves as a summary of this article. Note that I have divided it in two parts. Add this code to the base code in the <code>WxPerlComExampleFrame</code> constructor:</p>

<pre><code># Create menus
my $firstmenu = Wx::Menu-&gt;new();
$firstmenu-&gt;Append($id[0], "Normal Item");
$firstmenu-&gt;AppendCheckItem($id[1], "Check Item");
$firstmenu-&gt;AppendSeparator();
$firstmenu-&gt;AppendRadioItem($id[2], "Radio Item");

my $secmenu   = Wx::Menu-&gt;new();
$secmenu-&gt;Append(wxID_EXIT, "Exit\tCtrl+X");

# Create menu bar
my $menubar   = Wx::MenuBar-&gt;new();
$menubar-&gt;Append($firstmenu, "First Menu");
$menubar-&gt;Append($secmenu, "Exit Menu");

# Attach menubar to the window
$self-&gt;SetMenuBar($menubar);
$self-&gt;SetAutoLayout(1);

# Handle events only for Exit and Normal item
EVT_MENU( $self, $id[0], \&amp;ShowDialog );
EVT_MENU( $self, wxID_EXIT, sub {$_[0]-&gt;Close(1)} );</code></pre>

<p>Insert the following code into the base code at the line <code>### PUT SUBROUTINES HERE ###</code>.</p>

<pre><code>use Wx qw(wxOK wxCENTRE);

# The following subroutine will be called when you click in the normal item

sub ShowDialog {
  my($self, $event) = @_;
  Wx::MessageBox( "This is a dialog", 
                  "Wx::MessageBox example", 
                   wxOK|wxCENTRE, 
                   $self
               );
}</code></pre>

<p>Run this example to see something like Figures 1 and 2.</p>

<p><img src="/pub/2005/10/06/graphics/qexample1.jpg" width="290" height="224" alt="a menu with complex sub-items" /><br />
<em>Figure 1. A menu with complex sub-items</em>
</p>

<p><img src="/pub/2005/10/06/graphics/qexample2.jpg" width="290" height="224" alt="a menu with a single sub-item" /><br />
<em>Figure 2. A menu with a single sub-item</em>
</p>

<h3>Programming Menus</h3>

<p>To add a menu to your wxPerl application, you must know how to use two Perl modules that come with WxPerl: Wx::MenuBar and Wx::Menu. Wx::MenuBar creates and manages the bar that contains menus created with Wx::Menu. There is also a third module involved: Wx::MenuItem. This module, as its name implies, creates and manages menu items. You usually don't need to use it, because almost all of the operations you need for a menu item are available through Wx::Menu methods.</p>













<h4>Using Wx::Menu</h4>

<p>Creating a menu with Wx::Menu is as easy as:</p>

<pre><code>my $menu = Wx::Menu-&gt;new();</code></pre>

<p>Now <code>$menu</code> is a Wx::Menu object. WxPerl has five types of items. The first is the normal item, upon which you can click to get a response (a dialog or something else). The second is the check item, which has the Boolean property of being checked or not (independent of another check items). The third item is the radio item, which is an "exclusive check item;" if you check a particular radio item, other radio items in its radio group get unchecked instantly. The fourth type of item is the separator, which is just a straight line that acts as a barrier that separates groups of similar items inside of a menu. The fifth type is the submenu, an item that expands another menu when the mouse cursor is over it.</p>

<h5>Setting Up Menu Items</h5>

<p>To create a normal item for your menu, write:</p>

<pre><code>$menu-&gt;Append($id, $label, $helpstr);</code></pre>

<p>where <code>$id</code> is an unique integer that identifies this item, <code>$label</code> is the text to display on the menu, and <code>$helpstr</code> is a string to display in the status bar. (This last argument is optional.) Note that every menu item must have an unique identifier number in order to be able to operate with this item during the rest of the program. (From now on, <code>$id</code> will denote the unique identifier number of a menu item.)</p>

<p>To create a check or radio item, the methods are analogous to <code>Append</code>--<code>AppendCheckItem</code> and <code>AppendRadioItem</code>, respectively. Add a separator with the <code>AppendSeparator</code> method; it does not expect arguments. Create a submenu with the <code>AppendSubMenu</code> method:</p>

<pre><code>$menu-&gt;AppendSubMenu($id, $label, $submenu, $helpstr);</code></pre>

<p>where <code>$submenu</code> is an instance to another Wx::Menu object. (Don't try to make that a submenu be a submenu of itself, because the Universe will crash or, in the best case, your program won't execute at all.)</p>

<p>While append methods add menu items in the last position of your menus, Wx::Menu gives you methods to add menu items at any position you want. For instance, to add a normal item at some position in a menu:</p>

<pre><code>$menu-&gt;Insert($pos, $id, $label, $helpstr);</code></pre>

<p>where <code>$pos</code> is the position of the item, starting at 0. To add a radio item, check item, or separator, use the <code>InsertRadioItem</code>, <code>InsertCheckItem</code>, or <code>InsertSeparator</code> methods. As usual, the latter takes no arguments. To insert a submenu, use the <code>InsertSubMenu</code> method:</p>

<pre><code>$menu-&gt;InsertSubMenu($pos, $id, $label, $submenu, $helpstr);</code></pre>

<p>You can also insert an item at the first position by using the <code>Prepend</code> method:</p>

<p>$menu-&gt;Prepend($id, $label, $helpstr);</p>

<p><code>PrependRadioItem</code>, <code>PrependCheckItem</code>, and <code>PrependSeparator</code> methods are also available. As you might expect, there's a <code>PrependSubMenu</code> method that works like this:</p>

<p><code>$menu-&gt;PrependSubMenu($id, $label, $submenu, $helpstr);</code>
</p>

<p>Sometimes, a menu grows to include too many menu items, and then it's impractical to show them all. For this problem, Wx::Menu has the <code>Break</code> method. When called, it causes Wx to place subsequently appended items into another column. Call this method like so:</p>

<pre><code>$menu-&gt;Break();</code></pre>

<h5>Menu Item Methods</h5>

<p>Once you have created your items, you need some way to operate on them, such as finding information about them through their identifier numbers, getting or setting their labels or help strings, enabling or disabling them, checking or unchecking them, or removing them. For example, you may want to retrieve some specific menu item in some point of your program. To do this, use the <code>FindItem</code> method in either of two ways:</p>

<pre><code>my $menuitem_with_the_given_id = $menu-&gt;FindItem($id);
my ($menuitem, $submenu)        = $menu-&gt;FindItem($id);</code></pre>

<p>where <code>$menuitem</code> is the corresponding Wx::MenuItem object with the identifier <code>$id</code>, and <code>$submenu</code> is the (sub)menu to which <code>$menuitem</code> belongs. You can also retrieve a menu item through the <code>FindItemByPosition</code> method (but remember that positions start at 0):</p>

<pre><code>my $menuitem = $menu-&gt;FindItemByPosition($pos);</code></pre>

<p>Wx::Menu provides methods to get or set properties of menu items. To set a property, there are two methods: <code>SetLabel</code> and <code>SetHelpString</code>. A <code>SetLabel</code> call might be:</p>

<pre><code>$menu-&gt;SetLabel($id, $newlabel);</code></pre>

<p><code>SetHelpString</code> works similarly:</p>

<pre><code>$menu-&gt;SetHelpString($id, $newhelpstr);</code></pre>













<p>To retrieve the label or help string of a particular item, use the <code>GetLabel</code> and <code>GetHelpString</code> methods. Both methods expect the menu item identifier number as the sole argument.</p>

<p>Every menu item has an <em>enabled</em> property that makes an item available or unavailable. By default, all items are enabled. To enable or disable a particular menu item, use the <code>Enable</code> method:</p>

<pre><code>$menu-&gt;Enable($id, $boolean);</code></pre>

<p>where <code>$boolean</code> is 0 or 1, depending if you want to disable or enable it, respectively. Maybe your next question is how to check if a menu item is enabled; use the <code>IsEnabled</code> method:</p>

<pre><code>$menu-&gt;IsEnabled($id);</code></pre>

<p>This returns <code>TRUE</code> or <code>FALSE</code>, depending on the status of the menu item.</p>

<p>Radio items and check items have the <em>checked</em> property that indicates the selection status of the item. By default, no check item is checked at the start of the execution of your program. For radio items, the first one created is checked at the start of execution. Use the <code>Check</code> method to check or uncheck a radio or check item:</p>

<pre><code>$menu-&gt;Check($id, $boolean);</code></pre>

<p>To determine if a menu item is checked, use <code>IsChecked</code>:</p>

<pre><code>$menu-&gt;IsChecked($id);</code></pre>

<p>This method, as does <code>IsEnabled</code>, returns <code>TRUE</code> or <code>FALSE</code>.</p>

<p>It's also possible to get the number of menu items your menu has. For this, use the <code>GetMenuItemCount</code> method:</p>

<pre><code>$menu-&gt;GetMenuItemCount();</code></pre>

<p>note that if <code>@args</code> is the argument's array, then <code>$menu-&gt;Append(@args)</code> and <code>$menu-&gt;Insert($menu-&gt;GetMenuItemCount(), @args)</code> are the same.</p>

<p>Finally, it's important to know that there are three ways to remove an item from a menu (honoring Larry Wall's phrase: "There's more than one way to do it"). The first is the <code>Delete</code> method, which just kills the menu item without compassion:</p>

<pre><code>$menu-&gt;Delete($id);</code></pre>

<p>This method returns nothing. Be careful--WxWidgets documentation says that the <code>Delete</code> method doesn't delete a menu item that's a submenu. Instead, the documentation recommends that you use the <code>Destroy</code> method to delete a submenu. In wxPerl, this isn't true. <code>Delete</code> is certainly capable of deleting a submenu, and is here equivalent to the <code>Destroy</code> method. I don't know the reason for this strange behavior.</p>

<p>The <code>Destroy</code> method looks like this:</p>

<pre>$menu-&gt;Destroy($id);</pre>

<p>If you want to remove an item but not destroy it, then the <code>Remove</code> method is for you. It allows you to store the menu item that you want to delete in a variable for later use, and at the same time delete it from its original menu. Use it like so:</p>

<pre><code>my $removed_item = $menu-&gt;Remove($id);</code></pre>

<p>Now you have your menu item with the identifier <code>$id</code> in the <code>$removed_item</code> variable (it now contains a Wx::MenuItem object). You can now use this variable to relocate the removed item into another menu with the append methods. For example:</p>

<pre><code>$other_menu-&gt;Append($removed_item);</code></pre>

<p>does the same thing as:</p>

<pre><code>$other_menu-&gt;Append($id_removed_item, $title_removed_item, 
    $helpstr_removed_item);</code></pre>

<p>but in a shorter way.</p>

<p>Finally, it's useful to be able to remove a submenu's menu item. You can't use the <code>Destroy</code>, <code>Delete</code>, or <code>Remove</code> methods, because they don't work. Instead, you need to do something like this:</p>

<pre><code>my ($mitem, $submenu) = $menu-&gt;FindItem($mitem_id);</code></pre>

<p>where <code>$mitem_id</code> is the identifier number of the submenu's menu item you're looking for. <code>$submenu</code> is a Wx::Menu object, just as <code>$menu</code> is, and hence you can use all the methods mentioned here, so the only thing you have to do to remove <code>$mitem</code> from <code>$submenu</code> is:</p>

<pre><code>$submenu-&gt;Delete($mitem_id);</code></pre>

<p>As the good reader that I am sure you are, you already have realized that this isn't the only thing you can do with the <code>$submenu</code> object. In fact, you can now add new menu items to your submenu, delete another menu item, and in general do everything mentioned already.</p>













<h4>Using Wx::MenuBar</h4>

<p>You have created your menus and obviously want to use them. The last step to get the job done is to create the menu bar that will handle your menus. When you want to create a menu bar, the first step is to enable your code to handle menu events. This is the job of the Wx::Event module:</p>

<pre><code>use Wx::Event qw(EVT_MENU)</code></pre>

<p>Now create a Wx::MenuBar object:</p>

<pre><code>my $menubar = Wx::MenuBar-&gt;new();</code></pre>

<p>This object will contain all of the menus that you want to show on your window. To associate a menu bar with a frame, call the <code>SetMenuBar</code> method from Wx::Frame:</p>

<pre><code>$self-&gt;SetMenuBar($menubar);</code></pre>

<p>where <code>$self</code> is the Wx::Frame object inherited in <code>WxPerlComExampleFrame</code>'s constructor. Note that if your application has MDI characteristics, or has many windows, then you have to take in account that Wx first sends menu events to the focused window. (I won't cover this issue in this article, so for more information, review the WxWidgets documentation.) Finally, be sure to call the <code>EVT_MENU</code> subroutine as many times as you have menu items that execute some action when clicked:</p>

<pre><code>EVT_MENU($self, $menu_item_id, \&amp;subroutine);</code></pre>

<p>where <code>$self</code> is the object of your package's <code>new</code> method, <code>$menu_item_id</code> is the unique identifier of the menu item involved, and <code>subroutine</code> is the name of the subroutine that will handle the click event you want to catch.</p>

<h5>Setting Up Menus</h5>

<p>The first thing to do once you have created your menu bar is to attach your menus to the menu bar. There are two methods for this: <code>Append</code> and <code>Insert</code>. <code>Append</code>, as you might expect, attaches a menu in the last position:</p>

<pre><code>$menubar-&gt;Append($menu, $label);</code></pre>

<p>where <code>$menu</code> is the menu created in the previous section and <code>$label</code> is the name to display for this menu in the menu bar. To insert a menu in an arbitrary position, use the <code>Insert</code> method:</p>

<pre><code>$menubar-&gt;Insert($pos, $menu, $label);</code></pre>

<p>where <code>$pos</code> is the position of your menu, starting at 0.</p>

<h5>Menu Methods</h5>

<p>Wx::MenuBar provides some methods that are also present in Wx::Menu and work in the same way. This methods are <code>Check</code>, <code>Enable</code>, <code>FindItem</code>, <code>GetLabel</code>, <code>GetHelpString</code>, <code>SetLabel</code>, <code>SetHelpString</code>, <code>IsChecked</code>, and <code>IsEnabled</code>. Besides these methods, Wx::MenuBar has its own set of methods to manage the properties of the menu bar. For example, as a menu item, a menu has its own <em>enabled</em> property, which you toggle with the <code>EnableTop</code> method:</p>

<pre><code>$menubar-&gt;EnableTop($pos, $boolean);</code></pre>

<p>where <code>$pos</code> is the position of your menu (starting at 0) and <code>$boolean</code> is <code>TRUE</code> or <code>FALSE</code>, depending on whether you want that menu enabled. Note that you can use this method only after you attach your menu bar to the window through the <code>SetMenuBar</code> method.</p>

<p>Wx::MenuBar has methods to retrieve an entire menu or menu item given its title or (menu title, menu item label) pair, respectively. In the first case, use the code:</p>

<pre><code>$menu_with_the_given_title = $menubar-&gt;FindMenu($title);</code></pre>

<p>In the second case:</p>

<pre><code>$menu_item = $menubar-&gt;FindMenuItem($menu_title, $menu_item_label);</code></pre>

<p>In both cases, the returned variables are Wx::Menu objects. You can also retrieve a menu if you provide its position (starting at 0):</p>

<pre><code>$menu_with_the_given_pos = $menubar-&gt;GetMenu($pos);</code></pre>

<p>As in the Wx::Menu case, Wx::MenuBar provides methods to set or get the label of a specific menu and to retrieve the number of menus in a menu bar. Those methods are <code>SetLabelTop</code>, <code>GetLabelTop</code>, and <code>GetMenuCount</code> respectively. Use them like this:</p>

<pre><code>$menu-&gt;SetLabelTop($pos, $label);
my $menu_label = $menu-&gt;GetLabelTop($pos);
my $num_menu   = $menu-&gt;GetMenuCount();</code></pre>

<p>where <code>$pos</code> is the position of the menu and <code>$label</code> is the new label that you want to put on your menu. Note that <code>GetLabelTop</code>'s result doesn't include accelerator characters inside the returned string.</p>

<p>Finally, Wx::MenuBar gives two more choices to remove a menu. The first method is <code>Replace</code>, which replaces it with another menu:</p>

<pre><code>$menubar-&gt;Replace($pos, $new_menu, $label);</code></pre>

<p>where <code>$pos</code> is the position of the menu to remove, <code>$new_menu</code> is the new menu that will be in the <code>$pos</code> position, and <code>$label</code> is the label to display on the menu bar for <code>$new_menu</code>. The second choice is to remove a menu, just by removing it with the <code>Remove</code> method:</p>

<pre><code>my $removed_menu = $menubar-&gt;Remove($pos);</code></pre>

<p><code>Remove</code> returns the <code>$removed_menu</code> object, so if you need it in the future, it'll be still there waiting for you.</p>













<h3>Example</h3>

<p>With all of that explained, I can show a full, working example. As before, add this code to the base code in the blank spot in the <code>WxPerlComExampleFrame</code> constructor.</p>

<pre><code># Create menus
# Action's sub menu
my $submenu = Wx::Menu-&gt;new();
$submenu-&gt;Append($id[2], "New normal item");
$submenu-&gt;Append($id[3], "Delete normal item");
$submenu-&gt;AppendSeparator();
$submenu-&gt;Append($id[4], "New check item");
$submenu-&gt;Append($id[5], "Delete check item");
$submenu-&gt;AppendSeparator();
$submenu-&gt;Append($id[6], "New radio item");
$submenu-&gt;Append($id[7], "Delete radio item");

# Disable items for this submenu
for(2..7) {
    $submenu-&gt;Enable($id[$_], 0);
}

# Actions menu
my $actionmenu = Wx::Menu-&gt;new();
$actionmenu-&gt;Append($id[0], "Create Menu"); # Create new menu
$actionmenu-&gt;Append($id[1], "Delete Menu"); # Delete New Menu
$actionmenu-&gt;AppendSeparator();
$actionmenu-&gt;AppendSubMenu($id[100], "New Item", $submenu); # Create item submenu
$actionmenu-&gt;AppendSeparator();
$actionmenu-&gt;Append(wxID_EXIT, "Exit\tCtrl+X"); # Exit

# At first, disable the Delete Menu option
$actionmenu-&gt;Enable($id[1], 0);

# Create menu bar
$self-&gt;{MENU} = Wx::MenuBar-&gt;new();
$self-&gt;{MENU}-&gt;Append($actionmenu, "Actions");

# Attach menubar to the window
$self-&gt;SetMenuBar($self-&gt;{MENU});
$self-&gt;SetAutoLayout(1);

# Handle events
EVT_MENU($self, $id[0], \&amp;MakeActionMenu);
EVT_MENU($self, $id[1], \&amp;MakeActionMenu);
EVT_MENU($self, $id[2], \&amp;MakeActionNormal);
EVT_MENU($self, $id[3], \&amp;MakeActionNormal);
EVT_MENU($self, $id[4], \&amp;MakeActionCheck);
EVT_MENU($self, $id[5], \&amp;MakeActionCheck);
EVT_MENU($self, $id[6], \&amp;MakeActionRadio);
EVT_MENU($self, $id[7], \&amp;MakeActionRadio);

EVT_MENU($self, wxID_EXIT, sub {$_[0]-&gt;Close(1)});</code></pre>

<p>This code creates a menu called <em>Actions</em> with the following options inside:</p>

<ul>
<li><b>Create Menu</b>: When a user clicks this option, the program creates a new menu called <em>New Menu</em> at the right side of the <em>Actions</em> menu. The <em>Create Menu</em> option is enabled by default, but creating the menu disables this option.</li>

<li><b>Delete Menu</b>: Deletes the menu created with <em>Create Menu</em>. This option is disabled by default and is enabled when <em>New Menu</em> exists.</li>

<li><b>New normal item</b>: This option creates the <em>Normal item</em> option on <em>New Menu</em> when it exists. It is disabled by default.</li>

<li><b>Delete normal item</b>: Deletes <em>Normal item</em> when it exists. It is disabled by default.</li>

<li><b>New check item</b>: Creates the <em>Check item</em> option on <em>New Menu</em> when it exists. It is disabled by default. <em>Check item</em> is unchecked by default.</li>

<li><b>Delete check item</b>: Deletes <em>Check item</em> when it exists. It is disabled by default.</li>

<li><b>New radio item</b>: Creates the <em>Radio item</em> option on <em>New Menu</em> when it exists. It is disabled by default. <em>Radio item</em> is checked by default.</li>

<li><b>Delete radio item</b>: Deletes <em>Radio item</em> when it exists. It is disabled by default.</li>

<li><b>Exit</b>: Exits the program.</li>
</ul>

<p>Once the code has created the menu, it attaches the menu to the menu bar saved on <code>$self-&gt;{MENU}</code>, then calls the <code>EVT_MENU</code> subroutine eight times to handle all of the menu events from <em>Action</em>'s menu items. Add the following code to the base code where it says <code>### PUT SUBROUTINES HERE ###</code>:</p>

<pre><code># Subroutine that handles menu creation/erasure
sub MakeActionMenu {
    my($self, $event) = @_;

    # Get Actions menu
    my $actionmenu    = $self-&gt;{MENU}-&gt;GetMenu(0);

    # Now check if we have to create or delete the New Menu
    if ($self-&gt;{MENU}-&gt;GetMenuCount() == 1) {
        # New Menu doesn't exist

        # Create menu
        my $newmenu = Wx::Menu-&gt;new();
        $self-&gt;{MENU}-&gt;Append($newmenu, "New Menu");       

        # Disable and Enable options
        $actionmenu-&gt;Enable($id[0], 0); # New menu
        $actionmenu-&gt;Enable($id[1], 1); # Delete menu
        $actionmenu-&gt;Enable($id[2], 1); # New normal item
        $actionmenu-&gt;Enable($id[3], 0); # Delete normal item
        $actionmenu-&gt;Enable($id[4], 1); # New check item
        $actionmenu-&gt;Enable($id[5], 0); # Delete check item
        $actionmenu-&gt;Enable($id[6], 1); # New radio item
        $actionmenu-&gt;Enable($id[7], 0); # Delete radio item
    } else {
        # New Menu exists

        # Remove menu
       $self-&gt;{MENU}-&gt;Remove(1);

        # Enable and disable options
        $actionmenu-&gt;Enable($id[0], 1);

        for(1..7) {
               $actionmenu-&gt;Enable($id[$_], 0);
        }
    }

    return 1;
}

# Subroutine that handles normal item creation/erasure
sub MakeActionNormal {
    my($self, $event) = @_;
    # Check if New Menu exists
    if($self-&gt;{MENU}-&gt;GetMenuCount() == 2) {
        # New menu exists

        # Get Action menu
        my $actionmenu = $self-&gt;{MENU}-&gt;GetMenu(0);
        my $newmenu    = $self-&gt;{MENU}-&gt;GetMenu(1);

        # Check if we have to create or delete a menu item
        if($actionmenu-&gt;IsEnabled($id[2])) {
            # Create normal menu item
            $newmenu-&gt;Append($id[50], "Normal item");           

            # Disable and Enable options
            $actionmenu-&gt;Enable($id[2], 0);
            $actionmenu-&gt;Enable($id[3], 1);
        } else {
            # Delete menu item
               $newmenu-&gt;Delete($id[50]);

            # Enable and disable options
            $actionmenu-&gt;Enable($id[2], 1);
            $actionmenu-&gt;Enable($id[3], 0);
        }
    }

    return 1;
}

# Subroutine that handles check item creation/erasure
sub MakeActionCheck {
    my($self, $event) = @_;

    # Check if New Menu exists
    if($self-&gt;{MENU}-&gt;GetMenuCount() == 2) {
        # New menu exists

        # Get Action menu
        my $actionmenu = $self-&gt;{MENU}-&gt;GetMenu(0);
        my $newmenu    = $self-&gt;{MENU}-&gt;GetMenu(1);

        # Check if we have to create or delete a menu item
        if($actionmenu-&gt;IsEnabled($id[4])) {
            # Create check item
               $newmenu-&gt;AppendCheckItem($id[51], "Check item");

           # Disable and Enable options
           $actionmenu-&gt;Enable($id[4], 0);
           $actionmenu-&gt;Enable($id[5], 1);
        } else {
           # Delete menu item
           $newmenu-&gt;Delete($id[51]);

              # Enable and disable options
              $actionmenu-&gt;Enable($id[4], 1);
              $actionmenu-&gt;Enable($id[5], 0);
        }
    }

    return 1;
}

# Subroutine that handles radio item creation/erasure

sub MakeActionRadio {
    my($self, $event) = @_;

    # Check if New Menu exists
    if($self-&gt;{MENU}-&gt;GetMenuCount() == 2) {
        # New menu exists

        # Get Action menu
        my $actionmenu = $self-&gt;{MENU}-&gt;GetMenu(0);
        my $newmenu    = $self-&gt;{MENU}-&gt;GetMenu(1);

        # Check if we have to create or delete a menu item
        if ($actionmenu-&gt;IsEnabled($id[6])) {
               # Create radio item
              $newmenu-&gt;AppendRadioItem($id[52], "Radio item");

              # Disable and Enable options
              $actionmenu-&gt;Enable($id[6], 0);
              $actionmenu-&gt;Enable($id[7], 1);
        } else {
              # Delete menu item
              $newmenu-&gt;Delete($id[52]);

              # Enable and disable options
              $actionmenu-&gt;Enable($id[6], 1);
              $actionmenu-&gt;Enable($id[7], 0);
        }
    }

    return 1;
}</code></pre>

<p>The <code>MakeActionMenu</code> subroutine handles events for the <em>New Menu</em> and <em>Delete Menu</em> items. It first gets the <em>Actions</em> menu and checks whether the <em>New Menu</em> exists by retrieving the number of menus attached to the <code>$self-&gt;{MENU}</code> menu bar. If the new menu doesn't exist, the number of menus in the menu bar is equal to 1, and the subroutine then creates <em>New Menu</em>. If it exists, the subroutine deletes <em>New Menu</em>.</p>

<p>The <code>MakeActionNormal</code>, <code>MakeActionCheck</code>, and <code>MakeActionRadio</code> subroutines are almost identical. They differ only in the involved identifier numbers. These subroutines handle events for <em>New normal item</em>, <em>Delete normal item</em>, <em>New check item</em>, <em>Delete check item</em>, <em>New radio item</em>, and <em>Delete radio item</em>, respectively. They first check if <em>New Menu</em> exists (the number of menus attached to the menu bar is equal to 2). If so, they check if the options to create normal, check, or radio items are enabled, respectively. If the corresponding option is enabled, then the corresponding item doesn't exist on <em>New Menu</em>, and the subroutine creates it. If the option to create an item is disabled, then that item exists on <em>New Menu</em> and hence it must be deleted. If <em>New Menu</em> doesn't exist, the subroutines do nothing. Figure 3 shows how there are no options available if <em>New Menu</em> does not exist, and Figure 4 shows <em>New Menu</em> with two options added.</p>

<p><img src="/pub/2005/10/06/graphics/example1.jpg" width="289" height="268" alt="no available options without New Menu" /><br />
<em>Figure 3. No available options without New Menu</em>
</p>

<p><img src="/pub/2005/10/06/graphics/example2.jpg" width="289" height="268" alt="New Menu has menu options" /><br />
<em>Figure 4. New Menu has menu options</em>
</p>

<h3>Conclusion</h3>

<p>As this article has shown, menu programming with wxPerl is an extremely simple task. Wx::MenuBar and Wx::Menu's methods are very easy to use and remember. If you understood this article, you can do anything possible with menus in your wxPerl programs.</p>

<p>I have covered almost all of the available methods in Wx::Menu and Wx::MenuBar. I left out some methods related to pop-up menus, but I hope to cover these topics in future articles. WxPerl is a really great module, but its lack of adoption is due to its severe lack of documentation. This situation must be reversed, and this article is a small contribution to that cause.</p>

<h3>See Also</h3>

<ul>
<li><a href="http://www.wxwidgets.org/manuals/2.4.2/wx262.htm">WxMenu tutorial</a> and <a href="http://www.wxwidgets.org/manuals/2.4.2/wx263.htm">WxMenuBar tutorial</a> by Julian Smart, Robert Roebling, Vadim Zeitlin, Robin Dunn, et al.</li>

<li>"<a href="http://www.bzzt.net/~wxwidgets/icpp_wx2.html#menubar">Adding a Menu Bar</a>," by David Beech.</li>

<li>"<a href="/pub/a/2001/09/12/wxtutorial1.html">wxPerl: Another GUI for Perl</a>," by Jouke Visser.</li>
</ul>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/porting/">&laquo; Porting</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/regular-expressions/">Regular Expressions &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2010/07/">July 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.02" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
