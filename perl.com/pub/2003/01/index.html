<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: January 2003 Archives</title>


    <link rel="prev" href="/pub/2002/12/" title="December 2002" />
    <link rel="next" href="/pub/2003/02/" title="February 2003" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">January 2003 Archives</h1>





                            
                            <div id="entry-1052" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/01/30/review.html" rel="bookmark">Embedding Perl in HTML with Mason</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2003-01-30T00:00:00-08:00">January 30, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>
<i>Disclaimer</i>: As you know, each month I try to review a recently published Perl book,
and I aim to cover all the majors as they come out. The book that's
fallen onto my desk for review this month is Dave Rolsky and Ken
Williams' <a href="http://www.oreilly.com/catalog/perlhtmlmason">Embedding Perl in
HTML with Mason</a> "What is this," you're thinking, "an O'Reilly site
doing a review of an O'Reilly book? Scandalous!" Well, I hope that you've
taken a look at my other reviews and have satisfied yourself that I try to 
be as impartial as I can when reviewing. As far as I'm concerned, this
is a Perl site first and an O'Reilly site second.
</p>

<csperl file="grab" domain="on" record="b/795" template="article_sidebar.view">

<p>
With that disclaimer out of the way, onto the book! There are plenty of
ways of achieving the Perl-in-HTML goal, as this book correctly points
out: the <a href="http://www.template-toolkit.org/">Template
Toolkit</a>, the venerable <a href="http://perl.apache.org/embperl/">embperl</a>, and so on. My
personal favorite, however, is <a href="http://www.masonhq.com/"><code>HTML::Mason</code></a>, and so I've
been looking forward to this book for a long time. That also means,
however, that I've had high expectations of it; Rolsky and Williams'
effort has lived up to many of them but let me down in a few areas.</p>

<p> The first chapter does a good job of setting the scene - it
describes a little of what Mason looks like, talks about some of the
alternatives to Mason, and shows how to install the module and test it. 
While the first description is precisely what is needed, and the test
process is well-documented, I feel more could have been made of the
comparison to other techniques - tools such as PHP and Template Toolkit are
described, but they're not compared to Mason, so it's hard to see
their relative strengths and weaknesses. Similarly, the installation
process for Mason is quite detailed, and brushing it off with
"<code>perl Makefile.PL; make; make install</code>" doesn't do it
justice - an example of the output would make readers feel more
comfortable.</p>

<p>The book then goes on to introduce the main syntax of Mason
components. This is a useful section and I learned a lot about various
ways Mason tags are interpreted, but I felt it would have been
better structured with more examples building on top of one another; that
said, the chapter did declare itself to be an introduction to Mason
syntax and semantics, and as that, it succeeded - however, I think it
would have been a better tutorial if both semantics and syntax were
covered.</p>

<p>The short chapter on autohandlers and dhandlers was a sermon from the
clouds. I've long known that these things existed and were powerful, but
until reading chapter 3, I didn't quite know how they should be used.
The section on the Mason API again unfortunately suffers from a lack of
examples; but on the other hand, the book builds up to a full
example in chapter 8. The "advanced features" chapter was a complete
goldmine of information. Like many of these early chapters, it contains
a lot of concentrated goodness in not many pages, and it will take me
several more readings to pick out and understand more
of the ideas. 
</p>
<p>Chapter 6, another short (10 page) chapter on the "lexer
compiler, resolver and interpreter objects" seems to be included for
completeness or for hard-core Mason hackers - it could be skipped or
moved to an appendix with no loss of flow or coverage.
</p>
<p>
As I've mentioned, chapter 8 is where it all comes together: a full,
real-life application (the <a href="http://apprentice.perl.org/">Perl
Apprenticeship site</a> - an interesting resource in its own right!) is
put together before your very eyes. As this is a real live site, areas
such as creating user accounts and handling access control have to be
covered. If you're doing anything at all with Mason, then I'd urge you to buy
this book if only for this chapter - once you've worked through it,
you'll have a much clearer idea of how a Mason site fits together.
</p>
<p>
Later chapters cover mixing Mason and CGI, another brief (8 page)
chapter on design, and another gold mine chapter of recipes.
Chapters like this and the advanced topics chapter are the reason you
buy books on open source projects: sure, there may be free
documentation's there - and the Mason documentation is pretty thorough - but
it doesn't directly tell you how to do what you want to do. The
documentation doesn't
often cover the situations you find yourself in when you're actually
developing with the tool in question; I'm happy to say that this book
does.</p>
<p>
Appendices
cover the Mason API, (which is odd, given chapter 4 covers that ...) the
Mason-object model, using Mason with your favorite text editor (a
surprisingly useful set of information!) and information about
Bricolage, a Mason-based context management system; useful as yet
another set of ideas for what Mason can do.
</p>
<p>
On an aesthetic note, kudos to O'Reilly for restoring the spine
coloring - now my bookshelf can be color-coded again; now bring back
Garamond!
</p>

<p>
If I've sounded at all negative in this review, then it's probably because
I've been expecting this book for a while and have had high hopes for
it. That said, my overall impression of this book is that it's a little
thin - short chapters and few worked examples leave one wanting more. On
the other hand, the full example in chapter 8 is worth its weight
in gold, and when combined with the advanced concept and cookbook
chapters, I'd give this book a qualified thumbs-up for anyone doing any
Mason work. </p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1062" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/01/p6pdigest/20030126.html" rel="bookmark">This week on Perl 6, week ending 2003-01-26</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-01-26T00:00:00-08:00">January 26, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->


<p>Welcome to the first Perl 6 summary of the new 'Copious Free Time
enabled' era, which should mean that these summaries will get mailed
out on Monday evening from now on.</p>
<p>We start, as usual, with perl6-internals</p>

<h4><a name="the_eval_patch">The eval patch</a></h4>
<p>Leopold T&ouml;tsch continued to work on making <code>eval</code> and its
associated operators work and asked for some opinions about a problem
he was having with jumps between code segments. Jason Gloudon played
sounding board and the two of them found a way forward.</p>
<p><a href="http://groups.google.com/groups?threadm=3E2C816D.4070307%40toetsch.at">http://groups.google.com/groups</a></p>

<h4><a name="the_parrot_crashes">The Parrot crashes</a></h4>
<p>Dan announced that Parrot was crashing big time under (at least) OS X,
throwing segfaults in the NCI mark routine. Other people contributed
reports of what was happening on their platform and Leo T&ouml;tsch
tried to track down the error, working on the assumption that it was
something to do with his eval patch as that was the last patch that
had gone in.</p>
<p>Later in the week Dan realised that part of the problem with OS X was
a problem with <em>imclexer.c</em>, an autogenerated file being generated
with bad code. Leo reckoned it was a problem with something having
been multiply defined, which had since been fixed.</p>
<p>Still later in the week, Steve Fink offered some analysis on the NCI mark
routine and a patch which attempted to fix the problems he saw with
it. Leo reckoned that the patch wasn't quite right, but the analysis
was good and used that to fix the problem and discovered in the
process that the parrot build process's dependency analysis wasn't
quite up to the mark. (I don't think there's a fix for that yet, but
at least we know the problem exists...)</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f03ba51f9a576c1%40%5B192.168.2.1%5D">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=a05200f0aba532561a41c%40%5B192.168.2.1%5D">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20030123040732.GI4862%40foxglove.digital-integrity.com">http://groups.google.com/groups</a></p>

<h4><a name="compiling_to_parrot">Compiling to Parrot</a></h4>
<p>K Stol is looking for a final project for his Bachelor's degree and
would like to implement some language targeting Parrot and asked for
suggestions. Simon Wistow suggested PHP or Lua, Leon Brocard suggested
Java (though Gopal V wasn't sure that was such a good idea just
yet). Dan suggested that, just because someone else was already
working on a TCL compiler it didn't mean it wasn't worth trying
anyway, but apparently it would have been unlikely to get approval as
a Bachelor's project. There was some further discussion of Lua and
whether there would be any real point in implementing it and the
thread died down before Mr Stol told anyone what he'd decided to do,
which was rather a shame I thought.</p>
<p><a href="http://groups.google.com/groups?threadm=BAY1-DAV66VOMMxTk0r00015d9e%40hotmail.com">http://groups.google.com/groups</a></p>

<h4><a name="extending_the_packfile_format">Extending the packfile format</a></h4>
<p>Some months ago, J&uuml;rgen B&ouml;mmels offered a patch to extend
the Parrot packfile format whilst retaining backward
compatibility. This week, after a little modification, Leo
T&ouml;tsch applied it. James Mastros wondered if it didn't make
sense (at least before parrot 1.0) to ignore backward compatibility
issues and just make it right. Leo and Dan agreed, but Leo pointed out
that, at least until the switch from assemble.pl to IMCC was complete,
maintaining backward compatibility was the right thing. (So, if you're
currently using assemble.pl to assemble your language, consider moving
it to IMCC sooner rather than later).</p>
<p><a href="http://rt.perl.org/rt2/Ticket/Display.html?id=18056">http://rt.perl.org/rt2/Ticket/Display.html</a></p>

<h4><a name="the_long_running_objects_thread">The long running Objects thread</a></h4>
<p>Discussions continued.  A good deal of time this week was spent
discussing the overrideablility (there's got to be better word than
that...) of OO method dispatch for different languages (and at a
language level too I hope -- I like flexibility). Python for instance
seems to require that every step in the process be subject to
override. Dan pointed out that dispatch would end up being implemented
as vtable methods on per language Object PMCs so that messages from
one language's objects to another's would use the target language's
dispatch rules. Which seems rather cute (in a good way).</p>
<p><a href="http://groups.google.com/groups?threadm=20030122184654.GA1013%40Radii">http://groups.google.com/groups</a> -- Christopher Armstrong talks about Python</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f0aba55de36f844%40%5B192.168.2.1%5D">http://groups.google.com/groups</a> -- Dan on how it works.</p>

<h4><a name="intersegment_branching">Intersegment branching</a></h4>
<p>Leo T&ouml;tsch added a new opcode for intersegment branches, called
<code>branch_cs</code> which was his implementation of the fix that he and Jason
Gloudon had discussed while talking about problems with <code>eval</code>. Dan
didn't think Parrot needed this and that we could just use a plain
jump. Leo pointed out that there were several places where this didn't
quite work, especially in the presence of JIT optimization. Dan didn't
think that didn't mean it wouldn't work, but reckoned that the cases
Leo pointed out were reasons he wanted to see intersegment jumps
mediated by subroutine calls. Leo followed up to this with an
example. I can't for the life of me tell if this was a counter
example, a suggestion or what though.</p>
<p>This reemerged as a new thread with the subject 'Transferring control
between code segments'. Dan opened the thread by discussing the design
perspective and laying down a few edicts. He went on to discuss the
issues that Leo's 'phenomenally cool' <code>compile</code> opcode has exposed in
his earlier handwaving and replaced the handwaves with more detail.</p>
<p>People were generally happy to see this, but there were a few small
issues with it which weren't explicitly resolved this week.</p>
<p><a href="http://groups.google.com/groups?threadm=3E2EBE60.6070304%40toetsch.at">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=a05200f02ba5497181516%40%5B192.168.2.1%5D">http://groups.google.com/groups</a> -- Design issues</p>

<h4><a name="bytecode_metadata">Bytecode Metadata</a></h4>
<p>Dan responded to the earlier discussion of extending the packfile
format by opening a discussion of the type of metadata that might be
useful to have in either the on disk packfile or in memory
bytecode. He reminded everyone that parrot may have to ignore (or at
least mistrust) the metadata and opened the floor suggestions.</p>
<p>James Michael DuPont came up with a proposal involving RDF which Dan
thought might well be overkill (albeit interesting overkill) since he
had been thinking more about metadata that would be used by the engine
itself or provided to programs running on it.</p>
<p>Various other suggestions were made, and it's apparent that one
immutable design guideline is that any bytecode format for Parrot
must allow for executable code to be mmapped in.</p>
<p>Leo T&ouml;tsch has a patch implementing a simplified API for
generating packfiles and wondered if he should check it in.</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f01ba5492b60e51%40%5B192.168.2.1%5D">http://groups.google.com/groups</a> -- Opening remarks</p>
<p><a href="http://groups.google.com/groups?threadm=20030123062939.54929.qmail%40web41505.mail.yahoo.com">http://groups.google.com/groups</a> -- The RDF
bazooka</p>

<h4><a name="odd_jit_timings">Odd JIT timings</a></h4>
<p>Dan reported that <em>examples/assembly/mops_p.pasm</em> was running slower
with JIT optimization than without under OSX, which doesn't seem
right. Daniel Grunblatt pointed out that JIT cores that don't optimize
many opcodes will always be slower than a Computed Goto (CG) core and
there aren't many optimized opcodes for the PPC architecture. Bruce
Gray pointed Dan at an introduction to PPC assembler in case Dan
wanted to add to the score of optimizations. Anyone else is interested
could take a look too, kudos awaits the heroic implementer.</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f05ba569ca7a572%40%5B192.168.2.1%5D">http://groups.google.com/groups</a></p>
<p><a href="http://www-106.ibm.com/developerworks/linux/library/l-ppc/">http://www-106.ibm.com/developerworks/linux/library/l-ppc/</a></p>


<h3><a name="meanwhile,_in_perl6language">Meanwhile, in perl6-language</a></h3>
<p>There was a little more diversity of discussion this instead of
concentration on a single massive thread, though that thread did, of
course, continue on its path.</p>

<h4><a name="l2r/r2l_syntax">L2R/R2L syntax</a></h4>
<p>There was some discussion of implementing conditionals (<code>if</code>, <code>else</code>
etc) as functions rather than special keywords. Personally I'm not
sure that anything that monkeys with Perl's normal order of evaluation
can strictly be called a function, but what the hey.</p>
<p>Buddha Buck showed off a rather neat implementation of if, then and
else which borrowed some of its implementation from a Smalltalk
like 'Bool' class with <code>isTrue</code> and <code>isFalse</code> methods and then used
multiple dispatch to get the rest.</p>
<p>In another subthread, Michael Lazzaro explained why he still wanted
Right to Left pipelining, even though he was much more at ease with
Perl 6's rules for when you needed a comma in an argument list. It
appears to be mostly about teachability.</p>
<p>Damian popped up to make (at least) Graham Barr and me happy when he
said that he didn't think the Perl 5ish functional forms of <code>map</code> and
<code>grep</code> etc would be going away. Huzzah!</p>
<p><a href="http://groups.google.com/groups?threadm=3E2C3BBB.3070308%4014850.com">http://groups.google.com/groups</a> -- Buddha's Smalltalk port of
conditionals</p>
<p><a href="http://groups.google.com/groups?threadm=00A74788-2CD8-11D7-B567-00050245244A%40cognitivity.com">http://groups.google.com/groups</a> -- Michael
Lazzaro on grep, map and explicit pipelines</p>
<p><a href="http://groups.google.com/groups?threadm=3E3337E4.1070800%40conway.org">http://groups.google.com/groups</a> -- map/grep/etc still functions</p>

<h4><a name="a_proposal_on_if_and_else">A proposal on if and else</a></h4>
<p>Brent Dax proposed a solution to the problem of implementing <code>if</code> and
<code>else</code> as functions (the problem being that, unless you cuddle all
your <code>else</code>s, perl will intuit a semicolon at the end of <code>if</code>'s
block and things will get confused) by proposing that <em>all</em> code
blocks take an optional 'else', accessed by the <code>$code.else</code>
attribute, one of the side effects of which would be that <code>elsif</code>
would become <code>else if</code>.</p>
<p>Austin Hastings wondered if supporting 'separable verbs' might be a
better way forward. The idea certainly looks interesting, the best
summary of the idea I can give you is to point you at Austin's
original message though.</p>
<p><a href="http://groups.google.com/groups?threadm=004201c2c0b8%242bfab000%247b01a8c0%40deepblue">http://groups.google.com/groups</a> -- All blocks are elseable</p>
<p><a href="http://groups.google.com/groups?threadm=20030120222955.33503.qmail%40web12305.mail.yahoo.com">http://groups.google.com/groups</a> -- Separable verbs</p>

<h4><a name="arc:_an_unfinished_dialect_of_lisp">Arc: An Unfinished Dialect of Lisp</a></h4>
<p>Rich Morin pointed everyone at Paul Graham's presentation at the first
Little Languages conference about Arc, pointing out that Graham had
some interesting things to say about language design. The discussion
that followed was mostly off topic (in the sense that they weren't
talking at all about Perl 6). Graham's paper is interesting though.</p>
<p><a href="http://groups.google.com/groups?threadm=p05200f28ba536351462d%40%5B192.168.254.205%5D">http://groups.google.com/groups</a></p>
<p><a href="http://paulgraham.com/arcll1.html">http://paulgraham.com/arcll1.html</a></p>

<h4><a name="array/colon_question">Array/Colon question</a></h4>
<p>Michael Lazzaro wondered about the seemingly different meanings of
colon in:</p>
<pre>
    print $FH : $a;    # $FH is an indirect object
    @a = 0 .. 10 : 2;  # @a is (0,2,4,6,8,10)</pre>
<p>and wanted to know when <code>:</code> meant 'step' and when it designated an
indirect object. Brent Dax helped clear things up. Essentially <code>:</code> is
a 'supercomma' and different operators and functions interpret what
comes after the supercomma in different ways. <code>..</code> treats it as
specifying a step.</p>
<p><a href="http://groups.google.com/groups?threadm=66FE52DB-2EFE-11D7-BD12-00050245244A%40cognitivity.com">http://groups.google.com/groups</a></p>

<h4><a name="multiple_dispatch_by_context">Multiple Dispatch by Context?</a></h4>
<p>Piers Cawley wondered if it would be possible to specify a multimethod
by context as well as by parameter types. Dan Sugalski managed to hole
the proposal below the waterline with a neat set of multidispatch
declarations that led to a horrible ambiguity. Thomas A Boyer pointed
out that Ada can handle such ambiguities but that it was a complete
pain to implement and voted against using return type for multiple
dispatch.</p>
<p><a href="http://groups.google.com/groups?threadm=m27kcvqa1z.fsf%40TiBook.bofh.org.uk">http://groups.google.com/groups</a></p>


<h3><a name="who's_who_in_perl_6">Who's Who in Perl 6</a></h3>
<p>Ah... um... I appear to be lacking an answer set this week.</p>


<h3><a name="announcements,_acknowledgements_and_apologies">Announcements, Acknowledgements and Apologies</a></h3>
<p>I'm afraid to have to announce that, as of this week I can no longer
donate the fee for these summaries to the Perl Foundation it's
currently my only source of income. On the positive side, now that I
don't have to spend 8 hours a day working for someone else I should be
able to get the Summary mailed out to the Perl 6 lists on a Monday
from now on.</p>
<p>Thanks to everyone who sent me mail about my redundancy. No matter how
good it feels not to have to get up at 5.50 every morning with the
prospect of not getting home again 'til at least 18.40 it's still a
terrible shock to lose your job. Thankfully we look to be in a much
better position this year than we were last time I was out of work;
I'm hoping that, if I can get a few more freelance writing gigs and
maybe a little consultancy I'm not going to have to go back to the 4
hour commutes for the foreseeable future.</p>
<p>Thanks too to everyone who's given me answers for the Who's Who
section since this summary started. I'm sorry to be retiring it for
now, but as new blood filters into the Perl 6 community I hope I'll be
able to restart it some time further down the road.</p>
<p>If you appreciated this summary, please consider one or more of the
following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl</li>

<li>
Get involved in the Perl 6 process. The mailing lists are open to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>

<li>
Send feedback, flames, money, job offers or concrete proof either way
about Iraq's weaponry to <em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em></li>
</ul>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1050" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/01/22/mechanize.html" rel="bookmark">Screen-scraping with WWW::Mechanize</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Chris Ball</span> on <abbr class="published" title="2003-01-22T00:00:00-08:00">January 22, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
             
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->
<p>Screen-scraping is the process of emulating an interaction with a Web
site - not just downloading pages, but filling out forms, navigating
around the site, and dealing with the HTML received as a result.  As
well as for traditional lookups of information - like the example we'll
be exploring in this article - we can use screen-scraping to enhance a
Web service into doing something the designers hadn't given us the power
to do in the first place.  Here's an example:</p>

<p>I do my banking online, but get quickly bored with having to go to my
bank's site, log in, navigate around to my accounts and check the
balance on each of them.  One quick Perl module (<a href="http://search.cpan.org/author/CHRIS/Finance-Bank-HSBC-1.01/HSBC.pm"><code>Finance::Bank::HSBC</code></a>)
later, and now I can loop through each of my accounts and print their balances,
all from a shell prompt.  Some more code, and I can do something the
bank's site doesn't ordinarily let me - I can treat my accounts as a
whole instead of individual accounts, and find out how much money I
have, could possibly spend, and owe, all in total.  Another step forward
would be to schedule a <em>crontab</em> every day to use the HSBC option to
download a copy of my transactions in Quicken's QIF format, and use
Simon Cozens' <a href="http://search.cpan.org/author/SIMON/Finance-QIF-1.00/QIF.pm"><code>Finance::QIF</code></a> module to interpret the file and run those
transactions against a budget, letting me know whether I'm spending too
much lately.  This takes a simple Web-based system from being merely
useful to being automated and bespoke; if you can think of how to write
the code, then you can do it.  (It's probably wise for me to add the caveat,
though, that you should be extremely careful working with banking
information programatically, and even more careful if you're storing
your login details in a Perl script somewhere.)</p>

<csperl file="grab" domain="on" record="b/755" template="article_sidebar.view">

<p>Back to screen-scrapers, and introducing <a href="http://search.cpan.org/author/PETDANCE/WWW-Mechanize-0.33/lib/WWW/Mechanize.pm"><code>WWW::Mechanize</code></a>, written by
Andy Lester and based on Skud's 
<a href="http://search.cpan.org/author/SKUD/WWW-Automate-0.20/lib/WWW/Automate.pm"></a><code>WWW::Automate</code></a>.  Mechanize allows
you to go to a URL and explore the site, following links by name, taking
cookies, filling in forms and clicking &quot;submit&quot; buttons.  We're also
going to use <a href="http://search.cpan.org/author/GAAS/HTML-Parser-3.27/lib/HTML/TokeParser.pm"><code>HTML::TokeParser</code></a> to process the HTML we're given back,
which is a process I've written about
<a href="/pub/a/2001/11/15/creatingrss.html">previously</a>.</p>
<p>The site I've chosen to demonstrate on is the BBC's
<a href="http://www.radiotimes.beeb.com">Radio Times</a> site, which allows users
to create a &quot;Diary&quot; for their favorite TV programs, and will tell you
whenever any of the programs is showing on any channel.  Being a
<a href="http://london.pm.org/">London Perl M[ou]nger</a>, I have an obsession with
Buffy the Vampire Slayer.  If I tell this to the BBC's site, then it'll
tell me when the next episode is, and what the episode name is - so I
can check whether it's one I've seen before.  I'd have to remember to log
into their site every few days to check whether there was a new episode
coming along, though.  Perl to the rescue!  Our script will check to see
when the next episode is and let us know, along with the name of the
episode being shown.</p>
<p>Here's the code:</p>
<pre><code>
  #!/usr/bin/perl -w
  use strict;</code></pre>
<pre><code>
  use WWW::Mechanize;
  use HTML::TokeParser;</code></pre>
<p>If you're going to run the script yourself, then you should register with the
Radio Times site and create a diary, before giving the e-mail address
you used to do so below.</p>
<pre><code>
  my $email = &quot;;
  die &quot;Must provide an e-mail address&quot; unless $email ne &quot;;</code></pre>
<p>We create a WWW::Mechanize object, and tell it the address of the site
we'll be working from.  The Radio Times' front page has an image link
with an ALT text of &quot;My Diary&quot;, so we can use that to get to the right
section of the site:</p>
<pre><code>
  my $agent = WWW::Mechanize-&gt;new();
  $agent-&gt;get(&quot;http://www.radiotimes.beeb.com/&quot;);
  $agent-&gt;follow(&quot;My Diary&quot;);</code></pre>
<p>The returned page contains two forms - one to allow you to choose from a
list box of program types, and then a login form for the diary
function.  We tell WWW::Mechanize to use the second form for input.
(Something to remember here is that WWW::Mechanize's list of forms,
unlike an array in Perl, is indexed starting at 1 rather than 0.  Our
index is, therefore,'2.')</p>
<pre><code>
  $agent-&gt;form(2);</code></pre>
<p>Now we can fill in our e-mail address for the '&lt;INPUT name=&quot;email&quot;
type=&quot;text&quot;&gt;' field, and click the submit button.  Nothing too
complicated.</p>
<pre><code>
  $agent-&gt;field(&quot;email&quot;, $email);
  $agent-&gt;click();</code></pre>
<p>WWW::Mechanize moves us to our diary page.  This is the page we need
to process to find the date details from.  Upon looking at the HTML source
for this page, we can see that the HTML we need to work through is something
like:</p>
<pre><code>
  &lt;input&gt;
  &lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td class=&quot;bluetext&quot;&gt;Date of episode&lt;/td&gt;&lt;/tr&gt;
  &lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;
  &lt;td class=&quot;bluetext&quot;&gt;&lt;b&gt;Time of episode&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;a href=&quot;page_with_episode_info&quot;&gt;&lt;/a&gt;
</code></pre>
<p>
This can be modeled with <CODE>HTML::TokeParser</CODE> as below.  The important
methods to note are <code>get_tag</CODE> - which will move the stream on to the
next opening for the tag given - and <code>get_trimmed_text</code>, which returns
the text between the current and given tags.  For example, for the HTML
code &quot;&lt;b&gt;Bold text here&lt;/b&gt;&quot;, <code>my $tag =
get_trimmed_text(&quot;/b&quot;)</code> would
return <code>&quot;Bold text here&quot;</code> to <CODE>$tag</CODE>.</p>
<p>Also note that we're initializing HTML::TokeParser on
'\$agent-&gt;{content}' - this is an internal variable for WWW::Mechanize,
exposing the HTML content of the current page.</p>
<pre><code>
  my $stream = HTML::TokeParser-&gt;new(\$agent-&gt;{content});
  my $date;
  
  # &lt;input&gt;
  $stream-&gt;get_tag(&quot;input&quot;);</code></pre>
<pre><code>
  # &lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;
  $stream-&gt;get_tag(&quot;tr&quot;); $stream-&gt;get_tag(&quot;tr&quot;);</code></pre>
<pre><code>
  # &lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;
  $stream-&gt;get_tag(&quot;td&quot;); $stream-&gt;get_tag(&quot;td&quot;);</code></pre>
<pre><code>
  # &lt;td class=&quot;bluetext&quot;&gt;Date of episode&lt;/td&gt;&lt;/tr&gt;
  my $tag = $stream-&gt;get_tag(&quot;td&quot;);
  if ($tag-&gt;[1]{class} and $tag-&gt;[1]{class} eq &quot;bluetext&quot;) {
      $date = $stream-&gt;get_trimmed_text(&quot;/td&quot;);
      # The date contains '&amp;nbsp;', which we'll translate to a space.
      $date =~ s/\xa0/ /g;
  }
 
  # &lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;
  $stream-&gt;get_tag(&quot;td&quot;);</code></pre>
<pre><code>
  # &lt;td class=&quot;bluetext&quot;&gt;&lt;b&gt;Time of episode&lt;/b&gt;  
  $tag = $stream-&gt;get_tag(&quot;td&quot;);</code></pre>
<pre><code>
  if ($tag-&gt;[1]{class} eq &quot;bluetext&quot;) {
      $stream-&gt;get_tag(&quot;b&quot;);
      # This concatenates the time of the showing to the date.
      $date .= &quot;, from &quot; . $stream-&gt;get_trimmed_text(&quot;/b&quot;);
  }</code></pre>
<pre><code>
  # &lt;/td&gt;&lt;/tr&gt;&lt;a href=&quot;page_with_episode_info&quot;&gt;&lt;/a&gt;
  $tag = $stream-&gt;get_tag(&quot;a&quot;);</code></pre>
<pre><code>
  # Match the URL to find the page giving episode information.
  $tag-&gt;[1]{href} =~ m!src=(<a href="http://">http://</a>.*?)'!;</code></pre>
<p>We have a scalar, $date, containing a string that looks something like
&quot;Thursday 23 January, from 6:45pm to 7:30pm.&quot;, and we have an URL, in
$1, that will tell us more about that episode.  We tell WWW::Mechanize
to go to the URL:</p>
<pre><code>
  $agent-&gt;get($1);</code></pre>
<p>The navigation we want to perform on this page is far less complex than
on the last page, so we can avoid using a TokeParser for it - a regular
expression should suffice.  The HTML we want to parse looks something
like this:</p>
<pre><code>
  &lt;br&gt;&lt;b&gt;Episode&lt;/b&gt;&lt;br&gt;  The Episode Title&lt;br&gt;</code></pre>
<p>We use a regex delimited with '!' in order to avoid having to escape the
slashes present in the HTML, and store any number of alphanumeric
characters after some whitespace, all between &lt;br&gt; tags after the
Episode header:</p>
<pre><code>
  $agent-&gt;{content} =~ m!&lt;br&gt;&lt;b&gt;Episode&lt;/b&gt;&lt;br&gt;\s+?(\w+?)&lt;br&gt;!;</code></pre>
<p>$1 now contains our episode, and all that's left to do is print out what
we've found:</p>
<pre><code>
  my $episode = $1;
  print &quot;The next Buffy episode ($episode) is on $date.\n&quot;;</code></pre>
<p>And we're all set.  We can run our script from the shell:</p>
<pre><code>
  $ perl radiotimes.pl
  The next Buffy episode (Gone) is Thursday Jan. 23, from 6:45 to 7:30 p.m.</code></pre>
<p>I hope this gives a light-hearted introduction to the usefulness of the
modules involved.  As a note for your own experiments, WWW::Mechanize
supports cookies - in that the requestor is a normal LWP::UserAgent
object - but they aren't enabled by default.  If you need to support
cookies, then your script should call &quot;<code>use HTTP::Cookies;</code>
<code>$agent-&gt;cookie_jar(HTTP::Cookies-&gt;new)</code>;&quot; on your agent object in order
to enable session-volatile cookies for your own code.</p>
<p>Happy screen-scraping, and may you never miss a Buffy episode again.</p>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1058" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/01/p6pdigest/20020319.html" rel="bookmark">This week on Perl 6, week ending 2003-01-19</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-01-19T00:00:00-08:00">January 19, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>Summary time again, damn but those tuits are hard to round up. Guess,
what? perl6-internals comes first. 141 messages this week versus the
language list's 143.</p>


<h4><a name="objects_(again)">Objects (again)</a></h4>
<p>Objects were still very much on everyone's mind as the discussions of
Dan's initial thoughts about objects in Parrot continued. Jonathan
Sillito put up a list of questions about Dan's original message which
Dan answered promptly. Down the thread a little Dan mentioned that he
hoped Parrot's objects would serve, reasonably unmodified for a bunch
of languages (ie, he hoped that there wouldn't be a requirement for
PythonRef/Attr/Class/Object etc), Chris Armstrong thought that, given
what Dan had outlined so far, that wouldn't be straightforward. Dan
thanked him for throwing a spanner in the works, asking for more
details which Chris provided.</p>
<p>Meanwhile Jonathan had some supplementary questions... Hmm... doing
this blow by blow will take forever. Suffice to say that details are
being thrashed out. At one point Dan's head started to spin as
terminology mismatches started to bite, leading Nicholas Clark to
suggest an entirely new set of terms involving houses and hotels (but
with some serious underpinnings).</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f00ba44a84de6d8%40%5B63.120.19.221%5D">http://groups.google.com/groups</a> -- thread root, from last week.</p>
<p><a href="http://groups.google.com/groups?threadm=OFEPJACOCOPCBJCNJKDLGEGGCAAA.sillito%40cs.ubc.ca">http://groups.google.com/groups</a> -- Jonathan's questions</p>
<p><a href="http://groups.google.com/groups?threadm=20030115023751.GE31014%40Radii">http://groups.google.com/groups</a> -- Chris Armstrong throws a spanner</p>
<p><a href="http://groups.google.com/groups?threadm=20030115204030.GA276%40Bagpuss.unfortu.net">http://groups.google.com/groups</a> -- Nicholas Clark tries
for a monopoly on silliness</p>


<h4><a name="optimizing_and_per_file_flags">Optimizing and per file flags</a></h4>
<p>Nicholas Clark wrote about requiring the ability to adjust compiler
optimization flags on a per file basis (brought up by Dan on IRC
apparently) and proposed a scheme. Quote of the thread (and quite
possibly the year so far): &quot;When unpack is going into an infinite loop
on a Cray 6000 miles away that you don't have any access to, there
isn't much more you can do.&quot; Thanks for that one Nick.</p>
<p><a href="http://groups.google.com/groups?threadm=20030112154536.GI288%40Bagpuss.unfortu.net">http://groups.google.com/groups</a></p>


<h4><a name="the_draft_todo/worklist">The draft todo/worklist</a></h4>
<p>Dan posted his current todo/worklist, which he described as
&quot;reasonably high level, and a bit terse&quot;. I particularly liked the
last entry &quot;Working Perl 5 parser&quot;. Surprisingly, there was very
little discussion, maybe everyone liked it.</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f04ba47d7050beb%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>


<h4><a name="parrot_examples">Parrot Examples</a></h4>
<p>Joe Yates asked if we could add a <em>helloworld.pasm</em> to
<em>parrot/examples/assembly</em>. Joseph Guhlin wondered what was so
special about</p>
<pre>
    print &quot;Hello, world\n&quot;
    end</pre>
<p>that it would need a file of its own (though he did forget the <code>end</code>
in his post, and segfaults are not really what you want in sample code).</p>
<p><a href="http://groups.google.com/groups?threadm=5.1.1.6.0.20030112103417.0251d2e0%40mbox.spacespa.it">http://groups.google.com/groups</a></p>


<h4><a name="thoughts_on_infant_mortality_(continued)">Thoughts on infant mortality (continued)</a></h4>
<p>Jason Gloudon posted a wonderfully clear exposition of the problems
facing anyone trying to implement a portable, incremental garbage
collector for Parrot which sparked a small amount of discussion and
muttering from Dan about the temptation to program down to the metal.</p>
<p><a href="http://groups.google.com/groups?threadm=20030113162121.GA978%40gloudon.com">http://groups.google.com/groups</a></p>


<h4><a name="operators_neg_and_abs_in_core.ops">Operators neg and abs in core.ops</a></h4>
<p>Bernhard Schmalhofer posted an enormous patch adding <code>neg</code> and <code>abs</code>
operators to core.ops. There were a few issues with the patch so it
hasn't gone in yet and an issue with what underlying C functions are
available reared its head too.</p>
<p><a href="http://groups.google.com/groups?threadm=rt-20298-48537.11.3214103549667%40bugs6.perl.org">http://groups.google.com/groups</a></p>


<h4><a name="the_eval_patch">The <code>eval</code> patch</a></h4>
<p>Leo T&ouml;tsch seems to have spent most of the week working on
getting <code>eval</code> working and he opened a ticket on rt.perl.org to track
what's happening with it. The response to this can be summarized as
'Wow! Fabulous!'.</p>
<p>Once more, for Googlism, Leopold Toetsch is my hero.</p>
<p><a href="http://rt.perl.org/rt2/Ticket/Display.html?id=20315">http://rt.perl.org/rt2/Ticket/Display.html</a></p>


<h4><a name="pretty_pictures">Pretty Pictures</a></h4>
<p>Mitchell N Charity posted some pretty pictures that he'd generated
with doxygen and graphviz. Most of the responses to this suggested he
use different tools. Ah well.</p>
<p><a href="http://groups.google.com/groups?threadm=200301160129.h0G1TYu26543%40vendian.org">http://groups.google.com/groups</a></p>


<h4><a name="solaris_tinderbox_failures">Solaris tinderbox failures</a></h4>
<p>Andy Dougherty created an RT ticket for the Solaris tinderbox, which
have been failing with the delightfully useful 'PANIC: Unknown
signature type&quot; and wondered if things could be fixed up to be a
little more informative. Apparently it was as issue with Leo's
recently checked in eval patch. So Leo fixed it.</p>
<p><a href="http://rt.perl.org/rt2/Ticket/Display.html?id=20374">http://rt.perl.org/rt2/Ticket/Display.html</a></p>


<h4><a name="parrot_compilers">Parrot compilers</a></h4>
<p>Cory Spencer wondered about how the current compilers that target
parrot work, noting that they seem to be duplicating a good deal of
labour, and wondered if anyone had worked on a gcc like framework with
a standardized Abstract Syntax Tree (AST). Everyone pointed him at
IMCC. Gopal V also pointed out that, given the variety of
implementation languages (C, Perl, Parrot...) sharing effort between
the sample languages would be a little tricky, and mentioned his work
on TreeCC (an AST manager).</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0301171900500.8414-100000%40okcomputer.antiflux.org">http://groups.google.com/groups</a></p>


<h4><a name="ook.pasm_eval"><em>ook.pasm</em> eval</a></h4>
<p>Leon Brocard had problems getting the eval based Ook implementation
working. It turned out to be a problem with Ook's <code>make test</code> using
parrot instead of IMCC.</p>
<p><a href="http://rt.perl.org/rt2/Ticket/Display.html?id=20400">http://rt.perl.org/rt2/Ticket/Display.html</a></p>



<h3><a name="meanwhile,_in_perl6language">Meanwhile, in perl6-language</a></h3>
<p>The language list was a little fractious this week; I get the feeling
that we're spinning our wheels slightly at the moment</p>


<h4><a name="array_questions">Array questions</a></h4>
<p>Piers Cawley thought that <code>my $b is $a</code> would be a compile
error, but Michael Lazzaro pointed out that that would mean that 
<code>my %data is FileBasedHash($path)</code> would also be a error. Damian
pointed out that they shouldn't be compile time errors, but there
would be no compile time type checking.</p>
<p><a href="http://groups.google.com/groups?threadm=m2k7h881wv.fsf%40TiBook.bofh.org.uk">http://groups.google.com/groups</a></p>


<h4><a name="l2r/r2l_syntax._again.">L2R/R2L syntax. Again.</a></h4>
<p>Okay, cards on the table here, I'm getting really, really fed up with
this thread. This week it was the monster that ate perl6-language. And
how.</p>
<p>We revisited the Unicode argument (Larry has said that Perl 6
<em>will</em> have Unicode operators, some people don't like it, others
(including me) aren't keen. Nobody came up with any original arguments
this week).</p>
<p>Sarcasm was employed (and missed).</p>
<p>Michael Lazzaro brought up Perl 5's special case syntax for functions
prototyped with block arguments which sparked some slightly heated
discussion. Damian had some words of wisdom on this subject.</p>
<p><a href="http://groups.google.com/groups?threadm=CAFE3022-2A4D-11D7-B2B5-00050245244A%40cognitivity.com">http://groups.google.com/groups</a> -- Michael
Lazzaro on block syntax</p>
<p><a href="http://groups.google.com/groups?threadm=3E28B608.3070700%40conway.org">http://groups.google.com/groups</a> -- Damian talks sense</p>
<p>Later in the thread, Damian clarified his explanation of how the
proposed <code>~&gt;</code> and <code>&lt;~</code> operators would work in response to
Buddha Buck's excellent summary of his understanding of them. If
you're taking part in this monster thread I strongly suggest rereading
both of these messages, they're excellent. The subthread from Damian's
clarifications led on to a discussion of multimethods that's worth
looking at too.</p>
<p><a href="http://groups.google.com/groups?threadm=3E2853E1.2070102%4014850.com">http://groups.google.com/groups</a> -- Buddha Buck's summary</p>
<p><a href="http://groups.google.com/groups?threadm=3E288384.6000403%40conway.org">http://groups.google.com/groups</a> -- Damian's clarifications</p>


<h4><a name="larry's_state_of_health_and_employment">Larry's state of health and employment</a></h4>
<p>Damian mentioned that &quot;We should bear in mind that Larry has had some
health issues.  And that he's currently unemployed with four children
to support.  Other matters are taking precedence at the moment.&quot; Get
well soon Larry.</p>
<p>This led to a discussion of whether the Perl Foundation would be continuing its
grant to Larry in 2003 (apparently not). (The <em><a href="mailto:advocacy@perl.org">advocacy@perl.org</a></em>
list is supposedly the right place to discuss this further but I'm not
yet a member.)</p>
<p><a href="http://groups.google.com/groups?threadm=71BEC0D4E1DED3118F7A009027B12028034C8B79%40EXCH_MISSION">http://groups.google.com/groups</a></p>



<h3><a name="who's_who_in_perl_6">Who's Who in Perl 6?</a></h3>
<dl>
<dt><strong><a name="item_who_are_you%3f">Who are you?</a></strong><br />
</dt>
<dd>
Melvin Smith. I work for IBM. Former Linux hacker.
My education is Computer Science. I am happily married.
</dd>


<dt><strong><a name="item_what_do_you_do_for%2fwith_perl_6">What do you do for/with Perl 6</a></strong><br />
</dt>
<dd>
Wrote various pieces of Parrot, including continuations (woo woo!),
IMCC, and Cola as well as heckle Dan on IRC any chance I get.  Sadly,
my contributions are fragmented and sparse, until I no longer have to
work for a living.
</dd>


<dt><strong><a name="item_where_are_you_coming_from%3f">Where are you coming from?</a></strong><br />
</dt>
<dd>
Country boy from Georgia. I have a 4x4 truck and a dog. Perl is my
favorite language because it has made possible many days of finishing
work early to play golf, and I love WOW-ing Java programmers.
</dd>


<dt><strong><a name="item_when_do_you_think_perl_6_will_be_released%3f">When do you think Perl 6 will be released?</a></strong><br />
</dt>
<dd>
In digestable form, December, 2003. However, if the Raelians can
clone Leopold T&ouml;tsch by July, then August might be possible.
</dd>


<dt><strong><a name="item_why_are_you_doing_this%3f">Why are you doing this?</a></strong><br />
</dt>
<dd>
Solely to learn new things. There is no better way to learn how to
write a compiler than to write one badly. If Perl6 never arrives,
I'll be satisfied by what I accomplished.
</dd>


<dt><strong><a name="item_you_have_5_words%2e_describe_yourself">You have 5 words. Describe yourself</a></strong><br />
</dt>
<dd>
Intense, stubborn, dedicated, happy and kind.
</dd>


<dt><strong><a name="item_do_you_have_anything_to_declare%3f">Do you have anything to declare?</a></strong><br />
</dt>
<dd>
Yes. Treat people on the Net just like your friends and coworkers.
They just might be, one day.
</dd>

</dl>



<h3><a name="acknowledgements">Acknowledgements</a></h3>
<p>Well, this set of acknowledgements may look slightly different than
usual. This morning we had one of <em>those</em> meetings... If you've ever
worked for a dot com you know the type;  the whole company got called
into a conference room that was two small at about two minutes notice
and the boss spent 10 minutes umming and ahhing through a speech about
retrenchment and cost cutting and... um... downsizing.</p>
<p>So, it looks like I'm about to become a member of the Copious Free
Time club. I would take this opportunity to beg for a job, but if you
do have jobs to offer Perl programmers Larry and Dan may be more
useful to you.</p>
<p>Returning to your normally scheduled acknowledgements, many thanks to
Melvin Smith for his answers to the Who's Who questionnaire. The
answer queue is empty again so unless someone else sends some answers
Who's Who will be on hiatus for a while. Send your answers to
<em><a href="mailto:5Ws@bofh.org.uk">5Ws@bofh.org.uk</a></em></p>
<p>If you appreciated this summary please consider one or more of the
following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.</li>


<li>
Get involved in the Perl 6 process. The mailing lists are open to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>


<li>
Send feedback, flames, money and or the complete Tarbell Course in
Magic to <em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em>.</li>

</ul>
<p>The fee paid for the publication of these summaries on perl.com is
paid directly to the Perl Foundation (but given my current
situation I may be reconsidering that.)</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1048" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/01/16/whatsnew.html" rel="bookmark">What's new in Perl 5.8.0</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Artur Bergman</span> on <abbr class="published" title="2003-01-16T00:00:00-08:00">January 16, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p> It's been nearly six months since the release of Perl 5.8.0, but
many people still haven't upgraded to it. We'll take a look at some of
the new features it provides and describe why you should investigate
them yourself.
</p>
<h2><a name="unicode">Unicode</a></h2>

    <p>Perl 5.8 - at last! - properly supports Unicode. Handling
    Unicode data in Perl should now be much more reliable than in
    5.6.0 and 5.6.1. In fact, quoting the most excellent
    <a href="http://www.perldoc.com/perl5.8.0/pod/perluniintro.html">perluniintro.pod</a>, which is suggested reading, '5.8 is the first
    recommended release for serious Unicode work.'</p>


    <p>The <a href="http://www.unicode.org/ucd/">Unicode Character
    Database</a>, which ships with Perl, has been upgraded to Unicode
    3.2.0, 5.6.1 had 3.0.1. Most UCD files are included with some
    omissions for space considerations.</p>

    <p>Perl's Unicode model is straightforward: Strings can be
    eight-bit native bytes or strings of Unicode characters. The
    principle is that Perl tries to keep its data as eight-bit bytes
    for as long as possible. When Unicodeness cannot be avoided, the
    data is transparently upgraded to Unicode. Native eight-bit bytes
    are whatever the platform users (for example Latin-1), Unicode is
    typically stored as UTF-8.</p> 

    <p>Perl will do the right thing with regard to mixing Unicode and
    non-Unicode strings; all functions and operators will respect the
    UTF-8 flag. For example, it is now possible to use Unicode strings
    in hashes, and correctly use them in regular expressions and
    transliterations. This has fully changed from 5.6 where you
    controlled Unicode support with a lexically scoped <a href="http://www.perldoc.com/perl5.6.1/lib/utf8.html"><code>utf8</code></a>
    pragma.</p>

<p> To fully use Unicode in Perl, we must now compile Perl with
<code>perlio</code> -- the new IO system written by Nick Ing-Simmons
that we will cover later -- together with the new <a href="http://search.cpan.org/author/DANKOGAI/Encode-1.84/Encode.pm">Encode
module</a> written by Dan Kogai. Together, these allow individual
filehandles to be set to bytes, Unicode or legacy encodings. Encode
also comes with <code>piconv</code>, which is a Perl implementation of
iconv and <code>enc2xs</code>, which allows you to create your own
encodings to Encode, either from Unicode Character Mapping files or
from Tcl Encoding Files. From Sadahiro Tomoyuki comes <a href="http://search.cpan.org/author/SADAHIRO/Unicode-Normalize-0.17/"><code>Unicode::Normalize</code></a>
and <a href="http://search.cpan.org/author/SADAHIRO/Unicode-Collate-0.23/"><code>Unicode::Collate</code></a>,
surprisingly used for normalization and collating.</p>

<h2>Perl Threads</h2> 

<p>Just like 5.8 is the first recommended release for Unicode work, it
is also the first recommended release for threading work. Starting
with 5.6, Perl had two modes of threading: one style called
<code>5005threading</code>, mainly because it was introduced with
5.005, and ithreads, which is short for interpreter threads. Gurusamy
Sarathy introduced ithreads as a step forward from multiplicity to
support the psuedofork implementation on Win32. However, in 5.6, there
was no way to control these threads from Perl; this has now
changed with the introduction of two new modules in 5.8.</p> 

<p>The basic rule for this thread model is that all data is cloned
when a new thread is created, so no data is shared between threads. If
one wants to share data, then there is a <a href="http://www.perldoc.com/perl5.8.0/lib/threads/shared.html"><code>threads::shared</code>
module</a> and the new <code>: shared</code>; variable
attribute. Controlling the new threads is done by using the <a href="http://www.perldoc.com/perl5.8.0/lib/threads.html"><code>threads</code></a>
module. More reading can be found in the respective modules and
<a href="http://www.perldoc.com/perl5.8.0/pod/perlthrtut.html">the Perl Thread Tutorial page</a></p>.

<h2>New IO</h2> 

<p>Perl can now rely on its own bugs instead of the bugs of your
underlying IO implementation! In Perl 5.8, we are now using the PerlIO library,
which replaces both stdio and sfio. The new IO system allows filters
to be pushed/popped from a filehandle for doing all kinds of nifty
things. For example, the Encode module, as mentioned earlier in
the Unicode discussion, uses PerlIO to do the magic character set
conversions at the IO level.</p> 

<p>Interested parties that want to create their own layers should look
at <a href="http://www.perldoc.com/perl5.8.0/pod/perlapio.html">the
library API</a>, <a href="http://www.perldoc.com/perl5.8.0/pod/perliol.html">the IO layer
API</a>, <a href="http://www.perldoc.com/perl5.8.0/lib/PerlIO.html">the PerlIO
module</a>, and <a href="http://www.perldoc.com/perl5.8.0/lib/PerlIO/via.html">the
PerlIO::via manpage</a>.</p>

<h2>Safe
Signals</h2> 

<p>No more random segfaults caused by signals! We now have a signal
handler that just raises a flag and then dispatches the signal between
opcodes so you are free to do anything you feel like in a signal
handler (Since it isn't run at async time, it isn't really a signal
handler). This has potential for conflicts if you are embedding Perl
and relying on signals to do some particular behavior, but I suppose if
you really like having the chance of a random segfault on receiving a
signal, then you can always compile perl with PERL_OLD_SIGNALS. This will, however,
not be threadsafe.</p>

<p>New and Improved Modules</p> 

<p>Perl 5.8 comes with 54 new modules,
many of them are included of CPAN for various reasons. One goal has
been to make it easy for <a href="http://www.perldoc.com/perl5.8.0/lib/CPAN.html">CPAN.pm</a> to be selfhosting; this has meant including
libnet and a couple of other modules.</p>

<p>
 We have been working on testing
a lot so the <a href="http://www.perldoc.com/perl5.8.0/lib/Test/More.html"><code>Test::More</code></a> family of modules were natural to include.
Then there was a push to make Perl more i18n friendly, so 5.8.0 includes
several i18n and l10n modules as well as the previously covered
Unicode modules. There many modules that provide access to
internal functions like the PerlIO modules, threads module and sort,
the new module that provides a interface to the sort implementation
you are using. Finally, we also thought it was time to include <a href="http://www.perldoc.com/perl5.8.0/lib/Storable.html"><code>Storable</code></a>
in the core.</p> 

<p>We also have a bunch of updated modules included: <a href="http://www.perldoc.com/perl5.8.0/lib/Cwd.html"><code>Cwd</code></a>
is now implemented in XS, giving us a nice speed boost. <a href="http://www.perldoc.com/perl5.8.0/lib/B/Deparse.html"><code>B::Deparse</code></a>
has been improved to the point that it is actually useful. Maintenance work
on <a href="http://www.perldoc.com/perl5.8.0/lib/ExtUtils/MakeMaker.html"><code>
ExtUtils::MakeMaker</code></a> has made it more stable. Storable
supports Unicode hash keys and restricted hashes. <a href="http://www.perldoc.com/perl5.8.0/lib/Math/BigInt.html"><code>Math::BigInt</code></a>
and <a href="http://www.perldoc.com/perl5.8.0/lib/Math/BigFloat.html"><code>Math::BigFloat</code>
manpage</a> have been upgraded and bugfixed quite a lot, and they have
been complemented by a <a href="http://www.perldoc.com/perl5.8.0/lib//Math/BigRat.html"><code>Math::BigRat</code></a> module,
and the <a href="http://www.perldoc.com/perl5.8.0/lib/bigrat.html"><code>bigrat</code></a>, 
<a href="http://www.perldoc.com/perl5.8.0/lib/bigint.html"><code>bigint</code></a> and
<a href="http://www.perldoc.com/perl5.8.0/lib/bignum.html"><code>bignum</code></a> pragmata 
for lexical control of transparent bignumber support.</p>

<h2>Speed Improvements</h2> 

<p>Even if this release includes a lot of new features, there are some
optimizations in there as well! We have changed sort to use mergesort,
which for me is rather surprising since I have been told since I was a
toddler to use quicksort. However, the old behavior can be controlled
using the <a href="http://www.perldoc.com/perl5.8.0/lib/sort.html"><code>sort</code></a>
module; we even have a mystery stable quicksort!</p>

<p>Once again, we have changed the hashing algorithm to
something called One-At-A-Time, so all of you who depend on the order
of hashes, this is a good reason to fix your programs now!</p>

 <p>Finally, <code>map</code> has been made faster, as has
 <code>unshift</code>.</p>

<h2>Testing</h2>

 <p>We
hope this should be the most stable release of Perl to date, as an
extensive QA effort has been spearheaded by Michael Schwern that has
led to several benefits. We now have six times the amount of test cases,
testing a cleaner codebase with more documentation. The Perl Bug
database has been switched to <a href="http://www.bestpractical.com/">Request Tracker</a>; we should thank
Richard Foley for his work on perlbugtron, which has now been retired.
After several discussions on what a memory leak is, several memory
leaks and naughty accesses have been fixed. Tools used have been third
degree, purify, and the most excellent open-source alternative,
<a href="http://developer.kde.org/~sewardj/">valgrind</a>.</p>

<h2>More Numbers</h2> 

<p>Nicholas Clark, Hugo van der Sanden and Tels have done
some magic keeping integers as integers as long as possible, and when
finding bugs in vendors number-to-string and string-to-number they
have coded around these to increased precision. We should all be happy
that 42 is now 42 and not 42.000000000000001 - imagine what the aliens
would do if they found out!</p> 

<h2>Documentation</h2>

<p>I have
mentioned several documentations pages earlier, they are part of the
13 new POD files included in Perl; in addition to this, all README.os
files have been translated into pod. Interestingly, there are several
new tutorials, including <a href="http://www.perldoc.com/perl5.8.0/pod/perlretut.html">a regular expressions tutorial</a>, <a href="http://www.perldoc.com/perl5.8.0/pod/perlpacktut.html">a tutorial on pack and unpack</a>,
<a href="http://www.perldoc.com/perl5.8.0/pod/perldebtut.html">a debugging tutorial</a>, <a href="http://www.perldoc.com/perl5.8.0/pod/perlnewmod.html">a module creation tutorial</a>, and <a href="http://www.perldoc.com/perl5.8.0/pod/perlintro.html">'a gentle introduction to
perl'</a>. There is also a new 
<a href="http://www.perldoc.com/perl5.8.0/pod/perlpodspec.html">POD format specification</a>
written by Sean M. Burke.</p>

<h2>Deprecations</h2> 

<p>Several deprecations have occurred in this release of Perl. In
future versions of Perl, 5005threads will be gone and replaced by
ithreads. Pseudo-hashes will be killed but the <a href="http://www.perldoc.com/perl5.8.0/lib/fields.html">fields</a> pragma
will work using restricted hashes; suidperl, which, despite everything,
isn't safe and the bare <code>package;</code> directive, which had unclear semantics.</p> 

<p>A few things have been removed and forbidden: blessing a refence into
another ref is one; self-tying of arrays and hashes led to some weird
bugs and have been disabled, as they touched some rarely tested
codepaths. The <code>[[.c.]]</code> and <code>[[=c=]]</code> character classes are also
forbidden because they might be used for future extensions. Several
scripts that were outdated have been removed and the upper case
comparison operators have also got the ax.</p> 

<h2>The War of the Platforms</h2> 

<p>Perl 5.8 works on several new platforms and the EBDIC
platforms were regained. However, sadly we lost Amiga; so any volunteers that
want to make the Amiga port work again are very welcome.</p> 

<h2>Odd and Ends</h2> <p>
There is a long list of new small changes in Perl 5.8,
the biggest of these small changes are restricted hashes, which can be
used from the new <a href="http://www.perldoc.com/perl5.8.0/lib/Hash/Util.html"><code>Hash::Util</code></a>
module and allows you to lock down the keys in a specific hash; this will
possibly be used as a replacement for pseudohashes for the
<em>fields</em> pragma.</p>
<p> For the full and gory details, check out the whole <a href="http://www.perldoc.com/perl5.8.0/pod/perldelta.html">Perl delta documentation</a>.</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1056" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/01/p6pdigest/20020312.html" rel="bookmark">This week on Perl 6, week ending 2003-01-12</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-01-12T00:00:00-08:00">January 12, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>... And we're back. Yup, it's summary time again. We'll dive straight
in with perl6-internals (as if you expected anything else).</p>


<h4><a name="more_thoughts_on_dod">More Thoughts on DOD</a></h4>
<p>Leopold T&ouml;tsch posted a test program showing the effects of PMC
size and timing of garbage collection and allocation and suggested
ways of improving the GC system based on the conclusions he drew from
its results. Leo, Dan and Mitchell N Charity discussed this further
and tried a few different approaches to try and improve performance
(though Mitchell did worry about premature optimization). Work in this
area is ongoing.</p>
<p><a href="http://groups.google.com/groups?threadm=3E1976F7.1060106%40toetsch.at">http://groups.google.com/groups</a></p>


<h4><a name="the_perl_6_parser">The Perl 6 Parser</a></h4>
<p>Dan asked about the current state of the Perl 6 parser, wanting to
know what was and wasn't implemented, and wondered about adding the
Perl 6 tests into the standard Parrot test suite. Sean O'Rourke and
Joseph F. Ryan both gave a summaries of where things stood. Joseph
also suggested a few refactorings of the parser to deal with the
fluidity of the current spec (almost all the operators have changed
symbols since the parser was first written for instance).</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f15ba425a3d908d%40%5B192.168.2.1%5D">http://groups.google.com/groups</a></p>


<h4><a name="lxr__source_code_indexing">LXR - Source code indexing</a></h4>
<p>Last week, I said that Robert Spier had 'started work on getting a
browseable, cross-referenced version of the Parrot source up on
perl.org.' What actually happened was that Robert asked Zach Lipton to
do the work. This week, Zach delivered the goods, which, I must say,
look fabulous.</p>
<p>I'm sure that if someone were to extend LXR so it had a better
understanding of .pasm, .pmc, .ops and other special Parrot source
types, then the community would be very grateful indeed. I know I would.</p>
<p><a href="http://groups.google.com/groups?threadm=BA41F83F.8F2D%25zach%40zachlipton.com">http://groups.google.com/groups</a> -- Announcement</p>
<p><a href="http://tinderbox.perl.org/lxr/parrot/source">http://tinderbox.perl.org/lxr/parrot/source</a></p>


<h4><a name="thoughts_on_infant_mortality">Thoughts on Infant Mortality</a></h4>
<p>Piers Cawley offered what he thought might be a new approach to
dealing with the infant mortality problem that got efficiently shot
down by Leo T&ouml;tsch. This led to further discussion of possible
answers, and it looks like Leo's proposed solution involving a small
amount of code reordering and early anchoring will be the one that's
tried next. All being well, it won't require walking the C stack and
hardware register set, which can only be a good thing.</p>
<p>Later, Leo asked whether it'd be OK to check in his work so far on
redoing the GC because he was up to 15 affected files and was starting
to worry about integration hell. Steve Fink wasn't sure about one of
his changes, so Leo checked in everything else.</p>
<p><a href="http://groups.google.com/groups?threadm=m27kdere5g.fsf%40TiBook.bofh.org.uk">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=3E1D47B6.20301%40toetsch.at">http://groups.google.com/groups</a></p>


<h4><a name="objects,_finally_(try_1)">Objects, Finally (try 1)</a></h4>
<p>Last week, I mentioned that Leon Brocard's wish list for the next Parrot
iteration included Objects. This week, Dan posted his first draft of
what Parrot Objects would and wouldn't be able to do. The 11th
entry on Dan's list (Objects are all orange) seemed to be custom-made
to please Leon. There was a fair amount of discussion (of course), but
the consensus was positive.</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f06ba439cb1436b%40%5B192.168.2.1%5D">http://groups.google.com/groups</a></p>


<h4><a name="the_benchmarking_problem">The Benchmarking Problem</a></h4>
<p>Nicholas Clark crossposted to p5p and perl6-internals to discuss the
problems of benchmarking Parrot against Perl 5. One of parrot's aims
is, of course, to go faster than Perl 5. The problem is, how do you
measure 'faster'? Nicholas has been working on making Perl 5 go faster
and was distressed to find out that using 'perlbench,' a patch of his
went 5 percent faster, 1 percent slower, zero and 1 percent faster, depending on what
machine/compiler combination he ran the benchmark on. Leo T&ouml;tsch
commented that he'd found performance varying by more than 50 percent in a JIT
test, depending on the position of a loop in memory. Andreas Koenig
commented that he'd come to the conclusion that bugs in glibc meant
that there was little point in benchmarking Perl at all if it was
built with a glibc older than version 2.3 (apparently malloc/free
proved to be gloriously erratic...) I'm afraid not much was actually
resolved though.</p>
<p><a href="http://groups.google.com/groups?threadm=20030111190521.GK283%40Bagpuss.unfortu.net">http://groups.google.com/groups</a></p>




<h3><a name="meanwhile,_in_perl6language">Meanwhile, in perl6-language</a></h3>
<p>The discussion of Variable types versus Value types continued from the
previous week. Dan opined that Arrays weren't necessarily objects,
which brought forth squawks from Piers Cawley who pointed out that
being able to do:</p>
<pre>
   class PersistentList is Array { 
       method FETCH ($index) { 
           ...
       }
       ...
   }</pre>
<p>would be much nicer than tying a value in the Perl 5ish fashion. Dan
reckoned that delegation would probably be enough which, IMHO, seemed
to miss the point. Various other people chimed in to, essentially,
tell Dan that he was wrong, but I'm  not sure Dan agreed with them.</p>
<p>Meanwhile, in a subthread sprouting lower on the thread tree, Damian
pointed out that there were two types associated with any Perl
variable -- the 'storage type' and the 'implementation type.' (See his
post for details) Essentially the storage type is the type
associated with the contents of a variable and the implementation type
is the type of the 'thing' that does the storing -- usually one of
SCALAR, HASH or ARRAY -- i.e., related to the variable's sigil. Specifying a different implementation type will probably be how Perl 6
does tying.)</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f07ba3e5ebbf80c%40%5B192.168.3.1%5D">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=3E1BF672.2020606%40conway.org">http://groups.google.com/groups</a></p>


<h4><a name="array_questions">Array Questions</a></h4>
<p>In a thread that spilt over from the previous discussion about
whether arrays were objects, Michael Lazzaro put up a list of
examples that seem to imply rather strongly that arrays are
either objects or indistinguishable from them, and there was general
muttering that being able to overload tied Perl containers in this way
was a neat way of implementing tie semantics. Mr Nobody attempted to
restart the left-to-right versus right-to-left argument. There was also some discussion of the sickness of <code>my Foo
@foo is Foo</code> (which, in Perl 5ish parlance creates a tied array -- using Foo as the tying class -- which can only contain objects in class
Foo.) Damian agreed that this was definitely sick, and that he for one
would be making use of it.</p>
<p><a href="http://groups.google.com/groups?threadm=6B9F6C55-226A-11D7-81AD-00050245244A%40cognitivity.com">http://groups.google.com/groups</a></p>


<h4><a name="l2r/r2l_syntax">L2R/R2L Syntax</a></h4>
<p>Argh! No! It's back and this time it means business. The dreaded
left-&gt;right versus right-&gt;left thing came back, and this time it was
Damian applying the electrodes to the corpse. Of course, it being
Damian, he was instantly forgiven as he came up with the very cool,
very low precedence <code>~&gt;</code> and <code>&lt;~</code> operators, allowing you to
write</p>
<pre>
   @out = @a ~&gt; grep {...} ~&gt; map {...} ~&gt; sort;</pre>
<p>Which is, to these eyes at least, lovely. See Damian's post for the
full details. The general response to this was definitely on the
'lovely' side of the balance, though one detractor did induce a sense
of humor failure on Damian's part. There was also a certain amount of
discussion about whether this was exactly the right syntax to go with
the semantics, but where would perl6-language be without a great deal
of syntactic quibbling? (A good deal easier to summarize). The most
popular alternatives were <code>|&gt;</code> and <code>&lt;|</code>. There was also a
certain amount of discussion of what I can only describe as 'evil'
uses of the syntax, involving arrows going in different directions in
one statement. Rafael Garcia-Suarez earned at least one giggle when he
suggested that we just needed <code>v~</code> <code>^~</code> and we had our own
flavour of Befunge.</p>
<p>There was a fair amount more discussion, mostly thrashing out details
and edge cases.</p>
<p><a href="http://groups.google.com/groups?threadm=3E1BA592.6050902%40conway.org">http://groups.google.com/groups</a></p>


<h4><a name="disappearing_code">&quot;Disappearing&quot; code</a></h4>
<p>John Siracusa wondered whether there would be a perl6ish way of creating
code that was 'the spiritual equivalent of #ifdef, only Perlish.' To
which the answer is, of course, 'yes.' Damian showed off a neat trick
(modulo a couple of pretty typos) with an immediate function that
demonstrated using Perl 6 as its own macro language.</p>
<p><a href="http://groups.google.com/groups?threadm=BA438428.E548%25siracusa%40mindspring.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=BA447213.2B258%25siracusa%40mindspring.com">http://groups.google.com/groups</a> -- Damian's neat trick</p>




<h3><a name="in_brief">In Brief</a></h3>
<p>Jim Radford fixed some typos in the <em>rx.ops</em> documentation.</p>




<h3><a name="who's_who_in_perl_6">Who's Who in Perl 6</a></h3>
<dl>
<dt><strong><a name="item_who_are_you%3f">Who are you?</a></strong><br />
</dt>
<dd>
Steve Fink. Some guy who writes code.
</dd>


<dt><strong><a name="item_what_do_you_do_for%2fwith_perl_6%3f">What do you do for/with Perl 6?</a></strong><br />
</dt>
<dd>
The only thing I set out to do was implement a regular expression
compiler. Along the way, I seem to have implemented hashtables,
patched the configuration system, messed with memory management,
implemented some stuff for IMCC, beefed up the PMC file parser, fixed
some problems with the JIT, and a few other things. Then I got a job
and ran out of time to work on Parrot, so they made me pumpking. And I
still haven't made it that far with the regex compiler.
</dd>


<dt><strong><a name="item_where_are_you_coming_from%3f">Where are you coming from?</a></strong><br />
</dt>
<dd>
Computer games, originally. First language, BASIC; second language, 6502
assembly. Then a failed attempt at C, then more successful encounters
with Pascal and 68000 assembly, and then C++. Next, a few more
assembly languages together with SML, NESL, Lisp, Scheme, COBOL, Tcl,
Prolog, and a few others. And, at last, Perl4 and then Perl5. Oh, and
Java, fairly recently. My day job is now in a combination of Perl5 and
C++, as well as C when nobody's looking.
</dd>


<dt><strong><a name="item_when_do_you_think_perl_6_will_be_released%3f">When do you think Perl 6 will be released?</a></strong><br />
</dt>
<dd>
Probably smoothing the path for other developers and keeping them
motivated. My highest priority is applying (and testing) other
people's patches, since the mostly likely reason for someone to lose
interest is to not have their hard work make it into the distribution.
I would also like to somehow make people's contributions more visible
-- anyone who has contributed anything significant should at least be
able to point to something and say &quot;Look! I did that! See my name?!&quot;
</dd>


<dt><strong><a name="item_i_said%2c_when_do_you_think_perl_6_will_be_release">I said, when do you think Perl 6 will be released?</a></strong><br />
</dt>
<dd>
Obviously, Leopold T&ouml;tsch. Anyone paying an iota of attention
would know that. Particularly someone who's been writing the
summaries, unless you're stupid or something. Leo's amazing; I don't
know how he finds the time. To accomplish that much, I'd need to be
working full-time about 26 hours a day.
</dd>


<dt><strong><a name="item_no%2c_really%2e_when_do_you_think_perl_6_will_be_r">No, really. When do you think Perl 6 will be released?</a></strong><br />
</dt>
<dd>
No, not really. I was originally thinking of Perl6 when I got
involved, but since then the Parrot VM itself has become more
interesting to me. Although I still wish Perl6 development would pick up --
there's a lot that can be done even with the limited amount of the
language that's been defined. Sean O'Rourke did an excellent job in a
short amount of time, but it looks like real life has drawn him back
into its fold, and nobody seems to have picked up the slack.
</dd>


<dt><strong><a name="item_why_are_you_doing_this%3f">Why are you doing this?</a></strong><br />
</dt>
<dd>
Heh. That is the question, isn't it? Making a release is probably the
most concrete measure of how I'm doing as a pumpking, and by that
standard I'm a dismal failure. As soon as we reclaim the tinderbox
(and without dropping any machines off it in order to do so!)
Everything else I wanted to get in is already there.
</dd>


<dt><strong><a name="item_you_have_five_words%2e_describe_yourself%2e">You have five words. Describe yourself.</a></strong><br />
</dt>
<dd>
No, I don't think so. Maybe I'm wrong, but I know that I personally
had to put aside a lot of the actual coding I was working on in order
to concentrate on making sure everyone else's changes were being given
proper consideration. I'd much rather relieve him of that burden, and
let him continue to exercise his demonstrated talent at churning out
quality code.
</dd>


<dt><strong><a name="item_do_you_have_anything_to_declare%3f">Do you have anything to declare?</a></strong><br />
</dt>
<dd>
No. It kind of makes sense, but I remember how I first started by
rewriting a bunch of Dan Sugalski's code, and then seeing most of my
code get rewritten. I used to be disturbed by that, but now I think of
it more as a badge of honor -- it proves that what I wrote was worth
rewriting. Much more so in Dan's case, I suppose, since he stated
up-front that he was merely doing a reference implementation of a
design. Dan's done an amazing job of laying out a design that hasn't
needed to change at its core, and so has been a very dependable guide
to the implementation of the backbone. But even in my case, I can see
a number of ideas that were carried through in the reimplementation,
even if no actual code survived. (Interestingly, my tests did. Which
kind of makes sense if you think about it.)
</dd>


<dt><strong><a name="item_are_you_finished_yet%3f">Are you finished yet?</a></strong><br />
</dt>
<dd>
Why yes, thank you.
</dd>

</dl>
<p>Ahem. Thanks Steve. Really.</p>




<h3><a name="acknowledgements">Acknowledgements</a></h3>
<p>Another Monday evening, another summary running over into Tuesday
morning. Ah well. Distractions were provided by the usual suspects
(Mike and Sully, our ginger kittens), supplemented this week by a
horrible cold (the compulsion to find a tissue does tend to derail the
train of thought).</p>
<p>Proofreading was once more handled by Aspell and me. This week, we even
made sure that the Who's Who section contains the name of the person
answering the questions rather than making you wait 'til the
acknowledgements section.</p>
<p>Speaking of which, many thanks to Steve Fink for his answers to the
questionnaire (well, to the questions he wanted to answer anyway). The
questionnaire queue is now quite empty so, unless a few more folks in
the Perl 6 community send me some answers soon then the Who's Who
section may be going on hiatus. Send your answers (or request the
'correct' question list from) <em><a href="mailto:5Ws@bofh.org.uk">5Ws@bofh.org.uk</a></em>.</p>
<p>If you didn't like this summary, then how did you get this far? If you did
like it, then please consider one or more of the following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl 6.</li>


<li>
Get involved in the Perl 6 process. The mailing lists are open to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>


<li>
Send feedback, flames, money and or a couple of first-class flights to
from London to Portland for this year's OSCON to
<em><a href="mailto:mailto:p6summarizer@bofh.org.uk">mailto:p6summarizer@bofh.org.uk</a></em> (&quot;Aim high!&quot; they told me.)</li>

</ul>
<p>The fee paid for the publication of these summarize on perl.com is
paid directly to the Perl Foundation.</p>
<p>The Perl 6 Summarizer disclaims any and all responsibility for the
sanity of his readers; he's having enough trouble hanging onto his
own.</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1054" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/01/p6pdigest/20020308.html" rel="bookmark">This week on Perl 6, weeks ending 2003-01-05</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-01-08T00:00:00-08:00">January  8, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>Hello, and welcome to the first summary of 2003; welcome to the future. 
This summary covers two weeks, but they've been quiet what with Christmas and 
the New Year's.</p>


<p>So, starting as usual with perl6-internals</p>


<h4><a name="a_pile_of_patches_to_the_perl_6_compiler" id="a_pile_of_patches_to_the_perl_6_compiler">A Pile of Patches to the 
Perl 6 Compiler</a></h4>
<p>Joseph F. Ryan submitted several patches to the Perl 6 mini-compiler, 
(found in the <em>languages/perl6</em> subdirectory of your friendly 
neighborhood Parrot distribution) mostly implementing the the semantics for 
string and numeric literals discussed on perl6-documentation.</p>


<h4><a name="garbage_collection_headaches" id="garbage_collection_headaches">Garbage Collection Headaches</a></h4>
<p>Heads have been put together in an attempt to get Parrot's Garbage Collection 
system working efficiently and accurately (no destroying stuff before anyone's 
had a chance to use it, damn it!) It appears that there's still a good deal of 
head scratching to be done in this area (the chaps over on the LL1 list are 
wondering why we aren't just using the Boehm GC system ... .)</p>
<p>I freely admit that GC makes my head hurt (especially as, in my current Perl 
5 project, I'm busy implementing mark and sweep collection for a persistent 
object store while also making sure that my random assortment of circular data 
structures has weakened references in just the right places so that stuff gets 
destroyed but only when it <strong>should</strong> be destroyed ... . Boy, am I 
looking forward to Perl 6 and not having to worry about this stuff ever 
again ... .) but I I'll have a go at summarizing the issues.</p>
<p>The main problem appears to be that of 'Infant mortality,' an issue that I 
will now attempt to explain.</p>
<p>All the objects in memory can be represented as nodes in a graph, and the 
pointers between those objects can be represented as edges in that graph. The 
process of garbage collection involves taking a subset of those nodes (the 
rootset) and freeing (or marking as freeable) all those nodes in the graph that
are unreachable from the rootset.</p>
<p>Now, consider a function that sets up a new PMC, specifically a PMC that 
contains another PMC. The first step is to grab the memory for our new PMC. Next, we 
create the contained PMC, a process that allocates more memory ... and there's 
the rub. Garbage Collection can get triggered at any point where we go to 
allocate more memory; unless the <em>containing</em> PMC is reachable from the 
rootset then it will get freed at the point. And that leads to badness. So the 
Infant Mortality problem can also be thought of as the problem of rootset 
maintenance. Which is, in theory, simple; just treat all C variables as members 
of the rootset. However, in practice it isn't that simple, mostly because 
hardware registers complicate the issue.</p>
<p>Steve Fink offered an overview of the issues and some of the possible 
approaches to dealing with them, which sparked a fair amount of discussion 
among those who understood the issues.</p>
<p><a 
href="http://groups.google.com/groups?threadm=a05200f07ba2d0834cfdf%40%5B63.120.19.221%5D">http://groups.google.com/groups?threadm=a05200f07ba2d0834cfdf%40%5B63.120.19.221%5D</a></p>
<p><a 
href="http://groups.google.com/groups?threadm=20021231000055.GA23896%40foxglove.digital-integrity.com">http://groups.google.com/groups?threadm=20021231000055.GA23896%40foxglove.digital-integrity.com</a> 
-- Steve's overview</p>


<h4><a name="variable/value_vtable_split" id="variable/value_vtable_split">Variable/value vtable split</a></h4>
<p>Leo T&ouml;tsch posted a summary of where we stand on doing the variable/value 
vtable split, suggesting that he wanted to start feeding in patches soon. 
Mitchell N Charity supplied a handy dandy 'context' post with links to 
appropriate articles, and he and Leo did a certain amount of thrashing out of 
issues.</p>
<p><a 
href="http://groups.google.com/groups?threadm=3E1067FF.5030307%40toetsch.at">http://groups.google.com/groups?threadm=3E1067FF.5030307%40toetsch.at</a></p>
<p><a 
href="http://groups.google.com/groups?threadm=200212310239.gBV2dC524913%40vendian.org">http://groups.google.com/groups?threadm=200212310239.gBV2dC524913%40vendian.org</a></p>


<h4><a name="parrot_gets_another_new_language" id="parrot_gets_another_new_language">Parrot Gets Another New 
Language</a></h4>
<p>Ook! Jerome Quelin offered an implementation of the latest silly language, 
Ook! which can be thought of as brainf.ck for librarians. Due to insanity, the 
Ook! compiler is implemented in Parrot assembly, and emits Parrot assembly, too, 
which led Jerome to ask for an 'eval' opcode that Leo promised to supply -- and 
which Dan specced out in PDD6. All of which led Leo to comment that, for all 
these languages are toys, they do seem to be driving the implementation of 
important bits of Parrot. Nicholas Clark reminded everyone that a zcode 
interpreter would be another good thing to have a crack at because it would 
require a couple of other really useful bits of Parrot functionality. Ook! is 
now in the core.</p>
<p><a 
href="http://groups.google.com/groups?threadm=rt-19610-46602.16.0961486583524%40bugs6.perl.org">http://groups.google.com/groups?threadm=rt-19610-46602.16.0961486583524%40bugs6.perl.org</a></p>


<h4><a name="returning_new_pmcs" id="returning_new_pmcs">Returning new PMCs</a></h4>
<p>David Robins wondered what was the resolution about creating and returning a 
new PMC in PMC ops that take a <code>PMC* dest</code> parameter. He and Dan 
discussed it back and forth and it became apparent that Dan really needs to get 
Parrot Objects defined ... .</p>
<p><a 
href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0212311324290.2659-100000%40davidrobins.net">http://groups.google.com/groups?threadm=Pine.LNX.4.44.0212311324290.2659-100000%40davidrobins.net</a></p>


<h4><a name="fun_with_perlhash" id="fun_with_perlhash">Fun with PerlHash</a></h4>
<p>Jerome Quelin noticed that you couldn't delete an item from a PerlHash. Leo 
fixed it. Jerome later asked how one could retrieve the keys of a PerlHash in 
Parrot assembly and wondered whether there was a way to traverse a hash. Sadly, the 
answer is 'not yet,' but happily Aldo Calpini has something nearly ready 
for prime time.</p>
<p><a 
href="http://groups.google.com/groups?threadm=200301021757.35942.jquelin%40mongueurs.net">http://groups.google.com/groups?threadm=200301021757.35942.jquelin%40mongueurs.net</a></p>


<h4><a name="gc/dod_feedback_&amp;_runtime_tuning" id="gc/dod_feedback_&_runtime_tuning">GC/DOD feedback &amp; runtime 
tuning</a></h4>
<p>Dan has been playing some test programs and has found some major issues with 
resource allocation and added his stress-test programs to the distribution so 
others could see whether they could see how to fix things. Leo T&ouml;tsch (who else) made 
some inroads, reporting his progress to the list as he and Dan discussed ways 
forward.</p>
<p><a 
href="http://groups.google.com/groups?threadm=a05200f17ba3a6adff185%40%5B192.168.3.1%5D">http://groups.google.com/groups?threadm=a05200f17ba3a6adff185%40%5B192.168.3.1%5D</a></p>


<h4><a name="object_semantics" id="object_semantics">Object Semantics</a></h4>
<p>Dan posted a sketch of how Parrot was going to deal with language level 
objects. And there was much rejoicing. Various people pointed out that Dan's 
assumption that 'real' languages only had reference type objects was incorrect; 
ruby has value types, so does smalltalk and C# and they're just the ones off the 
top of people's heads.</p>
<p><a 
href="http://groups.google.com/groups?threadm=a05200f16ba3a5968d9a6%40%5B192.168.3.1%5D">http://groups.google.com/groups?threadm=a05200f16ba3a5968d9a6%40%5B192.168.3.1%5D</a></p>


<hr />

<h3><a name="meanwhile_in_perl6language" id="meanwhile_in_perl6language">Meanwhile in perl6-language</a></h3>
<p>Not much was happening. The language folks seem to have taken their holidays 
seriously; the last fortnight saw all of 76 posts.</p>


<h4><a name="tree_frobbing_facilities_in_perl_6" id="tree_frobbing_facilities_in_perl_6">Tree-Frobbing Facilities in Perl 
6</a></h4>
<p>Rich Morin wondered what type of facilities Perl 6 would have for monkeying 
about in trees, offering a discussion of the sort of thing he wanted to do and 
the problems he saw with doing that in Perl 5. Michael Schwern reckoned that 
&quot;Doctor, it hurts when I do this.&quot; applied (&quot;Well, don't do that then&quot;) and 
suggested other ways to handle Rich's problem. Simon Cozens, who should know 
better, made a <em>terrible</em> joke about frobbing trees. Dave Whipp pointed 
out that continuations should make it easy to treat tree traversal just like 
traversing any other list.</p>
<p><a 
href="http://groups.google.com/groups?threadm=p05200f0dba2db8832a47%40%5B192.168.254.205%5D">http://groups.google.com/groups?threadm=p05200f0dba2db8832a47%40%5B192.168.254.205%5D</a></p>


<h4><a name="pre/post_in_loops" id="pre/post_in_loops">PRE/POST in Loops</a></h4>
<p>Arthur Bergman is this week's hero. He's busy writing 
<strong>Hook::Scope</strong>, which will (eventually) implement Perl 6's 
<code>PRE/POST/FINALLY/CATCH</code> etc. In Perl 5. Yay Arthur.</p>
<p>Anyway, Arthur wanted to know what happens with POST and PRE in loop scopes. 
Do they get called for every iteration, or merely at the beginning and end of 
the loop?</p>
<p>Luke Palmer reckons that POST gets executed for every iteration (NEXT doesn't 
get executed on the last time through a loop.</p>
<p><a 
href="http://groups.google.com/groups?threadm=F41A933B-1E7E-11D7-BEB2-003065D64CBE%40cpan.org">http://groups.google.com/groups?threadm=F41A933B-1E7E-11D7-BEB2-003065D64CBE%40cpan.org</a></p>


<hr />

<h3><a name="my_int_(_1..31_)_$var_" id="my_int_(_1..31_)_$var_"><code>my int ( 1..31 ) $var</code> ?</a></h3>
<p>Murat &Uuml;nalan didn't like Damian's proposed <code>my $date is 
Integer(1..31);</code> (restricts $date to an integer between 1 and 31) and 
proposed using <code>my int(1..31) $date</code> instead. He didn't like</p><pre>    my int ($pre, $in, $post) is constant = (0..2);</pre>
<p>either, proposing either of:</p><pre>    my constant int ($pre, $in, $post) = (0..2);
    my int is constant ($pre, $in, $post) = (0..2);</pre>
<p>Murat argued that 'type and property' belong together. Damian disagreed, and 
pointed out that, if you <em>want</em> the specifiers close together, then you could 
write:</p><pre>    my ($pre, $in, $post) returns int is constant = (0..2);</pre>
<p>I'm caricaturing (but only slightly) the rest of the discussion if I say that 
the rest of the thread ran along the lines of a pantomime argument (&quot;Oh yes it 
is!&quot; ... &quot;Oh no it isn't!&quot;), suffice to say I don't think either Damian or 
Murat convinced the other. Personally, I'm on Damian's side -- sorry Murat.</p>
<p><a 
href="http://groups.google.com/groups?threadm=000001c2b32b%24c4cb0400%246a00fea9%40Platin">http://groups.google.com/groups?threadm=000001c2b32b%24c4cb0400%246a00fea9%40Platin</a></p>
<p><a 
href="http://groups.google.com/groups?threadm=000001c2b382%24f4bfb500%246a00fea9%40Platin">http://groups.google.com/groups?threadm=000001c2b382%24f4bfb500%246a00fea9%40Platin</a></p>


<h4><a name="variable_types_vs_value_types" id="variable_types_vs_value_types">Variable Types vs. Value Types</a></h4>
<p>Dave Whipp wondered whether the type of a variable could vary independently of its 
value. I'm not sure I understand what Dave was driving at, which makes 
summarizing his post a little tricky (but I <em>think</em> there's confusion 
about the meaning of 'type'; A variable has what I will call a 'sigil type' and 
may also have a more specific 'declared type'. Thus, a declaration of the form 
<code>my Array $foo;</code> declares a scalar (sigil type) variable which points 
to (contains) an Array (declared type) object while one of the form <code>my 
Array @foo;</code> declares an array (sigil type) variable which contains a 
number of Array (declared type) objects. The meaning of <code>my Array 
%foo</code>.</p>
<p>This led into a discussion of the 'Everything is an object' principle, but 
more on that next week.</p>
<p><a 
href="http://groups.google.com/groups?threadm=20030103004227.16970.qmail%40onion.perl.org">http://groups.google.com/groups?threadm=20030103004227.16970.qmail%40onion.perl.org</a></p>


<hr />

<h3><a name="in_brief" id="in_brief">In Brief</a></h3>
<p>Leo T&ouml;tsch kept up his staggering patch generation rate. Does he ever 
sleep?</p>
<p>Mitchell Charity supplied a script which generates a browseable list of 
Parrot file names with brief descriptions, which should prove useful to new 
developers who want to get a feel for the layout of Parrot. Dan agreed, and it's 
in the Parrot distribution now as 
<em>tools/dev/extract_file_descriptions.pl</em>.</p>
<p>Jason Gloudon got Garbage collection working on IA-64 Linux, yay Jason.</p>
<p>Bruce Gray sent in a bunch of cleanup and win32 patches.</p>
<p>On a suggestion from Mitchell N Charity, Robert Spier has started work on 
getting a browseable, cross-referenced version of the Parrot source up on 
perl.org and asked to be pinged in a week or two if it hasn't happened.</p>
<p>Jerome also improved the debugger.</p>
<p>Leon 'bear of very little brain' Brocard added a couple of wishlist items: 
Objects, and a 'make install' that does something sensible.</p>


<hr />

<h3><a name="who's_who_in_perl_6" id="who's_who_in_perl_6">Who's Who in Perl 6?</a></h3>
<dl>
  <dt><strong><a name="item_who_are_you%3f" id="item_who_are_you%3f">Who are you?</a></strong><br />
  </dt>
  <dd>A twenty-something coder, writer and editor who thinks it's possible to 
    improve the state of software and software development. </dd>
  <dt><strong><a name="item_what_do_you_do_for%2fwith_perl_6%3f" id="item_what_do_you_do_for%2fwith_perl_6%3f">What 
    do you do for/with Perl 6?</a></strong><br />
  </dt>
  <dd>Random stuff: 
  <ul>
      <li>argue language features with Allison, who lives very nearby </li>
      <li>proofread documentation when I'm trying to read it </li>
      <li>extending Parrot as an embedded platform for game scripting </li>
      <li>overseeing the project to turn p6d documentation into executable test 
    cases 
    
</li></ul>
  <p>Maybe I need a Perl 6 Test Pumpking hat ...</p>
  </dd>
  <dt><strong><a name="item_where_are_you_coming_from%3f" id="item_where_are_you_coming_from%3f">Where 
    are you coming from?</a></strong><br />
  </dt>
  <dd>Physically, Portland, Ore., or Sebastopol, Calif. </dd>
  <dd>
  <p>Otherwise, I find that Perl 5 fits the way I think and expect Perl 6 to do 
  the same, only much more so.</p>
  

  </dd>
  <dt><strong><a name="item_when_do_you_think_perl_6_will_be_released%3f" id="item_when_do_you_think_perl_6_will_be_released%3f">When 
    do you think Perl 6 will be released?</a></strong><br />
  </dt>
  <dd>In beta form within the next two years. Within five years, I think it will 
    overtake Perl 5. (I expect a 5.12, though.) </dd>
  <dt><strong><a name="item_why_are_you_doing_this%3f" id="item_why_are_you_doing_this%3f">Why 
    are you doing this?</a></strong><br />
  </dt>
  <dd>Someone has to do this. I'm blessed to be in a position where I have some 
    ability to give back to the community that's given me so much and where I 
    have financial compensation to spend some time participating in this community. 
  </dd>
  <dd>
  <p>I also believe that the way to write high-quality software is to take 
  quality seriously. We have the opportunity to test Perl 6 from the ground up, 
  having learned lessons and built tools for Perl 5. If we do our job correctly, 
  then we'll even have tests in place before we have the language features in place. 
  Hooray for test-driven development!</p>
  

  </dd>
  <dt><strong><a name="item_you_have_5_words%2e_describe_yourself%2e" id="item_you_have_5_words%2e_describe_yourself%2e">You 
    have five words. Describe yourself.</a></strong><br />
  </dt>
  <dd>I am not really Schwern. </dd>
  <dt><strong><a name="item_do_you_have_anything_to_declare%3f" id="item_do_you_have_anything_to_declare%3f">Do 
    you have anything to declare?</a></strong><br />
  </dt>
  <dd>So this camel and parrot walk into a bar... 
  
</dd></dl>


<hr />

<h3><a name="acknowledgements" id="acknowledgements">Acknowledgements</a></h3>
<p>Back to writing summaries on the train and in the armchair when I get 
distracted by almost anything (current distractions, writing a graphical 
TestRunner for the ObjcTest framework, Eliza Carthy's utterly wonderful 
<em>Anglicana</em> CD and the nsNet puzzle game...). I started writing this 
Monday morning damn it.</p>
<p>Proofreading was once more handled by Aspell and me.</p>
<p>Thanks to chromatic for answering the questionnaire for me. The queue now has 
one (count it, one) entry left in it so please consider sending me your answers 
to <em><a 
href="mailto:mailto:5Ws@bofh.org.uk">mailto:mailto:5Ws@bofh.org.uk</a></em></p>
<p>If you didn't like this summary, why are you still reading it? If you did 
like it, please consider one or more of the following options:</p>
<ul>
  <li>Send money to the Perl Foundation at <a 
  href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> 
    and help support the ongoing development of Perl 6. </li>
  <li>Get involved in the Perl 6 process. The mailing lists are open to all. <a 
  href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a 
  href="http://www.parrotcode.org/">http://www.parrotcode.org/</a> are good starting 
    points with links to the appropriate mailing lists. </li>
  <li>Send feedback, flames, money and/or one of those enormous new Apple 
  Powerbooks to <em><a 
  href="mailto:mailto:p6summarizer@bofh.org.uk">mailto:mailto:p6summarizer@bofh.org.uk</a></em> 

  
</li></ul>
<p>The fee paid for publication of these summaries on perl.com is paid directly 
to the Perl Foundation.</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1044" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/01/07/mod_perl.html" rel="bookmark">Improving mod_perl Sites' Performance: Part 6</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Stas Bekman</span> on <abbr class="published" title="2003-01-07T00:00:00-08:00">January  7, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>It's desirable to avoid forking under <code>mod_perl</code>, as when you do, 
you are forking the entire Apache server -- lock, stock and barrel. Not only is 
your Perl code and Perl interpreter being duplicated, but so is 
<code>mod_ssl</code>, <code>mod_rewrite</code>, <code>mod_log</code>, 
<code>mod_proxy</code>, <code>mod_speling</code> (it's not a typo!) or whatever 
modules you have used in your server, all the core routines.</p>
<p>Modern operating systems come with a light version of fork, which adds a 
little overhead when called, since it was optimized to do the absolute minimum 
of memory pages duplications. The <em>copy-on-write</em> technique is what 
allows it to do so. The gist of this technique is as follows: The parent 
process' memory pages aren't immediately copied to the child's space on fork(); 
this is done only when the child or the parent modifies the data in some memory 
pages. Before the pages get modified, they get marked as dirty and the child has 
no choice but to copy the pages that are to be modified since they cannot be 
shared any more.</p>
<p>If you need to call a Perl program from your <code>mod_perl</code> code, then it's 
better to try to covert the program into a module and call it as a function 
without spawning a special process to do that. Of course, if you cannot do that 
or the program is not written in Perl, then you have to call via 
<code>system()</code> or its equivalent, which spawns a new process. If the 
program is written in C, then you can try to write a Perl glue code with help of XS 
or SWIG architectures, and then the program will be executed as a Perl 
subroutine.</p>
<p>Also, by trying to spawn a sub-process, you might be trying to do the 
<em>&quot;wrong thing&quot;</em>. If what you really want is to send information to the 
browser and then do some post-processing, then look into the 
<code>PerlCleanupHandler</code> directive. The latter allows you to tell the 
child process after request has been processed and user has received the 
response. This doesn't release the <code>mod_perl</code> process to serve other 
requests, but it allows you to send the response to the client faster. If this 
is the situation and you need to run some cleanup code, then you may want to register 
this code during the request processing stage like so:</p><pre><code>  my $r = shift;
  $r-&gt;register_cleanup(\&amp;do_cleanup);
  sub do_cleanup{ #some clean-up code here }</code></pre>
<p>But when a long-term process needs to be spawned, there is not much choice 
but to use fork(). We cannot just run this process within the Apache 
process because it'll keep the Apache process busy, instead of allowing it 
to do the job it was designed to do. Also, if Apache stops, then the long-term 
process might be terminated as well unless coded properly to detach from 
Apache's process group.</p>

<csperl file="grab" domain="on" record="b/832" template="b/article_sidebar2.view">

<p>In the following sections, I'm going to discuss how to properly spawn new 
processes under <code>mod_perl</code>.</p>

<h3><a name="forking_a_new_process">Forking a New Process</a></h3>
<p>This is a typical way to call <code>fork()</code> under 
<code>mod_perl</code>:</p><pre><code>  defined (my $kid = fork) or die "Cannot fork: $!\n";
  if ($kid) {
    # Parent runs this block
  } else {
    # Child runs this block
    # some code comes here
    CORE::exit(0);
  }
  # possibly more code here usually run by the parent</code></pre>
<p>When using fork(), you should check its return value, because if it returns 
<code>undef</code>, it means that the call was unsuccessful and no process was 
spawned; something that can happen when the system is running too many processes 
and cannot spawn new ones.</p>
<p>When the process is successfully forked, the parent receives the PID of the 
newly spawned child as a returned value of the <code>fork()</code> call and the 
child receives 0. Now the program splits into two. In the above example, the code 
inside the first block after <em>if</em> will be executed by the parent and the 
code inside the first block after <em>else</em> will be executed by the child 
process.</p>
<p>It's important not to forget to explicitly call <code>exit()</code> at the 
end of the child code when forking - if you don't and there is some code outside 
the <em>if/else block</em>, then the child process will execute it as well. But under 
<code>mod_perl</code> there is another nuance: You must use 
<code>CORE::exit()</code> and not <code>exit()</code>, which would be 
automatically overriden by <code>Apache::exit()</code> if used in conjunction 
with <code>Apache::Registry</code> and similar modules. We actually do want the 
spawned process to quit when its work is done, otherwise, it'll just stay alive, 
use resources and do nothing.</p>
<p>The parent process usually completes its execution path and enters the pool 
of free servers to wait for a new assignment. If the execution path is to be 
aborted earlier for some reason, then one should use Apache::exit() or die(). In the 
case of <code>Apache::Registry</code> or <code>Apache::PerlRun</code> handlers, a 
simple <code>exit()</code> will do the correct thing.</p>
<p>The child shares with parent its memory pages until it has to modify some of 
them, which triggers a <em>copy-on-write</em> process that copies these pages 
to the child's domain before the child is allowed to modify them. But this all 
happens afterward. At the moment the <code>fork()</code> call is executed, the 
only work to be done before the child process goes on its separate way is to set 
up the page tables for the virtual memory, which imposes almost no delay at 
all.</p>

<h3><a name="freeing_the_parent_process">Freeing the Parent Process</a></h3>
<p>In the child code, you must also close all pipes to the connection socket 
that were opened by the parent process (i.e. <code>STDIN</code> and 
<code>STDOUT</code>) and inherited by the child, so the parent will be able to 
complete the request and free itself for serving other requests. If you need the 
<code>STDIN</code> and/or <code>STDOUT</code> streams, then you should reopen them. 
You may need to close or reopen the <code>STDERR</code> filehandle. It's opened 
to append to the <em>error_log</em> file as inherited from its parent, so 
chances are that you will want to leave it untouched.</p>
<p>Under <code>mod_perl</code>, the spawned process also inherits a file 
descriptor that's tied to the socket through which all communication 
between the server and the client occur. Therefore, we need to free this stream 
in the forked process. If we don't do that, then the server cannot be restarted while 
the spawned process is still running. If an attempt is made to restart the 
server, then you will get the following error:</p><pre><code>  [Mon Dec 11 19:04:13 2000] [crit] 
  (98)Address already in use: make_sock:
    could not bind to address 127.0.0.1 port 8000</code></pre>
<p><code>Apache::SubProcess</code> comes to our aid and provides a method 
<code>cleanup_for_exec()</code>, which takes care of closing this file 
descriptor.</p>
<p>So the simplest way to free the parent process is to close all three 
<code>STD*</code> streams if we don't need them, and untie the Apache socket. In 
addition, you may want to change the process' current directory to <em>/</em> so 
the forked process won't keep the mounted partition busy, if this is to be 
unmounted at a later time. To summarize all this issues, here is an example of 
the fork that takes care of freeing the parent process.</p><pre><code>  use Apache::SubProcess;
  defined (my $kid = fork) or die "Cannot fork: $!\n";
  if ($kid) {
    # Parent runs this block
  } else {
    # Child runs this block
      $r-&gt;cleanup_for_exec(); # untie the socket
      chdir '/' or die "Can't chdir to /: $!";
      close STDIN;
      close STDOUT;
      close STDERR;
  
    # some code comes here
  
      CORE::exit(0);
  }
  # possibly more code here usually run by the parent</code></pre>
<p>Of course, between the freeing-parent code and child-process termination, 
the real code is to be placed.</p>

<h3><a name="detaching_the_forked_process">Detaching the Forked Process</a></h3>
<p>Now what happens if the forked process is running and we decide that we need 
to restart the Web server? This forked process will be aborted, since when the 
parent process dies during the restart, it'll kill its child processes as well. 
In order to avoid this, we need to detach the process from its parent session by 
opening a new session. We do this with help of <code>setsid()</code> system 
call, provided by the <code>POSIX</code> module:</p><pre><code>  use POSIX 'setsid';
  
  defined (my $kid = fork) or die "Cannot fork: $!\n";
  if ($kid) {
    # Parent runs this block
  } else {
    # Child runs this block
      setsid or die "Can't start a new session: $!";
      ...
  }</code></pre>
<p>Now the spawned child process has a life of its own, and it doesn't depend on 
the parent any longer.</p>

<h3><a name="avoiding_zombie_processes">Avoiding Zombie Processes</a></h3>
<p>Now let's talk about zombie processes.</p>
<p>Normally, every process has its parent. Many processes are children of the 
<code>init</code> process, whose <code>PID</code> is <code>1</code>. When you 
fork a process, you must <code>wait()</code> or <code>waitpid()</code> for it to 
finish. If you don't <code>wait()</code> for it, then it becomes a zombie.</p>
<p>A zombie is a process that doesn't have a parent. When the child quits, it 
reports the termination to its parent. If no parent wait()s to collect the exit 
status of the child, then it gets <em>&quot;confused&quot;</em> and becomes a ghost process. 
This process can be seen as a process, but not killed. It will be killed only 
when you stop the parent process that spawned it!</p>
<p>Generally, the <code>ps(1)</code> utility displays these processes with the 
<code>&lt;defunct&gt;</code> tag, and you will see the zombies counter increment 
when doing top(). These zombie processes can take up system resources and are 
generally undesirable.</p>
<p>So the proper way to do a fork is:</p><pre><code>  my $r = shift;
  $r-&gt;send_http_header('text/plain');
  
  defined (my $kid = fork) or die "Cannot fork: $!";
  if ($kid) {
    waitpid($kid,0);
    print "Parent has finished\n";
  } else {
      # do something
      CORE::exit(0);
  }</code></pre>
<p>In most cases, the only reason you would want to fork is when you need to 
spawn a process that will take a long time to complete. So if the Apache process 
that spawns this new child process has to wait for it to finish, then you have gained 
nothing. You can neither wait for its completion (because you don't have the 
time to), nor continue because you will get yet another zombie process. This is 
called a blocking call, since the process is blocked to do anything else before 
this call gets completed.</p>
<p>The simplest solution is to ignore your dead children. Just add this line 
before the <code>fork()</code> call:</p><pre><code>  $SIG{CHLD} = 'IGNORE';</code></pre>
<p>When you set the <code>CHLD</code> (<code>SIGCHLD</code> in C) signal handler 
to <code>'IGNORE'</code>, all the processes will be collected by the 
<code>init</code> process and are therefore prevented from becoming zombies. 
This doesn't work everywhere, however. It proved to work at least on the Linux 
OS.</p>
<p>Note that you cannot localize this setting with <code>local()</code>. If you 
do, then it won't have the desired effect.</p>
<p>So now the code would look like this:</p><pre><code>  my $r = shift;
  $r-&gt;send_http_header('text/plain');
  
  $SIG{CHLD} = 'IGNORE';
  
  defined (my $kid = fork) or die "Cannot fork: $!\n";
  if ($kid) {
    print "Parent has finished\n";
  } else {
      # do something time-consuming
      CORE::exit(0);
  }</code></pre>
<p>Note that <code>waitpid()</code> call is gone. The 
$SIG{CHLD}&nbsp;=&nbsp;'IGNORE'; statement protects us from zombies, as 
explained above.</p>
<p>Another, more portable but slightly more expensive solution, is to use a 
double fork approach.</p><pre><code>  my $r = shift;
  $r-&gt;send_http_header('text/plain');
  
  defined (my $kid = fork) or die "Cannot fork: $!\n";
  if ($kid) {
    waitpid($kid,0);
  } else {
    defined (my $grandkid = fork) or die "Kid cannot fork: $!\n";
    if ($grandkid) {
      CORE::exit(0);
    } else {
      # code here
      # do something long lasting
      CORE::exit(0);
    }
  }</code></pre>
<p><code>$grandkid</code> becomes a <em>&quot;child of init&quot;</em>, i.e. the child 
of the process whose PID is 1.</p>
<p>Note that the previous two solutions do allow you to know the exit status of 
the process, but in my example I didn't care about it.</p>
<p>Another solution is to use a different <em>SIGCHLD</em> handler:</p><pre><code>  use POSIX 'WNOHANG';
  $SIG{CHLD} = sub { while( waitpid(-1,WNOHANG)&gt;0 ) {} };</code></pre>
<p>This is useful when you <code>fork()</code> more than one process. The 
handler could call <code>wait()</code> as well, but for a variety of reasons 
involving the handling of stopped processes and the rare event when two 
children exit at nearly the same moment, the best technique is to call 
<code>waitpid()</code> in a tight loop with a first argument of <code>-1</code> 
and a second argument of <code>WNOHANG</code>. Together, these arguments tell 
<code>waitpid()</code> to reap the next child that's available, and prevent the 
call from blocking if there happens to be no child ready for reaping. The 
handler will loop until <code>waitpid()</code> returns a negative number or 
zero, indicating that no additional reapable children remain.</p>
<p>While you test and debug your code that uses one of the above examples, you 
might want to write some debug information to the error_log file so you know 
what happens.</p>
<p>Read <em>perlipc</em> manpage for more information about signal handlers.</p>
















<h3><a name="a_complete_fork_example">A Complete Fork Example</a></h3>
<p>Now let's put all the bits of code together and show a well-written fork code 
that solves all the problems discussed so far. I will use an 
&lt;Apache::Registry&gt; script for this purpose:</p><pre><code>  proper_fork1.pl
  ---------------
  use strict;
  use POSIX 'setsid';
  use Apache::SubProcess;
  
  my $r = shift;
  $r-&gt;send_http_header("text/plain");
  
  $SIG{CHLD} = 'IGNORE';
  defined (my $kid = fork) or die "Cannot fork: $!\n";
  if ($kid) {
    print "Parent $$ has finished, kid's PID: $kid\n";
  } else {
      $r-&gt;cleanup_for_exec(); # untie the socket
      chdir '/'                or die "Can't chdir to /: $!";
      open STDIN, '/dev/null'  or die "Can't read /dev/null: $!";
      open STDOUT, '&gt;/dev/null'
          or die "Can't write to /dev/null: $!";
      open STDERR, '&gt;/tmp/log' or die "Can't write to /tmp/log: $!";
      setsid or die "Can't start a new session: $!";
  
      select STDERR;
      local $| = 1;
      warn "started\n";
      # do something time-consuming
      sleep 1, warn "$_\n" for 1..20;
      warn "completed\n";
  
      CORE::exit(0); # terminate the process
  }</code></pre>
<p>The script starts with the usual declaration of the strict mode, loading the 
<code>POSIX</code> and <code>Apache::SubProcess</code> modules and importing of 
the <code>setsid()</code> symbol from the <code>POSIX</code> package.</p>
<p>The HTTP header is sent next, with the <em>Content-type</em> of 
<em>text/plain</em>. The gets ready to ignore the child, to avoid zombies and 
the fork is called.</p>
<p>The program gets its personality split after <code>fork</code> and the 
<code>if</code> conditional evaluates to a true value for the parent process, 
and to a false value for the child process; the first block is executed by the 
parent and the second by the child.</p>
<p>The parent process announces his PID and the PID of the spawned process and 
finishes its block. If there will be any code outside, then it will be executed by the 
parent as well.</p>
<p>The child process starts its code by disconnecting from the socket, changing 
its current directory to <code>/</code>, opening the STDIN and STDOUT streams to 
<em>/dev/null</em>, which in effect closes them both before opening. In fact, in 
this example we don't need neither of these, so I could just 
<code>close()</code> both. The child process completes its disengagement from 
the parent process by opening the STDERR stream to <em>/tmp/log</em>, so it 
could write there, and creating a new session with help of setsid(). Now the 
child process has nothing to do with the parent process and can do the actual 
processing that it has to do. In our example, it performs a simple series of 
warnings, which are logged into <em>/tmp/log</em>:</p><pre><code>      select STDERR;
      local $|=1;
      warn "started\n";
      # do something time-consuming
      sleep 1, warn "$_\n" for 1..20;
      warn "completed\n";</code></pre>
<p>The localized setting of <code>$|=1</code> is there, so we can see the output 
generated by the program immediately. In fact, it's not required when the output 
is generated by warn().</p>
<p>Finally, the child process terminates by calling:</p><pre><code>      CORE::exit(0);</code></pre>
<p>which makes sure that it won't get out of the block and run some code that 
it's not supposed to run.</p>
<p>This code example will allow you to verify that indeed the spawned child 
process has its own life, and its parent is free as well. Simply issue a request 
that will run this script, watch that the warnings are started to be written 
into the <em>/tmp/log</em> file and issue a complete server stop and start. If 
everything is correct, then the server will successfully restart and the long-term 
process will still be running. You will know that it's still running if the 
warnings will still be printed into the <em>/tmp/log</em> file. You may need to 
raise the number of warnings to do above 20, to make sure that you don't miss 
the end of the run.</p>
<p>If there are only five warnings to be printed, then you should see the following 
output in this file:</p><pre><code>  started
  1
  2
  3
  4
  5
  completed</code></pre>

<h3><a name="starting_a_long_running_external_program">Starting a Long-Running 
External Program</a></h3>
<p>But what happens if we cannot just run a Perl code from the spawned process 
and we have a compiled utility, i.e. a program written in C. Or we have a Perl 
program that cannot be easily converted into a module, and thus called as a 
function. Of course, in this case, we have to use system(), exec(), 
<code>qx()</code> or <code>``</code> (back ticks) to start it.</p>
<p>When using any of these methods and when the <em>Taint</em> mode is enabled, 
we must at least add the following code to untaint the <em>PATH</em> environment 
variable and delete a few other insecure environment variables. This information 
can be found in the <em>perlsec</em> manpage.</p><pre><code>  $ENV{'PATH'} = '/bin:/usr/bin';
  delete @ENV{'IFS', 'CDPATH', 'ENV', 'BASH_ENV'};</code></pre>
<p>Now all we have to do is to reuse the code from the previous section.</p>
<p>First, we move the core program into the <em>external.pl</em> file, add the 
shebang first line so the program will be executed by Perl, tell the program to 
run under <em>Taint</em> mode (-T) and possibly enable the <em>warnings</em> 
mode (-w) and make it executable:</p><pre><code>  external.pl
  -----------
  #!/usr/bin/perl -Tw
  
  open STDIN, '/dev/null'  or die "Can't read /dev/null: $!";
  open STDOUT, '&gt;/dev/null'
      or die "Can't write to /dev/null: $!";
  open STDERR, '&gt;/tmp/log' or die "Can't write to /tmp/log: $!";
  
  select STDERR;
  local $|=1;
  warn "started\n";
  # do something time-consuming
  sleep 1, warn "$_\n" for 1..20;
  warn "completed\n";</code></pre>
<p>Now we replace the code that moved into the external program with 
<code>exec()</code> to call it:</p><pre><code>  proper_fork_exec.pl
  -------------------
  use strict;
  use POSIX 'setsid';
  use Apache::SubProcess;
  
  $ENV{'PATH'} = '/bin:/usr/bin';
  delete @ENV{'IFS', 'CDPATH', 'ENV', 'BASH_ENV'};
  
  my $r = shift;
  $r-&gt;send_http_header("text/html");
  
  $SIG{CHLD} = 'IGNORE';
  
  defined (my $kid = fork) or die "Cannot fork: $!\n";
  if ($kid) {
    print "Parent has finished, kid's PID: $kid\n";
  } else {
      $r-&gt;cleanup_for_exec(); # untie the socket
      chdir '/'                or die "Can't chdir to /: $!";
      open STDIN, '/dev/null'  or die "Can't read /dev/null: $!";
      open STDOUT, '&gt;/dev/null'
          or die "Can't write to /dev/null: $!";
      open STDERR, '&gt;&amp;STDOUT'  or die "Can't dup stdout: $!";
      setsid or die "Can't start a new session: $!";
  
      exec "/home/httpd/perl/external.pl" or die "Cannot execute exec: $!";
  }</code></pre>
<p>Notice that <code>exec()</code> never returns unless it fails to start the 
process. Therefore, you shouldn't put any code after exec()--it will be not 
executed in the case of success. Use <code>system()</code> or back-ticks instead 
if you want to continue doing other things in the process. But then you probably 
will want to terminate the process after the program has finished. So you will 
have to write:</p><pre><code>      system "/home/httpd/perl/external.pl" or die "Cannot execute system: $!";
      CORE::exit(0);</code></pre>
<p>Another important nuance is that we have to close all <code>STD*</code> 
streams in the forked process, even if the called program does that.</p>
<p>If the external program is written in Perl, then you may pass complicated data 
structures to it using one of the methods to serialize Perl data and then to 
restore it. The <code>Storable</code> and <code>FreezeThaw</code> modules come 
handy. Let's say that we have program <em>master.pl</em> calling program 
<em>slave.pl</em>:</p><pre><code>  master.pl
  ---------
  # we are within the C&lt;mod_perl&gt; code
  use Storable ();
  my @params = (foo =&gt; 1, bar =&gt; 2);
  my $params = Storable::freeze(\@params);
  exec "./slave.pl", $params or die "Cannot execute exec: $!";</code></pre><pre><code>  slave.pl
  --------
  #!/usr/bin/perl -w
  use Storable ();
  my @params = @ARGV ? @{ Storable::thaw(shift)||[] } : ();
  # do something</code></pre>
<p>As you can see, <em>master.pl</em> serializes the <code>@params</code> data 
structure with <code>Storable::freeze</code> and passes it to <em>slave.pl</em> 
as a single argument. <em>slave.pl</em> restores it with 
<code>Storable::thaw</code>, by shifting the first value of the 
<code>ARGV</code> array if available. The <code>FreezeThaw</code> module does a 
similar thing.</p>

<h3><a name="starting_a_short_running_external_program">Starting a Short-Running 
External Program</a></h3>
<p>Sometimes you need to call an external program and you cannot continue before 
this program completes its run and optionally returns some result. In this case, 
the fork solution doesn't help. But we have a few ways to execute this program. 
First using system():</p><pre><code>  system "perl -e 'print 5+5'"</code></pre>
<p>We believe that you will never call the Perl interperter for doing this 
simple calculation, but for the sake of a simple example it's good enough.</p>
<p>The problem with this approach is that we cannot get the results printed to 
<code>STDOUT</code>, and that's where back-ticks or <code>qx()</code> help. If you use either:</p><pre><code>  my $result = `perl -e 'print 5+5'`;</code></pre>
<p>or:</p><pre><code>  my $result = qx{perl -e 'print 5+5'};</code></pre>
<p>the whole output of the external program will be stored in the 
<code>$result</code> variable.</p>
<p>Of course, you can use other solutions, such as opening a pipe (<code>|</code> to 
the program) if you need to submit many arguments and more evolved solutions 
provided by other Perl modules like <code>IPC::Open2</code>, which allows to open 
a process for both reading and writing.</p>

<h3><a name="executing_system()_or_exec()_in_the_right_way">Executing 
<code>system()</code> or <code>exec()</code> in the Right Way</a></h3>
<p>The <code>exec()</code> and <code>system()</code> system calls behave 
identically in the way they spawn a program. For example, let's use 
<code>system()</code>. Consider the following code:</p><pre><code>  system("echo","Hi");</code></pre>
<p>Perl will use the first argument as a program to execute, find 
<code>/bin/echo</code> along the search path, invoke it directly and pass the 
<em>Hi</em> string as an argument.</p>
<p>Perl's <code>system()</code> is <strong>not</strong> the 
<code>system(3)</code> call (from the C-library). This is how the arguments to 
<code>system()</code> get interpreted. When there is a single argument to 
system(), it'll be checked for having shell metacharacters first (like 
<code>*</code>,<code>?</code>), and if there are any--Perl interpreter invokes a 
real shell program (/bin/sh&nbsp;-c on Unix platforms). If you pass a list of 
arguments to system(), then they will be not checked for metacharacters, but split 
into words if required and passed directly to the C-level <code>execvp()</code> 
system call, which is more efficient. That's a <em>very</em> nice optimization. 
In other words, only if you do:</p><pre><code>  system "sh -c 'echo *'"</code></pre>
<p>will the operating system actually <code>exec()</code> a copy of 
<code>/bin/sh</code> to parse your command. But even then, since <em>sh</em> is 
almost certainly already running somewhere, the system will notice that (via the 
disk inode reference) and replace your virtual memory page table with one 
pointing to the existing program code plus your data space, thus will not create 
this overhead.</p>



<h3><a name="references">References</a></h3>
<ul>
  <li>The <code>mod_perl</code> site's URL: <a 
  href="http://perl.apache.org/">http://perl.apache.org/</a> </li>
  
  <li><code>Apache-SubProcess</code> <a 
  href="http://search.cpan.org/search?dist=Apache-SubProcess">http://search.cpan.org/search?dist=Apache-SubProcess</a> </li>

  
  <li><code>Storable</code> <a 
  href="http://search.cpan.org/search?dist=Storable">http://search.cpan.org/search?dist=Storable</a> 

  </li></ul>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2002/12/">&laquo; December 2002</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2003/02/">February 2003 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
