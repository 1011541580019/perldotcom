<p> It's been nearly six months since the release of Perl 5.8.0 but
many people still haven't upgraded to it. We'll take a look at some of
the new features it provides and describe why you ought to investigate
them for yourself.
</p>
<h2><a name="unicode">Unicode</a></h2>

    <p>Perl 5.8 - at last! - properly supports Unicode. Handling
    Unicode data in Perl should now be much more reliable than in
    5.6.0 and 5.6.1. In fact, quoting the most excellent
    <a href="http://www.perldoc.com/perl5.8.0/pod/perluniintro.html">perluniintro.pod</a> which is suggested reading, '5.8 is the first
    recommended release for serious Unicode work'.</p>


    <p>The <a href="http://www.unicode.org/ucd/">Unicode Character
    Database</a> which ships with Perl has been upgraded to Unicode
    3.2.0, 5.6.1 had 3.0.1. Most UCD files are included with some
    omissions for space considerations.</p>

    <p>Perl's Unicode model is straightforward: strings can be
    eight-bit native bytes or strings of Unicode characters. The
    principle is that Perl tries to keep its data as eight-bit bytes
    for as long as possible. When Unicodeness cannot be avoided, the
    data is transparently upgraded to Unicode. Native eight-bit bytes
    are whatever the platform users (for example Latin-1), Unicode is
    typically stored as UTF-8.</p> 

    <p>Perl will do the right thing with regard to mixing Unicode and
    non-Unicode strings; all functions and operators will respect the
    UTF-8 flag. For example, it is now possible to use Unicode strings
    in hashes, correctly use them in regular expressions and
    transliterations. This has fully changed from 5.6 where you
    controlled Unicode support with a lexically scoped <a href="http://www.perldoc.com/perl5.6.1/lib/utf8.html"><code>utf8</code></a>
    pragma.</p>

<p> To fully use Unicode in Perl, we must now compile perl with
<code>perlio</code>, the new IO system written by Nick Ing-Simmons
that we will cover later on, together with the new <a href="http://search.cpan.org/author/DANKOGAI/Encode-1.84/Encode.pm">Encode
module</a> written by Dan Kogai. Together, these allow individual
filehandles to be set to bytes, Unicode or legacy encodings. Encode
also comes with <code>piconv</code> which is a perl implementation of
iconv and <code>enc2xs</code> which allows you to create your own
encodings to Encode, either from Unicode Character Mapping files or
from Tcl Encoding Files. From SADAHIRO Tomoyuki comes <a href="http://search.cpan.org/author/SADAHIRO/Unicode-Normalize-0.17/"><code>Unicode::Normalize</code></a>
and <a href="http://search.cpan.org/author/SADAHIRO/Unicode-Collate-0.23/"><code>Unicode::Collate</code></a>,
surprisingly used for normalization and collating.</p>

<h2>Perl threads</h2> 

<p>Just like 5.8 is the first recommended release for Unicode work, it
is also the first recommended release for threading work. Starting
with 5.6, Perl had two modes of threading,:one style called
<code>5005threading</code>, mainly because it was introduced with
5.005, and ithreads which is short for interpreter threads. Gurusamy
Sarathy introduced ithreads as a step forward from multiplicity to
support the psuedofork implementation on Win32. However in 5.6, there
was no way in controlling these threads from perl; this has now
changed with the introduction of two new modules in 5.8.</p> 

<p>The basic rule for this thread model is that all data is cloned
when a new thread is created, so no data is shared between threads. If
one wants to share data there is a <a href="http://www.perldoc.com/perl5.8.0/lib/threads/shared.html"><code>threads::shared</code>
module</a> and the new <code>: shared</code>; variable
attribute. Controlling the new threads are done using the <a href="http://www.perldoc.com/perl5.8.0/lib/threads.html"><code>threads</code></a>
module. More reading can be found in the respective modules and
<a href="http://www.perldoc.com/perl5.8.0/pod/perlthrtut.html">the Perl Thread Tutorial page</a></p>.

<h2>New IO</h2> 

<p>Perl can now rely on its own bugs instead of the bugs of your
underlying IO implementation! In perl 5.8 we are now using the PerlIO library,
which replaces both stdio and sfio. The new IO system allows filters
to be pushed/popped from a filehandle for doing all kinds of nifty
things. For example the Encode module, as mentioned earlier in
the Unicode discussion, uses PerlIO to do the magic character set
conversions at the IO level.</p> 

<p>Interested parties that want to create their own layers should look
at <a href="http://www.perldoc.com/perl5.8.0/pod/perlapio.html">the
library API</a>, <a href="http://www.perldoc.com/perl5.8.0/pod/perliol.html">the IO layer
API</a>, <a href="http://www.perldoc.com/perl5.8.0/lib/PerlIO.html">the PerlIO
module</a>, and <a href="http://www.perldoc.com/perl5.8.0/lib/PerlIO/via.html">the
PerlIO::via manpage</a>.</p>

<h2>Safe
signals</h2> 

<p>No more random segfaults caused by signals! We now have a signal
handler that just raises a flag and then dispatches the signal between
opcodes so you are free to do anything you feel like in a signal
handler (Since it isn't run at async time, it isn't really a signal
handler). This has potential for conflicts if you are embedding Perl
and rely on signals to do some particular behavior, but I suppose if
you really like having the chance of a random segfault on receiving a
signal, you can always compile perl with PERL_OLD_SIGNALS. This will, however,
not be threadsafe.</p>

<p>New and improved modules</p> 

<p>perl 5.8 comes with 54 new modules,
many of them are included of CPAN for various reasons. One goal has
been to make it easy for <a href="http://www.perldoc.com/perl5.8.0/lib/CPAN.html">CPAN.pm</a> to be selfhosting; this has meant including
libnet and a couple of other modules.</p>

<p>
 We have been working on testing
a lot so the <a href="http://www.perldoc.com/perl5.8.0/lib/Test/More.html"><code>Test::More</code></a> family of modules were natural to include.
Then there was a push to make perl more i18n friendly, so 5.8.0 includes
several i18n and l10n modules as well as the previously covered
Unicode modules. There is a bunch of modules that provide access to
internal functions like the PerlIO modules, threads module and sort,
the new module that provides a interface to the sort implementation
you are using. Finally we also thought it was time to include <a href="http://www.perldoc.com/perl5.8.0/lib/Storable.html"><code>Storable</code></a>
in the core.</p> 

<p>We also have a bunch of updated modules included: <a href="http://www.perldoc.com/perl5.8.0/lib/Cwd.html"><code>Cwd</code></a>
is now implemented in XS, giving us a nice speed boost. <a href="http://www.perldoc.com/perl5.8.0/lib/B/Deparse.html"><code>B::Deparse</code></a>
has been improved to the point it is actually useful. Maintenance work
on <a href="http://www.perldoc.com/perl5.8.0/lib/ExtUtils/MakeMaker.html"><code>
ExtUtils::MakeMaker</code></a> has made it more stable. Storable
supports Unicode hash keys and restricted hashes. <a href="http://www.perldoc.com/perl5.8.0/lib/Math/BigInt.html"><code>Math::BigInt</code></a>
and <a href="http://www.perldoc.com/perl5.8.0/lib/Math/BigFloat.html"><code>Math::BigFloat</code>
manpage</a> have been upgraded and bugfixed quite a lot, and they have
been complemented by a <a href="http://www.perldoc.com/perl5.8.0/lib//Math/BigRat.html"><code>Math::BigRat</code></a> module,
and the <a href="http://www.perldoc.com/perl5.8.0/lib/bigrat.html"><code>bigrat</code></a>, 
<a href="http://www.perldoc.com/perl5.8.0/lib/bigint.html"><code>bigint</code></a> and
<a href="http://www.perldoc.com/perl5.8.0/lib/bignum.html"><code>bignum</code></a> pragmata 
for lexical control of transparent bignumber support.</p>

<h2>Speed improvements</h2> 

<p>Even if this release includes a lot of new features, there are some
optimizations in there as well! We have changed sort to use mergesort,
which for me is rather surprising since I have been told since I was a
toddler to use quicksort. However the old behaviour can be controlled
using the <a href="http://www.perldoc.com/perl5.8.0/lib/sort.html"><code>sort</code></a>
module; we even have a mystery stable quicksort!</p>

<p>Once again we have changed the hashing algorithm to
something called One-At-A-Time, so all of you who depend on the order
of hashes, this is a good reason to fix your programs now!</p>

 <p>Finally, <code>map</code> has been made faster, as has
 <code>unshift</code>.</p>

<h2>Testing</h2>

 <p>We
hope this should be the most stable release of Perl to date, as an
extensive QA effort has been spearheaded by Michael Schwern which has
led to several benefits. We now have 6 times the amount of testcases,
testing a cleaner codebase with more documentation. The Perl Bug
database has been switched over to <a href="http://www.bestpractical.com/">Request Tracker</a>; we should thank
Richard Foley for his work on perlbugtron that has now been retired.
After several discussions on what a memory leak is, several memory
leaks and naughty accesses have been fixed. Tools used have been third
degree, purify, and the most excellent Open Source alternative,
<a href="http://developer.kde.org/~sewardj/">valgrind</a>.</p>

<h2>More numbers</h2> 

<p>Nicholas Clark, Hugo van der Sanden and Tels have done
some magic keeping integers as integers as long as possible, and when
finding bugs in vendors number-to-string and string-to-number they
have coded around these to increased precision. We should all be happy
that 42 is now 42 and not 42.000000000000001 - imagine what the aliens
would do if they found out!</p> 

<h2>Documentation</h2>

<p>I have
mentioned several documentations pages earlier, they are part of the
13 new POD files included in perl; in addition to this, all README.os
files have been translated into pod. Interesting to note are several
new tutorials including <a href="http://www.perldoc.com/perl5.8.0/pod/perlretut.html">a regular expressions tutorial</a>, <a href="http://www.perldoc.com/perl5.8.0/pod/perlpacktut.html">a tutorial on pack and unpack</a>,
<a href="http://www.perldoc.com/perl5.8.0/pod/perldebtut.html">a debugging tutorial</a>, <a href="http://www.perldoc.com/perl5.8.0/pod/perlnewmod.html">a module creation tutorial</a>, and <a href="http://www.perldoc.com/perl5.8.0/pod/perlintro.html">'a gentle introduction to
perl'</a>. There is also a brand new 
<a href="http://www.perldoc.com/perl5.8.0/pod/perlpodspec.html">POD format specification</a>
written by Sean M. Burke.</p>

<h2>Deprecations</h2> 

<p>Several deprecations have occurred in this release of Perl. In
future versions of Perl, 5005threads will be gone and replaced by
ithreads. Pseudo-hashes will be killed but the <a href="http://www.perldoc.com/perl5.8.0/lib/fields.html">fields</a> pragma
will work using restricted hashes; suidperl which, despite everything,
isn't safe and the bare <code>package;</code> directive which had unclear semantics.</p> 

<p>A few things have been removed and forbidden: blessing a refence into
another ref is one; self-tying of arrays and hashes led to some weird
bugs and have been disabled, as they touched some rarely tested
codepaths. The <code>[[.c.]]</code> and <code>[[=c=]]</code> character classes are also
forbidden because they might be used for future extensions. Several
scripts that were outdated have been removed and the upper case
comparison operators have also got the axe.</p> 

<h2>The war of the platforms</h2> 

<p>Perl 5.8 works on several new platforms and the EBDIC
platforms were regained. However, sadly we lost Amiga so any volunteers that
want to make the Amiga port work again are very welcome.</p> 

<h2>Odd and Ends</h2> <p>
There is a long list of new small changes in perl 5.8,
the biggest of these small changes are restricted hashes which can be
used from the new <a href="http://www.perldoc.com/perl5.8.0/lib/Hash/Util.html"><code>Hash::Util</code></a>
module and lets you lock down the keys in a specific hash, this will
possibly be used as a replacement for psuedohashes for the
<em>fields</em> pragma.</p>
<p> For the full and gory details, check out the whole <a href="http://www.perldoc.com/perl5.8.0/pod/perldelta.html">Perl delta documentation</a>.</p>
