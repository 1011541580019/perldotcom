<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/2003/09/17/perlcookbook.html">
<dc:title>Cooking with Perl, Part 3</dc:title>
<dc:description> Editor&apos;s note: In this third and final batch of recipes excerpted from Perl Cookbook, you&apos;ll find solutions and code examples for extracting HTML table data, templating with HTML::Mason, and making simple changes to elements or text. Sample Recipe: Extracting...</dc:description>
<dc:creator>perl.com</dc:creator>
<dc:date>2003-09-17T00:00:00-08:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    
    <link rel="prev bookmark" href="/pub/2003/09/10/bioinformatics.html" title="A Chromosome at a Time with Perl, Part 1" />
    <link rel="next bookmark" href="/pub/2003/09/p6pdigest/20030921.html" title="This week on Perl 6, week ending 2003-09-21" />
    
    
    <title>Cooking with Perl, Part 3 - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1190" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Cooking with Perl, Part 3</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">perl.com</span> on <abbr class="published" title="2003-09-17T00:00:00-08:00">September 17, 2003 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p><i>Editor's note: In this third and final batch of recipes excerpted from <a href="http://www.oreilly.com/catalog/perlckbk2/index.html?CMP=IL7015">Perl Cookbook</a>, you'll find solutions and code examples for extracting HTML table data, templating with HTML::Mason, and making simple changes to elements or text. </i></p>

<h3>Sample Recipe: Extracting Table Data</h3>

<h4>Problem</h4>


<p>You have data in an HTML table, and you would like to turn that 
into a Perl data structure. For example, you want to monitor changes to an 
author's CPAN module list.</p>

<h4>Solution</h4>

<p>Use the HTML::TableContentParser module from CPAN:</p>

<pre><code>use HTML::TableContentParser;
&nbsp;
$tcp = HTML::TableContentParser-&gt;new;
$tables = $tcp-&gt;parse($HTML);
&nbsp;
foreach $table (@$tables) {
  @headers = map { $_-&gt;{data} } @{ $table-&gt;{headers} };
  # attributes of table tag available as keys in hash
  $table_width = $table-&gt;{width};
&nbsp;
  foreach $row (@{ $tables-&gt;{rows} }) {
    # attributes of tr tag available as keys in hash
    foreach $col (@{ $row-&gt;{cols} }) {
      # attributes of td tag available as keys in hash
      $data = $col-&gt;{data};
    }
  }
}</code>
</pre>

<h4>Discussion</h4>

<csperl file="grab" domain="on" record="b/941" template="b/article_sidebar.view">

<p>The HTML::TableContentParser module converts all tables in the 
HTML document into a Perl data structure. As with HTML tables, there are three 
layers of nesting in the data structure: the table, the row, and the data in 
that row.</p>

<p>Each table, row, and data tag is represented as a hash reference. 
The hash keys correspond to attributes of the tag that defined that table, row, 
or cell. In addition, the value for a special key gives the contents of the 
table, row, or cell. In a table, the value for the <code>rows</code> key is a reference to an array of rows. In a row, the 
<code>cols</code> key points to an array of cells. In a cell, the 
<code>data</code> key holds the HTML contents of the data tag.</p>

<p>For example, take the following table:</p>

<pre><code>&lt;table width="100%" bgcolor="#ffffff"&gt;
  &lt;tr&gt;
    &lt;td&gt;Larry &amp;amp; Gloria&lt;/td&gt;
    &lt;td&gt;Mountain View&lt;/td&gt;
    &lt;td&gt;California&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;b&gt;Tom&lt;/b&gt;&lt;/td&gt;
    &lt;td&gt;Boulder&lt;/td&gt;
    &lt;td&gt;Colorado&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Nathan &amp;amp; Jenine&lt;/td&gt;
    &lt;td&gt;Fort Collins&lt;/td&gt;
    &lt;td&gt;Colorado&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;</code>
</pre>

<p>The <code>parse</code> method returns this data 
structure:</p>

<pre><code>[
  {
    'width' =&gt; '100%',
    'bgcolor' =&gt; '#ffffff',
    'rows' =&gt; [
               {
                'cells' =&gt; [
                            { 'data' =&gt; 'Larry &amp;amp; Gloria' },
                            { 'data' =&gt; 'Mountain View' },
                            { 'data' =&gt; 'California' },
                           ],
                'data' =&gt; "\n      "
               },
               {
                'cells' =&gt; [
                            { 'data' =&gt; '&lt;b&gt;Tom&lt;/b&gt;' },
                            { 'data' =&gt; 'Boulder' },
                            { 'data' =&gt; 'Colorado' },
                           ],
                'data' =&gt; "\n      "
               },
               {
                'cells' =&gt; [
                            { 'data' =&gt; 'Nathan &amp;amp; Jenine' },
                            { 'data' =&gt; 'Fort Collins' },
                            { 'data' =&gt; 'Colorado' },
                           ],
                'data' =&gt; "\n      "
               }
              ]
  }
]</code>
</pre>

<p>The data tags still contain tags and entities. If you don't want 
the tags and entities, remove them by hand using techniques from "Extracting or 
Removing HTML Tags."</p>

<!-- sidebar begins -->
<table width="220" border="0" cellspacing="8" cellpadding="4" align="right">
<tr>
<td width="220" valign="top" bgcolor="#efefef">
<div class="secondary">
<h4>Previous Articles in this Series</h4>
<p class="secondary">
&bull; <a href="/pub/a/2003/08/21/perlcookbook.html">Cooking with Perl</a><br />
&bull; <a href="/pub/a/2003/09/03/perlcookbook.html">Cooking with Perl, Part 2</a>
</p>
</div>
</td></tr></table>
<!-- sidebar ends -->

<p><a href="http://admin.oreillynet.com/catalog/perlckbk2/excerpts/ch20.html#77026">Example 
20-11</a> fetches a particular CPAN author's page and displays in plain text the 
modules they own. You could use this as part of a system that notifies you when 
your favorite CPAN authors do something new.</p>

<p><b>Example 20-11:</a></b> <b>Dump modules for a particular CPAN author </b></p>

<pre><code>  #!/usr/bin/perl -w
  # dump-cpan-modules-for-author - display modules a CPAN author owns
  use LWP::Simple;
  use URI;
  use HTML::TableContentParser;
  use HTML::Entities;
  use strict;
  our $URL = shift || 'http://search.cpan.org/author/TOMC/';
  my $tables = get_tables($URL);
  my $modules = $tables-&gt;[4];    # 5th table holds module data
  foreach my $r (@{ $modules-&gt;{rows} }) {
    my ($module_name, $module_link, $status, $description) = 
        parse_module_row($r, $URL);
    print "$module_name &lt;$module_link&gt;\n\t$status\n\t$description\n\n";
  } 
  sub get_tables {
    my $URL = shift;
    my $page = get($URL);
    my $tcp = new HTML::TableContentParser;
    return $tcp-&gt;parse($page);
  }
  sub parse_module_row {
    my ($row, $URL) = @_;
    my ($module_html, $module_link, $module_name, $status, $description);
    # extract cells
    $module_html = $row-&gt;{cells}[0]{data};  # link and name in HTML
    $status      = $row-&gt;{cells}[1]{data};  # status string and link
    $description = $row-&gt;{cells}[2]{data};  # description only
    $status =~ s{&lt;.*?&gt;}{  }g; # naive link removal, works on this simple HTML
    # separate module link and name from html
    ($module_link, $module_name) = $module_html =~ m{href="(.*?)".*?&gt;(.*)&lt;}i;
    $module_link = URI-&gt;new_abs($module_link, $URL); # resolve relative links
    # clean up entities and tags
    decode_entities($module_name);
    decode_entities($description);
    return ($module_name, $module_link, $status, $description);
  }</code>
</pre>

<h4>See Also</h4>

<p>The documentation for the CPAN module HTML::TableContentParser; <a href="http://search.cpan.org/">http://search.cpan.org/</a></p>















<h3>Sample Recipe: Templating with HTML::Mason</h3>

<h3>Problem</h3>

<p>You want to separate presentation (HTML formatting) from logic 
(Perl code) in your program. Your web site has a lot of components with only 
slight variations between them. You'd like to abstract out common elements and 
build your pages from templates without having a lot of "if I'm in this page, 
then print this; else if I'm in some other page . . . " conditional statements 
in a single master template.</p>

<h4>Solution</h4>

<p>Use HTML::Mason components and inheritance.</p>

<h4>Discussion</h4>

<p>HTML::Mason (also simply called Mason) offers the power of Perl in 
templates. The basic unit of a web site built with Mason is the component--a 
file that produces output. The file can be HTML, Perl, or a mixture of both. 
Components can take arguments and execute arbitrary Perl code. Mason has many 
features, documented at <a href="http://masonhq.com/">http://masonhq.com/</a> 
and in <cite>Embedding Perl in HTML with Mason</cite> by Dave 
Rolsky and Ken Williams (O'Reilly; online at <a href="http://masonbook.com/">http://masonbook.com/</a>).</p>

<p>Mason works equally well with CGI, mod_perl, and non-web programs. 
For the purposes of this recipe, however, we look at how to use it with 
mod_perl. The rest of this recipe contains a few demonstrations to give you a 
feel for what you can do with Mason and how your site will be constructed. There 
are more tricks, traps, and techniques for everything we discuss, though, so be 
sure to visit the web site and read the book for the full story.</p>

<h5>Configuration</h5>

<p>Install the HTML-Mason distribution from CPAN and add the 
following to your <em>httpd.conf</em>:</p>

<pre><code>PerlModule HTML::Mason::ApacheHandler
&lt;Location /mason&gt;
  SetHandler perl-script
  PerlHandler HTML::Mason::ApacheHandler
  DefaultType text/html
&lt;/Location&gt;</code>
</pre>

<p>This tells mod_perl that every URL that starts with <code>/mason</code> is handled by Mason. So if you request <code>/mason/hello.html</code>, the file <em>mason/hello.html</em> in your document directory will be compiled 
and executed as a Mason component. The DefaultType directive lets you omit the 
<em>.html</em> from component names.</p>
<p>Next create a directory for Mason to cache the compiled components 
in. Mason does this to speed up execution.</p>

<pre><code>cd $SERVER_ROOT
mkdir mason</code>
</pre>

<p>Then make a <em>mason</em> directory for components 
to live in:</p><pre><code>cd $DOCUMENT_ROOT
mkdir mason</code>
</pre>

<p>Now you're ready for "Hello, World". Put this in <em>mason/hello</em>:</p>

<pre><code>Hello, &lt;% ("World", "Puny Human")[rand 2] %&gt;</code>
</pre>

<p>Restart Apache and load up the <i>mason/hello</i> page. If you 
reload it, you should see "Hello, World" and "Hello, Puny Human" randomly. If 
not, look at the Mason FAQ (<a href="http://www.masonhq.com/docs/faq/">http://www.masonhq.com/docs/faq/</a>), 
which answers most commonly encountered problems.</p>

<h5>Basic Mason syntax</h5>

<p>There are four types of new markup in Mason components: 
substitutions, Perl code, component calls, and block tags. You saw a 
substitution in the "Hello World" example: <code>&lt;% ... 
%&gt;</code> evaluates the contents as Perl code and inserts the result into the 
surrounding text.</p>

<p>Perl code is marked with a <code>%</code> at the 
start of the line:</p>

<pre><code>% $now = localtime;   # embedded Perl
This page was generated on &lt;% $now %&gt;.</code>
</pre>

<p>Because substitutions can be almost any Perl code you like, this 
could have been written more simply as:</p>

<pre><code>This page was generated on &lt;% scalar localtime %&gt;.</code>
</pre>

<p>If either of these variations were saved in <em>footer.mas</em>, you could include it simply by saying:</p>

<pre><code>&lt;&amp; footer.mas &amp;&gt;</code>
</pre>

<p>This is an example of a component call--Mason runs the component 
and inserts its result into the document that made the call.</p>

<p>Block tags define different regions of your component. <code>&lt;%perl&gt; ... &lt;/%perl&gt;</code> identifies Perl code. 
While <code>%</code> at the start of a line indicates that just 
that line is Perl code, you can have any number of lines in a <code>&lt;%perl&gt;</code> block.</p>

<p>A <code>&lt;%init&gt; ... &lt;/%init&gt;</code> 
block is like an INIT block in Perl. The code in the block is executed before 
the main body of code. It lets you store definitions, initialization, database 
connections, etc. at the bottom of your component, where they're out of the way 
of the main logic.</p>

<p>The <code>&lt;%args&gt; ... &lt;/%args&gt;</code> 
block lets you define arguments to your component, optionally with default 
values. For example, here's <em>greet.mas</em>:</p>

<pre><code>&lt;%args&gt;
   $name =&gt; "Larry"
   $town =&gt; "Mountain View"
&lt;/%args&gt;
Hello, &lt;% $name %&gt;.  How's life in &lt;% $town %&gt;?</code>
</pre>

<p>Calling it with:</p>

<pre><code>&lt;&amp; greet.mas &amp;&gt;</code>
</pre>

<p>emits:</p>

<pre><code>Hello, Larry.  How's life in Mountain View?</code>
</pre>

<p>You can provide options on the component call:</p>

<pre><code>&lt;&amp; greet.mas, name =&gt; "Nat", town =&gt; "Fort Collins" &amp;&gt;</code>
</pre>

<p>That emits:</p>

<pre><code>Hello, Nat.  How's life in Fort Collins?</code>
</pre>

<p>Because there are default values, you can supply only some of the 
arguments:</p>

<pre><code>&lt;&amp; greet.mas, name =&gt; "Bob" &amp;&gt;</code>
</pre>

<p>That emits:</p>

<pre><code>Hello, Bob.  How's life in Mountain View?</code>
</pre>

<p>Arguments are also how Mason components access form parameters. 
Take this form:</p>

<pre><code>&lt;form action="compliment"&gt;
  How old are you?  &lt;input type="text" name="age"&gt; &lt;br /&gt;
  &lt;input type="submit"&gt;
&lt;/form&gt;</code>
</pre>

<p>Here's a <em>compliment</em> component that could 
take that parameter:</p>

<pre><code>&lt;%args&gt;
  $age
&lt;/%args&gt;
Hi.  Are you really &lt;% $age %&gt;?  You don't look it!</code>
</pre>

<h5>Objects</h5>

<p>All Mason components have access to a <code>$m</code> variable, which contains an HTML::Mason::Request object. 
Methods on this object give access to Mason features. For example, you can 
redirect with:</p>

<pre><code>$m-&gt;redirect($URL);</code>
</pre>

<p>The <code>$r</code> variable is the mod_perl request 
object, so you have access to the information and functions of Apache from your 
Mason handlers. For example, you can discover the client's IP address with:</p>

<pre><code>$ip = $r-&gt;connection-&gt;remote_ip;</code>
</pre>

<h5>Autohandlers</h5>

<p>When a page is requested through Mason, Mason can do more than 
simply execute the code in that page. Mason inspects each directory between the 
component root and the requested page, looking for components called <em>autohandler</em>. This forms a <em>wrapping 
chain</em>, with the top-level autohandler at the start of the chain and the 
requested page at the end. Mason then executes the code at the start of the 
chain. Each autohandler can say "insert the output of the next component in the 
chain here."</p>

<p>Imagine a newspaper site. Some parts don't change, regardless of 
which article you're looking at: the banner at the top, the random selection of 
ads, the list of sections down the lefthand side. However, the actual article 
text varies from article to article. Implement this in Mason with a directory 
structure like this:</p>

<pre><code>/sports
/sports/autohandler
/sports/story1
/sports/story2
/sports/story3</code>
</pre>

<p>The individual story files contain only the text of each story. 
The autohandler builds the page (the banner, the ads, the navigation bar), and 
when it wants to insert the content of the story, it says:</p>

<pre><code>% $m-&gt;call_next;</code>
</pre>

<p>This tells Mason to call the next component in the chain (the 
story) and insert its output here.</p>

<p>The technique of having a chain of components is called <em>inheritance</em>, and autohandlers aren't the only way to do it. 
In a component, you can designate a parent with:</p>

<pre><code>&lt;%flags&gt;
  inherit = 'parent.mas'
&lt;/%flags&gt;</code>
</pre>

<p>This lets you have different types of content in the one 
directory, and each contained component gets to identify its surrounding page 
(its parent).</p>

<h5>Dhandlers</h5>

<p>Sometimes it's nice to provide the illusion of a directory full of 
pages, when in reality they are all dynamically generated. For example, stories 
kept in a database could be accessed through URLs like:</p

><pre><code>/sports/1
/sports/2
/sports/3</code>
</pre>

<p>The Mason way to dynamically generate the pages at these URLs is 
with a component called <em>dhandler</em> in the <em>sports</em> directory. The <em>dhandler</em> 
component accesses the name of the missing page (<em>123</em> in 
this case) by calling:</p><pre><code>$m-&gt;dhandler_arg</code>
</pre>

<p>You could then use this to retrieve the story from the database 
and insert it into a page template.</p>

<h4>See Also</h4>

<p>Recipe 15.11 in <cite>mod_perl Developer's 
Cookbook</cite>; <cite>Embedding Perl in HTML with Mason</cite>; 
<a href="http://www.masonhq.com/">http://www.masonhq.com/</a> and <a href="http://www.masonbook.com/">http://www.masonbook.com/</a></p>















<h3>Sample Recipe: Making Simple Changes to Elements or Text</h3>

<h3>Problem</h3>

<p>You want to filter some XML. For example, you want to make 
substitutions in the body of a document, or add a price to every book described 
in an XML document, or you want to change <code>&lt;book 
id="1"&gt;</code> to <code>&lt;book&gt; 
&lt;id&gt;1&lt;/id&gt;</code>.</p>

<h4>Solution</h4>

<p>Use the XML::SAX::Machines module from CPAN:</p>

<pre><code>#!/usr/bin/perl -w
&nbsp;
use MySAXFilter1;
use MySAXFilter2;
use XML::SAX::ParserFactory;
use XML::SAX::Machines qw(Pipeline);
&nbsp;
my $machine = Pipeline(MySAXFilter1 =&gt; MySAXFilter2); # or more
$machine-&gt;parse_uri($FILENAME);</code>
</pre>

<p>Write a handler, inheriting from XML::SAX::Base as in "Parsing XML 
into SAX Events," then whenever you need a SAX event, call the appropriate 
handler in your superclass. For example:</p>

<pre><code>$self-&gt;SUPER::start_element($tag_struct);</code>
</pre>

<h4>Discussion</h4>

<p>A SAX filter accepts SAX events and triggers new ones. The 
XML::SAX::Base module detects whether your handler object is called as a filter. 
If so, the XML::SAX::Base methods pass the SAX events onto the next filter in 
the chain. If your handler object is not called as a filter, then the 
XML::SAX::Base methods consume events but do not emit them. This makes it almost 
as simple to write events as it is to consume them.</p>

<p>The XML::SAX::Machines module chains the filters for you. Import 
its <code>Pipeline</code> function, then say:</p>

<pre><code>my $machine = Pipeline(Filter1 =&gt; Filter2 =&gt; Filter3 =&gt; Filter4);
$machine-&gt;parse_uri($FILENAME);</code>
</pre>

<p>SAX events triggered by parsing the XML file go to Filter1, which 
sends possibly different events to Filter2, which in turn sends events to 
Filter3, and so on to Filter4. The last filter should print or otherwise do 
something with the incoming SAX events. If you pass a reference to a typeglob, 
XML::SAX::Machines writes the XML to the filehandle in that typeglob.</p>

<p><a href="http://admin.oreillynet.com/catalog/perlckbk2/excerpts/ch22.html#45625">Example 
22-5</a> shows a filter that turns the <code>id</code> attribute 
in <code>book</code> elements from the XML document in Example 
22-1 into a new <code>id</code> element. For example, <code>&lt;book id="1"&gt;</code> becomes <code>&lt;book&gt;&lt;id&gt;1&lt;/id&gt;</code>.</p>

<p><b><a name="45625">Example 22-5:</a></b> <b>filters-rewriteids </b></p>

<pre><code>package RewriteIDs;
# RewriteIDs.pm -- turns "id" attributes into elements
&nbsp;
use base qw(XML::SAX::Base);
&nbsp;
my $ID_ATTRIB = "{  }id";   # the attribute hash entry we're interested in
&nbsp;
sub start_element {
    my ($self, $data) = @_;
&nbsp;
    if ($data-&gt;{Name} eq 'book') {
        my $id = $data-&gt;{Attributes}{$ID_ATTRIB}{Value};
        delete $data-&gt;{Attributes}{$ID_ATTRIB};
        $self-&gt;SUPER::start_element($data);
&nbsp;
        # make new element parameter data structure for the &lt;id&gt; tag
        my $id_node = {  };
        %$id_node = %$self;
        $id_node-&gt;{Name} = 'id';     # more complex if namespaces involved
        $id_node-&gt;{Attributes} = {  };
&nbsp;
        # build the &lt;id&gt;$id&lt;/id&gt;
        $self-&gt;SUPER::start_element($id_node);
        $self-&gt;SUPER::characters({ Data =&gt; $id });
        $self-&gt;SUPER::end_element($id_node);
    } else {
        $self-&gt;SUPER::start_element($data);
    }
}
&nbsp;
1;</code>
</pre>

<p><a href="http://admin.oreillynet.com/catalog/perlckbk2/excerpts/ch22.html#15387">Example 
22-6</a> is the stub that uses XML::SAX::Machines to create the pipeline for 
processing <em>books.xml</em> and print the altered XML.</p>

<p><b><a name="15387">Example 22-6:</a></b> <b>filters-rewriteprog </b></p>

<pre><code>#!/usr/bin/perl -w
# rewrite-ids -- call RewriteIDs SAX filter to turn id attrs into elements
&nbsp;
use RewriteIDs;
use XML::SAX::Machines qw(:all);
&nbsp;
my $machine = Pipeline(RewriteIDs =&gt; *STDOUT);
$machine-&gt;parse_uri("books.xml");</code>
</pre>

<p>The output of <a href="http://admin.oreillynet.com/catalog/perlckbk2/excerpts/ch22.html#15387">Example 
22-6</a> is as follows (truncated for brevity):</p>

<pre><code>&lt;book&gt;&lt;id&gt;1&lt;/id&gt;
    &lt;title&gt;Programming Perl&lt;/title&gt;
 ...
&lt;book&gt;&lt;id&gt;2&lt;/id&gt;
    &lt;title&gt;Perl &amp;amp; LWP&lt;/title&gt;
 ...</code>
</pre>

<p>To save the XML to the file <em>new-books.xml</em>, 
use the XML::SAX::Writer module:</p>

<pre><code>#!/usr/bin/perl -w
&nbsp;
use RewriteIDs;
use XML::SAX::Machines qw(:all);
use XML::SAX::Writer;
&nbsp;
my $writer = XML::SAX::Writer-&gt;new(Output =&gt; "new-books.xml");
my $machine = Pipeline(RewriteIDs =&gt; $writer);
$machine-&gt;parse_uri("books.xml");</code>
</pre>

<p>You can also pass a scalar reference as the <code>Output</code> parameter to have the XML appended to the scalar; as 
an array reference to have the XML appended to the array, one array element per 
SAX event; or as a filehandle to have the XML printed to that filehandle.</p>

<h4>See Also</h4>

<p>The documentation for the modules XML::SAX::Machines and 
XML::SAX::Writer</p>
                                    </div>


                                </div>
                                <div class="asset-footer">


                                    <div class="entry-tags">
                                        <h4>Tags<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=extracting%20table%20data&amp;limit=20';return false;" rel="tag">extracting table data</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=making%20simple%20changes%20to%20elements%20or%20text&amp;limit=20';return false;" rel="tag">making simple changes to elements or text</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=Nathan%20Torkington&amp;limit=20';return false;" rel="tag">Nathan Torkington</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=perl&amp;limit=20';return false;" rel="tag">perl</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=Perl%20Cookbook&amp;limit=20';return false;" rel="tag">Perl Cookbook</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=templating%20with%20HTML%3A%3AMason&amp;limit=20';return false;" rel="tag">templating with HTML::Mason</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=Tom%20Christiansen&amp;limit=20';return false;" rel="tag">Tom Christiansen</a></li>
                                        </ul>
                                    </div>

                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
