<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.02" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
    
    <link rel="prev bookmark" href="/pub/2003/06/20030615.html" title="This week on Perl 6, week ending 2003-06-15" />
    <link rel="next bookmark" href="/pub/2003/06/20030622.html" title="This week on Perl 6, week ending 2003-06-22" />
    
    
    <title>Hidden Treasures of the Perl Core, part II - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <div id="top_advert"> 
<!-- Put any landscape advert in here -->
<a href="http://www.perlfoundation.org/" target="_new">
<img src="/i/tpf_banner.png" width="468" height="60" /></a>
        </div> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description"></div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1138" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Hidden Treasures of the Perl Core, part II</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Casey West</span> on <abbr class="published" title="2003-06-19T00:00:00-08:00">June 19, 2003 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>In the <a href="/pub/a/2003/05/29/treasures.html">previous hidden
treasures article</a>, we looked at some easy-to-use (but not well-known) modules in
the Perl Core. In this article, we dig deeper to uncover some of the truly precious
and unique gems in the Perl Core.</p>

<h2><a name="constant"><code>constant</code></a></h2>

<p>The <code>constant</code> pragma is not new or unknown, but it is a nice feature
enhancement.  Many people have used constant. Here is a standard example
of using the constant for &pi;.</p>

<pre><code>use constant PI =&gt; 22/7;</code></pre>

<p>When <code>constant</code>s are used in programs or modules, they are often used in a
set.  Older versions of Perl shipped with a <code>constant</code> pragma that required
a high level of work to produce a set.</p>

<pre><code>        use constant SUNDAY  =&gt; 0;
        use constant MONDAY  =&gt; 1;
        use constnat TUESDAY =&gt; 2;</code></pre>

<p>Wow, that's a lot of work!  I've already given up on my program, not to
mention the syntax error in the declaration of <code>TUESDAY</code>.  Now let's
try this again using the multiple declaration syntax, new to the
<code>constant</code> pragma for Perl 5.8.0.</p>

<pre><code>        use constant {
                SUNDAY    =&gt; 0,
                MONDAY    =&gt; 1,
                TUESDAY   =&gt; 2,
                WEDNESDAY =&gt; 3,
                THURSDAY  =&gt; 4,
                FRIDAY    =&gt; 5,
                SATURDAY  =&gt; 6,
        };</code></pre>
		
<p>The only warning here is that this syntax is new to Perl 5.8.0.  If you
intend to distribute a program using multiple constant declarations,
then remember the limitations of the program.  You may want to specify what
version of Perl is required for your program to work.</p>

<pre><code>        use 5.8.0;</code></pre>

<p>Perl will throw a fatal error if the version is anything less than
<code>5.8.0</code>.</p>

<h2><a name="attribute::handlers"><code>Attribute::Handlers</code></a></h2>

<p>This module allows us to play with Perl's subroutine attribute syntax
by defining our attributes.  This is a powerful module with a
rich feature set.  Here I'll give you an example of writing a minimal
debugger using subroutine attributes.</p>

<p>First, we need to create an attribute.  An attribute is any subroutine
that has an attribute of <code>:ATTR</code>.  Setting up our <code>debug</code> attribute
is easy.</p>

<pre><code>        use Attribute::Handlers;</code></pre>
<pre><code>        sub debug :ATTR {
                my (@args) = @_;
                warn &quot;DEBUG: @args\n&quot;;
        }</code></pre>
		
<p>Now we have a simple debug attribute named <code>:debug</code>.   Using
our attribute is also easy.</p>

<pre><code>        sub table :debug {
                # ...
        }
        table(%data);
        table(%other_data);</code></pre>

<p>Now, since attributes are compiled just before runtime, in the <code>CHECK</code>
phase, our debugging output will only be sent to <code>STDERR</code> once.  For the
code above, we might get output like this:</p>

<pre><code>        DEBUG: main GLOB(0x523d8) CODE(0x2e758) debug  CHECK
           Casey  Dad
        Chastity  Mom
         Evelina  Kid
        Coffee  Oily
          Cola  Fizzy</code></pre>
		  
<p>That debug string represents some of the information we get in an attribute
subroutine.  The first argument is the name of the package the attribute
was declared in.  Next is a reference to the symbol table entry for the
subroutine, followed by a reference to the subroutine itself.  Next comes
the name of the attribute, followed by any data associated with the attribute
(none in this case).  Finally, the name of the phase that invoked the handler
passed.</p>

<p>At this point, our debugging attribute isn't useful, but the parameters
we are given to work with are promising.  We can use them to invoke
debugging output each time the subroutine is called.  Put on your hard hat,
this is where things get interesting.</p>

<p>First, let us take a look at how we want to debug our subroutine.  I think we'd
like different levels of debugging output.  At the lowest level (<code>1</code>), the name
of the subroutine being invoked should be sent to <code>STDERR</code>.  At the next
level (<code>2</code>), it would be nice to be notified of entry and exit of the subroutine. Going further (level <code>3</code>), we might want to see the arguments passed to the
subroutine.  Even more detail can be done, but we'll save that for later and
stop at three debug levels.</p>

<p>In order to do this voodoo, we need to replace our subroutine with one doing
the debugging for us.  The subroutine doing the debugging must then invoke
our original code with the parameters passed to it, and return the proper output
from it.  Here is the implementation for debug level one (<code>1</code>).</p>

<pre><code>        use Attribute::Handlers;
        use constant {
                PKG    =&gt; 0,
                SYMBOL =&gt; 1,
                CODE   =&gt; 2,
                ATTR   =&gt; 3,
                DATA   =&gt; 4,
                PHASE  =&gt; 5,
        };
        sub debug :ATTR {
                my ($symbol, $code, $level) = @_[SYMBOL, CODE, DATA];
                $level ||= 1;
                
                my $name = join '::', *{$symbol}{PACKAGE}, *{$symbol}{NAME};
                
                no warnings 'redefine';
                *{$symbol} = sub {
                        warn &quot;DEBUG: entering $name\n&quot;;
                        return $code-&gt;(@_);
                };
        }
        sub table :debug {
                # ...
        }
        table(%data);
        table(%other_data);</code></pre>

<p>There are some sticky bits in the debug subroutine that I need to explain
in more detail.</p>

<pre><code>        my $name = join '::', *{$symbol}{PACKAGE}, *{$symbol}{NAME};</code></pre>

<p>This line is used to find the name and package of the subroutine we're debugging.
We do the lookups from the symbol table, using the reference to the symbol that
our attribute is given.</p>

<pre><code>        no warnings 'redefine';</code></pre>

<p>Here we turn off warnings about redefining a subroutine, because we're going
to redefine a subroutine on purpose.</p>

<pre><code>        *{$symbol} = sub { ... };</code></pre>

<p>This construct simply replaces the code section in the symbol table with this
anonymous subroutine (which is a code reference).</p>

<p>In this example, we set the default log level to one (<code>1</code>), set up some helper variables, and replace our <code>table()</code> subroutine with a debugging closure.  I
call the anonymous subroutine a closure because we are reusing some variables
that are defined in the <code>debug()</code> subroutine.  Closures are explained in greater
detail in <em>perlref</em> (<code>perldoc perlref</code> from the command line).</p>
<p>To set the debug level for a subroutine, just a number the <code>:debug</code> attribute.</p>

<pre><code>        sub table :debug(1) {
                # ...
        }</code></pre>

<p>The output looks something like this:</p>

<pre><code>        DEBUG: entering main::table
           Casey  Dad
        Chastity  Mom
         Evelina  Kid
        DEBUG: entering main::table
        Coffee  Oily
          Cola  Fizzy</code></pre>
		  
<p>Creating debug level two (<code>2</code>) is pretty easy from here.  Time stamps will
also be added to the output, which are useful for calculating how long your
subroutine takes to run.</p>

<pre><code>        *{$symbol} = sub {
                warn sprintf &quot;DEBUG[%s]: entering %s\n&quot;,
                        scalar(localtime), $name;
                my @output = $code-&gt;(@_);
                if ( $level &gt;= 2 ) {
                        warn sprintf &quot;DEBUG[%s]: leaving %s\n&quot;,
                                scalar(localtime), $name;
                }
                return @output;
        };</code></pre>
		
<p>In this example, we use <code>sprintf</code> to make out debugging statements a little
more readable as complexity grows.  This time, we cannot return directly from
the original code reference.  Instead, we have to capture the output and return
it at the end of the routine.  When the <code>table()</code> subroutine defines its debug
level as <code>:debug(2)</code> the output is thus.</p>

<pre><code>        DEBUG[Wed Jun 18 12:18:44 2003]: entering main::table
           Casey  Dad
        Chastity  Mom
         Evelina  Kid
        DEBUG[Wed Jun 18 12:18:44 2003]: leaving main::table
        DEBUG[Wed Jun 18 12:18:44 2003]: entering main::table
        Coffee  Oily
          Cola  Fizzy
        DEBUG[Wed Jun 18 12:18:44 2003]: leaving main::table</code></pre>
		
<p>Finally, debug level three (<code>3</code>) should also print the arguments passed
to the subroutine.  This is a simple modification to the first debugging
statement.</p>

<pre><code>        warn sprintf &quot;DEBUG[%s]: entering %s(%s)\n&quot;,
                scalar(localtime), $name, ($level &gt;= 3 ? &quot;@_&quot; : '' );</code></pre>

<p>The resulting output.</p>

<pre><code>        DEBUG[Wed Jun 18 12:21:06 2003]: entering main::table(Chastity Mom Casey Dad Evelina Kid)
           Casey  Dad
        Chastity  Mom
         Evelina  Kid
        DEBUG[Wed Jun 18 12:21:06 2003]: leaving main::table
        DEBUG[Wed Jun 18 12:21:06 2003]: entering main::table(Coffee Oily Cola Fizzy)
        Coffee  Oily
          Cola  Fizzy
        DEBUG[Wed Jun 18 12:21:06 2003]: leaving main::table</code></pre>
		
<p><code>Attribute::Handlers</code> can do quite a lot more than what I've shown you already.
If you like what you see, then you may want to add attributes to variables or worse.
Please read the thorough documentation provided with the module.</p>

<h2><a name="b::deparse"><code>B::Deparse</code></a></h2>

<p>This module is a well-known Perl debugging module.  It generates Perl source
code from Perl source code provided to it.  This may seem useless to some,
but to the aspiring obfuscator, it's useful in understanding odd code.</p>

<pre><code>        perl -snle'$w=($b=&quot;bottles of beer&quot;).&quot; on the wall&quot;;$i&gt;=0?print:last
        LINE for(map &quot;$i $_&quot;,$w,$b),&quot;take one down, pass it around&quot;,
        do{$i--;&quot;$i $w!&quot;}' -- -i=100</code></pre>

<p>That is an example of an obfuscated program.  It could be worse, but it's
pretty bad already.  Understanding this gem is as simple as adding
<code>-MO=Deparse</code> to the command line.  This will use <code>B::Deparse</code> to turn that mess into more readable Perl source code.</p>

<pre><code>        LINE: while (defined($_ = &lt;ARGV&gt;)) {
                chomp $_;
                $w = ($b = 'bottles of beer') . ' on the wall';
                foreach $_ (
                         map(&quot;$i $_&quot;, $w, $b),
                         'take one down, pass it around',
                         do { --$i; &quot;$i $w!&quot; }
                       ) {
                        $i &gt;= 0 ? print($_) : last LINE;
                }
        }</code></pre>
		
<p>To use <code>B::Deparse</code> in the everyday example, just run your program using
it on the command line.</p>

<pre><code>        perl -MO=Deparse prog.pl</code></pre>

<p>But if you want to have some real fun, then dig into the object-oriented interface
for <code>B::Deparse</code>.  There you will find an amazing method called <code>coderef2text()</code>. This method turns any code reference to text, just like the command line trick does for an entire program.  Here is a short example.</p>

<pre><code>        use B::Deparse;
        
        my $deparser = B::Deparse-&gt;new;
        
        print $deparser-&gt;coderef2text(
                sub { print &quot;Hello, world!&quot; }
        );</code></pre>
		
<p>The output will be the code block, after it's been deparsed.</p>

<pre><code>        {
        print 'Hello, world!';
        }</code></pre>
		
<p>We can use this to add another debug level to our <code>Attribute::Handlers</code>
example.  Here, debug level four (<code>4</code>) will print out the source of
our subroutine.</p>

<p>Before our <code>debug()</code> subroutine declaration we add the following lines
of code.</p>

<pre><code>        use B::Deparse;
        my $deparser = B::Deparse-&gt;new;</code></pre>

<p>Next, our debugging closure declaration is updated to print out the
full subroutine with the <code>DEBUG: </code> prefix on each line.</p>

<pre><code>        *{$symbol} = sub {
                warn sprintf &quot;DEBUG[%s]: entering %s(%s)\n&quot;,
                        scalar(localtime), $name, ($level &gt;= 3 ? &quot;@_&quot; : '' );
                if ( $level &gt;= 4 ) {
                        my $sub = sprintf &quot;sub %s %s&quot;,
                                $name, $deparser-&gt;coderef2text( $code );
                        $sub =~ s/\n/\nDEBUG: /g;
                        warn &quot;DEBUG: $sub\n&quot;;
                }
                my @output = $code-&gt;(@_);
                if ( $level &gt;= 2 ) {
                        warn sprintf &quot;DEBUG[%s]: leaving %s\n&quot;,
                                scalar(localtime), $name;
                }
                return @output;
        };</code></pre>

<p>The verbose debugging output looks like this.</p>

<pre><code>        DEBUG[Wed Jun 18 12:47:22 2003]: entering main::table(Chastity Mom Casey Dad Evelina Kid)
        DEBUG: sub main::table {
        DEBUG:    BEGIN {${^WARNING_BITS} = &quot;UUUUUUUUUUUU&quot;}
        DEBUG:    use strict 'refs';
        DEBUG:    my(%data) = @_;
        DEBUG:    my $length = 0;
        DEBUG:    foreach $_ (keys %data) {
        DEBUG:        $length = length $_ if length $_ &gt; $length;
        DEBUG:    }
        DEBUG:    my $output = '';
        DEBUG:    while (my($k, $v) = each %data) {
        DEBUG:        $output .= sprintf(&quot;%${length}s  %s\n&quot;, $k, $v);
        DEBUG:    }
        DEBUG:    print &quot;\n$output&quot;;
        DEBUG:}
           Casey  Dad
        Chastity  Mom
         Evelina  Kid
        DEBUG[Wed Jun 18 12:47:22 2003]: leaving main::table</code></pre>
		
<p>There are more methods in the <code>B::Deparse</code> class that you can use to muck
around with the results of <code>coderef2text()</code>.  This module is powerful
and useful for debugging.  I suggest you at least use the simple version if
code becomes ambiguous and incomprehensible.</p>

<p>While <code>B::Deparse</code> is good at what it does, it's not complete.  Each
version of Perl has made it better, and it's good in Perl 5.8.0.  Don't
trust <code>B::Deparse</code> to get everything right, though.  For instance, I
wouldn't trust it to serialize code for later use.</p>

<h2><a name="class::struct"><code>Class::Struct</code></a></h2>

<p>This module, just like the <code>constant</code> pragma, is well-known.  The
difference is that <code>Class::Struct</code> is not often used.  For many programs,
setting up a class to represent data would be ideal, but overkill.
<code>Class::Struct</code> gives us the opportunity to live in our ideal world
without the pain of setting up any classes by hand.  Here
is an example of creating a class with <code>Class::Struct</code>.  In this
example, we're going to use compile time-class declarations, a new feature
in Perl 5.8.0.</p>

<pre><code>        use Class::Struct Person =&gt; {
                name =&gt; '$',
                mom  =&gt; 'Person',
                dad  =&gt; 'Person',
        };</code></pre>

<p>Here we've created a class called <code>Person</code> with three attributes.
<code>name</code> can contain a simple scalar value, represented by the dollar
sign (<code>$</code>).  <code>mom</code> and <code>dad</code> are both objects of type <code>Person</code>.
Using our class within the same program is the same as using any
other class.</p>

<pre><code>        my $self = Person-&gt;new( name =&gt; 'Casey West' );
        my $wife = Person-&gt;new( name =&gt; 'Chastity West' );
        my $baby = Person-&gt;new(
                name =&gt; 'Evelina West',
                mom  =&gt; $wife,
                dad  =&gt; $self,
        );
        printf &lt;&lt;__FORMAT__, $baby-&gt;name, $baby-&gt;mom-&gt;name;
        %s, daughter of %s,
        went on to cure cancer and disprove Fermat's Theorem.
        __FORMAT__</code></pre>
		
<p><code>Class::Struct</code> classes are simple by design, and can get more complex
with further creativity.  For instance, to add a method to the <code>Person</code>
class you can simply declare it in the <code>Person</code> package.  Here is a
method named <code>birth()</code> which should be called on a Person object.  It
takes the name of the baby as an argument, and optionally the father
(a <code>Person</code> object).  Returned is a new <code>Person</code> object representing
the baby.</p>

<pre><code>        sub Person::birth {
                my ($self, $name, $dad) = @_;
                return Person-&gt;new(
                        name =&gt; $name,
                        mom  =&gt; $self,
                        dad  =&gt; ( $dad || undef ),
                );
        }</code></pre>

<p>These object are not meant to be persistent.  If you want persistent
objects, then you need to look elsewhere, perhaps <code>Class::DBI</code> or any
other implementation, of which there are many.</p>

<p>These in-memory objects can help to clean up your code, but they add
a bit of overhead.  You have to decide where the balance in your program
is.  In most cases, using <code>Class::Struct</code> is going to be OK.</p>

<h2><a name="encode"><code>Encode</code></a></h2>

<p><code>Encode</code> is Perl's interface to Unicode.  An explanation of Unicode itself
is far beyond the scope of this article.  In fact, it's far beyond the scope
of most of us.  This module is powerful.  I'm going to provide some examples
and lots of pointers to the appropriate documentation.</p>

<p>The first function of the API to learn is <code>encode()</code>.  <code>encode()</code> will convert a string for Perl's internal format to a series of octets in the
encoding you choose.  Here is an example.</p>

<pre><code>        use Encode;
        my $octets = encode( &quot;utf8&quot;, &quot;Hello, world!&quot; );</code></pre>

<p>Here we have turned the string <em>Hello, world!</em> into a <code>utf8</code> string, which is now in <code>$octets</code>.  We can also decode strings using the <code>decode()</code> function.</p>

<pre><code>        my $string = decode( &quot;utf8&quot;, $utf8_string );</code></pre>

<p>Now we've decoded a <code>utf8</code> string into Perl's internal string representation.
Since <code>utf8</code> is a common encoding to deal with, there are two helper functions:
<code>encode_utf8()</code>, and <code>decode_utf8</code>.  Both of these function take a string
as the argument.</p>

<p>A list of supported encodings can be found in <code>Encode::Supported</code>, or by
using the <code>encodings()</code> method.</p>

<pre><code>        my @encodings = Encode-&gt;encodings;</code></pre>

<p>For even more Unicode fun, dive into the documentation in <code>Encode</code>
(<code>perldoc Encode</code> on the command line).</p>

<h2><a name="filter::simple"><code>Filter::Simple</code></a></h2>

<p>This module gives us an easy way to write source-code filters.  These
filters may change the behavior of calling Perl code, or implement new
features of Perl, or do anything else they want.  Some of the more
infamous source-filter modules on the CPAN include <code>Acme::Bleach</code>,
<code>Semi::Semicolons</code>, and even <code>Switch</code>.</p>

<p>In this article, I'm going to implement a new comment syntax for Perl.
Using the following source-filter package will allow you to comment
your code using SQL comments.  SQL comments begin with two consecutive
dashes (<code>--</code>).  For our purposes, these dashes cannot be directly
followed by a semicolon (<code>;</code>) or be preceded by something other than
whitespace or a the beginning of a line.</p>

<pre><code>        package SQLComments;
        use Filter::Simple sub {
                s/(?:^|\s)--(?!;)/#/g;
        };
        1;</code></pre>
		
<p>In this example, we create an anonymous subroutine that is passed on
to <code>Filter::Simple</code>.  The entire source of the calling program is
in <code>$_</code>, and we use a regular expression to search for our SQL comments
and change them to Perl comments.</p>

<p>Using our new source filter works like this.</p>

<pre><code>        use SQLComments;
        -- Here is some code that decrements a variable.
        my $i = 100; -- start at 100.
        while ( $i ) {
                $i--; -- decrement
        }
        -- That's it!.</code></pre>
		
<p>Using <code>B::Deparse</code> on the command line, we can see what the code
looks like after it's filtered.  Just remember that <code>B::Deparse</code>
doesn't preserve comments.</p>

<pre><code>        use SQLComments;
        
        my $i = 100;
        while ($i) {
            --$i;
        }</code></pre>

<p>The output is exactly as we expect.  Filtering source code is a complex art.
If your filters are not perfect, then you can break code in unexpected ways.
Our <code>SQLComments</code> filter will break the following code.</p>

<pre><code>        print &quot;This is nice -- I mean really nice!\n&quot;;</code></pre>

<p>It will turn into this.</p>

<pre><code>        print &quot;This is nice# I mean really nice!\n&quot;;</code></pre>

<p>Not exactly the results we want.  This particular problem can be avoided,
however, using <code>Filter::Simple</code> in a slightly different way.  You can
specify filters for different sections of the source code, here is how
we can limit our <code>SQLComments</code> filter to just code and not quote-like
constructs.</p>

<pre><code>        package SQLComments;
        
        use Filter::Simple;
        
        FILTER_ONLY code =&gt; sub { s/(?:^|\s)--(?!;)/#/g };</code></pre>

<p>If you want to learn more about source filters, then read the documentation
provided in <code>Filter::Simple</code>.</p>

<h2><a name="variable_utility_modules">Variable Utility Modules</a></h2>

<p>There are some functions that are repeated in hundreds (probably thousands)
of programs.  Think of all the sorting functions written in C programs.  Perl
programs have them, too, and the following utility modules try to clean up our
code, eliminating duplication is simple routines.</p>

<p>There are a number of useful functions in each of these modules.  I'm going to
highlight a few, but be sure to read the documentation provided with each
of them for a full list.</p>

<dl>
<dt><strong><a name="item_scalar%3a%3autil"><code>Scalar::Util</code></a></strong><br />
</dt>
<dd>
<code>blessed()</code> will return the package name that the variable is blessed into,
or <code>undef</code> if the variable isn't blessed.
</dd>
<dd><pre><code>        my $baby  = Person-&gt;new;
        my $class = blessed $baby;</code></pre>
</dd>
<dd>
<p><code>$class</code> will hold the string <em>Person</em>.  <code>weaken</code> is a function that
takes a reference and makes it weak.  This means that the variable will
not hold a reference count on the thing it references.  This is useful
for objects, where you want to keep a copy but you don't want to stop
the object from being <code>DESTROY</code>-ed at the right time.</p>
</dd>
<dt><strong><a name="item_list%3a%3autil"><code>List::Util</code></a></strong><br />
</dt>
<dd>
The <code>first()</code> function returns the first element in the list for which
the block returns true.
</dd>
<dd>
<pre><code>        my $person = first { $_-&gt;age &lt; 18 } @people;</code></pre>
</dd>
<dd>
<p><code>shuffle()</code> will return the elements of the list in random order.  Here
is an example of breaking a group of people into teams.</p>
</dd>
<dd>
<pre><code>        my @people = shuffle @people;
        
        my @team1  = splice @people,  0, (@people/2);
        my @team2  = @people;</code></pre>
</dd>
<dd>
<p>Finally, <code>sum</code> returns the sum of all the elements in a list.</p>
</dd>
<dd>
<pre><code>        my $sum = sum 1 .. 10;</code></pre>
</dd>
<dt><strong><a name="item_hash%3a%3autil"><code>Hash::Util</code></a></strong><br />
</dt>
<dd>
<a href="#item_hash%3a%3autil"><code>Hash::Util</code></a> has a slightly different function than the previously
discussed variable utility modules.  This module implements restricted
hashes, which are the predecessor to the undesirable (and now obsolete)
pseudo-hashes.
</dd>
<dd>
<p><code>lock_keys()</code> is a function that will restrict the allowed keys of a
hash.  If a list of keys is given, the hash will be restricted to that
set, otherwise the hash is locked down to the currently existing keys.</p>
</dd>
<dd><pre><code>        use Hash::Util qw[lock_keys];
        
        my %person = (
                name =&gt; &quot;Casey West&quot;,
                dad  =&gt; $dad,
                mom  =&gt; $mom,
        );
        
        lock_keys( %person );</code></pre>
		
<p>The <code>%person</code> hash is now restricted.  Any keys currently in the
hash may be modified, but no keys may be added.  The following code
will result in a fatal error.</p>
</dd>
<dd>
<pre><code>        $person{wife} = $wife;</code></pre>
</dd>
<dd>
<p>You can use the <code>unlock_keys()</code> function to release your restricted
hash.</p>
</dd>
<dd>
<p>You can also lock (or unlock) a value in the hash.</p>
</dd>
<dd>
<pre><code>        lock_value( %person, &quot;name&quot; );
        $person{name} = &quot;Bozo&quot;; # Fatal error!</code></pre>
</dd>
<dd>
<p>Finally, you can lock and unlock an entire hash, making it read only
in the first case.</p>
</dd>
<dd>
<pre><code>        lock_hash( %person );</code></pre>
</dd>
<dd><p>Now our <code>%person</code> hash is really restricted.  No keys can be added or
deleted, and no values can be changed.  I know all those OO folks out there
wishing Perl made it easy to keep class and instance data private are
smiling.</p>
</dd>
</dl>

<h2><a name="locale_modules"><code>Locale</code> Modules</a></h2>

<p>I've seen these modules implemented time and time again.  Perl 5.8.0 introduced
them.  Each of them implements a set of functions that handle locale issues for
you.</p>

<dl>
<dt><strong><a name="item_locale%3a%3alanguage"><code>Locale::Language</code></a></strong><br />
</dt>
<dd>
This module will translate language codes to names, and vice-versa.
</dd>
<dd>
<pre><code>        my $lang = code2language( 'es' );      # Spanish
        my $code = language2code( 'English' ); # en</code></pre>
</dd>
<dd>
<p>You can also get a full list of supported language names and codes.</p>
</dd>
<dd>
<pre><code>        my @codes = all_language_codes();
        my @names = all_language_names();</code></pre>
</dd>
<dt><strong><a name="item_locale%3a%3acountry"><code>Locale::Country</code></a></strong><br />
</dt>
<dd>
<p>Convert country names to codes, and vice-versa.  By default country codes
are represented in two character codes.</p>
</dd>
<dd>
<pre><code>        my $code = country2code( 'Finland' ); # fi</code></pre>
</dd>
<dd>
<p>You can change the default behavior to get three character codes, or the
numeric country codes.</p>
</dd>
<dd>
<pre><code>        my $code = country2code( 'Russia', LOCALE_CODE_ALPHA_3 ); # rus
        my $num  = country2code( 'Australia', LOCALE_CODE_NUMERIC ); # 036</code></pre>
</dd>
<dd>
<p>You can also go from any code type to country name.</p>
</dd>
<dd>
<pre><code>        my $name = code2country( 'jp' ); # Japan</code></pre>
</dd>
<dd>
<p>You can specify any type of code, but if it's not the default two character
representation you must supply the extra argument to define what type it is.</p>
</dd>
<dd>
<pre><code>        my $name = code2country( &quot;120&quot;, LOCALE_CODE_NUMERIC ); # Cameroon</code></pre>
</dd>
<dd>
<p>Just as before, you can get a full list of codes and countries using the
two query functions: <code>all_country_codes()</code>, and <code>all_country_names()</code>.
Both of these functions accept an optional argument specifying the code
set to use for the resulting list.</p>
</dd>
<dt><strong><a name="item_locale%3a%3acurrency"><code>Locale::Currency</code></a></strong><br />
</dt>
<dd>
<p>This module has the same properties as the other locale modules.  You can
convert currency codes into full names, and vice-versa.</p>
</dd>
<dd>
<pre><code>        my $curr = code2currency( 'jpy' ); # Yen
        my $code = currency2code( 'US Dollar' ); # usd</code></pre>
</dd>
<dd>
<p>The query functions are: <code>all_currency_codes()</code>, and <code>all_currency_names()</code>.</p>
</dd>
</dl>

<h2><a name="memoize"><code>Memoize</code></a></h2>

<p><code>Memoize</code> is a module that performs code optimization for you.  In a
general sense, when you <em>memoize</em> a function, it is replaced by a <em>memoized</em>
version of the same function.  OK, that was too general.  More specifically,
every time your memoized function is called, the calling arguments are
cached and anything the function returns is cached as well.  If the function
is called with a set of arguments that has been seen before, then the cached
return value is sent back and the actual function is never called.  This makes
the function faster.</p>

<p>Not all functions can be memoized.  For instance, if your function would return
a different value on two calls, even for the exact same set of calling arguments,
then it will be broken.  Only the first sets return values will be returned for every
call.  Many function do not act this way, and that's what makes <code>Memoize</code> so
useful.</p>

<p>Here is an example of a <em>memoize</em>able function.</p>

<pre><code>        sub add {
                my ($x, $y) = @_;
                return $x + $y;
        }</code></pre>
		
<p>For every time this function is called as <code>add( 2, 2 )</code>, the result will be <code>4</code>.
Rather than compute the value of <code>4</code> in every case, we can cache it away the first
time and retrieve it from the cache every other time we need to compute <code>2 + 2</code>.</p>

<pre><code>        use Memoize;
        
        memoize( 'add' );
        
        sub add {
                my ($x, $y) = @_;
                return $x + $y;
        }</code></pre>

<p>We've just made <code>add()</code> faster, without any work.  Of course, our addition function isn't slow to begin with.  The documentation of <code>Memoize</code> gives a much more details look into this algorithm.  I highly suggest you invest time in learning about <code>Memoize</code>, it can give you wonderful speed increases if you know how and when to use it.</p>

<h2><a name="win32"><code>Win32</code></a></h2>

<p>I currently don't have a Microsoft operating system running on any of my networks,
but when perusing the Perl core, I happened upon the <code>Win32</code> module.  I wanted
to bring it up because if I were using a Microsoft OS, then I would find the functions
in his module invaluable.  Please, if you are running in that environment, then look
at the documentation for <code>Win32</code> for dozens of helpful functions (<code>perldoc Win32</code> on the command line).</p>

<h2><a name="conclusion">Conclusion</a></h2>

<p>Just as before, I've still not covered all of the Perl core.  There is much more to
explore and a full list can be found by reading <em>perlmodlib</em>.  The benefit of having
these modules in the core is great.  Lots of environments require programmers to be
bound to using only code that is distributed with Perl.  I hope I've been able to lighten
the load for anyone who has been put in that position (even by choice).</p>

                                    </div>


                                </div>
                                <div class="asset-footer">

    
                                    <div class="entry-categories">
                                        <h4>Categories<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="/pub/modules/" rel="tag">Modules</a></li>
                                        </ul>
                                    </div>
    


                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2010/07/">July 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.02" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
