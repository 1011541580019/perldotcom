<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: June 2003 Archives</title>


    <link rel="prev" href="/pub/2003/05/" title="May 2003" />
    <link rel="next" href="/pub/2003/07/" title="July 2003" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">June 2003 Archives</h1>





                            
                            <div id="entry-1140" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/06/25/perl6essentials.html" rel="bookmark">Perl 6 Design Philosophy</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <abbr class="published" title="2003-06-25T00:00:00-08:00">June 25, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->


<csperl file="grab" domain="on" record="b/940" template="b/article_sidebar.view">

<p><i>Editor's note: <a href="http://www.oreilly.com/catalog/perl6es/index.html?CMP=IL7015">Perl 6 Essentials</a> is the first book to offer a peek into the next major version of the Perl language. It covers the development of Perl 6 syntax as well as Parrot, the language-independent interpreter developed as part of the Perl 6 design strategy. In this excerpt from Chapter 3 of the book, the authors take an in-depth look of some of the most important principles of natural language and their impact on the design decisions made in Perl 6. </i></p>

<h2>Introduction</h2>
  
<p>At the heart of every language is a core set of ideals that give 
the language its direction and purpose. If you really want to understand the 
choices that language designers make--why they choose one feature over another 
or one way of expressing a feature over another--the best place to start is 
with the reasoning behind the choices.</p>

<p>Perl 6 has a unique set of influences. It has deep roots in Unix 
and the children of Unix, which gives it a strong emphasis on utility and 
practicality. It's grounded in the academic pursuits of computer science and 
software engineering, which gives it a desire to solve problems the right way, 
not just the most expedient way. It's heavily steeped in the traditions of 
linguistics and anthropology, which gives it the goal of comfortable 
adaptation to human use. These influences and others like them define the 
shape of Perl and what it will become.</p>

<h2>Linguistic and Cognitive Considerations</h2>

<p>Perl is a human language. Now, there are significant differences 
between Perl and languages like English, French, German, etc. For one, it is 
artificially constructed, not naturally occurring. Its primary use, providing 
a set of instructions for a machine to follow, covers a limited range of human 
existence. Even so, Perl is a language humans use for communicating. Many of 
the same mental processes that go into speaking or writing are duplicated in 
writing code. The process of learning to use Perl is much like learning to 
speak a second language. The mental processes involved in reading are also 
relevant. Even though the primary audience of Perl code is a machine, as often 
as not humans have to read the code while they're writing it, reviewing it, or 
maintaining it.</p>

<p>Many Perl design decisions have been heavily influenced by the 
principles of natural language. The following are some of the most important 
principles, the ones we come back to over and over again while working on the 
design and the ones that have had the greatest impact.</p>

<h3>The Waterbed Theory of Complexity</h3>

<p>The natural tendency in human languages is to keep overall 
complexity about equivalent, both from one language to the next, and over time 
as a language changes. Like a waterbed, if you push down the complexity in one 
part of the language, it increases complexity elsewhere. A language with a 
rich system of sounds (phonology) might compensate with a simpler syntax. A 
language with a limited sound system might have a complex way of building 
words from smaller pieces (morphology). No language is complex in every way, 
as that would be unusable. Likewise, no language is completely simple, as too 
few distinctions would render it useless.</p>

<p>The same is true of computer languages. They require a constant 
balance between complexity and simplicity. Restricting the possible operators 
to a small set leads to a proliferation of user-defined methods and 
subroutines. This is not a bad thing, in itself, but it encourages code that 
is verbose and difficult to read. On the other hand, a language with too many 
operators encourages code that is heavy in line noise and difficult to read. 
Somewhere in the middle lies the perfect balance.</p>

<h3>The Principle of Simplicity</h3>

<p>In general, a simple solution is preferable to a complex one. A 
simple syntax is easier to teach, remember, use, and read. But this principle 
is in constant tension with the waterbed theory. Simplification in the wrong 
area is one danger to avoid. Another is false simplicity or 
oversimplification. Some problems are complex and require a complex solution. 
Perl 6 grammars aren't simple. But they are complex at the language level in a 
way that allows simpler solutions at the user level.</p>

<h3>The Principle of Adaptability</h3>

<p>Natural languages grow and change over time. They respond to 
changes in the environment and to internal pressure. New vocabulary springs up 
to handle new communication needs. Old idioms die off as people forget them, 
and newer, more relevant idioms take their place. Complex parts of the system 
tend to break down and simplify over time. Change is what keeps language 
active and relevant to the people who use it. Only dead languages stop 
changing.</p>

<p>The plan for Perl 6 explicitly includes plans for future 
language changes. No one believes that Perl 6.0.0 will be perfect, but at the 
same time, no one wants another change process quite as dramatic as Perl 6. So 
Perl 6 will be flexible and adaptable enough to allow gradual shifts over 
time. This has influenced a number of design decisions, including making it 
easy to modify how the language is parsed, lowering the distinctions between 
core operations and user-defined operations, and making it easy to define new 
operators.</p>

<h3>The Principle of Prominence</h3>

<p>In natural languages, certain structures and stylistic devices 
draw attention to an important element. This could be emphasis, as in "The <em>dog</em> stole my wallet" (the dog, not the man), or extra 
verbiage, as in "It was the dog who stole my wallet," or a shift to an unusual 
word order, "My wallet was stolen by the dog" (my wallet, not my shoe, etc.), 
or any number of other verbal tricks.</p>

<p>Perl is designed with its own set of stylistic devices to mark 
prominence, some within the language itself, and some that give users 
flexibility to mark prominence within their code. The <code>NAMED</code> blocks use all capitals to draw attention to the 
fact that they're outside the normal flow of control. Perl 5 has an alternate 
syntax for control structures like <code>if</code> and <code>for</code>, which moves them to the end to serve as statement 
modifiers (because Perl is a left-to-right language, the left side is always a 
position of prominence). Perl 6 keeps this flexibility, and adds a few new 
control structures to the list.</p>

<p>The balance for design is to decide which features deserve to be 
marked as prominent, and where the syntax needs a little flexibility so the 
language can be more expressive.</p>

<h3>The Principle of End Weight</h3>

<p>Natural languages place large complex elements at the end of 
sentences. So, even though "I gave Mary the book" and "I gave the book to 
Mary" are equally comfortable, "I gave the book about the history of 
development of peanut-based products in Indonesia to Mary" is definitely less 
comfortable than the other way around. This is largely a mental parsing 
problem. It's easier to interpret the major blocks of the sentence all at once 
than to start with a few, work through a large chunk of minor information, and 
then go back to fill in the major sentence structure. Human memory is 
limited.</p>

<p>End weight is one of the reasons regular expression modifiers 
were moved to the front in Perl 6. It's easier to read a grammar rule when you 
know things like "this rule is case insensitive" right at the start. (It's 
also easier for the machine to parse, which is almost as important.)</p>

<p>End weight is also why there has been some desire to reorder the 
arguments in <code>grep</code> to:</p>

<pre><code>grep @array { potentially long and complex block };</code></pre>

<p>But that change causes enough cultural tension that it may not 
happen.</p>

<h3>The Principle of Context</h3>

<p>Natural languages use context when interpreting meaning. The 
meanings of "hot" in "a hot day," "a hot stereo," "a hot idea," and "a hot 
debate" are all quite different. The implied meaning of "it's wet" changes 
depending on whether it's a response to "Should I take a coat?" or "Why is the 
dog running around the kitchen?" The surrounding context allows us to 
distinguish these meanings. Context appears in other areas as well. A painting 
of an abstract orange sphere will be interpreted differently depending on 
whether the other objects in the painting are bananas, clowns, or basketball 
players. The human mind constantly tries to make sense of the universe, and it 
uses every available clue.</p>

<p>Perl has always been a context-sensitive language. It makes use 
of context in a number of different ways. The most obvious use is scalar and 
list contexts, where a variable may return a different value depending on 
where and how it's used. These have been extended in Perl 6 to include string 
context, boolean context, numeric context, and others. Another use of context 
is the <code>$_</code> defaults, like <code>print</code>, <code>chomp</code>, matches, and now 
<code>when</code>.</p>

<p>Context-dependent features are harder to write an interpreter 
for, but they're easier on the people who use the language daily. They fit in 
with the way humans naturally think, which is one of Perl's top goals.</p>

<h3>The Principle of DWIM</h3>

<p>In natural languages there is a notion called "native speaker's 
intuition." Someone who speaks a language fluently will be able to tell 
whether a sentence is correct, even if they can't consciously explain the 
rules. (This has little to do with the difficulty English teachers have 
getting their students to use "proper" grammar. The rules of formal written 
English are very different from the rules of spoken English.)</p>

<p>As much as possible, features should do what the user expects. 
This concept of DWIM, or "Do What I Mean," is largely a matter of intuition. 
The user's experiences, language exposure, and cultural background all 
influence their expectations. This means that intuition varies from person to 
person. An English speaker won't expect the same things as a Dutch speaker, 
and an Ada programmer won't expect the same things as a COBOL programmer.</p>

<p>The trick in design is to use the programmer's intuitions 
instead of fighting against them. A clearly defined set of rules will never 
match the power of a feature that "just seems right."</p>

<p>Perl 6 targets Perl programmers. What seems right to one Perl 
programmer may not seem right to another, so no feature will please everyone. 
But it is possible to catch the majority cases.</p>

<p>Perl generally targets English speakers. It uses words like 
"given," which gives English speakers a head start in understanding its 
behavior in code. Of course, not all Perl programmers are English speakers. In 
some cases idiomatic English is toned down for broader appeal. In grammar 
rules, ordinal modifiers have the form <code>1st</code>, <code>2nd</code>, <code>3rd</code>, <code>4th</code>, etc., because those are most natural for native 
English speakers. But they also have an alternate form <code>1th</code>, <code>2th</code>, etc., with the 
general rule <em>N</em>th, because the English endings for 
ordinal numbers are chaotic and unfriendly to non-native speakers.</p>

<h3>The Principle of Reuse</h3>

<p>Human languages tend to have a limited set of structures and 
reuse them repeatedly in different contexts. Programming languages also employ 
a set of ordinary syntactic conventions. A language that used <code>{ }</code> braces to delimit loops but paired keywords to delimit <code>if</code> statements (like <code>if 
... then</code> <code>... end if</code>) would be incredibly 
annoying. Too many rules make it hard to find the pattern.</p>

<p>In design, if you have a certain syntax to express one feature, 
it's often better to use the same syntax for a related feature than to invent 
something entirely new. It gives the language an overall sense of consistency, 
and makes the new features easier to remember. This is part of why grammars 
are structured as classes. Grammars could use any syntax, but classes already 
express many of the features grammars need, like inheritance and the concept 
of creating an instance.</p>

<h3>The Principle of Distinction</h3>

<p>The human mind has an easier time identifying big differences 
than small ones. The words "cat" and "dog" are easier to tell apart than 
"snore" and "shore." Usually context provides the necessary clues, but if 
"cats" were "togs," we would be endlessly correcting people who heard us wrong 
("No, I said the Johnsons got a new dog, not tog, <em>dog</em>.").</p>
<p>The design consideration is to build in visual clues to subtle 
contrasts. The language should avoid making too many different things similar. 
Excessive overloading reduces readability and increases the chance for 
confusion. This is part of the motivation for splitting the two meanings of 
<code>eval</code> into <code>try</code> and <code>eval</code>, the two meanings of <code>for</code> 
into <code>for</code> and <code>loop</code>, and 
the two uses of <code>sub</code> into <code>sub</code> and <code>method</code>.</p>

<p>Distinction and reuse are in constant tension. If too many 
features are reused and overloaded, the language will begin to blur together. 
Far too much time will be spent trying to figure out exactly which use is 
intended. But, if too many features are entirely distinct, the language will 
lose all sense of consistency and coherence. Again, it's a balance.</p>

<h3>Language Cannot Be Separated from Culture</h3>

<p>A natural language without a community of speakers is a dead 
language. It may be studied for academic reasons, but unless someone takes the 
effort to preserve the language, it will eventually be lost entirely. A 
language adds to the community's sense of identity, while the community keeps 
the language relevant and passes it on to future generations. The community's 
culture shapes the language and gives it a purpose for existence.</p>

<p>Computer languages are equally dependent on the community behind 
them. You can measure it by corporate backing, lines of code in operation, or 
user interest, but it all boils down to this: a programming language is dead 
if it's not used. The final sign of language death is when there are no 
compilers or interpreters for the language that will run on existing hardware 
and operating systems.</p>

<p>For design work this means it's not enough to only consider how 
a feature fits with other features in the language. The community's traditions 
and expectations also weigh in, and some changes have a cultural price.</p>

<h3>The Principle of Freedom</h3>

<p>In natural languages there is always more than one way to 
express an idea. The author or speaker has the freedom, and the 
responsibility, to pick the best phrasing--to put just the right spin on the 
idea so it makes sense to their audience.</p>

<p>Perl has always operated on the principle that programmers 
should have the freedom to choose how to express their code. It provides easy 
access to powerful features and leaves it to the individuals to use them 
wisely. It offers customs and conventions rather than enforcing laws.</p>

<p>This principle influences design in several ways. If a feature 
is beneficial to the language as a whole, it won't be rejected just because 
someone could use it foolishly. On the other hand, we aren't above making some 
features difficult to use, if they should be used rarely.</p>

<p>Another part of the design challenge is to build tools that will 
have many uses. No one wants a cookbook that reads like a Stephen King novel, 
and no one wants a one-liner with the elaborate structure of a class 
definition. The language has to be flexible to accommodate freedom.</p>

<h3>The Principle of Borrowing</h3>

<p>Borrowing is common in natural languages. When a new technology 
(food, clothing, etc.) is introduced from another culture, it's quite natural 
to adopt the original name for it. Most of the time borrowed words are adapted 
to the new language. In English, no one pronounces "tortilla," "lasagna," or 
"champagne" exactly as in the original languages. They've been altered to fit 
the English sound system.</p>

<p>Perl has always borrowed features, and Perl 6 will too. There's 
no shame in acknowledging that another language did an excellent job 
implementing a particular feature. It's far better to openly borrow a good 
feature than to pretend it's original. Perl doesn't have to be different just 
for the sake of being different. Most features won't be adopted without any 
changes, though. Every language has its own conventions and syntax, and many 
aren't compatible. So, Perl borrows features, but uses equivalent structures 
to express them.</p>

<h2>Architectural Considerations</h2>

<p>The second set of principles governs the overall architecture of 
Perl 6. These principles are connected to the past, present, and future of 
Perl, and define the fundamental purpose of Perl 6. No principle stands alone; 
each is balanced against the others.</p>

<h3>Perl Should Stay Perl</h3>

<p>Everyone agrees that Perl 6 should still be Perl, but the 
question is, what exactly does that mean? It doesn't mean Perl 6 will have 
exactly the same syntax. It doesn't mean Perl 6 will have exactly the same 
features. If it did, Perl 6 would just be Perl 5. So, the core of the question 
is what makes Perl "Perl"?</p>

<h4>True to the original purpose</h4>

<p>Perl will stay true to its designer's original intended purpose. 
Larry wanted a language that would get the job done without getting in his 
way. The language had to be powerful enough to accomplish complex tasks, but 
still lightweight and flexible. As Larry is fond of saying, "Perl makes the 
easy things easy and the hard things possible." The fundamental design 
philosophy of Perl hasn't changed. In Perl 6, the easy things are a little 
easier and the hard things are more possible.</p>

<h4>Familiarity</h4>

<p>Perl 6 will be familiar to Perl 5 users. The fundamental syntax 
is still the same. It's just a little cleaner and a little more consistent. 
The basic feature set is still the same. It adds some powerful features that 
will probably change the way we code in Perl, but they aren't required.</p>

<p>Learning Perl 6 will be like American English speakers learning 
Australian English, not English speakers learning Japanese. Sure, there are 
some vocabulary changes, and the tone is a little different, but it is 
still--without any doubt--English.</p>

<h4>Translatable</h4>

<p>Perl 6 will be mechanically translatable from Perl 5. In the 
long term, this isn't nearly as important as what it will be like to write 
code in Perl 6. But during the transition phase, automatic translation will be 
important. It will allow developers to start moving ahead before they 
understand every subtle nuance of every change. Perl has always been about 
learning what you need now and learning more as you go.</p>

<h3>Important New Features</h3>

<p>Perl 6 will add a number of features such as exceptions, 
delegation, multi-method dispatch, continuations, coroutines, and currying, to 
name a few. These features have proven useful in other languages and provide a 
great deal of power for solving certain problems. They improve the stability 
and flexibility of the language.</p>

<p>Many of these features are traditionally difficult to 
understand. Perl takes the same approach as always: provide powerful tools, 
make them easy to use, and leave it up to the user to decide whether and how 
to use them. Most users probably won't even know they're using currying when 
they use the <code>assuming</code> method.</p>

<p>Features like these are an important part of preparing Perl for 
the future. Who knows what development paradigms might develop in a language 
that has this combination of advanced features in a form easily approachable 
by the average programmer. It may not be a revolution, but it's certainly 
evolution.</p>

<h3>Long-Term Usability</h3>

<p>Perl 6 isn't a revision intended to last a couple of years and 
then be tossed out. It's intended to last 20 years or more. This long-range 
vision affects the shape of the language and the process of building it. We're 
not interested in the latest fad or in whipping up a few exciting tricks. We 
want strong, dependable tools with plenty of room to grow. And we're not 
afraid to take a little extra time now to get it right. This doesn't mean Perl 
6.0 will be perfect, any more than any other release has been perfect. It's 
just another step of progress. </p>

<hr size="1" noshade="noshade" />

<p>
O'Reilly &amp; Associates recently released (June 2003) <a href="http://www.oreilly.com/catalog/perl6es/index.html?CMP=IL7015">Perl 6 Essentials</a>.
</p>

<ul>
<li><p>
<a href="http://www.oreilly.com/catalog/perl6es/chapter/">Sample Chapter 1: Project Overview</a>, is available 
free online. 
</p></li>

<li><p>
You can also look at the <a href="http://www.oreilly.com/catalog/perl6es/toc.html">Table of Contents</a>, the 
<a href="http://www.oreilly.com/catalog/perl6es/inx.html">Index</a>, and the <a href="http://www.oreilly.com/catalog/perl6es/desc.html">Full Description</a> of 
the book.
</p></li>

<li><p>
For more information, or to order the book, 
<a href="http://www.oreilly.com/catalog/perl6es/index.html?CMP=IL7015">click here</a>.</p></li>  
</ul>






        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1150" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/06/p6pdigest/20030629.html" rel="bookmark">This week on Perl 6, week ending 2003-06-29</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-06-23T00:00:00-08:00">June 23, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <h2><a name="the perl 6 summary for the week ending 20030629">The Perl 6
Summary for the week ending 20030629</a></h1>

<p>Welcome to the third of my US tour Perl 6 summaries. Once again I'm pleased
to report that the denizens of the Perl 6 mailing lists continue to make the
life of a touring summarizer an easy one by not posting all that much to the
lists. So, I can sit here in my room at the Shaker Inn in Enfield and marvel at
the traffic noise outside, wonder about the car next door with the New
Hampshire plates reading PERLFAN, and just generally appreciate the loveliness
of the room.</p>

<p>But, while I'm doing that, I should start with perl6-internals</p>

<h3><a name="exceptions">Exceptions</a></h2>

<p>At the end of last week, Dan outlined his thoughts on how exception handling
will work in Parrot. This week, people talked about it. Discussion revolved
around how much information should be attached to an exception and how/whether
we should support resumable exceptions.</p>

<p><a
href="http://groups.google.com/groups?threadm=a0521060abb1a415c7209%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>

<h3><a name="more on continuation passing">More on Continuation Passing</a></h2>

<p>Last week I said that "I get the strong feeling that Leo T&ouml;tsch isn't
entirely happy with the new Continuation Passing Style". This week Leo
corrected me; I hadn't noticed that the speed issues had been addressed by the
latest changes to parrot (in fact the current CPS implementation is faster than
the old <code>invoke/ret</code> scheme).</p>

<p>Sean O'Rourke addressed Leo's problem with the Perl 6 Compiler tests failing
by saying that the compiler should really be ported to use CPS rather than
implementing a new variant of the Sub PMC that uses the old scheme. Leo
reckoned that such a port wasn't currently doable because IMCC needed to be
modified to use the CPS scheme, which would also involve reworking the register
allocator. Given Leo's prodigious rate of implementation, this may have already
happened.</p>

<p><a
href="http://groups.google.com/groups?threadm=200306240712.h5O7Cb200882%40thu8.leo.home">http://groups.google.com/groups</a></p>

<h3><a name="imcc/parrot leak">IMCC/Parrot leak</a></h2>

<p>Clinton A. Pierce had reported a memory leak in Parrot, but tracked it down
to a situation where he was doing:</p>

<pre><code>.arg 0
call _foo</code></pre>

<p>and forgetting to take the <code>0</code> off the stack. However, even after
he'd fixed that, he had segfault issues, and posted a (largish) code fragment
that tweaked the bug.</p>

<p>It appears that Parrot wasn't throwing warnings when stacks get to big, just
failing silently. Leo added a check for too deeply nested stacks, which at
least avoids segfaulting on logic bugs.</p>

<p>Leo and Dan discussed other places where such limit checking should be put
in place. Dan also muttered something about turning stack chunks into PMCs,
allowing for the garbage collection of stack frames. Leo also muttered about
the proliferation of stack implementations in Parrot (there are five) and
thinks it should be possible to have one general stack engine.</p>

<p><a
href="http://groups.google.com/groups?threadm=5.1.0.14.2.20030623192413.0258eb20%40mail.geeksalad.org">http://groups.google.com/groups</a></p>

<h3><a name="making + a unary operator">Making <code>+</code> a unary
operator</a></h2>

<p>Bernhard Schmalhofer found a problem with the Perl 6 implementation.</p>

<pre><code>print +42, "\n";</code></pre>

<p>printed <code>42</code>, but omitted the carriage return. He fixed this by
making <code>+</code> into a unary operator as well as a binary operator and
sent the patch to the list, where it was applied. Good catch, Bernhard.</p>

<p><a
href="http://groups.google.com/groups?threadm=rt-22765-59761.17.1648582488247%40rt.perl.org">http://groups.google.com/groups</a></p>

<h3><a name="parrotio filedescriptors">ParrotIO File-Descriptors</a></h2>

<p>J&uuml;rgen B&ouml;mmels is in the process of porting the IO subsystem from
its current <code>mem_sys_alloc/free</code> based implementation to the sunny,
garbage-collected uplands of a PMC based implementation. However, he's run into
a problem; some of the operations in <code>op.ops</code> use integer File
Descriptors, grabbing information from a table in the interpreter structure.
This gets in the way of garbage collection, since any integer could be a file
descriptor.</p>

<p>J&uuml;rgen proposed removing the integer file descriptors and mandating
that ParrotIO PMCs be the only way to access IO (including the standard
<code>STDIN</code>, <code>STDOUT</code>, and <code>STDERR</code>). He proposed
adding <code>get_std[in|out|err]</code> ops to get at the standard streams.</p>

<p>Dan suggested that J&uuml;rgen Just Do It; the current IO system being more
than slightly hackish, essentially put in place until something better came
along.</p>

<p><a
href="http://groups.google.com/groups?threadm=m2he6dgfaq.fsf%40helium.physik.uni-kl.de">http://groups.google.com/groups</a></p>

<h3><a name="small perl task for the interested">Small Perl task for the
interested</a></h2>

<p>Want to get involved in the Parrot development process? Don't know much
about Virtual Machine design and implementation? Do know Perl?  Dan has a small
but interesting task for you.</p>

<p>At present, Parrot gets built without any compiler level optimizations
turned on because files like <code>tsq.c</code> can't have any optimizations
turned on (<code>tsq.c</code> is the thread safe queue module, which is
"annoyingly execution-order-dependent because it has to operate safely as
interrupt code potentially interrupting itself").</p>

<p>Dan would like a version of <code>Configure.pl</code> which can build a
<code>Makefile</code> (or whatever build tool we end up using) with per-C-file
compiler flags, and it needs to be possible to override those flags, per file,
by the platform configuration module.</p>

<p>Interested?  David Robins seems to be, and he asked whether the build system
had to be <code>Makefile</code> based. Dan says not, but the really important
thing is that the resulting build script, or the config system that generates
the script be adequately understandable/maintainable.</p>

<p><a
href="http://groups.google.com/groups?threadm=a05210603bb20ad1ca7e1%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>

<h3><a name="scoping, .local and imcc">Scoping, <code>.local</code> and
IMCC</a></h2>

<p>Bugfinder General Clinton A Pierce is getting a headache trying to
understand <code>.local</code>. When he executes the following code</p>

<pre><code>.local int f
.sub _main
    .local int x
    .sub _foo1
        f=1
        x=2
        call _foo2
        end
    .end
    .sub _foo2
        print "f is 1: "
        print f
        print "\n"
        ret
    .end
.end</code></pre>

<p>the output looks like:</p>

<pre><code>f is 1: 2</code></pre>

<p>which isn't quite what one would expect.</p>

<p>Leo explained what's going on; essentially it boils down to issues with
register allocation not being aware of <code>.local</code> scopes. He
recommended that Clint use either true globals or lexicals instead of
<code>.local</code>. Clint isn't so sure that this is a good idea, pointing out
that there are occasions when having lexically scoped names at the IMCC level
as well as at the level of lexical pads would be very useful.</p>

<blockquote><p>"In my mind, when I saw: 1. <code>.local</code>, 2. automagical register
spillage in IMCC, and 3. nested compilation units I thought I'd found
Assembler Manna."<br /> &mdash; Clint Pierce</blockquote></p>

<p><a
href="http://groups.google.com/groups?threadm=200306271506359.SM00172%40localhost">http://groups.google.com/groups</a>
&mdash; Clint is puzzled</p>

<p><a
href="http://groups.google.com/groups?threadm=3EFCC07A.3020809%40nextra.at">http://groups.google.com/groups</a>
&mdash; Leo explains it all</p>

<h3><a name="tentative valclone patch">Tentative <code>valclone</code>
patch</a></h2>

<p>Luke Palmer has been thinking about value and reference objects. He wondered
if there was any value in a <code>valclone</code> operator alongside
<code>set</code> and <code>clone</code> which would allow the target PMC to
decide whether to use <code>set</code> or <code>clone</code> semantics. He also
offered a patch implementing the operator if people thought it would be useful.
Leo T&ouml;tsch wasn't sure the new operator was necessary.</p>

<p>Klaas-jan Stol noted that he'd encountered problems with reference/value
confusion when he'd been working on his Lua compiler, but he wondered if the
problem couldn't be solved by having a general, language independent "argument"
PMC class. (I'm not sure I understood what he meant by this so I'm hoping for
an explanation with code fragments).</p>

<p><a
href="http://groups.google.com/groups?threadm=ygche6aj4il.fsf%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>


<h3><a name="events, exceptions and threads. oh my!">Events, exceptions, and
threads. Oh my!</a></h2>

<p>There is a story that UK prime minister Harold MacMillan was asked by a
student what it was that concerned him most as Prime Minister. Mac replied
"Events dear boy, events."</p>

<p>Leo T&ouml;tsch laid out his thoughts and ensuing questions about
Exceptions, events, and threads, and how they played together. There has been a
small amount of discussion in response to this, but I think everyone's
currently thinking hard about the issue....</p>

<p><a
href="http://groups.google.com/groups?threadm=3EFD623C.20604%40nextra.at">http://groups.google.com/groups</a></p>

<h3><a name="cps and the call stack">CPS and the call stack</a></h2>

<p>Luke Palmer wondered if there would be a standard way of inspecting the call
stack (for debugging/<code>caller</code>/etc). (I think I'm going to switch to
using the phrase 'call chain' rather than call stack, as the presence of
continuations makes the call 'stack' look pretty unstacklike....).</p>

<p>Leo and Dan both thought that this would be a high level language issue
rather than a Parrot issue, though Dan did note that there might be useful
things that Parrot could do to make such introspection easier/possible.</p>

<p><a
href="http://groups.google.com/groups?threadm=ygcllvmh1ya.fsf%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>

<h3><a name="continuation manipulation">Continuation manipulation</a></h2>

<p>Leo T&ouml;tsch has been thinking about occasions when one might need to
monkey with the internals of an existing continuation (he was thinking about
the <code>warnings</code> state) and proposed several solutions. Dan favoured
his new opcode, <code>updatecc</code> and thought it would be good to be able
to broaden the scope of what one could update in a continuation/context. This
scared Leo somewhat, but Dan came up with some examples of where it might prove
to be useful.</p>

<p><a
href="http://groups.google.com/groups?threadm=3EFD8D74.2090506%40nextra.at">http://groups.google.com/groups</a></p>

<hr />

<h2><a name="meanwhile in perl6language">Meanwhile in perl6-language</a></h1>

<p>Almost nothing happened. There were all of 15 messages.</p>

<h3><a name="perl 6 daydreams">Perl 6 Daydreams</a></h3>

<p>Miko O'Sullivan engaged in some summer daydreaming by asking what everyone
was looking forward to most from Perl 6. Miko himself is looking forward to
more Pure Perl modules. If Perl 6 delivers on its performance promises then
there are going to be more and more things where implementing directly in Perl
will be fast enough, and Perl is so much easier to implement in than C....</p>

<p>Jonathan Scott Duff incurred Cozeny when he said that he's hoping that by
this time next year we'll have an 85% complete Perl 6 that will be usable in
production (by brave people). Simon Cozens noted that we already have such a
beast and it's called Perl 5. For some reason this led to a new marketing
slogan being proposed: Perl 6, the reconstituted cheeseburger of programming
languages. Somehow I don't think that one's going to fly. (I just read this bit
out loud to my wife and she says that she really doesn't like the thought of a
flying reconstituted cheeseburger, so I think we'd best leave it at that.</p>

<p><a
href="http://groups.google.com/groups?threadm=20030628024829.M17737%40rescuemission.net">http://groups.google.com/groups</a></p>

<hr />

<h2><a name="acknowledgements, announcements and apologies">Acknowledgements,
Announcements, and Apologies</a></h1>

<p>Tcha! I announce the retirement of Leon Brocard from his post as Perl 6
Summary Running Joke and put the right to choose the next joke up for auction
at YAPC. And what do you know, the winner of the auction nominates Leon Brocard
as the new running joke. So, settle in for another year of desperate
rationalizations for mentioning Leon in these summaries. Who knows, maybe
Leon's Parrot related workrate will go up to such an extent that it'll be easy,
but somehow I doubt it.</p>

<p>Thanks to, in chronological order, Adam Turoff and Lisa Wolfisch; Walt
Mankowski, Mark-Jason and Laurie Dominus; Dave Adler; Dan and Karen Sugalski;
and Uri and Linda Guttman for being such fine hosts in Washington,
Philadelphia, New York, Hartford, and Boston respectively. Next time we do
this, we will not be attempting to visit quite so many cities on the Eastern
Seaboard in such a short time. At one point all we were seeing was Perl nerds
and freeways in rapid succession.</p>

<p>As ever, if you've appreciated this summary, please consider one or more of
the following options:</p>

<ul>

<li>Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.</li>

<li>Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>

<li>Send feedback, flames, money, photographic, and writing commissions, or a
cute little iPod with a huge capacity to satisfy my technolust <em><a
href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em>.</li>

</ul>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1148" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/06/p6pdigest/20030622.html" rel="bookmark">This week on Perl 6, week ending 2003-06-22</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-06-23T00:00:00-08:00">June 23, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Welcome to my first anniversary issue of the Perl 6 Summary. Hopefully there
won't be too many more anniversaries to celebrate before we have a real, running
Perl 6, but there's bound to be ongoing development after that. My job is
secure!</p>

<p>Because I can't think of anything better to do, I'll start with the action
on the perl6-internals list.</p>

<h3>Converting parrot to continuation passing style</h3>

<p>The ongoing effort to convert Parrot to use/support continuation passing
style (CPS) at the assembler level continues. Jonathan Sillito offered another
patch implementing the require support, which Dan liked and applied.</p>

<p><a href="http://groups.google.com/groups?threadm=3EF35FFC.3080801%40softhome.net">http://groups.google.com/groups</a></p>

<p>Klaas-Jan Stol wondered what he'd missed; last time he looked Parrot wasn't
doing continuation passing. He asked why Dan had chosen to go down that route.
Dan answered that he had realized that "we had to save off so much state that
we essentially had a continuation anyway". Explicitly going with continuation
passing just made things more formal, and wrapped up all the context saving
behind a straightforward interface. He promised a more detailed explanation
later.</p>

<p><a href="http://groups.google.com/groups?threadm=a0521060dbb1b83b3bddf%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>

<h3>Portable way of finding libc, unbuffered reads</h3>

<p>Clinton Pierce noted that the following code:</p>

<pre><code>    loadlib P1, &quot;/lib/libc.so.6&quot;
    dlfunc P0, P1, &quot;system&quot;, &quot;it&quot;
    set I0, 1
    set S5, &quot;ls&quot;
    invoke
    end</code></pre>

<p>just works, which simultaneously pleases and scares him silly. He wondered
if there was a good way of finding the standard C library on a Unix system
without scary hardwiring as in the fragment above. He also wondered if there
was an "official" way of getting an unbuffered read via parrot.</p>

<p>Jens Rieks came up with a gloriously evil way of finding libc. The theory
goes that Parrot is linked against libc, so you just have to
<code>dlopen</code> the running image and you can call libc functions to your
heart's content. To dlopen the running image you need to pass a NULL pointer to
the underlying <code>loadlib</code> so he offered a patch to <em>core.ops</em>
which interpreted an empty string as a pointer to NULL. Leo and Dan were
impressed and the patch (or something similar) was applied. I get the feeling
that Dan wants to do something a little less hacky to access the current
executable though....</p>

<p>Clint noted that the dlopen the running image by passing a null pointer
trick doesn't work with Windows, but outlined a workaround for that too. Jen
Rieks suggested a better Windows workaround.</p>

<p>Nobody came up with an approved way of doing <code>getc</code>, but once you
have libc loaded you can just use its <code>getc</code>.</p>

<p><a href="http://groups.google.com/groups?threadm=5.1.0.14.2.20030616163614.01f8db18%40mail.geeksalad.org">http://groups.google.com/groups</a></p>

<h3>OO, Objects</h3>

<p>If you look in a fresh from CVS parrot directory you'll now find
<em>object.ops</em>, which will be the cause of much rejoicing in many
places. Dan's nailed the object spec down enough that he's started implementing
a few of the required ops. As he points out, what we have is "hardly
sufficient", but everyone's got to start somewhere, the journey of a thousand
miles begins with but a single step, etc.</p>

<p>Judging by the number of comments (none), everyone was stunned into silence.</p>

<p><a href="http://groups.google.com/groups?threadm=a05210600bb16013a7965%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>

<h3>More CPS shenanigans</h3>

<p>I get the strong feeling that Leo T&ouml;tsch isn't entirely happy with the
new Continuation Passing Style regime. He's worried that the P6C tests break,
and that CPS subs are some 3 times slower for calling the sub. This led into a
discussion of what context really must go into a continuation, whether we can
get away with different classes of continuation (hold more or less contextual
information) and other ways of possibly speeding things up.</p>

<p>I'm not sure Leo has been entirely convinced, but I'm confident that Dan's
not going to change his mind about this.</p>

<p>Leo later submitted a large patch which unifies the various subroutine
related PMCs to take into account CPS.</p>

<p><a href="http://groups.google.com/groups?threadm=3EF08047.8070803%40nextra.at">http://groups.google.com/groups</a></p>

<h3>Exceptions</h3>

<p>Now that the rules for subs/methods etc are settling down, Dan outlined his
thoughts on exception handlers. If I'm understanding him correctly, an
exception handler is just a continuation that you invoke with the exception as
its only argument. There were no comments by the end of the week.</p>

<p><a href="http://groups.google.com/groups?threadm=a0521060abb1a415c7209%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>

<h2>Meanwhile in perl6-language</h2>

<p>The language list was quiet again. Maybe everyone was doing face to face
things at YAPC. Or on holiday. Or something.</p>

<h3><code>printf</code> like formatting in interpolated strings</h3>

<p>Remember last week I mentioned that Luke Palmer had made a cool suggestion
about <code>printf</code> like formatting in string interpolation?  (He
suggested a syntax like <code>rx/&lt;expression&gt; but
formatted(&lt;formatspec&gt;)/</code>, which I for one quite liked).</p>

<p>Edwin Steiner wasn't so keen, noting that Luke's suggestion was actually
more verbose than <code>rx/sprintf &lt;formatspec&gt;,
&lt;expression&gt;/</code>. He wasn't entirely sure that having a formatting
rule attached to a value with a 'but' was really the right thing to do (it does
rather violate the whole model/view/controller abstraction for instance).
Edwin's favoured interpolation syntax was,</p>

<pre><code>  rule formatted_interpolation {\\F &lt;formatspec&gt; &lt;interpolatable_atom&gt;}
  rule formatspec { # sprintf format without '%' 
  }
  rule interpolatable_atom { &lt;variable&gt; | \$\( &lt;expr&gt; \) }</code></pre>

<p>(or something along those lines). Edwin went on to extend his idea, allowing
for all sorts of clever interpolation rules, leading Dave Storrs to comment
that the Obfuscated Perl people would certainly thank him if the suggestions
went in.</p>

<p>Arcadi Shehter came up with yet another suggested syntax involving
<code>:</code> (neglecting the important rule that, whilst one's heart may
belong to Daddy, the <code>:</code> belongs to Larry. And I'm really trying not
to think about the images that conjures up).</p>

<p>At this point, we ended up in a philosophical discussion about when was the
right time to do stuff, generality of solutions and Perl remaining Perl. I
remain confident that come the appropriate time, Larry and/or Damian (more
likely Damian given some of the stuff he was showing off to do with formatting
at YAPC) will nail things down and we'll all go "Of course!" and move onto the
next thing.</p>

<p><a href="http://groups.google.com/groups?threadm=ygcwufmwx2x.fsf%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>

<h3>Dispatching, Multimethods and the like</h3>

<p>Adam Turoff noted that, in his YAPC opening talk, Damian had mentioned the
catchall DISPATCH sub, which will allow for altering the dispatch behaviour to
do any magic you choose. The 'problem' with DISPATCH is defining its
interaction with the likes of AUTOLOAD and other built in dynamic dispatch
behaviours, which will need to be nailed down.</p>

<p>Dan Sugalski jetted over from perl6-internals to give the lowdown on what
would be available at the parrot level (which may or may not be exposed at the
Perl 6 language level). Essentially, what we know is that there will be the
capability to insert any dispatch method you like, but the details of how you'd
do it aren't thrashed out yet. It almost certainly won't be easy, but that's a
good thing.</p>

<p><a href="http://groups.google.com/groups?threadm=20030616145807.GA16195%40panix.com">http://groups.google.com/groups</a></p>

<h3>Type Conversion Matrix, Pragmas (Take 4)</h3>

<p>Discussion of Mike Lazzaro's type conversion matrix continued as people
explored corner cases.</p>

<p><a href="http://groups.google.com/groups?threadm=319DBDC4-A01E-11D7-B141-000A277AA894%40cognitivity.com">http://groups.google.com/groups</a></p>

<h2>Acknowledgements, Announcements and Apologies</h2>

<p>Whee! My first anniversary! I confess that when I started writing these
things I didn't expect to keep going for this long. Now I don't expect to ever
stop.</p>

<p>After due and careful consideration of a short shortlist, I should like to
award an anniversary virtual white parrot award to Leopold "Patchmonster"
T&ouml;tsch for his astonishing contribution to the Parrot core. Other mental
nominees for this award were: Clinton A Pierce, for BASIC and the associated
bug finding; Leon Brocard, for humorous reasons and Robert Spier and Ask
Bj&oslash;rn Johansen for invaluable and invisible work on websites, CVS and
mailing list maintenance.</p>

<p>I eliminated the core design team from consideration for the above award,
but I'd like to formally thank Larry, Damian, Allison and Dan, without
whom...</p>

<p>As I said last week, Leon Brocard is no longer the summaries' running joke.
However, I auctioned off the right to specify the next running joke at YAPC
last week; next week should see the unveiling of the new, improved Perl 6
Summary Running Joke.</p>

<p>If you've appreciated this summary, please consider one or more of the
following options:</p>

<ul>

<li>Send money to the Perl Foundation at <a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a>
and help support the ongoing development of Perl.</li>

<li>Get involved in the Perl 6 process. The mailing lists are open  to all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a> are good 
starting points with links to the appropriate mailing lists.</li>

<li>Send feedback, flames, money, photographic and writing commissions, or a
cute little iPod with a huge capacity to satisfy my technolust <em><csperl file="mailmunge" arg_email="p6summarizer@bofh.org.uk" /></em>.</li>

</ul>







        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1138" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/06/19/treasures.html" rel="bookmark">Hidden Treasures of the Perl Core, part II</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Casey West</span> on <abbr class="published" title="2003-06-19T00:00:00-08:00">June 19, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>In the <a href="/pub/a/2003/05/29/treasures.html">previous hidden
treasures article</a>, we looked at some easy-to-use (but not well-known) modules in
the Perl Core. In this article, we dig deeper to uncover some of the truly precious
and unique gems in the Perl Core.</p>

<h2><a name="constant"><code>constant</code></a></h2>

<p>The <code>constant</code> pragma is not new or unknown, but it is a nice feature
enhancement.  Many people have used constant. Here is a standard example
of using the constant for &pi;.</p>

<pre><code>use constant PI =&gt; 22/7;</code></pre>

<p>When <code>constant</code>s are used in programs or modules, they are often used in a
set.  Older versions of Perl shipped with a <code>constant</code> pragma that required
a high level of work to produce a set.</p>

<pre><code>        use constant SUNDAY  =&gt; 0;
        use constant MONDAY  =&gt; 1;
        use constnat TUESDAY =&gt; 2;</code></pre>

<p>Wow, that's a lot of work!  I've already given up on my program, not to
mention the syntax error in the declaration of <code>TUESDAY</code>.  Now let's
try this again using the multiple declaration syntax, new to the
<code>constant</code> pragma for Perl 5.8.0.</p>

<pre><code>        use constant {
                SUNDAY    =&gt; 0,
                MONDAY    =&gt; 1,
                TUESDAY   =&gt; 2,
                WEDNESDAY =&gt; 3,
                THURSDAY  =&gt; 4,
                FRIDAY    =&gt; 5,
                SATURDAY  =&gt; 6,
        };</code></pre>
		
<p>The only warning here is that this syntax is new to Perl 5.8.0.  If you
intend to distribute a program using multiple constant declarations,
then remember the limitations of the program.  You may want to specify what
version of Perl is required for your program to work.</p>

<pre><code>        use 5.8.0;</code></pre>

<p>Perl will throw a fatal error if the version is anything less than
<code>5.8.0</code>.</p>

<h2><a name="attribute::handlers"><code>Attribute::Handlers</code></a></h2>

<p>This module allows us to play with Perl's subroutine attribute syntax
by defining our attributes.  This is a powerful module with a
rich feature set.  Here I'll give you an example of writing a minimal
debugger using subroutine attributes.</p>

<p>First, we need to create an attribute.  An attribute is any subroutine
that has an attribute of <code>:ATTR</code>.  Setting up our <code>debug</code> attribute
is easy.</p>

<pre><code>        use Attribute::Handlers;</code></pre>
<pre><code>        sub debug :ATTR {
                my (@args) = @_;
                warn &quot;DEBUG: @args\n&quot;;
        }</code></pre>
		
<p>Now we have a simple debug attribute named <code>:debug</code>.   Using
our attribute is also easy.</p>

<pre><code>        sub table :debug {
                # ...
        }
        table(%data);
        table(%other_data);</code></pre>

<p>Now, since attributes are compiled just before runtime, in the <code>CHECK</code>
phase, our debugging output will only be sent to <code>STDERR</code> once.  For the
code above, we might get output like this:</p>

<pre><code>        DEBUG: main GLOB(0x523d8) CODE(0x2e758) debug  CHECK
           Casey  Dad
        Chastity  Mom
         Evelina  Kid
        Coffee  Oily
          Cola  Fizzy</code></pre>
		  
<p>That debug string represents some of the information we get in an attribute
subroutine.  The first argument is the name of the package the attribute
was declared in.  Next is a reference to the symbol table entry for the
subroutine, followed by a reference to the subroutine itself.  Next comes
the name of the attribute, followed by any data associated with the attribute
(none in this case).  Finally, the name of the phase that invoked the handler
passed.</p>

<p>At this point, our debugging attribute isn't useful, but the parameters
we are given to work with are promising.  We can use them to invoke
debugging output each time the subroutine is called.  Put on your hard hat,
this is where things get interesting.</p>

<p>First, let us take a look at how we want to debug our subroutine.  I think we'd
like different levels of debugging output.  At the lowest level (<code>1</code>), the name
of the subroutine being invoked should be sent to <code>STDERR</code>.  At the next
level (<code>2</code>), it would be nice to be notified of entry and exit of the subroutine. Going further (level <code>3</code>), we might want to see the arguments passed to the
subroutine.  Even more detail can be done, but we'll save that for later and
stop at three debug levels.</p>

<p>In order to do this voodoo, we need to replace our subroutine with one doing
the debugging for us.  The subroutine doing the debugging must then invoke
our original code with the parameters passed to it, and return the proper output
from it.  Here is the implementation for debug level one (<code>1</code>).</p>

<pre><code>        use Attribute::Handlers;
        use constant {
                PKG    =&gt; 0,
                SYMBOL =&gt; 1,
                CODE   =&gt; 2,
                ATTR   =&gt; 3,
                DATA   =&gt; 4,
                PHASE  =&gt; 5,
        };
        sub debug :ATTR {
                my ($symbol, $code, $level) = @_[SYMBOL, CODE, DATA];
                $level ||= 1;
                
                my $name = join '::', *{$symbol}{PACKAGE}, *{$symbol}{NAME};
                
                no warnings 'redefine';
                *{$symbol} = sub {
                        warn &quot;DEBUG: entering $name\n&quot;;
                        return $code-&gt;(@_);
                };
        }
        sub table :debug {
                # ...
        }
        table(%data);
        table(%other_data);</code></pre>

<p>There are some sticky bits in the debug subroutine that I need to explain
in more detail.</p>

<pre><code>        my $name = join '::', *{$symbol}{PACKAGE}, *{$symbol}{NAME};</code></pre>

<p>This line is used to find the name and package of the subroutine we're debugging.
We do the lookups from the symbol table, using the reference to the symbol that
our attribute is given.</p>

<pre><code>        no warnings 'redefine';</code></pre>

<p>Here we turn off warnings about redefining a subroutine, because we're going
to redefine a subroutine on purpose.</p>

<pre><code>        *{$symbol} = sub { ... };</code></pre>

<p>This construct simply replaces the code section in the symbol table with this
anonymous subroutine (which is a code reference).</p>

<p>In this example, we set the default log level to one (<code>1</code>), set up some helper variables, and replace our <code>table()</code> subroutine with a debugging closure.  I
call the anonymous subroutine a closure because we are reusing some variables
that are defined in the <code>debug()</code> subroutine.  Closures are explained in greater
detail in <em>perlref</em> (<code>perldoc perlref</code> from the command line).</p>
<p>To set the debug level for a subroutine, just a number the <code>:debug</code> attribute.</p>

<pre><code>        sub table :debug(1) {
                # ...
        }</code></pre>

<p>The output looks something like this:</p>

<pre><code>        DEBUG: entering main::table
           Casey  Dad
        Chastity  Mom
         Evelina  Kid
        DEBUG: entering main::table
        Coffee  Oily
          Cola  Fizzy</code></pre>
		  
<p>Creating debug level two (<code>2</code>) is pretty easy from here.  Time stamps will
also be added to the output, which are useful for calculating how long your
subroutine takes to run.</p>

<pre><code>        *{$symbol} = sub {
                warn sprintf &quot;DEBUG[%s]: entering %s\n&quot;,
                        scalar(localtime), $name;
                my @output = $code-&gt;(@_);
                if ( $level &gt;= 2 ) {
                        warn sprintf &quot;DEBUG[%s]: leaving %s\n&quot;,
                                scalar(localtime), $name;
                }
                return @output;
        };</code></pre>
		
<p>In this example, we use <code>sprintf</code> to make out debugging statements a little
more readable as complexity grows.  This time, we cannot return directly from
the original code reference.  Instead, we have to capture the output and return
it at the end of the routine.  When the <code>table()</code> subroutine defines its debug
level as <code>:debug(2)</code> the output is thus.</p>

<pre><code>        DEBUG[Wed Jun 18 12:18:44 2003]: entering main::table
           Casey  Dad
        Chastity  Mom
         Evelina  Kid
        DEBUG[Wed Jun 18 12:18:44 2003]: leaving main::table
        DEBUG[Wed Jun 18 12:18:44 2003]: entering main::table
        Coffee  Oily
          Cola  Fizzy
        DEBUG[Wed Jun 18 12:18:44 2003]: leaving main::table</code></pre>
		
<p>Finally, debug level three (<code>3</code>) should also print the arguments passed
to the subroutine.  This is a simple modification to the first debugging
statement.</p>

<pre><code>        warn sprintf &quot;DEBUG[%s]: entering %s(%s)\n&quot;,
                scalar(localtime), $name, ($level &gt;= 3 ? &quot;@_&quot; : '' );</code></pre>

<p>The resulting output.</p>

<pre><code>        DEBUG[Wed Jun 18 12:21:06 2003]: entering main::table(Chastity Mom Casey Dad Evelina Kid)
           Casey  Dad
        Chastity  Mom
         Evelina  Kid
        DEBUG[Wed Jun 18 12:21:06 2003]: leaving main::table
        DEBUG[Wed Jun 18 12:21:06 2003]: entering main::table(Coffee Oily Cola Fizzy)
        Coffee  Oily
          Cola  Fizzy
        DEBUG[Wed Jun 18 12:21:06 2003]: leaving main::table</code></pre>
		
<p><code>Attribute::Handlers</code> can do quite a lot more than what I've shown you already.
If you like what you see, then you may want to add attributes to variables or worse.
Please read the thorough documentation provided with the module.</p>

<h2><a name="b::deparse"><code>B::Deparse</code></a></h2>

<p>This module is a well-known Perl debugging module.  It generates Perl source
code from Perl source code provided to it.  This may seem useless to some,
but to the aspiring obfuscator, it's useful in understanding odd code.</p>

<pre><code>        perl -snle'$w=($b=&quot;bottles of beer&quot;).&quot; on the wall&quot;;$i&gt;=0?print:last
        LINE for(map &quot;$i $_&quot;,$w,$b),&quot;take one down, pass it around&quot;,
        do{$i--;&quot;$i $w!&quot;}' -- -i=100</code></pre>

<p>That is an example of an obfuscated program.  It could be worse, but it's
pretty bad already.  Understanding this gem is as simple as adding
<code>-MO=Deparse</code> to the command line.  This will use <code>B::Deparse</code> to turn that mess into more readable Perl source code.</p>

<pre><code>        LINE: while (defined($_ = &lt;ARGV&gt;)) {
                chomp $_;
                $w = ($b = 'bottles of beer') . ' on the wall';
                foreach $_ (
                         map(&quot;$i $_&quot;, $w, $b),
                         'take one down, pass it around',
                         do { --$i; &quot;$i $w!&quot; }
                       ) {
                        $i &gt;= 0 ? print($_) : last LINE;
                }
        }</code></pre>
		
<p>To use <code>B::Deparse</code> in the everyday example, just run your program using
it on the command line.</p>

<pre><code>        perl -MO=Deparse prog.pl</code></pre>

<p>But if you want to have some real fun, then dig into the object-oriented interface
for <code>B::Deparse</code>.  There you will find an amazing method called <code>coderef2text()</code>. This method turns any code reference to text, just like the command line trick does for an entire program.  Here is a short example.</p>

<pre><code>        use B::Deparse;
        
        my $deparser = B::Deparse-&gt;new;
        
        print $deparser-&gt;coderef2text(
                sub { print &quot;Hello, world!&quot; }
        );</code></pre>
		
<p>The output will be the code block, after it's been deparsed.</p>

<pre><code>        {
        print 'Hello, world!';
        }</code></pre>
		
<p>We can use this to add another debug level to our <code>Attribute::Handlers</code>
example.  Here, debug level four (<code>4</code>) will print out the source of
our subroutine.</p>

<p>Before our <code>debug()</code> subroutine declaration we add the following lines
of code.</p>

<pre><code>        use B::Deparse;
        my $deparser = B::Deparse-&gt;new;</code></pre>

<p>Next, our debugging closure declaration is updated to print out the
full subroutine with the <code>DEBUG: </code> prefix on each line.</p>

<pre><code>        *{$symbol} = sub {
                warn sprintf &quot;DEBUG[%s]: entering %s(%s)\n&quot;,
                        scalar(localtime), $name, ($level &gt;= 3 ? &quot;@_&quot; : '' );
                if ( $level &gt;= 4 ) {
                        my $sub = sprintf &quot;sub %s %s&quot;,
                                $name, $deparser-&gt;coderef2text( $code );
                        $sub =~ s/\n/\nDEBUG: /g;
                        warn &quot;DEBUG: $sub\n&quot;;
                }
                my @output = $code-&gt;(@_);
                if ( $level &gt;= 2 ) {
                        warn sprintf &quot;DEBUG[%s]: leaving %s\n&quot;,
                                scalar(localtime), $name;
                }
                return @output;
        };</code></pre>

<p>The verbose debugging output looks like this.</p>

<pre><code>        DEBUG[Wed Jun 18 12:47:22 2003]: entering main::table(Chastity Mom Casey Dad Evelina Kid)
        DEBUG: sub main::table {
        DEBUG:    BEGIN {${^WARNING_BITS} = &quot;UUUUUUUUUUUU&quot;}
        DEBUG:    use strict 'refs';
        DEBUG:    my(%data) = @_;
        DEBUG:    my $length = 0;
        DEBUG:    foreach $_ (keys %data) {
        DEBUG:        $length = length $_ if length $_ &gt; $length;
        DEBUG:    }
        DEBUG:    my $output = '';
        DEBUG:    while (my($k, $v) = each %data) {
        DEBUG:        $output .= sprintf(&quot;%${length}s  %s\n&quot;, $k, $v);
        DEBUG:    }
        DEBUG:    print &quot;\n$output&quot;;
        DEBUG:}
           Casey  Dad
        Chastity  Mom
         Evelina  Kid
        DEBUG[Wed Jun 18 12:47:22 2003]: leaving main::table</code></pre>
		
<p>There are more methods in the <code>B::Deparse</code> class that you can use to muck
around with the results of <code>coderef2text()</code>.  This module is powerful
and useful for debugging.  I suggest you at least use the simple version if
code becomes ambiguous and incomprehensible.</p>

<p>While <code>B::Deparse</code> is good at what it does, it's not complete.  Each
version of Perl has made it better, and it's good in Perl 5.8.0.  Don't
trust <code>B::Deparse</code> to get everything right, though.  For instance, I
wouldn't trust it to serialize code for later use.</p>

<h2><a name="class::struct"><code>Class::Struct</code></a></h2>

<p>This module, just like the <code>constant</code> pragma, is well-known.  The
difference is that <code>Class::Struct</code> is not often used.  For many programs,
setting up a class to represent data would be ideal, but overkill.
<code>Class::Struct</code> gives us the opportunity to live in our ideal world
without the pain of setting up any classes by hand.  Here
is an example of creating a class with <code>Class::Struct</code>.  In this
example, we're going to use compile time-class declarations, a new feature
in Perl 5.8.0.</p>

<pre><code>        use Class::Struct Person =&gt; {
                name =&gt; '$',
                mom  =&gt; 'Person',
                dad  =&gt; 'Person',
        };</code></pre>

<p>Here we've created a class called <code>Person</code> with three attributes.
<code>name</code> can contain a simple scalar value, represented by the dollar
sign (<code>$</code>).  <code>mom</code> and <code>dad</code> are both objects of type <code>Person</code>.
Using our class within the same program is the same as using any
other class.</p>

<pre><code>        my $self = Person-&gt;new( name =&gt; 'Casey West' );
        my $wife = Person-&gt;new( name =&gt; 'Chastity West' );
        my $baby = Person-&gt;new(
                name =&gt; 'Evelina West',
                mom  =&gt; $wife,
                dad  =&gt; $self,
        );
        printf &lt;&lt;__FORMAT__, $baby-&gt;name, $baby-&gt;mom-&gt;name;
        %s, daughter of %s,
        went on to cure cancer and disprove Fermat's Theorem.
        __FORMAT__</code></pre>
		
<p><code>Class::Struct</code> classes are simple by design, and can get more complex
with further creativity.  For instance, to add a method to the <code>Person</code>
class you can simply declare it in the <code>Person</code> package.  Here is a
method named <code>birth()</code> which should be called on a Person object.  It
takes the name of the baby as an argument, and optionally the father
(a <code>Person</code> object).  Returned is a new <code>Person</code> object representing
the baby.</p>

<pre><code>        sub Person::birth {
                my ($self, $name, $dad) = @_;
                return Person-&gt;new(
                        name =&gt; $name,
                        mom  =&gt; $self,
                        dad  =&gt; ( $dad || undef ),
                );
        }</code></pre>

<p>These object are not meant to be persistent.  If you want persistent
objects, then you need to look elsewhere, perhaps <code>Class::DBI</code> or any
other implementation, of which there are many.</p>

<p>These in-memory objects can help to clean up your code, but they add
a bit of overhead.  You have to decide where the balance in your program
is.  In most cases, using <code>Class::Struct</code> is going to be OK.</p>

<h2><a name="encode"><code>Encode</code></a></h2>

<p><code>Encode</code> is Perl's interface to Unicode.  An explanation of Unicode itself
is far beyond the scope of this article.  In fact, it's far beyond the scope
of most of us.  This module is powerful.  I'm going to provide some examples
and lots of pointers to the appropriate documentation.</p>

<p>The first function of the API to learn is <code>encode()</code>.  <code>encode()</code> will convert a string for Perl's internal format to a series of octets in the
encoding you choose.  Here is an example.</p>

<pre><code>        use Encode;
        my $octets = encode( &quot;utf8&quot;, &quot;Hello, world!&quot; );</code></pre>

<p>Here we have turned the string <em>Hello, world!</em> into a <code>utf8</code> string, which is now in <code>$octets</code>.  We can also decode strings using the <code>decode()</code> function.</p>

<pre><code>        my $string = decode( &quot;utf8&quot;, $utf8_string );</code></pre>

<p>Now we've decoded a <code>utf8</code> string into Perl's internal string representation.
Since <code>utf8</code> is a common encoding to deal with, there are two helper functions:
<code>encode_utf8()</code>, and <code>decode_utf8</code>.  Both of these function take a string
as the argument.</p>

<p>A list of supported encodings can be found in <code>Encode::Supported</code>, or by
using the <code>encodings()</code> method.</p>

<pre><code>        my @encodings = Encode-&gt;encodings;</code></pre>

<p>For even more Unicode fun, dive into the documentation in <code>Encode</code>
(<code>perldoc Encode</code> on the command line).</p>

<h2><a name="filter::simple"><code>Filter::Simple</code></a></h2>

<p>This module gives us an easy way to write source-code filters.  These
filters may change the behavior of calling Perl code, or implement new
features of Perl, or do anything else they want.  Some of the more
infamous source-filter modules on the CPAN include <code>Acme::Bleach</code>,
<code>Semi::Semicolons</code>, and even <code>Switch</code>.</p>

<p>In this article, I'm going to implement a new comment syntax for Perl.
Using the following source-filter package will allow you to comment
your code using SQL comments.  SQL comments begin with two consecutive
dashes (<code>--</code>).  For our purposes, these dashes cannot be directly
followed by a semicolon (<code>;</code>) or be preceded by something other than
whitespace or a the beginning of a line.</p>

<pre><code>        package SQLComments;
        use Filter::Simple sub {
                s/(?:^|\s)--(?!;)/#/g;
        };
        1;</code></pre>
		
<p>In this example, we create an anonymous subroutine that is passed on
to <code>Filter::Simple</code>.  The entire source of the calling program is
in <code>$_</code>, and we use a regular expression to search for our SQL comments
and change them to Perl comments.</p>

<p>Using our new source filter works like this.</p>

<pre><code>        use SQLComments;
        -- Here is some code that decrements a variable.
        my $i = 100; -- start at 100.
        while ( $i ) {
                $i--; -- decrement
        }
        -- That's it!.</code></pre>
		
<p>Using <code>B::Deparse</code> on the command line, we can see what the code
looks like after it's filtered.  Just remember that <code>B::Deparse</code>
doesn't preserve comments.</p>

<pre><code>        use SQLComments;
        
        my $i = 100;
        while ($i) {
            --$i;
        }</code></pre>

<p>The output is exactly as we expect.  Filtering source code is a complex art.
If your filters are not perfect, then you can break code in unexpected ways.
Our <code>SQLComments</code> filter will break the following code.</p>

<pre><code>        print &quot;This is nice -- I mean really nice!\n&quot;;</code></pre>

<p>It will turn into this.</p>

<pre><code>        print &quot;This is nice# I mean really nice!\n&quot;;</code></pre>

<p>Not exactly the results we want.  This particular problem can be avoided,
however, using <code>Filter::Simple</code> in a slightly different way.  You can
specify filters for different sections of the source code, here is how
we can limit our <code>SQLComments</code> filter to just code and not quote-like
constructs.</p>

<pre><code>        package SQLComments;
        
        use Filter::Simple;
        
        FILTER_ONLY code =&gt; sub { s/(?:^|\s)--(?!;)/#/g };</code></pre>

<p>If you want to learn more about source filters, then read the documentation
provided in <code>Filter::Simple</code>.</p>

<h2><a name="variable_utility_modules">Variable Utility Modules</a></h2>

<p>There are some functions that are repeated in hundreds (probably thousands)
of programs.  Think of all the sorting functions written in C programs.  Perl
programs have them, too, and the following utility modules try to clean up our
code, eliminating duplication is simple routines.</p>

<p>There are a number of useful functions in each of these modules.  I'm going to
highlight a few, but be sure to read the documentation provided with each
of them for a full list.</p>

<dl>
<dt><strong><a name="item_scalar%3a%3autil"><code>Scalar::Util</code></a></strong><br />
</dt>
<dd>
<code>blessed()</code> will return the package name that the variable is blessed into,
or <code>undef</code> if the variable isn't blessed.
</dd>
<dd><pre><code>        my $baby  = Person-&gt;new;
        my $class = blessed $baby;</code></pre>
</dd>
<dd>
<p><code>$class</code> will hold the string <em>Person</em>.  <code>weaken</code> is a function that
takes a reference and makes it weak.  This means that the variable will
not hold a reference count on the thing it references.  This is useful
for objects, where you want to keep a copy but you don't want to stop
the object from being <code>DESTROY</code>-ed at the right time.</p>
</dd>
<dt><strong><a name="item_list%3a%3autil"><code>List::Util</code></a></strong><br />
</dt>
<dd>
The <code>first()</code> function returns the first element in the list for which
the block returns true.
</dd>
<dd>
<pre><code>        my $person = first { $_-&gt;age &lt; 18 } @people;</code></pre>
</dd>
<dd>
<p><code>shuffle()</code> will return the elements of the list in random order.  Here
is an example of breaking a group of people into teams.</p>
</dd>
<dd>
<pre><code>        my @people = shuffle @people;
        
        my @team1  = splice @people,  0, (@people/2);
        my @team2  = @people;</code></pre>
</dd>
<dd>
<p>Finally, <code>sum</code> returns the sum of all the elements in a list.</p>
</dd>
<dd>
<pre><code>        my $sum = sum 1 .. 10;</code></pre>
</dd>
<dt><strong><a name="item_hash%3a%3autil"><code>Hash::Util</code></a></strong><br />
</dt>
<dd>
<a href="#item_hash%3a%3autil"><code>Hash::Util</code></a> has a slightly different function than the previously
discussed variable utility modules.  This module implements restricted
hashes, which are the predecessor to the undesirable (and now obsolete)
pseudo-hashes.
</dd>
<dd>
<p><code>lock_keys()</code> is a function that will restrict the allowed keys of a
hash.  If a list of keys is given, the hash will be restricted to that
set, otherwise the hash is locked down to the currently existing keys.</p>
</dd>
<dd><pre><code>        use Hash::Util qw[lock_keys];
        
        my %person = (
                name =&gt; &quot;Casey West&quot;,
                dad  =&gt; $dad,
                mom  =&gt; $mom,
        );
        
        lock_keys( %person );</code></pre>
		
<p>The <code>%person</code> hash is now restricted.  Any keys currently in the
hash may be modified, but no keys may be added.  The following code
will result in a fatal error.</p>
</dd>
<dd>
<pre><code>        $person{wife} = $wife;</code></pre>
</dd>
<dd>
<p>You can use the <code>unlock_keys()</code> function to release your restricted
hash.</p>
</dd>
<dd>
<p>You can also lock (or unlock) a value in the hash.</p>
</dd>
<dd>
<pre><code>        lock_value( %person, &quot;name&quot; );
        $person{name} = &quot;Bozo&quot;; # Fatal error!</code></pre>
</dd>
<dd>
<p>Finally, you can lock and unlock an entire hash, making it read only
in the first case.</p>
</dd>
<dd>
<pre><code>        lock_hash( %person );</code></pre>
</dd>
<dd><p>Now our <code>%person</code> hash is really restricted.  No keys can be added or
deleted, and no values can be changed.  I know all those OO folks out there
wishing Perl made it easy to keep class and instance data private are
smiling.</p>
</dd>
</dl>

<h2><a name="locale_modules"><code>Locale</code> Modules</a></h2>

<p>I've seen these modules implemented time and time again.  Perl 5.8.0 introduced
them.  Each of them implements a set of functions that handle locale issues for
you.</p>

<dl>
<dt><strong><a name="item_locale%3a%3alanguage"><code>Locale::Language</code></a></strong><br />
</dt>
<dd>
This module will translate language codes to names, and vice-versa.
</dd>
<dd>
<pre><code>        my $lang = code2language( 'es' );      # Spanish
        my $code = language2code( 'English' ); # en</code></pre>
</dd>
<dd>
<p>You can also get a full list of supported language names and codes.</p>
</dd>
<dd>
<pre><code>        my @codes = all_language_codes();
        my @names = all_language_names();</code></pre>
</dd>
<dt><strong><a name="item_locale%3a%3acountry"><code>Locale::Country</code></a></strong><br />
</dt>
<dd>
<p>Convert country names to codes, and vice-versa.  By default country codes
are represented in two character codes.</p>
</dd>
<dd>
<pre><code>        my $code = country2code( 'Finland' ); # fi</code></pre>
</dd>
<dd>
<p>You can change the default behavior to get three character codes, or the
numeric country codes.</p>
</dd>
<dd>
<pre><code>        my $code = country2code( 'Russia', LOCALE_CODE_ALPHA_3 ); # rus
        my $num  = country2code( 'Australia', LOCALE_CODE_NUMERIC ); # 036</code></pre>
</dd>
<dd>
<p>You can also go from any code type to country name.</p>
</dd>
<dd>
<pre><code>        my $name = code2country( 'jp' ); # Japan</code></pre>
</dd>
<dd>
<p>You can specify any type of code, but if it's not the default two character
representation you must supply the extra argument to define what type it is.</p>
</dd>
<dd>
<pre><code>        my $name = code2country( &quot;120&quot;, LOCALE_CODE_NUMERIC ); # Cameroon</code></pre>
</dd>
<dd>
<p>Just as before, you can get a full list of codes and countries using the
two query functions: <code>all_country_codes()</code>, and <code>all_country_names()</code>.
Both of these functions accept an optional argument specifying the code
set to use for the resulting list.</p>
</dd>
<dt><strong><a name="item_locale%3a%3acurrency"><code>Locale::Currency</code></a></strong><br />
</dt>
<dd>
<p>This module has the same properties as the other locale modules.  You can
convert currency codes into full names, and vice-versa.</p>
</dd>
<dd>
<pre><code>        my $curr = code2currency( 'jpy' ); # Yen
        my $code = currency2code( 'US Dollar' ); # usd</code></pre>
</dd>
<dd>
<p>The query functions are: <code>all_currency_codes()</code>, and <code>all_currency_names()</code>.</p>
</dd>
</dl>

<h2><a name="memoize"><code>Memoize</code></a></h2>

<p><code>Memoize</code> is a module that performs code optimization for you.  In a
general sense, when you <em>memoize</em> a function, it is replaced by a <em>memoized</em>
version of the same function.  OK, that was too general.  More specifically,
every time your memoized function is called, the calling arguments are
cached and anything the function returns is cached as well.  If the function
is called with a set of arguments that has been seen before, then the cached
return value is sent back and the actual function is never called.  This makes
the function faster.</p>

<p>Not all functions can be memoized.  For instance, if your function would return
a different value on two calls, even for the exact same set of calling arguments,
then it will be broken.  Only the first sets return values will be returned for every
call.  Many function do not act this way, and that's what makes <code>Memoize</code> so
useful.</p>

<p>Here is an example of a <em>memoize</em>able function.</p>

<pre><code>        sub add {
                my ($x, $y) = @_;
                return $x + $y;
        }</code></pre>
		
<p>For every time this function is called as <code>add( 2, 2 )</code>, the result will be <code>4</code>.
Rather than compute the value of <code>4</code> in every case, we can cache it away the first
time and retrieve it from the cache every other time we need to compute <code>2 + 2</code>.</p>

<pre><code>        use Memoize;
        
        memoize( 'add' );
        
        sub add {
                my ($x, $y) = @_;
                return $x + $y;
        }</code></pre>

<p>We've just made <code>add()</code> faster, without any work.  Of course, our addition function isn't slow to begin with.  The documentation of <code>Memoize</code> gives a much more details look into this algorithm.  I highly suggest you invest time in learning about <code>Memoize</code>, it can give you wonderful speed increases if you know how and when to use it.</p>

<h2><a name="win32"><code>Win32</code></a></h2>

<p>I currently don't have a Microsoft operating system running on any of my networks,
but when perusing the Perl core, I happened upon the <code>Win32</code> module.  I wanted
to bring it up because if I were using a Microsoft OS, then I would find the functions
in his module invaluable.  Please, if you are running in that environment, then look
at the documentation for <code>Win32</code> for dozens of helpful functions (<code>perldoc Win32</code> on the command line).</p>

<h2><a name="conclusion">Conclusion</a></h2>

<p>Just as before, I've still not covered all of the Perl core.  There is much more to
explore and a full list can be found by reading <em>perlmodlib</em>.  The benefit of having
these modules in the core is great.  Lots of environments require programmers to be
bound to using only code that is distributed with Perl.  I hope I've been able to lighten
the load for anyone who has been put in that position (even by choice).</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1146" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/06/p6pdigest/20030615.html" rel="bookmark">This week on Perl 6, week ending 2003-06-15</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-06-15T00:00:00-08:00">June 15, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Welcome to the last Perl 6 Summary of my first year of summarizing. If
I were a better writer (or if I weren't listening with half an ear to
Damian telling YAPC about Perl 6 in case anything's changed), then this
summary might well be a summary of the last year in Perl 6. But I'm
not, so it won't. Instead, I'm going to try and keep it short
(summaries generally take me about eight hours on an average day, and I
really don't want to lose eight hours of YAPC, thank you very much).</p>

<p>It's getting predictable I know, but we'll start with the internals
list -- again.</p>

<h2><a name="class_instantiation_and_creation">Class Instantiation and Creation</a></h2>

<p>Dan continued slouching toward full OO and outlined the issues
involved with setting up classes and asked for opinions. People offered them.</p>

<p><a href="http://groups.google.com/groups?threadm=a05210604bb0a8541a403%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>

<h2><a name="writing_language_debuggers">Writing Language Debuggers</a></h2>

<p>Clinton Pierce wanted to know how to go about writing language level
debuggers in Parrot. (This man is unstoppable, I tell you.) He offered
some example code to show what he was trying to do. Benjamin Goldberg
had a style suggestion for the code, but nobody had much to say about
Clint's particular issue.</p>

<p><a href="http://groups.google.com/groups?threadm=5.1.0.14.2.20030610122946.01ff3ca0%40mail.geeksalad.org">http://groups.google.com/groups</a></p>

<h2><a name="converting_parrot_to_continuation_passing_style">Converting Parrot to Continuation-Passing Style</a></h2>

<p>Much of this week's effort was involved in getting support for the
continuation-passing style function calling into Parrot. Jonathan
Sillito posted a patch. This led to a certain amount of confusion
about what needs to be stashed in the continuation and a certain
amount of bemusement about the implications of caller saves rather
than callee saves (in a nutshell, a calling context only has to save
those registers that <em>it</em> cares about; it doesn't have to worry about
saving any other registers, because its callers will already have
saved them if they cared.)</p>

<p>Dan ended up rewriting the calling conventions PDD to take into
account some of the confusion.</p>

<p>I think the upshot of this is that the Parrot core now has everything
we need to support the documented continuation-passing calling
conventions. But I could be wrong.</p>

<p><a href="http://groups.google.com/groups?threadm=rt-22633-59206.4.7078149158456%40rt.perl.org">http://groups.google.com/groups</a></p>

<p><a href="http://groups.google.com/groups?threadm=a05210600bb0ea82b9e33%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>

<h2><a name="segfaulting_imcc_for_fun_and_profit">Segfaulting IMCC for Fun and Profit</a></h2>

<p>Clint Pierce's BASIC implementation efforts continue to be one of the
most-effective bug hunting (in code and/or docs) efforts the Parrot
team has. This time, Clint managed to segfault IMCC by trying to
declare nested <code>.subs</code> using the wrong sorts of names. Leo
T&ouml;tsch explained how to fix the problem. It seems that fixing
IMCC to stop it from segfaulting on this issue is hard, since the segfault
happens at runtime.</p>

<p><a href="http://groups.google.com/groups?threadm=rt-22645-59248.5.99474340192458%40rt.perl.org">http://groups.google.com/groups</a></p>

<h2><a name="passing_the_time">Passing the Time</a></h2>

<p>Clint's BASIC can now place chess! Not very well, but we're in 'dogs
dancing' territory here. Bravo Clint! There was applause.</p>

<p><a href="http://groups.google.com/groups?threadm=5.1.0.14.2.20030611232204.01e42fe8%40mail.geeksalad.org">http://groups.google.com/groups</a></p>

<hr noshade size="1" />
<h1><a name="meanwhile_in_damian's_yapc_address...">Meanwhile in Damian's YAPC Address ...</a></h1>

<h2><a name="new_dispatch_method">New DISPATCH method</a></h2>

<p>Last week, Ziggy worried about multimethod dispatch not being good
enough. This week at YAPC, Damian announced DISPATCH, a scary magic
subroutine that allows you to define your own dispatch
rules. Essentially, it gets called before the built-in dispatch rules do; beyond that, I know nothing.</p>

<p>Sorry, no link for this.</p>

<hr noshade size="1" />

<h1><a name="meanwhile_in_perl6language">Meanwhile in perl6-language</a></h1>

<h2><a name="ziggy's_obsoleted_thread">Ziggy's Obsolete Thread</a></h2>

<p>Last week, I mentioned that Adam Turoff had worried a little about
multimethod dispatch, and wanted to know whether it would be possible to
easily override the dispatch system. This week, he outlines
the types of things he might want to do.</p>

<p>See above for the resolution. Details don't exist just yet, but we'll
get there.</p>

<p><a href="http://groups.google.com/groups?threadm=20030609141349.GB22666%40panix.com">http://groups.google.com/groups</a></p>

<h2><a name="type_conversion_matrix,_pragmas_(take_4)">Type Conversion Matrix, Pragmas (Take 4)</a></h2>

<p>Michael Lazzaro posted the latest version of his Type Conversion
Matrix and asked for comments and, hopefully, definitive answers. There
was a small about of discussion ...</p>

<p><a href="http://groups.google.com/groups?threadm=53890EF6-9B76-11D7-8800-000A277AA894%40cognitivity.com">http://groups.google.com/groups</a></p>

<h2><a name="returning_from_a_nested_call">Returning from a Nested Call</a></h2>

<p>Whilst idly 'longing for the cleansing joy [of] Perl,' Dave Storrs
wondered how/whether he could write a method that would return from
its caller. Answer: yes, use <code>leave</code>.</p>

<p><a href="http://groups.google.com/groups?threadm=20030612150646.G31803%40megazone.bigpanda.com">http://groups.google.com/groups</a></p>

<h2><a name="printf_like_formatting_in_interpolated_strings">printf like formatting in interpolated strings</a></h2>

<p>Edward Steiner wondered about having some way to printf, like
formatting of numbers in interpolated strings. Luke Palmer (who just
told me he's embarrassed about something I wrote about something he
said last week, but I'd forgotten it) came up with a cool-looking
suggestion in response.</p>

<p><a href="http://groups.google.com/groups?threadm=m3he6rfx80.fsf%40linux.local">http://groups.google.com/groups</a></p>

<hr noshade size="1" />

<h1><a name="acknowledgements,_announcements_and_apologies">Acknowledgements, Announcements and Apologies</a></h1>

<p>Well, that wraps up my first year of summary writing. Thanks to
everyone for reading, it's been fun.</p>

<p>I have one announcement to make: As of next week, there will be no
obligatory reference to Leon Brocard -- I'm getting bored of it, you
all must have been bored with it for months ... .</p>

<p>If you've appreciated this summary, then please consider one or more of the
following options:</p>

<ul>
<li><p>Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.</p></li>

<li><p>Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</p></li>

<li><p>/usr/bin/pod2html: p6s.pod: cannot resolve L&lt;p6summarizer@bofh.org.uk&gt; in paragraph 50. Send feedback, flames, money, photographic and writing commissions, or
a nice long US power cable to plug into my Mac power-brick to
<em><csperl file="mailmunge" arg_email="p6summarizer@bofh.org.uk" /></em>.</p></li>
</ul>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1136" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/06/13/design1.html" rel="bookmark">Perl Design Patterns</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Phil Crow</span> on <abbr class="published" title="2003-06-13T00:00:00-08:00">June 13, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<h3><a name="introduction">Introduction</a></h3>
<p>In 1995, Design Patterns was published, and during the intervening years, it
has had a great influence on how many developers write
software.  In this series of articles, I present my take on how the
Design Patterns book (the so-called Gang of Four book, which I will call
GoF) and its philosophy applies to Perl.  While Perl is an OO language -- you could code the examples from GoF directly in Perl -- many of the
problems the GoF is trying to solve are better solved in Perl-specific
ways, using techniques not open to Java developers or those C++
developers who insist on using only objects. Even if developers in other
languages are willing to consider procedural approaches, they can't, for
instance, use Perl's immensely powerful built-in pattern support.</p>
<p>Though these articles are self-contained, you will get more out of them
if you are familiar with the GoF book (or better yet have it open on
your desk while you read).  If you don't have the book, then try searching
the Web - many people talk about these patterns.  Since the
Web and the book have diagrams of the object versions of the patterns,
I will not reproduce those here, but can direct you to
<a href="http://www.tml.hut.fi/~pnr/GoF-models/html/">this fine site</a>.</p>
<p>I will show you how to implement the highest value patterns in Perl, most
often by using Perl's rich core language.  I even include some objects.</p>
<p>For the object-oriented implementations, I need you to understand
the basics of Perl objects.  You can learn that from printed sources
like the <a href="http://www.oreilly.com/catalog/cookbook">Perl Cookbook</a> by Tom Christiansen and Nat Torkington or <a href="http://www.manning.com/Conway/index.html">Objected
Oriented Perl</a> by Damian Conway.  But the simplest way to learn the
basics is from <a href="http://www.perldoc.com/perl5.8.0/pod/perltoot.html">perldoc perltoot</a>.</p>
<p>As motivation for my approach, let me start with a little object-oriented
philosophy.  Here are my two principles of objects:</p>
<ol>
<li>
Objects are good when data and methods are tightly bound.</li>

<li>
In most other cases, objects are overkill.</li>
</ol>
<p>Let me elaborate briefly on these principles.</p>

<h4><a name="objects_are_good_when_data_and_methods_are_tightly_bound.">Objects are good when data and methods are tightly bound.</a></h4>
<p>When you are working for a company that rents cars (as I do), an object
to represent a rental agreement makes sense.  The data on the agreement
is tightly bound to the methods you need to perform.  To calculate the
amount owed, you take the various rates and add them together, etc.
This is a good use of an object (or actually several aggregated objects).</p>

<h4><a name="in_most_other_cases,_objects_are_overkill.">In most other cases, objects are overkill.</a></h4>
<p>Consider a few examples from other languages.  Java has the <code>java.lang.Math</code>
class.  It provides things such as sine and cosine.  It only provides class
methods and a couple of class constants.  This should not be forced into
an object-oriented framework, since there are no Math objects.  Rather
the functions should be put in the core, left out completely, or made into
non-object-oriented functions.  The last option is not even available
in Java.</p>
<p>Or think of the C++ standard template library.  The whole templating
framework is needed to make C++ backward compatible with C and to handle
strong static-type checking.  This makes for awkward object-oriented
constructs for things that should be simple parts of the core language.
To be specific, why shouldn't the language just have a better array type
at the outset?  Then a few well-named built-in operations take care of
stacks, queues, dequeues and many other structures we learned in school.</p>
<p>So, in particular, I take exception to one consistent GoF trick: turning an
idea into a full-blown class of objects.  I prefer the Perl way of
incorporating the most-important concepts into the core of the language.
Since I prefer this Perl way, I won't be showing how to objectify
things that could more easily be a simple hash with no methods or
a simple function with no class.  I will invert the GoF trick:
implement full-blown pattern classes with simpler Perl concepts.</p>
<p>The patterns in this first article rely primarily on built-in
features of Perl.  Later articles will address other groups of
patterns.  Now that I've told you what I'm about to do, let's start.</p>


<h3><a name="iterator">Iterator</a></h3>
<p>There are many structures that you need to walk one element at a time.
These include simple things such as arrays, moderate things such as the keys
of a hash, and complex things such as the nodes of a tree.</p>
<p>The Gang of Four suggest solving this problem with the above mentioned
trick: turn a concept into an object.  Here that means you should make
an iterator object.  Each class of objects that can reasonably be
walked should have a method that returns an iterator object.  The object
itself always behaves in a uniform way.  For example, consider the following
code, which uses an iterator to walk the keys of a hash in Java.</p>
<pre><code>
    for (Iterator iter = hash.keySet().iterator(); iter.hasNext();) {
        Object key   = iter.next();
        Object value = hash.get(key);
        System.out.println(key + &quot;\t&quot; + value);
    }</code></pre>
<p>The HashMap object has something that can be walked: its keys.  You
can ask it for this keySet.  That Set will give you an Iterator
on request to its iterator method.  The Iterator responds to
hasNext with a true value if there are more things to be walked,
and false otherwise.  Its next method delivers the next object in
whatever sequence the Iterator is managing.  With that key, the
HashMap delivers the next value in response to get(key).
This is neat and tidy in the completely OO framework of a language
with limited operators and built-in types.  It also perfectly exhibits
the GoF iterator pattern.</p>
<p>In Perl any built-in or user defined object which can be walked
has a method which returns an ordered list of the items to be walked.
To walk the list, simply place it inside the parentheses of a
foreach loop.  So the Perl version of the above hash key walker is:</p>
<pre><code>
    foreach my $key (keys %hash) {
        print &quot;$key\t$hash{$key}\n&quot;;
    }</code></pre>
<p>I could implement the pattern exactly as it is diagrammed in GoF,
but Perl provides a better way.  In Perl 6, it will even be possible
to return a list that expands lazily, so the above will be more
efficient than it is now.  In Perl 5, the keys list is built completely
when I call <code>keys</code>.  In the future, the keys list will be built on
demand, saving memory in most cases, and time in cases where the loop
ends early.</p>
<p>The inclusion of iteration as a core concept represents Perl design
at its finest.  Instead of providing a clumsy mechanism in non-core
code, as Java and C++ (through its standard template library) do,
Perl incorporates this pattern into the core of the language.
As I alluded to in the introduction, there is a Perl principle here:</p>
<p><strong>If a pattern is really valuable, then it should be part of the core language.</strong></p>
<p>The above example is from the core of the language.  To see that <code>foreach</code>
fully implements the iterator pattern, even for user-defined modules,
consider an example from CPAN: <a href="http://search.cpan.org/perldoc?XML::DOM"><code>XML::DOM</code></a>.  The DOM for XML was specified
by Java programmers.  One of the methods you can call on a DOM Document is
<code>getElementsByTagName</code>.  In the DOM specification this returns a
<code>NodeList</code>,
which is a Java Collection.  Thus, the <code>NodeList</code> works like the Set in the
Java code above.  You must ask it for an Iterator, then walk the Iterator.</p>
<p>When Perl people implemented the DOM, they decided that
<code>getElementsByTagName</code>
would return a proper Perl list.  To walk the list one says something like:</p>
<pre><code>
    foreach my $element ($doc-&gt;getElementsByTagName(&quot;tag&quot;)) {
        # ... process the element ...
    }</code></pre>
<p>This stands in stark contrast to the overly verbose Java version:</p>
<pre><code>
    NodeList elements = doc.getElementsByTagName(&quot;tag&quot;);
    for (Iterator iter = elements.iterator(); iter.hasNext();) {
        Element element = (Element)iter.next();
        // ... process the element ...
    }</code></pre>
<p>One beauty of Perl is its ability to combine procedural, object-oriented,
and core concepts in such powerful ways.  The facts that GoF
suggests implementing a pattern with objects and that object only languages
like Java require it do not mean that Perl programmers should ignore
the non-object features of Perl.</p>
<p>Perl succeeds largely by excellent use of the principle of promotion.
Essential patterns are integrated into the core of the language.  Useful
things are implemented in modules.  Useless things are usually missing.</p>
<p>So the iterator pattern from GoF is a core part of Perl we hardly think
about.  The next pattern might actually require us to do some work.</p>


<h3><a name="decorator">Decorator</a></h3>
<p>In normal operation, a <strong>decorator</strong> wraps an object, responding to the same
API as the wrapped object.  For example, suppose I add a compressing
decorator to a file writing object.  The caller passes a file
writer to the decorator's constructor, and calls <code>write</code> on the decorator.
The decorator's write method first compresses the data, then calls the
<code>write</code> method of the file writer it wraps.  Any other type of
writer could be wrapped with the same decorator, so long as all writers
respond to the same API.  Other decorators can also be used in a chain.
The text could be converted from ASCII to unicode by one decorator and
compressed by another.  The order of the decorators is important.</p>
<p>In Perl, I can do this with objects, but I can also use a couple of
language features to obtain most of the decorations I need, sometimes
relying solely on built-in syntax.</p>
<p>I/O is the most common use of decoration.  Perl provides I/O decoration
directly.  Consider the above example: compressing while writing.  Here are
two ways to do this.</p>

<h4><a name="use_the_shell_and_its_tools">Use the Shell and Its Tools</a></h4>
<p>When I open a file for writing in Perl, I can decorate via shell tools.
Here is the above example in code:</p>
<pre><code>
    open FILE, &quot;| gzip &gt; output.gz&quot;
        or die &quot;Couldn't open gzip and/or output.gz: $!\n&quot;;</code></pre>
<p>Now everything I write is passed through <em>gzip</em> on its way to <em>output.gz</em>.
This works great so long as (1) you are willing to use the shell, which
sometimes raises security issues; and (2) the shell has a tool to do
what you need done.  There is also an efficiency concern here.  The
operating system will spawn a new process for the gzip step.  Process
creation is about the slowest thing the OS can do without performing I/O.</p>

<h4><a name="tying">Tying</a></h4>
<p>If you need more control over what happens to your data, then you can decorate
it yourself with Perl's tie mechanism.  It will be even faster, easier
to use, and more powerful in Perl 6, but it works in Perl 5.  It does
work within Perl's OO framework; see <a href="http://www.perldoc.com/perl5.8.0/pod/perltie.html">perltie</a> for more information.</p>
<p>Suppose I want to preface each line of output on a handle with a time stamp.
Here's a tied class to do it.</p>
<pre><code>
    package AddStamp;
    use strict; use warnings;

    sub TIEHANDLE {
        my $class  = shift;
        my $handle = shift;
        return bless \$handle, $class;
    }

    sub PRINT {
        my $handle = shift;
        my $stamp  = localtime();

        print $handle &quot;$stamp &quot;, @_;
    }

    sub CLOSE {
        my $self = shift;
        close $self;
    }

    1;</code></pre>
<p>This class is minimal, in real life you need more code to make the
decorator more robust and complete.  For example, the above code does
not check to make sure the handle is writable nor does it provide
<code>PRINTF</code>,
so calls to <code>printf</code> will fail.  Feel free to fill in the details.
(Again, see perldoc perltie for more information.)</p>
<p>Here's what these pieces do.  The constructor for a tied file
handle class is called <code>TIEHANDLE</code>.  Its name is fixed and uppercase,
because Perl calls this for you.  This is a class method, so the
first argument is the class name.  The other argument is an open
output handle.  The constructor merely blesses a reference to this
handle and returns that reference.</p>
<p>The <code>PRINT</code> method receives the object constructed in <code>TIEHANDLE</code> plus
all the arguments supplied to print.  It calculates the time stamp
and sends that together with the original arguments to the handle
using the real print function.  This is typical decoration at work.
The decorating object responds to print just like a regular handle
would.  It does a little work, then calls the same method on the
wrapped object.</p>
<p>The <code>CLOSE</code> method closes the handle.  I could have inherited from
<a href="http://search.cpan.org/perldoc?Tie::StdHandle">Tie::StdHandle</a> to gain this method and many more like it.</p>
<p>Once I put <em>AddTimeStamp.pm</em> in my lib path, I can use it like this:</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    use AddStamp;

    open LOG, &quot;&gt;output.tmp&quot; or die &quot;Couldn't write output.tmp: $!\n&quot;;
    tie *STAMPED_LOG, &quot;AddStamp&quot;, *LOG;

    while (&lt;&gt;) {
        print STAMPED_LOG;
    }

    close STAMPED_LOG;</code></pre>
<p>After opening the file for writing as usual, I use the built-in <code>tie</code>
function to bind the <code>LOG</code> handle to the <code>AddStamp</code> class under the name
<code>STAMPED_LOG</code>.  After that, I refer exclusively to <code>STAMPED_LOG</code>.</p>
<p>If there are other tied decorators, then I can pass the tied handle to
them.  The only downside is that Perl 5 ties are slower than normal
operations.  Yet, in my experience, disks and networks are my bottlenecks
so in memory inefficiency like this tends not to matter.  Even
if I make the script code execute 90 percent faster, I don't save a noticeable
amount of time, because it wasn't using much time in the first place.</p>
<p>This technique works for many of the built-in types: scalars, arrays,
hashes, as well as file handles. <em>perltie</em> explains how to
tie each of those.</p>
<p>Ties are great since they don't require the caller to understand the
magic you are employing behind their back.  That is also true of GoF
decorators with one clear exception: In Perl, you can change the
behavior of built-in types.</p>













<h4><a name="decorating_lists">Decorating Lists</a></h4>
<p>One of the most common tasks in Perl is to transform a list in some
way.  Perhaps you need to skip all entries in the list that start with
underscore.  Perhaps you need to sort or reverse the list.  Many built-in
functions are list filters.  They take a list, do something to it and
return a resultant list.  This is similar to Unix filters, which expect
lines of data on standard input, which they manipulate in some way, before
sending the result to standard output.  Just as in Unix, Perl list filters
can be chained together.  For example, suppose you want a list of all
subdirectories of the current directory in reverse alphabetical order.
Here's one possible solution.</p>
<pre><code>
 1  #!/usr/bin/perl
 2  use strict; use warnings;
 3
 4  opendir DIR, &quot;.&quot;,
 5      or die &quot;Can't read this directory, how did you get here?\n&quot;;
 6  my @files = reverse sort map { -d $_ ? $_ : () } readdir DIR;
 7  closedir DIR;
 8  print &quot;@files\n&quot;;</code></pre>
<p>Perl 6 will introduce a more meaningful notation for these operations,
but you can learn to read them in Perl 5, with a little effort.  Line 6
is the interesting one.  Start reading it on the right (this is backward
for Unix people).  First, it reads the directory.  Since <code>map</code> expects
a list, <code>readdir</code> returns a list of all files in the directory. <code>map</code>
generates a list with the name of each file which is a directory (or
<code>undef</code> if the <code>-d</code> test fails). <code>sort</code> puts the list in
ASCII-betical order. <code>reverse</code> reverses that.  The result is stored in
<code>@files</code> for later printing.</p>
<p>You can make your own list filter quite easily.  Suppose you wanted to
replace the ugly <code>map</code> usage above (I tend to think <code>map</code> is always ugly)
with a special purpose function, here's how:</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    sub dirs_only (@) {
        my @retval;
        foreach my $entry (@_) {
            push @retval, $entry if (-d $entry);
        }
        return @retval;
    }

    opendir DIR, &quot;.&quot;
        or die &quot;Can't read this directory, how did you get here?\n&quot;;
    my @files = reverse sort { lc($a) cmp lc($b) } dirs_only readdir DIR;
    closedir DIR;
    local $&quot; = &quot;;&quot;;
    print &quot;@files\n&quot;;</code></pre>
<p>The new <code>dirs_only</code> routine replaces <code>map</code> above, leaving out the
entries we don't want to see.</p>
<p>The <code>sort</code> now has an explicit comparison subroutine.  This is to prevent it
from thinking that <code>dirs_only</code> is its comparison routine.  Since I had to
include this, I chose to take advantage of the situation and sort with
more finesse: ignoring case.</p>
<p>You can make such list filters to your heart's content.</p>
<p>I have now shown you the most important types of decoration.  Any others
you need could be implemented in the traditional GoF way.</p>
<p>The next pattern feels like cheating, but then Perl often gives me that
feeling.</p>


<h3><a name="flyweight">Flyweight</a></h3>
<p>The idea of reusing objects is the essence of the flyweight pattern.
Thanks to Mark-Jason Dominus, Perl takes this far beyond what the GoF
had in mind.  Further, he did the work once and for all.  Larry Wall
likes this idea so much he's promoting it to the core for Perl 6
(there's that promotion concept again).</p>
<p>What I want is this:</p>
<p><strong>For objects whose instances don't matter (they are constants or random), those requesting a new object should be given the same one they already received whenever possible.</strong></p>
<p>This pattern fails dramatically if separate instances matter.  But if
they don't, then it would save time and memory.</p>
<p>Here's an example of how this works in Perl.  Suppose I want to provide
a die class for games like Monopoly or Craps.  My die class might look
like this:
(Warning: This example is contrived to show you the technique.)</p>
<pre><code>
    package CheapDie;
    use strict; use warnings;

    use Memoize;
    memoize('new');

    sub new {
        my $class = shift;
        my $sides = shift;
        return bless \$sides, $class;
    }

    sub roll {
        my $sides         = shift;
        my $random_number = rand;

        return int ($random_number * $sides) + 1;
    }

    1;</code></pre>
<p>On first glance, this looks like many other classes.  It has a constructor
called new.  The constructor stores the received number of sides into a
subroutine lexical variable (a.k.a. a my variable), returning a blessed
reference to it.  The roll method calculates a random number,
scales it according to the number of sides, and returns the result.</p>
<p>The only thing strange here are these two lines:</p>
<pre><code>
    use Memoize;
    memoize('new');</code></pre>
<p>These exploit Perl's magic extraordinarily well.  The <code>memoize</code>
function modifies the calling package's symbol table so that <code>new</code> is
wrapped.  The wrapping function examines the incoming arguments (the
number of sides in this case).  If it has not seen those arguments before,
then it would call the function as the user intended, storing the result in
a cache and returning it to the user.  This takes more time and memory than
if I had not used the module.</p>
<p>The savings come when the method is called again.  When the wrapper notices
a call with the same arguments it used before, it does not call the method.
Rather, it sends the cached object instead.  We don't have to do anything
special as a caller or as an object implementor.  If your object is
big, or slow to construct, then this technique would save you time and
memory.  In my case, it wastes both since the objects are so small.</p>
<p>The only thing to keep in mind is that some methods don't benefit from
this technique.  For example, if I memoize <code>roll</code>, then it would return
the same number each time, which is not exactly the desired result.</p>
<p>Note too that <a href="http://search.cpan.org/perldoc?Memoize">Memoize</a> can be used in non-object situations - in fact
the documentation for it doesn't seem to contemplate using it for object
factories.</p>
<p>Not only do languages such as Java not have core functions for caching
method returns, they don't allow clever users to implement them.  
Mark-Jason Dominus did a fine thing implementing Memoize, but 
Larry Wall did a
better thing by letting him.  Imagine Java letting a user write a
class that manipulated the caller's symbol table at run time - I
can almost hear the screams of terror.  Of course, these techniques
can be abused, but precluding them is a greater loss than rejecting
poor code on the few occasions that some less-than-stellar programmer
improperly adjusts the symbol table.</p>
<p>In Perl all things are legal, but some are best left to modules with
strong development communities.  This allows regular users to take advantage
of magic manipulations without worrying about whether our own magic
will work. <code>Memoize</code> is an example.  Instead of rolling your own wrapped
call and caching scheme, use the well-tested one that ships with Perl
(and looked for the 'is cached' trait to do this for routines in Perl 6).</p>
<p>The next pattern is related to this one, so you can use flyweight to
implement it.</p>


<h3><a name="singleton">Singleton</a></h3>
<p>In the flyweight pattern, we saw that there are sometimes resources that
everyone can share.  GoF calls the special case when there is a single
resource that everyone needs to share the singleton pattern.  Perhaps the
resource is a hash of configuration parameters.  Everyone should be able to
look there, but it should only be built on startup (and possibly rebuilt on
some signal).</p>
<p>In most cases, you could just use <code>Memoize</code>.  That seems most reasonable to me.
(See the flyweight section above.) In that case, everyone who wants access
to the resource calls the constructor.  The first person to do so causes
the construction to happen and receives the object.  Subsequent people call
the constructor, but they receive the originally constructed object.</p>
<p>There are many other ways to achieve this same effect.  For instance, if
you think your callers might pass you unexpected arguments, then <code>Memoize</code> would
make multiple instances, one for each set of arguments.  In this case,
managing the singleton with modules like <a href="http://search.cpan.org/perldoc?Cache::FastMemoryCache">Cache::FastMemoryCache</a> from CPAN
may make more sense. You could even
use a file lexical, assigning it a value in a <code>BEGIN</code> block.  Remember
bless doesn't have to be used in a method.  You could say:</p>
<pre><code>
    package Name;
    my $singleton;
    BEGIN {
        $singleton = {
            attribute =&gt; 'value',
            another   =&gt; 'something',
        };
        bless $singleton, &quot;Name&quot;;
    }

    sub new {
        my $class = shift;
        return $singleton;
    }</code></pre>
<p>This avoids some of the overhead of Memoize and shows what I'm doing more
directly.  I made no attempt to take subclassing into account here.  Maybe
I should, but the pattern says a singleton should belong always to one class.
The fundamental statement about singletons is:</p>
<p><strong>``There can only be one singleton.''</strong></p>


<h3><a name="summary">Summary</a></h3>
<p>All four of the patterns shown in this article use built-in features,
or standard modules.  The iterator is implemented with <code>foreach</code>.  The
decorator is implemented for I/O with Unix pipe and redirection
syntax or with a tied file handle.  For lists, decorators are just
functions which take and return lists.  So, I might call decorators
filters.  Flyweights are shared objects easily implemented with the
Memoize module.  Singletons can be implemented as flyweights or with
simple object techniques.</p>
<p>The next time some uppity OO programmer starts going on about patterns,
rest assured, you know how to use them.  In fact, they are built-in
to the core of your language (at least if you have the sense to use Perl).</p>
<p>Next time, I will look at patterns which rely on code references or
data containers.</p>

<h4><a name="acknowledgements_and_background">Acknowledgements and Background</a></h4>
<p>I wrote these articles after taking a training course using GoF from a well-known training and consulting company.  My writing is also informed by
many people in the Perl community, including Mark-Jason Dominus, who
showed at YAPC 2002, using his unique flair, how Perl deals with the
iterator pattern.  Though the writing here is mine, the inspiration
comes from Dominus and many others in the Perl community, most of all Larry
Wall, who have incorporated patterns into the heart of Perl during the
years.  As these patterns show, time and time again, Perl employs the
principle of promotion carefully
and well.  Instead of adding a collection framework in source code modules,
as Java and C++ do, Perl has only two collections: arrays and hashes.
Both are core to the language.  I think Perl's greatest strength
is the community's choices of what to include in the core, what to ship
along with the core, and what to leave out.  Perl 6 will only make Perl
more competitive in the war of language design ideas.</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1144" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/06/p6pdigest/20030608.html" rel="bookmark">This week on Perl 6, week ending 2003-06-08</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-06-08T00:00:00-08:00">June  8, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>It's another Monday, it's another summary and I need to get this
finished so I can starting getting the house in order before we head
off to Boca Raton and points north and west on the long road to
Portland, Oregon. Via Vermont. (I'm English and as the poem comments,
the rolling English road is ``A rare road, a rocky road and one that we
did tread // The day we went to Birmingham by way of Beachy Head.''
Just because I'm in America doesn't mean I can't take an English route
to OSCON)</p>
<p>We'll start with the internals list this week (and, given that there are
only 18 or so messages in my perl6-language inbox, we may well stop
there).</p>

<h2><a name="building_imcc_as_parrot">Building IMCC as parrot</a></h2>
<p>It's been pretty much decided that IMCC will soon become 'the' parrot
executable. Josh Wilmes, Robert Spier and Leo ``Perl Foundation grant
recipient'' T&ouml;tsch are looking into what needs to be done to make
this so. It's looking like the build system may well see some vigorous
cleanup action in this process.</p>
<p><a href="http://groups.google.com/groups?threadm=200306020024.h520OlPn001985%40galactic.hitchhiker.org">http://groups.google.com/groups</a></p>

<h2><a name="the_horror!_the_horror!">The Horror! The Horror!</a></h2>
<p>Clint Pierce continued to expand on the internals of this Basic
implementation. The more I see of his pathological examples, the
gladder I am that I escaped BASIC as quickly as possible. Still, kudos
to Clint once more for the effort, even if it is a tad embarrassing
that the most advanced language hosted on Parrot is BASIC. (On IRC
Leon Brocard and others have been heard to remark that they're?
unlikely to go all out at a real language until Parrot has
objects. Dan?)</p>
<p><a href="http://groups.google.com/groups?threadm=5.1.0.14.2.20030601220001.01fd81a0%40mail.geeksalad.org">http://groups.google.com/groups</a></p>

<h2><a name="the_horror!_the_horror!_part_ii">The Horror! The Horror! Part II</a></h2>
<p>The timely destruction thread still doesn't want to go away. Dan has
been heard muttering about this on IRC. Eventually, he did more than
mutter on IRC -- he stated clearly on list that 'We aren't doing
reference counting' and that as far as he is concerned the matter is
closed.</p>
<p>Dan's blog also has another of his excellent ``What The Heck Is'' posts,
this time about Garbage Collection.</p>
<p><a href="http://groups.google.com/groups?threadm=3EDBBFA0.E819E6E%40hotpop.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=a05210602bb02f82300e8%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>
<p><a href="http://www.sidhe.org/~dan/blog/archives/000200.html">http://www.sidhe.org/~dan/blog/archives/000200.html</a> - What the Heck
is: Garbage Collection</p>

<h2><a name="the_continu(ation)ing_saga">The Continu(ation)ing Saga</a></h2>
<p>Jonathan Sillito posted a longish meditation on Parrot's new
continuation passing calling conventions. He wondered if, now we have
continuation passing, we really needed the various register stacks
that were used in the old stack based calling conventions. Warnock's
Dilemma currently applies.</p>
<p><a href="http://groups.google.com/groups?threadm=CNEMKELBCHOGALFFEDPFIECOCAAA.sillito%40cs.ubc.ca">http://groups.google.com/groups</a></p>

<h2><a name="clint_pierce,_imcc_tester_extraordinaire">Clint Pierce, IMCC tester extraordinaire</a></h2>
<p>Over the past couple of week's Clint Pierce has been porting his BASIC
implementation over to run on IMCC. In the process of doing so he's
been finding and reporting all sorts of IMCC bugs and/or
misunderstandings and Leo T&ouml;tsch (usually) has either been
correcting Clint's assumptions or fixing the bugs he's found. I've
mentioned a few of these exchanges that generated longish threads in
the past, but that hasn't covered everything that's been found,
discussed and fixed. It's been great to see this sort of dialogue
driving the design and implementation forward based on the needs of a
real program.</p>
<p>The thread I've linked to below is another exchange in this ongoing
dialogue. Clint found a way of reliably segfaulting IMCC. Leo fixed
it. And on to the next.</p>
<p><a href="http://groups.google.com/groups?threadm=rt-22521-58643.5.77130880187681%40rt.perl.org">http://groups.google.com/groups</a></p>

<h2><a name="and,_on_the_subject_of_list_stalwarts...">And, on the subject of list stalwarts...</a></h2>
<p>J&uuml;rgen B&ouml;mmels is still working away at the Parrot IO
(PIO) subsystem. In this particular patch, he's gone through the
Parrot source replacing occurrences <code>PIO_fprintf(interpreter,
PIO_STDERR(interpreter, ...)</code> with the better factored
<code>PIO_eprintf(interpreter, ...)</code>, which as well as eliminating
repetition, helps to keep the IO code slightly easier to maintain.</p>
<p>Leo applied the patch. (Although it's not mentioned explicitly
elsewhere, Leo continues to keep up his astonishing productivity with
various other patches to Parrot)</p>
<p><a href="http://groups.google.com/groups?threadm=rt-22535-58661.11.7827035484784%40rt.perl.org">http://groups.google.com/groups</a></p>

<h2><a name="make_mine_supersized">Make mine SuperSized</a></h2>
<p>Bryan C. Warnock continued to discuss issues of the size of Parrot's
various types, particularly the integer types that get used within a
running Parrot. Bryan argues that these should ideally use a given
platform's native types, worrying about guaranteed sizes only at the
bytecode loading/saving stage. Dan and others commented on this (Dan
essentially said that he understood what Bryan was driving at but
wasn't quite sure of the way forward, and outlined his
options). Discussion continues.</p>
<p><a href="http://groups.google.com/groups?threadm=1054644274.2210.803.camel%40wakko">http://groups.google.com/groups</a></p>

<h2><a name="call_invoke_call">Call <code>invoke</code> call?</a></h2>
<p>Jonathan Sillito submitted a patch which changes <code>invoke</code> to
<code>call</code>, adds some PMC access macros and updates the tests. He and Leo
T&ouml;tsch discussed things for a while and I think the patch is in
the process of being rewritten as result of that discussion.</p>
<p><a href="http://groups.google.com/groups?threadm=rt-22549-58682.5.99782813786945%40rt.perl.org">http://groups.google.com/groups</a></p>

<h2><a name="constant_propagation/folding">Constant Propagation/Folding</a></h2>
<p>Matt Fowles had another bite at his Constant Propagation cherry. His
latest patch is rather more conservative, and actually has tests. Leo
changed one line and applied it.</p>
<p><a href="http://groups.google.com/groups?threadm=rt-22558-58706.18.079205723288%40rt.perl.org">http://groups.google.com/groups</a></p>

<h2><a name="destruction_order">Destruction order</a></h2>
<p>One of the good things about a simple minded reference counting
Garbage Collector is that object destructors generally get called in a
sensible order; if you have a tree of objects, the various node
destructors will generally get called in such a way that a given
node's children won't have been destroyed already. Garrett Goebel
asked if we could keep this behaviour with the Parrot GC system. Dan
was minded to say ``Yes'' as he's been wrestling with issues of non
deterministic destruction order in another of his projects (So have I;
it's a <em>very</em> long way from being fun, if I had the C chops I'd be
trying to fix Perl 5's 'at exit' mark and sweep garbage collector to
do something similar.)</p>
<p><a href="http://groups.google.com/groups?threadm=71BEC0D4E1DED3118F7A009027B12028034C8D6E%40EXCH_MISSION">http://groups.google.com/groups</a></p>

<h2><a name="k_stol's_lua_compiler_project">K Stol's Lua Compiler project</a></h2>
<p>Klaas-Jan Stol announced that he's turned in his project implementing
a Lua compiler that targets Parrot. He hasn't actually finished the
compiler, his deadline being what it was, but he did post a link to
his project report and commented that ``[Parrot is] a really cool
project and VM to target'' and thanked everyone on the mailing list for
their help. I think the parrot-internals people will echo my best
wishes to Klaas-Jan; it's great to see someone who comes to a list with a
project and, instead of saying ``Write this for me!'', asks sensible
questions and makes a useful contribution to the ongoing task.</p>
<p><a href="http://groups.google.com/groups?threadm=BAY1-DAV22zUSxvjPkQ00000969%40hotmail.com">http://groups.google.com/groups</a></p>
<p><a href="http://members.home.nl/joeijoei/parrot/report.pdf">http://members.home.nl/joeijoei/parrot/report.pdf</a> -- Project report</p>


<h1><a name="meanwhile,_in_perl6language">Meanwhile, in perl6-language</a></h1>
<p>By gum, it's been quiet this week. I haven't seen any traffic in the
language list since Wednesday. Maybe everyone's waiting for Damian's
Exegesis to escape.</p>

<h2><a name="multimethod_dispatch">Multimethod dispatch?</a></h2>
<p>Adam Turoff asked if multimethod dispatch (MMD) was really <em>the</em> Right
Thing (it's definitely <em>a</em> Right Thing) and suggested that it would
be more Perlish to allow the programmer to override the dispatcher,
allowing for all sorts of more or less cunning dispatch mechanisms
(which isn't to say we could still have MMD tightly integrated, but it
wouldn't be the <em>only</em> alternative to simple single dispatch). Luke
Palmer gets the ``Pointy End Grandma'' award for pointing out that Perl
6 is a '``real'' programming language now' (as Adam pointed out, Perl's
been a 'real' programming language for years), inspiring a particularly
pithy bit of Cozeny. As far as I can tell, Adam wants to be able to
dispatch on the runtime value of a parameter as well as on its runtime
type (he's not alone in this). Right now you either have to do this
explicitly in the body of the subroutine, or work out the correct
macromantic incantations needed to allow the programmer to use 'nice'
syntax for specifying such dispatch.</p>
<p>Assuming I'm not misunderstanding what Adam is after, this has come up
before (I think I asked about value based dispatch a few months back)
and I can't remember if the decision was that MMD didn't extend to
dispatching based on value, or if that decision hasn't been taken
yet. If it's not been taken, I still want to be able to do</p>
<pre><code>
   multi factorial (0) { 1 }
   multi factorial ($n) { $n * factorial($n - 1) }</code></pre>
<p>It seems to me that if MMD is flexible enough to do this, then it
becomes easy to express any other set of dispatch rules as special
cases of this more general mechanism. (That said, I'm not sure how one
would go about expressing Smalltalk like message specifiers, which is
a shame, I like Smalltalk message specifiers).</p>
<p><a href="http://groups.google.com/groups?threadm=20030602033631.GD4266%40panix.com">http://groups.google.com/groups</a></p>


<h1><a name="acknowledgements,_announcements_and_apologies">Acknowledgements, Announcements and Apologies</a></h1>
<p>Well, that's about it for another week. Next week's summary will be
coming to you from YAPC in Boca Raton. then there should be one from
chez Turoff in Washington DC (As far as I can tell the Washington
summary will be the first summary of the second year of my summary
writing, if you're going to be in the Greater Washington area around
that time, consider getting in touch with either me or Ziggy and we'll
see about having a celebratory something or other that evening). After
Washington I'll be in Boston for the next summary, and at OSCON for
the one after that. I fully expect to be writing either enormously
long summaries or drastically curtailed ones while I'm over in the
States. After OSCON, there'll be a summary from Seattle and then I'll
be off back home. If you're in any of those localities at the
appropriate times drop me a line, we'll try and arrange meet-ups to wet
the appropriate summaries' heads.</p>
<p>If you've appreciated this summary, please consider one or more of the
following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.</li>

<li>
Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>

<li>
Send feedback, flames, money, photographic and writing commissions, or
a large collection of appropriately shaped tuits to
<em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em>.</li>
</ul>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1134" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/06/06/regexps.html" rel="bookmark">Regexp Power</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2003-06-06T00:00:00-08:00">June  6, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p></p>
<p>Everyone knows that Perl works particularly well as a text processing
language, and that it has a great many tools to help the programmer
slice and dice text files. Most people know that Perl's regular
expressions are the mainstay of its text processing capabilities, but do
you know about <strong>all</strong> of the features which regexps provide in order to
help you do your job?</p>
<p>In this short series of two articles, we'll take a look through some of
the less well-known or less understood parts of the regular expression
language, and see how they can be used to solve problems with more power
and less fuss.</p>
<p>If you're not too familiar with the basics of the regexp language, a
good place to start is <a 
href="http://www.perldoc.com/perl5.8.0/pod/perlretut.html">perlretut</a>, which comes as part of the Perl
distribution. We're going to assume that you know about anchors,
character classes, repetition, bracketing, and alternation. Where can we
go from here?</p>

<csperl file="grab" domain="on" record="b/834" template="b/article_sidebar2.view">

<h3><a  name="multiline_strings">Multi-line strings</a></h3>
<p>Matching multi-line strings is one thing that I have to admit confuses
me every time. I remember that it has something to do with the <code>/m</code> and
<code>/s</code> modifiers, so when I think my strings will contain embedded
newlines, I just slap both <code>/ms</code> on the end of my regular expression
and hope for the best.</p>
<p>This is inexcusable behavior, especially since the distinction is
pretty simple. <code>/m</code> has to do with anchors. <code>/s</code> has to do with dots.
Let's start by looking at <code>/s</code>. The ``any'' character, <code>.</code>, does not
actually match any character; by default, it matches any character
except for a newline. So for instance, this won't match:</p>
<pre><code>
    &quot;This is my\nmulti-line string&quot; =~ /This.*string/;</code></pre>
<p>Don't just take my word for it. Get into the habit of trying out these
things for yourself; with Perl's <code>-e</code> switch, it's very easy to make up
a quick test of regular expression behavior if you're unsure:</p>
<pre><code>
    % perl -e 'print &quot;Matched!&quot; if &quot;This is my\nmulti-line string&quot; =~
        /This.*string/;'</code></pre>
<p>As predicted, it doesn't print <code>Matched!</code>.</p>
<p>This newline-phobia only relates to the <code>.</code> operator. It's nothing to
do with regular expressions in general. If we use something other than a
<code>.</code> to match the stuff in the middle, it will work:</p>
<pre><code>
    &quot;This is my\nmulti-line string&quot; =~ /This\D+string/;</code></pre>
<p>This matches the first <code>This</code>, then more than one thing that isn't
a digit, and then <code>string</code>. Because <code>\n</code> isn't a digit - and nor is
anything else between <code>This</code> and <code>string</code> - the regular expression will
match.</p>
<p>So the dot operator won't match a newline. If we want to change the
behavior of the dot operator, we can use the <code>/s</code> modifier to the
regular expression.</p>
<pre><code>
    &quot;This is my\nmulti-line string&quot; =~ /This.*string/s;</code></pre>
<p>This time, it matches. If you're using the <code>.</code> operator in your regular
expressions and you want it to be able to cross over newline boundaries,
use the <code>/s</code> modifier. However, you can sometimes get the same result
without using <code>/s</code> by choosing another way of matching</p>
<p>What about anchors? Well, there are two possible things that we might
want anchors to do with a multi-line string. We might them to match the
start or end of any line in the string, or we might want them to match
the start or end of the whole thing. Let's back up a little, and then
see how the <code>/m</code> modifier can be used to choose between these two
possible behaviors.</p>
<p>First, let's try something we know that doesn't work.</p>
<pre><code>
    &quot;This is my\nmulti-line string&quot; =~ /^(.*)$/;</code></pre>
<p>This wants to match the start of the string, any amount of stuff that's
not a newline and the end of the string. But we know that there is a
newline between the start of the string and the end, so it won't match.
We could, of course, allow <code>.</code> to match a newline using the <code>/s</code> trick
we've just learnt, and then we can capture the whole lot:</p>
<pre><code>
     % perl -e 'print $1 if &quot;This is my\nmulti-line string&quot; =~ /^(.*)$/s'
     This is my
     multi-line string</code></pre>
<p>But instead, we could use the <code>/m</code> modifier. Let's see what happens if
we do that:</p>
<pre><code>
     % perl -e 'print $1 if &quot;This is my\nmulti-line string&quot; =~ /^(.*)$/m' 
     This is my</code></pre>
<p>Aha! This time, we've changed the meanings of the anchors - instead of
matching just the start and end of the string, they now match the start
of any line in the string.</p>
<p>What happens when Perl runs this regular expression? Let's pretend we're
the regular expression engine for a brief, mad moment.</p>
<p>We start at the beginning of the string. The <code>^</code> anchor tells us to
match the beginning of a line, which is handy, since we're at one of
those right now. Now we match and capture any amount of stuff - so long
as it isn't a newline. This takes us up to <code>This is my</code>, and as the
next character is a newline, that is where we must stop. Next, we have
the <code>$</code> anchor. Now without the <code>/m</code> modifier, this would want to find
the end of the string. We're not at the end of the string - there's
<code>\nmulti-line string</code> left to go - so without the <code>/m</code> modifier this
match would fail. That's what happened just above.</p>
<p>However, this time we do have the <code>/m</code> modifier, so the meaning of
<code>$</code> has changed. This time, it means the end of any line in the string.
As we've had to stop at the <code>\n</code>, that would mean we're at the end of a
line. So <strong>that</strong> means that our <code>$</code> matches, and the whole expression
matches and all is well.</p>
<p>What if we use both the <code>/m</code> and <code>/s</code> modifiers here? Let's see:</p>
<pre><code>
    % perl -e 'print $1 if &quot;This is my\nmulti-line string&quot; =~ /^(.*)$/ms'
    This is my
    multi-line string</code></pre>
<p>Well, it looks the same as when we had just used <code>/s</code>. Why? Because we
do have <code>/s</code>, the <code>.*</code> can eat up absolutely everything right up to the
end of the string. Now our <code>/m</code>-enabled <code>$</code> matches the end of any
line in the string, and indeed we are at the end of the second line in
the string, so this matches too. In this case, the <code>/m</code> is superfluous.</p>
<p>Another trick to avoid confusion is to use explicit newlines in your
expression. For instance, if you're dealing with data like this:</p>
<pre><code>
    Name: Mark-Jason Dominus
    Occupation: Perl trainer
    Favourite thing: Octopodes</code></pre>
<pre><code>
    Name: Simon Cozens
    Occupation: Hacker
    Favourite thing: Sleep</code></pre>
<p>then you can split it up with a newline-embedded regexp like so:</p>
<pre><code>
    /^Name: (.*)\nOccupation: (.*)\nFavourite thing: (.*)/</code></pre>
<p>This time we don't need any modifiers at all - we want the <code>.*</code> to stop
before the newline, and then the explicit newlines themselves obviate
the need for start-of-line or end-of-line anchors. In our next article,
we'll see how to use the <code>/g</code> modifier to read in multiple records.</p>
<p>So those are the two rules for dealing with multi-line strings: <code>/s</code>
changes the behavior of the dot operator. Without <code>/s</code>, <code>.</code> will not
match a newline. With <code>/s</code>, <code>.</code> truly matches anything. On the other
hand <code>/m</code> changes the behavior of the anchors <code>^</code> and <code>$</code>; without
<code>/m</code>, these anchors only match the start and end of the whole string.
With <code>/m</code>, they match the start or end of any line inside the string.</p>

<h3><a  name="spacing,_commenting_and_quoting_regexps">Spacing, Commenting and Quoting Regexps</a></h3>
<p>Another modifier like <code>/s</code> and <code>/m</code> is <code>/x</code>; <code>/x</code> changes the
behavior of whitespace inside a regular expression. Without <code>/x</code>,
a literal space inside a regex matches a space in the string. This makes
sense:</p>
<pre><code>
    &quot;A string&quot; =~ /A string/;</code></pre>
<p>You would expect this to match, and without <code>/x</code>, it does match. Phew.
With <code>/x</code>, however, the match fails. Why is this? <code>/x</code> strips literal
whitespace of any meaning. If we want to match <code>A string</code>, we have to
use either the <code>\s</code> whitespace character class or some other
shenanigans:</p>
<pre><code>
    &quot;A string&quot; =~ /A\sstring/x;
    &quot;A string&quot; =~ /A[ ]string/x;</code></pre>
<p>How can this conceivably be useful? Well, for a start, by removing the
meaning of white space inside a regular expression, we can use
whitespace at will; this is particularly useful to help us space out
complicated expressions. The rather unpleasant</p>
<pre><code>
    ($postcode) = 
        ($address =~ 
    /([A-Z]{1,2}\d{1,3}[ \t]+\d{1,2}[A-Z][A-Z]|[A-Z][A-Z][\t ]+\d{5})/);</code></pre>
<p>becomes the slightly more managable</p>
<pre><code>
    ($postcode) = 
        ($address =~
    /(
          [A-Z]{1,2}\d{1,3} [ \t]+ \d{1,2} [A-Z][A-Z]
        | [A-Z][A-Z] [\t ]+ \d{5}
    )/x);</code></pre>
<p>Without <code>/x</code>, we would be looking for literal spaces, tabs and carriage
returns inside our postcode, which really wouldn't work out as we want.</p>
<p>Another advantage of using <code>/x</code> is that it allows us to add comments
to our regular expression, helping to make the example above even more
maintainable:</p>
<pre><code>
    ($postcode) = 
        ($address =~
    /(
        # UK Postcode:
          [A-Z]{1,2} # Post town
          \d{1,3}    # Area 
          [ \t]+ 
          \d{1,2}    # Region
          [A-Z][A-Z] # Street part
        | 
        # US Postcode:
          [A-Z][A-Z]   # State
          [\t ]+ 
          \d{5}        # ZIP+5
    )/x);</code></pre>
<p>Of course, to make it still tidier, we can put regular expression
components into variables:</p>
<pre><code>
    my $post_town = '[A-Z]{1,2}';
    my $area      = '\d{1,3};
    my $space     = '[ \t]+';
    my $region    = '\d{1,2}';
    my $street    = '[A-Z][A-Z]';
    
    my $uk_postcode = &quot;$post_town $area $space $region $street&quot;;
    ...</code></pre>
<p>Because variables are interpolated inside regular expressions:</p>
<pre><code>
    ($postcode) = 
        ($address =~ /($uk_postcode|$us_postcode)/x);</code></pre>
<p>Perl 5.6.0 introduced the ability to package up regular expressions
into variables using the <code>qr//</code> operator. This acts just like <code>q//</code>
except that it follows the quoting, escaping and interpolation rules of
the regular expression match operator. In our example above, we had to
use single quotes for the ``basic'' components, and then double quotes to
get the interpolation when we wanted to string them all together into
<code>$uk_postcode</code>. Now, we can use the same <code>qr//</code> operator for all the
parts of our regular expression:</p>
<pre><code>
    my $post_town = qr/[A-Z]{1,2}/;
    my $area      = qr/\d{1,3}/;
    my $space     = qr/[ \t]+/;
    my $region    = qr/\d{1,2}/;
    my $street    = qr/[A-Z][A-Z]/;
   
And we can also add modifiers to parts of a quoted regular expression:</code></pre>
<pre><code>
    my $uk_postcode = qr/$post_town $area $space $region $street/x;</code></pre>
<p>Because the modifiers are packaged up inside their own little component,
we can ``mix and match'' modifiers inside a single regular expression. If,
for instance, we want to match part of it case-insensitively and some
case-sensitively:</p>
<pre><code>
    my $prefix = qr/zip code: /i;
    my $code   = qr/[A-Z][A-Z][ \t]+\d{5}/;</code></pre>
<pre><code>
    $address =~ /$prefix $code/x;</code></pre>
<p>In this example, the prefix part ``knows'' that it has to match
case-insensitively and the code part ``knows'' that it should match
case-sensitively like any other normal regular expression.</p>
<p>Another boon of using quoted regular expressions is a little
off-the-wall. We can actually use them to create recursive regular
expressions. For instance, an old chestnut is the question ``How do I
extract parenthesized text?''. Well, such a simple problem turns out to
be quite nasty to solve using regular expressions. Here's a
simple-minded approach:</p>
<pre><code>
    $paren = qr/ \( [^)]+ \) /x;</code></pre>
<p>This simple approach works in simple cases:</p>
<pre><code>
    &quot;Some (parenthesized) text&quot; =~ /($paren)/;
    print $1; # parenthesized</code></pre>
<p>But fails in complex cases:</p>
<pre><code>
    &quot;Some (parenthesised and (gratuitously) sub-parenthesised text&quot;
        =~ /($paren)/;
    print $1; # parenthesized and (gratuitously</code></pre>
<p>Oops. Our expression sees the first closing paren and stops. We need to
find a way to tell it to count the number of opening and closing parens
and make sure they're balanced before finishing. This actually turns out
to be tremendously difficult, and the solution is too messy to show
here. Regular expressions are not meant for iterative solutions.</p>
<p>Regular expressions aren't <strong>really</strong> meant for recursive solutions
either, but if we have recursive regular expressions, we can define our
balanced-paren expression like this: first match an opening paren; then
match a series of things that can be non-parens or an another
balanced-paren group; then a closing paren. Turned into Perl code, this
becomes:</p>
<pre><code>
    $paren = qr/
      \(
        ( 
           [^()]+  # Not parens
         | 
           $paren  # Another balanced group
        )*
      \)
    /x;</code></pre>
<p>This is almost there, but it's not quite correct. Because <code>qr//</code>
compiles a regular expression, it does the interpolation right there and
then. And when our expression is compiled <code>$paren</code> isn't defined yet,
so it's interpolated as an empty string, and we don't get the recursion.</p>
<p>That's OK. We can tell the expression not to interpolate the <code>$paren</code>
quite yet with the super-secret regular expression ``don't interpolate
this bit yet'' operator: <code>(??{ })</code>. (It has two question marks to remind
you that it's doubly secret.) Now we have</p>
<pre><code>
    $paren = qr/
      \(
        ( 
           [^()]+  # Not parens
         | 
           (??{ $paren })  # Another balanced group (not interpolated yet)
        )*
      \)
    /x;</code></pre>
<p>When this is run on some text like <code>(lambda (x) (append x '(hacker)))</code>,
the following happens: we see our opening paren, so all is well. Then we
see some things which are not parens (<code>lambda </code>) and all is still well.
Now we see <code>(</code>, which definitely is a paren. Our first alternative
fails, we try the second alternative. Now it's finally time to
interpolate what's inside the double-secret operator, which just happens
to be <code>$paren</code>. And what does <code>$paren</code> tell us to match? First, an
open paren - ooh, we seem to have one of those handy. Then some things
which are not parens, such as <code>x</code>, and then we can finish this part of
the match by matching a close paren. This polishes off the
sub-expression, so we can go back to looking for more things that aren't
parens, and so on.</p>
<p>Of course, if we need to get this confusing, you might wonder why we're
using a regular expression at all. Thankfully, there's a much easier way
of doing things: the <a 
href="http://search.cpan.org/author/DCONWAY/Text-Balanced-1.95/lib/Text/Balanced.pm">the Text::Balanced manpage</a> module helps extract all kinds of
balanced, quoted and tagged texts, and this is one of the things we'll
look at in our next article, next month.</p>

<h3><a  name="in_conclusion">In Conclusion</a></h3>
<p>Regular expressions are like a microcosm of the Perl language itself:
it's simple to use them to do simple things with, and most of the time
you only need to do simple things with them. But sometimes you need to
do more complex things, and you have to start digging around in the dark
corners of the language to pull out the slightly more complex tools.</p>
<p>Hopefully this article has shed a little light on some of the dark
corners: for dealing with multi-line strings and making expressions more
readable with quoting and interpolation. In the next article, we'll look
at the dreaded look-ahead and look-behind operators, splitting up text
with more than just <code>split</code>, and some CPAN modules to help you get all
this done.</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1142" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/06/p6pdigest/20030601.html" rel="bookmark">This week on Perl 6, week ending 2003-06-01</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-06-01T00:00:00-08:00">June  1, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>Another Monday, another Perl 6 Summary. Does this man never take a
holiday? (Yes, but only to go to Perl conferences this year, how did
that happen?)</p>
<p>We start with the internals list as usual.</p>

<h2><a name="more_on_timely_destruction">More on timely destruction</a></h2>
<p>The discussion of how to get timely destruction with Parrot's Garbage
Collection system continued. Last week Dan announced that, for
languages that make commitments to call destructors as soon as a thing
goes out of scope, there would be a set of helpful ops to allow
languages to trigger conditional DOD (Dead Object Detection) runs at
appropriate times. People weren't desperately keen on the performance
hit that this entails (though the performance hit involved with
reference counting is pretty substantial...) but we didn't manage to
come up with a better solution to the issue.</p>
<p><a href="http://groups.google.com/groups?threadm=200305251047.h4PAl4k24911%40thu8.leo.home">http://groups.google.com/groups</a></p>

<h2><a name="bryan_c._warnock,_patchmonster_of_the_week">Bryan C. Warnock, patchmonster of the week</a></h2>
<p>Bryan C. Warnock seems to be attempting to outdo Leo T&ouml;tsch in
the patchmonster stakes this week. He put in a miscellany of patches
dealing with the Perl based assembler, opcode sizes, debugging flags
and probably others. Most of them were applied with alacrity.</p>

<h2><a name="the_perl_6_essentials_book">The Perl 6 Essentials book</a></h2>
<p>Dan Sugalski gave a rundown of how the Perl 6 Essentials book came
about, what's in it and all that jazz. He started by apologizing for
not mentioning it before, but he thought he had. This led Clint Pierce
to wonder if there was something up with Dan's Garbage Collection
system. The existence of the book probably goes some way to explaining
Leo T&ouml;tsch's relative silence over the last few weeks. Nicholas
Clark wondered if it explains why Parrot doesn't have objects
yet. Brent Dax wondered when it would be available (by OSCON this year
apparently).</p>
<p><a href="http://groups.google.com/groups?threadm=a05210638baf81088c209%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>

<h2><a name="imcc,_pasm_and_constants/macros">IMCC, PASM and constants/macros</a></h2>
<p>Clint Pierce had some big headaches with moving his BASIC interpreter
over to IMCC owing to problems with <code>.constant</code> which is legal for
the assembler, but not for IMCC. Leo T&ouml;tsch pointed Clint at
IMCC's <code>.const</code> operator. Bryan Warnock wondered if IMCC and the
assembler's syntax couldn't be unified. Leo noted that it wasn't quite
that straightforward because <code>.constant</code> declares an untyped
constant, but <code>.const</code> requires a type as well. It turns out that
<code>.const</code> wasn't quite what Clint needed, so Leo pointed him at
<code>.sym</code> and <code>.local</code> which do seem to do what he needs.</p>
<p><a href="http://groups.google.com/groups?threadm=5.1.0.14.2.20030526183737.027afa68%40mail.geeksalad.org">http://groups.google.com/groups</a></p>

<h2><a name="3arg_opens">3-arg opens</a></h2>
<p>Bryan Warnock wondered if</p>
<pre>
    open I3, &quot;temp.file&quot;, &quot;r&quot;</pre>
<p>was valid code. Answer, no, the right way to do it is the Perlish
<code>open I3, &quot;temp.file&quot;, &quot;&lt;&quot;</code>. J&uuml;rgen B&ouml;mmels promised
more and better documentation for the Parrot IO system. Eventually.</p>
<p><a href="http://groups.google.com/groups?threadm=1053992856.2210.330.camel%40wakko">http://groups.google.com/groups</a></p>

<h2><a name="smaller_pmcs">Smaller PMCs</a></h2>
<p>Leo T&ouml;tsch's work on the new PMC layout continues apace. I'm
afraid I don't quite understand what's going on in this area, which
does make it rather tricky to summarize things. It seems to have a
good deal to do with memory allocation and garbage collection... Leo
thinks that it's the right thing, but there seem to be issues involved
with good ways of allocating zeroed memory.</p>
<p><a href="http://groups.google.com/groups?threadm=3ECF439A.2080005%40toetsch.at">http://groups.google.com/groups</a></p>

<h2><a name="an_experimental_wiki_for_parrot_development">An experimental Wiki for parrot development</a></h2>
<p>Mitchell N Charity has put up an experimental Wiki for Parrot and
primed it with a few things. St&eacute;phane Payrard pointed out that
it's rather hard to make a WikiWord from, for example, PMC. (10 points
to the first person to email <a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a> with the
expansion of PMC).</p>
<p><a href="http://groups.google.com/groups?threadm=200305272235.h4RMZCn02786%40vendian.org">http://groups.google.com/groups</a></p>

<h2><a name="imcc_packfile_bug">IMCC packfile bug</a></h2>
<p>While toying with <em>pbc2c.pl</em>, Luke Palmer discovered that it doesn't
want to play with IMCC generated .pbc files. Apparently this is
because we currently have two bytecode file formats. Leo T&ouml;tsch
thought the problem lay with <em>assemble.pl</em> which is old and slow and
doesn't produce 'proper' parrot bytecode. Leo also thought that the
way <em>pbc2c.pl</em> worked wasn't actually any use. Dan reckoned the time
had come to ditch <em>assemble.pl</em> too, and reckoned there was a case
for renaming IMCC as <em>parrot</em> since it can run either .pbc or
assembly files. Leo liked the idea, but is concerned about the state
of the Tinderbox.</p>
<p><a href="http://groups.google.com/groups?threadm=rt-22352-58313.14.7340141747095%40rt.perl.org">http://groups.google.com/groups</a></p>

<h2><a name="method_calling">Method Calling</a></h2>
<p>Dan tantalized all those waiting eagerly for objects in Parrot by
discussing how to make method calls. This, of course, means a few new
ops, called <code>findmeth</code>, <code>callmeth</code> and <code>callccmeth</code> for the time
being. Jonathan Sillito had a few naming consistency issues with the
ops. Dan agreed there were issues and asked for suggestions for an
opcode naming convention.</p>
<p><a href="http://groups.google.com/groups?threadm=a05210601bafc74ec3036%40%5B192.168.0.78%5D">http://groups.google.com/groups</a></p>

<h2><a name="simple_constant_propagation_in_imcc">Simple Constant Propagation in IMCC</a></h2>
<p>Matt Fowles posted a patch to add simple constant propagation to
IMCC. Essentially this means that, say</p>
<pre>
    set I0, 5
    set I1, 2
    set I2, I1
    add I2, I0</pre>
<p>would compile as if it were:</p>
<pre>
    set I0, 5
    set I1, 2
    set I2, 7</pre>
<p>Leo T&ouml;tsch liked the idea modified it slightly and added it to
the code base, but disabled. Apparently there are problems with it,
but it's a good starting framework. There need to be lots more tests
though...</p>
<p><a href="http://groups.google.com/groups?threadm=rt-22387-58435.10.9396178319999%40rt.perl.org">http://groups.google.com/groups</a></p>

<h2><a name="make_mine_supersized...">Make mine SuperSized...</a></h2>
<p>Bryan Warnock (in his own words) popped in to 'waffle on Parrot's core
sizes'. He proposed a way of drastically simplifying Parrot's type
system. He and Gopal V had a long discussion that I didn't quite
follow. I think Leo thinks that what Bryan proposes is doable, but I'm
not entirely sure whether he thinks it's a good idea...</p>
<p><a href="http://groups.google.com/groups?threadm=1054389285.2211.685.camel%40wakko">http://groups.google.com/groups</a></p>

<h2><a name="register_allocation_in_imcc">Register allocation in IMCC</a></h2>
<p>Clint Pierce had some problems with IMCC's register allocation. He
posted an example that gave problems and wondered if the problem was
with him or with IMCC. Leo T&ouml;tsch confirmed that it was a
bug. Luke Palmer pointed Clint at <code>find_global</code> and friends as the
'correct' way to solve the problem. For bonus points, Clint showed of
a pathological example of why BASIC should not be anyone's favourite
language.</p>
<p><a href="http://groups.google.com/groups?threadm=5.1.0.14.2.20030601114720.01f2cec8%40mail.geeksalad.org">http://groups.google.com/groups</a></p>


<h1><a name="meanwhile,_in_perl6language">Meanwhile, in perl6-language</a></h1>

<h2><a name="cothreads">Cothreads</a></h2>
<p>As if the Coroutine thread wasn't confusing enough, we now have the
Cothread thread, in which Michael Lazzaro argued that we should blur
the distinctions between coroutines and threads. Dave Whipp pointed
everyone at 'Austin Hastings' draft for A17 (threads)' and argued
that, whilst Coroutines, threads, closures, and various other things
that Michael had argued were aspects of the same thing were related,
they sufficiently different that bundling them all up behind a single
class would lead to badness (``a bloated blob with a fat interface'' was
the phrase he used).</p>
<p>This thread saw even more unrestrained speculation than usual and saw
the first use on the Perl 6 lists of the adjective 'Cozeny', from
Simon Cozens, possibly meaning ``feeling that what is being discussed
is over fussy and generally trying to take the language a <em>long</em> way
from what Real Programmers need''. This would seem to imply a verb form
'to Cozen', ``To more or less forcibly express ones Cozeny feelings''.</p>
<p>I'm afraid this was another thread I had a hard time following. I
reckon there's some interesting ideas in there, but I'm hoping that
someone will pull it all together in an RFC type document so I can go
``Remember that Cothreads thread last week? Leon Brocard summarized it
all neatly in a single proposal, you can find it here.'' (Except it
almost certainly won't be Leon Brocard, it'll be Mike Lazzaro, Leon
doesn't seem to do perl6-language very much).</p>
<p><a href="http://groups.google.com/groups?threadm=8520E9CC-8FAB-11D7-92AB-000A277AA894%40cognitivity.com">http://groups.google.com/groups</a></p>
<p><a href="http://archive.develooper.com/perl6-language@perl.org/msg14771.html">http://archive.develooper.com/perl6-language@perl.org/msg14771.html</a>
-- Austin Hastings on threads</p>

<h2><a name="compile_time_binding">Compile time binding</a></h2>
<p>In an effort to learn about Perl 6, Luke Palmer has been reading about
Haskell. For reasons he doesn't understand, this set him to wondering
what <code>::=</code> is supposed to mean -- it means 'compile time
binding', but what does <em>that</em> mean?</p>
<p>Damian Conway came through with the goods, summarizing his answer as
<code>::=</code> is to <code>:=</code> as a macro call is to a subroutine call.</p>
<p><a href="http://groups.google.com/groups?threadm=ygcel2j5p5r.fsf%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>

<h2><a name="threads_and_progress_monitors">Threads and Progress Monitors</a></h2>
<p>Dave Whipp had some more thread questions, and wondered what would be
a good Perl 6ish way of implementing a threaded progress
monitor. Whilst the discussion of all this was interesting, I'm not
sure that it's really much to do with the language, more something
that one would implement according to taste and the particular
requirements of a given project.</p>
<p><a href="http://groups.google.com/groups?threadm=20030529174736.34522.qmail%40onion.perl.org">http://groups.google.com/groups</a></p>

<h2><a name="exegesis_6_status_update">Exegesis 6 Status Update</a></h2>
<p>Damian announced that Exegesis six is mostly written, and should be
undergoing final revisions while he and Larry are on the Perl
Whirl. Hopefully we'll see the Exegesis before YAPC::America::North.</p>
<p><a href="http://groups.google.com/groups?threadm=3EDA5C10.9020904%40conway.org">http://groups.google.com/groups</a></p>


<h1><a name="acknowledgements,_announcements_and_apologies">Acknowledgements, Announcements and Apologies</a></h1>
<p>Thanks once again are due to all the good people on the Perl 6
lists. Apologies will almost certainly be due to the organizers of
YAPC North America as I <em>still</em> haven't started writing the talks I'm
supposed to be giving.</p>
<p>As I noted last week, I'm awarding points (and points mean prizes) to
those kind people who spotted the deliberate mistake. Smylers gets 100
points for spotting the accidental mistake (last week was <em>not</em> in
2004.) Sam Smith, David Wheeler, David Cantrell and Leon Brocard all
earned 50 points for spotting the deliberate mistake of not mentioning
Leon Brocard. But they've helped me make up for it this week by
mentioning him twice, so the karmic balance is restored.</p>
<p>The points I have awarded can be redeemed for the following,
wonderful prizes:</p>
<ol>
<li>
A lifetime subscription to the Perl 6 summaries.</li>

<li>
Er...</li>

<li>
That's it</li>
</ol>
<p>If you've appreciated this summary, please consider one or more of the
following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.</li>

<li>
Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>

<li>
Send feedback, flames, money, photographic and writing commissions, or
a patches to Camelbones making it possible to make Perl classes that
inherit from Objective C classes (heck, if Ruby and Python can do it)
to <em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em>.</li>
</ul>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2003/05/">&laquo; May 2003</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2003/07/">July 2003 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
