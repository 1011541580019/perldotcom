<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/2003/06/13/design1.html">
<dc:title>Perl Design Patterns</dc:title>
<dc:description> Introduction In 1995, Design Patterns was published, and during the intervening years, it has had a great influence on how many developers write software. In this series of articles, I present my take on how the Design Patterns book...</dc:description>
<dc:creator>Phil Crow</dc:creator>
<dc:date>2003-06-13T00:00:00-08:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    
    <link rel="prev bookmark" href="/pub/2003/06/p6pdigest/20030608.html" title="This week on Perl 6, week ending 2003-06-08" />
    <link rel="next bookmark" href="/pub/2003/06/p6pdigest/20030615.html" title="This week on Perl 6, week ending 2003-06-15" />
    
    
    <title>Perl Design Patterns - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1136" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Perl Design Patterns</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Phil Crow</span> on <abbr class="published" title="2003-06-13T00:00:00-08:00">June 13, 2003 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<h3><a name="introduction">Introduction</a></h3>
<p>In 1995, Design Patterns was published, and during the intervening years, it
has had a great influence on how many developers write
software.  In this series of articles, I present my take on how the
Design Patterns book (the so-called Gang of Four book, which I will call
GoF) and its philosophy applies to Perl.  While Perl is an OO language -- you could code the examples from GoF directly in Perl -- many of the
problems the GoF is trying to solve are better solved in Perl-specific
ways, using techniques not open to Java developers or those C++
developers who insist on using only objects. Even if developers in other
languages are willing to consider procedural approaches, they can't, for
instance, use Perl's immensely powerful built-in pattern support.</p>
<p>Though these articles are self-contained, you will get more out of them
if you are familiar with the GoF book (or better yet have it open on
your desk while you read).  If you don't have the book, then try searching
the Web - many people talk about these patterns.  Since the
Web and the book have diagrams of the object versions of the patterns,
I will not reproduce those here, but can direct you to
<a href="http://www.tml.hut.fi/~pnr/GoF-models/html/">this fine site</a>.</p>
<p>I will show you how to implement the highest value patterns in Perl, most
often by using Perl's rich core language.  I even include some objects.</p>
<p>For the object-oriented implementations, I need you to understand
the basics of Perl objects.  You can learn that from printed sources
like the <a href="http://www.oreilly.com/catalog/cookbook">Perl Cookbook</a> by Tom Christiansen and Nat Torkington or <a href="http://www.manning.com/Conway/index.html">Objected
Oriented Perl</a> by Damian Conway.  But the simplest way to learn the
basics is from <a href="http://www.perldoc.com/perl5.8.0/pod/perltoot.html">perldoc perltoot</a>.</p>
<p>As motivation for my approach, let me start with a little object-oriented
philosophy.  Here are my two principles of objects:</p>
<ol>
<li>
Objects are good when data and methods are tightly bound.</li>

<li>
In most other cases, objects are overkill.</li>
</ol>
<p>Let me elaborate briefly on these principles.</p>

<h4><a name="objects_are_good_when_data_and_methods_are_tightly_bound.">Objects are good when data and methods are tightly bound.</a></h4>
<p>When you are working for a company that rents cars (as I do), an object
to represent a rental agreement makes sense.  The data on the agreement
is tightly bound to the methods you need to perform.  To calculate the
amount owed, you take the various rates and add them together, etc.
This is a good use of an object (or actually several aggregated objects).</p>

<h4><a name="in_most_other_cases,_objects_are_overkill.">In most other cases, objects are overkill.</a></h4>
<p>Consider a few examples from other languages.  Java has the <code>java.lang.Math</code>
class.  It provides things such as sine and cosine.  It only provides class
methods and a couple of class constants.  This should not be forced into
an object-oriented framework, since there are no Math objects.  Rather
the functions should be put in the core, left out completely, or made into
non-object-oriented functions.  The last option is not even available
in Java.</p>
<p>Or think of the C++ standard template library.  The whole templating
framework is needed to make C++ backward compatible with C and to handle
strong static-type checking.  This makes for awkward object-oriented
constructs for things that should be simple parts of the core language.
To be specific, why shouldn't the language just have a better array type
at the outset?  Then a few well-named built-in operations take care of
stacks, queues, dequeues and many other structures we learned in school.</p>
<p>So, in particular, I take exception to one consistent GoF trick: turning an
idea into a full-blown class of objects.  I prefer the Perl way of
incorporating the most-important concepts into the core of the language.
Since I prefer this Perl way, I won't be showing how to objectify
things that could more easily be a simple hash with no methods or
a simple function with no class.  I will invert the GoF trick:
implement full-blown pattern classes with simpler Perl concepts.</p>
<p>The patterns in this first article rely primarily on built-in
features of Perl.  Later articles will address other groups of
patterns.  Now that I've told you what I'm about to do, let's start.</p>


<h3><a name="iterator">Iterator</a></h3>
<p>There are many structures that you need to walk one element at a time.
These include simple things such as arrays, moderate things such as the keys
of a hash, and complex things such as the nodes of a tree.</p>
<p>The Gang of Four suggest solving this problem with the above mentioned
trick: turn a concept into an object.  Here that means you should make
an iterator object.  Each class of objects that can reasonably be
walked should have a method that returns an iterator object.  The object
itself always behaves in a uniform way.  For example, consider the following
code, which uses an iterator to walk the keys of a hash in Java.</p>
<pre><code>
    for (Iterator iter = hash.keySet().iterator(); iter.hasNext();) {
        Object key   = iter.next();
        Object value = hash.get(key);
        System.out.println(key + &quot;\t&quot; + value);
    }</code></pre>
<p>The HashMap object has something that can be walked: its keys.  You
can ask it for this keySet.  That Set will give you an Iterator
on request to its iterator method.  The Iterator responds to
hasNext with a true value if there are more things to be walked,
and false otherwise.  Its next method delivers the next object in
whatever sequence the Iterator is managing.  With that key, the
HashMap delivers the next value in response to get(key).
This is neat and tidy in the completely OO framework of a language
with limited operators and built-in types.  It also perfectly exhibits
the GoF iterator pattern.</p>
<p>In Perl any built-in or user defined object which can be walked
has a method which returns an ordered list of the items to be walked.
To walk the list, simply place it inside the parentheses of a
foreach loop.  So the Perl version of the above hash key walker is:</p>
<pre><code>
    foreach my $key (keys %hash) {
        print &quot;$key\t$hash{$key}\n&quot;;
    }</code></pre>
<p>I could implement the pattern exactly as it is diagrammed in GoF,
but Perl provides a better way.  In Perl 6, it will even be possible
to return a list that expands lazily, so the above will be more
efficient than it is now.  In Perl 5, the keys list is built completely
when I call <code>keys</code>.  In the future, the keys list will be built on
demand, saving memory in most cases, and time in cases where the loop
ends early.</p>
<p>The inclusion of iteration as a core concept represents Perl design
at its finest.  Instead of providing a clumsy mechanism in non-core
code, as Java and C++ (through its standard template library) do,
Perl incorporates this pattern into the core of the language.
As I alluded to in the introduction, there is a Perl principle here:</p>
<p><strong>If a pattern is really valuable, then it should be part of the core language.</strong></p>
<p>The above example is from the core of the language.  To see that <code>foreach</code>
fully implements the iterator pattern, even for user-defined modules,
consider an example from CPAN: <a href="http://search.cpan.org/perldoc?XML::DOM"><code>XML::DOM</code></a>.  The DOM for XML was specified
by Java programmers.  One of the methods you can call on a DOM Document is
<code>getElementsByTagName</code>.  In the DOM specification this returns a
<code>NodeList</code>,
which is a Java Collection.  Thus, the <code>NodeList</code> works like the Set in the
Java code above.  You must ask it for an Iterator, then walk the Iterator.</p>
<p>When Perl people implemented the DOM, they decided that
<code>getElementsByTagName</code>
would return a proper Perl list.  To walk the list one says something like:</p>
<pre><code>
    foreach my $element ($doc-&gt;getElementsByTagName(&quot;tag&quot;)) {
        # ... process the element ...
    }</code></pre>
<p>This stands in stark contrast to the overly verbose Java version:</p>
<pre><code>
    NodeList elements = doc.getElementsByTagName(&quot;tag&quot;);
    for (Iterator iter = elements.iterator(); iter.hasNext();) {
        Element element = (Element)iter.next();
        // ... process the element ...
    }</code></pre>
<p>One beauty of Perl is its ability to combine procedural, object-oriented,
and core concepts in such powerful ways.  The facts that GoF
suggests implementing a pattern with objects and that object only languages
like Java require it do not mean that Perl programmers should ignore
the non-object features of Perl.</p>
<p>Perl succeeds largely by excellent use of the principle of promotion.
Essential patterns are integrated into the core of the language.  Useful
things are implemented in modules.  Useless things are usually missing.</p>
<p>So the iterator pattern from GoF is a core part of Perl we hardly think
about.  The next pattern might actually require us to do some work.</p>


<h3><a name="decorator">Decorator</a></h3>
<p>In normal operation, a <strong>decorator</strong> wraps an object, responding to the same
API as the wrapped object.  For example, suppose I add a compressing
decorator to a file writing object.  The caller passes a file
writer to the decorator's constructor, and calls <code>write</code> on the decorator.
The decorator's write method first compresses the data, then calls the
<code>write</code> method of the file writer it wraps.  Any other type of
writer could be wrapped with the same decorator, so long as all writers
respond to the same API.  Other decorators can also be used in a chain.
The text could be converted from ASCII to unicode by one decorator and
compressed by another.  The order of the decorators is important.</p>
<p>In Perl, I can do this with objects, but I can also use a couple of
language features to obtain most of the decorations I need, sometimes
relying solely on built-in syntax.</p>
<p>I/O is the most common use of decoration.  Perl provides I/O decoration
directly.  Consider the above example: compressing while writing.  Here are
two ways to do this.</p>

<h4><a name="use_the_shell_and_its_tools">Use the Shell and Its Tools</a></h4>
<p>When I open a file for writing in Perl, I can decorate via shell tools.
Here is the above example in code:</p>
<pre><code>
    open FILE, &quot;| gzip &gt; output.gz&quot;
        or die &quot;Couldn't open gzip and/or output.gz: $!\n&quot;;</code></pre>
<p>Now everything I write is passed through <em>gzip</em> on its way to <em>output.gz</em>.
This works great so long as (1) you are willing to use the shell, which
sometimes raises security issues; and (2) the shell has a tool to do
what you need done.  There is also an efficiency concern here.  The
operating system will spawn a new process for the gzip step.  Process
creation is about the slowest thing the OS can do without performing I/O.</p>

<h4><a name="tying">Tying</a></h4>
<p>If you need more control over what happens to your data, then you can decorate
it yourself with Perl's tie mechanism.  It will be even faster, easier
to use, and more powerful in Perl 6, but it works in Perl 5.  It does
work within Perl's OO framework; see <a href="http://www.perldoc.com/perl5.8.0/pod/perltie.html">perltie</a> for more information.</p>
<p>Suppose I want to preface each line of output on a handle with a time stamp.
Here's a tied class to do it.</p>
<pre><code>
    package AddStamp;
    use strict; use warnings;

    sub TIEHANDLE {
        my $class  = shift;
        my $handle = shift;
        return bless \$handle, $class;
    }

    sub PRINT {
        my $handle = shift;
        my $stamp  = localtime();

        print $handle &quot;$stamp &quot;, @_;
    }

    sub CLOSE {
        my $self = shift;
        close $self;
    }

    1;</code></pre>
<p>This class is minimal, in real life you need more code to make the
decorator more robust and complete.  For example, the above code does
not check to make sure the handle is writable nor does it provide
<code>PRINTF</code>,
so calls to <code>printf</code> will fail.  Feel free to fill in the details.
(Again, see perldoc perltie for more information.)</p>
<p>Here's what these pieces do.  The constructor for a tied file
handle class is called <code>TIEHANDLE</code>.  Its name is fixed and uppercase,
because Perl calls this for you.  This is a class method, so the
first argument is the class name.  The other argument is an open
output handle.  The constructor merely blesses a reference to this
handle and returns that reference.</p>
<p>The <code>PRINT</code> method receives the object constructed in <code>TIEHANDLE</code> plus
all the arguments supplied to print.  It calculates the time stamp
and sends that together with the original arguments to the handle
using the real print function.  This is typical decoration at work.
The decorating object responds to print just like a regular handle
would.  It does a little work, then calls the same method on the
wrapped object.</p>
<p>The <code>CLOSE</code> method closes the handle.  I could have inherited from
<a href="http://search.cpan.org/perldoc?Tie::StdHandle">Tie::StdHandle</a> to gain this method and many more like it.</p>
<p>Once I put <em>AddTimeStamp.pm</em> in my lib path, I can use it like this:</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    use AddStamp;

    open LOG, &quot;&gt;output.tmp&quot; or die &quot;Couldn't write output.tmp: $!\n&quot;;
    tie *STAMPED_LOG, &quot;AddStamp&quot;, *LOG;

    while (&lt;&gt;) {
        print STAMPED_LOG;
    }

    close STAMPED_LOG;</code></pre>
<p>After opening the file for writing as usual, I use the built-in <code>tie</code>
function to bind the <code>LOG</code> handle to the <code>AddStamp</code> class under the name
<code>STAMPED_LOG</code>.  After that, I refer exclusively to <code>STAMPED_LOG</code>.</p>
<p>If there are other tied decorators, then I can pass the tied handle to
them.  The only downside is that Perl 5 ties are slower than normal
operations.  Yet, in my experience, disks and networks are my bottlenecks
so in memory inefficiency like this tends not to matter.  Even
if I make the script code execute 90 percent faster, I don't save a noticeable
amount of time, because it wasn't using much time in the first place.</p>
<p>This technique works for many of the built-in types: scalars, arrays,
hashes, as well as file handles. <em>perltie</em> explains how to
tie each of those.</p>
<p>Ties are great since they don't require the caller to understand the
magic you are employing behind their back.  That is also true of GoF
decorators with one clear exception: In Perl, you can change the
behavior of built-in types.</p>













<h4><a name="decorating_lists">Decorating Lists</a></h4>
<p>One of the most common tasks in Perl is to transform a list in some
way.  Perhaps you need to skip all entries in the list that start with
underscore.  Perhaps you need to sort or reverse the list.  Many built-in
functions are list filters.  They take a list, do something to it and
return a resultant list.  This is similar to Unix filters, which expect
lines of data on standard input, which they manipulate in some way, before
sending the result to standard output.  Just as in Unix, Perl list filters
can be chained together.  For example, suppose you want a list of all
subdirectories of the current directory in reverse alphabetical order.
Here's one possible solution.</p>
<pre><code>
 1  #!/usr/bin/perl
 2  use strict; use warnings;
 3
 4  opendir DIR, &quot;.&quot;,
 5      or die &quot;Can't read this directory, how did you get here?\n&quot;;
 6  my @files = reverse sort map { -d $_ ? $_ : () } readdir DIR;
 7  closedir DIR;
 8  print &quot;@files\n&quot;;</code></pre>
<p>Perl 6 will introduce a more meaningful notation for these operations,
but you can learn to read them in Perl 5, with a little effort.  Line 6
is the interesting one.  Start reading it on the right (this is backward
for Unix people).  First, it reads the directory.  Since <code>map</code> expects
a list, <code>readdir</code> returns a list of all files in the directory. <code>map</code>
generates a list with the name of each file which is a directory (or
<code>undef</code> if the <code>-d</code> test fails). <code>sort</code> puts the list in
ASCII-betical order. <code>reverse</code> reverses that.  The result is stored in
<code>@files</code> for later printing.</p>
<p>You can make your own list filter quite easily.  Suppose you wanted to
replace the ugly <code>map</code> usage above (I tend to think <code>map</code> is always ugly)
with a special purpose function, here's how:</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    sub dirs_only (@) {
        my @retval;
        foreach my $entry (@_) {
            push @retval, $entry if (-d $entry);
        }
        return @retval;
    }

    opendir DIR, &quot;.&quot;
        or die &quot;Can't read this directory, how did you get here?\n&quot;;
    my @files = reverse sort { lc($a) cmp lc($b) } dirs_only readdir DIR;
    closedir DIR;
    local $&quot; = &quot;;&quot;;
    print &quot;@files\n&quot;;</code></pre>
<p>The new <code>dirs_only</code> routine replaces <code>map</code> above, leaving out the
entries we don't want to see.</p>
<p>The <code>sort</code> now has an explicit comparison subroutine.  This is to prevent it
from thinking that <code>dirs_only</code> is its comparison routine.  Since I had to
include this, I chose to take advantage of the situation and sort with
more finesse: ignoring case.</p>
<p>You can make such list filters to your heart's content.</p>
<p>I have now shown you the most important types of decoration.  Any others
you need could be implemented in the traditional GoF way.</p>
<p>The next pattern feels like cheating, but then Perl often gives me that
feeling.</p>


<h3><a name="flyweight">Flyweight</a></h3>
<p>The idea of reusing objects is the essence of the flyweight pattern.
Thanks to Mark-Jason Dominus, Perl takes this far beyond what the GoF
had in mind.  Further, he did the work once and for all.  Larry Wall
likes this idea so much he's promoting it to the core for Perl 6
(there's that promotion concept again).</p>
<p>What I want is this:</p>
<p><strong>For objects whose instances don't matter (they are constants or random), those requesting a new object should be given the same one they already received whenever possible.</strong></p>
<p>This pattern fails dramatically if separate instances matter.  But if
they don't, then it would save time and memory.</p>
<p>Here's an example of how this works in Perl.  Suppose I want to provide
a die class for games like Monopoly or Craps.  My die class might look
like this:
(Warning: This example is contrived to show you the technique.)</p>
<pre><code>
    package CheapDie;
    use strict; use warnings;

    use Memoize;
    memoize('new');

    sub new {
        my $class = shift;
        my $sides = shift;
        return bless \$sides, $class;
    }

    sub roll {
        my $sides         = shift;
        my $random_number = rand;

        return int ($random_number * $sides) + 1;
    }

    1;</code></pre>
<p>On first glance, this looks like many other classes.  It has a constructor
called new.  The constructor stores the received number of sides into a
subroutine lexical variable (a.k.a. a my variable), returning a blessed
reference to it.  The roll method calculates a random number,
scales it according to the number of sides, and returns the result.</p>
<p>The only thing strange here are these two lines:</p>
<pre><code>
    use Memoize;
    memoize('new');</code></pre>
<p>These exploit Perl's magic extraordinarily well.  The <code>memoize</code>
function modifies the calling package's symbol table so that <code>new</code> is
wrapped.  The wrapping function examines the incoming arguments (the
number of sides in this case).  If it has not seen those arguments before,
then it would call the function as the user intended, storing the result in
a cache and returning it to the user.  This takes more time and memory than
if I had not used the module.</p>
<p>The savings come when the method is called again.  When the wrapper notices
a call with the same arguments it used before, it does not call the method.
Rather, it sends the cached object instead.  We don't have to do anything
special as a caller or as an object implementor.  If your object is
big, or slow to construct, then this technique would save you time and
memory.  In my case, it wastes both since the objects are so small.</p>
<p>The only thing to keep in mind is that some methods don't benefit from
this technique.  For example, if I memoize <code>roll</code>, then it would return
the same number each time, which is not exactly the desired result.</p>
<p>Note too that <a href="http://search.cpan.org/perldoc?Memoize">Memoize</a> can be used in non-object situations - in fact
the documentation for it doesn't seem to contemplate using it for object
factories.</p>
<p>Not only do languages such as Java not have core functions for caching
method returns, they don't allow clever users to implement them.  
Mark-Jason Dominus did a fine thing implementing Memoize, but 
Larry Wall did a
better thing by letting him.  Imagine Java letting a user write a
class that manipulated the caller's symbol table at run time - I
can almost hear the screams of terror.  Of course, these techniques
can be abused, but precluding them is a greater loss than rejecting
poor code on the few occasions that some less-than-stellar programmer
improperly adjusts the symbol table.</p>
<p>In Perl all things are legal, but some are best left to modules with
strong development communities.  This allows regular users to take advantage
of magic manipulations without worrying about whether our own magic
will work. <code>Memoize</code> is an example.  Instead of rolling your own wrapped
call and caching scheme, use the well-tested one that ships with Perl
(and looked for the 'is cached' trait to do this for routines in Perl 6).</p>
<p>The next pattern is related to this one, so you can use flyweight to
implement it.</p>


<h3><a name="singleton">Singleton</a></h3>
<p>In the flyweight pattern, we saw that there are sometimes resources that
everyone can share.  GoF calls the special case when there is a single
resource that everyone needs to share the singleton pattern.  Perhaps the
resource is a hash of configuration parameters.  Everyone should be able to
look there, but it should only be built on startup (and possibly rebuilt on
some signal).</p>
<p>In most cases, you could just use <code>Memoize</code>.  That seems most reasonable to me.
(See the flyweight section above.) In that case, everyone who wants access
to the resource calls the constructor.  The first person to do so causes
the construction to happen and receives the object.  Subsequent people call
the constructor, but they receive the originally constructed object.</p>
<p>There are many other ways to achieve this same effect.  For instance, if
you think your callers might pass you unexpected arguments, then <code>Memoize</code> would
make multiple instances, one for each set of arguments.  In this case,
managing the singleton with modules like <a href="http://search.cpan.org/perldoc?Cache::FastMemoryCache">Cache::FastMemoryCache</a> from CPAN
may make more sense. You could even
use a file lexical, assigning it a value in a <code>BEGIN</code> block.  Remember
bless doesn't have to be used in a method.  You could say:</p>
<pre><code>
    package Name;
    my $singleton;
    BEGIN {
        $singleton = {
            attribute =&gt; 'value',
            another   =&gt; 'something',
        };
        bless $singleton, &quot;Name&quot;;
    }

    sub new {
        my $class = shift;
        return $singleton;
    }</code></pre>
<p>This avoids some of the overhead of Memoize and shows what I'm doing more
directly.  I made no attempt to take subclassing into account here.  Maybe
I should, but the pattern says a singleton should belong always to one class.
The fundamental statement about singletons is:</p>
<p><strong>``There can only be one singleton.''</strong></p>


<h3><a name="summary">Summary</a></h3>
<p>All four of the patterns shown in this article use built-in features,
or standard modules.  The iterator is implemented with <code>foreach</code>.  The
decorator is implemented for I/O with Unix pipe and redirection
syntax or with a tied file handle.  For lists, decorators are just
functions which take and return lists.  So, I might call decorators
filters.  Flyweights are shared objects easily implemented with the
Memoize module.  Singletons can be implemented as flyweights or with
simple object techniques.</p>
<p>The next time some uppity OO programmer starts going on about patterns,
rest assured, you know how to use them.  In fact, they are built-in
to the core of your language (at least if you have the sense to use Perl).</p>
<p>Next time, I will look at patterns which rely on code references or
data containers.</p>

<h4><a name="acknowledgements_and_background">Acknowledgements and Background</a></h4>
<p>I wrote these articles after taking a training course using GoF from a well-known training and consulting company.  My writing is also informed by
many people in the Perl community, including Mark-Jason Dominus, who
showed at YAPC 2002, using his unique flair, how Perl deals with the
iterator pattern.  Though the writing here is mine, the inspiration
comes from Dominus and many others in the Perl community, most of all Larry
Wall, who have incorporated patterns into the heart of Perl during the
years.  As these patterns show, time and time again, Perl employs the
principle of promotion carefully
and well.  Instead of adding a collection framework in source code modules,
as Java and C++ do, Perl has only two collections: arrays and hashes.
Both are core to the language.  I think Perl's greatest strength
is the community's choices of what to include in the core, what to ship
along with the core, and what to leave out.  Perl 6 will only make Perl
more competitive in the war of language design ideas.</p>


                                    </div>


                                </div>
                                <div class="asset-footer">


                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
