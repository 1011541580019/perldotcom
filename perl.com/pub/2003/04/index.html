<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: April 2003 Archives</title>


    <link rel="prev" href="/pub/2003/03/" title="March 2003" />
    <link rel="next" href="/pub/2003/05/" title="May 2003" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">April 2003 Archives</h1>





                            
                            <div id="entry-1116" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/04/p6pdigest/20030427.html" rel="bookmark">This week on Perl 6, week ending 2003-04-27</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-04-27T00:00:00-08:00">April 27, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Welcome back to (I hope) a normal length summary of Perl 6 shenanigans
after last week's bumper double length installment. (Thankfully
traffic has been much lighter this week; I'm not sure I could cope
with writing another epic.)</p>
<p>Perl6-internals was quiet again this week, but traffic does appear
to be picking up a little.</p>

<h4><a name="imc_and_variable_number_of_arguments">IMC and Variable Number of Arguments</a></h4>
<p>Following on from questions on this subject last week, Klaas-Jan Stol asked
for some clarification of Parrot calling conventions as documented in
Parrot Design Document (PDD) 03. In a subsequent post he noted that it
seems strange that the current perl6 implementation (such as it is)
doesn't follow the Parrot calling conventions. Sean O'Rourke shuffled
his feet slightly and admitted that he'd chosen that method because
``It was easiest'', though he'd later rationalized that to ``It doesn't
matter for internal calls''. Dan Sugalski pointed out that it was only
a temporary aberration. Unless I missed something, nobody actually
answered Klaas-Jan's initial questions.</p>
<p><a href="http://groups.google.com/groups?threadm=004301c30836%242bb7d530%246401a8c0%40deepblue">http://groups.google.com/groups</a></p>

<h4><a name="shortlived_memory_allocation">Short-lived memory allocation</a></h4>
<p>Last week, in a discussion of the Garbage Collection (GC) system, Dan
mentioned that Parrot GC would walk the system stack in order to build
the Root Set (the list of memory 'nodes' that are initially known to
be alive) which makes life a good deal easier for anyone allocating
memory because they don't have to worry about explicitly attaching
their shiny new buffer to the root set. Of course, it doesn't lessen
the pain of whoever writes the GC system because, as Benjamin Goldberg
pointed out, any system stack walking system is inherently
unportable.</p>
<p>Benjamin was concerned that there may be systems where, not only could
you not use the same stack walking code as was used everywhere else,
but it would be impossible to walk the system stack at all. Dan
admitted that there 'used to be' such systems, but asserted that, for
Parrot's purposes ``Either we get access to the C auto variable chain,
or we can't run there.'' Kurt Stephens pointed at some deeply scary
sounding (and gloriously non-portable) system stack walking methods
which involve co opting the C stack pointer and collecting garbage from
unlikely places...</p>
<p>If you're not sure what is meant by 'Walking the system stack' then
you're not alone. Tim Howell asked for clarification and received it
from Matt Fowles and Brent Dax.</p>
<p><a href="http://groups.google.com/groups?threadm=3EA5F617.DF8C2E43%40earthlink.net">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=86671D11624E2944A477B1E7AB38DC16A6048F%40exchange.fefcful.org">http://groups.google.com/groups</a></p>

<h4><a name="pmc_documentation">PMC Documentation</a></h4>
<p>Alberto Sim&otilde;es continued on his mission to document Parrot's
various PMC classes. This week he offered up some Perlstring documentation</p>
<p><a href="http://groups.google.com/groups?threadm=20030423072628.GA3286%40alfarrabio.di.uminho.pt">http://groups.google.com/groups</a></p>

<h4><a name="the_native_call_interface_(nci)_system.">The Native Call Interface (NCI) system.</a></h4>
<p>Michael Collins has been playing around with calling C from Parrot and
found the NCI system rather cumbersome. He wondered if the whole thing
couldn't simply be implemented with a <code>callcfunc</code> opcode and showed a
simple implementation of what he was driving at. Dan replied to this,
explaining that he'd considered it but that it turns out not to be the
Right Thing, and gave his reasons to do with encapsulation (when you
call a PMC's method you shouldn't have to know whether it's written in
C, PASM or Befunge) and issues with dynamic generation of stub
functions. Michael wasn't entirely convinced by Dan's argument.</p>
<p>On the subject of NCI, Clinton A Pierce wondered if it is supposed to
be Win32 capable and, if it was, what he needed to do to get it
working as his first attempt had failed. Currently on the horns of
Warnock's Dilemma.</p>
<p><a href="http://groups.google.com/groups?threadm=1413.192.168.1.3.1051146003.squirrel%40www.ivorycity.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=5.1.0.14.2.20030424121644.00b34a68%40mail.geeksalad.org">http://groups.google.com/groups</a></p>

<h4><a name="use_for_p6c"><code>use</code> for p6c</a></h4>
<p>Joseph F. Ryan resent his patch to implement <code>use</code> in Parrot's Perl 6
implementation, this time as a straight CVS diff on Steve Fink's
request.</p>
<p><a href="http://groups.google.com/groups?threadm=3EA73A7E.9000403%40osu.edu">http://groups.google.com/groups</a></p>

<h4><a name="building_on_win32">Building on Win32</a></h4>
<p>Matthia Barbon continued his sterling work on getting Parrot to play
well with Win32, offering a couple of patches. Steve Fink applied them
both.</p>
<p><a href="http://groups.google.com/groups?threadm=Mahogany-0.64.2-1156-20030424-234320.00%40rbnet.it">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20030427074312.GB2717%40foxglove">http://groups.google.com/groups</a></p>

<h4><a name="external_data_interfaces_draft_pdd">External Data Interfaces draft PDD</a></h4>
<p>Matthia Barbon redrafted Brent Dax's External Data Interfaces PDD
based on the discussion of the original document. This elicited a few
comments and I presume we can expect another, clarified draft at some
point.</p>
<p><a href="http://groups.google.com/groups?threadm=Mahogany-0.64.2-1156-20030424-234520.00%40rbnet.it">http://groups.google.com/groups</a></p>

<h4><a name="ppc_jit_questions">PPC JIT questions</a></h4>
<p>Peter Montagner has started to work on the Just In Time (JIT) system
for the PowerPC architecture (a chap can get tired of making sure that
every initialism is expanded at least once in a document you
know. Still, it's been a few summaries since I last did anything like
this) and had a couple of questions about its architecture and what he
was allowed to do in PPC assembly. Dan answered, Peter asked for
clarification; the usual give and take.</p>
<p><a href="http://groups.google.com/groups?threadm=EEE7E67C-7712-11D7-B7FC-000393934DD6%40postinbox.com">http://groups.google.com/groups</a></p>

<h4><a name="a_question_about_encoding">A question about encoding</a></h4>
<p>Speed junkie Luke Palmer (Hmm... that may not mean quite what I want
it to mean) is working on the next iteration of <code>string_str_search</code>,
which, apparently isn't fast enough (it's still slower than Perl
5). He had a few questions about encodings. Benjamin Goldberg offered
answers and an entire function. Luke was impressed, but he still
muttered about how much faster single byte searching could be (he's
written a singlebyte/singlebyte search routine that goes slightly more
than 2.5 times faster than Perl 5 apparently).</p>
<p>Later, Luke posted a new implementation of <code>string_str_search</code> which
used his screamingly fast algorithm for single byte searching and a
'stupid, slow algorithm' for multibyte searches. Steve Fink applied
the patch and asked for a unified diff next time as they are easier to
read.</p>
<p><a href="http://groups.google.com/groups?threadm=20030427032624.42EECC5%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=ygcel3o9ygf.fsf%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>

<h4><a name="leo_ttsch's_iterator_proposal">Leo T&ouml;tsch's iterator proposal</a></h4>
<p>Remember Leo T&ouml;tsch's iterator proposal that received so little
feedback a few weeks back? Steve Fink finally commented.</p>
<p><a href="http://groups.google.com/groups?threadm=20030427083919.GF2717%40foxglove">http://groups.google.com/groups</a></p>

<h4><a name="uniq.pasm_and_parrot_io">uniq.pasm and Parrot IO</a></h4>
<p>About a month ago, J&uuml;rgen B&ouml;mmels was doing some work on the
moving Parrot's IO operators to use Parrot's own PIO asynchronous IO
system, which broke Leon Brocard's <em>uniq.pasm</em>. J&uuml;rgen
estimated that he might have it working 'next weekend'. This week Leon
asked if any progress had been made yet.</p>
<p><a href="http://groups.google.com/groups?threadm=20030427085548.GA27550%40kanga.astray.com">http://groups.google.com/groups</a></p>













<h3><a name="meanwhile,_over_in_perl6language">Meanwhile, over in perl6-language</a></h3>
<p>The Type discussions continued. (Though I note, with some satisfaction
that most of the discussions died down after I posted the
summary. Maybe I got it right. Or not.)</p>

<h4><a name="types">Types</a></h4>
<p>Michael Lazzaro's excellent summary of what we knew about Types served
as the seed for this particular discussion, which was essentially a
continuation by other title of the thread that started last
week. Discussion centred on ways of specifying what sorts of type
coercions should be automatic and which disallowed. Paul Hodges
suggested <code>use strict allow =&gt; { Int =&gt; Str, Foo =&gt; Bar }</code> as a
possibility, which doesn't quite work where you want to allow a type
to convert to more than one possible target type, but it does look
like a reasonable start.</p>
<p>There was also discussion of autocoercion to different types via a
'path' of coercions which looks to like it has enormous potential for
complexity based nuisance. Michael Lazzaro reckoned that a lot of the
chaining problems would go away if you drew a distinction between a
'lossless' coercion to a string and a serialization of something to a
string for the purposes of debugging or whatever. (Coercing *from* a
string to almost any other type but a numeric one seems to be the hard
problem...)</p>
<p>Damian offered some thoughts about user defined coercions when he
pointed out that a coercion is really an interaction between two
classes and should therefore be implemented using a multimethod. He
argued that things like Coercions were a strong argument for allowing
return type to be incorporated into the multidispatch resolution
mechanism. Others agreed that this would be a good thing, and we await
a decision from Larry.</p>
<p><a href="http://groups.google.com/groups?threadm=95A29C02-71EF-11D7-BA15-00050245244A%40cognitivity.com">http://groups.google.com/groups</a> -- Seed</p>
<p><a href="http://groups.google.com/groups?threadm=010201c307a0%24a9ee62c0%2436e7403e%40server">http://groups.google.com/groups</a> -- This week's 'root'</p>
<p><a href="http://groups.google.com/groups?threadm=3EA34EF9.4070205%40conway.org">http://groups.google.com/groups</a></p>

<h4><a name="change_in_'if'_syntax">Change in 'if' syntax</a></h4>
<p>The Subject of the thread still thinks the discussion is about a
change in the syntax of <code>if</code>, but it's actually about a change in how
a block is recognized, which has knock on effects on on the syntax of
various control structures, of which <code>if</code> is just one
example. Various people balked (again) at the fact that the new rules
for detecting a block mean that code like <code> %foo {bar}</code> no longer
means ``find the value associated with 'bar' in the hash %foo'' but
instead evaluates to a hash variable followed by a block, and probably
a syntax error soon afterwards. Michael Lazzaro and Damian showed
workarounds for this (<code>%foo .{bar}</code> and <code>%foo{ bar}</code> respectively)
and Arcadi Shehter reminded everyone of the space eating <code>_</code> that
seems to have been completely forgotten since the last time this issue
arose.</p>
<p><a href="http://groups.google.com/groups?threadm=m23cka629e.fsf%40TiBook.bofh.org.uk">http://groups.google.com/groups</a></p>

<h4><a name="anonsub()'s_execute_in_a_for"><code>anon-sub()</code>'s execute in a for??</a></h4>
<p>Paul Hodges took a crack at implementing <code>for</code> as a subroutine and
came up with something that didn't look too insane. Luke Palmer added
a refinement allowing for n at a time looping. However, for reasons
that I can't quite put my finger on, I'm not quite sure that either
method has got the sub signature quite right, and I'm not entirely
sure how you would express <code>for</code>'s signature as a Perl 6 signature
anyway. Answers on a mailing list please.</p>
<p><a href="http://groups.google.com/groups?threadm=20030422171801.35742.qmail%40web41204.mail.yahoo.com">http://groups.google.com/groups</a></p>

<h4><a name="*_vs_**"><code>*</code> vs <code>**</code></a></h4>
<p>Paul Hodges wondered about the <code>*</code> and <code>**</code> flattening operators. He
wondered if they were actually distinct operators or if the double
variant was simply the result of applying <code>*</code> to the results of
<code>*@whatever</code>. According to Larry, the two are distinct, the only
difference between them is one of timing. I'm not sure I understood
the distinction to be honest and I don't think I'm alone in
this. Austin Hastings asked for an illustrative example, but we didn't
see any before the end of the week.</p>
<p><a href="http://groups.google.com/groups?threadm=20030422215146.432.qmail%40web41204.mail.yahoo.com">http://groups.google.com/groups</a></p>

<h4><a name="p6objects:_hint's_allegations_and_things_unsaid">P6Objects: Hint's allegations and things unsaid</a></h4>
<p>Austin Hastings' response to last week's mammoth Types discussion was
a mammoth document of his own on what is currently known about Perl
6's Object Orientation features which was the result of trawling back
through about two years of perl6-language postings. And jolly good it
is too. It triggered a modest amount of discussion, but my theory is
that everyone was too impressed to say much. I know I was.</p>
<p><a href="http://groups.google.com/groups?threadm=ICELKKFHGNOHCNCCCBKFKEAMCEAA.Austin_Hastings%40Yahoo.com">http://groups.google.com/groups</a></p>

<h4><a name="storing_program_state_for_restarting">Storing program state for restarting</a></h4>
<p>Ed Peschko wondered if it would be possible to serialize the state of
a running program so that it could pick up where it left off after it
died at the point of expiry. Dave Storrs suggested that, if one could
just serialize the current continuation, the problem would become
trivial (I'm not entirely sure he's right about that though; the
current continuation seems to me to be in slightly the wrong place)
and asked how one could do such a thing. The answer appears to be 'to
the best of current research's knowledge, you can't generally do that,
but we're working on it...'.</p>
<p><a href="http://groups.google.com/groups?threadm=20030422152656.A17489%40mdssirds.comp.pge.com">http://groups.google.com/groups</a></p>

<h4><a name="cstruct_style_data_reads">C-struct style data reads</a></h4>
<p>Paul Hodges doesn't like <code>pack</code>. What he wants to be able to do is
something akin to C's:</p>
<pre>
    struct {
        int   someInt;
        float someFloat;
        char  strData[42];
        float otherFloat;
        char  moreStr[123]
    } buf;
    fread(buf, sizeof buf, 1, fp);
    printf(&quot;%.0f %s&quot;, buf.someFloat, buf.moreStr);</pre>
<p>instead of unpacking a string with <code>unpack &quot;ifa43fa123&quot; &lt;$file&gt;</code>
or whatever. This led to some discussion of appropriate syntax and the
like, but it was generally felt that, even if something like this
wasn't in the core, it wouldn't be too hard to implement it.</p>
<p><a href="http://groups.google.com/groups?threadm=20030423151120.47160.qmail%40web41206.mail.yahoo.com">http://groups.google.com/groups</a></p>

<h4><a name="return_types_vs._generic_programming">Return types vs. Generic Programming</a></h4>
<p>Michael Lazzaro wants the moon on a stick. In particular he wants to
be able to declare:</p>
<pre>
   class Object { method CLONE returns MAGIC_TYPE {...} }</pre>
<p>where MAGIC_TYPE is some magical token that means not having to
declare</p>
<pre>
   class Whatever { method CLONE returns Whatever { .NEXT::CLONE } }
   class Whoever  { method CLONE returns Whoever  { .NEXT::CLONE } }</pre>
<p>Quite what's wrong with</p>
<pre>
   class Object { method CLONE returns Object {...} }</pre>
<p>is a mystery to me. Luke Palmer wants more than that. The insanity
continued for several messages.</p>
<p>Do you get the feeling that I'm not a fan of this particular proposal?
I confess I'm finding it very hard to summarize it any more than the
above without exclamations of shock and dismay. So I'll stop now. Read
the thread if you're interested.</p>
<p><a href="http://groups.google.com/groups?threadm=09747A96-75AF-11D7-BB99-00050245244A%40cognitivity.com">http://groups.google.com/groups</a></p>

<h4><a name="type_conversion_matrix">Type Conversion Matrix</a></h4>
<p>Michael Lazzaro posted a matrix of some of the known built in types
and of the possibilities of conversion between them, noting that what
was shown were the conversions that it was possible to make automatic,
not necessarily those which should be automatic. For some reason this
led to a discussion of boolean types. Nope, I don't know why either.</p>
<p>Another subthread discussed which conversions were lossy and whether
or not to make them automatic in the case of going from, say 'Int' to
'int'. (Int being a Perl Integer which could be undef and have
properties and traits, and 'int' being, essentially, at least 32 bits
of signed integer).</p>
<p>Michael posted a second take on the matrix with more information and
with an additional 'Scalar' type added to it.</p>
<p><a href="http://groups.google.com/groups?threadm=9B96DAF4-75C3-11D7-BB99-00050245244A%40cognitivity.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=B223400E-767E-11D7-9AE3-00050245244A%40cognitivity.com">http://groups.google.com/groups</a></p>

<h4><a name="fun_with_junctions">Fun with Junctions</a></h4>
<p>Austin Hastings got faintly confused by the difference between 'all'
and 'any' junctions. The rule of thumb appears to be 'if you want to
use a junction to represent a set, use an ``any'' junction.'</p>
<p><a href="http://groups.google.com/groups?threadm=20030423203739.3147.qmail%40web12302.mail.yahoo.com">http://groups.google.com/groups</a></p>

<h4><a name="fun_with_multidimensional_arrays">Fun with multi-dimensional arrays</a></h4>
<p>Dave Whipp pointed everyone at a discussion of Perl 6 on Perlmonks,
where people were implementing J H Conway's Game of Life in Perl. Dave
had a some questions about tools for iterating over multidimensional
arrays, suggesting some syntax as he went, then pulling it all
together in a rather neat recalculation engine for the game of life.</p>
<p>Things got scary pretty quickly after that; at one point Dave even did
a local redefinition of <code>infix:=</code> which certainly had me
worried. Some clever stuff going on there and no mistake.</p>
<p><a href="http://groups.google.com/groups?threadm=20030427004929.88458.qmail%40onion.perl.org">http://groups.google.com/groups</a></p>
<p><a href="http://www.perlmonks.org/index.pl?node_id=253366">http://www.perlmonks.org/index.pl?node_id=253366</a></p>


<h3><a name="acknowledgements,_announcements_and_apologies">Acknowledgements, Announcements and Apologies</a></h3>
<p>That about wraps it up for this week.</p>
<p>If you've appreciated this summary, please consider one or more of the
following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.</li>

<li>
Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>

<li>
Send feedback, flames, money, photographic and writing commissions, or
some proof that people read this bit to <em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em></li>
</ul>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1108" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/04/22/pool.html" rel="bookmark">POOL</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2003-04-22T00:00:00-08:00">April 22, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->
<p>In this article, we're going to look at POOL, a handy &quot;little language&quot;
I recently created for templating object-oriented modules. Now you may
not write many object-oriented modules, so this may not sound too
interesting to you. Don't worry; I also plan to discuss, among other
things, Ruby, how to use the Template Toolkit, profiling, computational
linguistic trie structures, Ruby again, and the oil paintings of the
Great Masters. Hopefully, something in here will be enough to keep your
interest.</p>


<h3><a name="splashing_around">Splashing Around</a></h3>
<p>One of the reasons that I always feel I never get anything substantial
done in Perl is that I'm always distracted unduly by subtasks, 
particularly metaprogramming. I write so many &quot;labor-saving&quot; modules
that I never get around to doing the original labor in the first place.</p>
<p>For instance, I wanted to write something to handle my accounts; I
needed something to handle command-line options but I couldn't be
bothered with the <code>Getopt::Long</code> rigmarole, so I wrote <a href="http://search.cpan.org/~simon/Getopt-Auto-1.00/Auto.pm"><code>Getopt::Auto</code></a>.
Next, I needed to parse a simple configuration file and I couldn't face
writing yet another colon-separated file parser, so I wrote
<a href="http://search.cpan.org/~simon/Config-Auto-0.03/Auto.pm"><code>Config::Auto</code></a>. Finally, I wrote something that examined a database
schema and wrote <code>Class::DBI</code> packages for each table -- all 
helpful tasks, and they meant I would never have to worry about
configuration files or command-line options again. But, of
course, I forgot about my accounts-handling application.</p>
<p>Something like this happened again recently. I started writing a module
I'm calling <code>Devel::DProfPP</code>, which parses the data output by
<code>Devel::DProf</code> in a neat object-oriented way. I was about five minutes
into it when found myself writing:</p>
<pre><code>
    =head1 CONSTRUCTOR

        $object = Devel::DProfPP-&gt;new( %options )

    Creates a new C&lt;Devel::DProfPP&gt; instance.

    =cut

    sub new {
        my ($class, %opts) = @_;
        bless { %opts }, $class;
    }</code></pre>
<p>And then I wrote my test: (I'm a bad boy, I write my tests after I write 
the code)</p>
<pre><code>
    use Test::More;
    use_ok(&quot;Devel::DProfPP&quot;);
    my $x = Devel::DProfPP-&gt;new();
    isa_ok($x, &quot;Devel::DProfPP&quot;);
    ...</code></pre>
<p>Nothing strange about that, you might think. It's something I've written
a dozen of times before, and something I will probably write a
dozen times again. And that's when it hit me. I don't
<strong>want</strong> to spend my time pounding out constructors and accessors,
documentation that's practically identical from class to class, tests
that are eminently predictable, and I never, ever wanted to have to
write <code>my $self = shift;</code> again.</p>
<p>There are two ways to solve this. Now I'm not going to last long as
editor of <code>perl.com</code> if I suggest everyone should do the first, and
switching to Ruby wouldn't help with the documentation and tests part of
the problem anyway.</p>
<p>The second is, of course, to make the computer do the hard work. I
sketched out a short description of what I wanted in my
<code>Devel::DProfPP</code> module, and wrote a little parser to read in that
description, and then had some code generate the module. Then, I made a
critical decision. I had just been doing some work with Template
Toolkit, and wanted some more opportunity to play with it. So instead of
hard-coding what the output module ought to look like, I simply passed
the parsed data structure to a bunch of templates and let them do the
work. This gave me an amazing amount of flexibility in terms of styling
the output, and that's where I think the power of this system, the Perl
Object Oriented Language, (POOL) lies.</p>
<p>In order to investigate that, let's look at some POOL files and
the output they generate, and then we'll examine how the templates work
and fit together.</p>


<h3><a name="diving_in">Diving In</a></h3>
<p>The POOL language is very, very ad hoc. It's bizarre and inconsistent,
but that's because it was created by rationalizing a module description
I scribbled down late one night. But it does the job. It's essentially a
brain dump, and if your brain happens not to work like mine, then you might
not like it; if yours does work like mine, my commiserations.</p>
<p>The POOL distribution, available from CPAN, ships with a handy reference
manual, and that very description; these are the original notes I made
when I was mocking up <code>Devel::DProfPP</code>, and they look like this:</p>
<pre><code>
    Devel::DProfPP - Parse C&lt;Devel::DProf&gt; output
        DESCRIPTION

    This module takes the output file from L&lt;Devel::DProf&gt; (typically
    F&lt;tmon.out&gt;) and parses it into a Perl data structure. Additionally, it
    can be used in an event-driven style to produce reports more
    immediately.

        EOD
        @fh
        -&gt;@enter    || sub {}
        -&gt;@leave    || sub {}
        ro-&gt;@stack  []
        @syms       []
        parse
        top_frame   -&gt;stack-&gt;[0]</code></pre>
<p>The first line should be familiar to anyone who writes or uses Perl modules:
it's the description line that goes at the top of the documentation. It's
enough to identify the class name and provide some documentation about it.</p>
<p>The next thing is the module description, again for the documentation, which
begins with <code>DESCRIPTION</code> and ends with <code>EOD</code>.</p>
<p>When you look at the things starting with <code>@</code>, don't think Perl, think Ruby -
they're not arrays, they're instance variables. Our <code>Devel::DProfPP</code> object
will contain a filehandle to read the profiling data from, a subroutine
reference for what to do when we enter a subroutine and when we leave one,
the current Perl stack, and an array of symbols to hold the subroutine names.</p>
<p>These instance variables come in three types. The first are variables
that the user doesn't set, but come with every new instance. I call
these &quot;set&quot; variables, because they're come set to a particular value.
Then there are &quot;defaulting&quot; instance variables, which the user may
specify but otherwise default to a particular value. And then there are
just ordinary ones, which are not initialized at all. Thankfully for me,
the <code>Devel::DProfPP</code> brain dump contained all three types.</p>
<p>The symbol table and the stack are &quot;set&quot; variables. They come set to the
an empty array reference; we signify this by simply putting an empty
array reference on the same line.</p>
<pre><code>
        @syms       []</code></pre>
<p>The enter subroutine, on the other hand, is a defaulting variable.
(Don't worry about the arrow for now.) If the user doesn't specify an
action to be performed when the profiler says that a subroutine has been
entered, then we want to default to a coderef that does nothing.</p>
<p>In Perl, when we want to default to a value, we say something like:</p>
<pre><code>
    $object-&gt;{enter} = $args{enter} || sub {};</code></pre>
<p>So the POOL encoding of that is:</p>
<pre><code>
        @enter      || sub {}</code></pre>
<p>Finally, there's the filehandle, which the user supplies. Nothing
special has to occur for this instance variable, so we just name it:</p>
<pre><code>
        @fh</code></pre>
<p>From this, we know enough to create a constructor like so:</p>
<pre><code>
    sub new {
        my $class = shift;
        my %args = @_;
        my $self = bless {
            fh =&gt; $args{fh},
            enter =&gt; $args{enter} || sub {},
            leave =&gt; $args{leave} || sub {},
            syms =&gt; [],
            stack =&gt; [],
        }, $class;
        return $self;
    }</code></pre>
<p>And that's precisely what POOL does. After the constructor, comes the
accessors; we want to be able to say <code>$obj-&gt;enter</code> to retrieve the
on-enter action, for instance. This thought led naturally to the syntax</p>
<pre><code>
    -&gt;@enter || sub {}</code></pre>
<p>When POOL sees an arrow attached to an instance variable, it creates an
accessor for it:</p>
<pre><code>
    sub enter {
        my $self = shift;
        if (defined @_) { $self-&gt;{enter} = @_ };

        return $self-&gt;{enter};
    }</code></pre>
<p>The stack accessor is an interesting one. First, we only want this to be
an accessor and not a mutator -- we really don't want people modifying the
profiler's idea of the stack behind its back. This is signified by the
letters <code>ro</code> (read-only) before the accessor arrow.</p>
<pre><code>
    ro-&gt;@stack []</code></pre>
<p>A further twist comes from the fact that POOL is still trying to DWIM
around my brain and my brain expects POOL to be very clever indeed.
Because we have declared <code>stack</code> to be set to an array reference, we
know that the <code>stack</code> accessor deals with arrays. Hence, when 
<code>$obj-&gt;stack</code> is called, it should know to dereference the
reference and return a list. This means the code ends up looking like
this:</p>
<pre><code>
    sub stack {
        my $self = shift;
        return @{$self-&gt;{stack}};
    }</code></pre>
<p>Aside from constructors and accessors, POOL knows about two other
styles of method. (For now; there are more coming.) There are ordinary
methods, which are simply named:</p>
<pre><code>
    parse</code></pre>
<p>Sadly we can't DWIM the entire code for this method, so we generate the
best we can:</p>
<pre><code>
    sub parse {
        my $self = shift;
        #...
    }</code></pre>
<p>And the final style is the delegate. The sad thing about the delegate
given in the <code>DProfPP</code> example is that it doesn't actually work, but we'll
pretend that it does. Delegates are useful when you have an object that
contains another object; you can provide a method in your class that
simply diverts off to the contained object. For instance, if we have a 
class representing a mail message, then we may wish to store the head and body
as separate objects inside our main object. (<code>Mail::Internet</code> does something
like this, containing a <code>Mail::Header</code> object.) Now we can provide a
method called <code>get_header</code>, which simply locates the header object and passes
on its arguments to that:</p>
<pre><code>
    sub get_header {
        my $self = shift;
        $self-&gt;header-&gt;get(@_);
    }</code></pre>
<p>In POOL lingo, this is a delegate <strong>via</strong> the <code>header</code> method, and <code>get</code>
tells us <strong>how</strong> to do the delegation. It would be specified like this:</p>
<pre><code>
    get_header  -&gt;header-&gt;get</code></pre>
<p>Notice that this is precisely what appears in the middle of the Perl code
for this method. An additional feature is that the &quot;how&quot; part of the delegation
is optional. If we were happy for our top-level method to be called <code>get</code>
instead of <code>get_header</code>, then we could say:</p>
<pre><code>
    get         -&gt;header-&gt;</code></pre>
<p>To me, this symbolizes going &quot;through&quot; the <code>header</code> method in order to call
the <code>get</code> method.</p>
<p>These are the basics of the POOL language, and we've seen a little of the
code it generates. It also generates a full set of documentation and
tests, as well as a <code>MANIFEST</code> file and <code>Makefile.PL</code> or <code>Build.PL</code>
file, but we'll look at those a little later.</p>
<p>In case you're interested, the reason why the delegation in the example
doesn't work is because I was being too clever. I thought I could say:</p>
<pre><code>
    top_frame   -&gt;stack-&gt;[0]</code></pre>
<p>and have a <code>top_frame</code> method which &quot;calls&quot; <code>[0]</code> on the stack array
reference, returning its first entry. This doesn't work for two reasons.
First, I was too clever about <code>-&gt;stack</code> and now it returns a list
instead of an array reference. Second, delegates need to pass arguments,
so POOL ends up generating code that looks like:</p>
<pre><code>
    return $self-&gt;stack-&gt;[0](@_);</code></pre>
<p>(The third reason, of course, is that the top of the stack when
represented as an array is element <code>-1</code>, not element <code>0</code>. Oops.)</p>
<p>I thought about fixing this to do what I really, really mean, but decided
that would be too nasty.</p>













<h3><a name="another_example">Another Example</a></h3>
<p>Now that I had this neat tool for generating modules, I set it to work
on the next module I wrote; this was a variant of <a href="http://search.cpan.org/~avif/Tree-Trie-0.4/Trie.pm"><code>Tree::Trie</code></a>, a
class to represent the trie data structure. Tries are a handy way of
representing prefix and suffix relationships between words. They're
conceptually simple; each letter in a word is inserted into a tree
as the child of the previous letter. If we wanted a trie to count the
prefices in the phrase <code>THERE IS A TAVERN IN THE TOWN</code>, then we would first
insert the chain <code>T-H-E-R-E-#</code>, then <code>I-S-#</code>, then <code>A-#</code>, and so on,
where <code>#</code> represents &quot;end-of-word&quot;. We'd end up with a trie looking
like this:</p>

<table border="0" cellpadding="2" cellspacing="2" align="center">
<tr>
<td width="450" align="center">
<img src="/pub/2003/04/22/graphics/tavern-trie.png" width="315" height="378" alt="An example of a trie" />
</td>
</tr>
<tr>
<td align="center" class="secondary"><strong>Figure 1: An Example of a Trie</strong></td>
</tr>
</table>
<p><code>Tree::Trie</code> is good at this sort of thing, but it didn't do a few
extra things I needed, so I wrote an internal-use module called
<code>Kasei::Trie</code>; this was the POOL file I used to generate it:</p>
<pre><code>
    Kasei::Trie - Implement the trie data structure
        DESCRIPTION

    &quot;Trie&quot;s are compact tree-like representations of multiple words, where
    each successive letter is introduced as the child of the previous.

        EOD
        @children {}
        insert

    Kasei::Trie::Node
        @children
        -&gt;@data</code></pre>
<p>The main class, <code>Kasei::Trie</code>, has a constructor with one instance variable
that is initialized to be an empty hash reference, and one method, <code>insert</code>.
There's also a secondary class representing each node in the trie, which has
its own children, and has a <code>data</code> variable with its own accessor.</p>
<p>After generating this with POOL, all I needed to do was to fill in the
code for the <code>insert</code> method, and modify some tests. A manifest,
<code>Makefile.PL</code>, test suite with nine tests, and 161 lines of code and
documentation were automatically created for me. I suspect that POOL
saved me one to two hours.</p>


<h3><a name="the_high_dive">The High Dive</a></h3>
<p>Let's now take a look at the templates that make this all happen. The
main template is called <code>module</code>, and it looks like this:</p>
<pre><code>
    package [% module.package %];
    [% INCLUDE module_header %]
    =head1 SYNOPSIS

    [% INCLUDE synopsis %]
    =head1 DESCRIPTION

    [% module.description  %]

    =head1 METHODS
    [% 
        FOREACH method = module.methods;
        INCLUDE do_method;
        END
    %]

    [% INCLUDE module_footer %]

    1;</code></pre>
<p>As you can probably guess, in the Template Toolkit language, interesting
things happen between <code>[%</code> and <code>%]</code>. Everything else is just output
wholesale, but all kinds of things can happen inside the brackets. The
first thing that happens is that we look at the module's package name.
All the data we've collated from the parsing phase is stuffed into a hash
reference, which we have passed into the template as <code>module</code>. The
dot operator in Template Toolkit is a general do-the-right-thing operator
that can be a method call, a hash reference look-up or an array reference
look-up. In this case, it's a hash reference look-up, and 
we perform the equivalent of <code>$module-&gt;{package}</code> to extract the name.</p>
<p>Template Toolkit's <code>[% INCLUDE template %]</code> directive looks for the file
<em>template</em> in its template path, processes it passing in all the relevant
variables, and includes its output. So after the initial <code>package ...;</code> line,
we include another template that contains everything that goes at the top of
the module. As we'll see later, part of the beauty of templating things this
way is that you can override templates by placing your own idea of what should
go at the top of a module into your private version of <code>module_header</code> earlier
in the template path, in a sense &quot;inheriting&quot; from the base set of templates.</p>
<p>Similarly, we include a file that will output the synopsis, and output the
description that we collected between the <code>DESCRIPTION</code> and <code>EOD</code>
lines of our POOL definition file.</p>
<p>Next, we want to document the various methods and output the code for
them. POOL will have placed all the metadata for the methods we've
defined, plus a constructor, in the appropriate order in the <code>methods</code>
hash entry of <code>module</code>. As this is an array reference, we want to use a
<code>foreach</code>-style loop to look at each method in turn. Not surprisingly,
Template Toolkit's <code>foreach</code>-style loop is called <code>FOREACH</code>.</p>
<p>So this code:</p>
<pre><code>
    [% 
        FOREACH method = module.methods;
        INCLUDE do_method;
        END
    %]</code></pre>
<p>will set a variable called <code>method</code> to each method in the array, and
then call the <code>do_method</code> template. This simply dispatches to
appropriate templates for each type of method. For instance, there's the
set of templates for the &quot;delegate&quot; style; <em>delegate_code</em> looks like
this:</p>
<pre><code>
    sub [% method.name %] {
        my $self = shift;
        return $self-&gt;[% method.via %]-&gt;[% method.how %](@_);
    }</code></pre>
<p>Whereas the documentation template contains some generic commentary:</p>
<pre><code>
    =head2 [% method.name %]

    [% INCLUDE delegate_synopsis -%]
    Delegates to the [%method.how%] method of this object's [%method.via%].

    =cut</code></pre>
<p>The synopsis that appears in the documentation here and in the synopsis
at the top of the file simply explains how the delegation is done:</p>
<pre><code>
    $self-&gt;[% method.name %](...); # $self-&gt;[% method.via %]-&gt;[%method.how%]</code></pre>
<p>Of course, there are some templates that are a little more complex, 
particularly those that generate the tests, but the main thing is that
you can override any or none of those. If you don't like
the standard same-terms-as-Perl-itself licensing block that appears at the
end of the module, then create a file called <em>~/.pool/license</em> containing:</p>
<pre><code>
    =head1 LICENSE

    This module is licensed under the Crowley Public License: do what thou
    wilt shall be the whole of the license.</code></pre>
<p>POOL will pick up this template and use it instead of the standard one.</p>


<h3><a name="there's_no_p_in_our_pool">There's No P in Our POOL</a></h3>
<p>When I started planning this article in the bath this morning, I realized
that POOL is actually fantastically badly named; there's nothing actually
Perl-specific about the language itself, and it's a handy definition language
for any object-oriented system. Hence, I hereby retroactively name the project
&quot;the POOL Object Oriented Language&quot;, which also satisfies the recursive
acronym freaks. But can we, using the same parser and templating system,
turn POOL files into other languages? Of course we can; this is all part
of the flexibility of the Template Toolkit system. What's more, we don't
even have to override <strong>all</strong> of the templates in order to do so, just some
of them. For instance, here's a Ruby equivalent of <em>accessor_code</em>:</p>
<pre><code>
    [% IF method.ro == &quot;ro&quot;; %]
        attr_reader :[% method.name %]
    [% ELSE; %]
        attr_accessor :[% method.name %]
    [% END; %]</code></pre>
<p><em>do_method</em> and <em>module_footer</em>, however, never need to change, since all
they do is include other methods. With a complete set of toolkits, the same
POOL description can be used to output a Perl, Ruby, Python, Java and C++
implementation of a given class.</p>


<h3><a name="going_deeper">Going Deeper</a></h3>
<p>When Frans Hals' famous painting
&quot;The Laughing Cavalier&quot; was being examined in a museum's labs,
someone had the bright idea of putting it through an X-ray machine. When
they did this, they were amazed to find underneath the famous painting a
completely different work -- a painting of a young girl. They then
adjusted the settings on the X-ray machine and tried again, and
underneath the young girl, they found another painting. Since then, it's
been common practice to X-ray pictures, and art historians have found
many layers of paint underneath some of the most-famous pictures.</p>
<p>What's this got to do with POOL? Well, very little, but I wanted to
throw that in. Since I realised that POOL's templates can be inherited
so easily, I've had the idea of POOL &quot;flavors&quot;; coherent sets of
templates that can be layered like oil paintings to impart certain
properties to the output.</p>
<p>For instance, at the moment, POOL outputs unit tests in separate files in
the <em>t/</em> directory, one for each class. Some people, however, prefer
to have their tests in the module right alongside the documentation and
implementation, using the method described in <a href="http://search.cpan.org/author/MSCHWERN/Test-Inline-0.15/lib/Test/Inline.pm"><code>Test::Inline</code></a>. Well,
there's no reason why POOL shouldn't be able to support this. All you'd
need to do is create a new directory, let's say <em>testinline/</em>, and put
a modified version of <em>do_method</em> in there which says something like:</p>
<pre><code>
    [% INCLUDE method_pod %]
    =head2 begin testing
    [% INCLUDE method_test %]
    =cut
    [% INCLUDE method_code %]</code></pre>
<p>Next, arrange for <em>testinline/</em> to appear in the Template Toolkit
template path, and magically your tests will appear in the right place.</p>
<p>It's not inconcievable that multiple &quot;flavours&quot; could combine in order
to theme a module; for instance, you might want a module which uses
<a href="http://search.cpan.org/author/ADIE/Test-Class-0.03/Class.pm"><code>Test::Class</code></a> for its tests, and <a href="http://search.cpan.org/author/KWILLIAMS/Module-Build-0.18/lib/Module/Build.pm"><code>Module::Build</code></a> for its build file,
with a BSD license flavor and <a href="http://search.cpan.org/author/KASEI/Class-Accessor-0.18/lib/Class/Accessor.pm"><code>Class::Accessor</code></a> for its accessors
instead of having them explicitly coded. Conceptually, you'd then say:</p>
<pre><code>
    pool --flavours=testclass,modulebuild,bsdlicense,classaccessor mymodule.pool</code></pre>
<p>and the module would come out just as you want. This hasn't happened
yet for two reasons: First, although it's only a two- or three-line
change to the <em>pool</em> parser to support pushing these directories onto
the template path, I haven't needed it yet so I haven't done it, and
second, because I haven't written any flavors yet. But it's easy
enough to do.</p>
<p>Other future directions for POOL include a syntax for class methods and
class variables, support for other languages as mentioned about, (which
basically means ripping out the hard-coding of <em>MANIFEST</em>,
<em>Makefile.PL</em> and so on and replacing that with a more flexible method)
and other minor modifications. For instance, I'd like some syntax to
specify dependencies; other Perl modules which will then be <code>use</code>'d in
the main modules and which would be named at the appropriate place in the
<em>Makefile.PL</em>. And, of course, there's building up a library of
flavors, including &quot;total conversion&quot; flavors like Ruby and Python.</p>
<p>
The one thing that's becoming really, really important is the need for
nondestructive editing -- the ability to fill in some additional code
for a method, then regenerate the class from a slight change to the POOL
file without losing the new method's code. I'm going to need to add that
soon to allow for iterative redesigning of modules.
</p>
<p>But the main thing about POOL is what it does now -- it saves me time,
and it takes away the drudgery of writing OO classes in Perl.</p>
<p>And I will finish <code>Devel::DProfPP</code> soon. I promise.</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1114" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/04/p6pdigest/20030420.html" rel="bookmark">This week on Perl 6, week ending 2003-04-20</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-04-20T00:00:00-08:00">April 20, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- sidebar begins --><!-- don't move sidebars --><!-- sidebar ends --><p>You know how it is,you go away for a lovely weekend folk festival in Wales,you have a really good,relaxed time,singing yourself hoarse and generally forgetting all about technology before coming home to email from the perl.com editor asking if he could have the summary about half an hour ago,and then you skim through the lists and find nearly 300 messages unread?You do?I thought it was just me.So,having utterly failed (by virtue of being elsewhere) to get a summary written by Monday,I'm currently shooting for 'getting it written'.Welcome to this week's Perl 6 summary; all the fun of the Perl 6 lists with none of the tedious 'reading every message'.</p><p>Let's see if I can't ease myself back into the Perl 6 vibe by summarizing the still rather quiet perl6&#45;internals list first...</p><h4><a name="Building_Parrot_on_Win32">Building Parrot on Win32</a></h4><p>Steve Fink has been busy committing (in the CVS rather than the culpability sense) Mattia Barbon's patches to get Parrot building happily in a Win32 environment.If you have such an environment,now would probably be a good time to grab the latest Parrot from CVS and see if it builds for you.I'm sure the list would be grateful to hear of your experience,good or bad.</p><h4><a name="PMC_documentation">PMC documentation</a></h4><p>After seemingly weeks in the wilderness with very little feedback,Alberto Sim&#245;es finally got some comments on (and thanks for) his latest PMC doc patches from Steve Fink and Brent Dax.The docs haven't made it into the distribution yet though,but it can only be a matter of time.</p><p><a href='http://groups.google.com/groups?threadm=20030414083708.GA1510@alfarrabio.di.uminho.pt'>http://groups.google.com/groups</a></p><h4><a name="Is_PMC_size_fixed?">Is PMC size fixed?</a></h4><p>Mattia Barbon wanted to know if it would eventually become possible to create PMCs with additional data members.Dan says not; PMCs are allocated from arenas which apparently means they need to be the same size (variable sized PMCs would mean adding complexity to the garbage collector,which is already complicated enough thanks very much...)</p><p><a href='http://groups.google.com/groups?threadm=Mahogany&#45;0.64.2&#45;628&#45;20030415&#45;212901.00@rbnet.it'>http://groups.google.com/groups</a></p><h4><a name="Dan_Does_Design_Decisions">Dan Does Design Decisions</a></h4><p>Dan announced a few design decisions:</p><ul><li>It's time to start assigning permanent opcode numbers to some of the opcodes.</li><li>There's some new stack ops,<code>halfpop[insp]</code>.</li><li>We now have <code>can</code> and <code>does</code> ops.</li><li>Dan explained that <code>can</code> and <code>does</code> were there to support fast interface polymorphism.</li></ul><p><a href='http://groups.google.com/groups?threadm=a0521060abac206fe31be@%5B63.120.19.221%5D'>http://groups.google.com/groups</a> -- permanent opcode numbers</p><p><a href='http://groups.google.com/groups?threadm=a05210609bac203bc6e40@%5B63.120.19.221%5D'>http://groups.google.com/groups</a> -- halfpop</p><p><a href='http://groups.google.com/groups?threadm=a0521060bbac22af49f56@%5B63.120.19.221%5D'>http://groups.google.com/groups</a> -- can/does</p><p><a href='http://groups.google.com/groups?threadm=a05210609bac4968b906b@%5B63.120.19.221%5D'>http://groups.google.com/groups</a> -- Interfaces/Classes</p><h4><a name="Short-lived_memory_allocation">Short-lived memory allocation</a></h4><p>Luke Palmer wondered what the Right Way was to allocate dynamic memory that wouldn't be needed beyond a function invocation.The answer,of course,was 'use Parrot memory management and let Garbage Collection work its shiny magic'.Toward the end of the thread Dan let on that Parrots Garbage Collector is 'always going to be walking the system stack' so there was no need to worry about anchoring the newly allocated buffer to the root set for the duration of the function invocation,which seems to be a new commitment.Both Dan and Steve Fink observed that the memory documentation could use updating to clarify best practice for everyone.Volunteers?</p><p><a href='http://groups.google.com/groups?threadm=ygc65pffcoo.fsf@babylonia.flatirons.org'>http://groups.google.com/groups</a></p><h4><a name="How_deep_is_clone?">How deep is <code>clone</code>?</a></h4><p>Alberto Sim&#245;es asked how deeply the <code>clone</code> operator worked.According to Leopold T&#246;tsch it's a deep,recursive clone,which he noted makes for interesting times when dealing with self referencing structures (Dan reckoned that it shouldn't be too bad if you take advantage of the GC system's graph traversal smarts...).Luke Palmer wondered why the default was a deep copy as,he claimed,deep copies were seldom needed.He wondered how to make a shallow copy.Leo suggested extending clone with an extra parameter to specify deep or shallow copying.Dan said that it is the way it is because he said so,and that one would make a shallow copy with assign.</p><p><a href='http://groups.google.com/groups?threadm=20030416112524.GA9757@alfarrabio.di.uminho.pt'>http://groups.google.com/groups</a></p><h4><a name="Shared_memory">Shared memory</a></h4><p>David Robins wondered whether Parrot's memory allocation system would cope with sharing memory between processes and found some messages in the archive that seemed to imply that 'it will cope eventually'.He wondered <i>how</i> it would cope.Warnock's Dilemma applies...</p><p><a href='http://groups.google.com/groups?threadm=Pine.LNX.4.44.0304170912260.19245&#45;100000@davidrobins.net'>http://groups.google.com/groups</a></p><h4><a name="A_New_GC_approach?">A New GC approach?</a></h4><p>Kurt Stephens announced that he had a partially written 'conservative,non&#45;copying &#34;treadmill&#34;' GC system that could work in real time without stopping the world.He wondered if it could be useful for Parrot.No comments so far...</p><p><a href='http://groups.google.com/groups?threadm=3E9F3F20.306@kurtstephens.com'>http://groups.google.com/groups</a></p><p><a href='http://kurtstephens.com/research/index.html'>http://kurtstephens.com/research/index.html</a></p><h4><a name="IMC_and_variable_number_of_arguments">IMC and variable number of arguments</a></h4><p>K Stol wondered how to handle a variable number of function arguments in IMC code.Dan remarked that it was covered by the Parrot calling conventions (presumably IMC code doesn't do the dfull Parrot calling conventions though).Leo T&#246;tsch suggested making sure that the last thing pushed onto the argument stack was the number of arguments,and Will Coleda suggested passing a single PMC like a PerlArray...</p><p><a href='http://groups.google.com/groups?threadm=BAY1&#45;DAV58yhJBbdbuN0000d25d@hotmail.com'>http://groups.google.com/groups</a></p><h3><a name="Meanwhile,_over_in_perl6-language">Meanwhile,over in perl6-language</a></h3><p>If I were asked to summarize this week's traffic on perl6&#45;language with one word,that word would be 'Types'.It turns out that thinking about types,and how they should behave in Perl 6,is hard.I don't envy Damian the writing of the next Exegesis,that's for sure.</p><p>Instead of presenting the threads in roughly chronological order this week I'm going to deal with the none type related threads first and then attempt to sketch the current issues with types without quite so much reference to individual threads.Cover me,I'm going in...</p><h4><a name="Currying_questions">Currying questions</a></h4><p>Last week,Ralph Mellor had asked whether currying assumptions could be overridden when the curried function was called and Luke Palmer had said he didn't think so.This week Damian answered with a rather more authoritative &#34;No,they can't be overridden,just make a call to the original function.&#34;.Ralph had also wondered if there would be a way to specify whether currying assumptions were made by binding or by copying a value (currently,they get bound,just like they do when you call a function normally (I wonder what happens when the function prototype specifies <code>is copy</code>)).Damian said that,if you wanted to make an assumption based on a copy then you needed to explicitly make that copy.</p><p><a href='http://groups.google.com/groups?threadm=3E968850.2000604@self&#45;reference.com'>http://groups.google.com/groups</a> -- Ralph's original questions</p><h4><a name="Are_all_list_constructors_iterators?">Are all list constructors iterators?</a></h4><p>'Marek Ph.' admired the shiny goodness that is lazy evaluation and wondered if <i>all</i> list constructors were actually iterators.He wanted to know if that meant that</p><pre><code>    @a = 1 .. Inf;    splice @a, 5, 2;</code></pre><p>would yield</p><pre><code>    @a == (1 .. 4, 7 .. Inf)</code></pre><p>He also asked if the <code>x</code> operator would generate an iterator too.Luke Palmer thought the answer to both questions was &#34;Yes&#34;.</p><p><a href='http://groups.google.com/groups?threadm=200304140800.04087.philipp.marek@bmlv.gv.at'>http://groups.google.com/groups</a></p><h4><a name="..._but_foo('bar')">...but foo('bar')</a></h4><p>St&#233;phane Payrard spotted a possible ambiguity in Perl 6's grammar.He wanted to know if</p><pre><code>    ... but foo('bar')</code></pre><p>set the property 'foo' to the value 'bar',or did it create a property with the name being the value returned by a function call of <code>foo('bar')</code>.He wondered what the syntax would be to get the 'other' meaning.Luke Palmer thought the first part was that the property 'foo' would get set to 'bar' (so do I,unless the thing implementing the property has some special semantics).He suggested that to force the call to the function to get a property name one would do one of:</p><pre><code>    ... but $(foo('bar'))</code></pre><p>or</p><pre><code>    ... but &#38;foo.('bar')</code></pre><p>I prefer the second of those two.</p><p><a href='http://groups.google.com/groups?threadm=20030414194736.GF2610@stefp.dyndns.org'>http://groups.google.com/groups</a></p><h4><a name="Perl_6_parser_questions">Perl 6 parser questions</a></h4><p>Right at the end of last week,Austin Hastings asked a bunch of questions about the behaviour of the Perl 6 parser.He wondered,for instance,if,in the future,he'd be able to (usefully) say:</p><pre><code>    #!/usr/bin/perl6.1    use Perl6::Grammar v6.0.0.2;</code></pre><p>Larry answered this question (&#34;I don't see why not&#34;) and all of Austin's other questions on this topic.Apparently the Perl 6 Parser will be documented 'whenever Apocalypse 18 comes out'.</p><p><a href='http://groups.google.com/groups?threadm=20030413195322.44208.qmail@web12306.mail.yahoo.com'>http://groups.google.com/groups</a></p><h4><a name="Initializations_outside_of_control_flow">Initializations outside of control flow</a></h4><p>Mark J.Reed asked about elegant ways of initializing shared variables.He wanted something a little neater than the blunderbuss of a <code>BEGIN</code> block.Larry obliged with one of his 'thinking aloud' posts which,while not giving us a final answer does give us a few signposts.It's looking like we'll have traits along the lines of:</p><pre><code>    state $where is begin($value);    state $where is check($value);    state $where is  init($value);    state $where is first($value);</code></pre><p>Where the traits work analogously to <code>BEGIN</code>,<code>CHECK</code>,<code>INIT</code> and <code>FIRST</code>.</p><p><a href='http://groups.google.com/groups?threadm=20030415143435.GD7176@charm.turner.com'>http://groups.google.com/groups</a></p><p><a href='http://groups.google.com/groups?threadm=20030415181942.GA11245@wall.org'>http://groups.google.com/groups</a></p><h4><a name="The_new_returns_keyword">The new <code>returns</code> keyword</a></h4><p>David Storrs was a little worried about the possible clash between the new <code>returns</code> keyword &#45;&#45; introduced in Apocalypse 6 &#45;&#45; and <code>return</code>.Michael Lazzaro pointed out that the 'possible clash' was almost certainly deliberate,after all:</p><pre><code>    sub foo returns Bar {...}</code></pre><p>reads rather well.David had used the example <code>my $spot returns Dog</code>,which does look rather ugly,but Michael pointed out,in the case of a variable declaration,it made more sense to use <code>my $spot of Dog</code> or even <code>my Dog $spot</code>.Michael commented that this choice of syntax meant the programmer was able to pick the most readable phrase for a given situation.</p><p><a href='http://groups.google.com/groups?threadm=CCE85CBE&#45;6F72&#45;11D7&#45;A307&#45;00050245244A@cognitivity.com'>http://groups.google.com/groups</a></p><h4><a name="A17_early_discussion:_Perl_6_threading_proposal">A17 early discussion: Perl 6 threading proposal</a></h4><p>Austin Hastings posted what would once have been called an RFC about Perl 6's threading model.No comments so far.</p><p><a href='http://groups.google.com/groups?threadm=20030415182938.6630.qmail@web12306.mail.yahoo.com'>http://groups.google.com/groups</a></p><h4><a name="wrap_from_Synopsis_6"><code>wrap</code> from Synopsis 6</a></h4><p>David Storrs wondered if the new <code>.wrap</code> method,which returns a unique id identifying the particular 'wrapper' could have an associated warning if the resulting id wasn't stored somewhere.Adam D.Lopresto and Austin Hastings weren't keen...</p><p><a href='http://groups.google.com/groups?threadm=20030416074404.A72173@megazone.bigpanda.com'>http://groups.google.com/groups</a></p><h4><a name="The_difference_between_-_$arg_{...}&gt;_and_sub_($arg)_{...}">The difference between <code>-</code> $arg {...}&gt; and <code>sub ($arg) {...}</code></a></h4><p>David Storrs asked for a 'micro&#45;Exegesis' on the difference between <code>-</code> $foo {...}&#62; and <code>sub ($foo) {...}</code> since they both seemed to generate anonymous subroutines.There were an awful lot of responses to this.Essentially the difference is that a 'pointy block' (my coinage I think) is just a block that has a signature.The main difference is what happens to a <code>return</code>.</p><p>In a block or a pointy block,a <code>return</code> returns from the subroutine that lexically contains that block,not simply from the block itself.If you want to leave a block prematurely without returning from its enclosing subroutine,you would use the <code>leave</code> keyword.</p><p>This distinction between a Block and a Sub allows for some rather neat (Smalltalkish) idioms</p><pre><code>    multi iterate_over_file( String $path: Block &#38;block ) {        my $fh = open File: '&#60;', $path or            fail &#34;Couldn't open $path: $!&#34;;        while &#60;$fh&#62; {            &#38;block($_);        }    }    sub find_user ($user_name) {        iterate_over_file &#34;/etc/passwd&#34; &#45;&#62; $line {            return $line but true if /^$user_name/;        }        return undef;    }</code></pre><p>This is a somewhat contrived example,but I think it's useful as an illustration.If a Block were exactly the same as a sub,then the <code>return</code> in <code>find_user</code> would return to the middle of the <code>while</code> loop in <code>iterate_over_file</code> and <code>iterate_over_file</code> would only return after it had gone through every line in the password file,which would mean that <code>find_user</code> would always return undef.However,a return from inside a block returns from the subroutine <i>containing</i> the block so <code>find_user</code> behaves as expected and we get to write powerful control structures without having to resort to macros.I do wonder if the it would be possible for a function like <code>iterate_over_file</code> to <code>CATCH</code> the block's Return exception though...</p><p><a href='http://groups.google.com/groups?threadm=20030416074937.B72173@megazone.bigpanda.com'>http://groups.google.com/groups</a></p><h4><a name="Compulsorily_named_parameters?">Compulsorily named parameters?</a></h4><p>The debate over declaring non optional named parameters continued as Damian joining in.The current consensus appears to be that the various optional/named/slurpy shorthands introduced in Apocalypse 6 should stay pretty much as they are,but that it should be possible to declare more complex parameter requirements using sensibly named traits.John Siracusa still wants a more 'powerful' shorthand,but there doesn't seem to be anyone taking his side on that.</p><p><a href='http://groups.google.com/groups?threadm=3E99F811.30603@conway.org'>http://groups.google.com/groups</a></p><h4><a name="Multimethod_invocants">Multimethod invocants</a></h4><p>Multimethods still appear to be causing some confusion,mostly to do with how they are called and dispatched,and which method parameters participate in the dispatch.There's a largish contingent (and I probably my count myself a member of that contingent,spot the bias) who would like to be able to write:</p><pre><code>    multi infix:@ (Number $x, Number $y) { new Point: $x, $y }    class point {        ...        multi make_rectangle ( Point $p ) {            new Rectangle: $_, $p;        }        multi make_rectangle ( Number $x, Number $y ) {            .make_rectangle( $x @ $y );        }    }</code></pre><p>Which isn't allowed.Instead you would have to write:</p><pre><code>    multi make_rectangle ( Point $p, Point $q ) {        new Rectangle: $p, $q;    }    multi make_rectangle ( Point $p, Number $x, Number $y ) {        make_rectangle ($p, $x @ $y);    }</code></pre><p>And you also have to be wary of</p><pre><code>    my Point $p;    ...    $p.make_rectangle($x @ $y);</code></pre><p>which would first try to dispatch to Point's <code>make_rectangle</code> 'unimethod',only attempting to dispatch via a multimethod if there is no such method.Personally,I think there's room for a spoonful or two of syntactic sugar to allow for the 'method variant' style of declaration as well as the full on generic multimethod style (which would,of course,underpin the more restricted method variant style).However,if it doesn't exist out of the box I expect someone (me?) will write a set of macros to make things work.</p><p>In the message referenced,Damian explains the current state of the multimethod art...</p><p><a href='http://groups.google.com/groups?threadm=3E99FEA8.2090009@conway.org'>http://groups.google.com/groups</a></p><h3><a name="Types...">Types...</a></h3><p>Well,that's 100 or so messages accounted for.Which leaves another 173 messages remaining all of which concern types.The problem as I see it is that different people seem to understand different things from the word type,and there's a lot of people talking at cross purposes as well as a fair amount of axe grinding going on.</p><p>Now,I could just punt and write something like &#34;Everyone except Leon Brocard talked for ages about types.Here are the links to those threads&#34; which would at least has the virtue of getting the god awful running joke out of the way,but that would smack of cheating.So,what I'm going to do is to only cheat slightly.At the bottom of this section you'll find links to all the threads that discussed types this week.However,before that I'll try give you a (biased) overview of the issues involved and the areas of confusion.</p><h4><a name="An_illustrative_quotation_from_Lewis_Carroll">An illustrative quotation from Lewis Carroll</a></h4><blockquote><p>&#34;The name of the song is called 'Haddocks' Eyes.'&#34; [said the White Knight.]</p><p>&#34;Oh,that's the name of the song,is it?&#34; Alice said,trying to feel interested.</p><p>&#34;No,you don't understand,&#34; the Knight said,looking a little vexed.&#34;That's what the name is called.The name really is 'The Aged,Aged Man.'&#34;</p><p>&#34;Then I ought to have said 'That's what the song is called'?&#34; Alice corrected herself.</p><p>&#34;No you oughtn't: that's another thing.The song is called 'Ways and Means' but that's only what it's <i>called</i>,you know!&#34;</p><p>&#34;Well,what is the song then?&#34; said Alice,who was by this time completely bewildered.</p><p>&#34;I was coming to that,&#34; the Knight said.&#34;The song really is 'A&#45;sitting On a Gate': and the tune's my own invention.&#34;</p><p>-- From Alice Through The Looking Glass,by Lewis Carroll</p></blockquote><h4><a name="Two_types_of_type">Two types of type</a></h4><p>Perl 6 draws an important distinction between 'variable type' and 'value type'.A variable is a binding between a name and a container.The variable type is the type of the container associated with the variable's name.A variable's 'value type' is the expected type of the value stored in the variable's container.As far as I can tell,Perl is weirder than the average programming language in this respect in that it allows the programmer to specify both sorts of type.In C for instance,a value doesn't know its own type,it's just an area of memory that is interpreted according to the type of the variable that it is accessed via (or according to the type it is cast into).Meanwhile,in lisp like languages,'variables' are simply keys in a symbol table,and the values in that symbol table are untyped pointers to values which know their own type.</p><p>Perl 6's symbol tables are rather more like Lisp symbol tables than C's,with the added wrinkle that the symbol table values are rather more sophisticated containers than simple generic pointers.This complexity arises for a couple of reasons:</p><dl><dt><a name="Tied_variables.">Tied variables.</a></dt><dd>Instead of storing a variable's value in one of the core container types (Array,Hash,Scalar),it can be useful to use a custom container type to allow for 'magical' behaviour:<pre><code>    my $FTSE is ShareIndex('FTSE');    print &#34;$FTSE&#34;;    # FTSE 100 Index: 3916.70 (+27.50/+0.7%) at 2003042216:40</code></pre>	</dd><dt><a name="Context">Context</a></dt><dd>Context is really important to Perl.If you look at an array variable in a numeric context,then you get the number of items in the array; in list context,a list of all the items in the array; in a scalar context,a pointer to the array.This context dependent behaviour is best handled by the container object,possibly with the assistance of the contained object,but not always.</dd></dl><p>Scalars turn out to be one of the more remarkable types of Perl containers.At their simplest they can be thought of as a container which can hold at most one 'atomic' thing.Perl 5 scalars have three(?) slots for Number,String and Reference values (On IRC,Dan tells me that Perl 6 scalars will probably have slots for String,Float,Integer,Boolean and Reference values).These different 'scalar value types' can,with certain restrictions be treated without regard to their 'actual' type: A Number in a string context will give a sensible string representation,a string in a number context will give an appropriate numeric value,but not every possible scalar value type can be sensibly viewed as any other type; if you try and use a number in a reference context,you're going to get an error for instance.For added fun,it's perfectly possible for a scalar variable to contain both a Number value and a String value (In Perl 5,<a href='TODO'>Scalar::Util</a> provides a nice interface to this preexisting capability.On IRC,Dan suggests that the Perl 6ish way of doing this will probably be <code>my $i = 4 but &#34;Bibble!&#34;;</code>).</p><h4><a name="What_are_value_type_declarations_for?">What are value type declarations for?</a></h4><p>Some people see value type declarations as being important for programmer safety.They want to see a situation where:</p><pre><code>    my Number $foo = some_function_returning_a_string();</code></pre><p>or</p><pre><code>    sub a_func (Number $param) { ... }    a_func(&#34;A string&#34;);</code></pre><p>will throw exceptions,preferably at compile time.</p><p>Others want to see those same code fragments coerce any values assigned to them into the appropriate types (possibly with a warning) and see value type declarations simply as a way of letting the compiler do automatic optimization of code (if you have declared that a given variable will only contain,say,a number,you can (at least) get rid of a layer of indirection in accessing that value).</p><p>Others don't really care one way or the other about whether or not to coerce,they just want to use value types in setting up multimethods.</p><p>Still others don't really like the idea of declaring types at all,but do see value in ML like type inference for programmer safety reasons...</p><p>Others want to let the programmer choose,and worry about how to implement something which will let that happen.I'm a 'let the programmer choose,and the compiler optimize what it can' kind of guy.</p><h4><a name="Are_types_the_same_as_objects?">Are types the same as objects?</a></h4><p>If types are the same as objects,do they all inherit from a common base class?If they do,what does the hierarchy look like?What about interfaces?Do they need to be explicitly declared or can they be inferred.If they can be inferred,what about the problem of:</p><pre><code>    class Tree {        method feed {...}        method grow {...}        method bark {...}        ...    }    interface Canine {        method feed {...}        method grow {...}        method bark {...}    }    class Borzoi {        method feed {...}        method grow {...}        method bark {...}    }    ...    multi treat($vet, Canine $critter ) {...}        treat($some_vet, Tree.new); # Should this fail?</code></pre><p>Arrghh!!!Make the hurting stop!</p><p>However,I don't care what Dan says,I want every type to have an associated class,and I want them all to inherit from some sort of common base class (at least conceptually,and,if I'm prepared to take the performance hit and jump through the hoops,actually.Sometimes you need to override Scalar's behaviour (or whatever)) but I don't think the inheritance trees that have been bandied about so far even come close to expressing the semantics we need.Expect a longish post to Perl 6 language on this at some point.Probably with (more or less) pseudo code.</p><h4><a name="Another_distinction_to_think_about">Another distinction to think about</a></h4><p>OO theory talks about value objects and reference objects.(I'm using 'object' here to try and get come conceptual distance from 'value type').Here's an abstract example of what I mean</p><pre><code>    my $a = new ValueObject: value =&#62; 10;    my $b = $a;    $b.set_value(20);        print &#34;$a $b&#34;; # 10 20    my $c = new ReferenceObject: value =&#62; 10;    my $d = $c;    $c.set_value(20)    print &#34;$c $d&#34;; # 20 20</code></pre><h4><a name="Just_when_you_thought_you_understood_value_types...">Just when you thought you understood value types...</a></h4><p>Along come compound value types to mess with your head.Assuming a strict interpretation of value type declarations (assigning the the 'wrong' type to a variable throws an error),consider the following:</p><pre><code>    my @a of Int = (1, 2, 3);    my @b = @a;    my @c of Str;</code></pre><p>What happens to each of the following?If it's an error does it happen at runtime or compile time?</p><pre><code>    @c = @a;    @c = @b;    push @a, &#34;String&#34;;    push @b, &#34;String&#34;;</code></pre><p>Are you sure about those?Now,what happens if you start with:</p><pre><code>    my @a of Int = (1 .. Inf);    my @b = @a;    my @c of Str;</code></pre><p>And there's more thorny problems where they came from.</p><h4><a name="Those_thread_links">Those thread links</a></h4><p><a href='http://groups.google.com/groups?threadm=200304140058.h3E0wlpa001034@bruce.csse.monash.edu.au'>http://groups.google.com/groups</a> -- Types of literals</p><p><a href='http://groups.google.com/groups?threadm=20030411204244.GG561@wall.org'>http://groups.google.com/groups</a> -- Do we really need the dual type system</p><p><a href='http://groups.google.com/groups?threadm=200304142143.11432.afaus@corp.vlex.com'>http://groups.google.com/groups</a> -- User defined hierarchical types</p><p><a href='http://groups.google.com/groups?threadm=a05210606bac48f32d796@%5B63.120.19.221%5D'>http://groups.google.com/groups</a> -- Mind the difference between value types and reference types</p><p><a href='http://groups.google.com/groups?threadm=ygcof343oc6.fsf@babylonia.flatirons.org'>http://groups.google.com/groups</a> -- Static typing with Interfaces</p><p><a href='http://groups.google.com/groups?threadm=001D81EE&#45;71D1&#45;11D7&#45;BA15&#45;00050245244A@cognitivity.com'>http://groups.google.com/groups</a> -- Michael Lazzaro's superb summary of how containers and values interact.Not sure it's the whole story though...</p><h3><a name="Acknowledgements,_Announcements_and_Apologies">Acknowledgements,Announcements and Apologies</a></h3><p>Sorry it's late.I blame the perl6&#45;language people.It has nothing whatsoever to do with weekend spent in Wales and a Bank Holiday Monday spent at an Easter egg hunt and barbecue at my aunt's.</p><p>This has been one of the harder Perl 6 summaries to write,mostly because the language list has been dealing with a complicated subject and finding lots of interesting corners and ambiguities.Many thanks to Michael Lazzaro for his careful summation of his understanding of how things work which certainly clarified my thinking,to St&#233;phane Payrard for his sanity check of the types summary and to Dan Sugalski for a few answers on IRC about Scalar behaviour.</p><p>If you've appreciated this summary,please consider one or more of the following options:</p><ul><li>Send money to the Perl Foundation at <a href='http://donate.perl&#45;foundation.org/'>http://donate.perl&#45;foundation.org/</a> and help support the ongoing development of Perl.</li><li>Get involved in the Perl 6 process.The mailing lists are open to all.<a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> and <a href='http://www.parrotcode.org/'>http://www.parrotcode.org/</a> are good starting points with links to the appropriate mailing lists.</li><li>Send feedback,flames,money,photographic and writing commissions,or a full set of Bertrand Harris Bronson's <i>The Traditional Tunes of the Child Ballads</i> to <a href='mailto:p6summarizer@bofh.org.uk'>p6summarizer@bofh.org.uk</a></li></ul>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1106" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/04/17/filters.html" rel="bookmark">Filters in Apache 2.0</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Geoffrey Young</span> on <abbr class="published" title="2003-04-17T00:00:00-08:00">April 17, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>
Not too long ago, despite a relative dearth 
of free tuits, I decided that I had
put off my investigation of mod_perl 2.0 for too 
long - it was time to really start kicking the tires and
tinkering with all the new stuff I had been hearing about.
What I found was that the new mod_perl API is full of 
interesting features, yet discovering and using them was
tedious, frustrating, enlightening, and fun all at 
the same time.  Hopefully,
I can help ease some of the growing pains you are likely
to encounter by experiencing the pain myself first, then
sharing some of the lessons through a series of articles.
Consider this and future articles to be our voyage together into
the rocky but exciting new mod_perl frontier.
</p>

<p>
One of the more interesting and practical features to come out
of the Apache 2.0 redesign effort is output filters.  While
in Apache 2.0 there are all kinds of filters, including
input and connection filters, it's output filters that are
most interesting to me - mostly because 2.0 discussions
make a point of saying
that it's impossible (well, really, really hard) to
filter output content in Apache 1.3, despite the fact that
mod_perl users have been able filter content (to some degree) for
years.  Thus, when I began to play around with mod_perl 2.0 it seemed
only logical that my first task would be to
port the instructional yet useful
<a href="http://search.cpan.org/author/GEOFF/Apache-Clean-0.05/Clean.pm">
<code>Apache::Clean</code></a>, a content filter for mod_perl 1.0, 
over to the new architecture.
</p>

<p>
What we will be examining here is a preliminary
implementation of <code>Apache::Clean</code> using the
mod_perl 2.0 API.  Because mod_perl 2.0 is still being tweaked
daily, if you want to follow along on your own box, then you would
need the current version of mod_perl from CVS, or a recent
<a href="http://cvs.apache.org/snapshots/modperl-2.0/">snapshot</a> -
the latest versions shipped with Linux distributions like
RedHat, or even the latest version on CPAN (1.99_08), are far
too out of date for what we will be doing.  The most current version
of <a href="http://www.apache.org/dist/httpd/">Apache 2.0</a>,
as well as
<a href="http://www.cpan.org/src/README.html">Perl 5.8.0</a>,
will also be helpful.  Keep in mind that many of the more
interesting features in mod_perl 2.0 are not entirely stable
yet, so do not be surprised if things work just a bit differently
six months from now.
</p>

<csperl file="grab" domain="on" record="b/832" template="b/article_sidebar.view">

<h3>What Are Output Filters Anyway?</h3>

<p>
Go ahead, admit it.  At some point, you wrote a CGI script
that generated HTML with embedded Server Side Include tags.
The impetus behind the idea was a simple one: You had hopes that
the embedded SSI tags 
would save you from the extra work of, say, adding a canned
footer to the bottom of your otherwise dynamic page.  Sounds
reasonable, right?  Seeing those SSI tags left unprocessed
in the resulting page must have been shocking.
</p>

<p>
As it turns out, whether you knew it or not, in Apache-speak
you were trying to filter your content, or pass
the output of one process (the CGI script) into another
(Apache's SSI engine) for subsequent processing.  Content
filtering is a simple idea,
and one that feels natural to us as programmers.
After all, Apache is supposed to be modular, and piping
modular components together - <code>cat yachts.txt | wc -l</code> -
is something we do on the Unix command line all the time.  
Wanting the same functionality in our Web server of choice seems
not only logical, but almost required in the interests of 
efficient application programming.
</p>

<p>
While the idea is certainly sound, the above experiment
exposes a limitation of the Apache 1.3 server itself, 
namely that by design you cannot have more than one content
handler for a given request - you can use either mod_cgi to
process and CGI script, or mod_include to parse an
SSI document, but not both.
</p>

<p>
With Apache 2.0, the idea of output filters were introduced,
which provide an official way to intercept and manipulate data
on its way from the content handler to the browser.
In the case of our SSI example, mod_include has been implemented
as an output filter in Apache 2.0, giving it the ability
to post-process either static files (served by the default
Apache content handler) or dynamically generated scripts
(such as those generated by mod_cgi, mod_perl, or mod_php).
True to its goal of exposing the entire Apache API to Perl,
mod_perl allows you to plug into the Apache
filter API and create your own output filters in Perl,
which is what we will be doing with <code>Apache::Clean</code>.
</p>

<h3><code>HTML::Clean</code> and <code>Apache::Clean</code></h3>

<p>
Let's take a moment to look at <code>HTML::Clean</code> before
delving into <code>Apache::Clean</code>, which is basically
just a mod_perl wrapper that takes <code>HTML::Clean</code> and turns
it into an output filter.
<code>HTML::Clean</code> is a nifty little module that 
reduces the size of an HTML page using a number of different
but simple techniques, such as removing unnecessary white space,
replacing longer HTML tags with shorter equivalents, and so on.
The end result is a page that, while still valid HTML and easily
rendered by a browser, is relatively compact.  If reducing bandwidth
is important in your environment, then using <code>HTML::Clean</code>
to tidy up static pages offline is a quick and easy way to save
some bytes.
</p>

<p>
Here is a simple example of <code>HTML::Clean</code> in action.
</p>

<pre>
  <code>
use HTML::Clean ();

use strict;

my $dirty = q!&lt;strong&gt;&amp;quot;helm's alee&amp;quot;&lt;/strong&gt;!;

my $h = HTML::Clean-&gt;new(\$dirty);

$h-&gt;strip({ shortertags =&gt; 1, entities =&gt; 1 });

print ${$h-&gt;data};
  </code>
</pre>


<p>
As you can see, the interface for <code>HTML::Clean</code> is object-oriented
and fairly straightforward.  Things begin by calling the
<code>new()</code> constructor to create an <code>HTML::Clean</code>
object.  <code>new()</code> accepts either a filename to clean
or a reference to a string containing some HTML.  Deciding exactly
which aspects of the HTML to tidy is determined in one of two
ways: either using the <code>level()</code> method to set an 
optimization level, or by passing the <code>strip()</code> method 
any number of options from a rich set.  In either case, <code>strip()</code>
is used to actually clean the HTML.  After that, calling
the <code>data()</code> method returns a reference to a string
containing the HTML, polished to a Perly white.  In our sample
code, the original HTML has been changed to
</p>

<pre>
  <code>
&lt;b&gt;&quot;helm's alee&quot;&lt;/b&gt;
  </code>
</pre>

<p>
which is half the size of our original string yet displayed the same 
way by browsers.
</p>

<p>
Depending on the size of your site, using <code>HTML::Clean</code> 
can lead to a significant reduction in the number of
bytes sent over the wire - for instance,
the front page of the current <a href="http://perl.apache.org/">
<code>mod_perl project homepage</code></a> becomes 70% of it's
original size when scrubbed with <code>$h-&gt;level(9)</code>.
However, while spending the time to tidy static HTML might
make sense, the number of static pages on any given site seems
to be diminishing daily.  What about dynamically generated HTML?
</p>

<p>
One way to handle dynamic HTML would be to add <code>HTML::Clean</code>
routines to each dynamic component of your application, a process
that really is neither scalable nor maintainable.  A better solution would
be to have Apache inject <code>HTML::Clean</code> processing directly
into the server response wherever we wanted it, to create a 
pluggable module that we could configure to post-process requests
to any given URI.  Enter <code>Apache::Clean</code>.
</p>

<p>
<code>Apache::Clean</code> provides a basic interface into
<code>HTML::Clean</code> but it works as an output filter.
As briefly mentioned, <code>Apache::Clean</code> already
exists for mod_perl 1.0, but over in Apache 1.3 land
it was limited
in that it could only post-process responses generated by
mod_perl, and that only after sufficient magic.  We are not
going to get into how that all worked in mod_perl 1.0 - 
for a detailed explanation see 
<a href="http://www.modperlcookbook.org/chapters/15.4.pdf">Recipe 15.4</a>
in the <i><a href="http://www.modperlcookbook.org/">mod_perl 
Developer's Cookbook</a></i> or the
<a href="http://search.cpan.org/author/GEOFF/Apache-Clean-0.05/">
original <code>Apache::Clean</code> manpage</a>.
With Apache 2.0 and the advent of output filters, 
we can now code <code>Apache::Clean</code> as a genuine part
of Apache's request processing, allowing us to 
clean responses on their way to 
the browser entirely independent of who generates
the content.
</p>

<h3>New Directives</h3>

<p>
Here is a look at a possible configuration for Apache 2.0,
one that takes output of a CGI script, post-processes
it for SSI tags, then cleans it with our <code>Apache::Clean</code>
output filter.
</p>

<pre>
  <code>
Alias /cgi-bin /usr/local/apache2/cgi-bin
&lt;Location /cgi-bin&gt;
  SetHandler cgi-script

  SetOutputFilter INCLUDES
  PerlOutputFilterHandler Apache::Clean

  PerlSetVar CleanOption shortertags
  PerlAddVar CleanOption whitespace

  Options +ExecCGI +Includes
&lt;/Location&gt;
  </code>
</pre>

<p>
As with Apache 1.3, mod_cgi is still enabled the same
way - in our case via the <code>SetHandler cgi-script</code>
directive, although this is not the only way and the
familiar <code>ScriptAlias</code> directive is still 
supported.  What is different in this <code>httpd.conf</code> 
snippet is the 
configuration of the SSI engine, mod_include.  As already
mentioned, mod_include was implemented as 
an output filter in Apache 2.0, and output filters
bring with them a new directive.
The <code>SetOutputFilter</code> directive activates
the SSI engine - the <code>INCLUDES</code> filter - within
our container.  This means that requests to
<code>cgi-bin/</code>, no matter who handles
the actual generation of content, will be parsed by 
mod_include.  See the
<a href="http://httpd.apache.org/docs-2.0/mod/mod_include.html">mod_include
documentation</a> for other possible SSI configurations
and options.
</p>

<p>
With the generic Apache bits out of the way, we can move
on to the mod_perl part, which isn't all that complex.
While the <code>PerlSetVar</code> and <code>PerlAddVar</code>
directives are exactly the same as they were in
mod_perl 1.0, mod_perl 2.0 introduces a new directive - 
<code>PerlOutputFilterHandler</code> - which specifies
the Perl output filter for the request.
In our sample <code>httpd.conf</code>,
the <code>Apache::Clean</code> output filter will
be added after mod_include, which inserts SSI
processing after mod_cgi.  The really cool part
about filters is that everything happens without any tricks or
magic - getting all these independent modules to 
work in harmony in creating the server response is 
all perfectly normal, which is a huge improvement
over Apache 1.3.
</p>

<p>
In the interests of safety, one thing that you should
note about our sample configuration is that it does not
include the <code>entities</code> option.  Because we're
cleaning dynamic content, reducing entity tags (such as
changing <code>&amp;quot;</code> to <code>&quot;</code>) 
would inadvertently 
remove any protection against Cross Site Scripting
introduced by the generating script.
For more information about Cross Site Scripting and
how to protect against it, a good overview is provided in
<a href="/pub/a/2002/02/20/css.html">this
<code>perl.com</code> article</a>.
</p>













<h3>Introducing mod_perl 2.0</h3>

<p>
mod_perl actually offers two different APIs for coding 
the Perl output filter.
We are going to be using the simpler, streaming
API, which hides the raw Apache API a bit.  Of course,
if you are feeling bold and want to manipulate the
Apache bucket brigades directly, you are more than welcome,
but it is a more complex process so we are not going to talk
about it here.  Instead, here is our new <code>Apache::Clean</code>
handler, ported to mod_perl 2.0 using the streaming filter API.
</p>

<pre>
  <code>
package Apache::Clean;

use 5.008;

use Apache::Filter ();      # $f
use Apache::RequestRec ();  # $r
use Apache::RequestUtil (); # $r-&gt;dir_config()
use Apache::Log ();         # $log-&gt;info()
use APR::Table ();          # dir_config-&gt;get() and headers_out-&gt;get()

use Apache::Const -compile =&gt; qw(OK DECLINED);

use HTML::Clean ();

use strict;

sub handler {

  my $f   = shift;

  my $r   = $f-&gt;r;

  my $log = $r-&gt;server-&gt;log;

  # we only process HTML documents
  unless ($r-&gt;content_type =~ m!text/html!i) {
    $log-&gt;info('skipping request to ', $r-&gt;uri, ' (not an HTML document)');

    return Apache::DECLINED;
  }

  my $context;

  unless ($f-&gt;ctx) {
    # these are things we only want to do once no matter how
    # many times our filter is invoked per request

    # parse the configuration options
    my $level = $r-&gt;dir_config-&gt;get('CleanLevel') || 1;

    my %options = map { $_ =&gt; 1 } $r-&gt;dir_config-&gt;get('CleanOption');

    # store the configuration
    $context = { level   =&gt; $level,
                 options =&gt; \%options,
                 extra   =&gt; undef };

    # output filters that alter content are responsible for removing
    # the Content-Length header, but we only need to do this once.
    $r-&gt;headers_out-&gt;unset('Content-Length');
  }

  # retrieve the filter context, which was set up on the first invocation
  $context ||= $f-&gt;ctx;

  # now, filter the content
  while ($f-&gt;read(my $buffer, 1024)) {

    # prepend any tags leftover from the last buffer or invocation
    $buffer = $context-&gt;{extra} . $buffer if $context-&gt;{extra};

    # if our buffer ends in a split tag ('&lt;strong' for example)
    # save processing the tag for later
    if (($context-&gt;{extra}) = $buffer =~ m/(&lt;[^&gt;]*)$/) {
      $buffer = substr($buffer, 0, - length($context-&gt;{extra}));
    }

    my $h = HTML::Clean-&gt;new(\$buffer);

    $h-&gt;level($context-&gt;{level});

    $h-&gt;strip($context-&gt;{options});

    $f-&gt;print(${$h-&gt;data});
  }

  if ($f-&gt;seen_eos) {
    # we've seen the end of the data stream

    # print any leftover data
    $f-&gt;print($context-&gt;{extra}) if $context-&gt;{extra};
  }
  else {
    # there's more data to come

    # store the filter context, including any leftover data
    # in the 'extra' key
    $f-&gt;ctx($context);
  }

  return Apache::OK;
}

1;
  </code>
</pre>

<p>
If you can dismiss the mod_perl specific bits for a moment, you
will see the <code>HTML::Clean</code> logic embedded in the middle
of the handler, which is not
very different from the isolated code we used to illustrate
<code>HTML::Clean</code> by itself.  One of the things we need to
do differently, however, is determine which options to pass to the
<code>level()</code> and <code>options()</code> methods of
<code>HTML::Clean</code>.  Here, we use <code>$r-&gt;dir_config()</code>
to gather whatever <code>httpd.conf</code> options we
specified through our <code>PerlSetVar</code> and
<code>PerlAddVar</code> configurations.
</p>

<pre>
  <code>
my $level = $r-&gt;dir_config-&gt;get('CleanLevel') || 1;

my %options = map { $_ =&gt; 1 } $r-&gt;dir_config-&gt;get('CleanOption');
  </code>
</pre>

<p>
This use of <code>dir_config()</code> is in fact no different 
than how we would have coded it in mod_perl 1.0.  Similarly,
later methods like <code>r-&gt;content_type()</code>,
<code>$r-&gt;server-&gt;log-&gt;info()</code>, and
<code>$r-&gt;uri()</code> also behave the same
as they did in mod_perl 1.0, which should offer some
degree of comfort.  For instance, the block
</p>

<pre>
  <code>
unless ($r-&gt;content_type =~ m!text/html!i) {
  $log-&gt;info('skipping request to ', $r-&gt;uri, ' (not an HTML document)');

  return Apache::DECLINED;
}
  </code>
</pre>

<p>
looks almost exactly the same as it would have been
in mod_perl 1.0, save the
use of <code>Apache::DECLINED</code>.  The new
<code>Apache::Const</code> class provides access to
all constants you will need in your handlers, albeit through
a slightly different interface than before - when
using the <code>-compile</code> option, constants are
imported into the <code>Apache::</code> namespace.
If you want the constants in your own namespace, 
mimicking the <code>OK</code> of yore, 
you can just <code>use Apache::Const</code> 
by itself without the without the <code>-compile</code>
option.
</p>

<p>
Some of the other minor differences you will notice are the
addition of a bunch of <code>use</code> statements at
the top of the handler.  Whereas with mod_perl 1.0 just about
every class was magically present when you needed it, with
mod_perl 2.0 you need to be very specific about the classes
you will be using in your handler, and almost nothing is 
available by default.
</p>

<p>
In general, the most important class is <code>Apache::RequestRec</code>,
which provides access to all the elements in the Apache C 
<code>request_rec</code> structure.  Methods originating
from the request object, <code>$r</code>, but not operating
on the actual <code>request_rec</code> slots, such as
<code>$r-&gt;dir_config()</code>, are defined in
<code>Apache::RequestUtil</code>.  This is a nice separation,
and can help you think about mod_perl more in terms of
access to the underlying Apache guts than just a box of 
black magic.
</p>

<p>
If you recall from 1.0, <code>$r-&gt;dir_config()</code> returned
an <code>Apache::Table</code> object, which corresponded to
an Apache table and allowed things like headers to be stored in
a case-insensitive, multi-keyed manner.  In 2.0, Apache tables
are accessed through the APR (Apache Portable Runtime) layer, so
any API that accesses tables needs to <code>use APR::Table</code>.
This includes the <code>get()</code> and <code>set()</code> methods
used on tables like <code>headers_out</code> and <code>dir_config</code>.
</p>

<p>
Besides <code>Apache::RequestRec</code>, <code>Apache::RequestUtil</code>,
and <code>APR::Table</code>, our handler also needs access to the
<code>Apache::Log</code> and <code>Apache::Filter</code> classes.
<code>Apache::Log</code> works no differently than it did under
mod_perl 1.0, while <code>Apache::Filter</code> is entirely new and will be
discussed shortly.
</p>

<p>
From experience, I can tell you that determining which module
you need to <code>use</code> in order to access the functionality
you require is maddening.  In the old days (just weeks before 
this article was written)
developers needed to plow through code examples in the mod_perl
test suite in order to discern which modules they needed. But no
more.  Recently introduced was the <code>ModPerl::MethodLookup</code>
package, which contains the <code>lookup_method()</code> function -
just pass it the name of the method you are looking for
and you will get back a list of modules likely to suit your needs.
See the <a href="http://perl.apache.org/docs/2.0/api/ModPerl/MethodLookup.html">
<code>MethodLookup</code> documentation</a> for more details.
</p>

<p>
With basic housekeeping out of the way, we can focus on the
guts of our output filter and the <code>Apache::Filter</code>
streaming API.  You will notice that the
first argument passed to the <code>handler()</code> subroutine
is an <code>Apache::Filter</code> object, not the
typical <code>$r</code> you might have been expecting. 
mod_perl 2.0 has stepped up it's DWIM factor a bit in
an attempt to make writing filters a bit more intuitive -
in fact, it is possible to write an output filter without
ever needing to access <code>$r</code>, so mod_perl gives
you what you will primarily need.  In order to access
<code>$r</code> we call the (aptly named) <code>r()</code>
method on our <code>$f</code>, then use <code>$r</code>
as the gateway to per-request attributes, such as
the MIME type of the response.  Note that our filter
genuinely declines to process the request if the content
is not HTML.  No fancy footwork, just processing like it
should be.
</p>

<p>
Beyond the typical handler initializations is where things
really start to get unfamiliar, starting with the notion
of filter context, or <code>$f-&gt;ctx()</code>.  Unlike
with mod_perl 1.0, where every handler is called only
once per request, output filters can be (and generally are)
called multiple times per request.  There can be several
reasons for this, but for our purposes it is sufficient
to understand that we need to adjust our normal handler
logic and compensate for some of the subtle behaviors that
can arise by being called several times.  
</p>

<p>
So, the
first thing we do is isolate parts of the request that
only need to happen once per request.  <code>$f-&gt;ctx()</code>,
which stores the filter context, will return <code>undef</code>
on the first request, so we can use it as an indicator of
the initial invocation of our filter.  Since we only
really need to parse our <code>httpd.conf</code> configuration
once, we use the initial invocation to get our 
<code>PerlSetVar</code> options and store them
in a hash for later - because <code>$f-&gt;ctx()</code>
can store a scalar for us, we store our hash as a reference
in <code>$context</code>.  We also set aside space 
in the hash for
the <code>extra</code> element, which will become important
later. 
</p>


<p>
Another thing we need to do only once per request is
to remove the <code>Content-Length</code> header from the
response.  Apache 2.0 has taken great steps to make
sure that all requests are as RFC compliant as possible,
while at the same time trying to make the developer's
life easier.  As it turns out, part of this was the
addition of the Content-Length filter, which calculates
the length of the response and adds the
<code>Content-Length</code> header if Apache
deems it appropriate.  If you are writing a handler 
that alters content to the point where the length
of the response is different (which is probably true
in most cases) you are responsible for removing the 
<code>Content-Length</code> header from the outgoing
headers table.  A simple call to
<code>$r-&gt;headers_out-&gt;unset()</code> is all
we need to accomplish this, which is again the same
as it would have been in mod_perl 1.0.  And don't worry,
if the <code>Content-Length</code> is missing Apache
takes other steps, such as using a chunked 
transfer encoding, to ensure that 
the request is HTTP compliant.
</p>

<p>
That about wraps up all the processing which should only
happen once per request.
If you do not like seeing the informational
<code>"skipping..."</code> message on every non-HTML filter
invocation, feel free to add logic that tests against
<code>$f-&gt;ctx()</code> there as well.
</p>

<p>
Once we have taken care of one-time-only processing,
we can move on to the heart of our output filter.
The actual <code>Apache::Filter</code> streaming API is fairly
straight forward.  For the most part, we simply 
call <code>$f-&gt;read()</code> to read incoming data in
chunks, in our case <code>1K</code> at a time.  Sending the
processed data down the line requires only that we
call <code>$f-&gt;print()</code>.  All in all, the basis
of the streaming API couldn't be any simpler.  Where it begins to
get complex stems from the nature of our particular
filter.
</p>

<p>
The idea behind <code>HTML::Clean</code> is that 
it can, in part, make HTML more compact.  However, 
since HTML is tag based, and those tags often
come in pairs, we need to take special steps to
make sure that our tags remain balanced after 
<code>Apache::Clean</code> has run.  Because we are
reading and processing data in chunks, there is
the possibility that a tag might be stranded between
chunks.  For instance, if the HTML looked like
</p>

<pre>
  <code>
[1019 bytes of stuff] &lt;strong&gt;Bold!&lt;/strong&gt; [more stuff]
  </code>
</pre>

<p>
the first chunk of data that <code>Apache::Clean</code>
would see is
</p>

<pre>
  <code>
[1019 bytes of stuff] &lt;str
  </code>
</pre>

<p>
Because <code>&lt;str</code> is not a valid HTML tag, 
<code>HTML::Clean</code>
leaves it unaltered.  When the next chunk of data
is read from the filter, it comes across as
</p>

<pre>
  <code>
ong&gt;Bold!&lt;/strong&gt; [more stuff]
  </code>
</pre>

<p>
and <code>HTML::Clean</code> again leaves the 
unrecognized <code>ong&gt;</code> unprocessed.  However,
it does catch the closing <code>&lt;/strong&gt;</code>
tag.  The end result, as you can probably see now,
would be
</p>

<pre>
  <code>
[1020 bytes of stuff] &lt;strong&gt;Bold!&lt;/b&gt; [more stuff]
  </code>
</pre>

<p>
which is definitely undesirable.  Our matching regex
and <code>extra</code> manipulations make certain
that any dangling tags are prepended to the front
of the next buffer, safeguarding against this particular
problem.  Of course, this kind of logic is not required
of all filters.  Just remember to keep in mind the
complexity that operating on data in pieces adds
when you implement your own filter.
</p>

<p>
Once we are finished processing all the data from
the current filter invocation we come to a critical junction - 
determining whether we have seen all of the data 
from the actual response.
If our filter will not be called again for
this request, <code>$f-&gt;seen_eos()</code>
will return true, meaning that we have reached the
end of the data stream.  Because we may have leftover
tag fragments stored in <code>$context-&gt;{extra}</code>,
we need to send those along before exiting our 
filter.  On the other hand, 
if there is more data to come, then we would need to
store the current filter context so it can be used
on the next invocation.
</p>

<h3>Voila!</h3>

<p>
So there you have it, output filtering made easy
with mod_perl 2.0.  All in all, it is a bit different
than what you might be used to with mod_perl 1.0, but
it's not that difficult once you get your head around
it.  And it does allow for some pretty amazing things.
For instance, not only can we now use Perl to code
interesting handlers like <code>Apache::Clean</code>,
but the overall filter mechanism makes it possible
to use Perl to manipulate <i>any and all</i> content
originating from the server - just a simple line like
</p>

<pre>
  <code>
PerlOutputFilterHandler My::Cool::Stuff
  </code>
</pre>

<p>
on the server level of your <code>httpd.conf</code>
(such as next to the <code>DocumentRoot</code>
directive) will allow you to post-process <i>every</i>
request.  Cool.
</p>

<p>
Of course, that's not the end
of the story, and what's left over has both positive
and negative sides.  What we've seen here is really
just scratching the surface of filters: There are
still input and connection filters to talk about, as
well as raw access to the Apache filtering API
via bucket brigades.  The downside
is that constructing a filter that handles 
conditional <code>GET</code> requests properly 
isn't really as good as it could be due to 
the (current) incompleteness of the mod_perl 2.0 
filtering API.  However, these
things aside, what we've accomplished here is
already pretty impressive, and I hope it gets
your creativity flowing and you start tinkering
with the very cool new world of mod_perl 2.0.  
</p>

<p>
If you want to try the code from this article, then it is available
<a href="http://www.modperlcookbook.org/~geoff/perl.com/Apache-Clean-2.0.tar.gz">as
a distribution</a> from my Web site.
Other good sources of information are the (growing) 
<a href="http://perl.apache.org/docs/2.0/">mod_perl 2.0 docs</a>, particularly
<a href="http://perl.apache.org/docs/2.0/user/handlers/filters.html">the
section on filtering</a>, which has been (very) recently 
updated with the latest information.
</p>

<h3>Stay Tuned ...</h3>

<p>
How did I know that my code here actually worked and
did what I expected it to?  I wrote a
test suite for <code>Clean.pm</code> using the new
<code>Apache::Test</code> framework and put my 
code against a live Apache server under every situation
I could think of.
<code>Apache::Test</code> is probably the single best
thing to come out of the mod_perl 2.0 redesign effort,
and what I will share with you next time.
</p>

<h3>Thanks</h3>

<p>
Many thanks to Stas Bekman, who reviewed
this article, even though it meant having to deal with
both my questions, suggestions and API gripes.
</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1112" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/04/p6pdigest/20030413.html" rel="bookmark">This week on Perl 6, week ending 2003-04-13</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-04-13T00:00:00-08:00">April 13, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Another week passes, another summary gets written. How does he do it?</p>
<p>We start, as per usual with the still very quiet perl6-internals list.</p>


<h4><a name="hey_sexy_where_you_been">hey sexy where you been?</a></h4>
<p>The internals list's normally impeccable spam filters failed slightly
this week and we actually saw a couple of spam messages sent via the
RT system. The problem is being looked into.</p>


<h4><a name="support_for_true_and_false_properties">Support for true and false properties</a></h4>
<p>St&eacute;phane Payrard posted a 'micropatch' to support the true and
false properties that are Perl 6 needs.</p>


<h4><a name="pmc_elements()_inaccessible_from_the_assembler">PMC <code>elements()</code> inaccessible from the assembler?</a></h4>
<p>St&eacute;phane also wondered about how he should access a PMC's
<code>elements</code> method via Parrot Assembly as there didn't seem to be a an
appropriate operator defined in <em>core.ops</em>. Leo T&ouml;tsch said
that it was known that there were inconsistencies between vtable
definitions and the ops files and that a major cleanup was needed
which would probably happen once it became clean which vtable methods
will remain and how <em>core.ops</em> needed to change.</p>
<p><a href="http://groups.google.com/groups?threadm=20030410122244.GA2448%40stefp.dyndns.org">http://groups.google.com/groups</a></p>


<h4><a name="parrot_on_win32">Parrot on Win32</a></h4>
<p>Clinton A Pierce announced that he'd built a Win32 Parrot distribution
and had put a zip file up for downloading (and hopefully
mirroring). He warned that it was very much a work in progress and the
downloader should beware. But hey! Parrot on Win32! Bravo Clint!</p>
<p>In the same vein, Mattia Barbon posted a couple of patches to improve
Win32 support.</p>
<p><a href="http://groups.google.com/groups?threadm=5.1.0.14.2.20030410110332.01d5b090%40mail.geeksalad.org">http://groups.google.com/groups</a></p>
<p><a href="http://geeksalad.org/tmp/Parrot_Dist_20030410.zip">http://geeksalad.org/tmp/Parrot_Dist_20030410.zip</a> -- Parrot on Win32!</p>
<p><a href="http://groups.google.com/groups?threadm=Mahogany-0.64.2-1004-20030412-182617.00%40rbnet.it">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=Mahogany-0.64.2-1004-20030412-182613.00%40rbnet.it">http://groups.google.com/groups</a></p>


<h4><a name="dan's_blog">Dan's Blog</a></h4>
<p>Dan Sugalski continues to post interesting stuff on his weblog,
including a discussion of the challenges he faces in writing Parrot's
Object spec.</p>
<p><a href="http://www.sidhe.org/~dan/blog/archives/000163.html">http://www.sidhe.org/~dan/blog/archives/000163.html</a></p>




<h3><a name="meanwhile_over_in_perl6language">Meanwhile over in perl6-language</a></h3>
<p>The internals list is still very quiet, seeing all of 28
messages. Meanwhile perl6-language saw over 200 messages. Maybe it had
something to do with Allison and Damian's Synopsis being posted on
perl.com</p>
<p><a href="/pub/a/2003/04/09/synopsis.html">http://www.perl.com/pub/a/2003/04/09/synopsis.html</a></p>


<h4><a name="incorporating_whatif">Incorporating WhatIf</a></h4>
<p>David Storrs had wondered about the CPAN module WhatIf which provides
rollback functionality for arbitrary code. He wanted to know if
support for this rollback capability could be added to the Perl 6
core. Luke Palmer liked the idea, and pointed to Larry's discussion of
<code>let subcall()</code> in one of the appendices to Apocalypse 6. Simon
Cozens thought that 'that way lies madness' and wondered if we weren't
already a long way down that road. The thread got a little bit meta at
this point, discussing what was and wasn't a valid rationale for
adding something to the core rather than just implementing it in a
module. Austin Hastings rule of thumb (which seems to be a good one)
is that something belongs in core if it 'enables a paradigm', citing
rules, continuations, multidispatch, thread support and the new object
system as examples of paradigm enabling stuff that belongs in
core. Dan Sugalski's rule of thumb is 'does it provide extra utility
at marginal cost?' Spot the implementer.</p>
<p>It turns out that Larry's rule of thumb is pretty much the same as
Austin's and he thinks we should add <code>let funcall()</code> to the core
because 'management of hypotheticality is the essence of logic
programming'.</p>
<p><a href="http://groups.google.com/groups?threadm=20030404061120.B92116%40megazone.bigpanda.com">http://groups.google.com/groups</a></p>
<p><a href="http://search.cpan.org/author/SIMONW/Whatif-1.01/">http://search.cpan.org/author/SIMONW/Whatif-1.01/</a> -- The WhatIf
module</p>
<p><a href="http://groups.google.com/groups?threadm=20030407180450.GB30009%40wall.org">http://groups.google.com/groups</a></p>


<h4><a name="==_vs_eq"><code>==</code> vs <code>eq</code></a></h4>
<p>The discussion of the meaning of</p>
<pre><code>
    \@a == \@b</code></pre>
<p>continued. In particular, does it return true if @a and @b are bound to
the same array, or does it return true simply if @a and @b have the
same number of elements. John Williams noted that he was looking
forward to Apocalypse 8, on references which would hopefully clarify a
lot of these issues.</p>


<h4><a name="the_over_overloading_of_is">The Over overloading of is</a></h4>
<p>Piers Cawley pointed out that the three different behaviours of 'is'
that Luke Palmer had worried about the week before were all just
examples of setting traits on containers and provided some code
in an attempt to show what he meant. Luke Palmer wasn't convinced (and
I'm not entirely convinced myself) but thought it was probably best to
reserve judgement until the Objects and Classes Apocalypse has been
done.</p>
<p><a href="http://groups.google.com/groups?threadm=m2k7e6nvae.fsf%40TiBook.bofh.org.uk">http://groups.google.com/groups</a></p>


<h4><a name="properties_and_methods_and_namespaces,_oh_my!">Properties and Methods and Namespaces, oh my!</a></h4>
<p>Piers Cawley tried to put Luke Palmer's worries about clashes between
method and property names to rest, and failed to do so. Luke wanted to
have lexically and dynamically scoped properties, but that gave Dan
Sugalski the screaming abdabs. Luke Palmer came up with anonymous
properties, an idea which I particularly like:</p>
<pre><code>
    my $visited = Property.new;

    sub breadth_first_traversal($root can LinksInterface, &amp;code) {
        my @queue is Queue = $root;
        for @queue {
            next if .$visited;
            $_ = $_ but $visited;
            code($_);
            push @queue: .links;
        }
    }</code></pre>
<p>I don't think any of the design team have commented on this particular
idea but I think it's lovely and I hope it gets rolled into the
language.</p>
<p><a href="http://groups.google.com/groups?threadm=m2el4do9gd.fsf%40TiBook.bofh.org.uk">http://groups.google.com/groups</a></p>


<h4><a name="globs">globs?</a></h4>
<p>Paul showed a lump of Perl 5 code that depended on globs to do bulk
setting of attributes in hash based objects and wanted to know how
one could do the same thing in Perl 6. Responses were along two lines,
the first being that you wouldn't be able to do that sort of thing at
all with Perl 6 objects, and others pointing out that you didn't
really need a glob to get the example given to work. Paul was
enlightened.</p>
<p><a href="http://groups.google.com/groups?threadm=20030408205603.51871.qmail%40web41209.mail.yahoo.com">http://groups.google.com/groups</a></p>


<h4><a name="alphabetblind_pattern_matching">alphabet-blind pattern matching</a></h4>
<p>The discussion of how to match streams of objects as well as simply
strings of characters using the grammar engine continued with a new
subject line. And it continued to make my head hurt. I particularly
liked Larry's observation that in 'treating patterns as too powerful
for just test [...]  we run the risk of making patterns to powerful
for text'. Larry seemed to think that the idea of matching streams of
objects with the grammar engine had merit though, which led to one of
his wonderful 'thinking aloud' posts where he went through the various
possibilities.</p>
<p><a href="http://groups.google.com/groups?threadm=200304090517.h395Hnb15932%40bell.apicom.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20030410004846.GA17607%40wall.org">http://groups.google.com/groups</a> -- Larry thinks out loud 'til his
brain hurts</p>


<h4><a name="synopsis_questions">Synopsis questions</a></h4>
<p>Angel Faus incurred the potential wrath of the summarizer by bundling
up a whole host of questions relating to Synopsis 6 in a single
post. Larry earned my undying gratitude by answering each question in
a separate post with a new subject. Yay Larry.</p>
<p>As it happened the answers provoked very little in the way of
discussion so I don't really need to handle each question separately
in this summary. Larry answered all the questions.</p>
<p><a href="http://groups.google.com/groups?threadm=200304110322.36698.afaus%40corp.vlex.com">http://groups.google.com/groups</a></p>


<h4><a name="variable/value_type_syntax">Variable/value type syntax</a></h4>
<p>Ralph Mellor wasn't keen on the syntax for declaring the types of
values and variables and proposed a new syntax. People weren't keen. I
have the really strong feeling that whoever writes the Perl 6
introductory texts will have an interesting time explaining the
difference between variable and value types. At least Luke Palmer had
a moment of clarity when he realised why using <code>is</code> for tying made
sense...</p>
<p><a href="http://groups.google.com/groups?threadm=3E968475.5010301%40self-reference.com">http://groups.google.com/groups</a></p>


<h4><a name="currying_questions">Currying questions</a></h4>
<p>Ralph also wondered if currying assumptions could be overridden by
passing the relevant argument by name when the curried function is
called. Luke Palmer didn't think it should be allowed. No call from
the core design team yet.</p>
<p><a href="http://groups.google.com/groups?threadm=3E968850.2000604%40self-reference.com">http://groups.google.com/groups</a></p>


<h4><a name="multimethod_invocants">Multimethod Invocants</a></h4>
<p>Paul got confused by multimethods with multiple invocants and asked for
clarification. Luke Palmer clarified things for him. The rule for
multimethods is that multidispatch is only done on the
invocants. Therefore a pair of declarations like:</p>
<pre><code>
    multi foo($me : Int $i)    {...}
    multi foo($me : String $s) {...}</code></pre>
<p>would probably throw a compilation exception or at the very least a
warning because of the collision between invocant types. If you really
wanted to dispatch on the type of the second argument you'd have to
write the method declarations as:</p>
<pre><code>
    multi foo($me, Int $i:)    {...}
    multi foo($me, String $s:) {...}</code></pre>
<p>Larry pointed out that one generally calls multimethods as if they
were subroutines, calling <code>$obj.foo(1)</code> would first try and find a
<em>method</em> called foo, only falling back to multiple dispatch there
were no such method to find. All of this engendered confusion in Michael
Lazzaro (and in me if I'm honest, but now it's been made clear, it
makes sense).</p>
<p><a href="http://groups.google.com/groups?threadm=20030411150717.51145.qmail%40web41206.mail.yahoo.com">http://groups.google.com/groups</a></p>


<h4><a name="change_in_if_syntax">Change in <code>if</code> syntax</a></h4>
<p>Buddha Buck was caught out by the fact that, in Perl 6 you don't need
parentheses 'round the test in an <code>if</code> statement and wondered when
things had changed. Luke Palmer pointed out that they were now
optional, a convenience bought by prohibiting whitespace between a
variable and its subscript (so <code>%foo {bar}</code> does not look up the
value associated with 'bar' in the %foo hash). Brent Dax hoped that
this no whitespace rule was a simple tiebreaker, but Damian dashed
that hope. The whitespace rule means that an opening brace after
whitespace *always* denotes the beginning of a block or an anonymous
hash. Some people don't like this.</p>
<p><a href="http://groups.google.com/groups?threadm=3E96EA21.5040901%4014850.com">http://groups.google.com/groups</a></p>


<h4><a name="named_parameters_are_always_optional">Named parameters are always optional?</a></h4>
<p>John Siracusa wanted a way of creating a subroutine that would only
accept named parameters, some or all of which are required. With Perl
6 as it stands, this appeared to be impossible without adding extra
code to the body of the sub. Luke Palmer thought that what John wanted
was silly, and suggested that if John really wanted the ability he
should just write a module to do it. After a few posts back and forth
on this, Austin Hastings pointed out that this discussion was
analogous to the earlier discussion about WhatIf and what should and
shouldn't be in the core.He argued -- by the 'enables a paradigm' rule
of thumb -- that there was no need for core support for requiring
named arguments because it could be added easily with a module. John
thought that adding this with a module meant that there would be no
way to check parameters successfully at compilation time (actually, I
think you could, with a suitably clever macro...).</p>
<p>By the end of the week John still wanted compulsory named arguments,
but nobody else (who participated in the thread) seemed to be
convinced that they were important enough to be implemented as part of
the language.</p>
<p><a href="http://groups.google.com/groups?threadm=BABCC095.67599%25siracusa%40mindspring.com">http://groups.google.com/groups</a></p>


<h4><a name="aliasing_operations_in_perl_6">Aliasing operations in Perl 6</a></h4>
<p>Mark Jason Dominus asked for some clarification of the binding
operator <code>:=</code> and how it interacted with autodereferencing. Given
code like:</p>
<pre><code>
    my $zero = 0;
    my $zeroref = \$zero;

    my $bound := $zeroref;</code></pre>
<p>He wanted to know whether the value of <code>$bound</code> was 0 or
<code>\$zero</code>. Damian answered that references only autodereferenced
themselves in an array or hash context, so the <code>$bound</code> would be <code>\$zero</code>.</p>
<p><a href="http://groups.google.com/groups?threadm=20030413190201.28216.qmail%40plover.com">http://groups.google.com/groups</a></p>




<h3><a name="acknowledgements,_announcements_and_apologies">Acknowledgements, Announcements and Apologies</a></h3>
<p>Leon Brocard does not make his traditional appearance in this summary
as he is on holiday. Normal service will hopefully be resumed soon.</p>
<p>If you've appreciated this summary, please consider one or more of the
following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.</li>


<li>
Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>


<li>
Send feedback, flames, money, photographic and writing commissions, or
bvfree entry to this years OSCON and tutorials to
<em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em></li>
</ul>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1104" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/04/09/synopsis.html" rel="bookmark">Synopsis 6</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Damian Conway</span> on <abbr class="published" title="2003-04-09T00:00:00-08:00">April  9, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S06.html">Synopsis 6</a> for the current design information.</p>

<p>This document summarizes Apocalypse 6, which covers subroutines and the
new type system.</p>

<h3><a name="subroutines_and_other_code_objects">Subroutines and Other Code Objects</a></h3>
<p><strong>Subroutines</strong> (keyword: <code>sub</code>) are noninheritable routines with
parameter lists.</p>
<p><strong>Methods</strong> (keyword: <code>method</code>) are inheritable routines that always
have an associated object (known as their invocant) and belong to a
particular class.</p>
<p><strong>Submethods</strong> (keyword: <code>submethod</code>) are noninheritable methods, or
subroutines masquerading as methods. They have an invocant and belong to
a particular class.</p>
<p><strong>Multimethods</strong> (keyword: <code>multi</code>) are routines that do not belong to a
particular class, but which have one or more invocants.</p>
<p><strong>Rules</strong> (keyword: <code>rule</code>) are methods (of a grammar) that perform
pattern matching. Their associated block has a special syntax (see
Synopsis 5).</p>
<p><strong>Macros</strong> (keyword: <code>macro</code>) are routines whose calls execute as soon
as they are parsed (i.e. at compile-time). Macros may return another
source code string or a parse-tree.</p>


<h4><a name="standard_subroutines">Standard Subroutines</a></h4>
<p>The general syntax for named subroutines is any of:</p>
<pre><code>
     my RETTYPE sub NAME ( PARAMS ) TRAITS {...}
    our RETTYPE sub NAME ( PARAMS ) TRAITS {...}
                sub NAME ( PARAMS ) TRAITS {...}</code></pre>
<p>The general syntax for anonymous subroutines is:</p>
<pre><code>
    sub ( PARAMS ) TRAITS {...}</code></pre>
<p>"Trait" is the new name for a compile-time (<code>is</code>) property.
See <a href="#traits_and_properties">Traits and Properties</a></p>


<h4><a name="perl5ish_subroutine_declarations">Perl5ish Subroutine Declarations</a></h4>
<p>You can still declare a sub without parameter list, as in Perl 5:</p>
<pre><code>
    sub foo {...}</code></pre>
<p>Arguments still come in via the <code>@_</code> array, but they are <strong>constant</strong>
aliases to actual arguments:</p>
<pre><code>
    sub say { print qq{&quot;@_&quot;\n}; }   # args appear in @_</code></pre>
<pre><code>
    sub cap { $_ = uc $_ for @_ }   # Error: elements of @_ are constant</code></pre>
<p>If you need to modify the elements of <code>@_</code>, then declare it with the <a href="#item_is_rw"><code>is rw</code></a>
trait:</p>
<pre><code>
    sub swap (*@_ is rw) { @_[0,1] = @_[1,0] }</code></pre>


<h4><a name="blocks">Blocks</a></h4>
<p>Raw blocks are also executable code structures in Perl 6.</p>
<p>Every block defines a subroutine, which may either be executed
immediately or passed in as a <code>Code</code> reference argument to some other
subroutine.</p>


<h4><a name="pointy_subs">"Pointy subs"</a></h4>
<p>The arrow operator <code>-&gt;</code> is almost a synonym for the anonymous
<code>sub</code> keyword. The parameter list of a pointy sub does not require
parentheses and a pointy sub may not be given traits.</p>
<pre><code>
    $sq = -&gt; $val { $val**2 };  # Same as: $sq = sub ($val) { $val**2 };</code></pre>
<pre><code>
    for @list -&gt; $elem {        # Same as: for @list, sub ($elem) {
        print &quot;$elem\n&quot;;        #              print &quot;$elem\n&quot;;
    }                           #          }</code></pre>


<h4><a name="stub_declarations">Stub Declarations</a></h4>
<p>To predeclare a subroutine without actually defining it, use a "stub block":</p>
<pre><code>
    sub foo {...};     # Yes, those three dots are part of the actual syntax</code></pre>
<p>The old Perl 5 form:</p>
<pre><code>
    sub foo;</code></pre>
<p>is a compile-time error in Perl 6 (for reasons explained in Apocalypse 6).</p>


<h4><a name="globally_scoped_subroutines">Globally Scoped Subroutines</a></h4>
<p>Subroutines and variables can be declared in the global namespace, and are
thereafter visible everywhere in a program.</p>
<p>Global subroutines and variables are normally referred to by prefixing
their identifier with <code>*</code>, but it may be omitted if the reference is
unambiguous:</p>
<pre><code>
    $*next_id = 0;
    sub *saith($text)  { print &quot;Yea verily, $text&quot; }</code></pre>
<pre><code>
    module A {
        my $next_id = 2;    # hides any global or package $next_id
        saith($next_id);    # print the lexical $next_id;
        saith($*next_id);   # print the global $next_id;
    }</code></pre>
<pre><code>
    module B {
        saith($next_id);    # Unambiguously the global $next_id
    }</code></pre>


<h4><a name="lvalue_subroutines">Lvalue Subroutines</a></h4>
<p>Lvalue subroutines return a "proxy" object that can be assigned to.
It's known as a proxy because the object usually represents the
purpose or outcome of the subroutine call.</p>
<p>Subroutines are specified as being lvalue using the <a href="#item_is_rw"><code>is rw</code></a> trait.</p>
<p>An lvalue subroutine may return a variable:</p>
<pre><code>
    my $lastval;
    sub lastval () is rw { return $lastval }
 
or the result of some nested call to an lvalue subroutine:</code></pre>
<pre><code>
    sub prevval () is rw { return lastval() }</code></pre>
<p>or a specially tied proxy object, with suitably programmed
<code>FETCH</code> and <code>STORE</code> methods:</p>
<pre><code>
    sub checklastval ($passwd) is rw {
        my $proxy is Proxy(
                FETCH =&gt; sub ($self) {
                            return lastval();
                         },
                STORE =&gt; sub ($self, $val) {
                            die unless check($passwd);
                            lastval() = $val;
                         },
        );
        return $proxy;
    }</code></pre>


<h4><a name="operator_overloading">Operator Overloading</a></h4>
<p>Operators are just subroutines with special names.</p>
<p>Unary operators are defined as prefix or postfix:</p>
<pre><code>
    sub prefix:OPNAME  ($operand) {...}
    sub postfix:OPNAME ($operand) {...}</code></pre>
<p>Binary operators are defined as infix:</p>
<pre><code>
    sub infix:OPNAME ($leftop, $rightop) {...}</code></pre>
<p>Bracketing operators are defined as circumfix. The leading and trailing
delimiters together are the name of the operator.</p>
<pre><code>
    sub circumfix:LEFTDELIM...RIGHTDELIM ($contents) {...}
    sub circumfix:DELIMITERS ($contents) {...}</code></pre>
<p>If the left and right delimiters aren't separated by "<code>...</code>",
then the <code>DELIMITERS</code> string must have an even number of characters. The first
half is treated as the opening delimiter and the second half as
the closing.</p>
<p>Operator names can be any sequence of Unicode characters. For example:</p>
<pre><code>
    sub infix:(c)        ($text, $owner) { return $text but Copyright($owner) }
    method prefix:&plusmn; (Num $x) returns Num { return +$x | -$x }
    multi postfix:!             (Int $n) { $n&lt;2 ?? 1 :: $n*($n-1)! }
    macro circumfix:&lt;!--...--&gt;   ($text) { &quot;&quot; }</code></pre>
<pre><code>
    my $document = $text (c) $me;</code></pre>
<pre><code>
    my $tolerance = &plusmn;7!;</code></pre>
<pre><code>
    &lt;!-- This is now a comment --&gt;</code></pre>




<h3><a name="parameters_and_arguments">Parameters and Arguments</a></h3>
<p>Perl 6 subroutines may be declared with parameter lists.</p>
<p>By default, all parameters are constant aliases to their corresponding
arguments -- the parameter is just another name for the original
argument, but the argument can't be modified through it. To allow
modification, use the <a href="#item_is_rw"><code>is rw</code></a> trait. To pass-by-copy, use the <a href="#item_is_copy"><code>is
copy</code></a> trait.</p>
<p>Parameters may be required or optional. They may be passed by position,
or by name. Individual parameters may confer a scalar or list context
on their corresponding arguments.</p>
<p>Arguments destined for required parameters must come before those bound
to optional parameters. Arguments destined for positional parameters
must come before those bound to named parameters.</p>


<h4><a name="invocant_parameters">Invocant Parameters</a></h4>
<p>A method invocant is specified as the first parameter in the parameter
list, with a colon (rather than a comma) immediately after it:</p>
<pre><code>
    method get_name ($self:) {...}
    method set_name ($me: $newname) {...}</code></pre>
<p>The corresponding argument (the invocant) is evaluated in scalar context
and is passed as the left operand of the method call operator:</p>
<pre><code>
    print $obj.get_name();
    $obj.set_name(&quot;Sam&quot;);</code></pre>
<p>Multimethod invocants are specified at the start of the parameter
list, with a colon terminating the list of invocants:</p>
<pre><code>
    multi handle_event ($window, $event: $mode) {...}    # two invocants</code></pre>
<p>Multimethod invocant arguments are passed positionally, though the first
invocant can be passed via the method call syntax:</p>
<pre><code>
    # Multimethod calls...
    handle_event($w, $e, $m);
    $w.handle_event($e, $m);</code></pre>
<p>Invocants may also be passed using the indirect object syntax, with a colon
after them. The colon is just a special form of the comma, and has the
same precedence:</p>
<pre><code>
    # Indirect method call...
    set_name $obj: &quot;Sam&quot;;</code></pre>
<pre><code>
    # Indirect multimethod call...
    handle_event $w, $e: $m;</code></pre>
<p>Passing too many or too few invocants is a fatal error.</p>
<p>The first invocant is always the topic of the corresponding method
or multimethod.</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S06.html">Synopsis 6</a> for the current design information.</p>

<h4><a name="required_parameters">Required Parameters</a></h4>
<p>Required parameters are specified at the start of a subroutine's parameter
list:</p>
<pre><code>
    sub numcmp ($x, $y) { return $x &lt;=&gt; $y }</code></pre>
<p>The corresponding arguments are evaluated in scalar context and may be
passed positionally or by name. To pass an argument by name,
specify it as a pair: <code>parameter_name =&gt; argument_value</code>.</p>
<pre><code>
    $comparison = numcmp(2,7);
    $comparison = numcmp(x=&gt;2, y=&gt;7);
    $comparison = numcmp(y=&gt;7, x=&gt;2);</code></pre>
<p>Passing the wrong number of required arguments is a fatal error.</p>
<p>The number of required parameters a subroutine has can be determined by
calling its <code>.arity</code> method:</p>
<pre><code>
    $args_required = &amp;foo.arity;</code></pre>


<h4><a name="optional_parameters">Optional Parameters</a></h4>
<p>Optional positional parameters are specified after all the required
parameters and each is marked with a <code>?</code> before the parameter:</p>
<pre><code>
    sub my_substr ($str, ?$from, ?$len) {...}</code></pre>
<p>The <code>=</code> sign introduces a default value:</p>
<pre><code>
    sub my_substr ($str, ?$from = 0, ?$len = Inf) {...}</code></pre>
<p>Default values can be calculated at run-time. They can even use the values of
preceding parameters:</p>
<pre><code>
    sub xml_tag ($tag, ?$endtag = matching_tag($tag) ) {...}</code></pre>
<p>Arguments that correspond to optional parameters are evaluated in
scalar context. They can be omitted, passed positionally, or passed by
name:</p>
<pre><code>
    my_substr(&quot;foobar&quot;);            # $from is 0, $len is infinite
    my_substr(&quot;foobar&quot;,1);          # $from is 1, $len is infinite
    my_substr(&quot;foobar&quot;,1,3);        # $from is 1, $len is 3
    my_substr(&quot;foobar&quot;,len=&gt;3);     # $from is 0, $len is 3</code></pre>
<p>Missing optional arguments default to their default value, or to <code>undef</code>
if they have no default.</p>


<h4><a name="named_parameters">Named Parameters</a></h4>
<p>Named parameters follow any required or optional parameters in the
signature. They are marked by a <code>+</code> before the parameter.</p>
<pre><code>
    sub formalize($text, +$case, +$justify) {...}</code></pre>
<p>Arguments that correspond to named parameters are evaluated in scalar
context. They can only be passed by name, so it doesn't matter what
order you pass them in, so long as they follow any positional arguments:</p>
<pre><code>
    $formal = formalize($title, case=&gt;'upper');
    $formal = formalize($title, justify=&gt;'left');
    $formal = formalize($title, justify=&gt;'right', case=&gt;'title');</code></pre>
<p>Named parameters are always optional. Default values for named
parameters are defined in the same way as for optional parameters. Named
parameters default to <code>undef</code> if they have no default.</p>


<h4><a name="list_parameters">List Parameters</a></h4>
<p>List parameters capture a variable length list of data. They're used
in subroutines like <code>print</code>, where the number of arguments needs to be
flexible. They're also called "variadic parameters," because they take a
<em>variable</em> number of arguments.</p>
<p>Variadic parameters follow any required or optional parameters. They are
marked by a <code>*</code> before the parameter:</p>
<pre><code>
    sub duplicate($n, *@data, *%flag) {...}</code></pre>
<p>Named variadic arguments are bound to the variadic hash (<code>*%flag</code>
in the above example). Such arguments are evaluated in scalar context.
Any remaining variadic arguments at the end of the argument list
are bound to the variadic array (<code>*@data</code> above) and are evaluated
in list context.</p>
<p>For example:</p>
<pre><code>
    duplicate(3, reverse=&gt;1, collate=&gt;0, 2, 3, 5, 7, 11, 14);</code></pre>
<pre><code>
    # The @data parameter receives [2, 3, 5, 7, 11, 14]
    # The %flag parameter receives { reverse=&gt;1, collate=&gt;0 }</code></pre>
<p>Variadic scalar parameters capture what would otherwise be the first
elements of the variadic array:</p>
<pre><code>
    sub head(*$head, *@tail)         { return $head }
    sub neck(*$head, *$neck, *@tail) { return $neck }
    sub tail(*$head, *@tail)         { return @tail }</code></pre>
<pre><code>
    head(1, 2, 3, 4, 5);        # $head parameter receives 1
                                # @tail parameter receives [2, 3, 4, 5]</code></pre>
<pre><code>
    neck(1, 2, 3, 4, 5);        # $head parameter receives 1
                                # $neck parameter receives 2
                                # @tail parameter receives [3, 4, 5]</code></pre>
<p>Variadic scalars still impose list context on their arguments.</p>
<p>Variadic parameters are treated lazily -- the list is only flattened
into an array when individual elements are actually accessed:</p>
<pre><code>
        @fromtwo = tail(1..Inf);        # @fromtwo contains a lazy [2..Inf]</code></pre>


<h4><a name="flattening_argument_lists">Flattening Argument Lists</a></h4>
<p>The unary prefix operator <code>*</code> flattens its operand (which allows the
elements of an array to be used as an argument list). The <code>*</code> operator
also causes its operand -- and any subsequent arguments in the argument
list -- to be evaluated in list context.</p>
<pre><code>
    sub foo($x, $y, $z) {...}    # expects three scalars
    @onetothree = 1..3;          # array stores three scalars</code></pre>
<pre><code>
    foo(1,2,3);                  # okay:  three args found
    foo(@onetothree);            # error: only one arg
    foo(*@onetothree);           # okay:  @onetothree flattened to three args</code></pre>
<p>The <code>*</code> operator flattens lazily -- the array is only flattened if
flattening is actually required within the subroutine. To flatten before
the list is even passed into the subroutine, use the unary prefix <code>**</code>
operator:</p>
<pre><code>
    foo(**@onetothree);          # array flattened before &amp;foo called</code></pre>


<h4><a name="pipe_operators">Pipe Operators</a></h4>
<p>The variadic array of a subroutine call can be passed in separately
from the normal argument list, by using either of the "pipe" operators:
<code>&lt;==</code> or <code>==&gt;</code>.</p>
<p>Each operator expects to find a call to a variadic subroutine on its
"sharp" end, and a list of values on its "blunt" end:</p>
<pre><code>
    grep { $_ % 2 } &lt;== @data;</code></pre>
<pre><code>
    @data ==&gt; grep { $_ % 2 };</code></pre>
<p>First, it flattens the list of values on the blunt side. Then, it binds
that flattened list to the variadic <code>parameter(s)</code> of the subroutine on
the sharp side. So both of the calls above are equivalent to:</p>
<pre><code>
    grep { $_ % 2 } *@data;</code></pre>
<p>Leftward pipes are a convenient way of explicitly indicating the typical
right-to-left flow of data through a chain of operations:</p>
<pre><code>
    @oddsquares = map { $_**2 } sort grep { $_ % 2 } @nums;</code></pre>
<pre><code>
    # more clearly written as...</code></pre>
<pre><code>
    @oddsquares = map { $_**2 } &lt;== sort &lt;== grep { $_ % 2 } &lt;== @nums;</code></pre>
<p>Rightward pipes are a convenient way of reversing the normal data flow in a
chain of operations, to make it read left-to-right:</p>
<pre><code>
    @oddsquares =
            @nums ==&gt; grep { $_ % 2 } ==&gt; sort ==&gt; map { $_**2 };</code></pre>
<p>If the operand on the sharp end of a pipe is not a call to a variadic
operation, then it must be a variable, in which case the list operand is
assigned to the variable. This special case allows for "pure" processing
chains:</p>
<pre><code>
    @oddsquares &lt;== map { $_**2 } &lt;== sort &lt;== grep { $_ % 2 } &lt;== @nums;</code></pre>
<pre><code>
    @nums ==&gt; grep { $_ % 2 } ==&gt; sort ==&gt; map { $_**2 } ==&gt; @oddsquares;</code></pre>


<h4><a name="closure_parameters">Closure Parameters</a></h4>
<p>Parameters declared with the <code>&amp;</code> sigil take blocks, closures, or
subroutines as their arguments. Closure parameters can be required,
optional, or named.</p>
<pre><code>
    sub limited_grep (Int $count, &amp;block, *@list) {...}</code></pre>
<pre><code>
    # and later...</code></pre>
<pre><code>
    @first_three = limited_grep 3 {$_&lt;10} @data;</code></pre>
<p>Within the subroutine, the closure parameter can be used like any other
lexically scoped subroutine:</p>
<pre><code>
    sub limited_grep (Int $count, &amp;block, *@list) {
        ...
        if block($nextelem) {...}
        ...
    }</code></pre>
<p>The closure parameter can have its own signature (from which the
parameter names may be omitted):</p>
<pre><code>
    sub limited_Dog_grep ($count, &amp;block(Dog), Dog *@list) {...}</code></pre>
<p>and even a return type:</p>
<pre><code>
    sub limited_Dog_grep ($count, &amp;block(Dog) returns Bool, Dog *@list) {...}</code></pre>
<p>When an argument is passed to a closure parameter that has this kind of
signature, the argument must be a <code>Code</code> object with a compatible
parameter list and return type.</p>


<h4><a name="unpacking_array_parameters">Unpacking Array Parameters</a></h4>
<p>Instead of specifying an array parameter as an array:</p>
<pre><code>
    sub quicksort (@data, ?$reverse, ?$inplace) {
        my $pivot := shift @data;
        ...
    }</code></pre>
<p>it may be broken up into components in the signature, by
specifying the parameter as if it were an anonymous array of
parameters:</p>
<pre><code>
    sub quicksort ([$pivot, *@data], ?$reverse, ?$inplace) {
        ...
    }</code></pre>
<p>This subroutine still expects an array as its first argument, just like
the first version.</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S06.html">Synopsis 6</a> for the current design information.</p>

<h4><a name="attributive_parameters">Attributive parameters</a></h4>
<p>If a method's parameter is declared with a <code>.</code> after the sigil (like an
attribute):</p>
<pre><code>
    method initialize($.name, $.age) {}</code></pre>
<p>then the argument is assigned directly to the object's attribute of the
same name. This avoids the frequent need to write code like:</p>
<pre><code>
    method initialize($name, $age) {
        $.name = $name;
        $.age  = $age;
    }</code></pre>


<h4><a name="placeholder_variables">Placeholder Variables</a></h4>
<p>Even though every bare block is a closure, bare blocks can't have
explicit parameter lists. Instead, they use "placeholder" variables,
marked by a caret (<code>^</code>) after their sigils.</p>
<p>Using placeholders in a block defines an implicit parameter list. The
signature is the list of distinct placeholder names, sorted in Unicode order.
So:</p>
<pre><code>
    { $^y &lt; $^z &amp;&amp; $^x != 2 }</code></pre>
<p>is a shorthand for:</p>
<pre><code>
    sub ($x,$y,$z) { $y &lt; $z &amp;&amp; $x != 2 }</code></pre>




<h3><a name="types">Types</a></h3>
<p>These are the standard type names in Perl 6 (at least this week):</p>
<pre><code>
    bit         single native bit
    int         native integer
    str         native string
    num         native floating point
    ref         native pointer 
    bool        native boolean
    Bit         Perl single bit (allows traits, aliasing, etc.)
    Int         Perl integer (allows traits, aliasing, etc.)
    Str         Perl string
    Num         Perl number
    Ref         Perl reference
    Bool        Perl boolean
    Array       Perl array
    Hash        Perl hash
    IO          Perl filehandle
    Code        Base class for all executable objects
    Routine     Base class for all nameable executable objects
    Sub         Perl subroutine
    Method      Perl method
    Submethod   Perl subroutine acting like a method
    Macro       Perl compile-time subroutine
    Rule        Perl pattern
    Block       Base class for all unnameable executable objects
    Bare        Basic Perl block
    Parametric  Basic Perl block with placeholder parameters
    Package     Perl 5 compatible namespace
    Module      Perl 6 standard namespace
    Class       Perl 6 standard class namespace
    Object      Perl 6 object
    Grammar     Perl 6 pattern matching namespace
    List        Perl list
    Lazy        Lazily evaluated Perl list
    Eager       Non-lazily evaluated Perl list</code></pre>


<h4><a name="value_types">Value Types</a></h4>
<p>Explicit types are optional. Perl variables have two associated types:
their "value type" and their "variable type".</p>
<p>The value type specifies what kinds of values may be stored in the
variable. A value type is given as a prefix or with the <code>returns</code> or
<code>of</code> keywords:</p>
<pre><code>
    my Dog $spot;
    my $spot returns $dog;
    my $spot of Dog;</code></pre>
<pre><code>
    our Animal sub get_pet() {...}
    sub get_pet() returns Animal {...}
    sub get_pet() of Animal {...}</code></pre>
<p>A value type on an array or hash specifies the type stored by each element:</p>
<pre><code>
    my Dog @pound;  # each element of the array stores a Dog</code></pre>
<pre><code>
    my Rat %ship;   # the value of each entry stores a Rat</code></pre>


<h4><a name="variable_types">Variable Types</a></h4>
<p>The variable type specifies how the variable itself is implemented. It is
given as a trait of the variable:</p>
<pre><code>
    my $spot is Scalar;             # this is the default
    my $spot is PersistentScalar;
    my $spot is DataBase;</code></pre>
<p>Defining a variable type is the Perl 6 equivalent to tying a variable in
Perl 5.</p>


<h4><a name="hierarchical_types">Hierarchical Types</a></h4>
<p>A nonscalar type may be qualified, in order to specify what type of
value each of its elements stores:</p>
<pre><code>
    my Egg $cup;                       # the value is an Egg
    my Egg @carton;                    # each elem is an Egg
    my Array of Egg @box;              # each elem is an array of Eggs
    my Array of Array of Egg @crate;   # each elem is an array of arrays of Eggs
    my Hash of Array of Recipe %book;  # each value is a hash of arrays of Recipes</code></pre>
<p>Each successive <code>of</code> makes the type on its right a parameter of the
type on its left. So:</p>
<pre><code>
    my Hash of Array of Recipe %book;</code></pre>
<p>means:</p>
<pre><code>
    my Hash(returns=&gt;Array(returns=&gt;Recipe)) %book;</code></pre>
<p>Because the actual variable can be hard to find when complex types are
specified, there is a postfix form as well:</p>
<pre><code>
    my Hash of Array of Recipe %book;           # HoHoAoRecipe
    my %book of Hash of Array of Recipe;        # same thing
    my %book returns Hash of Array of Recipe;   # same thing</code></pre>
<p>The <code>returns</code> form is more commonly seen in subroutines:</p>
<pre><code>
    my Hash of Array of Recipe sub get_book () {...}
    my sub get_book () of Hash of Array of Recipe {...}
    my sub get_book returns Hash of Array of Recipe {...}</code></pre>


<h4><a name="junctive_types">Junctive Types</a></h4>
<p>Anywhere you can use a single type you can use a junction of types:</p>
<pre><code>
    my Int|Str $error = $val;              # can assign if $val~~Int or $val~~Str</code></pre>
<pre><code>
    if $shimmer.isa(Wax &amp; Topping) {...}   # $shimmer must inherit from both</code></pre>


<h4><a name="parameter_types">Parameter Types</a></h4>
<p>Parameters may be given types, just like any other variable:</p>
<pre><code>
    sub max (int @array is rw) {...}
    sub max (@array of int is rw) {...}</code></pre>


<h4><a name="return_types">Return Types</a></h4>
<p>On a scoped subroutine, a return type can be specified before or
after the name:</p>
<pre><code>
    our Egg sub lay {...}
    our sub lay returns Egg {...}</code></pre>
<pre><code>
    my Rabbit sub hat {...}
    my sub hat returns Rabbit {...}</code></pre>
<p>If a subroutine is not explicitly scoped, then it belongs to the current
namespace (module, class, grammar, or package). Any return type must go
after the name:</p>
<pre><code>
    sub lay returns Egg {...}</code></pre>
<p>On an anonymous subroutine, any return type can only go after the name:</p>
<pre><code>
    $lay = sub returns Egg {...};</code></pre>
<p>unless you use the "anonymous declarator" (<code>a</code>/<code>an</code>):</p>
<pre><code>
    $lay = an Egg sub {...};
    $hat = a Rabbit sub {...};</code></pre>




<h3><a name="properties_and_traits">Properties and Traits</a></h3>
<p>Compile-time properties are now called "traits." The 
<code>is NAME (DATA)</code> syntax defines traits on containers and
subroutines, as part of their declaration:</p>
<pre><code>
    my $pi is constant = 3;</code></pre>
<pre><code>
    my $key is Persistent(file=&gt;&quot;.key&quot;);</code></pre>
<pre><code>
    sub fib is cached {...}</code></pre>
<p>The <code>will NAME BLOCK</code> syntax is a synonym for <code>is NAME (BLOCK)</code>:</p>
<pre><code>
    my $fh will undo { close $fh };    # Same as: my $fh is undo({ close $fh });</code></pre>
<p>The <code>but NAME (DATA)</code> syntax specifies run-time properties on values:</p>
<pre><code>
    my $pi = 3 but Approximate(&quot;legislated&quot;);</code></pre>
<pre><code>
    sub system {
        ...
        return $error but false if $error;
        return 0 but true;
    }</code></pre>


<h4><a name="subroutine_traits">Subroutine Traits</a></h4>
<p>These traits may be declared on the subroutine as a whole (not on individual
parameters).</p>
<dl>
<dt><strong><a name="item_is_signature"><code>is signature</code></a></strong><br />
</dt>
<dd>
The signature of a subroutine -- normally declared implicitly, by providing a
parameter list and/or return type.
</dd>


<dt><strong><a name="item_returns%2fis_returns"><code>returns</code>/<code>is returns</code></a></strong><br />
</dt>
<dd>
The type returned by a subroutine.
</dd>


<dt><strong><a name="item_will_do"><code>will do</code></a></strong><br />
</dt>
<dd>
The block of code executed when the subroutine is called -- normally declared
implicitly, by providing a block after the subroutine's signature definition.
</dd>


<dt><strong><a name="item_is_rw"><code>is rw</code></a></strong><br />
</dt>
<dd>
Marks a subroutine as returning an lvalue.
</dd>


<dt><strong><a name="item_is_parsed"><code>is parsed</code></a></strong><br />
</dt>
<dd>
Specifies the rule by which a macro call is parsed.
</dd>


<dt><strong><a name="item_is_cached"><code>is cached</code></a></strong><br />
</dt>
<dd>
Marks a subroutine as being memoized
</dd>


<dt><strong><a name="item_is_inline"><code>is inline</code></a></strong><br />
</dt>
<dd>
<em>Suggests</em> to the compiler that the subroutine is a candidate for
optimization via inlining.
</dd>


<dt><strong><a name="item_is_tighter%2fis_looser%2fis_equiv"><code>is tighter</code>/<code>is looser</code>/<code>is equiv</code></a></strong><br />
</dt>
<dd>
Specifies the precedence of an operator relative to an existing
operator.
</dd>


<dt><strong><a name="item_is_assoc"><code>is assoc</code></a></strong><br />
</dt>
<dd>
Specifies the associativity of an operator.
</dd>


<dt><strong><a name="item_pre%2fpost"><code>PRE</code>/<code>POST</code></a></strong><br />
</dt>
<dd>
Mark blocks that are to be unconditionally executed before/after
the subroutine's <code>do</code> block. These blocks must return a true value,
otherwise an exception is thrown.
</dd>


<dt><strong><a name="item_first%2flast%2fnext%2fkeep%2fundo%2fetc%2e"><code>FIRST</code>/<code>LAST</code>/<code>NEXT</code>/<code>KEEP</code>/<code>UNDO</code>/etc.</a></strong><br />
</dt>
<dd>
Mark blocks that are to be conditionally executed before or after
the subroutine's <code>do</code> block. The return values of these blocks
are ignored.
</dd>

</dl>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S06.html">Synopsis 6</a> for the current design information.</p>

<h4><a name="parameter_traits">Parameter Traits</a></h4>
<p>The following traits can be applied to many types of parameters.</p>
<dl>
<dt><strong><a name="item_is_constant"><code>is constant</code></a></strong><br />
</dt>
<dd>
Specifies that the parameter cannot be modified (e.g. assigned to,
incremented). It is the default for parameters.
</dd>


<dt><strong><code>is rw</code></strong><br />
</dt>
<dd>
Specifies that the parameter can be modified (assigned to, incremented,
etc). Requires that the corresponding argument is an lvalue or can be
converted to one.
</dd>
<dd>
<p>When applied to a variadic parameter, the <code>rw</code> trait applies to each
element of the list:</p>
</dd>
<dd>
<pre><code>
    sub incr (*@vars is rw) { $_++ for @vars }</code></pre>
</dd>


<dt><strong><a name="item_is_ref"><code>is ref</code></a></strong><br />
</dt>
<dd>
Specifies that the parameter is passed by reference. Unlike <a href="#item_is_rw"><code>is rw</code></a>, the
corresponding argument must already be a suitable lvalue. No attempt at
coercion or autovivification is made.
</dd>


<dt><strong><a name="item_is_copy"><code>is copy</code></a></strong><br />
</dt>
<dd>
Specifies that the parameter receives a distinct, read-writeable copy of the
original argument. This is commonly known as "pass-by-value."
</dd>
<dd>
<pre><code>
    sub reprint ($text, $count is copy) {
        print $text while $count--&gt;0;
    }</code></pre>
</dd>


<dt><strong><a name="item_context"><code>is context(TYPE)</code></a></strong><br />
</dt>
<dd>
Specifies the context that a parameter applies to its argument. Typically used
to cause a final list parameter to apply a series of scalar contexts:
</dd>
<dd>
<pre><code>
    # &amp;format may have as many arguments as it likes,
    # each of which is evaluated in scalar context</code></pre>
</dd>
<dd>
<pre><code>
    sub format(*@data is context(Scalar)) {...}</code></pre>
</dd>

</dl>




<h3><a name="advanced_subroutine_features">Advanced Subroutine Features</a></h3>


<h4><a name="the_&__routine">The <code>&amp;_</code> routine</a></h4>
<p><code>&amp;_</code> is always an alias for the current subroutine, much like the <code>$_</code>
alias for the current topic:</p>
<pre><code>
    my $anonfactorial = sub (Int $n) {
                            return 1 if $n&lt;2;
                            return $n * &amp;_($n-1)
                        };</code></pre>


<h4><a name="the_caller_function">The <code>caller</code> Function</a></h4>
<p>The <code>caller</code> function returns an object that describes a particular 
"higher" dynamic scope, from which the current scope was called.</p>
<pre><code>
    print &quot;In &quot;,           caller.sub,
          &quot; called from &quot;, caller.file,
          &quot; line &quot;,        caller.line,
          &quot;\n&quot;;</code></pre>
<p><code>caller</code> may be given arguments telling it what kind of higher scope to
look for, and how many such scopes to skip over when looking:</p>
<pre><code>
    $caller = caller;                      # immediate caller
    $caller = caller Method;               # nearest caller that is method
    $caller = caller Bare;                 # nearest caller that is bare block
    $caller = caller Sub, skip=&gt;2;         # caller three levels up
    $caller = caller Block, label=&gt;'Foo';  # caller whose label is 'Foo'</code></pre>


<h4><a name="the_want_function">The <code>want</code> Function</a></h4>
<p>The <code>want</code> function returns an object that contains information about
the context in which the current block, closure, or subroutine was
called.</p>
<p>The returned context object is typically tested with a smart match (<code>~~</code>)
or a <code>when</code>:</p>
<pre><code>
   given want {
        when Scalar {...}           # called in scalar context
        when List   {...}           # called in list context
        when Lvalue {...}           # expected to return an lvalue
        when 2      {...}           # expected to return two values
        ...
    }</code></pre>
<p>or has the corresponding methods called on it:</p>
<pre><code>
       if (want.Scalar)    {...}    # called in scalar context
    elsif (want.List)      {...}    # called in list context
    elsif (want.rw)        {...}    # expected to return an lvalue
    elsif (want.count &gt; 2) {...}    # expected to return more than two values</code></pre>


<h4><a name="the_leave_function">The <code>leave</code> Function</a></h4>
<p>A <code>return</code> statement causes the innermost surrounding subroutine, method,
rule, macro or multimethod to return.</p>
<p>To return from other types of code structures, the <code>leave</code> funtion is used:</p>
<pre><code>
    leave;                      # return from innermost block of any kind
    leave Method;               # return from innermost calling method
    leave &amp;_ &lt;== 1,2,3;         # Return from current sub. Same as: return 1,2,3
    leave &amp;foo &lt;== 1,2,3;       # Return from innermost surrounding call to &amp;foo
    leave Loop, label=&gt;'COUNT'; # Same as: last COUNT;</code></pre>


<h4><a name="temporization">Temporization</a></h4>
<p>The <code>temp</code> function temporarily replaces a variable, subroutine or
other object in a given scope:</p>
<pre><code>
    {
       temp $*foo = 'foo';      # Temporarily replace global $foo
       temp &amp;bar = sub {...};   # Temporarily replace sub &amp;bar
       ...
    } # Old values of $*foo and &amp;bar reinstated at this point</code></pre>
<p><code>temp</code> invokes its argument's <code>.TEMP</code> method. The method is expected
to return a reference to a subroutine that can later restore the current
value of the object. At the end of the lexical scope in which the
<code>temp</code> was applied, the subroutine returned by the <code>.TEMP</code> method is
executed.</p>
<p>The default <code>.TEMP</code> method for variables simply creates
a closure that assigns the variable's pre-<code>temp</code> value 
back to the variable.</p>
<p>New kinds of temporization can be created by writing storage classes with
their own <code>.TEMP</code> methods:</p>
<pre><code>
    class LoudArray is Array {
        method TEMP {
            print &quot;Replacing $_.id() at $(caller.location)\n&quot;;
            my $restorer = .SUPER::TEMP();
            return { 
                print &quot;Restoring $_.id() at $(caller.location)\n&quot;;
                $restorer();
            };
        }
    }</code></pre>
<p>You can also modify the behaviour of temporized code structures, by
giving them a <code>TEMP</code> block. As with <code>.TEMP</code> methods, this block is
expected to return a closure, which will be executed at the end of
the temporizing scope to restore the subroutine to its pre-<code>temp</code> state:</p>
<pre><code>
    my $next = 0;
    sub next {
        my $curr = $next++;
        TEMP {{ $next = $curr }}  # TEMP block returns the closure { $next = $curr }
        return $curr;
    }</code></pre>


<h4><a name="wrapping">Wrapping</a></h4>
<p>Every subroutine has a <code>.wrap</code> method. This method expects a single
argument consisting of a block, closure or subroutine. That argument
must contain a call to the special <code>call</code> function:</p>
<pre><code>
    sub thermo ($t) {...}   # set temperature in Celsius, returns old temp</code></pre>
<pre><code>
    # Add a wrapper to convert from Fahrenheit...</code></pre>
<pre><code>
    $id = &amp;thermo.wrap( { call( ($^t-32)/1.8 ) } );</code></pre>
<p>The call to <code>.wrap</code> replaces the original subroutine with the closure
argument, and arranges that the closure's call to <code>call</code> invokes the
original (unwrapped) version of the subroutine. In other words, the call to
<code>.wrap</code> has more or less the same effect as:</p>
<pre><code>
    &amp;old_thermo := &amp;thermo;
    &amp;thermo := sub ($t) { old_thermo( ($t-32)/1.8 ) }</code></pre>
<p>The call to <code>.wrap</code> returns a unique identifier that can later be passed to
the <code>.unwrap</code> method, to undo the wrapping:</p>
<pre><code>
    &amp;thermo.unwrap($id);</code></pre>
<p>A wrapping can also be restricted to a particular dynamic scope with
temporization:</p>
<pre><code>
    # Add a wrapper to convert from Kelvin
    # wrapper self-unwraps at end of current scope</code></pre>
<pre><code>
    temp &amp;thermo.wrap( { call($^t + 273.16) } );</code></pre>


<h4><a name="currying">Currying</a></h4>
<p>Every subroutine has an <code>.assuming</code> method. This method takes a series
of named arguments, whose names must match parameters of the subroutine
itself:</p>
<pre><code>
    &amp;textfrom := &amp;substr.assuming(str=&gt;$text, len=&gt;Inf);</code></pre>
<p>It returns a reference to a subroutine that implements the same behavior
as the original subroutine, but has the values passed to <code>.assuming</code>
already bound to the corresponding parameters:</p>
<pre><code>
    $all  = $textfrom(0);   # same as: $all  = substr($text,0,Inf);
    $some = $textfrom(50);  # same as: $some = substr($text,50,Inf);
    $last = $textfrom(-1);  # same as: $last = substr($text,-1,Inf);</code></pre>
<p>The result of a <code>use</code> statement is a (compile-time) object that also has
an <code>.assuming</code> method, allowing the user to bind parameters in all the
module's subroutines/methods/etc. simultaneously:</p>
<pre><code>
    (use IO::Logging).assuming(logfile =&gt; &quot;.log&quot;);</code></pre>




<h3><a name="other_matters">Other Matters</a></h3>


<h4><a name="anonymous_hashes_vs_blocks">Anonymous Hashes vs. Blocks</a></h4>
<p><code>{...}</code> is always a block/closure unless it consists of a single list, the
first element of which is either a hash or a pair.</p>
<p>The standard <code>pair LIST</code> function is equivalent to:</p>
<pre><code>
    sub pair (*@LIST) {
        my @pairs;
        for @LIST -&gt; $key, $val {
            push @pairs, $key=&gt;$val;
        }
        return @pairs;
    }</code></pre>
<p>The standard <code>hash</code> function takes a block, evaluates it in list context, and
constructs an anonymous hash from the resulting key/value list:</p>
<pre><code>
    $ref = hash { 1, 2, 3, 4, 5, 6 };   # Anonymous hash
    $ref = sub  { 1, 2, 3, 4, 5, 6 };   # Anonymous sub returning list
    $ref =      { 1, 2, 3, 4, 5, 6 };   # Anonymous sub returning list
    $ref =      { 1=&gt;2, 3=&gt;4, 5=&gt;6 };   # Anonymous hash
    $ref =      { 1=&gt;2, 3, 4, 5, 6 };   # Anonymous hash</code></pre>


<h4><a name="pairs_as_lvalues">Pairs as lvalues</a></h4>
<p>Pairs can be used as lvalues. The value of the pair is the recipient of
the assignment:</p>
<pre><code>
    (key =&gt; $var) = &quot;value&quot;;</code></pre>
<p>When binding pairs, names can be used to "match up" lvalues and rvalues:</p>
<pre><code>
    (who =&gt; $name, why =&gt; $reason) := (why =&gt; $because, who =&gt; &quot;me&quot;);</code></pre>


<h4><a name="outofscope_names">Out-of-Scope Names</a></h4>
<p><code>$CALLER::varname</code> specifies the <code>$varname</code> visible in the dynamic
scope from which the current block/closure/subroutine was called.</p>
<p><code>$MY::varname</code> specifies the lexical <code>$varname</code> declared in the current
lexical scope.</p>
<p><code>$OUTER::varname</code> specifies the <code>$varname</code> declared in the lexical
scope surrounding the current lexical scope (i.e. the scope in which
the current block was defined).</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1110" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/04/p6pdigest/20030406.html" rel="bookmark">This week on Perl 6, week ending 2003-04-06</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-04-06T00:00:00-08:00">April  6, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>Welcome my friends to the show that never ends. Yes, it's another of
Piers Cawley's risible attempts to summarize the week's happenings in
the Perl 6 development community. We start, as usual, with events in
the perl6-internals world (not the perk6-internals world, obviously,
that would be the sort of foolish typo that would <em>never</em> make it
into any mail sent to the Perl 6 lists) where things have been
quiet... too quiet. I think they're planning something.</p>


<h4><a name="documentation_for_pmcs">Documentation for PMCs</a></h4>
<p>Alberto Simoes posted some documentation for the Array PMC and
suggested somewhere for it to be included in the Parrot
distribution.</p>
<p><a href="http://rt.perl.org/rt2/Ticket/Display.html?id=21759">http://rt.perl.org/rt2/Ticket/Display.html</a></p>


<h4><a name="extension_pmc_vs_builtin">Extension PMC vs built-in</a></h4>
<p>K. Stol asked how to go about creating extension PMCs which he could
use without having to recompile the entire Parrot VM. No answers yet.</p>
<p><a href="http://groups.google.com/groups?threadm=BAY1-DAV32Zm8PYhu5M0004976d%40hotmail.com">http://groups.google.com/groups</a></p>


<h4><a name="documentation_problem_with_set_global">Documentation problem with <code>set_global</code></a></h4>
<p>K Stol reported a problem with <em>parrot_assembly.pod</em>, apparently
there was a disagreement between the docs and the code about
<code>set_global</code>. Leopold T&ouml;tsch agreed that this was a
documentation bug, but pointed out that it was far from being the only
one. He suggested that <em>parrot_assembly.pod</em> should only have a
general description of Parrot Assembly, with details of 'real' ops in
generated docs like <em>core_ops.pod</em> and information on as yet
unimplemented in the appropriate PDDs.</p>
<p><a href="http://groups.google.com/groups?threadm=BAY1-DAV14WV13OEmRZ0004cb72%40hotmail.com">http://groups.google.com/groups</a></p>


<h4><a name="building_imcc_in_win32">Building IMCC in Win32</a></h4>
<p>Clinton A Pierce's work last week to get IMCC building in a Win32
environment was admired by Leo T&ouml;tsch, who promised to check the
needed patches into the distribution.</p>
<p><a href="http://groups.google.com/groups?threadm=3E8ABD27.4080805%40toetsch.at">http://groups.google.com/groups</a></p>


<h4><a name="typos_in_rx.ops">Typos in <em>rx.ops</em></a></h4>
<p>Cal Henderson submitted a patch to fix some typos in <em>rx.ops</em>, which
were applied. Anton Berezin sent in a further patch to fix a few more
errors.</p>
<p><a href="http://groups.google.com/groups?threadm=20030403065455.729626C1CB%40neuron.neuron1.com">http://groups.google.com/groups</a></p>


<h4><a name="parrot_regex_engine">Parrot regex engine</a></h4>
<p>Benjamin Goldberg praised <em>rx.ops</em>, commenting that he was 'amazed at
how cool it is' and wondered if the work was based on something
else. Steve Fink thought it was original to Brent Dax. Steve also
pointed to an unfinished draft of his detailed description of how at
least one of Parrot's regex implementations works.</p>
<p><a href="http://groups.google.com/groups?threadm=3E8CF2B2.76AB1170%40earthlink.net">http://groups.google.com/groups</a></p>
<p><a href="http://0xdeadbeef.net/~sfink/uploads/regex.pod">http://0xdeadbeef.net/~sfink/uploads/regex.pod</a> -- Steve Fink's
description</p>


<h4><a name="dan_explains_everything">Dan Explains Everything</a></h4>
<p>Away from the internals list, Dan Sugalski has been doing some
fascinating brain dumps about the 'whys' of Parrot in his weblog
'Squawks of the Parrot'. Specifically, he's been addressing why JVM
and .NET weren't chosen. In the course of this discussion he's come up
with a rather neat one sentence description of continuations: ``A
continuation is essentially a closure that, in addition to closing
over the lexical environment, also closes over the control chain.''</p>
<p>Anyway, I commend the whole blog to you.</p>
<p><a href="http://www.sidhe.org/~dan/blog/">http://www.sidhe.org/~dan/blog/</a></p>




<h3><a name="meanwhile_over_in_perl6language">Meanwhile over in perl6-language</a></h3>
<p>The perl6-language list was where all the action was this week with
the list attracting far more traffic than the internals list at the
moment.</p>


<h4><a name="how_shall_threads_work_in_p6">How shall threads work in P6?</a></h4>
<p>Austin Hastings has 'been thinking about closures, continuations, and
coroutines, and one of the interfering points has been threads.'
Austin wants to know what the Perl 6 threading model will look like,
and threw out a few suggestions. Matthijs van Duin thought that
preemptive threading in the core would be unnecessary, arguing that
cooperative threading would solve everyone's problems. Almost nobody
agreed with him. Most tellingly, Dan disagreed with him. Parrot will
be getting preemptive threads and that's not a point for negotiation.</p>
<p>Larry popped up to point out that, at the language level, the
underlying thread implementation (whether preemptive or cooperative)
really didn't matter, what was more important to the user was how much
information was shared between threads. Larry said he thought that
both the pthreads (all globals shared by default) and ithreads (all
globals unshared by default) approaches to threading were 'wrong to
some extent'.</p>
<p><a href="http://groups.google.com/groups?threadm=20030331154530.4491.qmail%40web12307.mail.yahoo.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20030404191304.GB28950%40wall.org">http://groups.google.com/groups</a></p>


<h4><a name="conditional_returnss">Conditional <code>returns</code>s?</a></h4>
<p>Michael Lazzaro was concerned about the inefficiency of</p>
<pre><code>
    return result_of_big_long_calculation(...) 
        if result_of_big_long_calculation(...);</code></pre>
<p>and ugliness of:</p>
<pre><code>
    my $x = result_of_big_long_calculation(...);
    return $x if $x;</code></pre>
<p>He wondered if there was a less ugly way to do it in Perl 6. There is:</p>
<pre><code>
    given result_of_big_long_calculation(...) { return $_ when true }</code></pre>
<p>was the most popular solution, but Dave Whipp pointed out that it
would also be possible to write:</p>
<pre><code>
    sub return_if_true ($value) {
        if $value {
            leave where =&gt; caller(1), value =&gt; $value;
        }
    }</code></pre>
<p>and then just do:</p>
<pre><code>
    return_if_true(result_of_big_long_calculation(...));</code></pre>
<p>You know, I like Perl 6 more and more.</p>
<p><a href="http://groups.google.com/groups?threadm=9CCFB386-63AB-11D7-9C90-00050245244A%40cognitivity.com">http://groups.google.com/groups</a></p>


<h4><a name="==_vs._eq">== vs. eq</a></h4>
<p>Luke Palmer wondered if there was anything to be gained by getting rid
of the distinction between <code>==</code> and <code>eq</code> and falling back to a
polymorphic <code>==</code>. Brent Dax pointed out that the <code>~~</code> 'smartmatch'
operator did exactly that. Luke said that <code>~~</code> didn't meet his
needs (its behaviour with hashes, for instance, isn't what you want
when trying to find out if two hashes are equal). Smylers pointed out
that Larry had already rejected (and had given good reasons why) the
idea. Luke still wanted a 'generic equality' operator though. Marco
Baringer threw a spanner in the works by pointing out that no such
thing as 'generic equality' exists. Luke also came up with a symbol for
an identity operator, <code>=:=</code> defined as:</p>
<pre><code>
    sub operator:=:= ( $a, $b ) { $a.id == $b.id }</code></pre>
<p>Michael Lazzaro isn't convinced of the need for a universal .id
method, but he does like the idea of an identity test operator. There
was then some discussion of</p>
<pre><code>
    \@a == \@b;</code></pre>
<p>which, Michael claims would compare the lengths of <code>@a</code> and <code>@b</code>
rather than their addresses. He backed this up with a quote from Larry
where he said ``But it's probably fair to say that $foo and @foo always
behave identically in a scalar context''. I think Michael's wrong
because <code>\@a</code> is not the same as <code>$a</code>. By his argument it seems that
even</p>
<pre><code>
    my $array_ref = \@foo;
    my $ary_ref2  = [1, 2, 3];</code></pre>
<p>won't work, which seems wrong somehow.</p>
<p>Discussion continued with various different possible implementations
of 'generic' equality operators thrown up for consideration. One
subthread even saw the return of Tom ``I thought he'd got a life and
left the Perl community'' Christiansen in a thread that ended up
talking about transfinite numbers and the cardinality of infinite
sets (which was interesting, but rather beside the point). Andy
Wardley got bonus points for making me laugh: ``G&ouml;del seems to think
there is an answer, but he doesn't know what it is. Turing is trying
to work it out on a piece of paper, but he can't say when (or if)
he'll be finished.'' Okay, it may not make you laugh, but my degree is
in maths.</p>
<p><a href="http://groups.google.com/groups?threadm=ygc3cl3uhf4.fsf%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?hl=en&lr=&ie=UTF-8&selm=sfwr8r0uf8o.fsf%40shell01.TheWorld.com">http://groups.google.com/groups</a> -- Why generic equality doesn't exist</p>


<h4><a name="is_is_overoverloaded"><code>is</code> is overoverloaded?</a></h4>
<p>Luke Palmer was concerned that <code>is</code> has too many meanings. It gets
used for setting variable traits, defining base classes and setting up
tied variables. Luke is concerned that these appear to be too varied
in meaning, and proposed at least adding a new <code>isa</code> keyword for
defining base classes. There was some discussion, but I'm not sure
that either side is convinced of the other's rectitude.</p>
<p><a href="http://groups.google.com/groups?threadm=20030401015656.B091A52%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>


<h4><a name="shortcircuiting_userdefined_operators">Short-circuiting user-defined operators</a></h4>
<p>Joe Gottman wondered if there would be a way to write an operator
which would short circuit in the same way as <code>&amp;&amp;</code> and <code>||</code>. He
wondered if this would be a function trait (suggesting <code>is
short_circuit</code>), or something cunning to do with parameters. Larry
thought Joe was trying too hard, proposing:</p>
<pre><code>
    sub infix:!! ($lhs, &amp;rhs) is equiv(&amp;infix:||) {...}</code></pre>
<p>He noted that if that couldn't be made to work you might have to
declare the operator as a macro, but that it still shouldn't be too
hard to implement. Dave Whipp wasn't too sure about Larry's assertion
that declaring a parameter as <code>&amp;foo</code> should force the RHS of that
operator to be a closure. What, he wondered would happen with <code>10 !!
&amp;closure</code>?</p>
<p><a href="http://groups.google.com/groups?threadm=007501c2f8b6%24e8795fc0%24cf6e1918%40carolina.rr.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20030405184012.GA5104%40wall.org">http://groups.google.com/groups</a></p>


<h4><a name="ruminating_rfc_93__alphabetblind_pattern_matching">Ruminating RFC 93 - alphabet-blind pattern matching</a></h4>
<p>Yary Hluchan has been reading the Perl 6 RFC 93, which Larry discussed
in Apocalypse 5 and discussed doing regular expression type matches on
streams of 'things', where the things weren't necessarily Unicode
characters. At one point though Larry popped up to say that the
discussion seemed to run contrary to what he said about RFC 93 in
Apocalypse 5.</p>
<p>Further down the thread, Ed Peschko wondered about using the Regex
engine 'in reverse' to generate a list of all the possible strings
that a regular expression could match. Everyone politely assumed that
when Ed referred to the rule <code>rx/a*/</code> he really meant <code>rx/^a*$/</code> and
got stuck into the problem. Matthijs van Duin pointed out that to get
a 'useful' list of productions you'd have to go about producing all
possible matches of length 'n' before giving any possibilities of
length n+1 (where 'length' counts atoms I think...). Once Luke Palmer
had that key insight he showed off an implementation that could
generate such a list. Piers Cawley used Luke's cunning implementation
to show a lazy <code>generate_all</code> method that would iterate through all
the possible productions of a rule. Luke said that he hoped it
wouldn't actually need such a wrapper to be lazy. Personally I think
that might be a hope too far...</p>
<p><a href="http://groups.google.com/groups?threadm=200304020627.h326RKb21625%40bell.apicom.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=ygcy92rv7ga.fsf%40babylonia.flatirons.org">http://groups.google.com/groups</a> -- Luke's code, with
explication further down the thread</p>


<h4><a name="named_vs._variadic_parameters">Named vs. Variadic Parameters</a></h4>
<p>This thread continued from last week. The problem is that, if you want
to define a function that you would call in the following fashion:</p>
<pre><code>
    foo $pos, opt_nam =&gt; 'value', 'slurpy', 'list', ...;</code></pre>
<p>Then your signature needs to look like</p>
<pre><code>
    sub foo ( $pos, *@slurpy, +$opt_nam ) {...}</code></pre>
<p>which seems rather counter intuitive (though mixing positional and non
positional parameters could be seen to be counter intuitive whatever
happens...) Various people argued for longer forms to denote the
differences between positional, named, optional etc arguments and
proposed various solutions. Larry didn't sound all that convinced,
pointing out that if you wanted to implement such parameter
specification styles you could always use a macro and declared that
``Perl 6 is designed to allow cultural experimentation.  You may
reclassify any part of Perl 6 as a bike shed, and try to persuade
other people to accept your taste in color schemes.  Survival of the
prettiest, and all that...''</p>
<p><a href="http://groups.google.com/groups?threadm=20030402113533.A64627%40megazone.bigpanda.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20030404184049.GA28950%40wall.org">http://groups.google.com/groups</a></p>


<h4><a name="implicit_threading">Implicit threading</a></h4>
<p>The discussion of how to write short circuiting operators spawned a
subthread (which, rather annoyingly shared the same subject...)
trigged by a suggestion of David Whipp's to do lazy initialization of
some variables by spawning subthreads. The idea being that one could
do</p>
<pre><code>
   my $a is lazy := expensive_fn(...);</code></pre>
<p>or something, and Perl would immediately spawn a subthread to
calculate the value of <code>expensive_fn(...)</code> then, at the point you
come to use the value of <code>$a</code>, the main thread would do a thread join
and block if the subthread hadn't finished. Austin Hastings liked the
idea and went on to suggest other places in which implicit threading
could be used. My gut feeling is that this is the sort of thing that
will get implemented in a module on top of whatever explicit threading
system we get in Perl 6.</p>
<p><a href="http://groups.google.com/groups?threadm=20030402015704.25392.qmail%40onion.perl.org">http://groups.google.com/groups</a> -- Dave Whipp's cunning
idea</p>
<p><a href="http://groups.google.com/groups?threadm=20030403170325.26461.qmail%40web12308.mail.yahoo.com">http://groups.google.com/groups</a> -- Further
discussion here</p>


<h4><a name="properties_and_methods">Properties and Methods</a></h4>
<p>Luke Palmer was concerned about potential naming clashes between
properties and methods. He thought that things would be safer if,
instead of accessing properties using method call type syntax. He was
also worried about method naming clashes between the methods of things
in a junction, and of the Junction class itself. Nobody had commented
on this by the end of the week.</p>
<p><a href="http://groups.google.com/groups?threadm=ygche9fqut2.fsf%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>


<h4><a name="patterns_and_junctions">Patterns and Junctions</a></h4>
<p>Adam D. Lopresto had a suggestion for using two different kinds of
alternation in regular expressions. In Adam's proposal, alternation
with <code>|</code> could ignore the order of the alternatives when attempting
to make a match and alternation with <code>||</code> would do the kind of order
respecting alternation we're used to. I confess that I wondered what
on earth Adam was on about, but Luke Palmer liked the idea, pointing
out a way something like it could be used for globally optimizing
large grammars. However, he was unconvinced by the syntax and
suggested that it would be better if we could mark rules as being
'side effect free' and thus capable of being run in arbitrary order.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.GSO.4.53.0304030832230.5753%40ritz.cec.wustl.edu">http://groups.google.com/groups</a></p>




<h3><a name="acknowledgements,_announcements_and_apologies">Acknowledgements, Announcements and Apologies</a></h3>
<p>The schedules for both OSCON and YAPC::USA have been announced and
there's a fair amount of Perl 6 and Parrot related content at both of
them. I shall be attending both conferences (but only speaking at YAPC
-- about refactoring tools and about Pixie; the object persistence
tool I work on, neither of which are Perl 6 related) and driving from
YAPC to OSCON with probable stops in Washington DC, Philadelphia,
Boston, Burlington VT, Ottawa and Chicago (where we cheat and hop on a
train). Hopefully I'll get to meet up with some of my happy readers at
some or all of these stops and at the conferences.</p>
<p><a href="http://www.yapc.org/America/">http://www.yapc.org/America/</a> -- YAPC</p>
<p><a href="http://conferences.oreillynet.com/os2003/">http://conferences.oreillynet.com/os2003/</a> -- OSCON</p>
<p>I would like to apologize to Leon Brocard for failing to mention
his name in this week's summary. Leon is offering a 'Little Languages in
Parrot' talk at OSCON though.</p>
<p>If you've appreciated this summary, please consider one or more of the
following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.</li>


<li>
Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>


<li>
Send feedback, flames, money, photographic and writing commissions, or
a few pounds of <a href="http://www.puttyworld.com">http://www.puttyworld.com</a>'s products to
<em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em></li>

</ul>
<p>This week's summary was again sponsored by Darren Duncan. Thanks
Darren. If you'd like to become a summary sponsor, drop me a line at
<em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em>
</p>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1102" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/04/02/mod_perl.html" rel="bookmark">Apache::VMonitor - The Visual System and Apache Server Monitor</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Stas Bekman</span> on <abbr class="published" title="2003-04-02T00:00:00-08:00">April  2, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p><i>Stas Bekman is a coauthor of O'Reilly's upcoming <a href="http://www.oreilly.com/catalog/pmodperl/">Practical mod_perl</a>.</i></p>

<p>It's important to be able to monitor your production system's
health. You want to monitor the memory and file system utilization,
the system load, how much memory the processes use, whether you are
running out of swap space, and so on. All these tasks are feasible when
one has an interactive (telnet/ssh/other) access to the box the Web
server is running on, but it's quite a mess since different Unix tools
report about different parts of the system. All of this means that you
cannot watch the whole system at the one time; it requires lots of
typing since one has to switch from one utility to another, unless
many connections are open and then each terminal is dedicated to
report about something specific.</p>
<p>But if you are running mod_perl enabled Apache server, then you are in
good company, since it allows you to run a special module called
<code>Apache::VMonitor</code> thatprovides most of the desired reports at
once.</p>

<csperl file="grab" domain="on" record="b/832" template="b/article_sidebar2.view">


<h3><a name="apache::vmonitor">Apache::VMonitor</a></h3>
<p>The <code>Apache::VMonitor</code> module provides even better monitoring
functionality than top(1).  It gives all the relevant information
<a href="#item_top"><code>top(1)</code></a> does, plus all the Apache specific information provided by
Apache's mod_status module, such as request processing time, last
request's URI, number of requests served by each child, etc.  In
addition, it emulates the reporting functions of the top(1), mount(1),
<a href="#item_df"><code>df(1)</code></a> utilities.  There is a special mode for mod_perl processes.  It
has visual alerting capabilities and a configurable <em>automatic refresh</em> mode.
It provides a Web interface, which can be used to show
or hide all sections dynamically.</p>
<p>The module provides two main viewing modes:</p>
<ol>
</li>

<li>
Multi-processes and system overall status reporting mode


</li>

<li>
A single process extensive reporting system
</li>
</ol>


<h4><a name="prerequisites_and_configuration">Prerequisites and Configuration</a></h4>
<p>You need to have <strong>Apache::Scoreboard</strong> installed and configured in
<em>httpd.conf</em>, which in turn requires mod_status to be installed. You
also have to enable the extended status for mod_status, for this
module to work properly. In <em>httpd.conf</em> add:</p>
<pre>
  ExtendedStatus On</pre>
<p>You also need <strong>Time::HiRes</strong> and <strong>GTop</strong> to be installed.  <code>GTop</code>
relies in turn on <code>libgtop</code> library, which is not not available for all platforms.
</p>
<p>And, of course, you need a running mod_perl-enabled Apache server.</p>
<p>To enable this module, you should modify a configuration in
<strong>httpd.conf</strong>, if you add the following configuration:</p>
<pre>
  &lt;Location /system/vmonitor&gt;
    SetHandler perl-script
    PerlHandler Apache::VMonitor
  &lt;/Location&gt;</pre>
<p>The monitor will be displayed when you request
<a href="http://localhost/system/vmonitor.">http://localhost/system/vmonitor.</a></p>
<p>You probably want to protect this location from unwanted visitors. If
you always access this location from the same IP address, then you can use
a simple host-based authentication:</p>
<pre>
  &lt;Location /system/vmonitor&gt;
    SetHandler perl-script
    PerlHandler Apache::VMonitor
    order deny, allow
    deny  from all
    allow from 132.123.123.3
  &lt;/Location&gt;</pre>
<p>Alternatively you may use the Basic or other authentication schemes
provided by Apache and various extensions.</p>
<p>You can control the behavior of this module by configuring the
following variables in the startup file or inside the
<code>&lt;Perl&gt;</code> section.</p>
<p>You should load the module in <em>httpd.conf</em>:</p>
<pre>
  PerlModule Apache::VMonitor</pre>
<p>or from the the startup file:</p>
<pre>
  use Apache::VMonitor();</pre>
<p>You can alter the monitor reporting behavior by tweaking the
following configuration arguments from within the startup file:</p>
<pre>
  $Apache::VMonitor::Config{BLINKING} = 1;
  $Apache::VMonitor::Config{REFRESH}  = 0;
  $Apache::VMonitor::Config{VERBOSE}  = 0;</pre>
<p>You can control what sections are to be displayed when the tool is
first accessed via:</p>
<pre>
  $Apache::VMonitor::Config{SYSTEM}   = 1;
  $Apache::VMonitor::Config{APACHE}   = 1;
  $Apache::VMonitor::Config{PROCS}    = 1;
  $Apache::VMonitor::Config{MOUNT}    = 1;
  $Apache::VMonitor::Config{FS_USAGE} = 1;</pre>
<p>You can control the sorting of the mod_perl processes reports. These
report can be sorted by one of the following columns: <em>``pid''</em>, <em>``mode''</em>,
<em>``elapsed''</em>, <em>``lastreq''</em>, <em>``served''</em>, <em>``size''</em>, <em>``share''</em>,
<em>``vsize''</em>, <em>``rss''</em>, <em>``client''</em>, <em>``request''</em>. For example to sort
by process size, try the following setting:</p>
<pre>
  $Apache::VMonitor::Config{SORT_BY}  = &quot;size&quot;;</pre>
<p>As the application provides an option to monitor processes other than mod_perl
ones, you may set a regular expression to match the wanted
processes. For example, to match the process names, which include
<em>httpd_docs</em>, <em>mysql</em> and <em>squid</em> string, the following regular
expression is to be used:</p>
<pre>
  $Apache::VMonitor::PROC_REGEX = join &quot;\|&quot;, qw(httpd_docs mysql squid);</pre>
<p>We will discuss all these configuration options and their influence on
the application shortly.</p>


<h4><a name="multiprocesses_and_system_overall_status_reporting_mode">Multi-processes and System Overall Status Reporting Mode</a></h4>
<p>The first mode is the one that is mainly used, since it allows you to
monitor almost all important system resources from one location. For
your convenience you can turn on and off different sections on the
report, to make it possible for reports to fit into one screen.</p>
<p>This mode comes with the following features.</p>
<dl>
<dt><strong><a name="item_automatic_refreshing_mode">Automatic Refreshing Mode</a></strong><br />
</dt>
<dd>
You can tell the application to refresh the report every few
seconds. You can preset this value at the server startup. For example,
to set the refresh to 60 seconds you should add the following
configuration setting:
</dd>
<dd>
<pre>
  $Apache::VMonitor::Config{REFRESH} = 60;</pre>
</dd>
<dd>
<p>A 0 (zero) value turns automatic refreshing off.</p>
</dd>
<dd>
<p>When the server is started you can always adjust the refresh rate
using the application user interface.</p>
</dd>


<dt><strong><a name="item_top"><code>top(1)</code> Emulation: System Health Report</a></strong><br />
</dt>
<dd>
Just like top(1), it shows current date/time, machine up-time, average
load, all the system CPU and memory usage: CPU load, real memory and
swap partition usage.
</dd>
<dd>
<p>The <a href="#item_top"><code>top(1)</code></a> section includes a swap space usage visual alert
capability. As we know swapping is undesirable on production
systems. The system is said to be swapping when it has used all of
its RAM and starts to page out unused memory pages to the slow swap
partition, which slows down the whole system and may eventually lead to
the machine crash.</p>
</dd>
<dd>
<p>Therefore, the tool helps to detect abnormal situation by changing the
swap report row's color according to the following rules:</p>
</dd>
<dd>
<pre>
         swap usage               report color
   ---------------------------------------------------------
   5Mb &lt; swap &lt; 10 MB             light red
   20% &lt; swap (swapping is bad!)  red
   70% &lt; swap (almost all used!)  red + blinking (if enabled)</pre>
</dd>
<dd>
<p>Note that you can turn on the blinking mode with:</p>
</dd>
<dd>
<pre>
  $Apache::VMonitor::Config{BLINKING} = 1;</pre>
</dd>
<dd>
<p>The module doesn't alert when swap is being used just a little (&lt;5Mb),
since it happens most of the time on many Unix systems, even when
there is plenty of free RAM.</p>
</dd>
<dd>
<p>If you don't want the system section to be displayed set:</p>
</dd>
<dd>
<pre>
  $Apache::VMonitor::Config{SYSTEM} = 0;</pre>
</dd>
<dd>
<p>The default is to display this section.</p>
</dd>


<dt><strong><code>top(1)</code> Emulation: Apache/mod_perl Processes Status</strong><br />
</dt>
<dd>
Then just like in real <a href="#item_top"><code>top(1)</code></a> there is a report of the processes, but
it shows all the relevant information about mod_perl processes only!
</dd>
<dd>
<p>The report includes the status of the process (<em>Starting</em>,
<em>Reading</em>, <em>Sending</em>, <em>Waiting</em>, etc.), process' ID, time since
current request was started, last request processing time, size,
shared, virtual and resident size.  It shows the last client's IP and
Request URI (only 64 chars, as this is the maximum length stored by
underlying Apache core library).</p>
</dd>
<dd>
<p>This report can be sorted by any column during the application uses, by
clicking on the name of the column, or can be preset with the
following setting:</p>
</dd>
<dd>
<pre>
  $Apache::VMonitor::Config{SORT_BY}  = &quot;size&quot;;</pre>
</dd>
<dd>
<p>The valid choices are: <em>``pid''</em>, <em>``mode''</em>, <em>``elapsed''</em>,
<em>``lastreq''</em>, <em>``served''</em>, <em>``size''</em>, <em>``share''</em>, <em>``vsize''</em>,
<em>``rss''</em>, <em>``client''</em>, <em>``request''</em>.</p>
</dd>
<dd>
<p>The section is concluded with a report about the total memory being
used by all mod_perl processes as reported by kernel, plus an extra
number, which results from an attempt to approximately calculate the
real memory usage when memory sharing is taking place. The calculation
is performed by using the following logic:</p>

<ol>
</li>

<li>
For each process, sum up the difference between shared and total
memory.


</li>

<li>
Now if we add the share size of the process with the maximum shared
memory, then we would get all the memory that is actually used by all
mod_perl processes apart from the parent process.</li>

</ol>
<p>Please note that this might be incorrect for your system, so you
should use this number on your own risk. We have verified this number
on the Linux OS, by taken the number reported by <code>Apache::VMonitor</code>,
then stopping mod_perl and looking at the system memory usage. The
system memory went down approximately by the number reported by the
tool. Again, use this number wisely!</p>
<p>If you don't want the mod_perl processes section to be displayed set:</p>
<pre>
  $Apache::VMonitor::Config{APACHE} = 0;</pre>
<p>The default is to display this section.</p>
</dd>
<dt><strong><code>top(1)</code> Emulation: Any Processes</strong><br />
</dt>
<dd>
This section, just like the mod_perl processes section, displays the
information in a <a href="#item_top"><code>top(1)</code></a> fashion. To enable this section you have to
set:
</dd>
<dd>
<pre>
  $Apache::VMonitor::Config{PROCS} = 1;</pre>
</dd>
<dd>
<p>The default is not to display this section.</p>
</dd>
<dd>
<p>Now you need to specify which processes are to be monitored. The
regular expression that will match the desired processes is required
for this section to work. For example, if you want to see all the
processes whose name include any of these strings: <em>http</em>, <em>mysql</em>
and <em>squid</em>, then the following regular expression would be used:</p>
</dd>
<dd>
<pre>
  $Apache::VMonitor::PROC_REGEX = join &quot;\|&quot;, qw(httpd mysql squid);</pre>
</dd>
<dd>
<p>The following snapshot visualizes the sections that have been discussed
so far.</p>

<table align="center" width="450">
<tr>
<td align="center">
<a href="/2003/04/02/graphics/vmonitor5.1.png"><img src="/pub/2003/04/02/graphics/vmonitor5.1_t.gif" width="300" height="276" border="0" /></a>
</td>
</tr>
<tr><td align="center">              
<span class="secondary">
<strong>Figure 1.1: Emulation of top(1), Centralized Information About mod_perl and Selected Processes</strong>
</span>
<p class="tiny">(Click for larger image)</p>
</td></tr>
</table>

<p>As you can see the swap memory is heavily used and therefore the swap
memory report is colored in red.</p>
</dd>

<dt><strong><a name="item_mount"><code>mount(1)</code> Emulation</a></strong><br />
</dt>
<dd>
This section reports about mounted filesystems, the same way as if you
have called <a href="#item_mount"><code>mount(1)</code></a> with no parameters.
</dd>
<dd>
<p>If you want the <a href="#item_mount"><code>mount(1)</code></a> section to be displayed set:</p>
</dd>
<dd>
<pre>
  $Apache::VMonitor::Config{MOUNT} = 1;</pre>
</dd>
<dd>
<p>The default is NOT to display this section.</p>
</dd>


<dt><strong><a name="item_df"><code>df(1)</code> Emulation</a></strong><br />
</dt>
<dd>
This section completely reproduces the <a href="#item_df"><code>df(1)</code></a> utility. For each mounted
filesystem, it reports the number of total and available blocks (for
both superuser and user), and usage in percents.
</dd>
<dd>
<p>In addition it reports about available and used file inodes in numbers
and percents.</p>
</dd>
<dd>
<p>This section has a capability of visual alert which is being triggered
when either some filesystem becomes more than 90 percent full or there are
less than 10 percent of free file inodes left. When this event happens, the
filesystem-related report row will be displayed in the bold font and
in the red color. A mount point directory will blink if the blinking
is turned on. You can turn the blinking on with:</p>
</dd>
<dd>
<pre>
  $Apache::VMonitor::Config{BLINKING} = 1;</pre>
</dd>
<dd>
<p>If you don't want the <a href="#item_df"><code>df(1)</code></a> section to be displayed set:</p>
</dd>
<dd>
<pre>
  $Apache::VMonitor::Config{FS_USAGE} = 0;</pre>
</dd>
<dd>
<p>The default is to display this section.</p>
</dd>
<dd>
<p>The following snapshot presents an example of the report consisting of
the last two sections that were discussed (df(1) and <a href="#item_mount"><code>mount(1)</code></a>
emulation), plus the ever important mod_perl processes report.</p>

<table align="center" width="450">
<tr>
<td align="center">
<a href="/2003/04/02/graphics/vmonitor5.2.png"><img src="/pub/2003/04/02/graphics/vmonitor5.2_t.gif" width="300" height="276" border="0" /></a>
</td>
</tr>
<tr><td align="center">
<span class="secondary">
<strong>Figure 1.2: Emulation of df(1) both Inodes and Blocks Utilization. Emulation of mount(1).
</strong>
</span>
<p class="tiny">(Click for larger image)</p>
</td></tr>
</table>


<p>You can see that <em>/mnt/cdrom</em> and <em>/usr</em> filesystems are utilized
for more than 90 percent and therefore colored in red. (It's normal for
<em>/mnt/cdrom</em>, which is a mounted cdrom, but critical for the <em>/usr</em>
filesystem which should be cleaned up or enlarged).</p>
</dd>

<dt><strong><a name="item_abbreviations_and_hints">abbreviations and hints</a></strong><br />
</dt>
<dd>
The report uses many abbreviations, which might be knew for you. If
you enable the VERBOSE mode with:
</dd>
<dd>
<pre>
  $Apache::VMonitor::Config{VERBOSE} = 1;</pre>
</dd>
<dd>
<p>this section will reveal all the full names of the abbreviations at
the bottom of the report.</p>
</dd>
<dd>
<p>The default is NOT to display this section.</p>
</dd>

</dl>


<h4><a name="a_single_process_extensive_reporting_system">A Single Process Extensive Reporting System</a></h4>
<p>If you need to get an in-depth information about a single process, then you
just need to click on its PID.</p>
<p>If the chosen process is a mod_perl process, then the following info would be
displayed:</p>
<ul>

<li>
Process type (child or parent), status of the process (<em>Starting</em>,
<em>Reading</em>, <em>Sending</em>, <em>Waiting</em>, etc.), how long the current
request is processed or the last one was processed if the process is
inactive at the moment of the report take.


</li>

<li>
How many bytes transferred so far. How many requests served per child
and per slot.


</li>

<li>
CPU times used by process: <code>total</code>, <code>utime</code>, <code>stime</code>, <code>cutime</code>,
<code>cstime</code>.</li>

</ul>
<p>For all (mod_perl and non-mod_perl) processes the following
information is reported:</p>
<ul>
</li>

<li>
General process info: UID, GID, State, TTY, Command line arguments


</li>

<li>
Memory Usage: Size, Share, VSize, RSS


</li>

<li>
Memory Segments Usage: text, shared lib, date and stack.


</li>

<li>
Memory Maps: start-end, offset, device_major:device_minor, inode,
perm, library path.


</li>

<li>
Loaded libraries sizes.
</li>
</ul>
<p>Just like the multi-process mode, this mode allows you to
automatically refresh the page on the desired intervals.</p>
<p>The following snapshots show an example of the report about one
mod_perl process:</p>


<table align="center" width="450">
<tr>
<td align="center">
<a href="/2003/04/02/graphics/vmonitor5.3.png"><img src="/pub/2003/04/02/graphics/vmonitor5.3_t.gif" width="300" height="276" border="0" /></a>
</td>
</tr>
<tr><td align="center">
<span class="secondary">
<strong>Figure 1.3: Extended information about processes: General Process Information
</strong>
</span>
<p class="tiny">(Click for larger image)</p>
</td></tr>
</table>



<table align="center" width="450">
<tr>
<td align="center">
<a href="/2003/04/02/graphics/vmonitor5.4.png"><img src="/pub/2003/04/02/graphics/vmonitor5.4_t.gif" width="300" height="276" border="0" /></a>
</td>
</tr>
<tr><td align="center">  
<span class="secondary">
<strong>Figure 1.4: Extended information about processes: Memory Maps
</strong>
</span>
<p class="tiny">(Click for larger image)</p>
</td></tr>
</table>





<table align="center" width="450">
<tr>
<td align="center">
<a href="/2003/04/02/graphics/vmonitor5.5.png"><img src="/pub/2003/04/02/graphics/vmonitor5.5_t.gif" width="300" height="276" border="0" /></a>
</td>
</tr>
<tr><td align="center">
<span class="secondary">
<strong>Figure 1.5: Extended information about processes: Loaded Libraries
</strong>
</span>
<p class="tiny">(Click for larger image)</p>
</td></tr>
</table>







<h3><a name="references">References</a></h3>
<ul>

<li>
The mod_perl site's URL: <p><a href="http://perl.apache.org">http://perl.apache.org</a></p>


</li>

<li>
<code>Time::HiRes</code>
<p><a href="http://search.cpan.org/search?dist=Time-HiRes">http://search.cpan.org/search?dist=Time-HiRes</a></p>


</li>

<li>
<code>Apache::Scoreboard</code>
<p><a href="http://search.cpan.org/search?dist=Apache-Scoreboard">http://search.cpan.org/search?dist=Apache-Scoreboard</a></p>


</li>

<li>
<code>GTop</code>
<p><a href="http://search.cpan.org/search?dist=GTop">http://search.cpan.org/search?dist=GTop</a></p>
<p><code>GTop</code> relies in turn on libgtop library not available for all platforms</p>
</li>
</ul>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2003/03/">&laquo; March 2003</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2003/05/">May 2003 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
