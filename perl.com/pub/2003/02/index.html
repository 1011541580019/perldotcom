<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: February 2003 Archives</title>


    <link rel="prev" href="/pub/2003/01/" title="January 2003" />
    <link rel="next" href="/pub/2003/03/" title="March 2003" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">February 2003 Archives</h1>





                            
                            <div id="entry-1072" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/02/27/review.html" rel="bookmark">Genomic Perl</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2003-02-27T00:00:00-08:00">February 27, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>
This is a book I have been looking forward to for a long time. Back when
James Tisdall had just finished his <a href="http://www.oreilly.com/catalog/begperlbio/">Beginning Perl for
Bioinformatics</a>, I asked him to write an article about <a href="/pub/a/2002/01/02/bioinf.html">how to get into
bioinf</a> from a Perl programmer's perspective.
With bioinformatics being a recently booming sphere and many scientists
finding themselves in need of computer programmers to help them process
their data, I thought it would be good if there was more information for
programmers about the genomic side of things.
</p>
<p>
Rex Dwyer has produced a book, <a href="http://books.cambridge.org/052180177X.htm">Genomic Perl</a>,  which bridges the gap. As well as teaching
basic Perl programming techniques to biologists, it introduces many
useful genetic concepts to those already familiar with programming. Of
course, as a programmer and not a biologist, I'm by no means qualified
to assess the quality of that side of the book, but I certainly learned
a lot from it. 
</p>
<p>
The first chapter, for instance, taught the basics of DNA transcription
and translation, the basics of Perl string handling, and tied the two
concepts together with an example of transcription in Perl. This is
typical of the format of the book - each chapter introduces
a genetic principle and a related problem, a Perl
principle which can be used to solve the problem, and a program
illustrates both. It's a well thought-out
approach which deftly caters for both sides of the audience.
</p>
<p>
However, it should be stressed that the book is a substitute neither for
a good introductory book on Perl nor a good textbook on genetics; and
indeed, I think it will turn out to be better for programmers who need
an over-arching idea of some of the problems involved with
bioinformatics than for biologists who need to turn out working code. 
For instance, when it states that a hash is the most convenient data
structure for looking up amino acids by their codons, it doesn't say
why, or even what a hash is. On the other hand, amino acids and codons
are both explained in detail.
</p>
<p>
The book covers a wide range of biological areas - from the structure of
DNA to building predictive models of species, exploring the available
databases of genetic sequences including readers of the GenBank database
and an implementation of the BLAST algorithm, phylology, protein
databases, DNA sequence assembly and prediction, restriction mapping,
and a lot more besides. In all, it's a good overview of the common
areas in which biologists need computer programs.
</p>
<p>
There's a significant but non-threatening amount of math in there,
particularly in dealing with probabilities of mutation and determining
whether or not events are significant, but I was particularly encouraged
to see discussion of algorithmic running time; as the author is
primarily a computer science professor and secondarily a
bioinformaticists, this should not be too surprising. However, a
significant number of bioinformaticists tend to produce code which
works... eventually. Stopping to say "well, this is order n-to-the-6 and
we can probably do better than that" is most welcome.
</p>
<p>
Onto the code itself. The first thing any reader will notice about the
book is that the code isn't monospaced. Instead, the code is "ground",
pretty-printed, as in days of old. This means you'll see code snippets
like:</p>

<blockquote style="font-family:sans-serif">
<b>next unless</b> $succReadSite; <i>## dummy sinks have no successor</i><br />
<b>my</b> $succContigSite =  $classNames-&gt;find($succReadSite);<br />
</blockquote>

<p>Now, I have to admit I really like this, but others may find it
difficult to read, and those who know  slightly less Perl may find it
confusing - the distinction between '' and &quot; <!-- Hello, copyeditor! -->
(that's two single quotes and a double quote)
can be quite subtle, and if you're going to grind Perl code, regular
expressions really, really ought to be monospaced. &quot;<span style="font-family:sans-serif">$elem =~
/^[(^\[(]*)(\(.*\))?$/;</span>" is just plain awkward.
</p>

<p>
The code is more idiomatic than much bioinformatic code that I've seen,
but still feels a little unPerlish; good use is made of references,
callbacks and object oriented programming, but three-argument
<code>for</code> is used more widely than the fluent Perl programmer
would have it, and things like</p>
<pre><code>
    main();
    sub main {
        ...
    }</code></pre>
<p>worry me somewhat. But it works, it's efficient, and it's certainly
enough to get the point across.
</p>

<p>
The appendices were enlightening and well thought-out: the first turns
an earlier example, RNA structure folding, into a practical problem of
drawing diagrams of folded RNA for publication; the other two tackle
matters of how to make some of the algorithms in the text more
efficient.
</p>

<p>
All in all, I came away from this book not just with more knowledge
about genetics and biology - indeed, some of what I learned has been
directly applicable to some work I have - but also with an understanding
of some of the complexity of the problems geneticists face. It fully
satisfies its goals, expressed in the preface: teaching computer
scientists the biological underpinnings of bioinformatics, providing
real, working code for biologists without boring the programmers, and
providing an elementary handling of the statistical considerations of
the subject matter. While it will end up being more used by programmers
getting into the field, it's still useful for the biologists already
there, particularly when combined with something like James Tisdall's
book or <a href="http://www.oreilly.com/catalog/lperl3">Learning
Perl</a>. But for the programmer like me, interested in what biologists
do and how we can help them do it, it's by far the clearest introduction
available, and I would heartily recommend it.</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1080" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/02/p6pdigest/20030223.html" rel="bookmark">This week on Perl 6, week ending 2003-02-23</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-02-23T00:00:00-08:00">February 23, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->


<p>Another week, another Perl 6 Summary, in which you'll find gratuitous
mentions of Leon Brocard, awed descriptions of what Leopold
T&ouml;tsch got up to and maybe even a summary of what's been
happening in Perl 6 design and development.</p>
<p>Kicking off with perl6-internals as usual.</p>


<h4><a name="strings_and_header_reuse">Strings and header reuse</a></h4>
<p>Dan responded to prompting from Leo T&ouml;tsch about the use and
reuse of string headers. The problem is that most of the string
functions that produce modified strings do it in new string headers;
there's no way of reusing existing string headers. This can end up
generating loads of garbage. Dan's going through the various string
handling ops and PMC interfaces working out what needs to do what, and
documenting them, as well as adding in versions of the ops that take
their destination string headers as an argument. Dan hopes that 'we
can make the changes quickly and get this out of the way once and for
all', leading Robert Spier to mutter something about 'famous last
words'.</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f01ba76a0489bfb%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>


<h4><a name="pxs_help">PXS help</a></h4>
<p>Tupshin Harper has been trying to use an XML parser from within Parrot
and started off by looking at the PXS example (in <em>examples/pxs) but
had problems following the instructions given there as his compiler
spat out errors by the bucket load. Leo T&ouml;</em>tsch thought that PXS
was probably deprecated and the native call interface (NCI) was the
thing to use. Being Leo, he provided a port of the PXS Qt example to
NCI. Although PXS appears to be out of sync with the parrot core,
nobody was entirely sure whether it should be removed.</p>
<p><a href="http://groups.google.com/groups?threadm=3E5186AB.2030604%40tupshin.com">http://groups.google.com/groups</a></p>


<h4><a name="bit_rot_in_parrot/language/*">Bit rot in <em>parrot/language/*</em></a></h4>
<p>Tupshin Harper had some problems with some of the language examples
not working well with the most recent versions of Parrot. Leo
T&ouml;tsch addressed most of the issues he raised, but there are
definitely issues with the interpreter and the languages getting out
of sync.</p>
<p><a href="http://groups.google.com/groups?threadm=3E52078F.9060807%40tupshin.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=3E523381.6080109%40toetsch.at">http://groups.google.com/groups</a></p>


<h4><a name="macros_in_imcc_(part_2)">Macros in IMCC (part 2)</a></h4>
<p>J&uuml;rgen B&ouml;mmels extended the macro support in IMCC,
implementing <code>.constant</code> and adding some docs. The patch was promptly
applied.</p>
<p><a href="http://rt.perl.org/rt2/Ticket/Display.html?id=21277">http://rt.perl.org/rt2/Ticket/Display.html</a></p>


<h4><a name="[rfd]_imcc_calling_conventions">[RFD] IMCC calling conventions</a></h4>
<p>Leo T&ouml;tsch posted an RFD covering his understanding of the
various calling conventions that IMCC would have to deal with which
sparked some discussion. I'm now confused as to whether function calls
in Parrot will be caller saves, callee saves, or some unholy mixture
of the two.</p>
<p><a href="http://groups.google.com/groups?threadm=3E521993.5050700%40toetsch.at">http://groups.google.com/groups</a></p>


<h4><a name="parrot_performance_vs_the_good,_the_bad_and_the_ugly">Parrot performance vs the good, the bad and the ugly</a></h4>
<p>Tupshin Harper decided to port <em>primes.pasm</em> to C and Perl 5 to
compare results. Parrot came out very quick indeed. (Close to C). For
bonus points he then took a python primes algorithm that had been
ported to C and ported that to Parrot as well. In full on, all stops
pulled out, knobs turned to 11 mode, Parrot came in at about 50%
slower than C and around 14 times faster than Python. There was some
muttering about the demo being rigged. However, Jim Meyer redid the
Perl and Python implementations to use a loop that duplicated the
algorithm used in <em>primes.pasm</em> and, whilst it improved their
performance somewhat, Parrot was still substantially faster.</p>
<p>This probably won't be the test that's run when Dan and Guido face the
possibility of custard pies at 10 paces or whatever the performance
challenge stake stands at now.</p>
<p><a href="http://groups.google.com/groups?threadm=3E52211C.1070907%40tupshin.com">http://groups.google.com/groups</a></p>


<h4><a name="mmm..._spaceships...">Mmm... spaceships...</a></h4>
<p>Leon Brocard patched <em>examples/assembly/life.pasm</em> to use a small
spaceship as its starting pattern. Apparently because it 'can provide
hours of enjoyment at conferences if projected onto a big screen while
answering parrot questions.' Nobody thought to ask him how a spaceship
was going to answer Parrot questions, but Leo T&ouml;tsch applied the
patch.</p>
<p><a href="http://groups.google.com/groups?threadm=rt-21301-52439.16.4792168417894%40bugs6.perl.org">http://groups.google.com/groups</a></p>


<h4><a name="using_imcc_as_jit_optimizer">Using IMCC as JIT optimizer</a></h4>
<p>Apparently, Leo T&ouml;tsch finds it unbearable that 'optimized
compiled C is still faster than parrot -j' so he's been experimenting
with adding smarts to IMCC, making it add hardware register allocation
hints to its emitted bytecode. Sean O'Rourke liked the basic idea, but
reckoned that the information generated by IMCC should really be
platform-independent, suggesting that it'd be okay to pass a control
flow graph to the JIT, but that hardware register allocation for a
specific number of registers would iffy. He suggested that another
option would be for IMCC to 'just rank the Parrot registers in order
of decreasing spill cost', then the JIT could just move the most
important parrot registers into architectural registers.</p>
<p>Dan thought the idea was interesting too, but worried that the JIT
might spend more time optimizing code than it could possibly gain from
the optimization. The discussion got more than a little technical
after this. I'm afraid I'm a bear of little brain when it comes to
this sort of magic, so you'll have to read the whole thread if you're
interested in the details.</p>
<p>The response was pretty positive throughout the discussion, so Leo
went ahead and implemented it. The new, improved version shaved
slightly more than a tenth of a second from the primes.pasm runtime
(not a great percentage win, but the total runtime includes the
compilation time)</p>
<p><a href="http://groups.google.com/groups?threadm=3E54B776.1080508%40toetsch.at">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=3E58EC12.7090407%40toetsch.at">http://groups.google.com/groups</a></p>


<h4><a name="invoke"><code>invoke</code></a></h4>
<p>Steve Fink is bothered by the <code>invoke</code> op because it operates
implicitly on P0. He wants to replace it with a new version that takes
a PMC argument. Leo T&ouml;tsch is less bothered by the implicit
behaviour of the op, but would like to see an additional <code>invoke_p</code>
op, which would take a single PMC argument. So Steve implemented it,
but hit a couple of snags. I'm not quite sure whether these have been
overcome yet.</p>
<p><a href="http://groups.google.com/groups?threadm=20030220182024.GB21582%40foxglove">http://groups.google.com/groups</a></p>


<h4><a name="problems_with_configure.pl_cgoto=0">Problems with <code>Configure.pl --cgoto=0</code></a></h4>
<p>Nicholas Clark was unable to build Parrot with computed gotos turned
off. Simon Glover offered a simple patch that fixed Nick's
problem. Leo T&ouml;tsch talked about the different reasons for not
building a computed goto core, which depends on both the compiler's
capabilities and the user's choices. This led to a discussion of which
cores were now obsolete. Leo believes that the simple Computed Goto
and Prederef cores have been obsoleted by the CGP core (Computed Goto
Prederefed). Nick thought we should continue to ship code for all the
cores, and ensure that the config system is flexible enough to let
anyone build any arbitrary combination of cores, which convinced
Leo. Dan suggested that, once we'd done this we should revamp the
Tinderbox system to run tests on all the core types.</p>
<p><a href="http://groups.google.com/groups?threadm=20030220213957.GC281%40Bagpuss.unfortu.net">http://groups.google.com/groups</a></p>


<h4><a name="noninline_text_in_parrot_assembly">Non-inline text in parrot assembly</a></h4>
<p>Tupshin Harper wondered if there were any plans for Parrot to support
a distinct <code>.string</code> asm section. Leo T&ouml;tsch pointed to
<code>.constant</code> (in PASM) and <code>.const</code> (in IMCC) as ways of keeping
strings visually together. Tupshin realised he'd missed a chunk of
documentation (<code>perldoc assemble.pl</code> for anyone else who hasn't read
it) which he thinks should probably be moved into
<em>docs/parrot_assembly.pod</em> or somewhere similar.</p>
<p><a href="http://groups.google.com/groups?threadm=3E574520.3040203%40tupshin.com">http://groups.google.com/groups</a></p>


<h4><a name="access_to_partial_registers">Access to partial registers?</a></h4>
<p>Tupshin Harper wondered if it was possible and/or meaningful to read
and write from a part of a register (eg. a single word) in
PASM. Answer: Not at the moment, what do you want? We can always add
an <em>intreg.ops</em> set.</p>
<p><a href="http://groups.google.com/groups?threadm=3E5837F6.90705%40tupshin.com">http://groups.google.com/groups</a></p>




<h3><a name="meanwhile,_over_in_perl6language">Meanwhile, over in perl6-language</a></h3>
<p>Things were, once more quiet (all of 16 messages). I think we're all
awaiting the coming of the Prophet Zarquon (or possibly the next
Apocalypse, whichever comes soonest.)</p>


<h4><a name="arrays,_lists,_referencing">Arrays, lists, referencing</a></h4>
<p>David Storrs suggested some possible semantics for <code>(4, 1, 2) + 7</code>,
noting that he doesn't like the Perl5's current behaviour (evaluates
to 9). Michael Lazzaro thinks it should evaluate to 10 (length of the
list + 7) or possibly throw a syntax error. This then morphed into a
discussion of pass by value, pass by reference and pass by constant
reference, which Allison Randal told us would be addressed in the
upcoming Apocalypse 6.</p>
<p><a href="http://groups.google.com/groups?threadm=20030215084750.A80337%40megazone.bigpanda.com">http://groups.google.com/groups</a></p>


<h4><a name="err...">Err...</a></h4>


<h4><a name="that's_it">That's it</a></h4>


<h3><a name="acknowledgements,_announcements_and_apologies">Acknowledgements, Announcements and Apologies</a></h3>
<p>Mmm... the comfy chair... it's the only place to write a summary
in. Especially when you're plied with lashings of Earl Grey tea and
entertained by the antics of a couple of adolescent cats. Things could
be lots worse.</p>
<p>I'd like to apologize to Danny O'Brien for last weeks mention of 'a
Brainf*ck compiler, in Brainf*ck, for the Brainf*ck interpreter
supplied with Parrot, a virtual machine named after a joke, written
for a language that doesn't yet exist.' Apparently this sprained
Danny's head. And I extend similar apologies to anyone else whose head
was sprained by that concept.</p>
<p>The American Odyssey web page is still more of a beautiful idea than an
actual link you can click. Hopefully it'll spring into existence
before we set off, but I wouldn't bet on it.</p>
<p>Aspell is, once more, the weapon of proofreading choice.</p>
<p>If you  appreciated this summary, please consider one or more of the
following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.</li>


<li>
Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>


<li>
Send feedback, flames, money, job offers or his and hers Mini Coopers
to <em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em></li>

</ul>
<p>This week's summary was again sponsored by Darren Duncan. Thanks
Darren. If you'd like to become a summary sponsor, drop me a line at
<em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em>.</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1070" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/02/19/engine.html" rel="bookmark">Building a Vector Space Search Engine in Perl</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Maciej Ceglowski</span> on <abbr class="published" title="2003-02-19T00:00:00-08:00">February 19, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<a name="__index__"></a>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#building a vector space search engine in perl">Building a Vector Space Search Engine in Perl</a></li>
	<li><a href="#a few words about vectors">A Few Words About Vectors</a></li>
	<li><a href="#getting down to business">Getting Down To Business</a></li>
	<li><a href="#building the search engine">Building the Search Engine</a></li>
	<li><a href="#making it better">Making it Better</a></li>
	<li><a href="#further reading">Further Reading</a></li>
</ul>
<!-- INDEX END -->

<a name="building a vector space search engine in perl"></a>
<p><em>Why waste time reinventing the wheel, when you could be reinventing the engine?</em>
<em>-Damian Conway</em></p>
<p>As a Perl programmer, sooner or later you'll get an opportunity to build
a search engine. Like many programming tasks - parsing a date,
validating an e-mail address, writing to a temporary file - this turns
out to be easy to do, but hard to get right. Most people try end up with some kind of reverse index, a data structure that
associates words with lists of documents. Onto this, they graft a scheme
for ranking the results by relevance.</p>
<p>Nearly every search engine in use today - from Google on down - works on
the basis of a <strong>reverse keyword index</strong>. You can write such a keyword
engine in Perl, but as your project grows you will inevitably find
yourself gravitating to some kind of relational database system. Since
databases are customized for fast lookup and indexing, it's no surprise
that most keyword search engines make heavy use of them. But writing code for them isn't much fun.</p>
<p>More to the point, companies like Google and Atomz already offer
excellent, free search services for small Web sites. You can get an
instant search engine with a customizable interface, and spend no time
struggling with Boolean searches, text highlighting, or ranking
algorithms. Why bother duplicating all that effort?</p>
<p>As Perl programmers, we know that laziness is a virtue. But we also know
that there is more than one way to do things. Despite the ubiquity of
reverse-index search, there are many other ways to build a
search engine. Most of them originate in the field of information
retrieval, where researchers are having all kinds of fun. Unfortunately,
finding documentation about these alternatives isn't easy. Most of the
material available online is either too technical or too impractical to
be of use on real-world data sets. So programmers are left with the
false impression that vanilla search is all there
is.</p>
<p>In this article, I want to show you how to build and run a search
engine using a <strong>vector-space model</strong>, an alternative to reverse index
lookup that does not require a database, or indeed any file storage at
all. Vector-space search engines eliminate many of the disadvantages
of keyword search without introducing too many disadvantages of their
own. Best of all, you can get one up and running in just a few dozen
lines of Perl.</p>


<h1><a name="a few words about vectors">A Few Words About Vectors</a></h1>
<p>Vector-space search engines use the notion of a <strong>term space</strong>, where
each document is represented as a vector in a high-dimensional space.
There are as many dimensions as there are unique words in the entire
collection. Because a document's position in the term space is
determined by the words it contains, documents with many words in
common end up close together, while documents with few shared words end
up far apart.</p>
<p>To search our collection, we project a query into this term space and
calculate the distance from the query vector to all the document vectors
in turn. Those documents that are within a certain threshold distance
get added to our result set. If all this sounds like gobbledygook to
you, then don't worry - it will become clearer when we write the code.</p>
<p>The vector-space data model gives us a search engine with several
useful features:</p>
<ul>
<li>
Searches take place in RAM, there is no disk or database access</li>



<li>
Queries can be arbitrarily long</li>



<li>
Users don't have to bother with Boolean logic or regular expressions</li>



<li>
It's trivially easy to do 'find similar' searches on returned documents</li>



<li>
You can set up a 'saved results' basket, and do similarity searches on the
documents in it</li>



<li>
You get to talk about 'vector spaces' and impress your friends</li>


</ul>


<h1><a name="getting down to business">Getting Down to Business</a></h1>
<p>The easiest way to understand the vector model is with a concrete example.</p>
<p>Let's say you have a collection of 10 documents, and together they contain
50 unique words.   You can represent each document as a vector by counting
how many times a word appears in the document, and moving that distance along
the appropriate axis.  So if Document A contains the sentence &quot;cats like
chicken&quot;, then you find the axis for <code>cat</code>, move along one unit, and then do
the same for <code>like</code> and <code>chicken</code>. Since the other 47 words
don't appear in your document, you don't move along the corresponding
axes at all.</p>
<p>Plot this point and draw a line to it from the origin, and you have your
<strong>document vector</strong>. Like any vector, it has a magnitude (determined by
how many times each word occurs), and a direction (determined by which
words appeared, and their relative abundance).</p>
<p>There are two things to notice here:</p>
<p>The first is that we throw away all information word order, and there is
no guarantee that the vector will be unique. If we had started with the
sentence &quot;chickens like cats&quot; (ignoring plurals for the moment), then we
would have ended up with an identical document vector, even though the
documents are not the same.</p>
<p>This may seem to be a big limitation, but it turns out that word order
in natural language contains little information about content - you can
infer most of what a document is about by studying the word list. Bad
news for English majors, good news for us.</p>
<p>The second thing to notice is that with three non-zero values out of a
possible 50, our document vector is sparse. This will hold true for
any natural language collection, where a given document will contain
only a tiny proportion of all the possible words in the language. This
makes it possible to build in-RAM search engines even for large
collections, although the details are outside the scope of this article.
The point is, you can scale this model up quite far before having to
resort to disk access.</p>
<p>To run a vector-space search engine, we need to do the following:</p>
<ol>
<li>
Assemble a document collection</li>



<li>
Create a term space and map the documents into it</li>



<li>
Map an incoming query into the same term space</li>



<li>
Compare the query vector to the stored document vectors</li>



<li>
Return a list of nearest documents, ranked by distance</li>


</ol>
<p>Now let's see how to implement these steps in Perl.</p>


<h1><a name="building the search engine">Building the Search Engine</a></h1>
<p>We'll make things easy by starting with a tiny collection of four documents,
each just a few words long:</p>
<pre><code>
        &quot;The cat in the hat&quot;

        &quot;A cat is a fine pet.&quot;

        &quot;Dogs and cats make good pets.&quot;

        &quot;I haven't got a hat.&quot;</code></pre>
<p>Our first step is to find all the unique words in the document set. The
easiest way to do this is to convert each document into a word list, and
then combine the lists together into one. Here's one (awful) way do it:
</p>
<pre><code>

        sub get_words { 
                my ( $text ) = @_;
                return map { lc $_ =&gt; 1 }
                       map { /([a-z\-']+)/i } 
                       split /\s+/s, $text;
        }</code></pre>
<p>The subroutine splits a text string on whitespace, takes out all punctuation
except hyphens and apostrophes, and converts everything to lower case before
returning a hash of words.</p>
<p>The curious <code>do</code> statement is just a compact way of creating a lookup hash.
<code>%doc_words</code> will end up containing our word list as its keys, and its values
will be the number of times each word appeared.</p>
<p>If we run this 'parser' on all four documents in turn, then we get a master word
list:</p>
<pre><code>
        a
        and
        cat
        cats
        dogs
        fine
        good
        got
        hat
        haven't
        i
        in
        is
        make
        pet
        pets
        the</code></pre>
<p>Notice that many of the words in this list are junk words - pronouns, articles,
and other grammatical flotsam that's not useful in a search context.  A common
procedure in search engine design is to strip out words like these using a
<strong>stop list</strong>.    Here's the same subroutine with a rudimentary stop list added
in, filtering out the most common words:
</p>
<pre><code>

        our %stop_hash;
        our @stop_words = qw/i in a to the it have haven't was but is be from/;
        foreach @stop_words {$stop_hash{$_}++ };


        sub get_words {


                # Now with stop list action!


                my ( $text ) = @_;
                return map { $_ =&gt; 1 }
                       grep { !( exists $stop_hash{$_} ) }
                       map lc,
                       map { /([a-z\-']+)/i } 
                       split /\s+/s, $text;
        }</code></pre>
<p>A true stop list would be longer, and tailored to fit our document
collection. You can find a real stop list in the <code>DATA</code> section of
<a href="/2003/02/19/examples/VectorSpace.pm">Listing 1</a>, along with a complete implementation of the search engine
described here. Note that because of Perl's fast hash lookup algorithm,
we can have a copious stop list without paying a big price in program
speed. Because word frequencies in natural language obey a power-law
distribution, getting rid of the most common words removes a
disproportionate amount of bulk from our vectors.</p>
<p>Here is what our word list looks after we munge it with the stop list:</p>
<pre><code>
        cat
        cats
        dogs
        fine
        good
        got
        hat
        make
        pet
        pets</code></pre>
<p>We've narrowed the list down considerably, which is good.   But notice that our
list contains a couple of variants (&quot;cat&quot; and &quot;cats&quot;, &quot;pet&quot; and &quot;pets&quot;), that
differ only in number.   Also note that someone who searches on 'dog' in our
collection won't get any matches, even though 'dogs' in the plural form is a
valid hit.  That's bad.</p>
<p>This is a common problem in search engine design, so of course there is a module
on the CPAN to solve it.   The bit of code we need is called a <strong>stemmer</strong>, a set
of heuristics for removing suffixes from English words, leaving behind a common
root.   The stemmer we can get from CPAN uses the <strong>Porter stemming algorithm</strong>,
which is an imperfect but excellent way of finding word stems in English.</p>
<pre><code>
        use Lingua::Stem;</code></pre>
<p>We'll wrap the stemmer in our own subroutine, to hide the clunky Lingua::Stem
syntax:</p>
<pre><code>
        sub stem {
                my ( $word) = @_;
                my $stemref = Lingua::Stem::stem( $word );
                return $stemref-&gt;[0];
        }</code></pre>
<p>And here's how to fold it in to the <code>get_words</code> subroutine:</p>
<pre><code>
        return map { stem($_) =&gt; 1 }
               grep { !( exists $stop_hash{$_} ) }
               map lc,
               map { /([a-z\-']+)/i } 
               split /\s+/s, $text;</code></pre>
<p>Notice that we apply our stop list before we stem the words.   Otherwise, 
a valid word like <code>beings</code> (which stems to <code>be</code>) would be caught by the
overzealous stop list.  It's easy to make little slips like this in search algorithm design, so be extra careful.</p>
<p>With the stemmer added in, our word list now looks like this:</p>
<pre><code>
        cat
        dog
        fine
        good
        got
        hat
        make
        pet</code></pre>
<p>Much better!  We have halved the size of our original list, while
preserving all of the important content.</p>















<p>Now that we have a complete list of <strong>content words</strong>, we're ready for the second
step - mapping our documents into the term space.   Because our collection has a
vocabulary of eight content words, each of our documents will map onto an
eight-dimensional vector.</p>
<p>Here is one example:</p>
<pre><code>
        # A cat is a fine pet



        $vec = [ 1, 0, 1, 0, 0, 0, 1 ];</code></pre>
<p>The sentence &quot;A cat is a fine pet&quot; contains three content words. Looking
at our sorted list of words, we find <code>cat</code>, <code>fine</code>, and <code>pet</code> at
positions one, three, and eight respectively, so we create an anonymous
array and put ones at those positions, with zeroes everywhere else.</p>
<p>If we wanted to go in the opposite direction, then we could take the vector
and look up the non-zero values at the appropriate position in a sorted
word list, getting back the content words in the document (but no
information about word order).</p>
<p>The problem with using Perl arrays here is that they won't scale. Perl
arrays eat lots of memory, and there are no native functions for
comparing arrays to one another. We would have to loop through our
arrays, which is slow.</p>
<p>A better data way to do it is to use the PDL module, a set of compiled
C extensions to Perl made especially for use with matrix algebra. You
can find it on the CPAN. PDL stands for &quot;Perl Data Language&quot;, and it
is a powerful language indeed, optimized for doing math operations
with enormous multidimensional matrices. All we'll be using is a tiny
slice of its functionality, the equivalent of driving our Ferrari to
the mailbox.</p>
<p>It turns out that a PDL vector (or &quot;piddle&quot;) looks similar to our
anonymous array:
</p>
<pre><code>

        use PDL;
        my $vec = piddle [ 1, 0, 1, 0, 0, 0, 1 ];


        &gt; print $vec

        [1 0 0 1 0 0 0 1]</code></pre>
<p>We give the piddle constructor the same anonymous array as an
argument, and it converts it to a smaller data structure, requiring
less storage.</p>
<p>Since we already know that most of our values in each document
vector will be zero (remember how sparse natural language is),
passing full-length arrays to the piddle constructor might get a
little cumbersome. So instead we'll use a shortcut to create a
zero-filled piddle, and then set the non-zero values explicitly. For
this we have the <code>zeroes</code> function, which takes the size of the
vector as its argument:</p>
<pre><code>
        my $num_words = 8;
        my $vec = zeroes $num_words;



        &gt; print $vec

        [0 0 0 0 0 0 0 0 0]</code></pre>
<p>To set one of the zero values to something else, we'll have to use the
obscure PDL syntax:</p>
<pre><code>
        my $value = 3;
        my $offset = 4;



        index( $vec, $offset ) .= $value;

        &gt; print $vec;

        [0 0 0 3 0 0 0 0 0]</code></pre>
<p>Here we've said &quot;take this vector, and set the value at position 4 to
3&quot;.</p>
<p>This turns out to be all we need to create a document vector. Now we
just have to loop through each document's word list, and set the
appropriate values in the corresponding vector. Here's a subroutine that
does the whole thing:</p>
<pre><code>
        # $word_count is the total number of words in collection
        # %index is a lookup hash of word to its position in the master list



        sub make_vector {
                my ( $doc ) = @_;
                my %words = get_words( $doc );  
                my $vector = zeroes $word_count;


                foreach my $w ( keys %words ) {
                        my $value = $words{$w};
                        my $offset = $index{$w};
                        index( $vector, $offset ) .= $value;
                }
                return $vector;
        }</code></pre>
<p>Now that we can generate a vector for each document in our collection,
as well as turn an incoming query into a query vector (by feeding the
query into the <code>make_vector</code> subroutine), all we're missing is a way to
calculate the distance between vectors.</p>
<p>There are many ways to do this. One of the simplest (and most intuitive)
is the <strong>cosine measure</strong>. Our intuition is that document vectors with
many words in common will point in roughly the same direction, so the
angle between two document vectors is a good measure of their
similarity. Taking the cosine of that angle gives us a value from
zero to one, which is handy. Documents with no words in common will
have a cosine of zero; documents that are identical will have a cosine
of one. Partial matches will have an intermediate value - the closer
that value is to one, the more relevant the document.</p>
<p>The formula for calculating the cosine is this:</p>
<pre><code>
        cos  = ( V1 * V2 ) / ||V1|| x ||V2||</code></pre>
<p>Where V2 and V2 are our vectors, the vertical bars indicate the 2-norm,
and the <code>*</code> indicates the inner product. You can take the math on
faith, or look it up in any book on linear algebra.</p>
<p>With PDL, we can express that relation easily:</p>
<pre><code>
        sub cosine {
                my ($vec1, $vec2 ) = @_;
                my $n1 = norm $vec1;
                my $n2 = norm $vec2;
                my $cos = inner( $n1, $n2 );    # inner product
                return $cos-&gt;sclr();  # converts PDL object to Perl scalar
        }</code></pre>
<p>We can normalize the vectors to unit length using the <code>norm</code> function, because we're not interested in their absolute magnitude, only the angle between them.</p>
<p>Now that we have a way of computing distance between vectors, we're
almost ready to run our search engine. The last bit of the puzzle is a
subroutine to take a query vector and compare it against all of the
document vectors in turn, returning a ranked list of matches:</p>
<pre><code>
        sub get_cosines {
                my ( $query_vec ) = @_;
                my %cosines;
                while ( my ( $id, $vec ) = each  %document_vectors ) {
                        my $cosine = cosine( $vec, $query_vec );
                        next unless $cosine &gt; $threshold;
                        $cosines{$id} = $cosine;
                }
                return %cosines;
        }</code></pre>
<p>This gives us back a hash with document IDs as its keys, and cosines as its
values.  We'll call this subroutine from a <code>search</code> subroutine that will be 
our module's interface with the outside world:</p>
<pre><code>
        sub search {
                my ( $query ) = @_;
                my $query_vec = make_vector( $query );
                my %results = get_cosines( $query_vec );
                return %results;
        }</code></pre>
<p>All that remains is to sort the results by the cosine (in descending
order), format them, and display them to the user.</p>
<p>You can find an object-oriented implementation of this code in <a href="/2003/02/19/examples/VectorSpace.pm">Listing 1</a>, complete with built-in stop list and some small changes to make the
search go faster (for the curious, we normalize the document vectors
before storing them, to save having to do it every time we run the
<code>cosine</code> subroutine).</p>
<p>Once we've actually written the code, using it is straightforward:</p>
<pre><code>
    use Search::VectorSpace;



    my @docs = get_documents_from_somewhere();


    my $engine = Search::VectorSpace-&gt;new( docs =&gt; \@docs );


    $engine-&gt;build_index();
    $engine-&gt;set_threshold( 0.8 );


    while ( my $query = &lt;&gt; ) {
        my %results = $engine-&gt;search( $query );
        foreach my $result ( sort { $results{$b} &lt;=&gt; $results{$a} }
                             keys %results ) {
                print &quot;Relevance: &quot;, $results{$result}, &quot;\n&quot;;
                print $result, &quot;\n\n&quot;;
        }


        print &quot;Next query?\n&quot;;
    }</code></pre>
<p>And there we have it, an instant search engine, all in Perl.</p>


<h1><a name="making it better">Making It Better</a></h1>
<p>There are all kinds of ways to improve on this basic model. Here are a
few ideas to consider:</p>
<dl>
<dt><strong><a name="item_Better_parsing">Better parsing</a></strong></dt>

<dd>
Our <code>get_words</code> subroutine is rudimentary - the code equivalent of
a sharpened stick. For one thing, it will completely fail on text
containing hyperlinks, acronyms or XML. It also won't recognize
proper names or terms that contain more than one word ( like
&quot;Commonwealth of Independent States&quot;). You can make the parser smarter
by stripping out HTML and other markup with a module like
<code>HTML::TokeParser</code>, and building in a part-of-speech tagger to find
proper names and noun phrases (look for our own Lingua::Tagger::En,
coming soon on the CPAN).</dd>



<dt><strong><a name="item_Non%2DEnglish_collections">Non-English Collections</a></strong></dt>

<dd>
Perl has great Unicode support, and the vector model doesn't care about
language, so why limit ourselves to English? As long as you can write a
parser, you can adapt the search to work with any language.
<p>Most likely you will need a special stemming algorithm. This can be
easy as pie for some languages (Chinese, Italian), and really hard for
others (Arabic, Russian, Hungarian). It depends entirely on the
morphology of the language. You can find published stemming algorithms
online for several Western European languages, including German,
Spanish and French.</p></dd>



<dt><strong><a name="item_Similarity_search">Similarity Search</a></strong></dt>

<dd>
It's easy to add a &quot;find similar&quot; feature to your search engine. Just
use an existing document vector as your query, and everything else falls
into place. If you want to do a similarity search on multiple documents,
then add the vectors together.</dd>



<dt><strong><a name="item_Term_weighting">Term Weighting</a></strong></dt>

<dd>
<strong>Term weighting</strong> is a fancy way of saying &quot;some words are more
important than others&quot;. Done properly, it can greatly improve 
search results.
<p>You calculate weights when building document vectors. <strong>Local weighting</strong> assigns values to words based on how many times they appear in
a single document, while <strong>global weighting</strong> assigns values based on
word frequency across the entire collection. The intuition is that rare
words are more interesting than common words (global weighting), and
that words that appear once in a document are not as relevant as words
that occur multiple times (local weighting).</p></dd>



<dt><strong><a name="item_Incorporating_metadata">Incorporating Metadata</a></strong></dt>

<dd>
If your documents have metadata descriptors (dates, categories, author
names), then you can build those in to the vector model. Just add a slot for
each category, like you did for your keywords, and apply whatever kind
of weighting you desire.</dd>



<dt><strong><a name="item_Exact_phrase_matching">Exact Phrase Matching</a></strong></dt>

<dd>
You can add arbitrary constraints to your result set by adding a chain
of filters to your result set. An easy way to do exact phrase matching
is to loop through your result set with a regular expression. This kind
of post-processing is also a convenient way to sort your results by
something other than relevance.</dd>


</dl>



<h1><a name="further reading">Further Reading</a></h1>
<p>There's a vast body of material available on search engine design, but
little of it is targeted at the hobbyist or beginner. The following
are good places to start:</p>
<dl>
<dt><strong><a name="item_http%3A%2F%2Fhotwired%2Elycos%2Ecom%2Fwebmonkey%2F"></a><a href="http://hotwired.lycos.com/webmonkey/code/97/16/index2a.html?collection=perl">http://hotwired.lycos.com/webmonkey/code/97/16/index2a.html?collection=perl</a></strong></dt>

<dd>
This Webmonkey article dates back to 1997, but it's still the best tutorial on
writing a reverse index search engine in Perl.</dd>




<dt><strong><a name="item_http%3A%2F%2Fmoskalyuk%2Ecom%2Fsoftware%2Fperl%2Fs"></a><a href="http://moskalyuk.com/software/perl/search/kiss.htm">http://moskalyuk.com/software/perl/search/kiss.htm</a></strong></dt>

<dd>
An example of a simple keyword search engine - no database, just
a deep faith in Perl's ability to parse files quickly.</dd>



<dt><strong><a name="item_http%3A%2F%2Fwww%2Emovabletype%2Eorg%2Fdownload%2E"></a><a href="http://www.movabletype.org/download.shtml">http://www.movabletype.org/download.shtml</a></strong></dt>

<dd>
Movable Type is a popular weblog application, written in Perl. The
search engine lives in MT::App::Search, and supports several advanced
features. It's not pretty, but it's real production code.</dd>



<dt><strong><a name="item_http%3A%2F%2Fjakarta%2Eapache%2Eorg%2Flucene%2Fdoc"></a><a href="http://jakarta.apache.org/lucene/docs/index.html">http://jakarta.apache.org/lucene/docs/index.html</a></strong></dt>

<dd>
Lucene is a Java-based keyword search engine, part of the Apache project.
It's a well-designed, open-source search engine, intended for larger projects.
The documentation discusses some of the challenges of implementing a large
search engine; it's worth reading even if you don't know Java.</dd>



<dt><strong><a name="item_http%3A%2F%2Fmitpress%2Emit%2Eedu%2Fcatalog%2Fitem"></a><a href="http://mitpress.mit.edu/catalog/item/default.asp?ttype=2&tid=3391">http://mitpress.mit.edu/catalog/item/default.asp?ttype=2&amp;tid=3391</a></strong></dt>

<dd>
<em>Foundations of Statistical Natural Language Processing</em>, MIT Press (hardcover textbook).  Don't be put off by the title - this book is a fantastic introduction to all kinds of issues in text search, and includes a thorough 
discussion of vector space models.</dd>



<dt><strong><a name="item_http%3A%2F%2Fwww%2Enitle%2Eorg%2Flsi%2Fintro%2F"></a><a href="http://www.nitle.org/lsi/intro/">http://www.nitle.org/lsi/intro/</a></strong></dt>

<dd>
An introduction to <strong>latent semantic indexing</strong>,  the vector model on steroids.  The document is aimed at nontechnical readers, but gives some more background information on using vector techniques to search and visualize data collections.
<p>The adventurous can also download some Perl code for latent semantic
indexing at <a href="http://www.nitle.org/lsi.php.">http://www.nitle.org/lsi.php.</a> Both the code and the article
come from my own work for the National Institute for Technology and
Liberal Education.</p></dd>


</dl>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1078" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/02/p6pdigest/20030216.html" rel="bookmark">This week on Perl 6, week ending 2003-02-16</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-02-16T00:00:00-08:00">February 16, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>Welcome to the all new, entirely unaltered, all singing, all dancing
Perl 6 summary. Your beacon of reliability in the crazy world that is
Perl 6 design and development.</p>
<p>Another quiet week. Even quieter than last week in fact, unless my
mail spent some of the time up the spout, but I don't think so.</p>
<p>So, as is traditional, we kick off with perl6-internals</p>


<h4><a name="cgp__the_computed_goto_prederefed_runloop">CGP - The Computed Goto Prederefed Runloop</a></h4>
<p>Last week I mentioned that nobody seemed to have commented on Dan's
bet with Guido van Rossum that Parrot would outperform Python by OSCON
2004. (I also missed the fact that the penalty for losing the bet now
involves cream pies as well as $10 and a round of drinks...). After I
posted the summary to the mailing lists, Leopold T&ouml;tsch informed
me that he had commented indirectly by announcing his new, improved,
ludicrously quick runloop that combines computed GOTOs and
predereferencing. Whatever that means.</p>
<p>This week, Leo and Nicholas Clark worked out how to combine the
blistering pace of the JIT core (for operations that had been
translated into hand hacked machine code) with the blistering pace of
the CGP runloop (for the other ops). As far as I can tell, this
involved turning the idea 'inside out', the VM actually starts up
running JIT compiled code and calls out to the CGP core to execute
non-JITable sequences of ops. The numbers for this approach look
fantastic (quite stunningly quick...) So Leo checked it in.</p>
<p><a href="http://groups.google.com/groups?threadm=3E48C71A.2090708%40toetsch.at">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=3E4BBD29.7060307%40toetsch.at">http://groups.google.com/groups</a> -- Some numbers</p>
<p><a href="http://groups.google.com/groups?threadm=3E4CEF66.7020900%40toetsch.at">http://groups.google.com/groups</a> -- Check in notice</p>


<h4><a name="optimized_runloops_and_threading_issues">Optimized runloops and threading issues</a></h4>
<p>Last week we were reminded that JIT and Predereferenced runloops don't
work in a threaded environment. This week Jerome Vouillon pointed out
an approach that looks like it could fix that (it seemed to convince
Leo). Dan (possibly playing mail catchup) said he was okay with having
to fall back to the old fast core (as opposed to the current, stupidly
fast core) in the presence of threads, but Leo seem to think that,
using Jerome's scheme we'll be able to have our cake, eat it and still
throw the cream pie at the Python team. Huzzah!</p>
<p><a href="http://groups.google.com/groups?threadm=20030214133916.GA19119%40strontium.pps.jussieu.fr">http://groups.google.com/groups</a></p>


<h4><a name="keyed_int_issues"><code>keyed_int</code> issues</a></h4>
<p>Leo T&ouml;tsch had wondered about why 
<code>{get,set}_&lt;type&gt;_keyed_int</code> vtable methods needed to take an <code>INTVAL*</code>
value instead of a plain <code>INTVAL</code> as it introduced some possibly unneeded
conditional code, a stack variable for the key and made life hard for
JIT code. It looks like the pointer is a holdover from an early
approach to doing multidimensional keyed structures.</p>
<p><a href="http://groups.google.com/groups?threadm=3E4B76E8.2040509%40toetsch.at">http://groups.google.com/groups</a></p>


<h4><a name="changes_to_the_calling_convention_and_other_fallout">Changes to the calling convention and other fallout</a></h4>
<p>Dan returned from the Sebastapol Perl 6 meeting with a few
announcements and one change in the parrot calling convention (how
many calling conventions have we had now?).</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f00ba72cc9686b5%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>


<h4><a name="macro_support_in_imcc">Macro support in IMCC</a></h4>
<p>J&uuml;rgen B&ouml;mmels announced that he'd implemented macro
expansion in IMCC (Yay J&uuml;rgen!). Leo liked it, but requested a
few changes before he'd check it in, so hopefully, some time soon the
mainline IMCC will have macros, which is very nice.</p>
<p><a href="http://groups.google.com/groups?threadm=rt-21033-51310.14.4462403001212%40bugs6.perl.org">http://groups.google.com/groups</a></p>




<h3><a name="meanwhile,_in_perl6language">Meanwhile, in perl6-language</a></h3>
<p>Almost all the discussion was about the difference between arrays and
lists. Deborah Ariel Pickett came up with a good list of questions
about arrays and array references in scalar and list contexts, which
Michael Lazzaro answered (very neatly I thought) with a list of their
different contextual behaviours. Deborah extended Michael's list to
hashes and hashrefs in a reasonably obvious way. Smylers came up with
a possible new sigquote (after paraphrasing): ``We should limit new
features to those that arise from a desire for the functionality
rather than a desire to use up 'spare' syntax''. (Okay, it's not
exactly <em>snappy</em>, but I think it's important).</p>
<p><a href="http://groups.google.com/groups?threadm=200302120056.h1C0uaec026963%40bruce.csse.monash.edu.au">http://groups.google.com/groups</a> -- Deborah's questions</p>
<p><a href="http://groups.google.com/groups?threadm=90876177-3EB9-11D7-A9B7-00050245244A%40cognitivity.com">http://groups.google.com/groups</a> -- Michael's answers</p>
<p>And that wraps it up for the language list. I'm sure it'll pick up
again soon though. There are rumours of a draft apocalypse in the next
couple of weeks, and presumably that implies a real apocalypse soon
after. Assuming we haven't had another kind of Apocalypse in the mean
time.</p>




<h3><a name="announcements,_acknowledgements_and_anotherwordbeginningwitha">Announcements, Acknowledgements and AnotherWordBeginningWithA</a></h3>
<p>This week's summary was again prepared in the comfy chair with
surprisingly few distractions apart from the late arrival of mail from
Leon Brocard announcing that he'd implemented a brainf*ck compiler in
brainf*ck, but that didn't really happen this week so I've got no
excuse for mentioning Leon's name in this summary.</p>
<p>Thanks to everyone who dropped us a line about our American Odyssey;
I'm hoping I'll have one of those web page things up at some point
with a rough itinerary in case anyone wants to come and throw rotten
tomatoes at me (or, preferably, buy me sushi).</p>
<p>Proofreading services were again down to Aspell and me.</p>
<p>If you  appreciated this summary, please consider one or more of the
following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.</li>


<li>
Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>


<li>
Send feedback, flames, money, job offers or 17 inches of aluminium
goodness to <em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em></li>

</ul>
<p>This week's summary was, once more, sponsored by Darren Duncan. Thanks
Darren. If you'd like to become a summary sponsor, drop me a line at
<em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em>.</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1068" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/02/12/module1.html" rel="bookmark">Module::Build</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Dave Rolsky</span> on <abbr class="published" title="2003-02-12T00:00:00-08:00">February 12, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->
<br clear="all" />
<p><i>Dave Rolsky is a co-author of the recently released <a href="http://www.oreilly.com/catalog/perlhtmlmason/">Embedding Perl in HTML with Mason</a>.</i></p>

<p>This article was originally published in February of 2003, and was updated by Dave Rolsky and Michael Schwern in January, 2008.</p>

<p>If you've ever created a Perl module for distribution on CPAN, you've
used the <code>ExtUtils::MakeMaker</code> module.  This venerable module goes
back to the dawn of modern Perl, which began with the release of Perl
5.000.</p>
<p>Recently, Ken Williams has created a potential replacement for
<code>ExtUtils::MakeMaker</code> called <code>Module::Build</code>, which was first
released in August of 2002.  Hugo van der Sanden, the pumpking for the
current development version of Perl, has expressed interest in
replacing <code>ExtUtils::MakeMaker</code> with <code>Module::Build</code> for the 5.10
release of Perl, and Michael Schwern, the current
<code>ExtUtils::MakeMaker</code> maintainer, agrees with him.
<code>ExtUtils::MakeMaker</code> won't go away any time soon, but we can hope
for a gradual transition to a new and improved build system.</p>


<h2><a name="why_extutils::makemaker_is_important">Why ExtUtils::MakeMaker is Important</a></h2>
<p>The <code>ExtUtils::MakeMaker</code> module, along with the <code>h2xs</code> script, has
been a huge boon to the Perl community, as it makes it possible to
have a <em>standard</em> way to distribute and install Perl modules.  It
automates many tasks that module authors would otherwise have to to
implement by hand, such as turning XS into C, compiling that C code,
generating man pages from POD, running a module's test suite, and of
course, installing the module.</p>
<p><code>ExtUtils::MakeMaker</code> is a huge part of what makes PAUSE and CPAN
possible, and it is quite a programming feat.  Python did not have a
similar utility until the September, 1999 release of distutils, PHP's
PEAR didn't begin until mid-2000, and Ruby is just beginning to work
on a standard library distribution mechanism.</p>


<h2><a name="the_scary_guts_of_extutils::makemaker">The Scary Guts of ExtUtils::MakeMaker</a></h2>
<p><code>ExtUtils::MakeMaker</code> works by generating a makefile that contains
targets for the various tasks needed when maintaining or installing a
module.  Here's an example target:</p>
<pre>
  install :: all pure_install doc_install</pre>
<p>If you're familiar with makefile syntax, you'll realize that all this
target does is call three other targets, which are named &quot;all&quot;,
&quot;pure_install&quot;, and &quot;doc_install&quot;.  These targets in turn may call
other targets, or use system commands to do whatever action is needed,
in this case installing the module and its associated documentation.</p>
<p>The makefiles generated by <code>ExtUtils::MakeMaker</code> are fairly complex.
For example, using version 6.05 of <code>ExtUtils::MakeMaker</code> to install
my <code>Exception::Class</code> module, a pure Perl distribution containing
just one module, creates a makefile with about 390 lines of makefile
code.  Figuring out what this makefile actually does is no simple
feat, because it consists of a maze of twisty macros, all alike, many
of which simply call Perl one-liners from the command line to perform
some task.</p>
<p>The <code>ExtUtils::MakeMaker</code> code itself is extremely complicated, as it
works on many operating systems (almost as many as Perl itself), and
needs to accommodate their file systems, command line shells,
different versions of make, and so on.  And this is all done with an
extra layer of indirection in place, because it is generating a
makefile which does all the work.</p>
<p>If you want to customize the module build or installation process,
good luck.  To do this, you must subclass <code>ExtUtils::MakeMaker</code>,
override methods that generate specific makefile targets, and then
tweak the generated text to include your custom behavior, all the
while preserving the basic behavior of the target.  Considering that
there is no documentation describing what to expect from these
targets, and that the actual target text may change between releases
of <code>ExtUtils::MakeMaker</code> or between different OS's, this can be quite
painful to implement and maintain.</p>
<p>And by the way, you can't really subclass <code>ExtUtils::MakeMaker</code>,
instead you are subclassing the <code>MY</code> package.  This is a deeply
strange hack, but the end result is that you can only override certain
pre-defined methods in <code>ExtUtils::MakeMaker</code>.</p>
<p>For example, the <code>HTML::Mason</code> module includes this snippet:</p>
<pre>
  package MY;</pre>
<pre>
  sub test {
      my $self = shift;</pre>
<pre>
      my $test = $self-&gt;SUPER::test(@_);</pre>
<pre>
      # %MY::APACHE is set in makeconfig.pl.
      # If we are not going to test with Apache there is no harm in
      # setting this anyway.</pre>
<pre>
      # The PORT env var is used by Apache::test.  Don't delete it!
      my $port = $MY::APACHE{port} || 8228;
      $MY::APACHE{apache_dir} ||= &quot;;</pre>
<pre>
      my $is_maintainer = main::is_maintainer();</pre>
<pre>
      # This works for older MakeMakers
      $test =~ s/(runtests \@ARGV;)/\$\$ENV{MASON_VERBOSE} == 
	  \$(TEST_VERBOSE) ? \$(TEST_VERBOSE) : \$\$ENV{MASON_VERBOSE}; 
	  \$\$ENV{PORT}=$port; 
	  \$\$ENV{APACHE_DIR}=q^$MY::APACHE{apache_dir}^; 
	  \$\$ENV{MASON_MAINTAINER}=$is_maintainer; $1/;</pre>
<pre>
      my $bs = $^O =~ /Win32/i ? &quot; : '\\';</pre>
<pre>
      # This works for newer MakeMakers (5.48_01 +)
	  $test =~ s/(&quot;-MExtUtils::Command::MM&quot; &quot;-e&quot; &quot;)
	  (test_harness\(\$\(TEST_VERBOSE\).*?\)&quot;
	  \$\(TEST_FILES\))/$1 $bs\$\$ENV{MASON_VERBOSE} == \$(TEST_VERBOSE) ?
	  \$(TEST_VERBOSE) : $bs\$\$ENV{MASON_VERBOSE}; $bs\$\$ENV{PORT}=$port;
	  $bs\$\$ENV{APACHE_DIR}=q^$MY::APACHE{apache_dir}^;
	  $bs\$\$ENV{MASON_MAINTAINER}=$is_maintainer; $2/;</pre>
<pre>
      return $test;
  }</pre>
<p>The goal of all this code is to pass some additional environment
information to the test scripts when they are run, so we can do tests
with a live Apache server.  It accommodates several versions of
<code>ExtUtils::MakeMaker</code>, and attempts to work properly on multiple
operating systems (at least Win32 and *nix), and it has to be careful
about escaping things properly so that it executes properly from the
shell.</p>


<h2><a name="why_not_perl">Why not Perl?</a></h2>
<p>All of this prompts the question of &quot;why not just use Perl itself for
all of this?&quot;  That's exactly the question that Ken Williams answered
with <code>Module::Build</code>.  The goal of <code>Module::Build</code> is to do
everything useful that <code>ExtUtils::MakeMaker</code> does, but to do this all
with pure Perl wherever possible.</p>
<p>This greatly simplifies the build system code, and <code>Module::Build</code>
works on systems which don't normally include make, like Win32 and Mac
OS.  Of course, if a module installation requires the compilation of C
code, you'll still need an external C compiler.</p>
<p>Additionally, customizing <code>Module::Build</code>'s behavior is often quite
trivial, and only requires that you know Perl, as opposed to knowing
make syntax and possibly having to learn about multiple command line
environments.</p>
<p><code>Module::Build</code> also aims to improve on some of the features provided
by <code>ExtUtils::MakeMaker</code>.  One example is its prerequisite-checking
system, which provides much more flexibility than what
<code>ExtUtils::MakeMaker</code> allows.  While these features could be added to
<code>ExtUtils::MakeMaker</code>, it's risky to make major changes to such an
important module, especially one with such complex internals.</p>


<h2><a name="using_module::build">Using Module::Build</a></h2>
<p>From an end-user perspective, a module that uses <code>Module::Build</code>
looks quite a bit like one using <code>ExtUtils::MakeMaker</code>, and
intentionally so.  So to install a module using <code>Module::Build</code> you'd
type the following lines from the command line:</p>
<pre>
  perl Build.PL
  ./Build
  ./Build test
  ./Build install</pre>
<p>The <em>Build.PL</em> script tells <code>Module::Build</code> to create a <em>Build</em>
script.  During this process, <code>Module::Build</code> also writes some files
to a <em>_build/</em> directory.  These files are used to store the build
system's state between invocations of the <em>Build</em> script.  This
script, when invoked, simply loads up <code>Module::Build</code> again, and
tells it to perform the specified action.  An action is the
<code>Module::Build</code> version of a makefile target, and actions are
implemented in pure Perl whenever possible.</p>
<p>A bare bones <em>Build.PL</em> script might look like this:</p>
<pre>
  use Module::Build;</pre>
<pre>
  Module::Build-&gt;new
      ( module_name =&gt; 'My::Module',
        license =&gt; 'perl',
      )-&gt;create_build_script;</pre>
<p>The &quot;module_name&quot; parameter is like the <code>ExtUtils::MakeMaker</code> &quot;NAME&quot;
parameter.</p>
<p>The &quot;license&quot; parameter is new with <code>Module::Build</code>, and its intended
use it allow automated tools to determine under which license your
module is distributed.</p>
<p>To determine your module's version, <code>Module::Build</code> looks in the
module specified by the &quot;module_name&quot; parameter, though this can be
overridden either by specifying a different module to look in, or by
providing the version number directly.</p>
<p>Of course, there are more options than those.  For example,
<code>Module::Build</code> implements a prerequisite feature similar to that
implemented by <code>ExtUtils::MakeMaker</code>, so we can write:</p>
<pre>
  Module::Build-&gt;new
      ( module_name =&gt; 'My::Module',
        license =&gt; 'perl',
        requires =&gt; { 'CGI' =&gt; 0,
                      'DBD::mysql' =&gt; 2.1013,
                    },
      )-&gt;create_build_script;</pre>
<p>If you have any experience with <code>ExtUtils::MakeMaker</code>, you can
probably figure out that this says that our module requires any
version of <code>CGI</code>, and version 2.1013 or greater of <code>DBD::mysql</code>.  So
far, this looks just like what <code>ExtUtils::MakeMaker</code> provides, but
<code>Module::Build</code> goes further.</p>
















<p>Consider what happens if we know that we need some piece of
functionality first present in <code>DBD::mysql</code> 2.1013.  But perhaps a
release after this, 2.1014, introduced a new bug that breaks our
application.  If this bug is fixed in version 2.1015, we <em>could</em>
simply require version 2.1015, but this is not ideal.  There's no
reason to force someone who already has 2.1013 to upgrade because of a
bug in a version they don't have.</p>
<p>Fortunately, <code>Module::Build</code> provides a more flexible version
specification option that handles exactly this situation, so we can
write:</p>
<pre>
  Module::Build-&gt;new
      ( module_name =&gt; 'My::Module',
        license =&gt; 'perl',
        requires =&gt; { 'CGI' =&gt; 0,
                      'DBD::mysql' =&gt; '&gt;= 2.1013, != 2.1014',
                    },
      )-&gt;create_build_script;</pre>
<p>This says that we need a version greater than 2.1013 that <strong>is not</strong>
version 2.1014.  Users who have version 2.1013 or version 2.1015 or
greater are not forced to upgrade, but anyone with 2.1014 will be.</p>
<p>If we knew that version 3.0 didn't work with your module, we could
change our specification:</p>
<pre>
  Module::Build-&gt;new
      ( module_name =&gt; 'My::Module',
        license =&gt; 'perl',
        requires =&gt; { 'CGI' =&gt; 0,
                      'DBD::mysql' =&gt; '&gt;= 2.1013, != 2.1014, &lt; 3.0',
                    },
      )-&gt;create_build_script;</pre>
<p>If the user does have version 3.0 or greater installed, it will at
least let them know that it won't work with our module.
Unfortunately, the only possible way to use our module at this point
is for the end user to manually downgrade their installation of
<code>DBD::mysql</code>, since Perl does not allow multiple versions of a module
to co-exist peacefully.  Still, this is better than letting the module
be installed, only to fail at runtime when it tries to use an outdated
API for <code>DBD::mysql</code>.</p>
<p>There are also other options related to prerequisites, such as
&quot;recommends&quot; and &quot;build_requires&quot;, which can be helpful for
prerequisites that are required to build the module but don't need to
be present after installation.  There is also a &quot;conflicts&quot; option
which can be used to warn a user about potential conflicts between the
module they are installing and one they already have.</p>


<h2><a name="action!">Action!</a></h2>
<p>As of release 1.15, Module::Build implements the following actions,
most of which are based on existing <code>ExtUtils::MakeMaker</code>
functionality:</p>
<ul>
<li><strong><a name="item_build">build</a></strong><br />

<p>This is the default action, and is what happens if you run <em>./Build</em>
without any additional arguments.  It is responsible for creating the
<em>blib/</em> directory and copying files into it, as well as compiling XS
and C files.  If you have any scripts like <em>lib/My/Module.pm.PL</em>,
these are also run during this action.</p></li>


<li><strong><a name="item_test%2c_testdb">test, testdb</a></strong><br />

<p>Runs the module's tests using the <code>Test::Harness</code> module.  The
&quot;testdb&quot; action can be used to run the tests under Perl's debugger.
Equivalently, a &quot;debugger&quot; parameter can be passed to the &quot;test&quot;
action to get the same effect.</p></li>


<li><strong><a name="item_clean%2c_realclean">clean, realclean</a></strong><br />

<p>Both actions delete any files created by the &quot;build&quot; action.  The
&quot;realclean&quot; action also deletes the existing <em>Build</em> script.</p></li>


<li><strong><a name="item_diff">diff</a></strong><br />

<p>This action is used to compare the files about to be installed with
any corresponding files that already exist.  This feature is unique to
<code>Module::Build</code>.</p></li>


<li><strong><a name="item_install">install</a></strong><br />

<p>Installs the module files.  As of version 0.15, this doesn't yet
create or install any man pages.</p></li>


<li><strong><a name="item_fakeinstall">fakeinstall</a></strong><br />

<p>Tells you what the &quot;install&quot; would do.</p></li>


<li><strong><a name="item_dist">dist</a></strong><br />

<p>Creates a gzip'd tarball of your distribution.</p></li>


<li><strong><a name="item_manifest">manifest</a></strong><br />

Creates a <em>MANIFEST</em> file for your distribution.</li>


<li><strong><a name="item_distcheck">distcheck</a></strong><br />

<p>Tells you what files are in the build directory but not in the
<em>MANIFEST</em> file, and vice versa.</p></li>


<li><strong><a name="item_skipcheck">skipcheck</a></strong><br />

<p>Tells you what files will not be added to the <em>MANIFEST</em> by the
&quot;manifest&quot; action, based on the contents of your <em>MANIFEST.SKIP</em>
file.</p></li>


<li><strong><a name="item_distclean">distclean</a></strong><br />

<p>This is a shortcut for &quot;realclean&quot; followed by &quot;distcheck&quot;.</p></li>


<li><strong><a name="item_distdir">distdir</a></strong><br />
<p>Creates a directory based on your distribution name and version, and
then copies all the files listed in <em>MANIFEST</em> to that directory.
This directory is what people will see when they download and unpack
your distribution.
</p>
<p><code>Module::Build</code> also creates a file called <em>META.yaml</em> which
contains meta-data about your distribution.  In the future, it may be
possible to use a command line tool (written in Perl, of course) to
read this file and use its contents to install your distribution,
without running the <em>Build.PL</em> script.  It also makes the meta-data
more readily available to tools like search.cpan.org or the CPAN
shell.</p></li>


<li><strong><a name="item_disttest">disttest</a></strong><br />

<p>This performs the &quot;distdir&quot; action, switches to the newly created
directory, and then runs <code>perl Build.PL</code>, <code>./Build</code>, and <code>./Build
test</code>.  This lets you make sure that your distribution is actually
installable.</p></li>


<li><strong><a name="item_help">help</a></strong><br />

<p>Tells you what actions are available.  If additional actions are
implemented in a distribution, then these are listed here.</p></li>

</ul>
<p>Any of these options can be overridden through straightforward
subclassing, so our <code>HTML::Mason</code> example from earlier in this article
might be written something like this:</p>
<pre>
  package MyFancyBuilder;</pre>
<pre>
  use base 'Module::Build';</pre>
<pre>
  sub ACTION_test {
      my $self = shift;</pre>
<pre>
      # %MY::APACHE is set in makeconfig.pl.</pre>
<pre>
      $ENV{PORT}             = $MY::APACHE{port}       || 8228;
      $ENV{APACHE_DIR}       = $MY::APACHE{apache_dir} || &quot;;
      $ENV{MASON_VERBOSE}  ||= $self-&gt;{properties}{verbose};
      # _is_maintainer_mode would be another method of our subclass
      $ENV{MASON_MAINTAINER} = $self-&gt;_is_maintainer_mode();</pre>
<pre>
      return $self-&gt;SUPER::ACTION_test(@_);
  }</pre>
<p>This version is actually readable, and is unlikely to break regardless
of changes in the <code>Module::Build</code> internals.  This highlights just
how difficult it was to accomplish a simple task using
<code>ExtUtils::MakeMaker</code>, and how natural the pure-Perl solution can be.</p>


<h2><a name="the_larger_picture_and_backwards_compatibility">The Larger Picture and Backwards Compatibility</a></h2>
<p>One difficulty in getting <code>Module::Build</code> into widespread use is the
fact that support for <code>ExtUtils::MakeMaker</code> is so tightly integrated
into CPAN installers.</p>
<p>While the version of <code>CPAN.pm</code> which ships with 5.8 does not know how to deal with Build.PL, the latest versoin available from CPAN does.  It will even install <code>Module::Build</code> for you.  As of January 2008, <code>CPANPLUS</code>, another CPAN shell, understands <em>Build.PL</em> but will not install <code>Module::Build</code> for you, but this will be remedied in a future release.</p>
<p>However, old versions of <code>CPAN.pm</code> are still in extremely widespread use, and users won't
necessarily upgrade <code>CPAN.pm</code> before attempting to install a
distribution that relies on <code>Module::Build</code>.</p>
















<p>There are a couple workarounds for this problem.  The simplest is to
just include a <em>Build.PL</em> script and document this in the <em>README</em>
or <em>INSTALL</em> files included with your distribution.  This has the
appeal of requiring of very little work to implement, but the downside
is that people who expect things to just work with a CPAN shell will
give up when your distribution doesn't install properly.</p>
<p>Another possibility is to create functionally equivalent <em>Build.PL</em>
and <em>Makefile.PL</em> scripts.  If you're using <code>Module::Build</code> because
you need to customize installation behavior in a way that is difficult
to do with <code>ExtUtils::MakeMaker</code>, this pretty much defeats the
purpose of using <code>Module::Build</code> at all, and in any case having two
separate pieces of code that do the same thing is always unappealing.</p>
<p>Then there's the approach which involves using a
<em>Makefile.PL</em> script that simply installs <code>Module::Build</code> if needed,
and then generates a <em>Makefile</em> that passes everything through to the
<em>./Build</em> script.  This is known as the "passthrough" method.</p>
<p>I think this approach gives the best result for the effort involved,
and is the method I prefer.  The <code>Module::Build</code> distribution
includes a <code>Module::Build::Compat</code> module, which does the dirty work needed for this approach.</p>
<p>Simply add <code>create_makefile_pl => 'passthrough'</code> to the <em>Build.PL</em> parameters and a <em>Makefile.PL</em> will be created as part of the <code>Build dist</code> process.</p>

<p>Here's an example of such a <em>Makefile.PL</em> script:</p>
<pre>
    # Note: this file was auto-generated by Module::Build::Compat version 0.03

    unless (eval "use Module::Build::Compat 0.02; 1" ) {
      print "This module requires Module::Build to install itself.\n";
      
      require ExtUtils::MakeMaker;
      my $yn = ExtUtils::MakeMaker::prompt
        ('  Install Module::Build now from CPAN?', 'y');
      
      unless ($yn =~ /^y/i) {
        die " *** Cannot install without Module::Build.  Exiting ...\n";
      }
      
      require Cwd;
      require File::Spec;
      require CPAN;
      
      # Save this 'cause CPAN will chdir all over the place.
      my $cwd = Cwd::cwd();
      
      CPAN::Shell->install('Module::Build::Compat');
      CPAN::Shell->expand("Module", "Module::Build::Compat")->uptodate
        or die "Couldn't install Module::Build, giving up.\n";
      
      chdir $cwd or die "Cannot chdir() back to $cwd: $!";
    }
    eval "use Module::Build::Compat 0.02; 1" or die $@;
    
    Module::Build::Compat->run_build_pl(args => \@ARGV);
    require Module::Build;
    Module::Build::Compat->write_makefile(build_class => 'Module::Build');
</pre>
<p>So what exactly is going on here?  A good question indeed.  Let's walk
through some of the code.</p>
<pre>
    unless (eval "use Module::Build::Compat 0.02; 1" ) {
      print "This module requires Module::Build to install itself.\n";
      
      require ExtUtils::MakeMaker;
      my $yn = ExtUtils::MakeMaker::prompt
        ('  Install Module::Build now from CPAN?', 'y');
      
      unless ($yn =~ /^y/i) {
        die " *** Cannot install without Module::Build.  Exiting ...\n";
      }
</pre>
<p>This first attempts to load version 0.02 or greater of the
<code>Module::Build::Compat</code> module.  If it isn't installed we know we
need to install <code>Module::Build</code>.  Because we're polite, we ask the
user if they would like to install <code>Module::Build</code> before going
further.  Some people dislike interactive installations, but fortunately the promp() command is pretty smart about detecting if there's a user at the end of the line.</p>
<p>Assuming that the user agrees to install <code>Module::Build</code> (if they don't the installer has to give up) this is what comes next:</p>
<pre>
      # Save this 'cause CPAN will chdir all over the place.
      my $cwd = Cwd::cwd();
      
      CPAN::Shell->install('Module::Build::Compat');
      CPAN::Shell->expand("Module", "Module::Build::Compat")->uptodate
        or die "Couldn't install Module::Build, giving up.\n";
      
      chdir $cwd or die "Cannot chdir() back to $cwd: $!";
</pre>
<p>We want to use <code>CPAN.pm</code> to actually install <code>Module::Build</code>, but we
need to first save our current directory, because <code>CPAN.pm</code> calls
<code>chdir()</code> quite a bit, and we'll need to be in the same directory as
we started in after installing <code>Module::Build</code>.</p>
<p>Then we load <code>CPAN.pm</code> and tell it to install <code>Module::Build</code>.
After that, we <code>chdir()</code> back to our original directory.</p>
<pre>
    eval "use Module::Build::Compat 0.02; 1" or die $@;
    
    Module::Build::Compat->run_build_pl(args => \@ARGV);
    require Module::Build;
    Module::Build::Compat->write_makefile(build_class => 'Module::Build');
</pre>
<p>First it checks that the <code>Module::Build</code> install worked.  Then it simply tells <code>Module::Build::Compat</code> to run the <em>Build.PL</em>
script, and to write out a &quot;passthrough&quot; <em>Makefile</em>.
<code>Module::Build::Compat</code> will attempt to convert
<code>ExtUtils::MakeMaker</code> style arguments, like &quot;PREFIX&quot;, to arguments
that <code>Module::Build</code> can understand, like "--prefix".</p>
<p>The &quot;passthrough&quot; <em>Makefile</em> that <code>Module::Build::Compat</code> generates
looks something like this:</p>
<pre>
  all :
          ./Build
  realclean :
          ./Build realclean
          rm -f \$(THISFILE)
  .DEFAULT :
          ./Build \$@
  .PHONY   : install manifest</pre>
<p>The &quot;.DEFAULT&quot; target is called when there is no matching make target
for the one given on the command line.  It uses the &quot;$@&quot; make
variable, which will contain the name of the target that was passed to
make.  So if &quot;make install&quot; is called, then &quot;$@&quot; contains &quot;install&quot;,
and it ends up running &quot;./Build install&quot;.</p>
<p>The generated Makefile also contains a comment which specifies the
module's prerequisites, because this is how <code>CPAN.pm</code> figures out
what a module's prerequisites are (scary but true).</p>
<p>This approach is the most elegant of all, but the code that translates
<code>ExtUtils::MakeMaker</code> arguments to something <code>Module::Build</code>
understands is quite minimal and won't handle all possibilities.</p>
<p>I have used this approach for one CPAN module, <code>Thesaurus.pm</code>, and in
my limited testing it did work.  If you are inclined to try installing
this module, please send bug reports to me or the <code>Module::Build</code>
users list, <code>module-build-general@lists.sf.net</code>.</p>
<p>Recently, Autrijus Tang submitted a more complex <em>Makefile.PL</em> script
which implements several pieces of additional functionality.  First of
all, it makes sure that the script is running as a user that can
actually install <code>Module::Build</code>.  Second, it prefers <code>CPANPLUS.pm</code>
to <code>CPAN.pm</code>.</p>
<p>Autrijus' script looks promising, but since it hasn't yet been tested,
I've chosen not to include it here.  It's quite likely that some
version of his script will be documented in future versions of
<code>Module::Build</code></p>


<h2><a name="custom_behavior">Custom Behavior</a></h2>
<p>As was hinted at earlier, you can directly subclass <code>Module::Build</code>
in order to implement custom behavior.  This is a big topic unto
itself, and will be the topic of a future article here on perl.com.</p>


<h2><a name="the_future">The Future</a></h2>
<p>There is plenty of work left to be done on <code>Module::Build</code>.  Off the
top of my head, here are some things that still need to be done:</p>
<p>
The installation phase does not yet create man pages based on POD
included in the distribution.
</p>


<p>
<code>Module::Build</code> needs to implement a &quot;local install&quot; feature like the
one provided by the <code>ExtUtils::MakeMaker</code> &quot;PREFIX&quot; argument.  The
logic that implements this in <code>ExtUtils::MakeMaker</code> is Byzantine, but
only because doing this correctly is quite complicated.  This logic
needs to be implemented for <code>Module::Build</code> as well.
</p>


<p>
<code>Module::Build</code> needs better backwards compatibility with
<code>ExtUtils::MakeMaker</code>.  The argument translation in
<code>Module::Build::Compat</code> is currently just a placeholder.  Things like
&quot;PREFIX&quot;, &quot;LIB&quot;, and &quot;UNINST=1&quot; all need to be translated by
<code>Module::Build::Compat</code>, and the equivalent functionality needs to be
implemented for <code>Module::Build</code>
</p>

<p>
<code>CPANPLUS.pm</code> could take advantage of more <code>Module::Build</code> features.
For example, it currently ignores the &quot;conflict&quot; information that
<code>Module::Build</code> makes available, and it doesn't attempt to
distinguish between &quot;build_requires&quot;, &quot;requires&quot;, or &quot;recommends&quot;.
</p>

<p>Some of what <code>Module::Build</code> provides is intended for use by external
tools, such as the meta-data provided by the <em>META.yaml</em> file.
<code>CPANPLUS.pm</code> could use this to avoid having to run the <em>Build.PL</em>
and <em>Build</em> scripts, thus avoiding the need to install any of the
&quot;build_requires&quot; modules.  Package managers like <code>rpm</code> or the Debian
tools could also use it to construct installable packages for Perl
modules more easily.</p>


<p>
Adding at least basic support for <code>Module::Build</code> to <code>CPAN.pm</code> would
be nice.  If anyone is interested in pursuing this, I have an old
patch that may provide a decent start on this.  Contact me if you're
interested.
</p>

<h2><a name="more_information">More Information</a></h2>
<p>If you want to learn more about <code>Module::Build</code>, the first thing you
should do is install it (it will install itself just fine under
<code>CPAN.pm</code>) and read the docs for the <code>Module::Build</code> and
<code>Module::Build::Compat</code> modules.  There is a project on SourceForge
for <code>Module::Build</code> at
<a href="http://www.sourceforge.net/projects/module-build.">http://www.sourceforge.net/projects/module-build.</a>  The source is in
CVS on SourceForge, and is accessible via anonymous CVS and and
online.</p>
<p>Finally, if you're interested in using or helping to develop
<code>Module::Build</code>, please sign up on the
<a href="mailto:module-build-general@lists.sf.net">module-build-general@lists.sf.net</a> email list.  See
<a href="http://lists.sourceforge.net/lists/listinfo/module-build-general">http://lists.sourceforge.net/lists/listinfo/module-build-general</a> for
more details.</p>


<h2><a name="thanks">Thanks</a></h2>
<p>Thanks to Ken Williams for reviewing this article before publication,
and for writing <code>Module::Build</code>.</p>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1076" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/02/p6pdigest/20030209.html" rel="bookmark">This week on Perl 6, week ending 2003-02-09</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-02-09T00:00:00-08:00">February  9, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Welcome to the latest Perl 6 summary, your handy cut out and keep
guide to the goings on in the crazy world of Perl 6 design and
development.</p>
<p>It's been a rather quiet week this week; only 75 messages in
perl6-internals and a mere 57 in perl6-language. So, at least it's
palindromic.</p>
<p>We start off, as is traditional, with perl6-internals</p>

<h4><a name="the_2004_performance_challenge">The 2004 Performance challenge</a></h4>
<p>Dan announced that he'd made a bet with Guido van Rossum that Parrot
would be faster at executing a pure python benchmark of some sort to
be determined. The details of the challenge will be announced at OSCON
2003 and the results at OSCON 2004. Dan stands to lose $10 and a round
of beer for the Zope/Pythonlabs folks. (Dunno how many of them there
are though...). We don't know what he stands to win yet, but I'd hope
'beers from each of the Zope/Pythonlabs folks' are included.</p>
<p>For some reason nobody commented on this.</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f10ba646b93a1c0%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>

<h4><a name="more_parrot_objects">More Parrot Objects</a></h4>
<p>Jerome Quelin wondered how Parrot objects would handle property
inheritance. Dan pointed out that properties don't get inherited and
Jerome realised he meant to ask about attribute
inheritance. Attributes <em>are</em> inherited but are mostly invisible to
any methods but the methods of the class that defines the attributes
(though they will be accessible (presumably through reflection)).</p>
<p>In another subthread, we got confused by multimethods.</p>
<p><a href="http://groups.google.com/groups?threadm=200302032039.05913.jquelin%40mongueurs.net">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20030203213750.GB280%40Bagpuss.unfortu.net">http://groups.google.com/groups</a> -- Multimethods</p>

<h4><a name="bytecode_metadata">Bytecode Metadata</a></h4>
<p>James Michael DuPont wanted to know what had been decided about
Bytecode metadata and outlined the things that he'd like to know about
a given bytecode. Leo T&ouml;tsch reckoned that what James wanted was
either in the bytecode right now, or was handleable by the framework
that was in place. He pointed James to <em>docs/parrotbyte.pod</em> in the
Parrot distribution.</p>
<p>Further discussions centred on the <em>amount</em> of metadata and whether
this would affect loading speed and efficiency, or get in the way of
the desired 'mmap and go' principle. Gregor N. Purdy 
pointed out that we also had to be capable of passing meta data from a
compiler 'through' IMCC and on to the final bytecode. There was also a
touching reunion between James Michael DuPont and Gopal V. Ah...</p>
<p><a href="http://groups.google.com/groups?threadm=20030204090618.46313.qmail%40web41506.mail.yahoo.com">http://groups.google.com/groups</a></p>

<h4><a name="multi_programming_language_questions">Multi programming language questions</a></h4>
<p>Phil Hassey has been lurking, fascinated on the internals list for a
couple of months. This week he broke the silence by asking a couple of
questions about cross language function dispatch, string compatibility
and global scopes. For instance, PHP, Common Lisp and others are case
insensitive about functions. Which is okay when you're calling such a
function from a case sensitive language, but can be tricky if you call
out from a case insensitive to a case sensitive language. Dan thought
that there wasn't going to be much that could be done about this
problem (at least, not transparently) but seems to think that the
other issues raised shouldn't be too problematic.</p>
<p><a href="http://groups.google.com/groups?threadm=E18g57v-0005uW-00%40blackseaii.trouble-free.net">http://groups.google.com/groups</a></p>

<h4><a name="random_questions">Random questions</a></h4>
<p>David popped up and, after remarking on the amount of progress Parrot
had made since he last looked at it, had a few questions about various
bits and pieces. Leo and Dan provided a bunch of good answers.</p>
<p><a href="http://groups.google.com/groups?threadm=200302050152.34580.dcuny%40lanset.com">http://groups.google.com/groups</a></p>

<h4><a name="a_scheme_for_extending_core.ops">A Scheme for extending core.ops</a></h4>
<p>Leo T&ouml;tsch seems to have got bored of 'just' being the Patch
Monster and has been producing some discussion documents proposing all
sorts of useful tricks for improving the design/speed/extensibility of
Parrot's internals. This week he turned his attention to
<em>core.ops</em>. His plan involves a way of reducing the size of core_ops,
improving cache locality and generally solving a raft of problems I
didn't even know Parrot had. His new scheme allows for a small
<em>core.ops</em>, easy extension and no execution speed penalty for non
core ops. As is usual with Leo's stuff, the scheme came with
code. Gregor had a bunch of observations and suggestions and he and
Leo thrashed out a slightly modified scheme for going forward.</p>
<p><a href="http://groups.google.com/groups?threadm=3E40F555.90002%40toetsch.at">http://groups.google.com/groups</a></p>

<h4><a name="week_of_the_alternative_runloops">Week of the alternative runloops</a></h4>
<p>Leo T&ouml; offered a couple of different core runloops this
week. First up was the Computed Goto Prederefed (CGP) runloop which,
essentially combined a two runloop optimization techniques to provide
what can only be described as massive speedups. The -O3 compiled
version ran parrot_mops 6 times faster than the basic 'fast_core' and
more than 3 times faster than the previous fastest core. People were
impressed.</p>
<p>A few days later, Leo reached into his bag of tricks and pulled out
the CSwitch runloop that did predereferenced dispatch via a big C
switch statement. This loop is about 50% faster than the basic
fast_core loop, but slower than all the computed goto dispatched
loops. At this point Jason Gloudon pointed out that predereferencing
can cause problems in a multi threaded environment.</p>
<p>Quote of the Parrot development process so far:</p>
<p>``I'm a really bad C programmer'' -- Leo T&ouml;tsch</p>
<p><a href="http://groups.google.com/groups?threadm=3E425716.1000608%40toetsch.at">http://groups.google.com/groups</a></p>
<p>And that about wraps it up for perl6-internals this week. Dan's been
busy in Sebastapol with the Perl 6 Cabal thrashing out the design of
Perl 6 functions and other bits with Larry, Damian, Allison and
chromatic, which probably explains why he's not been driving the
mailing list for the week.</p>



<h3><a name="meanwhile_in_perl6language">Meanwhile in perl6-language</a></h3>
<p>It's been even quieter on the language list. Mostly interesting
though.</p>

<h4><a name="shortcut_=">Shortcut <code>?=</code></a></h4>
<p>Miko O'Sullivan proposed a new assignment operator, <code>$var ?= $x :
$y</code>, equivalent to <code>$var = $var ? $x : $y</code>. It was pointed out that,
for correctness that should be <code>??=</code>. Deborah Ariel Pickett wondered
what was the need for such an operator and couldn't imagine ever
needing such an operator.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.NEB.4.44.0302022035580.4069-100000%40canolog.ninthwonder.com">http://groups.google.com/groups</a></p>

<h4><a name="language_discussion_summaries">Language Discussion Summaries</a></h4>
<p>Miko O'Sullivan proposed that members of the language list provide
summaries of the discussions in the group [What's this? Chopped liver?
-- Ed]. The idea being that each summary would describe a proposed
idea and then summarizes the list's feelings on the idea, and would be
posted on a website. The idea was basically well received, then the
list fell to quibbling about format, whether summaries should be
posted to the list where they could be picked up by the list
summarizer, and whether we were just reinventing RFCs all over again.</p>
<p>As of now, the only summary that actually exists is Miko's summary of
the proposed <code>??=</code> operator. Which I hadn't even bothered to read
until I came to write the summary.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.NEB.4.44.0302031549260.8402-100000%40canolog.ninthwonder.com">http://groups.google.com/groups</a></p>
<p><a href="http://www.idocs.com/perl6/">http://www.idocs.com/perl6/</a> -- Summaries website</p>

<h4><a name="newline_as_a_statement_terminator">Newline as a statement terminator</a></h4>
<p>St&eacute;phane Payrard confessed that he would like newline to be a
statement terminator everywhere it can be. Everybody hated it. Deborah
Ariel Pickett came up with a neat example of why it was a really bad
idea with a simple ambiguous piece of code:</p>
<pre>
  sub foo 
  {
  print &quot;abcde&quot;
  if $condition
  {
  print &quot;fghij&quot;
  }
  }</pre>
<p>which could mean either:</p>
<pre>
  sub foo {
    print &quot;abcdef&quot; if $condition;
    
    return sub {
      print &quot;fghij&quot;;
    }
  }</pre>
<p>Or</p>
<pre>
  sub foo {
    print &quot;abcde&quot;;
    if $condition {
      print &quot;fghij&quot;;
    }
  }</pre>
<p>And disambiguating with indentation is way too Pythonesque for many.</p>
<p><a href="http://groups.google.com/groups?threadm=20030204005700.GC4054%40stefp.dyndns.org">http://groups.google.com/groups</a></p>

<h4><a name="arrays_vs._lists">Arrays vs. Lists</a></h4>
<p>In his quest to exhaustively document what is known about Perl so far,
Michael Lazzaro asked for a definitive answer to the question ``What's
the difference between an array and a list in Perl 6''?</p>
<p>Various answers were given but I think Uri Guttman came up with the
most succinct pair of definitions, which reduce to 'lists are read
only, arrays are read/write'. (That's the data structure itself, not
the data structure's contents, <code>($a, $b) = (1, 2)</code> doesn't modify
either list, but it does modify the lvalues in the left hand list).</p>
<p><a href="http://groups.google.com/groups?threadm=55EBD48C-3ACD-11D7-B6E4-00050245244A%40cognitivity.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=x7n0l7fypv.fsf%40mail.sysarch.com">http://groups.google.com/groups</a> -- Uri's definitions</p>



<h3><a name="announcements,_acknowledgements_and_trip_planning">Announcements, Acknowledgements and Trip Planning</a></h3>
<p>This week's summary was prepared in the comfy chair with distractions
from cats, irc, former employers, bugs and poring over maps of the
Eastern Seaboard.</p>
<p>We're coming to America. This year, making a virtue out of a necessity
we're going to give ourselves a good long holiday in the States. We'll
be flying out to Boca Raton for YAPC, then taking a road trip up
through the Appalachians to New England, possibly swinging into Canada
before coming down through Michigan to Chicago and taking a slow train
to Portland, OR for The Perl Conference. If it looks like you might be
on our route, drop me a line...</p>
<p>Proofreading services were provided by Aspell and me. (I could lie and
say that they were provided by Leon Brocard, enabling me to work his
name into the summary somehow, but I think I'll do it in a
parenthetical comment instead.)</p>
<p>If you appreciated this summary, please consider one or more of the
following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.</li>

<li>
Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>

<li>
Send feedback, flames, money, job offers or the secret of eternal
immaturity to <em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em></li>
</ul>
<p>This week's summary was sponsored by Darren Duncan. Thanks Darren. If
you'd like to become a summary sponsor, drop me a line at
<em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em>.</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1066" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/02/05/mod_perl.html" rel="bookmark">Improving mod_perl Sites' Performance: Part 7</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Stas Bekman</span> on <abbr class="published" title="2003-02-05T00:00:00-08:00">February  5, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
             
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Correct configuration of the <code>MinSpareServers</code>, <code>MaxSpareServers</code>,
<code>StartServers</code>, <code>MaxClients</code>, and <code>MaxRequestsPerChild</code> parameters
is very important.  There are no defaults.  If they are too low, then you
will underutilize the system's capabilities.  If they are too high, then
chances are that the server will bring the machine to its knees.</p>

<p>All the above parameters should be specified on the basis of the
resources you have.  With a plain Apache server, it's no big deal if
you run many servers since the processes are about 1Mb and don't eat a
lot of your RAM.  Generally, the numbers are even smaller with memory
sharing.  The situation is different with mod_perl.  I have seen
mod_perl processes of 20Mb and more.  Now, if you have <code>MaxClients</code>
set to 50, then 50x20Mb = 1Gb. Maybe you don't have 1Gb of RAM - so how
do you tune the parameters?  Generally, by trying different
combinations and benchmarking the server.  Again, mod_perl processes
can be made much smaller when memory is shared.</p>

<csperl file="grab" domain="on" record="b/832" template="article_sidebar.view">

<p>Before you start this task, you should be armed with the proper weapon.
You need the <strong>crashme</strong> utility, which will load your server with the
mod_perl scripts you possess.  You need it to have the ability to
emulate a multiuser environment and to emulate the behavior of
multiple clients calling the mod_perl scripts on your server
simultaneously.  While there are commercial solutions, you can get
away with free ones that do the same job.  You can use the
ApacheBench utility that comes with the Apache distribution, the
<code>crashme</code> script which uses <code>LWP::Parallel::UserAgent</code>, httperf or
http_load all discussed in one of the previous articles.</p>

<p>It is important to make sure that you run the load generator (the
client which generates the test requests) on a system that is more
powerful than the system being tested.  After all, we are trying to
simulate Internet users, where many users are trying to reach your
service at once.  Since the number of concurrent users can be quite
large, your testing machine must be very powerful and capable of
generating a heavy load.  Of course, you should not run the clients and
the server on the same machine.  If you do, then your test results would be
invalid.  Clients will eat CPU and memory that should be dedicated to
the server, and vice versa.</p>

<h3><a name="configuration_tuning_with_apachebench">Configuration Tuning with ApacheBench</a></h3>
<p>I'm going to use the <code>ApacheBench</code> (<code>ab</code>) utility to tune our server's
configuration. We will simulate 10 users concurrently requesting a
very light script at <code>http://www.example.com/perl/access/access.cgi</code>.
Each simulated user makes 10 requests.</p>
<pre><code>
  % ./ab -n 100 -c 10 http://www.example.com/perl/access/access.cgi</code></pre>
<p>The results are:</p>
<pre><code>
  Document Path:          /perl/access/access.cgi
  Document Length:        16 bytes
  
  Concurrency Level:      10
  Time taken for tests:   1.683 seconds
  Complete requests:      100
  Failed requests:        0
  Total transferred:      16100 bytes
  HTML transferred:       1600 bytes
  Requests per second:    59.42
  Transfer rate:          9.57 kb/s received
  
  Connnection Times (ms)
                min   avg   max
  Connect:        0    29   101
  Processing:    77   124  1259
  Total:         77   153  1360</code></pre>
<p>The only numbers we really care about are:</p>
<pre><code>
  Complete requests:      100
  Failed requests:        0
  Requests per second:    59.42</code></pre>
<p>Let's raise the request load to 100 x 10 (10 users, each making 100
requests):</p>
<pre><code>
  % ./ab -n 1000 -c 10  http://www.example.com/perl/access/access.cgi
  Concurrency Level:      10
  Complete requests:      1000
  Failed requests:        0
  Requests per second:    139.76</code></pre>
<p>As expected, nothing changes -- we have the same 10 concurrent users.
Now let's raise the number of concurrent users to 50:</p>
<pre><code>
  % ./ab -n 1000 -c 50  http://www.example.com/perl/access/access.cgi
  Complete requests:      1000
  Failed requests:        0
  Requests per second:    133.01</code></pre>
<p>We see that the server is capable of serving 50 concurrent users at
133 requests per second!  Let's find the upper limit.  Using <code>-n
10000 -c 1000</code> failed to get results (Broken Pipe?).  Using <code>-n 10000
-c 500</code> resulted in 94.82 requests per second.  The server's
performance went down with the high load.</p>

<p>The above tests were performed with the following configuration:</p>
<pre><code>
  MinSpareServers 8
  MaxSpareServers 6
  StartServers 10
  MaxClients 50
  MaxRequestsPerChild 1500</code></pre>
<p>Now let's kill each child after it serves a single request.  We will
use the following configuration:</p>
<pre><code>
  MinSpareServers 8
  MaxSpareServers 6
  StartServers 10
  MaxClients 100
  MaxRequestsPerChild 1</code></pre>
<p>Simulate 50 users each generating a total of 20 requests:</p>
<pre><code>
  % ./ab -n 1000 -c 50  http://www.example.com/perl/access/access.cgi</code></pre>
<p>The benchmark timed out with the above configuration. I watched the
output of <strong><code>ps</code></strong> as I ran it, the parent process just wasn't capable
of respawning the killed children at that rate.  When I raised the
<code>MaxRequestsPerChild</code> to 10, I got 8.34 requests per second.  Very
bad - 18 times slower!  You can't benchmark the importance of the
<code>MinSpareServers</code>, <code>MaxSpareServers</code> and <code>StartServers</code> with this
type of test.</p>

<p>Now let's reset <code>MaxRequestsPerChild</code> to 1500, but reduce
<code>MaxClients</code> to 10 and run the same test:</p>
<pre><code>
  MinSpareServers 8
  MaxSpareServers 6
  StartServers 10
  MaxClients 10
  MaxRequestsPerChild 1500</code></pre>
<p>I got 27.12 requests per second, which is better but still four to five times
slower.  (I got 133 with <code>MaxClients</code> set to 50.)</p>

<p><strong>Summary:</strong> I have tested a few combinations of the server
configuration variables (<code>MinSpareServers</code>, <code>MaxSpareServers</code>,
<code>StartServers</code>, <code>MaxClients</code> and <code>MaxRequestsPerChild</code>).  The
results I got are as follows:</p>

<p><code>MinSpareServers</code>, <code>MaxSpareServers</code> and <code>StartServers</code> are only
important for user response times.  Sometimes users will have to wait a
bit.</p>

<p>The important parameters are <code>MaxClients</code> and <code>MaxRequestsPerChild</code>.
<code>MaxClients</code> should be not too big, so it will not abuse your
machine's memory resources, and not too small, for if it is, your users
will be forced to wait for the children to become free to serve them.
<code>MaxRequestsPerChild</code> should be as large as possible, to get the full
benefit of mod_perl, but watch your server at the beginning to make
sure your scripts are not leaking memory, thereby causing your server
(and your service) to die very fast.</p>

<p>Also, it is important to understand that we didn't test the response
times in the tests above, but the ability of the server to respond
under a heavy load of requests. If the test script was heavier, then the
numbers would be different but the conclusions similar.</p>

<p>The benchmarks were run with:</p>
<ul>
  <li>HW: RS6000, 1Gb RAM</li>
  <li>SW: AIX 4.1.5 . mod_perl 1.16, apache 1.3.3</li>
  <li>Machine running only mysql, httpd docs and mod_perl servers.</li>
  <li>Machine was _completely_ unloaded during the
  benchmarking.</li></ul>
<p>After each server restart when I changed the server's configuration, I
made sure that the scripts were preloaded by fetching a script at
least once for every child.</p>

<p>It is important to notice that none of the requests timed out, even if
it was kept in the server's queue for more than a minute!  That is the
way <strong>ab</strong> works, which is OK for testing purposes but will be
unacceptable in the real world - users will not wait for more than
five to 10 seconds for a request to complete, and the client
(i.e. the browser) will time out in a few minutes.</p>

<p>Now let's take a look at some real code whose execution time is more
than a few milliseconds.  We will do some real testing and collect the
data into tables for easier viewing.</p>

<p>I will use the following abbreviations:</p>
<pre><code>
  NR    = Total Number of Request
  NC    = Concurrency
  MC    = MaxClients
  MRPC  = MaxRequestsPerChild
  RPS   = Requests per second</code></pre>
<p>Running a mod_perl script with lots of mysql queries (the script under
test is mysqld limited)
(http://www.example.com/perl/access/access.cgi?do_sub=query_form),
with the configuration:</p>
<pre><code>
  MinSpareServers        8
  MaxSpareServers       16
  StartServers          10
  MaxClients            50
  MaxRequestsPerChild 5000</code></pre>
<p>gives us:</p>
<pre><code>
     NR   NC    RPS     comment
  ------------------------------------------------
     10   10    3.33    # not a reliable figure
    100   10    3.94    
   1000   10    4.62    
   1000   50    4.09</code></pre>
<p><strong>Conclusions:</strong> Here I wanted to show that when the application is
slow (not due to perl loading, code compilation and execution, but
limited by some external operation) it almost does not matter what
load we place on the server.  The RPS (Requests per second) is almost
the same.  Given that all the requests have been served, you have the
ability to queue the clients, but be aware that anything that goes
into the queue means a waiting client and a client (browser) that
might time out!</p>
















<p>Now we will benchmark the same script without using the mysql (code
limited by perl only):
(http://www.example.com/perl/access/access.cgi), it's the same
script but it just returns the HTML form, without making SQL queries.</p>
<pre><code>
  MinSpareServers        8
  MaxSpareServers       16
  StartServers          10
  MaxClients            50
  MaxRequestsPerChild 5000

     NR   NC      RPS   comment
  ------------------------------------------------
     10   10    26.95   # not a reliable figure
    100   10    30.88   
   1000   10    29.31
   1000   50    28.01
   1000  100    29.74
  10000  200    24.92
 100000  400    24.95</code></pre>
<p><strong>Conclusions:</strong> This time the script we executed was pure perl (not
limited by I/O or mysql), so we see that the server serves the
requests much faster.  You can see the number of requests per second
is almost the same for any load, but goes lower when the number of
concurrent clients goes beyond <code>MaxClients</code>.  With 25 RPS, the
machine simulating a load of 400 concurrent clients will be served in
16 seconds.  To be more realistic, assuming a maximum of 100
concurrent clients and 30 requests per second, the client will be
served in 3.5 seconds.  Pretty good for a highly loaded server.</p>

<p>Now we will use the server to its full capacity, by keeping all
<code>MaxClients</code> clients alive all the time and having a big
<code>MaxRequestsPerChild</code>, so that no child will be killed during the
benchmarking.</p>
<pre><code>
  MinSpareServers       50
  MaxSpareServers       50
  StartServers          50
  MaxClients            50
  MaxRequestsPerChild 5000
  
     NR   NC      RPS   comment
  ------------------------------------------------
    100   10    32.05
   1000   10    33.14
   1000   50    33.17
   1000  100    31.72
  10000  200    31.60</code></pre>
<p>Conclusion: In this scenario, there is no overhead involving the parent
server loading new children, all the servers are available, and the
only bottleneck is contention for the CPU.</p>

<p>Now we will change <code>MaxClients</code> and watch the results: Let's reduce
<code>MaxClients</code> to 10.</p>
<pre><code>
  MinSpareServers        8
  MaxSpareServers       10
  StartServers          10
  MaxClients            10
  MaxRequestsPerChild 5000
  
     NR   NC      RPS   comment
  ------------------------------------------------
     10   10    23.87   # not a reliable figure
    100   10    32.64 
   1000   10    32.82
   1000   50    30.43
   1000  100    25.68
   1000  500    26.95
   2000  500    32.53</code></pre>
<p><strong>Conclusions:</strong> Very little difference!  Ten servers were able to
serve almost with the same throughput as 50.  Why?  My guess
is because of CPU throttling.  It seems that 10 servers were serving
requests five times faster than when we worked with 50 servers.  In that
case, each child received its CPU time slice five times less
frequently.  So having a big value for <code>MaxClients</code>, doesn't mean
that the performance will be better.  You have just seen the numbers!</p>

<p>Now we will start drastically to reduce <code>MaxRequestsPerChild</code>:</p>
<pre><code>
  MinSpareServers        8
  MaxSpareServers       16
  StartServers          10
  MaxClients            50

     NR   NC    MRPC     RPS    comment
  ------------------------------------------------
    100   10      10    5.77 
    100   10       5    3.32
   1000   50      20    8.92
   1000   50      10    5.47
   1000   50       5    2.83
   1000  100      10    6.51</code></pre>
<p><strong>Conclusions:</strong> When we drastically reduce <code>MaxRequestsPerChild</code>, the
performance starts to become closer to plain mod_cgi.</p>

<p>Here are the numbers of this run with mod_cgi, for comparison:</p>
<pre><code>
  MinSpareServers        8
  MaxSpareServers       16
  StartServers          10
  MaxClients            50
  
     NR   NC    RPS     comment
  ------------------------------------------------
    100   10    1.12
   1000   50    1.14
   1000  100    1.13</code></pre>
<p><strong>Conclusion</strong>: mod_cgi is much slower. :) In the first test, when
NR/NC was 100/10, mod_cgi was capable of 1.12 requests per second.  In
the same circumstances, mod_perl was capable of 32 requests per
second, nearly 30 times faster!  In the first test, each client waited
about 100 seconds to be served.  In the second and third tests, they
waited 1,000 seconds!</p>

<h3><a name="choosing_maxclients">Choosing MaxClients</a></h3>
<p>The <code>MaxClients</code> directive sets the limit on the number of
simultaneous requests that can be supported.  No more than this number
of child server processes will be created.  To configure more than 256
clients, you must edit the <code>HARD_SERVER_LIMIT</code> entry in <code>httpd.h</code>
and recompile.  In our case, we want this variable to be as small as
possible, so we can limit the resources used by the
server children.  Since we can restrict each child's process size with
<code>Apache::SizeLimit</code> or <code>Apache::GTopLimit</code>, the calculation of
<code>MaxClients</code> is pretty straightforward:</p>
<pre><code>
               Total RAM Dedicated to the Webserver
  MaxClients = ------------------------------------
                     MAX child's process size</code></pre>
<p>So if I have 400Mb left for the Web server to run with, then I can set
<code>MaxClients</code> to be of 40 if I know that each child is limited to 10Mb
of memory (e.g. with <code>Apache::SizeLimit</code>).</p>

<p>You will be wondering what will happen to your server if there are
more concurrent users than <code>MaxClients</code> at any time.  This situation
is signified by the following warning message in the <code>error_log</code>:</p>
<pre><code>
  [Sun Jan 24 12:05:32 1999] [error] server reached MaxClients setting,
  consider raising the MaxClients setting</code></pre>
<p>There is no problem -- any connection attempts over the <code>MaxClients</code>
limit will normally be queued, up to a number based on the
<code>ListenBacklog</code> directive.  When a child process is freed at the end
of a different request, the connection will be served.</p>

<p>It <strong>is an error</strong> because clients are being put in the queue rather
than getting served immediately, despite the fact that they do not get
an error response.  The error can be allowed to persist to balance
available system resources and response time, but sooner or later you
will need to get more RAM so you can start more child processes.  The
best approach is to try not to have this condition reached at all, and
if you reach it often you should start to worry about it.</p>

<p>It's important to understand how much real memory a child occupies.
Your children can share memory between them when the OS supports that.
You must take action to allow the sharing to happen. We have
disscussed this in one of the previous article whose main topic was
shared memory. If you do this, then chances are that your <code>MaxClients</code>
can be even higher.  But it seems that it's not so simple to calculate
the absolute number.  If you come up with a solution, then please let us
know!  If the shared memory was of the same size throughout the
child's life, then we could derive a much better formula:</p>
<pre><code>
               Total_RAM + Shared_RAM_per_Child * (MaxClients - 1)
  MaxClients = ---------------------------------------------------
                              Max_Process_Size</code></pre>
<p>which is:</p>
<pre><code>
                    Total_RAM - Shared_RAM_per_Child
  MaxClients = ---------------------------------------
               Max_Process_Size - Shared_RAM_per_Child</code></pre>
<p>Let's roll some calculations:</p>
<pre><code>
  Total_RAM            = 500Mb
  Max_Process_Size     =  10Mb
  Shared_RAM_per_Child =   4Mb

              500 - 4
 MaxClients = --------- = 82
               10 - 4</code></pre>
<p>With no sharing in place</p>
<pre><code>
                 500
 MaxClients = --------- = 50
                 10</code></pre>
<p>With sharing in place you can have 64 percent more servers without buying
more RAM.</p>

<p>If you improve sharing and keep the sharing level, let's say:</p>
<pre><code>
  Total_RAM            = 500Mb
  Max_Process_Size     =  10Mb
  Shared_RAM_per_Child =   8Mb

              500 - 8
 MaxClients = --------- = 246
               10 - 8</code></pre>
<p>392 percent more servers! Now you can feel the importance of having as much
shared memory as possible.</p>

<h3><a name="choosing_maxrequestsperchild">Choosing MaxRequestsPerChild</a></h3>
<p>The <code>MaxRequestsPerChild</code> directive sets the limit on the number of
requests that an individual child server process will handle.  After
<code>MaxRequestsPerChild</code> requests, the child process will die.  If
<code>MaxRequestsPerChild</code> is 0, then the process will live forever.</p>

<p>Setting <code>MaxRequestsPerChild</code> to a non-zero limit solves some memory
leakage problems caused by sloppy programming practices, whereas a
child process consumes more memory after each request.</p>

<p>If left unbounded, then after a certain number of requests the
children will use up all the available memory and leave the server to
die from memory starvation.  Note that sometimes standard system
libraries leak memory too, especially on OSes with bad memory
management (e.g. Solaris 2.5 on x86 arch).</p>

<p>If this is your case, then you can set <code>MaxRequestsPerChild</code> to a small
number.  This will allow the system to reclaim the memory that a
greedy child process consumed, when it exits after
<code>MaxRequestsPerChild</code> requests.</p>

<p>But beware -- if you set this number too low, you will lose some of
the speed bonus you get from mod_perl.  Consider using
<code>Apache::PerlRun</code> if this is the case.</p>

<p>Another approach is to use the <code>Apache::SizeLimit</code> or the
<code>Apache::GTopLimit</code> modules.  By using either of these modules you
should be able to discontinue using the <code>MaxRequestPerChild</code>,
although for some developers, using both in combination does the
job. In addition the latter module allows you to kill any servers
whose shared memory size drops below a specified limit.</p>

<h1><a name="references">References</a></h1>
<ul>
<li>
The mod_perl site's URL: <a href="http://perl.apache.org/">http://perl.apache.org/</a></li>

<li>
<code>Apache::GTopLimit</code>
<a href="http://search.cpan.org/search?dist=Apache-GTopLimit">http://search.cpan.org/search?dist=Apache-GTopLimit</a></li>
</ul>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1074" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/02/p6pdigest/20030202.html" rel="bookmark">This week on Perl 6, week ending 2003-02-02</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-02-02T00:00:00-08:00">February  2, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->


<h4><a name="parrot_objects_(noun,_not_verb)">Parrot Objects (noun, not verb)</a></h4>
<p>Piers Cawley worried about class private attributes and asked it it
was still going to be possible to write an object serializing tool
that wouldn't require tons of Perl class overloads. Dan said that it
should still be possible.</p>
<p><a href="http://groups.google.com/groups?threadm=m265saajxu.fsf%40TiBook.bofh.org.uk">http://groups.google.com/groups</a></p>


<h4><a name="the_packfile_patches,_an_ongoing_saga.">The packfile patches, an ongoing saga.</a></h4>
<p>Leo T&ouml;tsch spent the week working on the packfile format and
Parrot's tools for manipulating it. Various internals folks provided
feedback, pointers to standards and other handy feedback.</p>
<p><a href="http://groups.google.com/groups?threadm=3E3566AC.2070004%40toetsch.at">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=3E364AE3.6050204%40toetsch.at">http://groups.google.com/groups</a></p>
<p><a href="http://rt.perl.org/rt2/Ticket/Display.html?id=20584">http://rt.perl.org/rt2/Ticket/Display.html</a></p>
<p><a href="http://rt.perl.org/rt2/Ticket/Display.html?id=20597">http://rt.perl.org/rt2/Ticket/Display.html</a></p>


<h4><a name="securing_parrot_asm">Securing Parrot ASM</a></h4>
<p>Thomas Whateley has been thinking about how to allow Parrot to run
untrusted code in a sandbox, and proposed a system where code would
provide a list of required rights and Parrot would guarantee that only
those privileges were provided. Matthew Byng-Maddick pointed everyone
at the RFC he'd written along these lines and raised the issue of what
happens when you call out to a module that's written natively, which
he described a 'brick wall'. Others were less sure that this was a
showstopper.</p>
<p>Somewhat annoyingly my mailer seems to have had a bad moment and lost
some messages, including one from Dan in which he outlined his vision
for 'safe mode' and gave some pointers to the VMS docs in this area.</p>
<p><a href="http://groups.google.com/groups?threadm=20030128114114.A6158%40luminous.whateley.net">http://groups.google.com/groups</a></p>
<p><a href="http://dev.perl.org/rfc/353.pod">http://dev.perl.org/rfc/353.pod</a></p>
<p><a href="http://groups.google.com/groups?threadm=a05200f2cba5c7b409182%40%5B192.168.2.1%5D">http://groups.google.com/groups</a> -- Dan's outline</p>


<h4><a name="parrot_developer_world_map">Parrot Developer World Map</a></h4>
<p>Leon Brocard announced the Parrot Developer World Map, which plots the
locations of all the Parrot developers who sent him their location
details on a map of the world. A cursory glance at the map would seem
to imply that a good place for a Parrot Developers' face to face
meeting would be a Caribbean island. Gregor neatly one upped Leon with
his interactive SVG version.</p>
<p><a href="http://www.astray.com/parrot/worldmap/">http://www.astray.com/parrot/worldmap/</a></p>
<p><a href="http://www.focusresearch.com/gregor/map.html">http://www.focusresearch.com/gregor/map.html</a></p>


<h4><a name="coroutine_context_patch">Coroutine context patch</a></h4>
<p>Jonathan Sillito found some problems with the coroutine code, so he
wrote a test exposing the errors, patched things to fix the errors and
added a documentation patch to be on the safe side. Go Jonathan. Steve
Fink applied the patches. Jonathan also had a question about naming,
and wondered if anyone would be interested in a howto for compiler
writers. Nobody commented on this, but the howto sounds like a great
idea to me.</p>
<p><a href="http://groups.google.com/groups?threadm=rt-20592-49853.5.33372735119841%40bugs6.perl.org">http://groups.google.com/groups</a></p>


<h4><a name="multiple_code_segments_and_the_interpreter">Multiple code segments and the interpreter</a></h4>
<p>Leo T&ouml;tsch noted some problems with <code>interpreter-&gt;code</code> and
multiple code segments, suggested a way forward and asked for
comments. Nicholas Clark commented, wondering about the potential for
memory leaks but Leo seemed to think that that was covered.</p>
<p><a href="http://groups.google.com/groups?threadm=3E37D321.80108%40toetsch.at">http://groups.google.com/groups</a></p>


<h4><a name="parrot_run_loop_problems">Parrot run loop problems</a></h4>
<p>Leo has also been thinking about Parrot run loops and reckons we're
doing it wrong. So he proposed a different way of doing things,
working through its impact on the various kinds of Parrot core. Steve
Fink liked Leo's idea, but Jason Gloudon was less sure.</p>
<p><a href="http://groups.google.com/groups?threadm=3E38EB4E.1030506%40toetsch.at">http://groups.google.com/groups</a></p>




<h3><a name="meanwhile,_in_perl6language">Meanwhile, in perl6-language</a></h3>


<h4><a name="more_array_behaviours">More Array Behaviours</a></h4>
<p>Michael Lazzaro is working on documenting Perl Arrays and asked for
confirmations and clarifications on various areas of Array behaviour.
One subthread morphed into a discussion of when to use <code>is</code>
properties and when to use <code>but</code> properties. It turns out that the
'<code>is</code> is compile time, <code>but</code> is runtime' rule of thumb is only a
rule of thumb. Damian says that a better distinction is '<code>but</code> is a
property on a value, <code>is</code> is a property on a referent'. Variables,
arrays, opaque objects, hashes etc are referents and therefore get
<code>is</code> properties. Values are thing things that are held in variables,
arrays, opaque objects etc, and they get <code>but</code> properties.</p>
<p><a href="http://groups.google.com/groups?threadm=935680D1-3229-11D7-8A88-00050245244A%40cognitivity.com">http://groups.google.com/groups</a></p>


<h4><a name="spare_brackets">Spare Brackets</a></h4>
<p>Martin wondered if it would be possible to use <code>[]</code> to do both hash
and array lookups. Short answer ``No''. Which isn't to say the thread
didn't take off like a runaway train. After far too many messages we
reached the same 'No' conclusion that Damian had stated way back a the
start of the thread. The reasoning goes like this: Given <code>&lt;
$container[$spec] </code>&gt; you can't use the type of <code>$container</code> to decide
whether to do a hash or an array lookup because there are Perl object
types which have both hash and array semantics. And you can't use
<code>$spec</code>'s type either because Perl happily autoconverts between
numbers and strings. So, you need some way to specify what sort of
lookup you need, and you do that by using <code>{}</code> or <code>[]</code> as
appropriate. But, frankly, that's beside the point. The reason we're
not using <code>[]</code> to do both array and hash style lookups is Because
Larry Says So.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.33.0301281200060.7460-100000%40mogwai.home">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=a05200f07ba5cb096f87c%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>


<h4><a name="arrays:_default_values">Arrays: Default values</a></h4>
<p>Argh! I've really been screwed by problems with my mail here. For some
reason a batch of mail appears to have got dropped on the floor this
week and my record of this thread is the one that's suffered the
most.</p>
<p>The gist of the thread is that adding a default value to an array
opens a whole scary can of worms to do with the distinction between
'undef' and 'exists' (made trickier still by the fact that 'exists' is
a pretty vague concept when you're dealing with an array.) Damian's
view is that an array with a default value should do the equivalent of</p>
<pre>
   $content = @foo[$index] // @foo.default;</pre>
<p>ie, all undefs in the array should be 'replaced' with the array's
default value. And that includes any 'deliberate' undefs (where the
programmer does <code>@foo[$index] = undef</code>). As I understand it, doing
anything else leads to implementation pain. And it leads to even more
fun when your default is computed and the function doing the
computation gets passed the index as an argument. What happens when
someone does a shift?</p>
<p>For some reason this led into a discussion of whether hashes are
ordered (they're not, but if you leave a particular hash alone any
iterators (keys/values/each) will step through the hash in the same
order, repeatably, but that order is not predictable).</p>
<p><a href="http://groups.google.com/groups?threadm=3E36F2A1.80205%40conway.org">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=5E1D636C-3482-11D7-8044-00050245244A%40cognitivity.com">http://groups.google.com/groups</a> -- Current
'default' rules</p>


<h4><a name="damian_takes_a_sabbatical">Damian Takes a Sabbatical</a></h4>
<p>Damian announced that, owing to time pressures, the need to find
paying work, the need to help Larry get the next Apocalypse out the
door and to get the associated Exegesis written he's unsubscribed from
the language list for the time being, though he expects that he'll
probably resubscribe once A6 and E6 are released. Folks wished him well.</p>
<p><a href="http://groups.google.com/groups?threadm=3E398D2E.4030500%40conway.org">http://groups.google.com/groups</a></p>




<h3><a name="in_brief">In Brief</a></h3>
<p>After asking for suggestions of a language to implement using parrot,
K Stol announced that he would be implementing a Lua-&gt;parrot compiler
as his final year project.</p>




<h3><a name="who's_who_in_perl_6">Who's Who in Perl 6?</a></h3>
<dl>
<dt><strong><a name="item_who_are_you%3f">Who are you?</a></strong><br />
</dt>
<dd>
Gopal V [gopalv82 at symonds dot net]
</dd>


<dt><strong><a name="item_what_do_you_do_for%2fwith_perl_6%3f">What do you do for/with Perl 6?</a></strong><br />
</dt>
<dd>
I'm more interested in Parrot rather than in Perl 6 , since it is the
only really free bytecode format out there. I am planning to build a
C# to Parrot compiler. I did a bunch of opcodes in this direction ,
but mostly what I do is lurk around in the mailing list &amp; IRC.
</dd>


<dt><strong><a name="item_where_are_you_coming_from%3f">Where are you coming from?</a></strong><br />
</dt>
<dd>
I'm from the DotGNU project and have been playing around in that code
for some time. I've still got my foot placed firmly there and am
peering over the hedge into parrot. I'm still in college, so I still
have to find time to study.
</dd>


<dt><strong><a name="item_when_do_you_think_perl_6_will_be_released%3f">When do you think Perl 6 will be released?</a></strong><br />
</dt>
<dd>
On a Saturday morning after announcing Tuesday afternoon in the
release plan.
</dd>


<dt><strong><a name="item_why_are_you_doing_this%3f">Why are you doing this?</a></strong><br />
</dt>
<dd>
It's great to be involved with a community project , it's a very
entertaining, stimulating and educating experience. In short, I'm in
this for the warm fuzzy feeling !.
</dd>


<dt><strong><a name="item_you_have_5_words%2e_describe_yourself%2e">You have 5 words. Describe yourself.</a></strong><br />
</dt>
<dd>
compulsive hacker, caffeine addict, RSI_sufferer.
</dd>


<dt><strong><a name="item_do_you_have_anything_to_declare%3f">Do you have anything to declare?</a></strong><br />
</dt>
<dd>
I promise, I'll try hard to get the C# compiler working with
parrot. (starts singing ``Some day, Some way...'' off key)
</dd>

</dl>




<h3><a name="announcements_and_acknowledgements">Announcements and Acknowledgements</a></h3>
<p>This week's summary was once again prepared in a comfortable chair
with plenty of Earl Grey tea and distractions from two delightfully
ginger kittens and my embarrassing ability to screw up my Gnus
installation (now unscrewed).</p>
<p>Thanks to Gopal V for his answers to the questionnaire this week. If
you've been involved in the Perl 6 development process, please
consider answering the same set of questions and sending them to
<em><a href="mailto:5Ws@bofh.org.uk">5Ws@bofh.org.uk</a></em> and you'll earn my undying gratitude.</p>
<p>Proofreading was handled by the ever lovely Aspell.</p>
<p>If you appreciated this summary, please consider one or more of the
following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.</li>


<li>
Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>


<li>
Send feedback, flames, money, job offers or a working teleportation
device to <em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em></li>

</ul>
<p>This week's summary was sponsored by Darren Duncan. Thanks Darren. If
you'd like to become a summary sponsor, drop me a line at
<em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em>.</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2003/01/">&laquo; January 2003</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2003/03/">March 2003 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
