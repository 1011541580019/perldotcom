<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.02" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
    
    <link rel="prev bookmark" href="/pub/2003/02/20030209.html" title="This week on Perl 6, week ending 2003-02-09" />
    <link rel="next bookmark" href="/pub/2003/02/20030216.html" title="This week on Perl 6, week ending 2003-02-16" />
    
    
    <title>Module::Build - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <div id="top_advert"> 
<!-- Put any landscape advert in here -->
<a href="http://www.perlfoundation.org/" target="_new">
<img src="/i/tpf_banner.png" width="468" height="60" /></a>
        </div> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description"></div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1068" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Module::Build</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Dave Rolsky</span> on <abbr class="published" title="2003-02-12T00:00:00-08:00">February 12, 2003 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->
<br clear="all" />
<p><i>Dave Rolsky is a co-author of the recently released <a href="http://www.oreilly.com/catalog/perlhtmlmason/">Embedding Perl in HTML with Mason</a>.</i></p>

<p>This article was originally published in February of 2003, and was updated by Dave Rolsky and Michael Schwern in January, 2008.</p>

<p>If you've ever created a Perl module for distribution on CPAN, you've
used the <code>ExtUtils::MakeMaker</code> module.  This venerable module goes
back to the dawn of modern Perl, which began with the release of Perl
5.000.</p>
<p>Recently, Ken Williams has created a potential replacement for
<code>ExtUtils::MakeMaker</code> called <code>Module::Build</code>, which was first
released in August of 2002.  Hugo van der Sanden, the pumpking for the
current development version of Perl, has expressed interest in
replacing <code>ExtUtils::MakeMaker</code> with <code>Module::Build</code> for the 5.10
release of Perl, and Michael Schwern, the current
<code>ExtUtils::MakeMaker</code> maintainer, agrees with him.
<code>ExtUtils::MakeMaker</code> won't go away any time soon, but we can hope
for a gradual transition to a new and improved build system.</p>


<h2><a name="why_extutils::makemaker_is_important">Why ExtUtils::MakeMaker is Important</a></h2>
<p>The <code>ExtUtils::MakeMaker</code> module, along with the <code>h2xs</code> script, has
been a huge boon to the Perl community, as it makes it possible to
have a <em>standard</em> way to distribute and install Perl modules.  It
automates many tasks that module authors would otherwise have to to
implement by hand, such as turning XS into C, compiling that C code,
generating man pages from POD, running a module's test suite, and of
course, installing the module.</p>
<p><code>ExtUtils::MakeMaker</code> is a huge part of what makes PAUSE and CPAN
possible, and it is quite a programming feat.  Python did not have a
similar utility until the September, 1999 release of distutils, PHP's
PEAR didn't begin until mid-2000, and Ruby is just beginning to work
on a standard library distribution mechanism.</p>


<h2><a name="the_scary_guts_of_extutils::makemaker">The Scary Guts of ExtUtils::MakeMaker</a></h2>
<p><code>ExtUtils::MakeMaker</code> works by generating a makefile that contains
targets for the various tasks needed when maintaining or installing a
module.  Here's an example target:</p>
<pre>
  install :: all pure_install doc_install</pre>
<p>If you're familiar with makefile syntax, you'll realize that all this
target does is call three other targets, which are named &quot;all&quot;,
&quot;pure_install&quot;, and &quot;doc_install&quot;.  These targets in turn may call
other targets, or use system commands to do whatever action is needed,
in this case installing the module and its associated documentation.</p>
<p>The makefiles generated by <code>ExtUtils::MakeMaker</code> are fairly complex.
For example, using version 6.05 of <code>ExtUtils::MakeMaker</code> to install
my <code>Exception::Class</code> module, a pure Perl distribution containing
just one module, creates a makefile with about 390 lines of makefile
code.  Figuring out what this makefile actually does is no simple
feat, because it consists of a maze of twisty macros, all alike, many
of which simply call Perl one-liners from the command line to perform
some task.</p>
<p>The <code>ExtUtils::MakeMaker</code> code itself is extremely complicated, as it
works on many operating systems (almost as many as Perl itself), and
needs to accommodate their file systems, command line shells,
different versions of make, and so on.  And this is all done with an
extra layer of indirection in place, because it is generating a
makefile which does all the work.</p>
<p>If you want to customize the module build or installation process,
good luck.  To do this, you must subclass <code>ExtUtils::MakeMaker</code>,
override methods that generate specific makefile targets, and then
tweak the generated text to include your custom behavior, all the
while preserving the basic behavior of the target.  Considering that
there is no documentation describing what to expect from these
targets, and that the actual target text may change between releases
of <code>ExtUtils::MakeMaker</code> or between different OS's, this can be quite
painful to implement and maintain.</p>
<p>And by the way, you can't really subclass <code>ExtUtils::MakeMaker</code>,
instead you are subclassing the <code>MY</code> package.  This is a deeply
strange hack, but the end result is that you can only override certain
pre-defined methods in <code>ExtUtils::MakeMaker</code>.</p>
<p>For example, the <code>HTML::Mason</code> module includes this snippet:</p>
<pre>
  package MY;</pre>
<pre>
  sub test {
      my $self = shift;</pre>
<pre>
      my $test = $self-&gt;SUPER::test(@_);</pre>
<pre>
      # %MY::APACHE is set in makeconfig.pl.
      # If we are not going to test with Apache there is no harm in
      # setting this anyway.</pre>
<pre>
      # The PORT env var is used by Apache::test.  Don't delete it!
      my $port = $MY::APACHE{port} || 8228;
      $MY::APACHE{apache_dir} ||= &quot;;</pre>
<pre>
      my $is_maintainer = main::is_maintainer();</pre>
<pre>
      # This works for older MakeMakers
      $test =~ s/(runtests \@ARGV;)/\$\$ENV{MASON_VERBOSE} == 
	  \$(TEST_VERBOSE) ? \$(TEST_VERBOSE) : \$\$ENV{MASON_VERBOSE}; 
	  \$\$ENV{PORT}=$port; 
	  \$\$ENV{APACHE_DIR}=q^$MY::APACHE{apache_dir}^; 
	  \$\$ENV{MASON_MAINTAINER}=$is_maintainer; $1/;</pre>
<pre>
      my $bs = $^O =~ /Win32/i ? &quot; : '\\';</pre>
<pre>
      # This works for newer MakeMakers (5.48_01 +)
	  $test =~ s/(&quot;-MExtUtils::Command::MM&quot; &quot;-e&quot; &quot;)
	  (test_harness\(\$\(TEST_VERBOSE\).*?\)&quot;
	  \$\(TEST_FILES\))/$1 $bs\$\$ENV{MASON_VERBOSE} == \$(TEST_VERBOSE) ?
	  \$(TEST_VERBOSE) : $bs\$\$ENV{MASON_VERBOSE}; $bs\$\$ENV{PORT}=$port;
	  $bs\$\$ENV{APACHE_DIR}=q^$MY::APACHE{apache_dir}^;
	  $bs\$\$ENV{MASON_MAINTAINER}=$is_maintainer; $2/;</pre>
<pre>
      return $test;
  }</pre>
<p>The goal of all this code is to pass some additional environment
information to the test scripts when they are run, so we can do tests
with a live Apache server.  It accommodates several versions of
<code>ExtUtils::MakeMaker</code>, and attempts to work properly on multiple
operating systems (at least Win32 and *nix), and it has to be careful
about escaping things properly so that it executes properly from the
shell.</p>


<h2><a name="why_not_perl">Why not Perl?</a></h2>
<p>All of this prompts the question of &quot;why not just use Perl itself for
all of this?&quot;  That's exactly the question that Ken Williams answered
with <code>Module::Build</code>.  The goal of <code>Module::Build</code> is to do
everything useful that <code>ExtUtils::MakeMaker</code> does, but to do this all
with pure Perl wherever possible.</p>
<p>This greatly simplifies the build system code, and <code>Module::Build</code>
works on systems which don't normally include make, like Win32 and Mac
OS.  Of course, if a module installation requires the compilation of C
code, you'll still need an external C compiler.</p>
<p>Additionally, customizing <code>Module::Build</code>'s behavior is often quite
trivial, and only requires that you know Perl, as opposed to knowing
make syntax and possibly having to learn about multiple command line
environments.</p>
<p><code>Module::Build</code> also aims to improve on some of the features provided
by <code>ExtUtils::MakeMaker</code>.  One example is its prerequisite-checking
system, which provides much more flexibility than what
<code>ExtUtils::MakeMaker</code> allows.  While these features could be added to
<code>ExtUtils::MakeMaker</code>, it's risky to make major changes to such an
important module, especially one with such complex internals.</p>


<h2><a name="using_module::build">Using Module::Build</a></h2>
<p>From an end-user perspective, a module that uses <code>Module::Build</code>
looks quite a bit like one using <code>ExtUtils::MakeMaker</code>, and
intentionally so.  So to install a module using <code>Module::Build</code> you'd
type the following lines from the command line:</p>
<pre>
  perl Build.PL
  ./Build
  ./Build test
  ./Build install</pre>
<p>The <em>Build.PL</em> script tells <code>Module::Build</code> to create a <em>Build</em>
script.  During this process, <code>Module::Build</code> also writes some files
to a <em>_build/</em> directory.  These files are used to store the build
system's state between invocations of the <em>Build</em> script.  This
script, when invoked, simply loads up <code>Module::Build</code> again, and
tells it to perform the specified action.  An action is the
<code>Module::Build</code> version of a makefile target, and actions are
implemented in pure Perl whenever possible.</p>
<p>A bare bones <em>Build.PL</em> script might look like this:</p>
<pre>
  use Module::Build;</pre>
<pre>
  Module::Build-&gt;new
      ( module_name =&gt; 'My::Module',
        license =&gt; 'perl',
      )-&gt;create_build_script;</pre>
<p>The &quot;module_name&quot; parameter is like the <code>ExtUtils::MakeMaker</code> &quot;NAME&quot;
parameter.</p>
<p>The &quot;license&quot; parameter is new with <code>Module::Build</code>, and its intended
use it allow automated tools to determine under which license your
module is distributed.</p>
<p>To determine your module's version, <code>Module::Build</code> looks in the
module specified by the &quot;module_name&quot; parameter, though this can be
overridden either by specifying a different module to look in, or by
providing the version number directly.</p>
<p>Of course, there are more options than those.  For example,
<code>Module::Build</code> implements a prerequisite feature similar to that
implemented by <code>ExtUtils::MakeMaker</code>, so we can write:</p>
<pre>
  Module::Build-&gt;new
      ( module_name =&gt; 'My::Module',
        license =&gt; 'perl',
        requires =&gt; { 'CGI' =&gt; 0,
                      'DBD::mysql' =&gt; 2.1013,
                    },
      )-&gt;create_build_script;</pre>
<p>If you have any experience with <code>ExtUtils::MakeMaker</code>, you can
probably figure out that this says that our module requires any
version of <code>CGI</code>, and version 2.1013 or greater of <code>DBD::mysql</code>.  So
far, this looks just like what <code>ExtUtils::MakeMaker</code> provides, but
<code>Module::Build</code> goes further.</p>
















<p>Consider what happens if we know that we need some piece of
functionality first present in <code>DBD::mysql</code> 2.1013.  But perhaps a
release after this, 2.1014, introduced a new bug that breaks our
application.  If this bug is fixed in version 2.1015, we <em>could</em>
simply require version 2.1015, but this is not ideal.  There's no
reason to force someone who already has 2.1013 to upgrade because of a
bug in a version they don't have.</p>
<p>Fortunately, <code>Module::Build</code> provides a more flexible version
specification option that handles exactly this situation, so we can
write:</p>
<pre>
  Module::Build-&gt;new
      ( module_name =&gt; 'My::Module',
        license =&gt; 'perl',
        requires =&gt; { 'CGI' =&gt; 0,
                      'DBD::mysql' =&gt; '&gt;= 2.1013, != 2.1014',
                    },
      )-&gt;create_build_script;</pre>
<p>This says that we need a version greater than 2.1013 that <strong>is not</strong>
version 2.1014.  Users who have version 2.1013 or version 2.1015 or
greater are not forced to upgrade, but anyone with 2.1014 will be.</p>
<p>If we knew that version 3.0 didn't work with your module, we could
change our specification:</p>
<pre>
  Module::Build-&gt;new
      ( module_name =&gt; 'My::Module',
        license =&gt; 'perl',
        requires =&gt; { 'CGI' =&gt; 0,
                      'DBD::mysql' =&gt; '&gt;= 2.1013, != 2.1014, &lt; 3.0',
                    },
      )-&gt;create_build_script;</pre>
<p>If the user does have version 3.0 or greater installed, it will at
least let them know that it won't work with our module.
Unfortunately, the only possible way to use our module at this point
is for the end user to manually downgrade their installation of
<code>DBD::mysql</code>, since Perl does not allow multiple versions of a module
to co-exist peacefully.  Still, this is better than letting the module
be installed, only to fail at runtime when it tries to use an outdated
API for <code>DBD::mysql</code>.</p>
<p>There are also other options related to prerequisites, such as
&quot;recommends&quot; and &quot;build_requires&quot;, which can be helpful for
prerequisites that are required to build the module but don't need to
be present after installation.  There is also a &quot;conflicts&quot; option
which can be used to warn a user about potential conflicts between the
module they are installing and one they already have.</p>


<h2><a name="action!">Action!</a></h2>
<p>As of release 1.15, Module::Build implements the following actions,
most of which are based on existing <code>ExtUtils::MakeMaker</code>
functionality:</p>
<ul>
<li><strong><a name="item_build">build</a></strong><br />

<p>This is the default action, and is what happens if you run <em>./Build</em>
without any additional arguments.  It is responsible for creating the
<em>blib/</em> directory and copying files into it, as well as compiling XS
and C files.  If you have any scripts like <em>lib/My/Module.pm.PL</em>,
these are also run during this action.</p></li>


<li><strong><a name="item_test%2c_testdb">test, testdb</a></strong><br />

<p>Runs the module's tests using the <code>Test::Harness</code> module.  The
&quot;testdb&quot; action can be used to run the tests under Perl's debugger.
Equivalently, a &quot;debugger&quot; parameter can be passed to the &quot;test&quot;
action to get the same effect.</p></li>


<li><strong><a name="item_clean%2c_realclean">clean, realclean</a></strong><br />

<p>Both actions delete any files created by the &quot;build&quot; action.  The
&quot;realclean&quot; action also deletes the existing <em>Build</em> script.</p></li>


<li><strong><a name="item_diff">diff</a></strong><br />

<p>This action is used to compare the files about to be installed with
any corresponding files that already exist.  This feature is unique to
<code>Module::Build</code>.</p></li>


<li><strong><a name="item_install">install</a></strong><br />

<p>Installs the module files.  As of version 0.15, this doesn't yet
create or install any man pages.</p></li>


<li><strong><a name="item_fakeinstall">fakeinstall</a></strong><br />

<p>Tells you what the &quot;install&quot; would do.</p></li>


<li><strong><a name="item_dist">dist</a></strong><br />

<p>Creates a gzip'd tarball of your distribution.</p></li>


<li><strong><a name="item_manifest">manifest</a></strong><br />

Creates a <em>MANIFEST</em> file for your distribution.</li>


<li><strong><a name="item_distcheck">distcheck</a></strong><br />

<p>Tells you what files are in the build directory but not in the
<em>MANIFEST</em> file, and vice versa.</p></li>


<li><strong><a name="item_skipcheck">skipcheck</a></strong><br />

<p>Tells you what files will not be added to the <em>MANIFEST</em> by the
&quot;manifest&quot; action, based on the contents of your <em>MANIFEST.SKIP</em>
file.</p></li>


<li><strong><a name="item_distclean">distclean</a></strong><br />

<p>This is a shortcut for &quot;realclean&quot; followed by &quot;distcheck&quot;.</p></li>


<li><strong><a name="item_distdir">distdir</a></strong><br />
<p>Creates a directory based on your distribution name and version, and
then copies all the files listed in <em>MANIFEST</em> to that directory.
This directory is what people will see when they download and unpack
your distribution.
</p>
<p><code>Module::Build</code> also creates a file called <em>META.yaml</em> which
contains meta-data about your distribution.  In the future, it may be
possible to use a command line tool (written in Perl, of course) to
read this file and use its contents to install your distribution,
without running the <em>Build.PL</em> script.  It also makes the meta-data
more readily available to tools like search.cpan.org or the CPAN
shell.</p></li>


<li><strong><a name="item_disttest">disttest</a></strong><br />

<p>This performs the &quot;distdir&quot; action, switches to the newly created
directory, and then runs <code>perl Build.PL</code>, <code>./Build</code>, and <code>./Build
test</code>.  This lets you make sure that your distribution is actually
installable.</p></li>


<li><strong><a name="item_help">help</a></strong><br />

<p>Tells you what actions are available.  If additional actions are
implemented in a distribution, then these are listed here.</p></li>

</ul>
<p>Any of these options can be overridden through straightforward
subclassing, so our <code>HTML::Mason</code> example from earlier in this article
might be written something like this:</p>
<pre>
  package MyFancyBuilder;</pre>
<pre>
  use base 'Module::Build';</pre>
<pre>
  sub ACTION_test {
      my $self = shift;</pre>
<pre>
      # %MY::APACHE is set in makeconfig.pl.</pre>
<pre>
      $ENV{PORT}             = $MY::APACHE{port}       || 8228;
      $ENV{APACHE_DIR}       = $MY::APACHE{apache_dir} || &quot;;
      $ENV{MASON_VERBOSE}  ||= $self-&gt;{properties}{verbose};
      # _is_maintainer_mode would be another method of our subclass
      $ENV{MASON_MAINTAINER} = $self-&gt;_is_maintainer_mode();</pre>
<pre>
      return $self-&gt;SUPER::ACTION_test(@_);
  }</pre>
<p>This version is actually readable, and is unlikely to break regardless
of changes in the <code>Module::Build</code> internals.  This highlights just
how difficult it was to accomplish a simple task using
<code>ExtUtils::MakeMaker</code>, and how natural the pure-Perl solution can be.</p>


<h2><a name="the_larger_picture_and_backwards_compatibility">The Larger Picture and Backwards Compatibility</a></h2>
<p>One difficulty in getting <code>Module::Build</code> into widespread use is the
fact that support for <code>ExtUtils::MakeMaker</code> is so tightly integrated
into CPAN installers.</p>
<p>While the version of <code>CPAN.pm</code> which ships with 5.8 does not know how to deal with Build.PL, the latest versoin available from CPAN does.  It will even install <code>Module::Build</code> for you.  As of January 2008, <code>CPANPLUS</code>, another CPAN shell, understands <em>Build.PL</em> but will not install <code>Module::Build</code> for you, but this will be remedied in a future release.</p>
<p>However, old versions of <code>CPAN.pm</code> are still in extremely widespread use, and users won't
necessarily upgrade <code>CPAN.pm</code> before attempting to install a
distribution that relies on <code>Module::Build</code>.</p>
















<p>There are a couple workarounds for this problem.  The simplest is to
just include a <em>Build.PL</em> script and document this in the <em>README</em>
or <em>INSTALL</em> files included with your distribution.  This has the
appeal of requiring of very little work to implement, but the downside
is that people who expect things to just work with a CPAN shell will
give up when your distribution doesn't install properly.</p>
<p>Another possibility is to create functionally equivalent <em>Build.PL</em>
and <em>Makefile.PL</em> scripts.  If you're using <code>Module::Build</code> because
you need to customize installation behavior in a way that is difficult
to do with <code>ExtUtils::MakeMaker</code>, this pretty much defeats the
purpose of using <code>Module::Build</code> at all, and in any case having two
separate pieces of code that do the same thing is always unappealing.</p>
<p>Then there's the approach which involves using a
<em>Makefile.PL</em> script that simply installs <code>Module::Build</code> if needed,
and then generates a <em>Makefile</em> that passes everything through to the
<em>./Build</em> script.  This is known as the "passthrough" method.</p>
<p>I think this approach gives the best result for the effort involved,
and is the method I prefer.  The <code>Module::Build</code> distribution
includes a <code>Module::Build::Compat</code> module, which does the dirty work needed for this approach.</p>
<p>Simply add <code>create_makefile_pl => 'passthrough'</code> to the <em>Build.PL</em> parameters and a <em>Makefile.PL</em> will be created as part of the <code>Build dist</code> process.</p>

<p>Here's an example of such a <em>Makefile.PL</em> script:</p>
<pre>
    # Note: this file was auto-generated by Module::Build::Compat version 0.03

    unless (eval "use Module::Build::Compat 0.02; 1" ) {
      print "This module requires Module::Build to install itself.\n";
      
      require ExtUtils::MakeMaker;
      my $yn = ExtUtils::MakeMaker::prompt
        ('  Install Module::Build now from CPAN?', 'y');
      
      unless ($yn =~ /^y/i) {
        die " *** Cannot install without Module::Build.  Exiting ...\n";
      }
      
      require Cwd;
      require File::Spec;
      require CPAN;
      
      # Save this 'cause CPAN will chdir all over the place.
      my $cwd = Cwd::cwd();
      
      CPAN::Shell->install('Module::Build::Compat');
      CPAN::Shell->expand("Module", "Module::Build::Compat")->uptodate
        or die "Couldn't install Module::Build, giving up.\n";
      
      chdir $cwd or die "Cannot chdir() back to $cwd: $!";
    }
    eval "use Module::Build::Compat 0.02; 1" or die $@;
    
    Module::Build::Compat->run_build_pl(args => \@ARGV);
    require Module::Build;
    Module::Build::Compat->write_makefile(build_class => 'Module::Build');
</pre>
<p>So what exactly is going on here?  A good question indeed.  Let's walk
through some of the code.</p>
<pre>
    unless (eval "use Module::Build::Compat 0.02; 1" ) {
      print "This module requires Module::Build to install itself.\n";
      
      require ExtUtils::MakeMaker;
      my $yn = ExtUtils::MakeMaker::prompt
        ('  Install Module::Build now from CPAN?', 'y');
      
      unless ($yn =~ /^y/i) {
        die " *** Cannot install without Module::Build.  Exiting ...\n";
      }
</pre>
<p>This first attempts to load version 0.02 or greater of the
<code>Module::Build::Compat</code> module.  If it isn't installed we know we
need to install <code>Module::Build</code>.  Because we're polite, we ask the
user if they would like to install <code>Module::Build</code> before going
further.  Some people dislike interactive installations, but fortunately the promp() command is pretty smart about detecting if there's a user at the end of the line.</p>
<p>Assuming that the user agrees to install <code>Module::Build</code> (if they don't the installer has to give up) this is what comes next:</p>
<pre>
      # Save this 'cause CPAN will chdir all over the place.
      my $cwd = Cwd::cwd();
      
      CPAN::Shell->install('Module::Build::Compat');
      CPAN::Shell->expand("Module", "Module::Build::Compat")->uptodate
        or die "Couldn't install Module::Build, giving up.\n";
      
      chdir $cwd or die "Cannot chdir() back to $cwd: $!";
</pre>
<p>We want to use <code>CPAN.pm</code> to actually install <code>Module::Build</code>, but we
need to first save our current directory, because <code>CPAN.pm</code> calls
<code>chdir()</code> quite a bit, and we'll need to be in the same directory as
we started in after installing <code>Module::Build</code>.</p>
<p>Then we load <code>CPAN.pm</code> and tell it to install <code>Module::Build</code>.
After that, we <code>chdir()</code> back to our original directory.</p>
<pre>
    eval "use Module::Build::Compat 0.02; 1" or die $@;
    
    Module::Build::Compat->run_build_pl(args => \@ARGV);
    require Module::Build;
    Module::Build::Compat->write_makefile(build_class => 'Module::Build');
</pre>
<p>First it checks that the <code>Module::Build</code> install worked.  Then it simply tells <code>Module::Build::Compat</code> to run the <em>Build.PL</em>
script, and to write out a &quot;passthrough&quot; <em>Makefile</em>.
<code>Module::Build::Compat</code> will attempt to convert
<code>ExtUtils::MakeMaker</code> style arguments, like &quot;PREFIX&quot;, to arguments
that <code>Module::Build</code> can understand, like "--prefix".</p>
<p>The &quot;passthrough&quot; <em>Makefile</em> that <code>Module::Build::Compat</code> generates
looks something like this:</p>
<pre>
  all :
          ./Build
  realclean :
          ./Build realclean
          rm -f \$(THISFILE)
  .DEFAULT :
          ./Build \$@
  .PHONY   : install manifest</pre>
<p>The &quot;.DEFAULT&quot; target is called when there is no matching make target
for the one given on the command line.  It uses the &quot;$@&quot; make
variable, which will contain the name of the target that was passed to
make.  So if &quot;make install&quot; is called, then &quot;$@&quot; contains &quot;install&quot;,
and it ends up running &quot;./Build install&quot;.</p>
<p>The generated Makefile also contains a comment which specifies the
module's prerequisites, because this is how <code>CPAN.pm</code> figures out
what a module's prerequisites are (scary but true).</p>
<p>This approach is the most elegant of all, but the code that translates
<code>ExtUtils::MakeMaker</code> arguments to something <code>Module::Build</code>
understands is quite minimal and won't handle all possibilities.</p>
<p>I have used this approach for one CPAN module, <code>Thesaurus.pm</code>, and in
my limited testing it did work.  If you are inclined to try installing
this module, please send bug reports to me or the <code>Module::Build</code>
users list, <code>module-build-general@lists.sf.net</code>.</p>
<p>Recently, Autrijus Tang submitted a more complex <em>Makefile.PL</em> script
which implements several pieces of additional functionality.  First of
all, it makes sure that the script is running as a user that can
actually install <code>Module::Build</code>.  Second, it prefers <code>CPANPLUS.pm</code>
to <code>CPAN.pm</code>.</p>
<p>Autrijus' script looks promising, but since it hasn't yet been tested,
I've chosen not to include it here.  It's quite likely that some
version of his script will be documented in future versions of
<code>Module::Build</code></p>


<h2><a name="custom_behavior">Custom Behavior</a></h2>
<p>As was hinted at earlier, you can directly subclass <code>Module::Build</code>
in order to implement custom behavior.  This is a big topic unto
itself, and will be the topic of a future article here on perl.com.</p>


<h2><a name="the_future">The Future</a></h2>
<p>There is plenty of work left to be done on <code>Module::Build</code>.  Off the
top of my head, here are some things that still need to be done:</p>
<p>
The installation phase does not yet create man pages based on POD
included in the distribution.
</p>


<p>
<code>Module::Build</code> needs to implement a &quot;local install&quot; feature like the
one provided by the <code>ExtUtils::MakeMaker</code> &quot;PREFIX&quot; argument.  The
logic that implements this in <code>ExtUtils::MakeMaker</code> is Byzantine, but
only because doing this correctly is quite complicated.  This logic
needs to be implemented for <code>Module::Build</code> as well.
</p>


<p>
<code>Module::Build</code> needs better backwards compatibility with
<code>ExtUtils::MakeMaker</code>.  The argument translation in
<code>Module::Build::Compat</code> is currently just a placeholder.  Things like
&quot;PREFIX&quot;, &quot;LIB&quot;, and &quot;UNINST=1&quot; all need to be translated by
<code>Module::Build::Compat</code>, and the equivalent functionality needs to be
implemented for <code>Module::Build</code>
</p>

<p>
<code>CPANPLUS.pm</code> could take advantage of more <code>Module::Build</code> features.
For example, it currently ignores the &quot;conflict&quot; information that
<code>Module::Build</code> makes available, and it doesn't attempt to
distinguish between &quot;build_requires&quot;, &quot;requires&quot;, or &quot;recommends&quot;.
</p>

<p>Some of what <code>Module::Build</code> provides is intended for use by external
tools, such as the meta-data provided by the <em>META.yaml</em> file.
<code>CPANPLUS.pm</code> could use this to avoid having to run the <em>Build.PL</em>
and <em>Build</em> scripts, thus avoiding the need to install any of the
&quot;build_requires&quot; modules.  Package managers like <code>rpm</code> or the Debian
tools could also use it to construct installable packages for Perl
modules more easily.</p>


<p>
Adding at least basic support for <code>Module::Build</code> to <code>CPAN.pm</code> would
be nice.  If anyone is interested in pursuing this, I have an old
patch that may provide a decent start on this.  Contact me if you're
interested.
</p>

<h2><a name="more_information">More Information</a></h2>
<p>If you want to learn more about <code>Module::Build</code>, the first thing you
should do is install it (it will install itself just fine under
<code>CPAN.pm</code>) and read the docs for the <code>Module::Build</code> and
<code>Module::Build::Compat</code> modules.  There is a project on SourceForge
for <code>Module::Build</code> at
<a href="http://www.sourceforge.net/projects/module-build.">http://www.sourceforge.net/projects/module-build.</a>  The source is in
CVS on SourceForge, and is accessible via anonymous CVS and and
online.</p>
<p>Finally, if you're interested in using or helping to develop
<code>Module::Build</code>, please sign up on the
<a href="mailto:module-build-general@lists.sf.net">module-build-general@lists.sf.net</a> email list.  See
<a href="http://lists.sourceforge.net/lists/listinfo/module-build-general">http://lists.sourceforge.net/lists/listinfo/module-build-general</a> for
more details.</p>


<h2><a name="thanks">Thanks</a></h2>
<p>Thanks to Ken Williams for reviewing this article before publication,
and for writing <code>Module::Build</code>.</p>



                                    </div>


                                </div>
                                <div class="asset-footer">

    
                                    <div class="entry-categories">
                                        <h4>Categories<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="/pub/modules/" rel="tag">Modules</a></li>
                                        </ul>
                                    </div>
    


                                    <div class="entry-tags">
                                        <h4>Tags<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?blog_id=2&amp;tag=module%20build%20makemaker&amp;limit=20';return false;" rel="tag">module build makemaker</a></li>
                                        </ul>
                                    </div>

                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2010/07/">July 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.02" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
