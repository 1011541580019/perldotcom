<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: August 2003 Archives</title>


    <link rel="prev" href="/pub/2003/07/" title="July 2003" />
    <link rel="next" href="/pub/2003/09/" title="September 2003" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">August 2003 Archives</h1>





                            
                            <div id="entry-1184" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/08/p6pdigest/20030831.html" rel="bookmark">This week on Perl 6, week ending 2003-08-31</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-08-31T00:00:00-08:00">August 31, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>Welcome to this week's Perl 6 summary. This week, for one week only
I'm going to break with a long established summary tradition. No,
that doesn't mean I won't be mentioning Leon Brocard this week. Nope,
this week we're going to start by discussing what's been said on the
perl6-language list this week.</p>
<p>Now that's out of the way, we'll continue with a summary of the
internals list.</p>

<h4><a name="continuation passing is becoming the one true calling style" id="continuation passing is becoming the one true calling style">Continuation Passing is becoming the One True Calling Style</a></h4>
<p>Jos Visser had some code that broke in an interesting fashion when
<code>find_lex</code> through an exception, so he asked the list about it. Leo
T&ouml;tsch explained that exceptions and old style subs don't play
at all well together. It seems to me that the total and utter
deprecation of subs using the old style calling conventions is not
far distant.</p>
<p><a href="http://groups.google.com/groups?threadm=20030825090032.GG1125%40jadzia.ao.abnamro.nl">http://groups.google.com/groups</a></p>

<h4><a name="embedding parrot in perl" id="embedding parrot in perl">Embedding Parrot in Perl</a></h4>
<p>Luke Palmer has started to learn XS in the service of his project to
embed Parrot in Perl. Unsurprisingly, he had a few questions. He got
a few answers.</p>
<p><a href="http://groups.google.com/groups?threadm=20030825164459.GA14410%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>

<h4><a name="implementing isa" id="implementing isa">Implementing ISA</a></h4>
<p>Leo T&ouml;tsch has implemented <code>isa</code>. The unfashionably lowercased
chromatic argued that what Leo had implemented should actually be
called <code>does</code>. Chris Dutton thought <code>does</code> should be an alias for
<code>has</code>. Piers Cawley thinks he might be missing something.</p>
<p><a href="http://groups.google.com/groups?threadm=3F4A582C.9030200%40nextra.at">http://groups.google.com/groups</a></p>

<h4><a name="more on constant pmcs and classes" id="more on constant pmcs and classes">More on constant PMCs and classes</a></h4>
<p>Leo T&ouml;tsch's RFC on constant PMCs and classes from last week
continued to attract comments about possible interfaces and
implementations.</p>
<p><a href="http://groups.google.com/groups?threadm=3F4363FF.2010204%40nextra.at">http://groups.google.com/groups</a></p>

<h4><a name="a miscellany of newbie questions" id="a miscellany of newbie questions">A miscellany of newbie questions</a></h4>
<p>James Michael DuPont a bunch of questions and suggestions about
bytecode emission, the JIT and about possibly extracting the Parrot
object system into a separate library. Leo supplied answers.</p>
<p><a href="http://groups.google.com/groups?threadm=20030826142908.48488.qmail%40web41507.mail.yahoo.com">http://groups.google.com/groups</a></p>

<h4><a name="what the heck is active data" id="what the heck is active data">What the heck is active data?</a></h4>
<p>Dan clarified what he'd meant when he talked about Active Data. His
one sentence definition being '``Active Data'' is data that takes some
active role in its use -- reading, writing, modifying, deleting or
using in some activity'. The consequences of such data are far
reaching; even if your code has no active data in it, Dan points out
that you still have to take the possibility into account, or solve
the halting problem.</p>
<p>Benjamin Goldberg seemed to think that you didn't need to solve the
halting problem, you could just add scads of metadata to everything
and do dataflow analysis at compile time. I look forward with interest
to his implementation.</p>
<p>Matt Fowles wondered why active data necessitated keyed variants of
all the ops, asking instead why we couldn't have a <code>prepkeyed</code> op to
return an appropriate specialized PMC to use in the next op. Dan
agreed that such an approach was possible, but not necessarily very
efficient. Leo T&ouml;tsch disagreed with him though.</p>
<p>TOGoS wondered if this meant that we wouldn't know whether <code>set Px,
Py</code> did binding or morphing until runtime. (It doesn't. <code>set</code> always
simply copies a pointer). In an IRC conversation with Dan we realised
that some of this confusion arises from the fact that <code>set_string</code>
and friends behave as if they were called <code>assign_string</code>; to get
the expected <code>set_string</code> semantics you'd have to do:</p>
<pre>
    new Px, .PerlUndef
    set_string Px, &quot;some string&quot;</pre>
<p>Hopefully this is going to get fixed.</p>
<p><a href="http://groups.google.com/groups?threadm=a0521060ebb71b3c71432%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>

<h4><a name="mission haiku" id="mission haiku">Mission haiku</a></h4>

<blockquote>Nicholas Clark<br/>
To make some kind of mark<br/>
Committed haiku.<br/>
Don't you.</blockquote>
<p>Yes, I know that's not a haiku. It's a Clerihew. I suggest that
anyone else who feels tempted to perpetrate verse on list restrict
themselves to a sestina or a villanelle, or maybe a sonnet.</p>
<p>I also note that POD is a lousy format for setting poetry in.</p>
<p><a href="http://groups.google.com/groups?threadm=20030828001111.O4286%40plum.flirble.org">http://groups.google.com/groups</a></p>

<h4><a name="jrgen gets dewarnocked" id="jrgen gets dewarnocked">J&uuml;rgen gets De-Warnocked</a></h4>
<p>J&uuml;rgen B&ouml;mmels had been caught on the horns of Warnock's
Dilemma over a patch he submitted a while back. It turns out that he'd
been Warnocked in part because both Leo and Dan thought he already had
commit rights. So that got fixed. Welcome to the ranks of Parrot
committers J&uuml;rgen, you've deserved it for a while.</p>
<p><a href="http://groups.google.com/groups?threadm=m2znhuksi3.fsf%40helium.physik.uni-kl.de">http://groups.google.com/groups</a></p>

<h4><a name="parrot zmachine" id="parrot zmachine">Parrot Z-machine</a></h4>
<p>New face Amir Karger wants to write the Parrot Z-machine
implementation and had a few questions about stuff. So far he's been
Warnocked.</p>
<p><a href="http://groups.google.com/groups?threadm=20030828131707.8989.qmail%40web40705.mail.yahoo.com">http://groups.google.com/groups</a></p>

<h4><a name="notifications" id="notifications">Notifications</a></h4>
<p>Dan described how Parrot's notification system would work, and what
that means for weak references. Michael Schwern thought the outlined
notification system would also be awfully useful for debugger watch
expressions. Tim Bunce worried about some edge cases.</p>
<p><a href="http://groups.google.com/groups?threadm=a05210614bb743d52fe3f%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>

<h4><a name="msvc++ complaints" id="msvc++ complaints">MSVC++ complaints</a></h4>
<p>Vladimir Lipskiy (who's been doing some stellar work recently on
various build issues amongst other things) found some problems trying
to build Parrot with MSVC++ and asked for help in working out how to
fix them. J&uuml;rgen B&ouml;mmels suggested a fix, which Vladimir
liked in principle, but noted that there were still some issues it
didn't quite fix.</p>
<p><a href="http://groups.google.com/groups?threadm=007301c36dd1%247b68e410%24589d943e%4087w5ovc8gmxcahy">http://groups.google.com/groups</a></p>

<h4><a name="vtable>dump" id="vtable&gt;dump"><code>vtable-&gt;dump</code></a></h4>
<p>Leo T&ouml;tsch thought that, if only for debugging, it would be
really handy for PMCs to offer a <code>dump</code> method which would return a
string representation of the PMC. Dan thought that a better approach
would be to get freeze/thaw working for PMCs and have the debugger
know how to dump a frozen PMC. This seemed to open up a whole big can
of worms as Leo, Dan and others discussed what was needed from the
serialization toolset and what its interface should look
like.</p>
<p>Nicholas Clark threw a googly down the pitch with his description of
a possible attack on serialization schemes (possibly originating with
Jonathan Stowe) that seems deeply tricky to work around.</p>
<p><a href="http://groups.google.com/groups?threadm=3F4F27B4.7070909%40nextra.at">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20030830125952.S4286%40plum.flirble.org">http://groups.google.com/groups</a></p>

<h4><a name="exit opcode" id="exit opcode"><code>exit</code> opcode</a></h4>
<p>Leo checked in a small change to Parrot, making <code>exit</code> throw an
exception rather than simply quitting the program. Of course, unless
the exception is caught, parrot will exit anyway. He also proposed
changing the startup parameters by moving the ARGV array from P0 to
P5 for consistency with the Parrot Calling conventions. For some
reason this sparked off an enormous thread discussing how to return
from the main function.</p>
<p>Dan liked the the idea, so Leo checked a patch in and fixed up as
many of the examples and languages as he could find, but he expects
that he hasn't caught 'em all.</p>
<p><a href="http://groups.google.com/groups?threadm=3F4F390E.6080809%40nextra.at">http://groups.google.com/groups</a></p>


<h3><a name="acknowledgements, announcements, apologies" id="acknowledgements, announcements, apologies">Acknowledgements, Announcements, Apologies</a></h3>
<p>I'm really, really sorry about the Clerihew. But not sorry enough to
remove it.</p>
<p>Thanks to everyone involved in making sure I only got one and a
half of last week's predictions right. (The half prediction was to do
with my writing real Perl code, I didn't. But I <em>did</em> release the
Paris code, you can find it on CPAN at
<a href="http://search.cpan.org/search?query=Heritable%3A%3ATypes&mode=dist">http://search.cpan.org/search</a>
if you're interested.)</p>
<p>Thanks to Gill for seven and 2 days (as I write this) of wedded
bliss.</p>
<p>Check out <a href="http://pc1.bofhadsl.ftech.co.uk:8080/">http://pc1.bofhadsl.ftech.co.uk:8080/</a> for more of my
writing (and thanks to those who have already popped by).</p>
<p>As ever, if you've appreciated this summary, please consider one or
more of the following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.

    </li>
    <li>
Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.

    </li>
    <li>
Send feedback, flames, money, requests for consultancy, photographic
and writing commissions, or the soul of your first born to
<em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em>

    </li>
</ul>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1178" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/08/28/pvoice.html" rel="bookmark">Using Perl to Enable the Disabled</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Jouke Visser</span> on <abbr class="published" title="2003-08-23T00:00:00-08:00">August 23, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p><i>We use Perl for all kinds of things. Web development, data
munging, system administration, even bioinformatics; most of us have
used Perl for one of these situations. A few people use Perl for building
end-user applications with graphical user interfaces (GUIs). And as far
as I know, only two people in this world use Perl to make life easier
for the disabled: <a href="/pub/a/2001/08/27/bjornstad.html">Jon Bjornstad
</a> and I. Some people think the way we use Perl is something special,
but my story will show you that I just did what any other father,
capable of writing software, would do for his child.</i></p>


<h3>The Past</h3>


<p>In 1995 my eldest daughter, Krista, was born. She came way too early, after a pregnancy of only 27.5 weeks. That premature birth resulted in numerous complications during the first three months of her life. Luckily she survived, but getting pneumonia three times when you
   can't even breath on your own causes serious asphyxiation, which in turn
   resulted in severe brain damage. A few months after she left the
   hospital it became clear that the brain damage had caused a spastic
   quadriplegia. </p>

<p>
As Krista grew older, it became more and more clear what she could,
and couldn't do. Being a spastic means you can't move the muscles in
your body the way you want them to. Some people can't walk, but can do
everything else. In Krista's case, she can't walk, she can't sit,
she can't use her hands to grab anything, even keeping her head up
is difficult. Speaking is using the muscles in your mouth and
throat, so you can imagine that speaking is almost out of the
question for her. </p>

<p>
By the end of the year 2000, Krista went to a special school in
Rotterdam. But going to school without being able to speak or without
being able to write down what you want to say is hard, not only for the
teacher, but also for the student. We had to find a way to let Krista
communicate.</p> 

<p>Together with Krista's speech pathologist and
orthopedist we started looking for devices she could use to communicate
with the outside world. These devices should enable her to choose
between symbols, so a word or a sentence could be pronounced. A number
of devices were tested, but all of them either required some action with
her hands or feet that she wasn't able to perform, or gave her too
little choices of words. </p>

<p>
Then we looked into available communications software, so she could use
an adapted input device (in her case a headrest with built-in switches)
to control an application. Indeed there was software available that
could have been used, but the best match was a program that
automatically scanned through symbols on her screen and when the desired
symbol was highlighted, she had to move her head to select it. Timing
was the issue here. If moving your head to the left or right is really
hard to do anyway, it's hardly possible to take that action at the
desired moment. </p>

<h3>pVoice</h3>

<p>
We had to do something. There was no suitable device or software
application available. I thought it through and suggested I could try to
write a simple application myself. It would be based on the idea of the
best match we had found (the automatic scanning software), but this
software would have no automatic scanning. Instead, moving to the right
with your head would mean "Go to the next item," and moving to the left
would mean "Select the highlighted item." That would mean that she would
need a lot of time to get to the desired word, but it's better to be
slow than not able to select the right words at all.</p> 


<p>The
symbols would have to be put in categories, so there would be some logic
in the vocabulary she'd have on her PC. She started out with categories
like "Family," containing photos of some members of the family,
"School," containing several activities at school, and "Care," which
contained things like "going to the bathroom," "taking a shower," and
other phrases like that. </p>

<p>
By the end of January 2001 I started programming. In Perl. Maybe Perl
isn't the most logical choice for writing GUI applications for disabled
people, but Perl is my language of choice. And it turned out to be very
suitable for this job! Using Tk I quickly set up a nice looking
interface. Win32::Sound (and on Linux the Play command) enabled me to
"pronounce" the prerecorded words. Within two weeks time I had a first
version of pVoice, as I called this application (and since everyone
asks me what the 'p' stands for: 'p' is for Perl). Krista started trying
the application and was delighted. Finally she had a way to say what was
on her mind!</p> 

<p>Of course in the very beginning she didn't have much
of a vocabulary. The primary idea was to let her learn how to use it.
But every week or two we added more symbols or photos and extended her
vocabulary.</p>

<p>By the end of April 2001 I posted the code of this first pVoice version
on <a href="http://www.perlmonks.org/index.pl?node_id=75757">PerlMonks</a> and
set up a web page for people to download it if they could use it. The
response was overwhelming. Everyone loved the idea and suggestions to
improve the code or to add features came rolling in. Krista's therapists
were also enthusiastic and asked for new features too.</p>

<p>Unfortunately the original pVoice was nothing more than a quick hack to
get things going. It was not designed to add all the features people
were asking for. So I decided I had to rewrite the whole thing.
</p>

<p>This time it had to be a well-designed application. I wanted to use
wxPerl for the GUI instead of the (in my eyes) ugly Motif look of Tk, I
wanted to use a speech synthesizer instead of prerecorded .wav files, and
most importantly, I wanted to make it easier to use. The original
application was not easy to install and modifying the vocabulary was
based on the idea you knew your way around in the operating system of
your choice: you had to put files in the right directories yourself and
modify text files by hand. For programmers this is an easy task, but for
end users this turns out to be quite difficult.
</p>

<center><table width="500" border="0" cellspacing="0" cellpadding="0"><tr><td>
<p class="secondary"><img src="/pub/2003/08/28/graphics/ptypescreenshot1.gif" width="308" height="231" align="right" alt="pType Screenshot" />
</p></td></tr></table></center>


<p>It took me until the summer of 2002 before I started working on the
next pVoice release. For almost a year I hadn't worked on it at all
because of some things that happened in my personal life. Since Krista
was learning to read and write and had no way of expressing what she
could write herself, I decided not to start with rewriting pVoice
immediately, but with building pType.</p>

<p>pType would allow her to select
single letters on her screen to form words in a text entry field at
the bottom of her screen and -- if desired -- to pronounce that for
her. pType was my tryout for what pVoice 2.0 would come to be:
it used wxPerl, Microsoft Agent for speech synthesis, and was more
user-friendly. In October 2002, pType was ready and I could finally
start working on pVoice 2.0. While copying and pasting lots of the
code I wrote for pType, I set up pVoice to be as modular as possible.
I also tried to make the design extensible, so I would be able to
add features in the future -- even features I hadn't already
thought of. 
</p>

<p>In March this year it finally was time to release pVoice 2.0. It was
easy to install: it was compiled into a standalone executable using
PerlApp and by using InnoSetup I created a nice looking installer for
it. The application looked more attractive because I used wxPerl, which
gives your application the look-and-feel of the operating system it runs
on. It was user friendly because the user didn't have to modify any files
to use the application: all modifications and additions to the
vocabulary could be done within the application using easy-to-understand
dialog windows. I was quite satisfied with the result, although I
already knew I had some features to add in future releases.</p>

<h3>The Present</h3>

<center><table width="500" border="0" cellspacing="0" cellpadding="0"><tr><td>
<p class="secondary"><img src="/pub/2003/08/28/graphics/pvoice-anigif.gif" width="300" height="218" alt="pVoice animation" align="left" />
</p></td></tr></table></center>

<p>At this moment, rewriting the online help file is the last step before I
can release pVoice 2.1. That version will have support for all
Microsoft SAPI 4 compatible speech engines, better internationalization
support, the possibility to have an unlimited depth of categories
within categories (until pVoice 2.0 you had only one level of
categories with words and sentences), the possibility to define the
number of rows and columns with images yourself, and numerous small
improvements. Almost all of these improvements and feature additions
are suggested by people who tried pVoice 2.0 themselves. And that's
great news, because it means that people who need this kind of software
are discovering Open Source alternatives for the extremely expensive
commercial applications. 
</p>

<p>Many people have asked me how many
users pVoice has. That's a question I can't answer. How do you measure
the use of Open Source software? Since Jan. 1, 2003, approximately
400 people have downloaded pVoice. On the other hand, the mailing lists
have some 50 subscribers. How many people are actually using pVoice
then? I couldn't say. 
</p>

<h3>The Future</h3>

<p>I'm hoping to achieve an increase in the number of users in the next
   12 months. The Perl Foundation (TPF) has offered me one of its grants, to
   be used for promotion of pVoice. With the money I'll be travelling to
   OSCON next year and hope to speak there about pVoice. While I'm
   in Portland I'll try to get other speaking engagements in the area
   to try to convince people that they don't always need to spend so
   much money on commercial software for disabled people, but that there
   are alternatives like SueCenter and pVoice. Shortly after I heard
   about the TPF grant, I also heard that I'll be receiving a large
   donation from someone (who wishes to remain anonymous), that I can
   also use for promotion of pVoice or for other purposes like costs I
   might have to add features to pVoice. </p>
<p>
Still, a lot can be improved on pVoice itself. I want to make it more
useful for people with other disabilities than my daughter's, I would
like to have more translations of the program (currently I have Dutch
and English, and helpful people offered to translate it into German,
Spanish, French, and Swedish already), I want to support more Text To
Speech technologies than Microsoft's Speech API (like Festival), and I
would like to find the time to make the pVoice platform independent again,
because currently it only runs on Windows. I hope to write other pVoice-
like programs like pHouse, which will be based upon efforts of the <a href="http://www.misterhouse.com">MisterHouse</a> project, to be able to
control appliances in and around the house, but the main thing I need
for that is time. And with a full-time job, time is limited. </p>
<p>
Maybe, after reading all of this, you'll think, "How can I help?". Well,
there are several things you could do. First of all, if you know anyone
who works with disabled people, tell them about pVoice. Apart from
SueCenter, pVoice is the only Open Source project I know of in this
area. Lots of people who need this kind of software can't get their
insurance to pay for the software and would have to pay a lot of money.
With pVoice they have a free alternative.</p>

<p>Of course, you could also
help with the development. Since pVoice is not tied to any specific
natural language, you could help by translating pVoice into your native
tongue. Since the time I can spend on pVoice is limited, it would be
nice to have more developers on pVoice in general. More information on
pVoice is available from the <a href="http://www.pvoice.org">web site</a>. </p>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1176" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/08/21/perlcookbook.html" rel="bookmark">Cooking with Perl</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author"><a class="fn url" href="http://training.perl.com/">Tom Christiansen</a></span> on <abbr class="published" title="2003-08-21T00:00:00-08:00">August 21, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p><i>Editor's note: The new edition of <a href="http://www.oreilly.com/catalog/perlckbk2/">Perl Cookbook</a> is about to hit store shelves, so to trumpet its release, we offer some recipes--new to the second edition--for your sampling pleasure. This week's excerpts include recipes from Chapter 6 ("Pattern Matching") and Chapter 8 ("File Contents"). And be sure to check back here in the coming weeks for more new recipes on topics such as using SQL without a database server, extracting table data, templating with HTML::Mason, and more. </i></p>

<csperl file="grab" domain="on" record="b/941" template="b/article_sidebar2.view">

<h2>Sample Recipe: Matching Nested Patterns</h2>

<h3>Problem</h3>

<p>You want to match a nested set of enclosing delimiters, such as 
the arguments to a function call.</p>

<h3>Solution</h3>

<p>Use match-time pattern interpolation, recursively:</p>

<pre><code>my $np;
$np = qr{
           \(
           (?:
              (?&gt; [^(  )]+ )    # Non-capture group w/o backtracking
            |
              (??{ $np })     # Group with matching parens
           )*
           \)
        }x;</code>
</pre>

<p>Or use the Text::Balanced module's <code>extract_bracketed</code> function.</p>

<h3>Discussion</h3>

<p>The <code>$(??{ </code><i>CODE</i><code> })</code> construct runs the code 
and interpolates the string that the code returns right back into the pattern. A 
simple, non-recursive example that matches palindromes demonstrates this:</p>

<pre><code>if ($word =~ /^(\w+)\w?(??{reverse $1})$/ ) {
    print "$word is a palindrome.\n";
}</code>
</pre>

<p>Consider a word like "reviver", which this pattern correctly 
reports as a palindrome. The <code>$1</code> variable contains 
<code>"rev"</code> partway through the match. The optional word 
character following catches the <code>"i"</code>. Then the code 
<code>reverse $1</code> runs and produces <code>"ver"</code>, and that result is interpolated into the 
pattern.</p>

<p>For matching something balanced, you need to recurse, which is a 
bit tricker. A compiled pattern that uses <code>(??{ </code><i>CODE</i><code> })</code> can refer to itself. 
The pattern given in the Solution matches a set of nested parentheses, however 
deep they may go. Given the value of <code>$np</code> in that 
pattern, you could use it like this to match a function call:</p>

<pre><code>$text = "myfunfun(1,(2*(3+4)),5)";
$funpat = qr/\w+$np/;   # $np as above
$text =~ /^$funpat$/;   # Matches!</code>
</pre>

<p>You'll find many CPAN modules that help with matching (parsing) 
nested strings. The Regexp::Common module supplies canned patterns that match 
many of the tricker strings. For example:</p>

<pre><code>use Regexp::Common;
$text = "myfunfun(1,(2*(3+4)),5)";
if ($text =~ /(\w+\s*$RE{balanced}{-parens=&gt;'(  )'})/o) {
  print "Got function call: $1\n";
}</code>
</pre>

<p>Other patterns provided by that module match numbers in various 
notations and quote-delimited strings:</p>

<pre><code>$RE{num}{int}
$RE{num}{real}
$RE{num}{real}{'-base=2'}{'-sep=,'}{'-group=3'}
$RE{quoted}
$RE{delimited}{-delim=&gt;'/'}</code>
</pre>

<p>The standard (as of v5.8) Text::Balanced module provides a general 
solution to this problem.</p>

<pre><code>use Text::Balanced qw/extract_bracketed/;
$text = "myfunfun(1,(2*(3+4)),5)";
if (($before, $found, $after)  = extract_bracketed($text, "(")) {
    print "answer is $found\n";
} else {
    print "FAILED\n";
}</code>
</pre>

<h3>See Also</h3>

<p>The section on "Match-Time Pattern Interpolation" in Chapter 5, "Pattern Matching," of <a href="http://www.oreilly.com/catalog/pperl3/">Programming Perl, 3rd Edition</a>; the documentation for the Regexp::Common CPAN module and the standard Text::Balanced 
module.</p>













<h2>Sample Recipe: Pretending a String Is a File</h2>

<h2>Problem</h2>

<p>You have data in string, but would like to treat it as a file. For 
example, you have a subroutine that expects a filehandle as an argument, but you 
would like that subroutine to work directly on the data in your string instead. 
Additionally, you don't want to write the data to a temporary file.</p>

<h3>Solution</h3>

<p>Use the scalar I/O in Perl v5.8:</p>

<pre><code>open($fh, "+&lt;", \$string);   # read and write contents of $string</code>
</pre>

<h3>Discussion</h3>

<p>Perl's I/O layers include support for input and output from a 
scalar. When you read a record with <code>&lt;$fh&gt;</code>, you 
are reading the next line from <code>$string</code>. When you 
write a record with <code>print</code>, you change <code>$string</code>. You can pass <code>$fh</code> to a 
function that expects a filehandle, and that subroutine need never know that 
it's really working with data in a string.</p>

<p>Perl respects the various access modes in <code>open</code> for strings, so you can specify that the strings be 
opened as read-only, with truncation, in append mode, and so on:</p>

<pre><code>open($fh, "&lt;",  \$string);   # read only
open($fh, "&gt;",  \$string);   # write only, discard original contents
open($fh, "+&gt;", \$string);   # read and write, discard original contents
open($fh, "+&lt;", \$string);   # read and write, preserve original contents</code>
</pre>

<p>These handles behave in all respects like regular filehandles, so 
all I/O functions work, such as <code>seek</code>, <code>truncate</code>, <code>sysread</code>, and 
friends.</p>

<h3>See Also</h3>

<p>The <code>open</code> function in <em>perlfunc</em>(1) and in Chapter 29 ("Functions") of <a href="http://www.oreilly.com/catalog/pperl3/">Programming Perl, 3rd Edition</a>; "Using Random-Access I/O;" and "Setting 
the Default I/O Layers"</p>

<hr noshade="noshade" />

<p>O'Reilly &amp; Associates will soon release (August 2003) <a href="http://www.oreilly.com/catalog/perlckbk2/">Perl Cookbook, 2nd Edition.</a></p>

<ul>
    <li><a href="http://www.oreilly.com/catalog/perlckbk2/chapter/index.html">Sample Chapter 1, Strings</a> is available free online.</li>
    <li>You can also look at the <a href="http://www.oreilly.com/catalog/perlckbk2/toc.html">Table of Contents</a>, the <a href="http://www.oreilly.com/catalog/perlckbk2/inx.html">Index</a>, and the <a href="http://www.oreilly.com/catalog/perlckbk2/desc.html">full description</a> of the book.</li>
    <li>For more information, or to order the book, <a href="http://www.oreilly.com/catalog/perlckbk2/">click here</a>.</li>
</ul>

<hr noshade="noshade" />


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1182" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/08/p6pdigest/20030817.html" rel="bookmark">This week on Perl 6, week ending 2003-08-17</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-08-17T00:00:00-08:00">August 17, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Picture, if you will a sunny garden, unaffected by power cuts, floods,
plagues of frog or any of the other troubles that assail us in this
modern world. Picture, if you will, your summarizer, sat in this
garden with a laptop on his knee, cursing the inability of LCD
display manufacturers to make displays that are legible in
sunlight. Picture your summarizer returning to the comfortable chair
in the shade of his book room casting around for a witty and original
way to open another Perl 6 summary. Picture him giving up and
starting to type. Here's what he writes:</p>
<p>We start, as usual, with the the internals list.</p>

<h4><a name="tail call optimization">Tail call optimization</a></h4>
<p>Leo T&ouml;tsch has started to work on getting IMCC to detect tail
calls and optimize them to either a simple jump or an invoke. If
you're not sure what tail call optimization is I can recommend Dan's
``What the heck is a tail call?'' article on the subject.</p>
<p><a href="http://groups.google.com/groups?threadm=200308110927.h7B9RCe00848%40thu8.leo.home">http://groups.google.com/groups</a></p>
<p><a href="http://www.sidhe.org/~dan/blog/archives/000211.html">http://www.sidhe.org/~dan/blog/archives/000211.html</a> -- What the heck?</p>

<h4><a name="leo's queries from last week">Leo's QUERIES from last week</a></h4>
<p>Last week, Leo bundled up a bunch of outstanding questions for Dan,
and Dan answered them. Benjamin Goldberg queried Dan's answer about
<code>find_method</code>, which, if I'm reading things correctly is currently
implemented in the interpreter. Benjamin argued (convincingly I
thought) that, although the method hashes needed to be stored in the
interpreter structure, <code>find_method</code> should be implemented on
<code>default.pmc</code>, allowing for different classes/languages to override
its behaviour.</p>
<p><a href="http://groups.google.com/groups?threadm=3F36E05F.75A27AF0%40hotpop.com">http://groups.google.com/groups</a></p>

<h4><a name="why ~ for xor">Why <code>~</code> for xor?</a></h4>
<p>Michal Wallace wanted to know why <code>~</code> maps to both unary bitwise-not
and binary bitwise-xor in IMCC; he expected xor to be <code>^</code> and
<code>^^</code>. Leo explained that it was, at one point at least, the way Perl
6 did it but that he'd stopped keeping up with the developments in
perl6-language. He noted that, if the Perl 6 operator had been
settled, then IMCC should use that. A quick skim of my copy of <em>Perl
6 Essentials</em> tells me that Perl 6 now uses <code>+&amp;</code>, <code>+|</code> and <code>+^</code>
for bitwise and/or/xor, with <code>~&amp;</code>, <code>~|</code>, <code>~^</code> for stringwise
and/or/xor.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0308102333530.17955-100000%40hydrogen.sabren.com">http://groups.google.com/groups</a></p>
<p><a href="http://pc1.bofhadsl.ftech.co.uk:8080/archives/000011.html">http://pc1.bofhadsl.ftech.co.uk:8080/archives/000011.html</a> -- My
review of <em>Perl 6 Essentials</em></p>

<h4><a name="raising hell">Raising Hell</a></h4>
<p>Michal Wallace's Py-Pirate project continues to exercise the edges of
Parrot as he implements more and more of Python's semantics. This
time he needed to know about raising (and catching) exceptions. In
particular he wanted to be able to catch an exception when
<code>find_lex</code> failed to find an appropriately named
variable. (Currently, a <code>find_lex</code> failure doesn't raise an
exception, it just kills Parrot). Jos Visser told him that there were
plans to have <code>find_lex</code> throw a real, catchable exception, or maybe
just return <code>undef</code>. See last week's summary for a pointer to that
discussion.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0308110323070.23278-100000%40hydrogen.sabren.com">http://groups.google.com/groups</a></p>

<h4><a name="pirate status and help with instances">Pirate status and help with instances</a></h4>
<p>Michal Wallace announced that he had just finished an all night
coding spree and that Py-pirate could now handle:</p>
<ul>
<li>
functions (closures, recursion, etc)</li>
<li>
Global variables</li>
<li>
tuples (but they turn into lists)</li>
<li>
dictionaries (<code>create</code>, <code>setitem</code>, <code>getitem</code>, <code>print</code>)</li>
<li>
list comprehensions</li>
<li>
<code>raise</code> (strings only)</li>
<li>
<code>try...except</code> (partial)</li>
<li>
<code>try...finally</code></li>
<li>
<code>assert</code></li>
</ul>
<p>(At this point, I think we should all pause for moment of wild
applause).</p>
<p>However, he was having a few problems with instantiating objects of a
class. (For those who don't know, Python instances are created by
calling the Class as if it were a function). Leo T&ouml;tsch noted
that almost nothing would work, since Parrot's classes and objects
weren't actually finished yet. He agreed with others in the thread
who reckoned that Python classes could be made to work by subclassing
the standard class.pmc to allow it to respond to an <code>invoke</code> by
by creating a new instance. Easy! Michal muttered something about
faking classes with closures but I don't think he went through with it.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0308110526330.29940-100000%40hydrogen.sabren.com">http://groups.google.com/groups</a></p>

<h4><a name="packfile fun">Packfile fun</a></h4>
<p>So long <em>assemble.pl</em>, it's been good to know you.</p>
<p><a href="http://groups.google.com/groups?threadm=m2he4o9v8b.fsf%40helium.physik.uni-kl.de">http://groups.google.com/groups</a></p>

<h4><a name="approaching m4">Approaching m4</a></h4>
<p>Leon Brocard, Sean O'Rourke and James Michael DuPont looked on in awe
as Bernhard Schmalhofer announced that he'd been working on
implementing m4 in Parrot. According to Sean, the ``implications are
staggering... Sure, plenty of compilers can bootstrap themselves, but
how many can generate their own configure scripts via autoconf?  With
p4rrot, we may live to see this dream.''</p>
<p>One does worry about Sean's dream life.</p>
<p><a href="http://groups.google.com/groups?threadm=3F392C26.30500%40biomax.de">http://groups.google.com/groups</a></p>
<h4><a name="call and return conventions">Call and return conventions</a></h4>
<p>TOGoS has been thinking about the workings of the Parrot calling
conventions. He wondered if there was a case for making calling and
returning look exactly the same, allowing for cunning stunts with fake
continuations in P1. Luke Palmer really liked the idea. Leo seemed to
think it was a good idea too. There has been no word from Dan yet.</p>
<p><a href="http://groups.google.com/groups?threadm=20030813044321.55419.qmail%40web41406.mail.yahoo.com">http://groups.google.com/groups</a></p>
<h4><a name="packfile and exec">Packfile and EXEC</a></h4>
<p>Leo T&ouml;tsch has started to extend the <code>packfile</code> functions to
handle multiple code segments and has been running into problems with
EXEC -- the tool that uses the JIT to generate a native executable from
Parrot assembly. Daniel Grunblatt checked in a 'temporary' fix, which
at least solved Leo's immediate problem.</p>
<p><a href="http://groups.google.com/groups?threadm=3F39F1AC.5000303%40nextra.at">http://groups.google.com/groups</a></p>
<h4><a name="parrot 0.1.0  what's left">Parrot 0.1.0 -- what's left?</a></h4>
<p>Steve Fink thought, given the 'insane amount of work' on Parrot
recently, that it was approaching time to cut another release. He
asked if there was anything else coming up that people would like to
see included in the release, and whether we had enough to call the
next release 0.1.0. Luke Palmer really wanted to see objects finished,
but wasn't sure how much would that would entail. Leo thought that the
Parrot Calling Conventions (and more particularly the return
convention) support needed fixing, and noted that PackFile is
currently in a state of flux. Both of them thought 0.1.0 would be the
right version number though.</p>
<p><a href="http://groups.google.com/groups?threadm=20030813214453.GA8382%40foxglove">http://groups.google.com/groups</a></p>
<h4><a name="set vs. assign continues to add vs add!"><code>set</code> vs. <code>assign</code> continues to <code>add</code> vs <code>add!</code></a></h4>
<p>TOGoS wasn't keen on the variable behaviour of add depending on
whether its target was a PMC, or an integer/number register. Brent
Dax thought that TOGoS needed to train his expectations and went on
to explain why.</p>
<p>For reasons that I can't quite follow, this discussion morphed into a
polite argument between Dan and Leo about the wisdom of having all
those keyed opcodes.</p>
<p>Benjamin Goldberg pointed out that, since TOGoS's desired 'set'
semantics could easily mocked up with an assign operator (but not vice
versa), then maybe IMCC could handle mocking it up automatically.</p>
<p><a href="http://groups.google.com/groups?threadm=20030814033056.87966.qmail%40web41415.mail.yahoo.com">http://groups.google.com/groups</a></p>
<h4><a name="serializing functions">Serializing functions</a></h4>
<p>Michal Wallace wondered if it is possible to serialize a Parrot
function, or (slightly more tricky) if you could serialize a
generator and its state. Answer: Yes, it's almost done (well, the
function part anyway; Leo didn't' mention the generator thing).</p>
<p>I'm not sure if the support for this was fixed up in the packfile
changes that Leo checked in a couple of hours after his answer.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0308132149500.14468-100000%40hydrogen.sabren.com">http://groups.google.com/groups</a></p>
<h4><a name="parrot and stdout/stderr">Parrot and STDOUT/STDERR</a></h4>
<p>Arthur Bergman popped over from ponie-dev to ask about a problem he'd
been having with his parrot embedded miniperl. Apparently, if a
caller closes STDERR, the program produces no output on STDOUT
either. Leo found where the problem was happening -- Parrot was
trying to open STDERR, failing, and dying with an error message. To
STDERR. J&uuml;rgen B&ouml;mmels, the ParrotIO maintainer, outlined
a few possible fixes.</p>
<p><a href="http://groups.google.com/groups?threadm=5737C100-CE7C-11D7-8EC1-000A95A2734C%40nanisky.com">http://groups.google.com/groups</a></p>
<h4><a name="calling parrot from c">Calling Parrot from C</a></h4>
<p>Luke Palmer asked about calling a parrot sub from C and getting the
return value. Leo gave a terse answer that covered the bases and
pointed at <em>classes/Eval.pmc</em> for an implementation of something
very like the general case of calling parrot subs from C.</p>
<p><a href="http://groups.google.com/groups?threadm=20030815223815.GA25115%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>
<h4><a name="there's no undef!">There's no undef!</a></h4>
<p>Michal Wallace discovered that there seems to be no op to remove a
variable from a lexical pad. Leo patched the scratchpad PMC so that
you can now do:</p>
<pre>
    peek_pad Pn
    delete Pn[&quot;foo&quot;]</pre>
<p>to delete variable names.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0308160840390.15288-100000%40hydrogen.sabren.com">http://groups.google.com/groups</a></p>
<h4><a name="pirate 0.01 alpha!">Pirate 0.01 ALPHA!</a></h4>
<p>Michal Wallace announced the version 0.01 alpha of Pirate which he
described as ``(almost) everything I can do for Python without jumping
into C''. Which turns out to be an awful lot of stuff.</p>
<p>I've just looked back through my summary archive and, as near as I
can tell, Michal's gone from thinking about doing this to having most
of the Python syntax working in just under 3 weeks, which is really
rather scary when you think about it. Well done Michal.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0308162107030.11614-100000%40hydrogen.sabren.com">http://groups.google.com/groups</a></p>
<p><a href="http://pirate.tangentcode.com">http://pirate.tangentcode.com</a></p>
<h4><a name="timely destruction: an efficient, complete solution">Timely destruction: An efficient, complete solution</a></h4>
<p>Right at the end of the week, Luke Palmer posted another attempt to
come up with a neat solution to the timely destruction problem. I'm
guessing we'll see it discussed in next week's summary.</p>
<p><a href="http://groups.google.com/groups?threadm=20030817114814.GA5132%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>
<h4><a name="pow (parrot on win32) available">POW (Parrot on Win32) available</a></h4>
<p>A while ago now, Jonathan Worthington offered to start making regular
binary builds of Parrot for those who use Win32 but who can't compile
Parrot on it. This week he announced that he's done it. Thanks
Jonathan.</p>
<p><a href="http://groups.google.com/groups?threadm=00cc01c364d2%2496e8ba10%240100a8c0%40server">http://groups.google.com/groups</a></p>
<p><a href="http://www.jwcs.net/developers/perl/pow/">http://www.jwcs.net/developers/perl/pow/</a> -- The POW site</p>
<h4><a name="implementing nickle">Implementing Nickle</a></h4>
<p>Simon Cozens pointed the list at the nickle programming language and
wondered if it might be a suitable language to implement on Parrot.</p>
<p><a href="http://groups.google.com/groups?threadm=87zni8ouxv.fsf%40alibi.simon-cozens.org">http://groups.google.com/groups</a></p>
<p><a href="http://nickle.org/implement/html">http://nickle.org/implement/html</a> -- The Nickle site</p>
<h3><a name="meanwhile, in perl6language">Meanwhile, in perl6-language</a></h3>
<p>Traffic was light. Very light.</p>
<h4><a name="apocalypses and exegeses">Apocalypses and Exegeses</a></h4>
<p>Alberto Manuel Brand&atilde;o Sim&otilde;es, noting that the
Apocalypses and Exegeses were subject to later modification, wondered
if anyone had any idea when we'd have a freeze on the syntax and
features for Perl 6. The obvious joke -- ``Sometime after Perl 5's
syntax and features freeze'' -- was cracked. The consensus was that
the syntax is currently 'slushy', and will probably firm up in the
next 6-12 months. There was also some discussion of <em>Perl 6
Essentials</em>, and Nicholas Clark pointed us all at a new book that
Alan Burlison had found.</p>
<p><a href="http://groups.google.com/groups?threadm=1060861962.24696.21.camel%40eremita.di.uminho.pt">http://groups.google.com/groups</a></p>
<p><a href="http://bleaklow.com/blog/archive/000018.html">http://bleaklow.com/blog/archive/000018.html</a></p>
<h3><a name="acknowledgements, announcements and apologies">Acknowledgements, Announcements and Apologies</a></h3>
<p>If anyone's following the 'moving to the North East' saga, last
week's offer fell through, but that was actually a good thing as
we're now buying my daughter's Tyneside flat instead, which does
rather take some of the 'got to get everything sold by mid September'
pressure off and replaces it with 'How on earth are we going to fit
the contents of a 4 bedroomed house into a two bedroomed flat?'
pressure.</p>
<p>In case you hadn't already spotted that I was impressed, much kudos
goes to Michal Wallace for his sterling work on Pirate. Three weeks
from concept to having a huge chunk of the language implemented is
just amazing.</p>
<p>Check out <a href="http://pc1.bofhadsl.ftech.co.uk:8080/">http://pc1.bofhadsl.ftech.co.uk:8080/</a> for more of my
writing.</p>
<p>As ever, if you've appreciated this summary, please consider one or
more of the following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.
</li>
<li>
Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.
</li>
<li>
Send feedback, flames, money, requests for consultancy, photographic
and writing commissions, or some free time to
<em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em>
</li>
</ul>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1174" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/08/15/design3.html" rel="bookmark">Perl Design Patterns, Part 3</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Phil Crow</span> on <abbr class="published" title="2003-08-15T00:00:00-08:00">August 15, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>This is the third (and final) article in a series which form one Perl
programmer's response to the book <I>Design Patterns</I> (also known as the Gang
of Four book or simply as GoF, because four authors wrote it).  As I showed in
the <a href="/pub/a/2003/08/07/design2.html">second article</a>, Perl provides the types needed to implement many
patterns.  The Strategy and Template Method patterns can be implemented
with code references.  Builder usually builds a structure based on references
to some combination of hashes and lists.  Interpreters can be implemented
with simple tools like <code>split</code> or with the king: <code>Parse::RecDescent</code>, which
brings the best of yacc into your Perl script (albeit with somewhat
less efficiency than yacc).</p>
<p>This article continues my treatment by considering patterns which rely on
objects.  As such, this article's patterns bears the most resemblance to the
GoF book.  Before presenting some patterns, I'll give you my two cents about
object applicability.</p>

<h4><a name="when_are_objects_good">When Are Objects Good?</a></h4>
<p>As Larry Wall reminds us about all programming constructs, you should use
objects when they make sense and not when they don't.  So when do they
make sense?  This is partly a matter of taste.  This subsection gives you
my tastes.</p>
<p>It's easier to say when objects are bad, which they are in these cases:</p>

<!-- sidebar begins -->
<table width="220" border="0" cellspacing="8" cellpadding="4" align="right">
<tr>
<td width="220" valign="top" bgcolor="#efefef">
<div class="secondary">
<h4>More on Perl Design Patterns:</h4>
<p>
&bull; <a href="/pub/a/2003/06/13/design1.html">Perl Design Patterns, Part 1</a><br />
&bull; <a href="/pub/a/2003/08/07/design2.html">Perl Design Patterns, Part 2</a>
</p>
</div>
</td></tr></table>
<!-- sidebar ends -->

<ol>
<li>
There is only data, the methods are either trivial or non-existent.  Data
containers (also called nodes) are like this.  For example, I should not
need an object to return three numbers and a string to my caller.</li>

<li>
There are only methods.  The Java Math class is like this.  It won't even
let you make a Math object.  Clearly its methods should just be built-in
functions of the language.</li>
</ol>
<p>Seeing the poor uses of objects gives insight into their effective use.
Use objects when complexity is high and data is tightly coupled to
the methods which act on it.  High complexity makes these chief advantages
of objects more important: separate namespaces, inheritance, and polymorphism.</p>
<p>Now that I've spoken my peace, I'll go on to the patterns which use objects.</p>

<h3><a name="abstract_factory">Abstract Factory</a></h3>
<p>If you want to build platform independent programs, you need a way to access
the underlying systems without having to recode for each one's API.  This
is where a factory comes into play.  The source code asks for an instance
of a class, the class delivers a subclass instance suitable for use on
the current platform.  That class is called an abstract factory (or simply
a factory).  As we will see below, the platform might be a database.
So the factory would return an object suitable for use with a particular
database, but all the objects would have the same API.</p>
<p>To show the basic idea, here is an example which delivers one of two
types.  There are four code files in this example.  The first two are
the greeters.</p>
<pre><code>
package Greet::Repeat;

sub new {
    my $class    = shift;
    my $self     = {
        greeting =&gt; shift,
        repeat   =&gt; shift,
    };
    return bless $self, $class;
}

sub greet {
    my $self = shift;
    print ($self-&gt;{greeting} x $self-&gt;{repeat});
}

1;
</code></pre>
<p>This greeter's constructor expects a greeting and a repeat count.  It
stores these in a hash, returning a blessed reference to it.  When asked
to greet, it prints the greeting repeatedly (hence the name).  (I didn't
say this example was practical, but it is small.)</p>
<pre><code>
    package Greet::Stamp;
    use strict; use warnings;

    sub new {
        my $class    = shift;
        my $greeting = shift;
        return bless \$greeting, $class;
    }

    sub greet {
        my $greeting = shift;
        my $stamp    = localtime();
        print &quot;$stamp $$greeting&quot;;
    }

    1;</code></pre>
<p>This greeter only expects a greeting string, so it blesses a reference
to the one it receives.  When asked to greet, it prints the current time
followed by the greeting.</p>
<p>Here's the factory:</p>
<pre><code>
    package GreetFactory;
    use strict; use warnings;

    sub instantiate {
        my $class          = shift;
        my $requested_type = shift;
        my $location       = &quot;Greet/$requested_type.pm&quot;;
        my $class          = &quot;Greet::$requested_type&quot;;

        require $location;

        return $class-&gt;new(@_);
    }

    1;</code></pre>
<p>A Perl factory looks a lot like factories in other languages.
This one has only one method.  It returns the requested type to the caller.
It uses the caller's requested type as the name of the class to instantiate
and as the name of the Perl module in which the class lives.</p>
<p>Finally, you can use this factory with a script like this:</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    use GreetFactory;

    my $greeter_n = GreetFactory-&gt;instantiate(&quot;Repeat&quot;, &quot;Hello\n&quot;, 3);
    $greeter_n-&gt;greet();

    my $greeter_stamp = GreetFactory-&gt;instantiate(&quot;Stamp&quot;, &quot;Good-bye\n&quot;);
    $greeter_stamp-&gt;greet();</code></pre>
<p>To make each greeter, call the <code>instantiate</code> method of <code>GreetFactory</code>, passing
it the name of the class you want and any arguments that class's constructor
is expecting.</p>
<p>This example shows you the basic idea.  It is simple on purpose.  But it
does show how the factory can be ignorant of the underlying classes.
Any new greeter added to the system must have a name of the form <code>Greet::Name</code>
and be placed into a <code>Greet</code> subdirectory of an <code>@INC</code> path member as
<code>Name.pm</code>.  Then callers can use it without changing the factory.  Now that
you have seen a simple example, here is a more useful one.</p>
<p>The Perl DBI (DataBase Interface) provides an excellent example of a factory.
Each call to <code>DBI-</code>connect&gt;, expects the type of database and whatever
information that database needs to establish a connection.  This is a classic
factory.  It will load any DBD (DataBase Driver) you have installed
on your system, upon request.  Additional DBD's can be added at any time.
Once they are installed, any client can use them through the same
DBI API.  Here's an example use of DBI:</p>
<pre><code>
    use DBI;
    my $dbh      =
        DBI-&gt;connect(&quot;dbi:mysql:mydb:localhost&quot;, &quot;user&quot;, &quot;password&quot;);
    ...
    my $sth      = $dbh-&gt;prepare('select * from table');
    ...</code></pre>
<p>Once the database handle is obtained (which is usually called <code>$dbh</code>), it
can be used almost without regard to the underlying engine.  If you
later move to Oracle, you would merely change the connect call.
If a new database comes on the scene, some smart person in contact with
Tim Bunce will implement a class for it.  You can install and switch
to it as soon as they finish their work.  You might even be the implementer,
but I doubt I will be.</p>


<h3><a name="composite">Composite</a></h3>
<p>This pattern shows how to use the fully OO composite pattern.
If you are interested in a simpler non-OO implementation see the Builder
Pattern in Part 2 of this article series.</p>
<p>Many applications require hierarchies of related items linked into a tree
by relationship.  Many people see a hierarchy of this type:
a directory structure.  At the top is the root directory.  In the
simplest case it includes two types of items: files and subdirectories.
Each subdirectory is like the root directory.  Note that this definition
of the structure is recursive, which is typical of composites.</p>
<p>One of the most popular examples of a composite structure today is an XML
file.  These files have a root element which contains various types
of subelements, including tags and comments.  Tags have attributes
and some can contain subelements.  This makes the classic composite tree.
There are two important steps for a composite structure.  The first
is building it.  The second is using it.  We'll see simple examples of both
here.</p>
<p>For the genuine pattern, there must be methods that act on both regular
and composite elements (the elements with children are called composite
elements).  Invoking such a method on the root of a composite tree, or
subtree, causes that root to do work on its own data AND to forward the
request to its children.  Those children do the same, collecting their
own data and that of their children, until the bottom of the tree is
reached.  The return value is a collection of all this data.</p>
<p>For a practical example consider using the DOM model to process XML.
(You may obtain the <code>XML::DOM</code> module from CPAN.) To find all the paragraphs
in a document we could do something like this:</p>
<pre><code>
    use XML::DOM;
    my $parser = XML::DOM::Parser-&gt;new();
    my $doc    = $parser-&gt;parsefile(&quot;file.xml&quot;);
    foreach my $paragraph ($doc-&gt;getElementsByTagName(&quot;paragraph&quot;)) {
        print &quot;&lt;p&gt;&quot;;
        foreach my $child ($paragraph-&gt;getChildNodes) {
            print $child-&gt;getNodeValue if ($child-&gt;getNodeType eq TEXT_NODE);
        }
    }
    $doc-&gt;dispose();</code></pre>
<p>The call to <code>getElementsByTagName</code> begins at the root (since I called it
through <code>$doc</code>).  The root returns any of its children which are paragraphs,
but it also forwards the request to all of its tag elements asking them
to return their paragraphs.  They do the same.</p>
<p>An unrelated note:
Notice that the above example ends with a call to dispose.  <code>XML::DOM</code>
composite structures have references from parents to children and from
children to parents.  We usually call these circular links.  Perl 5
garbage collection cannot harvest such structures.  We must call dispose
to break the extra links so the structure's memory can be recovered.  If
you build structures with circular links, you must break those links
yourself, otherwise your program will leak memory.</p>













<p>We've seen how useful a well crafted composite structure can be, but
how could we build one for ourselves?  The objects in the structure must
all respond to the methods meant to walk the composite.  They may return
undef immediately, but they must exist.  Further, the version of those
methods in the composite objects (the ones which can have children), must
take care to pass the message along to their children.</p>
<p>To make this concrete, consider a non-binary tree (as we have been
all along).  Suppose we want to know how many nodes are in the tree.
We can ask the root to <code>count_nodes</code>.  It should count itself and add
that to the sum of <code>count_nodes</code> calls to each child.  Nodes which are
not composite (i.e. have no children) return one.  Composite nodes, return
one plus the sums from their children.  The code follows.</p>
<p>There are four pieces of code: (1) A base class for tree nodes: <code>Node.pm</code>,
(2) A class for nodes that could have children: <code>Composite.pm</code>, (3) A class
for nodes that can't have children: <code>Regular.pm</code>, and (4) a driver to
demonstrate that the system works: <code>comp</code>.  I'll show these one at a time,
in the order listed above.</p>
<pre><code>
    package Node;
    use strict; use warnings;

    sub count_nodes {
        my $self       = shift;
        my $class_name = ref $self;
        die &quot;$class_name does not implement count_nodes\n&quot;;
    }

    1;</code></pre>
<p>The only method here is <code>count_nodes</code>.  This serves as an implementation
requirement (also called an abstract method).  Attempting to use a Node
subclass which doesn't provide count_nodes results in a fatal run-time
error.  Every subclass should have an appropriate test to make sure this
error never happens to users.</p>
<pre><code>
    package Regular;

    use Node;
    @ISA = qw(Node);

    use strict; use warnings;

    sub new {
        my $class = shift;
        my $name  = shift;
        return bless \$name, $class;
    }

    sub count_nodes {
        return 1;
    }

    1;</code></pre>
<p>Regular nodes are blessed references to their names.  They always count as
a single node.  (An unrelated note: it is sometimes convenient to turn
on <code>strict</code> after the preamble of a package, here that let's me use <code>@ISA</code>
without qualifying it.)</p>
<pre><code>
    package Composite;

    use Node;
    @ISA = qw(Node);

    use strict; use warnings;

    sub new {
        my $class = shift;
        my $name  = shift;
        my $self  = { name =&gt; $name, children =&gt; [] };
        return bless $self, $class;
    }

    sub add_child {
        my $self      = shift;
        my $new_child = shift;

        push @{$self-&gt;{children}}, $new_child;
        return $new_child;
    }

    sub count_nodes {
        my $self  = shift;
        my $count = 1;

        foreach my $child (@{$self-&gt;{children}}) {
            $count += $child-&gt;count_nodes();
        }
        return $count;
    }

    1;</code></pre>
<p>This class is similar to <code>Regular</code>, but it needs a way to keep track of
children.  Since it also keeps its name, I used a hash for the object type.
New children are just pushed onto a list.  Counting includes one for the
parent node, plus the total for each child.  Since leaves of the tree
also implement <code>count_nodes</code>, we can process all <code>Node</code> types together.
This is the polymorphism advantage of objects and the heart of the Composite
Pattern.</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    use Composite;
    use Regular;

    my $root     = Composite-&gt;new(&quot;Root&quot;);

    my $eldest   = $root-&gt;add_child(Composite-&gt;new(&quot;Jim&quot;));
    my $middle   = $root-&gt;add_child(Composite-&gt;new(&quot;Jane&quot;));
                   $root-&gt;add_child(Regular-&gt;new(&quot;Bob&quot;));
    my $youngest = $root-&gt;add_child(Composite-&gt;new(&quot;Joe&quot;));

                   $eldest-&gt;add_child(Regular-&gt;new(&quot;JII&quot;));
    my $kayla    = $eldest-&gt;add_child(Composite-&gt;new(&quot;Kayla&quot;));
                   $kayla-&gt;add_child(Regular-&gt;new(&quot;Max&quot;));

    my $count = $root-&gt;count_nodes();

    print &quot;count: $count\n&quot;;</code></pre>
<p>This contrived example manually builds a simple tree, then asks for a node
count.  The correct answer is 8.</p>


<h3><a name="proxy">Proxy</a></h3>
<p>In GoF the proxy pattern example shows a way to delay loading expensive
components until the user actually wants them.  In the course of the
example they show a genuine proxy.  Proxies refer
all requests to some other object.  Think of it like an intermediary for
the mob.  You make your request to your local thug, as if he could do
the thing himself.  He passes that on to someone else you never meet
who actually does the job.  (Note to John Ashcroft: I am only imaging
this process, having NO personal experience with it.  Honest.)</p>
<p>Suppose an application could use several large files, but
usually only needs one or two.  Instead of reading all these files, I
will delay loading the file until the caller wants to see it.  The usual
warning applies: this is contrived to explain the concept.</p>
<p>Here is the class that actually stores and prints the files:</p>
<pre><code>
    package File;
    use strict; use warnings;

    sub new {
        my $class = shift;
        my $file  = shift;
        open FILE, &quot;$file&quot; or die &quot;Couldn't read $file: $!\n&quot;;
        my @data  = &lt;FILE&gt;;
        close FILE;
        return bless \@data, $class;
    }

    sub print_file {
        my $data = shift;
        print @$data;
    }

    sub DESTROY { }

    1;</code></pre>
<p>When the <code>File</code> constructor is called, it reads the file into an array for
later use, returning a blessed reference to the data to the caller.
When asked to print, it sends the data to the currently selected output
handle (usually standard out).</p>
<p>The <code>DESTROY</code> subroutine is called by Perl whenever a blessed reference is
about to go out of scope.  This allows us to perform clean-up which is
guaranteed to happen.  In this case, there is no necessary clean-up, but
the approach I'm about to show for the proxy class ends up calling this
method explicitly.  That explicit call offends Perl so much that it complains
to the screen.  To avoid the warning, I included the stub.</p>
<p>There is nothing special about the <code>File</code> class shown above.  The proxy
follows.</p>
<pre><code>
    package FileProxy;
    use strict; use warnings;

    use File;

    sub new {
        my $class = shift;
        my $self  = {
            params         =&gt; \@_,
            wrapped_object =&gt; undef,
        };
        return bless $self, $class;
    }

    sub AUTOLOAD {
        my $self    = shift;
        my $command = our $AUTOLOAD;
        $command    =~ s/.*://;

        unless (defined $self-&gt;{wrapped_object}) {
            $self-&gt;{wrapped_object} = File-&gt;new(@{$self-&gt;{params}});
        }
        $self-&gt;{wrapped_object}-&gt;$command(@_);
    }

    1;</code></pre>
<p>The constructor for the proxy takes the things necessary to build an actual
<code>File</code> object (namely the file name) and stores them as its <code>params</code>
attribute.  The other attribute will eventually hold the wrapped <code>File</code>
object.  The attributes are stored in hash, the hash's reference is
blessed and returned to the caller.</p>
<p>Whenever Perl has no where else to go with a method call, it calls
<code>AUTOLOAD</code> (if there is one).  So, the <code>AUTOLOAD</code> in FileProxy handles
all requests except <code>new</code> and <code>DESTROY</code>, which appear explicitly.
<code>AUTOLOAD</code> is all caps to remind us that Perl calls it for us.  While
making this call, Perl sets the package global variable <code>$AUTOLOAD</code> to
the name of the method the caller invoked.  The regular expression strips
off the package names from <code>$AUTOLOAD</code>, leaving only the method name.</p>













<p>If the object is not yet defined, <code>AUTOLOAD</code> calls File-&gt;new passing it the
arguments stored during construction.  After that, the object is defined,
so <code>AUTOLOAD</code> calls the requested method on the wrapped object.  The beauty
of this mechanism is that the <code>FileProxy</code> class only knows that the
constructor is called <code>new</code>.  It does not need to change as changes to
<code>File.pm</code> are made.  Any errors, such as no such method, will be fatal
as usual.</p>
<p>To use this proxied scheme we might employ a caller like this:</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    use FileProxy;

    my $file1 = FileProxy-&gt;new(&quot;art1&quot;);
    my $file2 = FileProxy-&gt;new(&quot;art2&quot;);

    $file1-&gt;print_file();
    $file1-&gt;print_file();
    $file2-&gt;print_file();</code></pre>
<p>With a couple of changes we could use this for any class.  Here's the new
generic version:</p>
<pre><code>
    package DelayLoad;
    use strict; use warnings;

    our %proxied_classes;

    sub import {
        shift;  # discard class name

        %proxied_classes = @_;

        foreach my $class (keys %proxied_classes) {
            require &quot;$class.pm&quot;;
        }
    }

    sub new {
        my $class = shift;
        my $self  = {
            type           =&gt; shift,
            constructor    =&gt; shift,
            params         =&gt; \@_,
            wrapped_object =&gt; undef,
        };
        return bless $self, $class;
    }

    sub AUTOLOAD {
        my $self    = shift;
        my $command = our $AUTOLOAD;
        $command    =~ s/.*://;

        if ($proxied_classes{$command}) {
            return $self-&gt;new($command, $proxied_classes{$command}, @_);
        }
        else {
            unless (defined $self-&gt;{wrapped_object}) {
                my $proxied_class       = $self-&gt;{type};
                my $constructor         = $self-&gt;{constructor};
                $self-&gt;{wrapped_object} = $proxied_class
                                        -&gt;$constructor(@{$self-&gt;{params}});
            }
            $self-&gt;{wrapped_object}-&gt;$command(@_);
        }
    }

    1;</code></pre>
<p>The first change is cosmetic: the name now reflects the nature of the
proxy.  Other changes include a new method: import.  Even though its name
is lower case, Perl calls it whenever the caller says <code>use DelayLoad</code> (see
below).  It does two things.  First, it stores the name of each proxied
class in the <code>%proxied_classes</code> package global.  Second, it requires each
module.  <code>require</code> is like use, but it happens at run time instead of
compile time.  (use also imports symbols, but then your object oriented
module shouldn't be exporting anything anyway.)</p>
<p>The constructor now stores a bit more information.  In addition to saving
room for the wrapped object and storing the <code>params</code>, it also records
the name of the class and of that class's constructor.  These will be
used in <code>AUTOLOAD</code>.</p>
<p>The only other changes are in the <code>AUTOLOAD</code> method.  There are two
changes.  The easiest one is to look up the class and constructor
names in the <code>DelayLoad</code> object instead of just calling File-&gt;new.</p>
<p>The other change is used during construction.  My explanation of it will
make more sense, if you see the new caller first.</p>
<p>The new version requires a couple of changes to the caller.  One change is on
the use line which becomes:</p>
<pre><code>
    use DelayLoad &quot;File&quot; =&gt; &quot;new&quot;;</code></pre>
<p>This uses <code>DelayLoad</code>, tells it we want to be able to delay
loads for <code>File</code> objects, and that <code>File</code>'s constructor is called <code>new</code>.</p>
<p>The other change is in how we construct the delayed object:</p>
<pre><code>
    my $file1 = DelayLoad-&gt;File(&quot;art1&quot;);
    my $file2 = DelayLoad-&gt;File(&quot;art2&quot;);</code></pre>
<p>This explains the unexplained piece in <code>AUTOLOAD</code> above.  When the user
calls the <code>File</code> method, <code>AUTOLOAD</code> notices that this ``method'' is
really the name of a delay loaded class.  When the <code>if</code> in <code>AUTOLOAD</code>
is true (i.e. the method is really a key in <code>%proxied_classes</code>), the caller
is given a new <code>DelayLoad</code> object primed for later use.  When the <code>if</code>
fails, <code>DelayLoad</code> works like <code>FileLoad</code>: it constructs the object, if
needed and calls the requested method.</p>
<p>The fundamental point of this example is that Perl allows us to implement
proxies without knowing very much about the underlying class.  In this
case, <code>import</code> receives the necessary information from the caller,
<code>AUTOLOAD</code> takes care of the rest.  Making the caller work is not always
a good idea.  Here it makes sense.  If she knows she wants to delay loading
objects until they are really needed, she must at least know the API for
those objects.  In the API is the name of the constructor, which she mentions
in the use statement so Perl can pass to <code>DelayLoad::import</code> for her.</p>
<p>Keep in mind that <code>AUTOLOAD</code> is not designed for this sort of work.  Its
real purpose in life is to load subroutines on demand for the current package.
It can't do that here, since changing the subroutines affects all instances
of a class.  Here we are <code>AUTOLOAD</code>ing data, not routines.
By suitably adjusting <code>import</code> and <code>AUTOLOAD</code>, you can make the proxy do
many other things.</p>


<h3><a name="summary">Summary</a></h3>
<p>In this article, I have finally shown object oriented patterns.
We saw how to implement a Factory so our callers can choose their favorite
driver, how to build composite structures and routines that
traverse them (without explicit <code>first_child</code> and <code>next</code> pointers that
would be needed in languages without quality built-in lists), and how
to stand as a proxy between a caller and a class with <code>import</code> and
<code>AUTOLOAD</code>.</p>


<h3><a name="author's_note">Author's Note</a></h3>
<p>This is the final article in this series, but look for a book, <I>Design
Patterns in Perl</I> from Apress at your favorite bookseller in the near future.</p>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1172" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/08/07/design2.html" rel="bookmark">Perl Design Patterns, Part 2</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Phil Crow</span> on <abbr class="published" title="2003-08-07T00:00:00-08:00">August  7, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>This is the second in a series of articles which form one Perl programmer's
response to the book, <i>Design Patterns</i> (also known as the Gang of Four
book or simply as GoF, because four authors wrote it).</p>

<p>As I showed in
the <a href="/pub/a/2003/06/13/design1.html">first
article</a>, Perl provides the best patterns in its core and many
others are modules which ship with Perl or are available from CPAN.
There I considered Iterator (<code>foreach</code>), Decorator (pipes and list filters),
Flyweight (<code>Memoize.pm</code>), and Singleton (bless an object in a <code>BEGIN</code> block).</p>

<p>People into patterns often talk about how knowing patterns makes describing
designs easier.  The parenthetical comments in the last sentence show how
Perl takes this to new heights by including the patterns internally.</p>

<p>This article continues my treatment by considering patterns which rely
on data containers and/or code references (which are also called callbacks).
Before showing the patterns let me explain these terms.</p>

<csperl file="grab" domain="on" record="b/936" template="b/article_sidebar2.view">

<h4><a name="data_containers">Data Containers</a></h4>
<p>I use data containers to mean any reference that holds a data structure.
Arrays and hashes are common data containers, but hashes of lists of hashes
storing things are more interesting.  Careful use of these structure
containers can often eliminate the need for objects.</p>

<p>Here's a concrete example.  Suppose I want a phone list.  I might use
a container like this:</p>
<pre><code>
    my $phone_list = {
        'phil' =&gt; [
            { type =&gt; 'home',  number =&gt; '555-0001' },
            { type =&gt; 'pager', number =&gt; '555-1000' },
        ],
        'frank' =&gt; [
            { type =&gt; 'cell',  number =&gt; '555-9012' },
            { type =&gt; 'pager', number =&gt; '555-5678' },
            { type =&gt; 'home',  number =&gt; '555-1234' },
        ],
    };</code></pre>
<p>This container is housed in a hash.  Its keys are names; its values are
phone numbers.  The numbers are listed in the order the person would like
them used.  (Call Frank on his cell phone first, then try his pager.  If
all else fails, use his home phone.)</p>
<p>To use this structure I might do the following:</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    my $phone_list = {
        'Phil' =&gt; [
            { type =&gt; 'home',  number =&gt; '555-0001' },
            { type =&gt; 'pager', number =&gt; '555-1000' },
        ],
        'Frank' =&gt; [
            { type =&gt; 'cell',  number =&gt; '555-9012' },
            { type =&gt; 'pager', number =&gt; '555-5678' },
            { type =&gt; 'home',  number =&gt; '555-1234' },
        ],
    };

    my $person = shift or die &quot;usage: $0 person\n&quot;;

    foreach my $number (@{$phone_list-&gt;{$person}}) {
        print &quot;$number-&gt;{type} $number-&gt;{number}\n&quot;;
    }</code></pre>
<p>Here, the user supplies the name of the person he or she wants to reach
as a command line argument which I store as <code>$person</code>.  I then loop through
all the phone numbers for that person, printing the type and number.</p>
<p>Of course, in practice your data would live outside your script.  The
example just shows what one data container can hold.</p>
<p>If you need to use a structure made of data nodes, you can often avoid
the need for a node object by using a data container instead.  Object
Oriented programming proponents would probably want me to make an object
for each person.  In that object they might even want me to store an
object for each phone type in some cumbersome list container.  My advice:
don't give in to pedants.  Even in Java, I can build a structure like
the one above (though not as easily).  Doing so is often wise.  Objects
work better in more complex situations.</p>


<h4><a name="what's_a_code_reference">What's a Code Reference?</a></h4>
<p>A code reference is like any reference in Perl, but what it points to
is a subroutine you can call.  For instance, I could write:</p>
<pre><code>
    my $doubler = sub { return 2 * $_[0]; };</code></pre>
<p>Then later in my program I would call that routine as:</p>
<pre><code>
    my $doubled = &amp;$doubler(5);  # $doubled is now 10</code></pre>
<p>This example is contrived.  But it lets you see the basic syntax of code
references.  If you assign a sub to a variable, you receive a code reference
by the grace of Perl.  To call the sub stored in the reference put an
<code>&amp;</code> in front of the variable which stores it.  This is like we do for other
references, as in this standard hash walker:</p>
<pre><code>
    foreach my $key (keys %$hash_reference) { ... }</code></pre>
<p>The <code>&amp;</code> is the sigil (or funny character) for subroutines, just like <code>@</code>
and <code>%</code> are the sigils for arrays and hashes.</p>
<p>Many patterns in GoF and outside it can be implemented well in Perl with
code references.  Languages which don't provide code references are missing
an important type.</p>
<p>Having explained these tools, I'm ready to show you some patterns which
use them.</p>




<h3><a name="strategy">Strategy</a></h3>
<p>When you want to select from a series of choices for how something should
be done, you need a strategy scheme.  For example, you might want to
sort based on a comparison function.  Each time you sort, you should
be able to specify the order strategy.</p>
<p>Since Perl has code references, we can easily implement the strategy
pattern without bloating our code base with a proliferation of classes
whose sole purpose is to provide one function.</p>
<p>Here's an example with the built-in sort:</p>
<pre><code>
    sort { lc($a) cmp lc($b) } @items</code></pre>
<p>This sorts without regard to case.  Notice how <code>sort</code> is receiving the
function directly in the call.  Though we could do this for our own
functions, it is more common to take a reference to the function as
a required positional parameter.</p>
<p>Suppose, for example, that we want to list all files in the current
directory, or any of its subdirectories, with some property.  There
are two pieces to this task: (1) Scan down the directory tree for
all the entries, and (2) Test each file to see if it meets the criterion.
Ideally we would like to separate these tasks so we can reuse them
independently (for instance scanning a directory tree is more common than
any particular criterion).  We will make the criterion a strategy executed
by the directory scanner.</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    my @files = find_files(\&amp;is_hidden, &quot;.&quot;);
    local $&quot; = &quot;\n&quot;;
    print &quot;@files\n&quot;;

    sub is_hidden {
        my $file = shift;
        $file    =~ s!.*/!!;
        return 0 if ($file =~ /^\./);
        return 1;
    }

    sub find_files {
        my $callback = shift;
        my $path     = shift;
        my @retval;

        push   @retval, $path if &amp;$callback($path);
        return @retval unless (-d $path);

        # identify children
        opendir DIR, $path or return;
        my @files = readdir DIR;
        closedir DIR;

        # visit each child
        foreach my $file (@files) {
            next if ($file =~ /^\.\.?$/);  # skip . and ..
            push @retval, find_files(&quot;$path/$file&quot;, $callback);
        }

        return @retval;
    }</code></pre>
<p>To understand this example, start with the initial call to <code>find_files</code>.
It passes two arguments.  The first is a code reference.  Note the syntax.
As I pointed out in the introduction, to let Perl know I mean a subroutine,
I put the <code>&amp;</code> sigil in front of <code>is_hidden</code>.  To make a reference to that
routine (instead of calling it immediately), I put a backslash in
front, just as I would to take any other kind of reference.</p>
<p>When I use the callback in <code>find_files</code>, <code>$callback</code> has the reference to
the code.  To dereference it I put the <code>&amp;</code> sigil in front of it.</p>
<p>The <code>find_files</code> subroutine takes a path where the search begins and a
code reference called <code>$callback</code>.  At each invocation, it stores the path
in the return list, if callback returns true for that path.  This allows
you to reuse <code>find_files</code> for many applications, changing only the callback
subroutine to change the outcome.  This is the strategy pattern, but
without the hassle of subclassing the <code>find_files</code> abstract base class
and overriding the criterion method.</p>
<p>In <code>find_files</code>, I use recursion to descend the directory tree and its
subtrees.  First, I call the callback to see if the current path should
go into the output.  Then the real routine begins.  What the callback
does makes no difference to this routine.  Any true or false value is OK
with <code>find_files</code>.</p>
<p>The recursion stops if the file is not a directory.  At that point the
list is immediately returned.  (It could be empty or have the current path
in it, depending on the callback's return value.)  Otherwise, all the files and
subdirectories in the current path are read into <code>@files</code>.  Each of those
entries is scanned by the recursive call to find_files (unless the file
is . or .., which would create endless recursion).  Whatever the recursive
call to <code>find_files</code> returns, it is pushed onto the end of the final output.
When all children have been visited, <code>@result</code> is returned to the caller.</p>
<p>The CPAN module <code>File::Find</code> robustly solves the problem approached quickly
in my example above.  It relies on exactly this kind of function callback.</p>
<p>The Strategy Pattern uses a callback to perform a single task that varies
from use to use.  The next pattern uses a series of callbacks to implement
the steps of an algorithm.</p>














<h3><a name="template_method">Template Method</a></h3>
<p>In some calculations the steps are known, but what the steps do is not.
For example, computing charges for a rental might involve three steps:</p>
<ol>
<li>
Calculate amount due from rates.</li>

<li>
Calculate taxes.</li>


<li>
Add these together.</li>

</ol>
<p>Yet different rentals might have different schemes for calculating the amount
due from rates, and different jurisdictions usually have different tax schemes.
A template method can implement the outline, deferring to callers for
the individual schemes.</p>
<pre><code>
    package Calc;
    use strict; use warnings;

    sub calculate {
        my $class     = shift;   # discarded
        my $data      = shift;
        my $rate_calc = shift;   # a code ref
        my $tax_calc  = shift;   # also a code ref

        my $rate      = &amp;$rate_calc($data);
        my $taxes     = &amp;$tax_calc($data, $rate);
        my $answer    = $rate + $taxes;
    }</code></pre>
<p>Here the caller supplies a data reference (probably to a hash or object)
together with two code references which are used as callbacks.  Each
callback must expect the data reference as its first parameter.  The <code>tax_calc</code>
code reference also receives the amount due from the rate calculator.
This allows it to use a percentage of the amount together with information in
the data reference.</p>
<p>A caller might look like this:</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    use Calc;

    my $rental = {
        days_used    =&gt; 5,
        day_rate     =&gt; 19.95,
        tax_rate     =&gt; .13,
    };

    my $amount_owed = Calc-&gt;calculate($rental, \&amp;rate_calc, \&amp;taxes);
    print &quot;You owe $amount_owed\n&quot;;

    sub rate_calc {
        my $data = shift;
        return $data-&gt;{days_used} * $data-&gt;{day_rate};
    }

    sub taxes {
        my $data     = shift;  # discarded
        my $subtotal = shift;

        return $data-&gt;{tax_rate} * $subtotal;
    }</code></pre>
<p>I made this contrived caller so you can see the calling sequence.  The
data here is a simple hash.  To save exporting from <code>Calc</code>, I made calculate
a class method, so I call it through its class.  In the call, I pass a
reference to my data hash and references to the two calculation routines.</p>
<p>This can be made more complex if you like.  One could even make a full-blown
class hierarchy of calculators, allowing callers to select the one they want.
This example is about as simple as I could make the template method pattern.</p>
<p>Another approach to templates is to have the caller place methods in
the template package.  This approach amounts to an implementation of
mixins a la Ruby.  Here's a sample that is more object oriented.</p>
<pre><code>
    package Calc;

    sub calculate {
        my $self = shift;
        my $rate = $self-&gt;calculate_rate();
        my $tax  = $self-&gt;calculate_tax($rate);
        return $rate + $tax;
    }

    1;</code></pre>
<p>The whole module is really only the template method.  To use it, you
have to code <code>calculate_rate</code> and <code>calculate_tax</code> methods, or your script
will die.  Here's a particular implementation of the scheme:</p>
<pre><code>
    package CalcDaily;
    package Calc;
    use strict; use warnings;

    sub new {
        my $class = shift;
        my $self  = {
            days_used    =&gt; shift,
            day_rate     =&gt; shift,
            tax_rate     =&gt; shift,
        };
        return bless $self, $class;
    }

    sub calculate_rate {
        my $data = shift;
        return $data-&gt;{days_used} * $data-&gt;{day_rate};
    }

    sub calculate_tax {
        my $data     = shift;  # discarded
        my $subtotal = shift;

        return $data-&gt;{tax_rate} * $subtotal;
    }

    1;</code></pre>
<p>Note that I added a constructor and two methods to the <code>Calc</code> package
in a different source file.  This is perfectly legal and occasionally useful.
By doing this, the template is totally isolated.  It doesn't even know
what sort of data will be stored in the objects of its own type.  That
does mean that only one <code>Calc</code> subtype can be used at a time.  If that's
a problem for you, do the standard thing: have <code>Calc</code> call methods on objects
in some separate hierarchy.</p>
<p>There are two package statements at the top of the file, this is on purpose.
The first one tells people (and crawlers) that this is the <code>CalcDaily</code>
package which rightfully belongs in <code>CalcDaily.pm</code>, not the original <code>Calc</code>, which belongs in <code>Calc.pm</code>.</p>
<p>Finally, here's the caller, which is only slightly modified:</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;
    use Calc;
    use CalcDaily;

    my $rental      = Calc-&gt;new(5, 19.95, .13);
    my $amount_owed = $rental-&gt;calculate();
    print &quot;You owe $amount_owed\n&quot;;</code></pre>
<p>This technique is similar to the one used in the debugger architecture
for Perl.  To make my own debugger, I need a name for it.  I might choose
<code>PhilDebug.pm</code>.  Then I have to make a file with that name in a Devel
directory which is in my <code>@INC</code> list.  The first line in the
file should be (but doesn't have to be):</p>
<pre><code>
    package Devel::PhilDebug;</code></pre>
<p>This allows the CPAN indexer to properly catalog my module.</p>
<p>The base package for debuggers is fixed as <code>DB</code>.  Perl expects to call
the <code>DB</code> function in that package.  So all together it might look something
like this:</p>
<pre><code>
    package Devel::PhilDebug;
    package DB;

    sub DB {
        my @info = caller(0);
        print &quot;@info\n&quot;;
    }

    1;</code></pre>
<p>Any script will use this debugger if it is invoked as:</p>
<pre><code>
    perl -d:PhilDebug script</code></pre>
<p>Each time the debugger notices that a new statement is about to start, it
first calls <code>DB::DB</code>.  This is a very powerful example of plug-and-play.</p>
<p>It is not usually wise to pollute foreign classes with your own code.
Yet, Perl permits this, because it is sometimes highly useful.  There
seems to be a theme here:</p>
<p><strong>Don't rule out dangerous things.  Just avoid them,
unless you have a good reason to use them.</strong></p>
<p>The Strategy and Template patterns use code references to allow the caller
to adjust the behavior of an algorithm.  The template I showed used a data
container to hold rental information.  The next pattern makes more use
of data containers.</p>




<h3><a name="builder">Builder</a></h3>
<p>Many structures external to your program should be represented with
composites (like trees or the data container in the introduction) inside
your program.  There are two fundamentally different ways to represent
these structures.  For an object-oriented way to compose such structures
see the Composite Pattern in GoF (which I will discuss in my next article).</p>
<p>Here we'll look at how to build a composite structure in a hash of hashes.
You might rather build the objected-oriented version.  Which you choose
should depend on the complexity of the data and the methods to act on it.
If data and methods are simple, you should probably use the hash structure.
It will be faster, have built-in support, and be more familiar to Perl
programmers who might need to maintain your code.  If the complexities are
large, you should use full-blown objects.  They make the structure easier
to understand for object-oriented programmers and provide more code-based
documentation than simple hashes.</p>













<p>So, hashes are superior structures for simple to moderately
complex data.  To see how to build a hash structure consider an example:
visualizing an outline.  For simplicity, I'll represent the outline
purely through indentation (not with Roman or other numerals).  Here's an
example outline:</p>
<pre><code>
    Grocery Store
        Milk
        Juice
        Butcher
            Thin sliced ham
            Chuck roast
        Cheese
    Cleaners
    Home Center
        Door
        Lock
        Shims</code></pre>
<p>This outline describes a theoretical shopping trip.  I want to represent
it internally in my program so I can play with it.  (One of my favorite
games is turning outlines into pictures, see below.)</p>
<p>Instead of a full-blown object, I'll use a little hash-based data container
for each node in the tree.  Each node will keep track of three things:</p>
<ol>
<li>
Name</li>


<li>
Level</li>


<li>
Children (a list of other nodes)</li>

</ol>
<p>To keep track of who is a child of whom, I'll use a stack of these nodes.
The node on the top of the stack is usually the parent of the next line of
input.  To show my method, I'll intersperse comments with the script.  At
the bottom of this section the script appears in one piece.</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;</code></pre>
<p>These lines are always a good idea.</p>
<pre><code>
    my $root = {
        name     =&gt; &quot;ROOT&quot;,
        level    =&gt; -1,
        children =&gt; [],
    };</code></pre>
<p>This is the root node.  It's a hash reference containing the three keys
mentioned earlier.  The root node is special.  Since it isn't in the file,
I give it an artificial name and a level that is lower than anyone else's.
(In a moment, we will see that levels in the input will be zero or positive.)
Initially the list of children is empty.</p>
<pre><code>
    my @stack;
    push @stack, $root;</code></pre>
<p>The stack will keep track of the ancestry of each new node.  For starters
it needs the root node, which won't ever be popped, because it is an ancestor
of all the nodes.</p>
<pre><code>
    while (&lt;&gt;) {
        /^(\s*)(.*)/;
        my $indentation = length $1 if defined ($1);
        my $name        = $2;</code></pre>
<p>To read the file, I chose a magic <code>while</code>.  For each line there will be two
parts: the indentation (the leading spaces) and the name (the rest of the
line).  The regular expression captures any leading space into <code>$1</code> and
everything else (except the new line) into <code>$2</code>.  The length of the
indentation is the important part, the bigger this is the more ancestors
the node has.  Lines starting at the margin have an indentation of 0
(which is why the <code>ROOT</code> has a level of -1).</p>
<pre><code>
        while ($indentation &lt;= $stack[-1]{level}) {
            pop @stack;
        }</code></pre>
<p>This loop handles ancestry.  It pops the stack, until the node on top of
the stack is the parent of the new node.  Think of an example.
When <code>Home Center</code> comes along, <code>Cleaners</code> and <code>ROOT</code> are on the stack.
<code>Home Center</code>'s level is 0 (it's at the margin), so is <code>Cleaners</code>'.  Thus,
<code>Cleaners</code> is popped (since 0 &lt;= 0).  Then only <code>ROOT</code> remains, so popping
stops (0 is not &lt;= -1).</p>
<pre><code>
        my $node = {
            name     =&gt; $name,
            level    =&gt; $indentation,
            children =&gt; [],
        };</code></pre>
<p>This builds a new node for the current line.  It's name and level are set.
We haven't seen any children yet, but I make room for them in an empty list.</p>
<pre><code>
        push @{$stack[-1]{children}}, $node;</code></pre>
<p>This line adds the new node to its parent's list of children.  Remember
that the parent is sitting on top of the stack.  The top of the stack is
<code>$stack[-1]</code> or the last element in the array.</p>
<pre><code>
        push @stack, $node;
    }</code></pre>
<p>This pushes the new node onto the stack, in case it has children.  The
closing brace ends the magic <code>while</code> loop.  For simplicity, I chose to
display the output with <code>Data::Dumper</code>:</p>
<pre><code>
    use Data::Dumper; print Dumper($root);</code></pre>
<p>Running this shows the tree (sideways) on standard out.</p>
<p>Here's the whole code without interruption:</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    my $root = {
        name     =&gt; &quot;ROOT&quot;,
        level    =&gt; -1,
        children =&gt; [],
    };

    my @stack;
    push @stack, $root;

    while (&lt;&gt;) {
        /^(\s*)(.*)/;
        my $indentation = length $1;
        my $name        = $2;
        while ($indentation &lt;= $stack[-1]{level}) {
            pop @stack;
        }
        my $node = {
            name     =&gt; $name,
            level    =&gt; $indentation,
            children =&gt; [],
        };
        push @{$stack[-1]{children}}, $node;
        push @stack, $node;
    }

    use Data::Dumper; print Dumper($root);</code></pre>
<p>I promised to explain how structures like the one above can be turned into
pictures.  The CPAN module <code>UML::Sequence</code> builds a structure similar to the
one shown here.  It then uses that to generate a UML Sequence diagram of
the steps in SVG (Scalable Vector Graphics) format.  That format can
be converted with standard tools like Batik to PNG or JPEG.  In practice
the outlines which I turn into pictures represent call sequences for
programs.  Perl can even generate the outline by running the program.
See <code>UML::Sequence</code> for more details.</p>
<p>When you have some interesting structured input, a builder might help
make a good internal structure.  One high value builder is <code>XML::DOM</code>.
Another with a slightly different approach is <code>XML::Twig</code>.  It is not
coincidental that XML parsers are really builders, as XML files are
non-binary trees.</p>




<h3><a name="interpreter">Interpreter</a></h3>
<p>If you haven't looked in GoF yet, start with the interpreter pattern.
Laughter is good for the soul.  The person who taught me patterns in
Java did not even know why this pattern would not work in practice.
He had heard it was somewhat slow, but he wasn't sure.  Well I'm sure.</p>
<p>Luckily for us, Perl has alternatives.  These range from quick and dirty
to full blown.  Here's the litany covered with examples below:</p>
<ul>
<li>
<code>split</code></li>


<li>
<code>eval</code>'ing Perl code</li>


<li>
<code>Config::Auto</code></li>


<li>
<code>Parse::RecDescent</code></li>

</ul>
<p>Since we already have a language we like (that's Perl for those who haven't
been paying attention), interpreting is limited to small languages that
do something for us.  Usually these turn out to be configuration files,
so I will focus on those.  (See the builder section above if a tree can
represent your data file.)</p>


<h4><a name="splitting">Splitting</a></h4>
<p>The easiest route involves <code>split</code>.  Suppose I have a config file which
uses <code>variable=value</code> settings.  Comments and blanks should be ignored,
all other lines should have a variable, value pair.  That's easy:</p>
<pre><code>
    sub parse_config {
        my $file = shift;
        my %answer;

        open CONFIG, &quot;$file&quot; or die &quot;Couldn't read config file $file: $!\n&quot;;
        while (&lt;CONFIG&gt;) {
            next if (/^#|^\s*$/);  # skip blanks and comments
            my ($variable, $value) = split /=/;
            $answer{$variable} = $value;
        }
        close CONFIG;

        return %answer;
    }</code></pre>
<p>This subroutine expects a config file name.  It opens and reads that file.
Inside the magic <code>while</code> loop the regex rejects lines which start with '#'
and those which contain only whitespace.  All other lines are split on '='.
The variables become keys in the <code>%answer</code> hash.  When all the lines are read,
the caller gets the hash back.</p>
<p>You could go much further along these lines, but see below for those who've
gone before you (see especially <code>Config::Auto</code>).</p>


<h4><a name="evaluating_perl_code">Evaluating Perl Code</a></h4>
<p>My current favorite way to bring configuration information into a Perl program
is to specify the config file in Perl.  So, I might have a config file like
this:</p>
<pre><code>
    our $db_name = &quot;projectdb&quot;;
    our $db_pass = &quot;my_special_password_no_one_will_think_of&quot;;
    our %personal = (
        name    =&gt; &quot;Phil Crow&quot;,
        address =&gt; &quot;philcrow2000@yahoo.com&quot;,
    );</code></pre>
<p>To use this in a Perl program all I have to do is eval it:</p>
<pre><code>
    ...
    open CONFIG, &quot;config.txt&quot; or die &quot;couldn't...\n&quot;;
    my $config = join &quot;&quot;, &lt;CONFIG&gt;;
    close CONFIG;

    eval $config;
    die &quot;Couldn't eval your config: $@\n&quot; if $@;
    ...</code></pre>
<p>To read the file, I open it, then use join to put the angle read operator
in list context.  This lets me bring the whole file into a scalar.  Once
it's in (and the file is closed for tidiness), I just eval the string I read.
I need to check <code>$@</code> to make sure the file was good Perl.  After that, I'm
ready to use the values just as if they appeared in the program originally.</p>













<h4><a name="config::auto__for_those_who_can't_be_bothered">Config::Auto -- For Those Who Can't be Bothered</a></h4>
<p>If you're too lazy to write your own config handler, or if you have lots
of configs outside your control, <code>Config::Auto</code> may be for you.  Basically,
it takes a file and guesses how to turn it into a config hash.  (It
can even guess the name of your config file).  Using it is easy (if it works):</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    use Config::Auto;

    my $config = Config::Auto::parse(&quot;your.config&quot;);
    ...</code></pre>
<p>What ends up in <code>$config</code> depends on what your config file looks like (shock).
For files which use <code>variable=value</code> pairs, you get what you expect, which
is exactly what the first example above generates for the same input.  It
is possible to specify a config file that <code>Config::Auto</code> cannot understand
(shock and amazement).</p>


<h4><a name="real_hackers_use_parse::recdescent">Real Hackers Use Parse::RecDescent</a></h4>
<p>If the file you need to parse is complex, consider <code>Parse::RecDescent</code>.
It implements a clever top/down parser scheme.  To use it, you specify
a grammar.  (You remember grammars, don't you?  If not, see below.)  It
builds a parser from your grammar.  You feed text to the parser.  It does
whatever the grammar specifies in its actions.</p>
<p>To give you a feel for how this works, I'll parse small Roman numerals.
The program below takes numbers from the keyboard and translates them
from Roman numerals to decimal integers, so XXIX becomes 29.</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    use Parse::RecDescent;

    my $grammar = q{
        Numeral : TenList FiveList OneList /\Z/
                    { $item[1] + $item[2] + $item[3]; }
                | /quit/i { exit(0); }
                | &lt;error&gt;

        TenList : Ten(3)                  { 30            }
                | Ten(2) OptionalNine     { 20 + $item[2] }
                | Ten OptionalNine        { 10 + $item[2] }
                | OptionalNine            { $item[1]      }

        OptionalNine : One Ten { 9 }
                     |         { 0 }

        FiveList : One Five { 4 }
                 | Five     { 5 }
                 |          { 0 }

        OneList : /(I{0,3})/i { length $1 }

        Ten : /X/i

        Five : /V/i

        One : /I/i
};</code></pre>
<p>my $parse = new Parse::RecDescent($grammar);</p>
<p>while (&lt;&gt;) {
    chomp;
    my $value = $parse-&gt;Numeral($_);
    print ``value: $value\n'';
}</p>
<p>As you can see <code>$grammar</code> takes up most of the space in this program.
The rest is pretty simple.  Once I receive the parser from the
<code>Parse::RecDescent</code> constructor, I just call its Numeral method repeatedly.</p>
<p>So what does the grammar mean?  Let's start at the top.  Grammars are
built from rules.  The rule for a Numeral (the Roman kind) says:</p>
<pre><code>
    A Numeral takes the form of one of these choices
        a TenList then a FiveList then a OneList then the end of the string
        OR
        the word quit in any case (not a Numeral, but a way to quit)
        OR
        anything else, which is an error</code></pre>
<p>We'll see what TenList and its friends are shortly.  The code after
the first choice is called an action.  If the rule matches a possibility,
it performs that possibility's action.  So if a valid Numeral is seen,
the action is executed.  This particular action adds up the values
TenList, FiveList, and OneList have accumulated.  The items are numbered
starting with 1, so TenList's value is in <code>$item[1]</code>, etc.</p>
<p>How does TenList get a value?  Well, when Numeral starts matching, it looks
first for a valid TenList.  There are four choices:</p>
<pre><code>
    A TenList takes the form of one of these choices
        three Tens
        OR
        two Tens then an OptionalNine
        OR
        a Ten then an OptionalNine
        OR
        an OptionalNine</code></pre>
<p>These choices are tried in order.  A Ten is simply an upper- or lower-case
X (see the Ten rule).  The result of an action is the result of its last
statement.  So, if there are three tens, the TenList returns 30.  If there
are two tens, it returns 20 plus whatever OptionalNine returned.</p>
<p>The Roman numeral IX is our 9.  I call this an OptionalNine.  (The names
are completely arbitrary.)  So after zero, one, or two X's, there can be
an IX which adds 9 to the total.  If there is no IX, the OptionalNine will
match the empty rule.  That consumes no text from the input and returns
zero according to its action.</p>
<p>Roman numerals are a lot more complex than my little grammar can handle.
For starters, by my calendar, we're now in the year MMIII.  There are no
M's in my grammar.  Further, some Romans thought that IIIIII was perfectly
valid.  In my grammar three is the limit for all repetitions, and only I
and X can repeat.  Further, reductions can only take one away.  So, IIX
is not eight, it's invalid.  This grammar can recognize any normalized
Roman numeral up to 38.  Feel free to expand it.</p>
<p><code>Parse::RecDescent</code> is not as fast as a yacc-generated parser, but it is
easier to use.  See the documentation in the distribution for more
information, especially the tutorial which originally appeared in The
Perl Journal.</p>
<p>If you look at what's inside the parser (say with <code>Data::Dumper</code>) you might
think this actually implements the interpreter pattern.  After all, it
makes a tree of objects from the grammar.  Look closer and you will see
the key difference.  All of the objects in the tree are members of
classes of like <code>Parse::RecDescent::Action</code>, which were written by Damian
Conway when he wrote the module.  In the GoF interpreter pattern we are
expected to build a class for each non-terminal in the grammar (above
those classes would be Numeral, ReducedTen, etc.).  Thus, the tree node
types are different for each grammar.</p>
<p>This difference has two implications: (1) it makes the <code>RecDescent</code> parser
generator simpler and (2) it's result faster.</p>




<h3><a name="summary">Summary</a></h3>
<p>In this installment we have seen how to use code references to implement
the Strategy and Template Method patterns.  We even saw how to force
our code into someone else's class.  Builder turns text into an internal
structure, which most Interpreters also do.  Those
structures can often be simple combinations of hashes, lists, and scalars.
If what you need to read is simpler, use split or <code>Config::Auto</code>.
If it is more complex, use <code>Parse::RecDescent</code>.  If that won't do it fast
enough, you might need one of the yaccs.</p>
<p>Next time I will look at patterns which actually rely on objects.</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1180" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2003/08/p6pdigest/20030803.html" rel="bookmark">This week on Perl 6, week ending 2003-08-03</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2003-08-03T00:00:00-08:00">August  3, 2003 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<p>&quot;Ooh look, it's another Perl 6 summary. Doesn't that man ever take a
holiday?&quot; <br />
&quot;I think he took one last month.&quot;<br />
&quot;Is it in Esperanto this week?&quot;<br />
&quot;I don't think so.&quot;<br />
&quot;Does Leon Brocard get a mention?&quot;<br />
&quot;It certainly looks that way.&quot;<br />
&quot;Does is start with the internals list again?&quot;<br />
&quot;I think it does, in fact, here it comes now.&quot;</p>

<h4><a name="approaching python">Approaching Python</a></h4>
<p>Discussions (and coding) of the Parrot implementation of Python
continued this week. Michal Wallace is working on taking a preexisting
(but incomplete, it's a proof of concept only) python parse tree -&gt;
parrot code generator and rejigging it to generate code for
IMCC. Assuming the initial rejig is doable, Michal surmises that
getting a complete python compiler will be 'just' a matter of fleshing
out the rest of the visitor methods, 'and then dealing with the
C-stuff.'</p>
<p>Actually, the main strand of this discussion dealt with ways of
extending IMCC to help optimize the translation of stack based code
to code that uses registers more efficiently (register unspilling as
Benjamin Goldberg called it), which should help with any bytecode
translator based efforts.</p>
<p><a href="http://groups.google.com/groups?threadm=3F2473A4.EED8FE8D%40hotpop.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0307281006310.18437-100000%40hydrogen.sabren.com">http://groups.google.com/groups</a></p>
<h4><a name="semantics of clone for pioobjects">Semantics of clone for PIO-objects</a></h4>
<p>J&uuml;rgen B&ouml;mmels' work on the Parrot IO system continues to
find edge cases in Parrot's memory management subsystem.  As initially
written, a clone call adds a reference to a ParrotIO object, but that
object is neither garbage collected nor refcounted, and it gets
destroyed when its first reference is destroyed. The problem can be
solved by allocating a new ParrotIO in the clone call, but
J&uuml;rgen had some questions about how to handle various things
like what to do with buffering or position pointers.</p>
<p>Jos Visser offered a suggestion involving indirection and reference
counting which met with (at least) Melvin Smith's approval.</p>
<p><a href="http://groups.google.com/groups?threadm=m24r167p89.fsf%40helium.physik.uni-kl.de">http://groups.google.com/groups</a></p>
<h4><a name="making 'make' less verbose">Making 'make' less verbose</a></h4>
<p>Leo T&ouml;tsch checked in a patch to make make's output rather less
verbose. After the patch, the make process only echos the name of the
file being compiled, and doesn't spam your terminal with the entire
compiler commandline (the compiler warnings do that). Some people
liked this. Others didn't.</p>
<p><a href="http://groups.google.com/groups?threadm=3F25264A.4070506%40nextra.at">http://groups.google.com/groups</a></p>
<h4><a name="don't trace system areas in sweep ops">Don't trace system areas in sweep ops</a></h4>
<p>One of the things we discussed at the Parrot BOF was how to solve the
'bogus objects' problem when doing timely destruction sweeps (The
'bogus objects' problem is when the stack walk code detects chimerical
objects through holes in the C stack (hmm... if anyone has a good
drawing of this?)). After much discussion we came to the conclusion
that the trick was to only walk the system stack during DOD (Dead
Object Detection) runs that got triggered via resource
starvation.</p>
<p>This works because &quot;There is nothing unanchored and alive beyond the
runloop's stack&quot;. Brent Dax was impressed, but then, he wasn't at the
BOF so he doesn't know how long it took us to get to the answer.</p>
<p><a href="http://groups.google.com/groups?threadm=3F252519.9060406%40nextra.at">http://groups.google.com/groups</a></p>
<h4><a name="user defined events">User defined events</a></h4>
<p>Klaas-Jan Stol wondered if there would be some way of generating and
posting user defined events. Uri Guttman thought that there probably
would be.</p>
<p><a href="http://groups.google.com/groups?threadm=BAY1-DAV50Vo2Zz8dmY0000ac49%40hotmail.com">http://groups.google.com/groups</a></p>
<h4><a name="php/parrot">PHP/Parrot</a></h4>
<p>The language implementation insanity continues!</p>
<p>Stephen Thorne announced that he's working on implementing a PHP
parser and is seriously considering targetting Parrot. He asked for
pointers to good docs on how to go about doing so. He worried a
little about bootstrapping as well.</p>
<p>Luke Palmer and Simon Glover were forthcoming with lots of useful
answers and pointers.</p>
<p><a href="http://groups.google.com/groups?threadm=200307291609.46294.stephen%40mu.com.au">http://groups.google.com/groups</a></p>
<h4><a name="why parrot uses continuation passing style">Why Parrot uses Continuation Passing Style</a></h4>
<p>In a delayed response to a question from Klaas-Jan Stol, Dan has
posted a long message on the reasons for choosing Continuation
Passing Style as Parrot's calling convention. It's definitely worth
the read if you're at all interested in the reasoning behind Parrot
(and the reason that my copy of <em>Perl 6 Essentials</em> has a signed
correction from Dan).</p>
<p><a href="http://groups.google.com/groups?threadm=a0521060ebb4c371912c0%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>
<h4><a name="imcc supports the parrot calling conventions">IMCC supports the Parrot Calling Conventions</a></h4>
<p>Leo announced that IMCC's brand of assembler, PIR (I can't remember
what it stands for, Parrot Intermediate Representation perhaps). Of
course, there are things it doesn't quite do yet (tail call
detection, only preserving 'necessary' registers...) and it's
somewhat lacking on the test front, but it's a start. Yay Leo!</p>
<p><a href="http://groups.google.com/groups?threadm=3F26B9E6.9020609%40nextra.at">http://groups.google.com/groups</a></p>
<h4><a name="another task for the interested: coverage">Another task for the interested: Coverage</a></h4>
<p>Dan threw out another 'task for the interested' this week. At present
we don't have a complete set of coverage tests for the parrot
opcodes, nor do we even know why opcodes do have coverage. Volunteers
to fix this state of affairs (start with a coverage report being
generated as part of the <code>make test</code> run) would be very welcome.</p>
<p>It turns out that Leo already has an &quot;unportable, ugly, slightly
tested&quot; script generating a coverage report of sorts which he
posted. Josh Wilmes also has a coverage testing tool generating
reports on the web, but he'd turned it off following some problems
under testing.</p>
<p><a href="http://groups.google.com/groups?threadm=a05210610bb4c910e2831%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>
<p><a href="http://www.hitchhiker.org/parrot_coverage">http://www.hitchhiker.org/parrot_coverage</a> -- Josh's reports</p>
<h4><a name="pirate (py...rrot)">Pirate (py...rrot)</a></h4>
<p>Will the terrible jokes never stop?</p>
<p>Michal Wallace reported to the list on his attempts to retool
amk's <em>parrot-gen.py</em> to generate code for IMCC. It sounds like he's
making good progress, but his choice of codename -- Pirate, from
py...rrot -- had at least one summarizer groaning.</p>
<p>Later Michal asked the list about the best way of generating
subroutines and asked for some pointers about how best to arrange the
generated code. He also let slip that Pirate could handle Lists,
strings, and ints; assignments; control structures; maths; boolean
logic; and comparisons...</p>
<p>Leo came up with a suggestion about code layout for Michal and spoke
for everyone (I think) when he added:</p>
<p>&quot;Wow.&quot;</p>
<p>Luke Palmer offered a few performance tuning tips (the parrot of Python
translation is currently running 3 times slower than python on
euclid, but I'm sure we'll get that fixed soon enough.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0307300400420.25808-100000%40hydrogen.sabren.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0307310652190.6807-100000%40hydrogen.sabren.com">http://groups.google.com/groups</a></p>
<h4><a name="jvm>pir translator">JVM-&gt;PIR translator</a></h4>
<p>Just as we were all giving Michal some good Wow, Joseph Ryan
announced that he had a partially complete JVM-&gt;PIR translator
done, though it still had a few issues.</p>
<p><a href="http://groups.google.com/groups?threadm=3F2A11BF.9000906%40osu.edu">http://groups.google.com/groups</a></p>
<p><a href="http://jryan.perlmonk.org/images/jirate.tar.gz">http://jryan.perlmonk.org/images/jirate.tar.gz</a></p>
<h4><a name="dynamic pmc classes">Dynamic PMC Classes</a></h4>
<p>Leo announced that he's started working on dynamic PMC classes. The
idea is that PMCs could be loaded on demand, in a similar fashion
(though hopefully with a nicer interface) to Perl 5's DynaLoader
tricks. He already has something working, and asked for comments.</p>
<p>Dan responded by outlining his thoughts on the interfaces and
requirements for dynamic PMC loading, which weren't quite the same as
what Leo had implemented, but they don't call it <strong>soft</strong>ware for
nothing.</p>
<p>Christian Renz wondered if there were any plans to allow PMCs to be
implemented in Parrot assembly. Dan confirmed that there were.</p>
<p><a href="http://groups.google.com/groups?threadm=3F27A15C.3060301%40nextra.at">http://groups.google.com/groups</a></p>
<h4><a name="question about interpreter == null">Question about <code>interpreter == NULL</code></a></h4>
<p>J&uuml;rgen B&ouml;mmels wondered which functions allowed the
caller to pass in a NULL pointer in place of the interpreter. Some
functions allow this, others fall in big segfaulty heaps. He and Leo
thrashed out the details of what is and isn't allowed, hopefully this
will make it into documentation at some point.</p>
<p><a href="http://groups.google.com/groups?threadm=m2ispin3v2.fsf%40helium.physik.uni-kl.de">http://groups.google.com/groups</a></p>
<h4><a name="adding yield semantics to imcc">Adding <code>yield</code> semantics to IMCC</a></h4>
<p>Kenneth A Graves has been experimenting with the <code>.pcc_*</code> directives
for implementing function calls, and wants to add coroutine support
by implementing <code>.pcc_begin_yield</code> and <code>.pcc_end_yield</code> which would
be analogous to the current <code>.pcc_*_return</code> directives. He supplied
a patch implementing what he was after. Leo liked the patch and
applied it.</p>
<p><a href="http://groups.google.com/groups?threadm=rt-23186-62028.2.9714262157627%40rt.perl.org">http://groups.google.com/groups</a></p>
<h4><a name="imcc objects speed, .include, filescoped vars et cetera">IMCC objects speed, <code>.include</code>, file-scoped vars et cetera</a></h4>
<p>Now that Parrot nearly has objects, Jerome Quelin has started work on
a new version of Befunge in IMCC. This meant he had a pile of
questions about speed, file scoping of variables, problems with line
numbering within included files, and fragility in the absence of
newline termination.</p>
<p>Melvin Smith opined that the time had come to start putting together
a nice web based set of docs for IMCC, and volunteered to start work
on it himself as soon as he'd caught up with the current state of the
IMCC art.</p>
<p>Leo T&ouml;tsch meanwhile answered most of Jerome's questions.</p>
<p><a href="http://groups.google.com/groups?threadm=200307312302.13304.jquelin%40mongueurs.net">http://groups.google.com/groups</a></p>
<h4><a name="imcc's call vs first class functions">IMCC's <code>call</code> vs first class functions</a></h4>
<p>If you were still not sure of the virtues of Continuation Passing
Style in Parrot, then Michal Wallace's problems with making first
class function objects in Pirate might help convince you of their
virtue. As far as I can see, just switching to a CPS style should
mean that anonymous functions in Pirate become almost automatic. (I
could be wrong of course)</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0308011305360.23256-100000%40hydrogen.sabren.com">http://groups.google.com/groups</a></p>
<h4><a name="david adler scares himself">David Adler Scares Himself</a></h4>
<p>For reasons best known only to himself Dave Adler has implemented an
hq9+ interpreter in pasm. Quite what an hq9+ interpreter is was left as an
exercise for the interested reader. Having just now done the Google
search for the language, I think it's best if I leave it to you to do
the search yourself, but quite frankly, I wouldn't bother.</p>
<p><a href="http://groups.google.com/groups?threadm=20030802054905.GA22806%40panix.com">http://groups.google.com/groups</a></p>
<h4><a name="upcoming backwards incompatible changes to imcc">Upcoming backwards incompatible changes to IMCC</a></h4>
<p>Leo T&ouml;tsch announced some changes to IMCC which will mean it is no
longer backwards compatible. What's changing is that from now, all
code outside of compilation units will be ignored, which means that
nested subroutines will no longer be supported. He will also be
adding a new <code>.globalconst</code> directive for declaring file scoped
constants.</p>
<p><a href="http://groups.google.com/groups?threadm=3F2B7BA0.9020500%40nextra.at">http://groups.google.com/groups</a></p>
<h4><a name="embedding parrot">Embedding Parrot</a></h4>
<p>Jeff Horwitz is interested in embedding parrot in other programs, and
wanted to know if there was any prior art, or even a road map. So far
there's been no response.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0308021218250.18912-100000%40booger.sixgeeks.org">http://groups.google.com/groups</a></p>

<h3><a name="meanwhile, in perl6language">Meanwhile, in perl6-language</a></h3>
<p>Things are starting to warm up a little in perl6-language
following the publication of Exegesis 6 (take a look, you'll find it
at <a href="/pub/a/2003/07/29/exegesis6.html">http://www.perl.com/pub/a/2003/07/29/exegesis6.html</a>, there's
much good stuff in there; Perl 6 is starting to look like a real
language I tell you). The volume's not got up to post-Apocalypse 6
levels yet, but it's early days yet.</p>
<h4><a name="perl 6's for() signature">Perl 6's <code>for()</code> signature</a></h4>
<p>John Siracusa referred back to an earlier summary where I had
wondered if either of two <code>for</code> implementations had got the
signature quite right. Luke Palmer (perpetrator of one of the for
implementations) thought that it wasn't quite possible to come up
with an accurate signature for <code>for</code> (or at least, not one that
could tell the compiler enough to detect errors at compile time.)
because you essentially needed a slurpy list followed by a block, but
slurpy lists have to be the last parameter in the signature.</p>
<p>John countered by quoting from Exegesis 6 &quot;An important goal of Perl
6 is to make the language powerful enough to implement all its own
built-ins&quot;, which doesn't exactly contradict what Luke said, as
there's always the possibility of implementing something <code>for</code>-like
using a macro, but that doesn't feel too comfortable.</p>
<p>Rod Adams proposed &quot;non-greedy slurpy arrays&quot; which would be
analogous to non-greedy regex matches and proposed <code>*?@</code> as the
sigil combination for such a parameter. (Perl? Line noise? Never!)</p>
<p>Damian Conway tweaked Simon Cozens' &quot;Soylen^WPerl 6 is Ruby!&quot;
detector when he mentioned that Larry was considering adding a
special case for allowing a single <code>&amp;block</code> parameter after a slurpy
parameter, but that both Larry and Damian weren't entirely happy with the
idea.</p>
<p>Larry offered words of wisdom. As usual.</p>
<p><a href="http://groups.google.com/groups?threadm=F2B0434A-C36C-11D7-961B-0050E4A0A466%40mindspring.com">http://groups.google.com/groups</a></p>
<p><a href="/pub/a/2003/04/p6pdigest/20030427.html?page=2">http://www.perl.com/pub/a/2003/04/p6pdigest/20030427.html</a>
-- the earlier summary</p>
<p><a href="http://groups.google.com/groups?threadm=20030802010217.GA17906%40wall.org">http://groups.google.com/groups</a> -- Larry dispenses wisdom</p>
<h4><a name="exegesis 6: assume nothing">Exegesis 6: Assume nothing</a></h4>
<p>Referring to Exegesis 6, Trey Harris wondered how one could curry a
subroutine to always use the default value for the 'assumed'
parameter. He wanted to be able to created a curried function in such
a way that, if the original function's default value changed, the
curried function would reflect that.</p>
<p>I don't think this thread has been resolved to anyone's satisfaction
yet, and I can't quite tell where it's headed. My gut feeling is that
this is a sufficiently rare requirement that Damian's solution of not
using <code>.assuming</code> at all and just writing a simple wrapper function
by hand may be the way forward.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.BSF.4.51.0307301958180.78431%40bowser.eecs.harvard.edu">http://groups.google.com/groups</a></p>
<h4><a name="mandating nameonly parameters">Mandating name-only parameters</a></h4>
<p>Mark J. Reed wondered if the new parameter declaration syntax meant
it was possible to declare a mandatory name-only parameter. Damian
thinks it will probably be doable, but only by using traits rather
than the single character prefixes.</p>
<p><a href="http://groups.google.com/groups?threadm=20030801154454.GA4016%40charm.turner.com">http://groups.google.com/groups</a></p>
<h4><a name="small junctions">Small Junctions</a></h4>
<p>Exegesis 6 describes a junction as &quot;a single scalar value that can
act like two or more values at once&quot;. Dave Whipp wondered how
junctions with 0 or 1 members would behave. As Dave said, the case of
a single member junction is relatively easily to understand, but he's
unsure as to the semantics for a 0 member junction.</p>
<p>Luke Palmer gave a good answer, and pointed at Damian's message about
&quot;Perl 6 and Set Theory&quot; for more detail.</p>
<p><a href="http://groups.google.com/groups?threadm=20030801165457.98906.qmail%40onion.perl.org">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?hl=en&lr=&ie=UTF-8&oe=UTF-8&safe=off&selm=3DF2FE76.6050602%40conway.org&rnum=2">http://groups.google.com/groups</a></p>
<h4><a name="macros and is parsed">Macros and <code>is parsed</code></a></h4>
<p>Abhijit A Mahabal asked for some clarification about the workings of
macros, in particular how/when macro arguments were parsed. The
answer from Larry appears to be that macros get a default <code>parsed</code>
trait, which can be overridden by <code>is parsed</code> when the macro is
declared, so macro arguments are parsed by the macro's <code>parsed</code>
trait.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.GSO.4.53.0308020838010.14060%40school.cs.indiana.edu">http://groups.google.com/groups</a></p>
<h4><a name="macro arguments themselves">Macro arguments themselves</a></h4>
<p>Luke Palmer wondered what macros do about being passed variables,
with a supplementary question about recursive macros. Larry answered
that macros dealt with their arguments in the way that Luke hoped
(it'd be a disaster if the didn't, frankly), but that to get a
recursive macro you would probably have to write a helper function.</p>
<p><a href="http://groups.google.com/groups?threadm=ygcwudvc1hy.fsf%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>
<h4><a name="another macro question">Another macro question</a></h4>
<p>Abhijit A. Mahabal wondered what</p>
<pre><code>
    macro foo() { return { my $x = 7 } }
    foo;
    print $x;</code></pre>
<p>would be equivalent to. According to Larry, the answer is probably:</p>
<pre><code>
    do { my $x = 7 }
    print $x;</code></pre>
<p>Which would throw an error under use strict. It seems to me that the
way to get expanded code that looks like:</p>
<pre><code>
    my $x = 7;
    print $x;</code></pre>
<p>would be to declare <code>foo</code> as:</p>
<pre><code>
    macro foo() { return 'my $x = 7' }</code></pre>
<p><a href="http://groups.google.com/groups?threadm=Pine.GSO.4.53.0308022223550.20685%40school.cs.indiana.edu">http://groups.google.com/groups</a></p>
<h4><a name="grep expr, list"><code>grep EXPR, LIST</code></a></h4>
<p>John Williams wondered if the Perl 5ish <code>grep EXPR, LIST</code> would
still work in Perl 6. Larry thinks not. I think it should be possible
to declare an appropriate macro version of grep, but the margins of
this summary are too narrow to contain my solution.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.33.0308022138390.18148-100000%40sharkey.morinda.com">http://groups.google.com/groups</a></p>

<h3><a name="acknowledgements, announcements and apologies">Acknowledgements, Announcements and Apologies</a></h3>
<p>Thanks to Damian for Exegesis 6, Perl 6 may be slow in coming, but I
like it more with each revelation.</p>
<p>Ooh look, another plug for <a href="http://pc1.bofhadsl.ftech.co.uk:8080/">http://pc1.bofhadsl.ftech.co.uk:8080/</a>.</p>
<p>As ever, if you've appreciated this summary, please consider one or
more of the following options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl.</li>
<li>
Get involved in the Perl 6 process. The mailing lists are open  to
all. <a href="http://dev.perl.org/perl6/">http://dev.perl.org/perl6/</a> and <a href="http://www.parrotcode.org/">http://www.parrotcode.org/</a>
are good starting points with links to the appropriate mailing lists.</li>

<li>
Send feedback, flames, money, requests for consultancy, photographic
and writing commissions, or suggestions for something else to ask for
in this bit to <em><a href="mailto:p6summarizer@bofh.org.uk">p6summarizer@bofh.org.uk</a></em></li>
</ul>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2003/07/">&laquo; July 2003</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2003/09/">September 2003 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
