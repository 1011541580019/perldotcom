<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/2003/08/15/design3.html">
<dc:title>Perl Design Patterns, Part 3</dc:title>
<dc:description> This is the third (and final) article in a series which form one Perl programmer&apos;s response to the book Design Patterns (also known as the Gang of Four book or simply as GoF, because four authors wrote it). As...</dc:description>
<dc:creator>Phil Crow</dc:creator>
<dc:date>2003-08-15T00:00:00-08:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    
    <link rel="prev bookmark" href="/pub/2003/08/07/design2.html" title="Perl Design Patterns, Part 2" />
    <link rel="next bookmark" href="/pub/2003/08/p6pdigest/20030817.html" title="This week on Perl 6, week ending 2003-08-17" />
    
    
    <title>Perl Design Patterns, Part 3 - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1174" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Perl Design Patterns, Part 3</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Phil Crow</span> on <abbr class="published" title="2003-08-15T00:00:00-08:00">August 15, 2003 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>This is the third (and final) article in a series which form one Perl
programmer's response to the book <I>Design Patterns</I> (also known as the Gang
of Four book or simply as GoF, because four authors wrote it).  As I showed in
the <a href="/pub/a/2003/08/07/design2.html">second article</a>, Perl provides the types needed to implement many
patterns.  The Strategy and Template Method patterns can be implemented
with code references.  Builder usually builds a structure based on references
to some combination of hashes and lists.  Interpreters can be implemented
with simple tools like <code>split</code> or with the king: <code>Parse::RecDescent</code>, which
brings the best of yacc into your Perl script (albeit with somewhat
less efficiency than yacc).</p>
<p>This article continues my treatment by considering patterns which rely on
objects.  As such, this article's patterns bears the most resemblance to the
GoF book.  Before presenting some patterns, I'll give you my two cents about
object applicability.</p>

<h4><a name="when_are_objects_good">When Are Objects Good?</a></h4>
<p>As Larry Wall reminds us about all programming constructs, you should use
objects when they make sense and not when they don't.  So when do they
make sense?  This is partly a matter of taste.  This subsection gives you
my tastes.</p>
<p>It's easier to say when objects are bad, which they are in these cases:</p>

<!-- sidebar begins -->
<table width="220" border="0" cellspacing="8" cellpadding="4" align="right">
<tr>
<td width="220" valign="top" bgcolor="#efefef">
<div class="secondary">
<h4>More on Perl Design Patterns:</h4>
<p>
&bull; <a href="/pub/a/2003/06/13/design1.html">Perl Design Patterns, Part 1</a><br />
&bull; <a href="/pub/a/2003/08/07/design2.html">Perl Design Patterns, Part 2</a>
</p>
</div>
</td></tr></table>
<!-- sidebar ends -->

<ol>
<li>
There is only data, the methods are either trivial or non-existent.  Data
containers (also called nodes) are like this.  For example, I should not
need an object to return three numbers and a string to my caller.</li>

<li>
There are only methods.  The Java Math class is like this.  It won't even
let you make a Math object.  Clearly its methods should just be built-in
functions of the language.</li>
</ol>
<p>Seeing the poor uses of objects gives insight into their effective use.
Use objects when complexity is high and data is tightly coupled to
the methods which act on it.  High complexity makes these chief advantages
of objects more important: separate namespaces, inheritance, and polymorphism.</p>
<p>Now that I've spoken my peace, I'll go on to the patterns which use objects.</p>

<h3><a name="abstract_factory">Abstract Factory</a></h3>
<p>If you want to build platform independent programs, you need a way to access
the underlying systems without having to recode for each one's API.  This
is where a factory comes into play.  The source code asks for an instance
of a class, the class delivers a subclass instance suitable for use on
the current platform.  That class is called an abstract factory (or simply
a factory).  As we will see below, the platform might be a database.
So the factory would return an object suitable for use with a particular
database, but all the objects would have the same API.</p>
<p>To show the basic idea, here is an example which delivers one of two
types.  There are four code files in this example.  The first two are
the greeters.</p>
<pre><code>
package Greet::Repeat;

sub new {
    my $class    = shift;
    my $self     = {
        greeting =&gt; shift,
        repeat   =&gt; shift,
    };
    return bless $self, $class;
}

sub greet {
    my $self = shift;
    print ($self-&gt;{greeting} x $self-&gt;{repeat});
}

1;
</code></pre>
<p>This greeter's constructor expects a greeting and a repeat count.  It
stores these in a hash, returning a blessed reference to it.  When asked
to greet, it prints the greeting repeatedly (hence the name).  (I didn't
say this example was practical, but it is small.)</p>
<pre><code>
    package Greet::Stamp;
    use strict; use warnings;

    sub new {
        my $class    = shift;
        my $greeting = shift;
        return bless \$greeting, $class;
    }

    sub greet {
        my $greeting = shift;
        my $stamp    = localtime();
        print &quot;$stamp $$greeting&quot;;
    }

    1;</code></pre>
<p>This greeter only expects a greeting string, so it blesses a reference
to the one it receives.  When asked to greet, it prints the current time
followed by the greeting.</p>
<p>Here's the factory:</p>
<pre><code>
    package GreetFactory;
    use strict; use warnings;

    sub instantiate {
        my $class          = shift;
        my $requested_type = shift;
        my $location       = &quot;Greet/$requested_type.pm&quot;;
        my $class          = &quot;Greet::$requested_type&quot;;

        require $location;

        return $class-&gt;new(@_);
    }

    1;</code></pre>
<p>A Perl factory looks a lot like factories in other languages.
This one has only one method.  It returns the requested type to the caller.
It uses the caller's requested type as the name of the class to instantiate
and as the name of the Perl module in which the class lives.</p>
<p>Finally, you can use this factory with a script like this:</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    use GreetFactory;

    my $greeter_n = GreetFactory-&gt;instantiate(&quot;Repeat&quot;, &quot;Hello\n&quot;, 3);
    $greeter_n-&gt;greet();

    my $greeter_stamp = GreetFactory-&gt;instantiate(&quot;Stamp&quot;, &quot;Good-bye\n&quot;);
    $greeter_stamp-&gt;greet();</code></pre>
<p>To make each greeter, call the <code>instantiate</code> method of <code>GreetFactory</code>, passing
it the name of the class you want and any arguments that class's constructor
is expecting.</p>
<p>This example shows you the basic idea.  It is simple on purpose.  But it
does show how the factory can be ignorant of the underlying classes.
Any new greeter added to the system must have a name of the form <code>Greet::Name</code>
and be placed into a <code>Greet</code> subdirectory of an <code>@INC</code> path member as
<code>Name.pm</code>.  Then callers can use it without changing the factory.  Now that
you have seen a simple example, here is a more useful one.</p>
<p>The Perl DBI (DataBase Interface) provides an excellent example of a factory.
Each call to <code>DBI-</code>connect&gt;, expects the type of database and whatever
information that database needs to establish a connection.  This is a classic
factory.  It will load any DBD (DataBase Driver) you have installed
on your system, upon request.  Additional DBD's can be added at any time.
Once they are installed, any client can use them through the same
DBI API.  Here's an example use of DBI:</p>
<pre><code>
    use DBI;
    my $dbh      =
        DBI-&gt;connect(&quot;dbi:mysql:mydb:localhost&quot;, &quot;user&quot;, &quot;password&quot;);
    ...
    my $sth      = $dbh-&gt;prepare('select * from table');
    ...</code></pre>
<p>Once the database handle is obtained (which is usually called <code>$dbh</code>), it
can be used almost without regard to the underlying engine.  If you
later move to Oracle, you would merely change the connect call.
If a new database comes on the scene, some smart person in contact with
Tim Bunce will implement a class for it.  You can install and switch
to it as soon as they finish their work.  You might even be the implementer,
but I doubt I will be.</p>


<h3><a name="composite">Composite</a></h3>
<p>This pattern shows how to use the fully OO composite pattern.
If you are interested in a simpler non-OO implementation see the Builder
Pattern in Part 2 of this article series.</p>
<p>Many applications require hierarchies of related items linked into a tree
by relationship.  Many people see a hierarchy of this type:
a directory structure.  At the top is the root directory.  In the
simplest case it includes two types of items: files and subdirectories.
Each subdirectory is like the root directory.  Note that this definition
of the structure is recursive, which is typical of composites.</p>
<p>One of the most popular examples of a composite structure today is an XML
file.  These files have a root element which contains various types
of subelements, including tags and comments.  Tags have attributes
and some can contain subelements.  This makes the classic composite tree.
There are two important steps for a composite structure.  The first
is building it.  The second is using it.  We'll see simple examples of both
here.</p>
<p>For the genuine pattern, there must be methods that act on both regular
and composite elements (the elements with children are called composite
elements).  Invoking such a method on the root of a composite tree, or
subtree, causes that root to do work on its own data AND to forward the
request to its children.  Those children do the same, collecting their
own data and that of their children, until the bottom of the tree is
reached.  The return value is a collection of all this data.</p>
<p>For a practical example consider using the DOM model to process XML.
(You may obtain the <code>XML::DOM</code> module from CPAN.) To find all the paragraphs
in a document we could do something like this:</p>
<pre><code>
    use XML::DOM;
    my $parser = XML::DOM::Parser-&gt;new();
    my $doc    = $parser-&gt;parsefile(&quot;file.xml&quot;);
    foreach my $paragraph ($doc-&gt;getElementsByTagName(&quot;paragraph&quot;)) {
        print &quot;&lt;p&gt;&quot;;
        foreach my $child ($paragraph-&gt;getChildNodes) {
            print $child-&gt;getNodeValue if ($child-&gt;getNodeType eq TEXT_NODE);
        }
    }
    $doc-&gt;dispose();</code></pre>
<p>The call to <code>getElementsByTagName</code> begins at the root (since I called it
through <code>$doc</code>).  The root returns any of its children which are paragraphs,
but it also forwards the request to all of its tag elements asking them
to return their paragraphs.  They do the same.</p>
<p>An unrelated note:
Notice that the above example ends with a call to dispose.  <code>XML::DOM</code>
composite structures have references from parents to children and from
children to parents.  We usually call these circular links.  Perl 5
garbage collection cannot harvest such structures.  We must call dispose
to break the extra links so the structure's memory can be recovered.  If
you build structures with circular links, you must break those links
yourself, otherwise your program will leak memory.</p>













<p>We've seen how useful a well crafted composite structure can be, but
how could we build one for ourselves?  The objects in the structure must
all respond to the methods meant to walk the composite.  They may return
undef immediately, but they must exist.  Further, the version of those
methods in the composite objects (the ones which can have children), must
take care to pass the message along to their children.</p>
<p>To make this concrete, consider a non-binary tree (as we have been
all along).  Suppose we want to know how many nodes are in the tree.
We can ask the root to <code>count_nodes</code>.  It should count itself and add
that to the sum of <code>count_nodes</code> calls to each child.  Nodes which are
not composite (i.e. have no children) return one.  Composite nodes, return
one plus the sums from their children.  The code follows.</p>
<p>There are four pieces of code: (1) A base class for tree nodes: <code>Node.pm</code>,
(2) A class for nodes that could have children: <code>Composite.pm</code>, (3) A class
for nodes that can't have children: <code>Regular.pm</code>, and (4) a driver to
demonstrate that the system works: <code>comp</code>.  I'll show these one at a time,
in the order listed above.</p>
<pre><code>
    package Node;
    use strict; use warnings;

    sub count_nodes {
        my $self       = shift;
        my $class_name = ref $self;
        die &quot;$class_name does not implement count_nodes\n&quot;;
    }

    1;</code></pre>
<p>The only method here is <code>count_nodes</code>.  This serves as an implementation
requirement (also called an abstract method).  Attempting to use a Node
subclass which doesn't provide count_nodes results in a fatal run-time
error.  Every subclass should have an appropriate test to make sure this
error never happens to users.</p>
<pre><code>
    package Regular;

    use Node;
    @ISA = qw(Node);

    use strict; use warnings;

    sub new {
        my $class = shift;
        my $name  = shift;
        return bless \$name, $class;
    }

    sub count_nodes {
        return 1;
    }

    1;</code></pre>
<p>Regular nodes are blessed references to their names.  They always count as
a single node.  (An unrelated note: it is sometimes convenient to turn
on <code>strict</code> after the preamble of a package, here that let's me use <code>@ISA</code>
without qualifying it.)</p>
<pre><code>
    package Composite;

    use Node;
    @ISA = qw(Node);

    use strict; use warnings;

    sub new {
        my $class = shift;
        my $name  = shift;
        my $self  = { name =&gt; $name, children =&gt; [] };
        return bless $self, $class;
    }

    sub add_child {
        my $self      = shift;
        my $new_child = shift;

        push @{$self-&gt;{children}}, $new_child;
        return $new_child;
    }

    sub count_nodes {
        my $self  = shift;
        my $count = 1;

        foreach my $child (@{$self-&gt;{children}}) {
            $count += $child-&gt;count_nodes();
        }
        return $count;
    }

    1;</code></pre>
<p>This class is similar to <code>Regular</code>, but it needs a way to keep track of
children.  Since it also keeps its name, I used a hash for the object type.
New children are just pushed onto a list.  Counting includes one for the
parent node, plus the total for each child.  Since leaves of the tree
also implement <code>count_nodes</code>, we can process all <code>Node</code> types together.
This is the polymorphism advantage of objects and the heart of the Composite
Pattern.</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    use Composite;
    use Regular;

    my $root     = Composite-&gt;new(&quot;Root&quot;);

    my $eldest   = $root-&gt;add_child(Composite-&gt;new(&quot;Jim&quot;));
    my $middle   = $root-&gt;add_child(Composite-&gt;new(&quot;Jane&quot;));
                   $root-&gt;add_child(Regular-&gt;new(&quot;Bob&quot;));
    my $youngest = $root-&gt;add_child(Composite-&gt;new(&quot;Joe&quot;));

                   $eldest-&gt;add_child(Regular-&gt;new(&quot;JII&quot;));
    my $kayla    = $eldest-&gt;add_child(Composite-&gt;new(&quot;Kayla&quot;));
                   $kayla-&gt;add_child(Regular-&gt;new(&quot;Max&quot;));

    my $count = $root-&gt;count_nodes();

    print &quot;count: $count\n&quot;;</code></pre>
<p>This contrived example manually builds a simple tree, then asks for a node
count.  The correct answer is 8.</p>


<h3><a name="proxy">Proxy</a></h3>
<p>In GoF the proxy pattern example shows a way to delay loading expensive
components until the user actually wants them.  In the course of the
example they show a genuine proxy.  Proxies refer
all requests to some other object.  Think of it like an intermediary for
the mob.  You make your request to your local thug, as if he could do
the thing himself.  He passes that on to someone else you never meet
who actually does the job.  (Note to John Ashcroft: I am only imaging
this process, having NO personal experience with it.  Honest.)</p>
<p>Suppose an application could use several large files, but
usually only needs one or two.  Instead of reading all these files, I
will delay loading the file until the caller wants to see it.  The usual
warning applies: this is contrived to explain the concept.</p>
<p>Here is the class that actually stores and prints the files:</p>
<pre><code>
    package File;
    use strict; use warnings;

    sub new {
        my $class = shift;
        my $file  = shift;
        open FILE, &quot;$file&quot; or die &quot;Couldn't read $file: $!\n&quot;;
        my @data  = &lt;FILE&gt;;
        close FILE;
        return bless \@data, $class;
    }

    sub print_file {
        my $data = shift;
        print @$data;
    }

    sub DESTROY { }

    1;</code></pre>
<p>When the <code>File</code> constructor is called, it reads the file into an array for
later use, returning a blessed reference to the data to the caller.
When asked to print, it sends the data to the currently selected output
handle (usually standard out).</p>
<p>The <code>DESTROY</code> subroutine is called by Perl whenever a blessed reference is
about to go out of scope.  This allows us to perform clean-up which is
guaranteed to happen.  In this case, there is no necessary clean-up, but
the approach I'm about to show for the proxy class ends up calling this
method explicitly.  That explicit call offends Perl so much that it complains
to the screen.  To avoid the warning, I included the stub.</p>
<p>There is nothing special about the <code>File</code> class shown above.  The proxy
follows.</p>
<pre><code>
    package FileProxy;
    use strict; use warnings;

    use File;

    sub new {
        my $class = shift;
        my $self  = {
            params         =&gt; \@_,
            wrapped_object =&gt; undef,
        };
        return bless $self, $class;
    }

    sub AUTOLOAD {
        my $self    = shift;
        my $command = our $AUTOLOAD;
        $command    =~ s/.*://;

        unless (defined $self-&gt;{wrapped_object}) {
            $self-&gt;{wrapped_object} = File-&gt;new(@{$self-&gt;{params}});
        }
        $self-&gt;{wrapped_object}-&gt;$command(@_);
    }

    1;</code></pre>
<p>The constructor for the proxy takes the things necessary to build an actual
<code>File</code> object (namely the file name) and stores them as its <code>params</code>
attribute.  The other attribute will eventually hold the wrapped <code>File</code>
object.  The attributes are stored in hash, the hash's reference is
blessed and returned to the caller.</p>
<p>Whenever Perl has no where else to go with a method call, it calls
<code>AUTOLOAD</code> (if there is one).  So, the <code>AUTOLOAD</code> in FileProxy handles
all requests except <code>new</code> and <code>DESTROY</code>, which appear explicitly.
<code>AUTOLOAD</code> is all caps to remind us that Perl calls it for us.  While
making this call, Perl sets the package global variable <code>$AUTOLOAD</code> to
the name of the method the caller invoked.  The regular expression strips
off the package names from <code>$AUTOLOAD</code>, leaving only the method name.</p>













<p>If the object is not yet defined, <code>AUTOLOAD</code> calls File-&gt;new passing it the
arguments stored during construction.  After that, the object is defined,
so <code>AUTOLOAD</code> calls the requested method on the wrapped object.  The beauty
of this mechanism is that the <code>FileProxy</code> class only knows that the
constructor is called <code>new</code>.  It does not need to change as changes to
<code>File.pm</code> are made.  Any errors, such as no such method, will be fatal
as usual.</p>
<p>To use this proxied scheme we might employ a caller like this:</p>
<pre><code>
    #!/usr/bin/perl
    use strict; use warnings;

    use FileProxy;

    my $file1 = FileProxy-&gt;new(&quot;art1&quot;);
    my $file2 = FileProxy-&gt;new(&quot;art2&quot;);

    $file1-&gt;print_file();
    $file1-&gt;print_file();
    $file2-&gt;print_file();</code></pre>
<p>With a couple of changes we could use this for any class.  Here's the new
generic version:</p>
<pre><code>
    package DelayLoad;
    use strict; use warnings;

    our %proxied_classes;

    sub import {
        shift;  # discard class name

        %proxied_classes = @_;

        foreach my $class (keys %proxied_classes) {
            require &quot;$class.pm&quot;;
        }
    }

    sub new {
        my $class = shift;
        my $self  = {
            type           =&gt; shift,
            constructor    =&gt; shift,
            params         =&gt; \@_,
            wrapped_object =&gt; undef,
        };
        return bless $self, $class;
    }

    sub AUTOLOAD {
        my $self    = shift;
        my $command = our $AUTOLOAD;
        $command    =~ s/.*://;

        if ($proxied_classes{$command}) {
            return $self-&gt;new($command, $proxied_classes{$command}, @_);
        }
        else {
            unless (defined $self-&gt;{wrapped_object}) {
                my $proxied_class       = $self-&gt;{type};
                my $constructor         = $self-&gt;{constructor};
                $self-&gt;{wrapped_object} = $proxied_class
                                        -&gt;$constructor(@{$self-&gt;{params}});
            }
            $self-&gt;{wrapped_object}-&gt;$command(@_);
        }
    }

    1;</code></pre>
<p>The first change is cosmetic: the name now reflects the nature of the
proxy.  Other changes include a new method: import.  Even though its name
is lower case, Perl calls it whenever the caller says <code>use DelayLoad</code> (see
below).  It does two things.  First, it stores the name of each proxied
class in the <code>%proxied_classes</code> package global.  Second, it requires each
module.  <code>require</code> is like use, but it happens at run time instead of
compile time.  (use also imports symbols, but then your object oriented
module shouldn't be exporting anything anyway.)</p>
<p>The constructor now stores a bit more information.  In addition to saving
room for the wrapped object and storing the <code>params</code>, it also records
the name of the class and of that class's constructor.  These will be
used in <code>AUTOLOAD</code>.</p>
<p>The only other changes are in the <code>AUTOLOAD</code> method.  There are two
changes.  The easiest one is to look up the class and constructor
names in the <code>DelayLoad</code> object instead of just calling File-&gt;new.</p>
<p>The other change is used during construction.  My explanation of it will
make more sense, if you see the new caller first.</p>
<p>The new version requires a couple of changes to the caller.  One change is on
the use line which becomes:</p>
<pre><code>
    use DelayLoad &quot;File&quot; =&gt; &quot;new&quot;;</code></pre>
<p>This uses <code>DelayLoad</code>, tells it we want to be able to delay
loads for <code>File</code> objects, and that <code>File</code>'s constructor is called <code>new</code>.</p>
<p>The other change is in how we construct the delayed object:</p>
<pre><code>
    my $file1 = DelayLoad-&gt;File(&quot;art1&quot;);
    my $file2 = DelayLoad-&gt;File(&quot;art2&quot;);</code></pre>
<p>This explains the unexplained piece in <code>AUTOLOAD</code> above.  When the user
calls the <code>File</code> method, <code>AUTOLOAD</code> notices that this ``method'' is
really the name of a delay loaded class.  When the <code>if</code> in <code>AUTOLOAD</code>
is true (i.e. the method is really a key in <code>%proxied_classes</code>), the caller
is given a new <code>DelayLoad</code> object primed for later use.  When the <code>if</code>
fails, <code>DelayLoad</code> works like <code>FileLoad</code>: it constructs the object, if
needed and calls the requested method.</p>
<p>The fundamental point of this example is that Perl allows us to implement
proxies without knowing very much about the underlying class.  In this
case, <code>import</code> receives the necessary information from the caller,
<code>AUTOLOAD</code> takes care of the rest.  Making the caller work is not always
a good idea.  Here it makes sense.  If she knows she wants to delay loading
objects until they are really needed, she must at least know the API for
those objects.  In the API is the name of the constructor, which she mentions
in the use statement so Perl can pass to <code>DelayLoad::import</code> for her.</p>
<p>Keep in mind that <code>AUTOLOAD</code> is not designed for this sort of work.  Its
real purpose in life is to load subroutines on demand for the current package.
It can't do that here, since changing the subroutines affects all instances
of a class.  Here we are <code>AUTOLOAD</code>ing data, not routines.
By suitably adjusting <code>import</code> and <code>AUTOLOAD</code>, you can make the proxy do
many other things.</p>


<h3><a name="summary">Summary</a></h3>
<p>In this article, I have finally shown object oriented patterns.
We saw how to implement a Factory so our callers can choose their favorite
driver, how to build composite structures and routines that
traverse them (without explicit <code>first_child</code> and <code>next</code> pointers that
would be needed in languages without quality built-in lists), and how
to stand as a proxy between a caller and a class with <code>import</code> and
<code>AUTOLOAD</code>.</p>


<h3><a name="author's_note">Author's Note</a></h3>
<p>This is the final article in this series, but look for a book, <I>Design
Patterns in Perl</I> from Apress at your favorite bookseller in the near future.</p>
                                    </div>


                                </div>
                                <div class="asset-footer">


                                    <div class="entry-tags">
                                        <h4>Tags<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=patterns&amp;limit=20';return false;" rel="tag">patterns</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=patterns%20in%20Perl&amp;limit=20';return false;" rel="tag">patterns in Perl</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=Perl&amp;limit=20';return false;" rel="tag">Perl</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=Perl%20programming&amp;limit=20';return false;" rel="tag">Perl programming</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=Phil%20Crow&amp;limit=20';return false;" rel="tag">Phil Crow</a></li>
                                        </ul>
                                    </div>

                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
