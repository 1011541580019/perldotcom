<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/2002/07/16/mod_perl.html">
<dc:title>Improving mod_perl Sites&apos; Performance: Part 3</dc:title>
<dc:description> In this article we will continue the topic started in the previous article. This time we talk about tools that help us with code profiling and memory usage measuring. Code Profiling Techniques The profiling process helps you to determine...</dc:description>
<dc:creator>Stas Bekman</dc:creator>
<dc:date>2002-07-16T00:00:00-08:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    
    <link rel="prev bookmark" href="/pub/2002/07/p6pdigest/20020714.html" title="This Week on Perl 6 (8 - 14 Jul 2002)" />
    <link rel="next bookmark" href="/pub/2002/07/23/review.html" title="Graphics Programming with Perl" />
    
    
    <title>Improving mod_perl Sites' Performance: Part 3 - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1324" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Improving mod_perl Sites' Performance: Part 3</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Stas Bekman</span> on <abbr class="published" title="2002-07-16T00:00:00-08:00">July 16, 2002 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->



<p>In this article we will continue the topic started in the previous
article. This time we talk about tools that help us with code
profiling and memory usage measuring.</p>
<p>
</p>
<h3><a name="code_profiling_techniques">Code Profiling Techniques</a></h3>
<p>The profiling process helps you to determine which subroutines or just
snippets of code take the longest time to execute and which subroutines
are called most often. You will probably just want to optimize those.</p>
<p>When do you need to profile your code? You do that when you suspect that
some part of your code is being called very often and so there may be a
need to optimize it to significantly improve the overall performance.</p>

<csquery path="q/21" where="cs_rid != {cs_rid}">

<p>For example, you might have used the <code>diagnostics</code> pragma, which
extends the terse diagnostics normally emitted by both the Perl compiler
and the Perl interpreter, augmenting them with the more verbose and
endearing descriptions found in the <code>perldiag</code> manpage. If you've ever
done so, then you know that it might slow your code down tremendously, so
let's first see whether or not it actually does.</p>
<p>We will run a benchmark, once with diagnostics enabled and once
disabled, on a subroutine called <em>test_code</em>.</p>
<p>The code inside the subroutine does an arithmetic and a numeric
comparison of two strings.  It assigns one string to another if the
condition tests true but the condition always tests false.  To
demonstrate the <code>diagnostics</code> overhead the comparison operator is
intentionally <em>wrong</em>.  It should be a string comparison, not a
numeric one.</p>
<pre><code>
  use Benchmark;
  use diagnostics;
  use strict;
  
  my $count = 50000;
  
  disable diagnostics;
  my $t1 = timeit($count,\&amp;test_code);
  
  enable  diagnostics;
  my $t2 = timeit($count,\&amp;test_code);
  
  print &quot;Off: &quot;,timestr($t1),&quot;\n&quot;;
  print &quot;On : &quot;,timestr($t2),&quot;\n&quot;;
  
  sub test_code{
    my ($a,$b) = qw(foo bar);
    my $c;
    if ($a == $b) {
      $c = $a;
    }
  }</code></pre>
<p>For only a few lines of code we get:</p>
<pre><code>
  Off:  1 wallclock secs ( 0.81 usr +  0.00 sys =  0.81 CPU)
  On : 13 wallclock secs (12.54 usr +  0.01 sys = 12.55 CPU)</code></pre>
<p>With <code>diagnostics</code> enabled, the subroutine <code>test_code()</code> is 16 times
slower than with <code>diagnostics</code> disabled!</p>
<p>Now let's fix the comparison the way it should be, by replacing <code>==</code>
with <code>eq</code>, so we get:</p>
<pre><code>
    my ($a,$b) = qw(foo bar);
    my $c;
    if ($a eq $b) {
      $c = $a;
    }</code></pre>
<p>and run the same benchmark again:</p>
<pre><code>
  Off:  1 wallclock secs ( 0.57 usr +  0.00 sys =  0.57 CPU)
  On :  1 wallclock secs ( 0.56 usr +  0.00 sys =  0.56 CPU)</code></pre>
<p>Now there is no overhead at all.  The <code>diagnostics</code> pragma slows
things down only when warnings are generated.</p>

<csperl file="grab" domain="on" record="b/832" template="b/article_sidebar2.view">

<p>After we have verified that using the <code>diagnostics</code> pragma might adds
a big overhead to execution runtime, let's use the code profiling to
understand why this happens. We are going to use <code>Devel::DProf</code> to
profile the code.  Let's use this code:</p>
<pre><code>
  diagnostics.pl
  --------------
  use diagnostics;
  print &quot;Content-type: text/html\n\n&quot;;
  test_code();
  sub test_code{
    my ($a,$b) = qw(foo bar);
    my $c;
    if ($a == $b) {
      $c = $a;
    }
  }</code></pre>
<p>Run it with the profiler enabled, and then create the profiling
stastics with the help of dprofpp:</p>
<pre><code>
  % perl -d:DProf diagnostics.pl
  % dprofpp
  
  Total Elapsed Time = 0.342236 Seconds
    User+System Time = 0.335420 Seconds
  Exclusive Times
  %Time ExclSec CumulS #Calls sec/call Csec/c  Name
   92.1   0.309  0.358      1   0.3089 0.3578  main::BEGIN
   14.9   0.050  0.039   3161   0.0000 0.0000  diagnostics::unescape
   2.98   0.010  0.010      2   0.0050 0.0050  diagnostics::BEGIN
   0.00   0.000 -0.000      2   0.0000      -  Exporter::import
   0.00   0.000 -0.000      2   0.0000      -  Exporter::export
   0.00   0.000 -0.000      1   0.0000      -  Config::BEGIN
   0.00   0.000 -0.000      1   0.0000      -  Config::TIEHASH
   0.00   0.000 -0.000      2   0.0000      -  Config::FETCH
   0.00   0.000 -0.000      1   0.0000      -  diagnostics::import
   0.00   0.000 -0.000      1   0.0000      -  main::test_code
   0.00   0.000 -0.000      2   0.0000      -  diagnostics::warn_trap
   0.00   0.000 -0.000      2   0.0000      -  diagnostics::splainthis
   0.00   0.000 -0.000      2   0.0000      -  diagnostics::transmo
   0.00   0.000 -0.000      2   0.0000      -  diagnostics::shorten
   0.00   0.000 -0.000      2   0.0000      -  diagnostics::autodescribe</code></pre>
<p>It's not easy to see what is responsible for this enormous overhead,
even if <code>main::BEGIN</code> seems to be running most of the time.  To get
the full picture we must see the OPs tree, which shows us who calls
whom, so we run:</p>
<pre><code>
  % dprofpp -T</code></pre>
<p>and the output is:</p>
<pre><code>
 main::BEGIN
   diagnostics::BEGIN
      Exporter::import
         Exporter::export
   diagnostics::BEGIN
      Config::BEGIN
      Config::TIEHASH
      Exporter::import
         Exporter::export
   Config::FETCH
   Config::FETCH
   diagnostics::unescape
   .....................
   3159 times [diagnostics::unescape] snipped
   .....................
   diagnostics::unescape
   diagnostics::import
 diagnostics::warn_trap
   diagnostics::splainthis
      diagnostics::transmo
      diagnostics::shorten
      diagnostics::autodescribe
 main::test_code
   diagnostics::warn_trap
      diagnostics::splainthis
         diagnostics::transmo
         diagnostics::shorten
         diagnostics::autodescribe
   diagnostics::warn_trap
      diagnostics::splainthis
         diagnostics::transmo
         diagnostics::shorten
        diagnostics::autodescribe</code></pre>
<p>So we see that two executions of <code>diagnostics::BEGIN</code> and 3161 of
<code>diagnostics::unescape</code> are responsible for most of the running
overhead.</p>
<p>If we comment out the <code>diagnostics</code> module, we get:</p>
<pre><code>
  Total Elapsed Time = 0.079974 Seconds
    User+System Time = 0.059974 Seconds
  Exclusive Times
  %Time ExclSec CumulS #Calls sec/call Csec/c  Name
   0.00   0.000 -0.000      1   0.0000      -  main::test_code</code></pre>
<p>It is possible to profile code running under mod_perl with the
<code>Devel::DProf</code> module, available on CPAN.  However, you must have
apache version 1.3b3 or higher and the <code>PerlChildExitHandler</code> enabled
during the httpd build process.  When the server is started,
<code>Devel::DProf</code> installs an <code>END</code> block to write the <em>tmon.out</em>
file.  This block will be called at server shutdown. Here is how to
start and stop a server with the profiler enabled:</p>
<pre><code>
  % setenv PERL5OPT -d:DProf
  % httpd -X -d `pwd` &amp;
  ... make some requests to the server here ...
  % kill `cat logs/httpd.pid`
  % unsetenv PERL5OPT
  % dprofpp</code></pre>
<p>The <code>Devel::DProf</code> package is a Perl code profiler.  It will collect
information on the execution time of a Perl script and of the subs in
that script (remember that <code>print()</code> and <code>map()</code> are just like any
other subroutines you write, but they come bundled with Perl!)</p>
<p>Another approach is to use <code>Apache::DProf</code>, which hooks
<code>Devel::DProf</code> into mod_perl.  The <code>Apache::DProf</code> module will run a
<code>Devel::DProf</code> profiler inside each child server and write the
<em>tmon.out</em> file in the directory <code>$ServerRoot/logs/dprof/$$</code> when
the child is shutdown (where <code>$$</code> is the number of the child
process).  All it takes is to add to <em>httpd.conf</em>:</p>
<pre><code>
  PerlModule Apache::DProf</code></pre>
<p>Remember that any PerlHandler that was pulled in before
<code>Apache::DProf</code> in the <em>httpd.conf</em> or <em>startup.pl</em>, will not have
its code debugging information inserted.  To run <code>dprofpp</code>, chdir to
<code>$ServerRoot/logs/dprof/$$</code> and run:</p>
<pre><code>
  % dprofpp</code></pre>
<p>(Lookup the <code>ServerRoot</code> directive's value in <em>httpd.conf</em> to figure
out what your <code>$ServerRoot</code> is.)</p>
<p>
</p>














<h3><a name="measuring_the_memory_of_the_process">Measuring the Memory of the Process</a></h3>
<p>One very important aspect of performance tuning is to make sure that your
applications don't use much memory, since if they do you cannot run
many servers and therefore in most cases under a heavy load the
overall performance degrades.</p>
<p>In addition the code may not be clean and leak memory, which is even
worse. In this case, the same process serves many requests and after
each request more memory is used. After a while all your RAM will be
used and machine will start swapping (use the swap partition) which is a
very undesirable event, since it may lead to a machine crash.</p>
<p>The simplest way to figure out how big the processes are and see
whether they grow is to watch the output of <code>top(1)</code> or <code>ps(1)</code> utilities.</p>
<p>For example the output of top(1):</p>
<pre><code>
    8:51am  up 66 days,  1:44,  1 user,  load average: 1.09, 2.27, 2.61
  95 processes: 92 sleeping, 3 running, 0 zombie, 0 stopped
  CPU states: 54.0% user,  9.4% system,  1.7% nice, 34.7% idle
  Mem:  387664K av, 309692K used,  77972K free, 111092K shrd,  70944K buff
  Swap: 128484K av,  11176K used, 117308K free                170824K cached</code></pre>
<pre><code>
     PID USER PRI NI SIZE  RSS SHARE STAT LIB %CPU %MEM   TIME COMMAND
  29225 nobody 0  0  9760 9760  7132 S      0 12.5  2.5   0:00 httpd_perl
  29220 nobody 0  0  9540 9540  7136 S      0  9.0  2.4   0:00 httpd_perl
  29215 nobody 1  0  9672 9672  6884 S      0  4.6  2.4   0:01 httpd_perl
  29255 root   7  0  1036 1036   824 R      0  3.2  0.2   0:01 top
    376 squid  0  0 15920  14M   556 S      0  1.1  3.8 209:12 squid
  29227 mysql  5  5  1892 1892   956 S N    0  1.1  0.4   0:00 mysqld
  29223 mysql  5  5  1892 1892   956 S N    0  0.9  0.4   0:00 mysqld
  29234 mysql  5  5  1892 1892   956 S N    0  0.9  0.4   0:00 mysqld</code></pre>
<p>Which starts with overall information of the system and then displays
the most active processes at the given moment. So for example if we
look at the <code>httpd_perl</code> processes we can see the size of the
resident (<code>RSS</code>) and shared (<code>SHARE</code>) memory segments. This sample
was taken on the production server running linux.</p>
<p>But of course we want to see all the apache/mod_perl processes, and
that's where <code>ps(1)</code> comes to help. The options of this utility vary
from one Unix flavor to another, and some flavors provide their own
tools. Let's check the information about mod_perl processes:</p>
<pre><code>
  % ps -o pid,user,rss,vsize,%cpu,%mem,ucomm -C httpd_perl
    PID USER      RSS   VSZ %CPU %MEM COMMAND
  29213 root     8584 10264  0.0  2.2 httpd_perl
  29215 nobody   9740 11316  1.0  2.5 httpd_perl
  29216 nobody   9668 11252  0.7  2.4 httpd_perl
  29217 nobody   9824 11408  0.6  2.5 httpd_perl
  29218 nobody   9712 11292  0.6  2.5 httpd_perl
  29219 nobody   8860 10528  0.0  2.2 httpd_perl
  29220 nobody   9616 11200  0.5  2.4 httpd_perl
  29221 nobody   8860 10528  0.0  2.2 httpd_perl
  29222 nobody   8860 10528  0.0  2.2 httpd_perl
  29224 nobody   8860 10528  0.0  2.2 httpd_perl
  29225 nobody   9760 11340  0.7  2.5 httpd_perl
  29235 nobody   9524 11104  0.4  2.4 httpd_perl</code></pre>
<p>Now you can see the resident (<code>RSS</code>) and virtual (<code>VSZ</code>) memory
segments (and shared memory segment if you ask for it) of all mod_perl
processes. Please refer to the <code>top(1)</code> and <code>ps(1)</code> man pages for more
information.</p>
<p>You probably agree that using <code>top(1)</code> and <code>ps(1)</code> are cumbersome if we
want to use memory size sampling during the benchmark test. We want to
have a way to print memory sizes during the program execution at
desired places. If you have <code>GTop</code> modules installed, which is a perl
glue to the <code>libgtop</code> library, it's exactly what we need.</p>
<p>Note: <code>GTop</code> requires the <code>libgtop</code> library but is not available for
all platforms.  Visit <a href="http://www.home-of-linux.org/gnome/libgtop/">http://www.home-of-linux.org/gnome/libgtop/</a> to
check whether your platform/flavor is supported.</p>
<p><code>GTop</code> provides an API for retrieval of information about processes
and the whole system. We are only interested in memory sampling API
methods. To print all the process related memory information we can
execute the following code:</p>



<pre><code>
  use GTop;
  my $gtop = GTop-&gt;new;
  my $proc_mem = $gtop-&gt;proc_mem($$);
  for (qw(size vsize share rss)) {
      printf &quot;   %s =&gt; %d\n&quot;, $_, $proc_mem-&gt;$_();
  }</code></pre>
<p>When executed we see the following output (in bytes):</p>
<pre><code>
      size =&gt; 1900544
     vsize =&gt; 3108864
     share =&gt; 1392640
       rss =&gt; 1900544</code></pre>
<p>So if we are interested in to print the process resident memory
segment before and after some event we just do it: For example if we
want to see how much extra memory was allocated after a variable
creation we can write the following code:</p>
<pre><code>
  use GTop;
  my $gtop = GTop-&gt;new;
  my $before = $gtop-&gt;proc_mem($$)-&gt;rss;
  my $x = 'a' x 10000;
  my $after  = $gtop-&gt;proc_mem($$)-&gt;rss;
  print &quot;diff: &quot;,$after-$before, &quot; bytes\n&quot;;</code></pre>
<p>and the output</p>
<pre><code>
  diff: 20480 bytes</code></pre>
<p>So we can see that Perl has allocated extra 20480 bytes to create
<code>$x</code> (of course the creation of <code>after</code> needed a few bytes as well,
but it's insignificant compared to a size of <code>$x</code>)</p>
<p>The <code>Apache::VMonitor</code> module with help of the <code>GTop</code> module allows
you to watch all your system information using your favorite browser
from anywhere in the world without a need to telnet to your machine.
If you are looking into what information you can retrieve with <code>GTop</code>,
you should examine <code>Apache::VMonitor</code>, as it deploys a big part of
the API that <code>GTop</code> provides.</p>
<p>If you are running a true BSD system, you may use
<code>BSD::Resource::getrusage</code> instead of <code>GTop</code>. For example:</p>
<pre><code>
  print &quot;used memory = &quot;.(BSD::Resource::getrusage)[2].&quot;\n&quot;</code></pre>
<p>For more information refer to the <code>BSD::Resource</code> manpage.</p>
<p>
</p>
<h3><a name="measuring_the_memory_usage_of_subroutines">Measuring the Memory Usage of Subroutines</a></h3>
<p>With help of <code>Apache::Status</code> you can find out the size of each
and every subroutine.</p>
<ol>
<li>
Build and install mod_perl as you always do, make sure it's version
1.22 or higher.

</li>
<li>
Configure /perl-status if you haven't already:
<pre><code>
  &lt;Location /perl-status&gt;
    SetHandler perl-script
    PerlHandler Apache::Status
    order deny,allow
    #deny from all
    #allow from ...
  &lt;/Location&gt;</code></pre>

</li>
<li>
Add to httpd.conf
<pre><code>
  PerlSetVar StatusOptionsAll On
  PerlSetVar StatusTerse On
  PerlSetVar StatusTerseSize On
  PerlSetVar StatusTerseSizeMainSummary On</code></pre>
<pre><code>
  PerlModule B::TerseSize</code></pre>

</li>
<li>
Start the server (best in httpd -X mode)

</li>
<li>
From your favorite browser fetch <a href="http://localhost/perl-status">http://localhost/perl-status</a>

</li>
<li>
Click on 'Loaded Modules' or 'Compiled Registry Scripts'

</li>
<li>
Click on the module or script of your choice (you might need
to run some script/handler before you will see it here unless it was
preloaded)

</li>
<li>
Click on 'Memory Usage' at the bottom

</li>
<li>
You should see all the subroutines and their respective sizes.
</ol>
<p>Now you can start to optimize your code, or test which of several
implementations is of the least size.</p>
<p>For example let's compare <code>CGI.pm</code>'s OO vs. procedural interfaces:</p>
<p>As you will see below the first OO script uses about 2k bytes while
the second script (procedural interface) uses about 5k.</p>
<p>Here are the code examples and the numbers:</p>
<ol>

<li>
<pre><code>
  cgi_oo.pl
  ---------
  use CGI ();
  my $q = CGI-&gt;new;
  print $q-&gt;header;
  print $q-&gt;b(&quot;Hello&quot;);</code></pre>
</li>
<li>
<pre><code>
  cgi_mtd.pl
  ---------
  use CGI qw(header b);
  print header();
  print b(&quot;Hello&quot;);</code></pre></li>
</ol>
<p>After executing each script in single server mode (-X) the results are:</p>
<ol>
<li>
<pre><code>
  Totals: 1966 bytes | 27 OPs
  
  handler 1514 bytes | 27 OPs
  exit     116 bytes |  0 OPs</code></pre></li>
<li>
<pre><code>
  Totals: 4710 bytes | 19 OPs
  
  handler  1117 bytes | 19 OPs
  basefont  120 bytes |  0 OPs
  frameset  120 bytes |  0 OPs
  caption   119 bytes |  0 OPs
  applet    118 bytes |  0 OPs
  script    118 bytes |  0 OPs
  ilayer    118 bytes |  0 OPs
  header    118 bytes |  0 OPs
  strike    118 bytes |  0 OPs
  layer     117 bytes |  0 OPs
  table     117 bytes |  0 OPs
  frame     117 bytes |  0 OPs
  style     117 bytes |  0 OPs
  Param     117 bytes |  0 OPs
  small     117 bytes |  0 OPs
  embed     117 bytes |  0 OPs
  font      116 bytes |  0 OPs
  span      116 bytes |  0 OPs
  exit      116 bytes |  0 OPs
  big       115 bytes |  0 OPs
  div       115 bytes |  0 OPs
  sup       115 bytes |  0 OPs
  Sub       115 bytes |  0 OPs
  TR        114 bytes |  0 OPs
  td        114 bytes |  0 OPs
  Tr        114 bytes |  0 OPs
  th        114 bytes |  0 OPs
  b         113 bytes |  0 OPs</code></pre></li>
</ol>
<p>Note, that the above is correct if you didn't precompile all
<code>CGI.pm</code>'s methods at server startup. Since if you did, the
procedural interface in the second test will take up to 18k and not 5k
as we saw. That's because the whole of <code>CGI.pm</code>'s namespace is
inherited and it already has all its methods compiled, so it doesn't
really matter whether you attempt to import only the symbols that you
need.  So if you have:</p>
<pre><code>
  use CGI  qw(-compile :all);</code></pre>
<p>in the server startup script. Having:</p>
<pre><code>
  use CGI qw(header);</code></pre>
<p>or</p>
<pre><code>
  use CGI qw(:all);</code></pre>
<p>is essentially the same. You will have all the symbols precompiled at
startup imported even if you ask for only one symbol.  It
seems to me like a bug, but probably that's how <code>CGI.pm</code> works.</p>
<p>BTW, you can check the number of opcodes in the code by a simple
command line run. For example comparing 'my&nbsp;%hash' vs. 'my&nbsp;%hash&nbsp;=
()'.</p>
<pre><code>
  % perl -MO=Terse -e 'my %hash' | wc -l
  -e syntax OK
      4</code></pre>
<pre><code>
  % perl -MO=Terse -e 'my %hash = ()' | wc -l
  -e syntax OK
     10</code></pre>
<p>The first one has fewer opcodes.</p>
<p>Note that you shouldn't use <code>Apache::Status</code> module on production
server as it adds quite a bit of overhead to each request.</p>
<p>
</p>
<hr />
<h1><a name="references">References</a></h1>
<ul>
<li>
The mod_perl site's URL: <a href="http://perl.apache.org">http://perl.apache.org</a></li>

<li>
<code>Devel::DProf</code>
<p><a href="http://search.cpan.org/search?dist=DProf">http://search.cpan.org/search?dist=DProf</a></p></li>

<li>
<code>Apache::DProf</code>
<p><a href="http://search.cpan.org/search?dist=Apache-DB">http://search.cpan.org/search?dist=Apache-DB</a></p></li>

<li>
<code>Apache::VMonitor</code>
<p><a href="http://search.cpan.org/search?dist=Apache-VMonitor">http://search.cpan.org/search?dist=Apache-VMonitor</a></p></li>

<li>
<code>GTop</code>
<p><a href="http://search.cpan.org/search?dist=GTop">http://search.cpan.org/search?dist=GTop</a></p>
<p>The home of the C library: <a href="http://www.home-of-linux.org/gnome/libgtop/">http://www.home-of-linux.org/gnome/libgtop/</a></p></li>

<li>
<code>BSD::Resource</code>
<p><a href="http://search.cpan.org/search?dist=BSD-Resource">http://search.cpan.org/search?dist=BSD-Resource</a></p></li>
</ul>

                                    </div>


                                </div>
                                <div class="asset-footer">


                                    <div class="entry-tags">
                                        <h4>Tags<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=mod_perl%20benchmarking%20test&amp;limit=20';return false;" rel="tag">mod_perl benchmarking test</a></li>
                                        </ul>
                                    </div>

                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
