<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: December 2002 Archives</title>


    <link rel="prev" href="/pub/2002/11/" title="November 2002" />
    <link rel="next" href="/pub/2003/01/" title="January 2003" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">December 2002 Archives</h1>





                            
                            <div id="entry-1412" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/12/18/hohoho.html" rel="bookmark">How Perl Powers Christmas</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Alex Gough</span> on <abbr class="published" title="2002-12-18T00:00:00-08:00">December 18, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>You know, it's not easy having the happiness of billions of children
around the world resting with your organization, and it's even harder
on the IT department.  The incorporated elves and pixiefolk of
the North Pole, under the direction of their jolly old leader, have to deal
with massive quantities of data, huge manfacturing flows and what is
possibly the strictest delivery timetable in the world.  Despite these
challenges Santa and his reindeer have been able to meet their tight
deadline and achieve one of the highest customer satisfaction ratings
in industry.</p>
<p>For many centuries, the elves needed to work for only a couple of
months of the year to manufacture every gift for every child, but
recent advances in technology and the increasing global population
have, in the past two decades, left them working day and night all
year round, with only a few days of holiday before work had to begin
again in early Janurary.  During the early '90s, some workflow
improvements were made and some time savings were gained by using a
mainframe to coordinate the route Santa would take on the night before
Christmas, ensuring he could still visit every client during the 24
hours available.  By 1995, these savings had made only a small
difference to the performance of the operation, with representatives
of the Amalgamated Present Production and Sleigh Mechanics' Union
threatening to leak to the media predictions that Christmas might need
to be cancelled in 1998 and held bi-annually from then on if every
child was to receive presents on the same day.  The elves even
considered going on strike in 1996, but they reconsidered after seeing
the reaction of a young boy to his older brother's proof that Santa
Claus could not physically exist.  (Santa is, of course, entirely real
-- he just doesn't pay too much attention to natural laws.)</p>
<p>Thankfully, history took a different route and the North Pole escaped its
first industrial action since records began.  A searching review of
the whole production process included sending parts of the short
statured delivery facilitation team on outplacements in industry.  One
of the elves in this division was lucky enough to be sent along to an
emerging dot-com, where he discovered -- and instantly fell in love
with -- Perl.  He returned to the Pole brimming with enthusiasm and
soon convinced Santa (well, his wife, who then made Mr. Claus
convinced) that it would be possible to prepare for Christmas in a
matter of months, or maybe even weeks, if this emerging tool fulfilled
its early promise.</p>
<p>That was seven years ago, and now Perl powers Christmas.  Its diverse
realm of application, not to mention its slightly idiosyncratic
nature, fit the mindset of an elf perfectly and -- more importantly --
help them to get everything done in November and December, leaving
them the rest of the year to enjoy themselves.</p>
<p>The first application of Perl was in the Health and Safety department.
For many years, the Association for the Prevention of Cruelty to
Avionic Reindeer was worried about the risks presented during landings
on roofs and increasingly from the potential for midair collisions with
aircraft.  An effort was undertaken to carefully map international air
corridors, catalog hazardous or unstable landing patches and (as
Santa's diet was underperforming) details of chimney widths for every
dwelling on the planet.  Needless to say maintaining this was a
nightmare -- until, that is, a custom set of tools was written in Perl
to allow Santa's scouts to take reports from the field using a
primitive Web interface.  The major benefit of Perl here was the speed
with which new types of reindeer strip could be added to the database
as the time needed to program the necessary logic to handle them was
reduced.</p>
<p>Perl continued to make inroads on the databases of Santa's grottos.
Next to fall to its rogueish charms was the global child distribution
and route planning systems.  These had been implemented on two
mainframes under two different packages but global population growth
scaled faster than the earlier architecture, requiring a shift to an
entirely new distributed design.  The database itself uses a commercial
package but the data migration was handled using Perl.  Its flexible
dynamic typing, object system and, above all, the set of DBI drivers
allowed Perl to talk to every database in its own language without the
programmers needing to learn each and every one of them.  This project
was completed ahead of schedule leaving the team of crack data migration
experts with little to do, so they were tasked to set their tools onto
the internally infamous naughtyness database.</p>

<hr size="2" noshade />
<div align="center">
<a href="http://www.thinkgeek.com/oreilly/"><img src="/images/ads/oreillygear_468x60.gif" width="468" height="60" alt="O'Reilly Gear" border="0" /></a>
</div>
<hr size="2" noshade />

<p>The naughtyness database was, for many years, simply a set of paper
files kept in a filing cabinet in a dungeon by a troll.  Every year,
the troll would carefully collate every good deed and every black act
of every boy and girl the world over.  Before distributing presents on
Christmas day, Father Christmas would ask the troll if there were any
children that deserved coal instead.  Of course, due to his meticulous
record keeping the troll could honestly, if gruffly, reply &quot;no, not a
single child has been that bad.&quot;  The mounting volumes of data near
the end of the last century left the troll unable to keep up with
developments.  Soon he began to confuse one child with another,
sometimes he couldn't enter every good thought of every child and
eventually the system failed.  A child was assigned not one but two
sacks of coal.  Thankfully an internal investigation revealed the
problems faced by the troll and corrected the error, but it was
decided that the troll must be retired in favor of a system based on
the latest developments in artificial intelligence technologies.  The
review also concluded that the system should also modified so that
especially good children would get better presents delivered, and coal
was retired in favor of a good talking to from the troll who now
relishes his new line in community work.</p>
<p>Getting back to the technical details, the system needed to run
quickly (emulating a troll is not an easy undertaking, they may appear
dimwitted but are, in fact, deeply pondering the games of postal Go
they love so much).  At the same time, it had to allow for operators to
script the system and tune its operation using a high level language.
It was decided that the crucial parts of the program would be
implemented in C, with wrappers being written using the Inline::C
module allowing Perl to form the high level director of the system.
This proved to be a great sucess, with roughly 5 percent of children now
qualifying for bonus presents.  Elves are also queing up to work in
the new department, in part because of the rewarding work, but also
because the system allows them so much room to tinker with the
criteria for awards as each processing run is performed so quickly.</p>
<p>The recent explosion of the Internet has been both good and bad for
the elves in the mail room.  Santa receives many millions of letters
each year from all around the world, and now also gets about 10 times
as many e-mails.  For a time, these were processed in the same way as
the letters, but soon a new solution was required.  In the end, rather
than develop an in house tool, the elves adopted RT -- a trouble
ticketing and bug tracking system written in Perl -- to handle the
assignment of requests to manufacturing areas.  This allowed a much
closer match between the wishes of the children and the presents they
unwrapped come Dec. 25.  The elves also encountered a growing
problem from e-mail spam.  For a while, they naively assumed that Santa
should be sending viagra and his bank details to relatives of the
President of Nigeria, but eventually they twigged that odd things were
afoot.  A bit of research, and some help from the Perl community, led
them quickly to Mail::Audit and spamassassin as an optimal filter.</p>
<p>In line with many companies these days, the North Pole has started to
outsource its production of presents to commercial concerns.  Perl has
again been able to help with this effort by acting as a mediator
between the requirements database produced from letters to Santa and
the production systems of the outsourced manufacturers.  A combination
of freely available XML, SOAP and CORBA tools allow rapid creation of
interfaces to the systems of new partners and allow aggregation of
many external representations of an invoice to a single standard form
suitable for input to the internal accounting systems.</p>
<p>These accounting systems are written entirely in Perl, mostly because
commercial packages are not available to deal in the currency (sherry,
biscuits and carrots) of Santa's environs.  This highly available mission
critical application ensures that elves are well supplied with the
rewards for their work and keeps the workforce motivated the whole
year round.  Using a core engine written using Perl's framework for
multi user dungeons (and any other multitasking or massively networked
environments), POE, the system has scaled to process over one billion
transactions in a single day.  (The elves and reindeer are paid
yearly, on boxing day, out of the titbits left out in houses and
collected by Santa as he passes through.)</p>
<p>Fifi Longstockings, the chief software engineer and head of
blancmange parties, says of Perl: &quot;without Perl, I don't know what
would happen to our operation.  It's now critical to every area of our
business and contributes directly to the magic of Christmas.  It's
amazing just how much hard work and effort it has helped us avoid in
the past few years.  Here in the grotto we dare to be lazy and Perl is
the ideal tool for the inspired slacker who'd rather sing and dance
than spend longer than they need to at work.&quot;  He also looks forward
to the benefits that Perl 6 could bring, and is happy that Perl will
continue to be supported by the community for the foreseeable future:
&quot;Of course, Perl has come a long way since we started using it.  There
were some tasks it just couln't cope with before it gained an object
oriented framework and there are some things now we'd love to get done
using it but cannot.  Some of these should be possible with Perl 6
though, so we're investing a couple of our elves' time and some fairy
dust in parrot development at the moment.  It's certainly an exciting
time for us, and for Perl!&quot;</p>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1410" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/12/11/mason.html" rel="bookmark">Programming with Mason</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Dave Rolsky</span> on <abbr class="published" title="2002-12-11T00:00:00-08:00">December 11, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p><i>Dave Rolsky and Ken Williams are the authors of 
<a href="http://www.oreilly.com/catalog/perlhtmlmason/">Embedding Perl in HTML with Mason</a>.</i></p>



<p>Mason is a powerful framework for generating dynamic text, and is
especially useful when creating complex, featureful Web sites.  For
those (hopefully few) folks who haven't yet heard of Mason, it is a
Perl-based templating framework comparable to frameworks such as 
Apache::ASP, Embperl, and Template Toolkit.  Like the first two, and
unlike the latter, Mason operates by embedding Perl in text.</p>

<p>Mason is based around the idea of a <i>component</i>.  A component is
roughly equivalent to a Perl subroutine, and can contain text and/or
code.  Here is a <i>very</i> simple, but complete component that has both
text and code:</p>

<pre><code>
 % my $planet = "World";
 Hello, &lt;% $planet %>!
</code></pre>

<p>When Mason runs this code, the output is:</p>

<pre><code>
 Hello, World!
</code></pre>

<csperl file="grab" domain="on" record="b/795" template="article_sidebar.view">

<p>The rest of this article assumes at least a minimal familiarity with
Mason, though if you're at all familiar with other templating systems,
you'll probably be able to grok the code we show.  For more details, I
would of course recommend <i>Embedding Perl in HTML with Mason</i>,
written by Ken Williams and myself.  Mason also comes with its own
documentation, which can be seen online at <a 
href="http://www.masonhq.com/">www.masonhq.com</a>.</p>

<p>As with any powerful and flexible system, Mason is applicable to a lot
of problems, and there is always more than one way to do it.  It is a
<i>Perl</i>-based system, after all!</p>

<p>Below you'll find some cookbook recipes for solving a few typical Web
application problems.  All the recipes assume that you are using the
latest version of Mason, which at the time of this writing is 1.15,
though most of them will work untouched with older versions.</p>

<h3>Putting a Session ID in All URLs</h3>

<p>If you've ever written a dynamic Web application, then it's likely that
you've used sessions to store data as the user moves through the
application.  Typically, sessions are identified by session IDs that are
stored in a cookie.</p>

<p>If you cannot use cookies, then you can store the session ID in the URL.
There are security and application problems with this approach (as well
as with the user of cookies), but those are outside the scope of this
article.  The mod_perl user list archives at <a href="http://marc.theaimsgroup.com/?l=apache-modperl">marc.theaimsgroup.com/?l=apache-modperl</a> contain a number of discussions related to this topic.</p>

<p>Putting the session ID in the URL can be a hassle, because
it means that you have to somehow process all the URLs you generate.
Using Mason, this isn't as difficult as it would be otherwise.  There
are at least two ways to do this.</p>

<p>The first would be to put a filter in your top level <code>autohandler</code>
component:</p>

<pre><code>
  &lt;%filter>
   s/href="([^"])+"/'href="' . add_session_id($1) . '"'/eg;
   s/action="([^"])+"/'href="' . add_session_id($1) . '"'/eg;
  &lt;/%filter>
</code></pre>

The <code>add_session_id()</code> subroutine, which should be defined in a
module, might look something like this:

<pre><code>
  sub add_session_id {
      my $url = shift;

      return $url if $url =~ m{^\w+://}; # Don't alter external URLs

      if ($url =~ /\?/) {
  	  $url =~ s/\?/?session_id=$MasonBook::Session{_session_id}&/;
      } else {
          $url .= "?session_id=$MasonBook::Session{_session_id}";
      }

      return $url;
  }
</code></pre>

<p>This routine accounts for external links as well as links with or
without an existing query string.</p>

<p>The drawback to putting this in a <code>&lt;%filter&gt;</code> section is that it
only filters URLs in the content generated by components, and misses any URLs that might be in headers, such as in a redirect.  Therefore, you'd need to handle those cases separately with this solution.</p>

<p>Another solution would be to create all URLs (including those
intended for redirects) via a dedicated component or subroutine that 
adds the session id.  This latter solution is probably a better
idea, as it handles redirects properly.  The drawback with this
strategy is that you'll have a Mason component call for every link,
instead of just regular HTML.</p>

<p>Here is just such a component:</p>

<pre><code>
  &lt;%args>
   $scheme   => 'http'
   $username => undef
   $password => ''
   $host     => undef
   $port     => undef
   $path
   %query    => ()
   $fragment => undef
  &lt;/%args>
  &lt;%init>
   my $uri = URI->new;

   if ($host) {
       $uri->scheme($scheme);

       if (defined $username) {
           $uri->authority( "$username:$password" );
       }

       $uri->host($host);
       $uri->port($port) if $port;
   }

   # Sometimes we may want to include a path in a query string as part
   # of the path but the URI module will escape the question mark.
   my $q;

   if ( $path =~ s/\?(.*)$// ) {
       $q = $1;
   }

   $uri->path($path);

   # If there was a query string, we integrate it into the query
   # parameter.
   if ($q) {
       %query = ( %query, split /[&=]/, $q );
   }

   $query{session_id} = $UserSession{session_id};

   # $uri->query_form doesn't handle hash ref values properly
   while ( my ( $key, $value ) = each %query ) {
       $query{$key} = ref $value eq 'HASH' ? [ %$value ] : $value;
   }

   $uri->query_form(%query) if %query;

   $uri->fragment($fragment) if $fragment;
  &lt;/%init>
  &lt;% $uri->canonical | n %>\
</code></pre>

<p>If you didn't want to put the session ID in the query string, then you
might instead make it part of the URL path.  The application could
retrieve the session id from incoming requests by using a mod_perl
handler during the URL translation stage of request handling.</p>

<p>This component provides a programmatic interface to URL 
generation.  Here is an example of how to use it, assuming that 
you've saved it as a component called <code>/url</code>:</p>

<pre><code>
   ... some HTML ...
   Look at &lt;a href="&lt;&amp; /url, path => "books.html" &>">our books&lt;/a>
   or &lt;a href="&lt;&amp; /url, host => "www.oreilly.com"
                        path => "/catalog" &>">O'Reilly's&lt;/a>.
   ... some HTML ...
</code></pre>

<h3>Making Use of Autoflush</h3>

<p>Every once in a while, you may have to output a very large component or a 
file to the client.  If you simply let this accumulate in the output buffer, you could use up a lot of memory.  Furthermore, the slow response time may make the user think that the site has stalled.</p>

<p>Here is an example that sends out the contents of a potentially large
file without sucking up lots of memory.</p>

<pre><code>
  &lt;%args>
   $filename
  &lt;/%args>
  &lt;%init>
   local *FILE;
   open FILE, "&lt; $filename" or die "Cannot open $filename: $!";
   $m->autoflush(1);
   while (&lt;FILE>) {
       $m->print($_);
   }
   $m->autoflush(0);
  &lt;/%init>
</code></pre>

<p>If each line wasn't too huge, then you might just flush the buffer every
once in a while:</p>

<pre><code>
  &lt;%args>
   $filename
  &lt;/%args>
  &lt;%init>
   local *FILE;
   open FILE, "&lt; $filename" or die "Cannot open $filename: $!";
   while (&lt;FILE>) {
       $m->print($_);
       $m->flush_buffer unless $. % 10;
   }
   $m->flush_buffer;
  &lt;/%init>
</code></pre>

<p>The <code>unless $. % 10</code> bit makes use of the special Perl variable
<code>$.</code>, which is the current line number of the file being read.  If
this number modulo 10 is equal to zero, then we flush the buffer.  This
means that we flush the buffer every 10 lines.  (Replace the number
10 with any desired value.)</p>

<h3>User Authentication and Authorization</h3>

<p>One problem that Web sites have to solve over and over again is user
authentication and authorization.  These two topics are related but
not the same, as some might think.  Authentication is the process of
figuring out if someone is who they say they are, and usually involves
checking passwords or keys.  Authorization comes after
this, when we want to determine whether a particular person is
allowed to perform a certain action.</p>

<p>There are a number of modules on CPAN that are intended to help do
these things under <code>mod_perl</code>.  In fact, Apache has separate request-handling phases for both authentication and authorization that
<code>mod_perl</code> can handle.  It is certainly possible to use these modules
with Mason.</p>

<p>You can also do authentication and authorization using Mason
components. Authentication will usually involve some sort of request
for a login and a password, after which you give the user some sort of
token (either in a cookie or a session) that indicates that they have
been authenticated.  You can then check the validity of this token for
each request.</p>

<p>If you have such a token, then authorization simply consists of
checking that the user to whom the token belongs is allowed to perform
a given action.</p>

<h3>Using Apache::AuthCookie</h3>

<p>The <code>Apache::AuthCookie</code> module, available from CPAN, is a module
that handles both authentication and authorization via <code>mod_perl</code> and
can be easily hooked into Mason.  Rather than go through all the
details of configuring <code>Apache::AuthCookie</code>, which requires various
settings in your server config file, let's just skip all that and show
you how you'd make the interface to Mason.</p>

<p><code>Apache::AuthCookie</code> requires that you create a "login script" that
will be executed the first time a browser tries to access a protected
area.  Calling this a script is actually somewhat misleading since it
is really a page rather than a script (though it could be a script
that generates a page).  Regardless, using a Mason component for your
"login script" merely requires that you specify the path to your Mason
component for the login script parameter.</p>

<p>We'll call this "script" <code>AuthCookieLoginForm.comp</code>:</p>

<pre><code>
  &lt;html>
  &lt;head>
  &lt;title>Mason Book AuthCookie Login Form&lt;/title>
  &lt;/head>
  &lt;body>
  &lt;p>
  Your attempt to access this document was denied
  (&lt;% $r->prev->subprocess_env("AuthCookieReason") %>).  Please enter
  your username and password.
  &lt;/p>

  &lt;form action="/AuthCookieLoginSubmit">
  &lt;input type="hidden" name="destination" value="&lt;% $r->prev->uri %>">
  &lt;table align="left">
   &lt;tr>
    &lt;td align="right">&lt;b>Username:&lt;/b>&lt;/td>
    &lt;td>&lt;input type="text" name="credential_0" size="10" maxlength="10">&lt;/td>
   &lt;/tr>
   &lt;tr>
    &lt;td align="right">&lt;b>Password:&lt;/b>&lt;/td>
    &lt;td>&lt;input type="password" name="credential_1" size="8" maxlength="8">&lt;/td>
   &lt;/tr>
   &lt;tr>
    &lt;td colspan="2" align="center">&lt;input type="submit" value="Continue">&lt;/td>
   &lt;/tr>
  &lt;/table>
  &lt;/form>

  &lt;/body>
  &lt;/html>
</code></pre>

<p>This component is modified version of the example login script
included with the <code>Apache::AuthCookie</code> distribution.</p>

<p>The action used for this form, <code></AuthCookieLoginSubmit></code>, is
configured as part of your AuthCookie configuration in your
<code>httpd.conf</code> file.</p>

<p>That's about all it takes to glue <code>Apache::AuthCookie</code> and Mason together.  The rest of 
authentication and authorization is handled by configuring <code>mod_perl</code> to
use <code>Apache::AuthCookie</code> to protect anything on your site that needs
authorization.  A very simple configuration might include the
following directives:</p>

<pre><code>
  PerlSetVar MasonBookLoginScript /AuthCookieLoginForm.comp

  &lt;location /authcookieloginsubmit>
    AuthType MasonBook::AuthCookieHandler
    AuthName MasonBook
    SetHandler  perl-script
    PerlHandler MasonBook::AuthCookieHandler->login
  &lt;/location>

  &lt;location /protected>
    AuthType MasonBook::AuthCookieHandler
    AuthName MasonBook
    PerlAuthenHandler MasonBook::AuthCookieHandler->authenticate
    PerlAuthzHandler  MasonBook::AuthCookieHandler->authorize
    require valid-user
  &lt;/location>
</code></pre>

The <code>MasonBook::AuthCookieHandler</code> module would look like this:

<pre><code>
  package MasonBook::AuthCookieHandler;

  use strict;

  use base qw(Apache::AuthCookie);

  use Digest::SHA1;

  my $secret = "You think I'd tell you?  Hah!";

  sub authen_cred {
      my $self = shift;
      my $r = shift;
      my ($username, $password) = @_;

      # implementing _is_valid_user() is out of the scope of this chapter
      if ( _is_valid_user($username, $password) ) {
          my $session_key =
            $username . '::' . Digest::SHA1::sha1_hex( $username, $secret );
          return $session_key;
      }
  }

  sub authen_ses_key {
      my $self = shift;
      my $r = shift;
      my $session_key = shift;

      my ($username, $mac) = split /::/, $session_key;

      if ( Digest::SHA1::sha1_hex( $username, $secret ) eq $mac ) {
          return $session_key;
      }
  }
</code></pre>

<p>This provides the minimal interface an <code>Apache::AuthCookie</code> subclass
needs to provide to get authentication working.</p>
















<h3>Doing It My Way (Thanks Frank)</h3>

<p>But what if you don't want to use <code>Apache::AuthCookie</code>?  For example,
your site may need to work without using cookies.  No doubt this was
exactly what Frank Sinatra was thinking about when he sang "My Way,"
so let's do it our way.</p>

<p>First, we will show an example authentication system that only uses
Mason and passes the authentication token around via the URL
(actually, via a session).</p>

<p>This example assumes that we already have some sort of session system
that passes the session id around as part of the URL, as discussed
previously.</p>

<p>We start with a quick login form.  We will call this component
<code>login_form.html</code>:</p>

<pre><code>
  &lt;%args>
   $username => ''
   $password => ''
   $redirect_to => ''
   @errors => ()
  &lt;/%args>
  &lt;html>
  &lt;head>
  &lt;title>Mason Book Login&lt;/title>
  &lt;/head>

  &lt;body>

  % if (@errors) {
  &lt;h2>Errors&lt;/h2>
  %   foreach (@errors) {
  &lt;b>&lt;% $_ | h %>&lt;/b>&lt;br>
  %   }
  % }

  &lt;form action="login_submit.html">
  &lt;input type="hidden" name="redirect_to" value="&lt;% $redirect_to %>">
  &lt;table align="left">
   &lt;tr>
    &lt;td align="right">&lt;b>Login:&lt;/b>&lt;/td>
    &lt;td>&lt;input type="text" name="username" value="&lt;% $username %>">&lt;/td>
   &lt;/tr>
   &lt;tr>
    &lt;td align="right">&lt;b>Password:&lt;/b>&lt;/td>
    &lt;td>&lt;input type="password" name="password" value="&lt;% $password %>">&lt;/td>
   &lt;/tr>
   &lt;tr>
    &lt;td colspan="2" align="center">&lt;input type="submit" value="Login">&lt;/td>
   &lt;/tr>
  &lt;/table>
  &lt;/form>

  &lt;/body>
  &lt;/html>
</code></pre>

<p>This form uses some of the same techniques we show in Chapter 8 ("Building a
Mason Site") to pre-populate the form and to handle errors.</p>

<p>Now let's make the component that handles the form submission.  This
component, called <code>login_submit.html</code>, will check the username and
password and, if they are valid, place an authentication token into
the user's session:</p>

<pre><code>
  &lt;%args>
   $username
   $password
   $redirect_to
  &lt;/%args>
  &lt;%init>
   if (my @errors = check_login($username, $password) {
       $m->comp( 'redirect.mas',
                  path => 'login_form.html',
                  query => { errors => \@errors,
                             username => $username,
                             password => $password,
                             redirect_to => $redirect_to } );
   }
 
   $MasonBook::Session{username} = $username;
   $MasonBook::Session{token} =
       Digest::SHA1::sha1_hex( 'My secret phrase', $username );
 
   $m->comp( 'redirect.mas',
             path => $redirect_to );
  &lt;/%init>
</code></pre>

<p>This component simply checks (via magic hand waving) that the username
and password are valid and if they are, it generates an
authentication token, which is added to the user's session.  To
generate this token, we take the username, which is also in the
session, and combine it with a secret phrase.  We then generate a MAC
from those two things.</p>

<p>The authentication and authorization check looks like this:</p>

<pre><code>
  if ( $MasonBook::Session{token} ) {
      if ( $MasonBook::Session{token} eq
           Digest::SHA1::sha1_hex( 'My secret phrase',
                                   $MasonBook::Session{username} ) {

          # R&lt;... valid login, do something here>
      } else {
          # R&lt;... someone is trying to be sneaky!>
      }
  } else { # no token
       my $wanted_page = $r->uri;
       
       # Append query string if we have one.
       $wanted_page .= '?' . $r->args if $r->args;

       $m->comp( 'redirect.mas',
                  path => '/login/login_form.html',
                  query => { redirect_to => $wanted_page } );
  }
</code></pre>

<p>We could put all the pages that require authorization in a single
directory tree and have a top-level autohandler in that tree do the
check.  If there is no token to check, then we redirect the browser to
the login page, and after a successful login they'll return, assuming
that they submit valid login credentials.</p>

<h3>Access Controls With Attributes</h3>

<p>The components we saw previously assumed that there are only two
access levels, unauthenticated and authenticated.  A more complicated
version of this code might involve checking that the user has a
certain access level or role.</p>

<p>In that case, we'd first check that we had a valid authentication
token and then go on to check that the user actually had the
appropriate access rights.  This is simply an extra step in the
authorization process.</p>

<p>Using attributes, we can easily define access controls for different
portions of our site.  Let's assume that we have four access levels,
"Guest," "User," "Editor" and "Admin."  Most of the site is public,
and viewable by anyone.  Some parts of the site require a valid login,
while some require a higher level of privilege.</p>

<p>We implement our access check in our top-level autohandler,
<code></autohandler></code>, from which all other components <i>must</i> inherit in
order for the access control code to be effective.</p>

<pre><code>

  &lt;%init>
   my $user = get_user();  # again, hand waving
 
   my $required_access = $m->base_comp->attr('required_access');
 
   unless ( $user->has_access_level($required_access) ) {
      # R&lt;... do something like send them to another page>
   }
 
   $m->call_next;
  &lt;/%init>
  &lt;%attr>
   required_access => 'Guest'
  &lt;/%attr>
</code></pre>

<p>It is crucial that we set a default access level in this autohandler.
By doing this, we are saying that by default, all components are
accessible by all people, since every visitor will have at least
"Guest" access.</p>

<p>We can override this default elsewhere.  For example, in a component
called <code>/admin/autohandler</code>, we might have:</p>

<pre><code>
  &lt;%attr>
   required_access => 'Admin'
  &lt;/%attr>
</code></pre>

<p>As long as all the components in the <code></admin/></code> directory inherit from
the <code></admin/autohandler></code> component and don't override the
<code>required_access</code> attribute, we have effectively limited that
directory (and its subdirectories) to administration users only.  If we, for
some reason, had an individual component in the <code></admin/></code> directory
that we wanted editors to be able to see, we could simply set the
"required_access" attribute for that component to "Editor."</p>

<h3>Managing DBI Connections</h3>

<p>Not infrequently, we see people on the Mason users list asking
questions about how to handle caching DBI connections.</p>

<p>Our recipe for this is really simple:</p>

<pre><code>
  use Apache::DBI
</code></pre>

<p>Rather than reinventing the wheel, use <code>Apache::DBI</code>, which provides
the following features:</p>

<ul>

<li><p>It is completely transparent to use.  Once you've used it, you simply
call <code>DBI->connect()</code> as always and <code>Apache::DBI</code> gives you an
existing handle if one is available.</p></li>

<li><p>It makes sure that the handle is live, so that if your RDBMS goes down
and then back up, your connections still work just fine.</p>
</li>


<li><p>It does not cache handles made before Apache forks, as many DBI
drivers do not support using a handle after a fork.</p>
</li>

</ul>

<h3>Generating Config Files</h3>

<p>Config files are a good candidate for generation by Mason.  For
example, your production and staging Web server config files might
differ in only a few areas.  Changes to one usually will need to be
propagated to another.  This is especially true with <code>mod_perl</code>,
where Web server configuration can basically be part of a Web-based
application.</p>

<p>On top of this, you may decide to set up a per-developer environment,
either by having each developer run the necessary software on their
own machine, or by starting Web servers on many different ports on a
single development server.  In this scenario, a template-driven config
file generator becomes even more appealing.</p>

<p>Here's a simple script to drive this generation.  This script assumes
that all the processes are running on one shared development machine.</p>

<pre><code>
  #!/usr/bin/perl -w

  use strict;

  use Cwd;
  use File::Spec;
  use HTML::Mason;
  use User::pwent;

  my $comp_root =
      File::Spec->rel2abs( File::Spec->catfile( cwd(), 'config' ) );

  my $output;
  my $interp =
      HTML::Mason::Interp->new( comp_root  => $comp_root,
				out_method => \$output,
			      );

  my $user = getpwuid($&lt;);

  $interp->exec( '/httpd.conf.mas', user => $user );

  my $file =  File::Spec->catfile( $user->dir, 'etc', 'httpd.conf' );
  open FILE, ">$file" or die "Cannot open $file: $!";
  print FILE $output;
  close FILE;
</code></pre>

<p>A <code>httpd.conf.mas</code> component might look like this:</p>

<pre><code>
  ServerRoot &lt;% $user->dir %>

  PidFile &lt;% File::Spec->catfile( $user->dir, 'logs', 'httpd.pid' ) %>

  LockFile &lt;% File::Spec->catfile( $user->dir, 'logs', 'httpd.lock' ) %>

  Port &lt;% $user->uid + 5000 %>

  # loads Apache modules, defines content type handling, etc.
  &lt;& standard_apache_config.mas &>

  &lt;perl>
   use lib &lt;% File::Spec->catfile( $user->dir, 'project', 'lib' ) %>;
  &lt;/perl>

  DocumentRoot &lt;% File::Spec->catfile( $user->dir, 'project', 'htdocs' ) %>

  PerlSetVar MasonCompRoot &lt;% File::Spec->catfile( $user->dir, 'project', 'htdocs' ) %>
  PerlSetVar MasonDataDir &lt;% File::Spec->catfile( $user->dir, 'mason' ) %>

  PerlModule HTML::Mason::ApacheHandler

  &lt;filesmatch "\.html$">
   SetHandler perl-script
   PerlHandler HTML::Mason::ApacheHandler
  &lt;/filesmatch>

  &lt;%args>
  $user
  &lt;/%args>
</code></pre>

<p>This points the server's document root to the developer's working
directory.  Similarly, it adds the <code>project/lib</code> directory to Perl's
<code>@INC</code> via <code>use lib</code> so that the user's working copy of the
project's modules are seen first.  The server will listen on a port
equal to the user's user ID, plus 5,000.</p>

<p>Obviously, this is an incomplete example.  It doesn't specify where
logs will go, or other necessary config items.  It also doesn't handle
generating the config file for a server intended to be run by the root
user on a standard port.</p>

<h3>If You Want More ...</h3>

<p>These recipes were adapted from Chapter 11, "Recipes," of <i>Embedding
Perl in HTML With Mason</i>.  And, of course, the book contains a lot
more than just recipes.  If you're interested in learning more about
Mason, the book is a great place to start.</p>

<p>Also, don't forget to check out the Mason HQ site at
<a href="http://www.masonhq.com/">www.masonhq.com/</a>, which contains online documentation,
user-contributed code and docs, and links to the Mason users mailing
list, which is another great resource for developers using Mason.</p>


<hr size="1" noshade="noshade" />

<p>
O'Reilly &amp; Associates recently released (October 2002) <a href="http://www.oreilly.com/catalog/perlhtmlmason/">Embedding Perl in HTML with Mason</a>.
</p>

<ul>
<li><p>
<a href="http://www.oreilly.com/catalog/perlhtmlmason/chapter/index.html">Sample Chapter 5, Advanced Features</a>, is available 
free online. 
</p></li>

<li><p>
You can also look at the <a href="">Table of Contents</a>, the 
<a href="">Index</a>, and the <a href="">Full Description</a> of 
the book.
</p></li>

<li><p>
For more information, or to order the book, 
<a href="">click here</a>.</p></li>  
</ul>









        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1416" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/12/p6pdigest/20021208.html" rel="bookmark">This week on Perl 6 (12/02-08, 2002)</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2002-12-08T00:00:00-08:00">December  8, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->


<p>Another Monday evening. Another summary to write.</p>
<p>Starting, as is becoming tediously predictable, with perl6-internals.</p>


<h4><a name="another_jit_discussion">Another JIT Discussion</a></h4>
<p>Toward the end of the previous week, Leopold T&ouml;tsch posted
something about the latest round of changes to the JIT core. Daniel
Grunblatt was concerned that the current JIT wasn't doing the correct
thing when it came to hardware register allocation and wanted to remove a
some conditional logic. Leo didn't agree at first, but became
convinced and Daniel's requested change was applied.</p>
<p><a href="http://groups.google.com/groups?threadm=200212011301.08982.daniel%40grunblatt.com.ar">http://groups.google.com/groups</a></p>


<h4><a name="fun_with_imcc">Fun With IMCC</a></h4>
<p>Many things happened with IMCC this week:</p>
<ul>
<li>
David Robins posted a list of minor niggles (For instance, it turns
out you can't <code>ret</code> early from a <code>.sub</code>) and suggested some
remedies. Leo T&ouml;tsch mentioned that the IMCC Cabal (which
would consist of Melvin Smith, Sean O'Rourke, Angel Faus and Leo if
there were a Cabal. But, as everyone knows, There Is No Cabal) has
been discussing several of these issues.
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0212021417160.14941-100000%40davidrobins.net">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=3DEC68A8.6070900%40toetsch.at">http://groups.google.com/groups</a></p></li>


<li>
Art Haas had problems building IMCC, apparently bison didn't like the
<em>imcc.y</em> file. Leo tracked down the problem (when asked a second time; I think he might be slipping) and checked in a working fix.</li>


<li>
Leo T&ouml;tsch made a pile of changes to IMCC to eliminate clashes
between Parrot's PASM language and IMCC's PIR syntax, which had made
it hard to mix the two. Full details of the changes are in his post.
<p>Gopal V wondered whether there was any way of feeding code to IMCC beyond
simply writing to a file and running IMCC. He'd had to make a bunch of
changes to the IMCC files that he used, and wondered whether there was a
better way. Actually, he didn't so much wonder as propose the
aforementioned better way, lifting ideas from DotGNU's <em>treecc</em>. He
and Leo discussed things, worked out an interface and Gopal went off
to implement something. (Yay Gopal!)</p>
<p><a href="http://groups.google.com/groups?threadm=3DECC08A.8090208%40toetsch.at">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20021204004556.A3407%40md3.vsnl.net.in">http://groups.google.com/groups</a></p></li>


<li>
Steve Fink posted a patch implementing a first cut at namespace
support in IMCC. He wasn't at all sure that what he'd implemented was
the right thing, but it supplied what he needed for the time being (if
that makes sense) in the regex engine. Leo reckoned that it looked
OK, and promised to apply it if nobody hollered. He also pointed out
some problems with the current regex implementation to do with
re-entrancy and memory leakage. It turns out that Steve was working on
<em>languages/regex</em> rather than the <code>rx_*</code> ops, which are the ones
that have the problems.
<p><a href="http://groups.google.com/groups?threadm=rt-18856-43866.10.1988319398784%40bugs6.perl.org">http://groups.google.com/groups</a></p></li>

<li>
Gregor N. Purdy had some problems with IMCC's syntax, a fragment of
code that he thought should work fell over in a heap.  Both Mr. Nobody
and Leo pointed out that IMCC expects subroutines, and you should wrap
your code in a <code>.sub</code>/<code>.end</code> pair.
<p>Once Gregor had that straight, he posted a Jako program and the IMCC
code he thought the Jako compiler should generate from it and asked
for any feedback before he went to change the compiler. Leo
T&ouml;tsch provided some (I assume) useful feedback.</p>
<p>A little later Gregor posted again, and he was still having problems with
IMCC not quite behaving as he wanted for the Jako compiler. He and Leo
thrashed it out over a few messages and, to cut a long story short,
IMCC looks like it won't be changing. I'm not sure whether Gregor is
happy about this ... .</p>
<p><a href="http://groups.google.com/groups?threadm=OF62DC53C8.485EA6B9-ON85256C85.00523820-85256C85.0052B894%40kennedytech.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=OFEBCC7A80.077BD3AB-ON85256C85.0058AE9F-85256C85.0059727D%40kennedytech.com">http://groups.google.com/groups</a></p>
</li>

<li>
Mr. Nobody posted a patch to get IMCC to compile under
Windows. Apparently, the <code>OUT</code> label clashes with something in the
Windows header files. The patch was applied.
</li>

<li>
Gregor N. Purdy got a little confused by how IMCC generates PASM code,
and posted some sample code, interspersed with questions, which Leo
answered. It's worth looking at this; it shows off the kind of
optimization that IMCC gets up to.
<p><a href="http://groups.google.com/groups?threadm=OF48E63324.EF9A6AE6-ON85256C87.00541440-85256C87.005616B1%40kennedytech.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=3DF0CFF8.7010009%40toetsch.at">http://groups.google.com/groups</a></p></li>

</ul>


<h4><a name="pmcs_are_the_thing">PMCs Are the Thing</a></h4>
<p>Dan announced that he's finally stopped waffling and frozen the PMC
structures `modulo the odd twiddling to it.' He's added a <em>pmc.ops</em>
file, and has started adding in ops to manipulate PMC internals. Leo
asked for some clarifications, got some, and then wondered what the
final 'Parrot Object' would look like.</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f07ba12bc13c829%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>


<h4><a name="logical_not_issue"><code>logical_not</code> Issue</a></h4>
<p>David Robins is having fun with <code>logical_not</code> and Ruby. The issue is
that <em>all</em> integers in Ruby are true, whether or not they are zero
but that with some of the assumptions in other PMCs. Robin offered 3
suggestions for how to fix it. Dan noted that it's an issue for Perl 6,
too, since the truth or otherwise of a value can be modified by a
property of that value, coming up with a fix is on his to-do
list. David wondered whether this had been discussed before and offered
another possible way forward. Dan half liked the idea but noted that
the approach didn't work for <code>and</code>, <code>or</code> and <code>xor</code>, at least where
Perl is concerned.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0212031513290.16321-100000%40davidrobins.net">http://groups.google.com/groups</a></p>


<h4><a name="the_language_that_dare_not_speak_its_name.">The Language That Dare Not Speak Its Name</a></h4>
<p>After a fortnight, during which nobody made any comment on Leon
Brocard's patch adding a <em>brainfuck</em> subdirectory to the <em>languages</em>
directory, Nicholas Clark committed it in CVS.</p>
<p>At which point, Andy Dougherty spoke up to say he wasn't happy about
it, saying that he didn't wish to be associated with needlessly crude
and offensive language. After some further debate, the subdirectory was
renamed to <em>bf</em> in such a way that, if you ask CVS it will tell you
that the <em>brainfuck</em> subdirectory does not exist now and never has
existed. Which seems strangely appropriate somehow. Fnord.</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f05ba13e8521fa2%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=a05200f05ba13e8521fa2%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>


<h4><a name="parrot_organization">Parrot Organization</a></h4>
<p>Michael Collins asked about the structure of the Parrot development
organization, and Dan provided some answers. My favorite Q&amp;A:</p>
<p>Q. Is there any formal structure to this organization.</p>
<p>A. I [Dan] delude myself into thinking I'm more or less in charge ... .</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f0dba12da9ef0f1%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=a05200f0dba12da9ef0f1%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>


<h4><a name="just_when_you_thought_it_was_safe">Just When You Thought It Was Safe ... </a></h4>
<p>to start using long file names with impunity, Mr. Nobody pointed out
that a bunch of the files in the Parrot repository didn't play well
with the MS-DOS 'filesystem's 8.3 naming rules. &quot;So what?&quot; asked Aldo
Calpini. Mr. Nobody asked if DOS was an intended compilation
target. Answer: &quot;No&quot;. The consensus appears to be &quot;Ha! We laugh at
your crappy filename restrictions and will not be jumping through any
hoops to deal with a faintly silly hypothetical target.&quot; Or maybe
that's just my opinion dressed up as consensus. Ah well, if I'm wrong, then
I'm sure someone will tell me.</p>
<p><a href="http://groups.google.com/groups?threadm=20021204145835.68294.qmail%40web20801.mail.yahoo.com">http://groups.google.com/groups</a></p>
















<h3><a name="meanwhile,_over_in_perl6language">Meanwhile, Over in perl6-language</a></h3>
<p>The perl6-documentation team have been discussing String literals and
their discussion spilled over into perl6-language as there are
several things about them that are undefined and needed discussing by
the language crowd. It's all to do with how octal numbers and octal
string escapes are specified. Essentially, people don't like the
current Perl5/C style <code>0101</code> (octal number) and <code>\101</code> (octal string
escape), so James supplied a list of the other possibilities. (The
current Numeric literals doc say that <code>0c101</code> designates an octal
numeric literal, but then the consistent extension to string literals
(<code>\c101</code> clashes with the current method of specifying a
control-char). After some debate, Larry pulled one of
his gloriously clear posts out of the bag, sketching the issues and
coming up with a straightforward and obvious (but only with hindsight)
way forward. It's good to be reminded why we trust Larry. Anyway, it
turns out that an octal number will be specified using <code>0o101</code> and an
octal character escape will probably be one of <code>\0o[101]</code> or
<code>\c[0o101]</code> (I like the second better...)</p>
<p><a href="http://groups.google.com/groups?threadm=3DED40AF.8010909%40mastros.biz">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20021204202101.GA7347%40wall.org">http://groups.google.com/groups</a></p>


<h4><a name="thinking_about_\c[...]">Thinking about <code>\c[...]</code></a></h4>
<p>Once Larry had pulled <code>\c[0o101]</code> out of the bag, it fell to David
Whipp to wonder what you could get up to with it. For instance, could
you do: <code>print &quot;\c[71, 101, 108, 108, 111]&quot;</code> and have that print
&quot;Hello&quot;? Damian pointed out that Larry had already discussed some of
this in Apocalypse 5, but that the separator character would probably
be the semicolon. Then Nicholas Clark got evil, and wondered about
<code>&quot;\c[$(call_a_func())]&quot;</code>, but Damian seemed to think that wouldn't be
such a good idea.</p>
<p><a href="http://groups.google.com/groups?threadm=F0DF160193C9D511B7110050DA8B7C24572B69%40msexchange.intranet.fast-chip.com">http://groups.google.com/groups</a></p>


<h4><a name="purge:_opposite_of_grep">Purge: Opposite of Grep</a></h4>
<p>Miko O'Sullivan suggested a <code>purge</code> command that would be to <code>grep</code>
as <code>unless</code> is to <code>if</code>. Nobody seemed to like the name that much,
though most seemed to think the idea was sound. Michael Lazzaro
suggested <code>divvy</code> could be used to break a list into multiple
lists (he initially proposed just breaking the list into two lists,
but others extended the idea to more). Damian didn't like the name,
and initially proposed <code>classify</code>, which would return a list of array
references. Discussion continued for a while until Ralph Mellor
suggested <code>part</code> as the name for this putative function, which Damian
leapt on with a glad cry.</p>
<p>This went on for a while, with extra features being proposed and other
explorations of the possibilities including some rather nifty proposed
shorthand/DWIMmery.</p>
<p>Meanwhile, Ken Fox wondered why we couldn't just implement
classify/part/divvy as a normal sub and why everything had to
be built into the first version of Perl 6. So Damian implemented it,
but commented that &quot;then the thousands of people who are apparently
clamoring for this functionality and who would have no hope of
getting the above correct, would have to pull in some module every
time they wanted to partition an array.&quot; Ken was impressed, and asked
for some commentary on how it all worked, which Damian provided. BTW,
this code is <em>really</em> worth looking at for an example of the kind of
power that Perl 6 will provide.</p>
<p>David Wheeler wasn't over keen on calling the function 'part' because
part has so many different possible interpretations. It turns out that
that's why Damian likes the name so much.</p>
<p><a href="http://groups.google.com/groups?threadm=Pine.NEB.4.44.0212042056050.16496-100000%40canolog.ninthwonder.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=3DF01FA4.3090109%40conway.org">http://groups.google.com/groups</a> -- <code>classify</code></p>
<p><a href="http://groups.google.com/groups?threadm=3DF26E5F.1030304%40vulpes.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=3DF29228.9070605%40conway.org">http://groups.google.com/groups</a> -- Damian implements <code>part</code></p>
<p><a href="http://groups.google.com/groups?threadm=3DF294F8.6070606%40conway.org">http://groups.google.com/groups</a> -- Damian implements <code>part</code> with sane
formatting</p>
<p><a href="http://groups.google.com/groups?threadm=3DF3D3B0.4090306%40conway.org">http://groups.google.com/groups</a> -- Damian explains it all</p>


<h4><a name="in_defence_of_zeroindexed_arrays">In Defense of Zero-Indexed Arrays</a></h4>
<p>Michael G. Schwern asked people to `explain how having indexes in Perl
6 start at zero will benefit most users. Do not invoke
legacy.' Answers ranged from the silly to the sincere. The best
answer was &quot;Because I [Larry] like it&quot; which, I think, trumps
everyone.</p>
<p><a href="http://groups.google.com/groups?threadm=20021205104539.GT11947%40blackrider.schwern.org">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20021207015933.GA25887%40wall.org">http://groups.google.com/groups</a></p>


<h4><a name="stringification_of_references">Stringification of References</a></h4>
<p>Joseph F. Ryan kicked off a discussion of the stringification of
objects and references and offered his suggestions. Joseph leans
toward having the default stringifications of objects and references
provide information useful to the programmer. I agree with him (so, if
you spot any bias in the upcoming summary that'd be because I'm
biased). Michael Lazzaro explicitly brought up the distinction between
&quot;stringification for output&quot; and &quot;stringification for debugging&quot;, and
came down in favor of stringification for output (heck, he even
wanted references to be invisible to stringification). Piers Cawley
told him he was wrong and appealed to the authority of Kent Beck
(a Smalltalk and Java programmer, possibly not the <em>best</em> authority
to choose). Michael then proposed a scheme involving subclasses of
String, to provide cues for different stringifications, which John
Siracusa thought was going rather a long way too far, coming down in
favour of the &quot;stringify for debugging&quot; position. I'm not sure
anything has actually been <em>decided</em> yet though. Tune in next week.</p>
<p><a href="http://groups.google.com/groups?threadm=3DEFE311.2020004%40osu.edu">http://groups.google.com/groups</a></p>


<h4><a name="outline_of_class_definitions_in_perl_6">Outline of Class Definitions in Perl 6</a></h4>
<p>Simon Cozens asked for a translation of some Perl 5 style OO code into
Perl 6, and Luke Palmer had a go at the task, then Larry came through
with something a little more definitive (but not <em>actually</em>
definitive just yet, I get the feeling that a few things are still in
flux ... .)</p>
<p><a href="http://groups.google.com/groups?threadm=87fztbi4ek.fsf%40simoncozens-2.dsl.easynet.co.uk">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20021206191520.GC23288%40wall.org">http://groups.google.com/groups</a></p>


<h4><a name="perl_6_and_set_theory">Perl 6 and Set Theory</a></h4>
<p>Luke Palmer posted a fascinating document presenting a &quot;new way of
thinking about some constructs.&quot; and proposed some changes to help
with consistency. The document covered junctions and classes,
recasting them as representations of finite and infinite sets. Only
Damian responded with a few corrections and clarifications noting
that one of Luke's proposed changes was rather fundamental, and that
he wasn't sure he wanted to make that change without some deep
reflection (from someone) on how that would affect the junction types
that Luke hadn't considered. Discussion continues.</p>
<p><a href="http://groups.google.com/groups?threadm=20021206210300.DE96032A%40babylonia.flatirons.org">http://groups.google.com/groups</a></p>




<h3><a name="in_brief">In Brief</a></h3>
<p>Steve Fink is toying with adding OpenGL ops to Parrot.</p>
<p>Leon Brocard has used the native call interface features to add curses
support to Parrot and offered a version of <em>life.pasm</em> that makes use
of it.</p>
<p>The perl6-language crowd are currently working on string literals and
stringification.</p>




<h3><a name="who's_who_in_perl_6">Who's Who in Perl 6?</a></h3>
<p>I'm bumping this one up the questionnaire queue slightly. I felt the
need for some controversy.</p>
<dl>
<dt><strong><a name="item_who_are_you%3f">Who are you?</a></strong>

</dt>
<dd>
Abigail
</dd>


<dt><strong><a name="item_what_do_you_do_for%2fwith_perl_6%3f">What do you do for/with Perl 6?</a></strong>

</dt>
<dd>
Nothing, except for disliking languages that are white space
sensitive.
</dd>


<dt><strong><a name="item_where_are_you_coming_from%3f">Where are you coming from?</a></strong>

</dt>
<dd>
I've been coding Perl since 1995. Joined p5p in 1996 or so.
</dd>


<dt><strong><a name="item_when_do_you_think_perl_6_will_be_released%3f">When do you think Perl 6 will be released?</a></strong>

</dt>
<dd>
A usable release? Given the current rate in which apocalypses are
produced, I'd say 2008. Give or take a few years.
</dd>


<dt><strong><a name="item_why_are_you_doing_this%3f">Why are you doing this?</a></strong>

</dt>
<dd>
I adore Perl. Perl5 that is. Programming in Perl5 is like exploring a
large medieval castle, surrounded by a dark, mysterious forest, with
something new and unexpected around each corner. There are dragons to
be conquered, maidens to be rescued, and holy grails to be quested
for. Lots of fun. Perl6 looks like a Louis-XVI castle and garden to
me. Straight, symmetric, and bright. There are wigs to be powdered,
minuets to be danced, all quite boring. I haven't been impressed by
new features yet, but I'm disappointed by what will be lost.
</dd>


<dt><strong><a name="item_you_have_5_words%2e_describe_yourself%2e">You have 5 words. Describe yourself.</a></strong>

</dt>
<dd>
My mind is twisted. Backwards.
</dd>


<dt><strong><a name="item_do_you_have_anything_to_declare%3f">Do you have anything to declare?</a></strong>

</dt>
<dd>
One of the great things about Perl5 is that I don't have to declare
anything I don't want to.
</dd>

</dl>




<h3><a name="acknowledgements">Acknowledgements</a></h3>
<p>Another week of writing on the train and, for a change of scenery, at
my parents' house, fuelled, as usual by large amounts of tea.</p>
<p>Proofreading was once again down to Aspell and me. Any errors this
week are probably my fault, it's about time I started accepting my
responsibilities.</p>
<p>Thanks to everyone who has sent me questionnaire answers, I've got a
queue of about four left so, if you work with Perl 6 (or, like Abigail,
hate it) please answer the same set of questions Abigail just answered
and send them to me at <em><a href="mailto:mailto:5Ws@bofh.org.uk">mailto:5Ws@bofh.org.uk</a></em>. Thanks.</p>
<p>I got some mail last week from someone praising me for the summaries
(thanks), but wanting to know how he could contribute his time and
energy, so this week the chorus has a few extra lines in it:</p>
<p>If you didn't like the summary, what are you doing still reading it?
If you did like it, please consider one or more of the following
options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate/perl-foundation.org/">http://donate/perl-foundation.org/</a> and help support the ongoing
development of Perl 6.</li>


<li>
Get involved with the Perl 6 process. The mailing lists are open to
everyone, <a href="http://dev.perl.org/perl6">http://dev.perl.org/perl6</a> and
<a href="http://dev.perl.org/parrot">http://dev.perl.org/parrot</a> are good starting points with links to
the appropriate mailing lists.</li>

<li>Send feedback, flames, money and or lucrative employment in the
Doncaster area to <em><a href="mailto:mailto:p6summarizer@bofh.org.uk">mailto:p6summarizer@bofh.org.uk</a></em> (No, I'm not
unemployed at the moment, I just want to work nearer to home...)</li>

</ul>
<p>The fee paid for publication of these summaries on perl.com is paid
directly to the Perl Foundation.</p>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1408" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/12/04/mod_perl.html" rel="bookmark">Improving mod_perl Sites' Performance: Part 5</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Stas Bekman</span> on <abbr class="published" title="2002-12-04T00:00:00-08:00">December  4, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <h3><a name="sharing_memory">Sharing Memory</a></h3>
<p>As we have learned in the previous article, sharing memory helps us save memory with mod_perl, giving us a huge speed increase; but we pay
the price with a big memory footprint. I presented a few techniques to
save memory by trying to share more of it. In this article, we will see
other techniques allowing you to save even more memory.</p>


<h3><a name="preloading_registry_scripts_at_server_startup">Preloading Registry Scripts at Server Startup</a></h3>
<p>What happens if you find yourself stuck with Perl CGI scripts and you
cannot or don't want to move most of the stuff into modules to benefit
from modules preloading, so the code will be shared by the children?
Luckily, you can preload scripts as well.  This time the
<code>Apache::RegistryLoader</code> module comes to your aid.
<code>Apache::RegistryLoader</code> compiles <code>Apache::Registry</code> scripts at
server startup.</p>

<p>For example, to preload the script <em>/perl/test.pl</em>, which is in fact
the file <em>/home/httpd/perl/test.pl</em>, you would do the following:</p>
<pre><code>
  use Apache::RegistryLoader ();
  Apache::RegistryLoader-&gt;new-&gt;handler(&quot;/perl/test.pl&quot;,
                            &quot;/home/httpd/perl/test.pl&quot;);</code></pre>
<p>You should put this code either into a <code>&lt;Perl&gt;</code> section or
into a startup script.</p>

<csperl file="grab" domain="on" record="b/832" template="article_sidebar2.view">

<p>But what if you have a bunch of scripts located under the same
directory and you don't want to list them one by one?  Take the
benefit of Perl modules and put them to good use - the <code>File::Find</code>
module will do most of the work for you.</p>
<p>The following code walks the directory tree under which all
<code>Apache::Registry</code> scripts are located.  For each file it encounters
with the extension <em>.pl</em>, it calls the
<code>Apache::RegistryLoader::handler()</code> method to preload the script in
the parent server, before pre-forking the child processes:</p>
<pre><code>
  use File::Find qw(finddepth);
  use Apache::RegistryLoader ();
  {
    my $scripts_root_dir = &quot;/home/httpd/perl/&quot;;
    my $rl = Apache::RegistryLoader-&gt;new;
    finddepth
      (
       sub {
         return unless /\.pl$/;
         my $url = &quot;$File::Find::dir/$_&quot;;
         $url =~ s|$scripts_root_dir/?|/|;
         warn &quot;pre-loading $url\n&quot;;
           # preload $url
         my $status = $rl-&gt;handler($url);
         unless($status == 200) {
           warn &quot;pre-load of `$url' failed, status=$status\n&quot;;
         }
       },
       $scripts_root_dir);
  }</code></pre>
<p>Note that I didn't use the second argument to <code>handler()</code> here, as
in the first example. To make the loader smarter about the URI to
filename translation, you might need to provide a <code>trans()</code> function
to translate the URI to a filename.  URI to filename translation
normally doesn't happen until HTTP request time, so the module is
forced to roll its own translation.  If the filename is omitted and a
<code>trans()</code> function was not defined, then the loader will try using the URI
relative to <strong>ServerRoot</strong>.</p>
<p>A simple <code>trans()</code> function can be like this:</p>
<pre><code>
  sub mytrans {
    my $uri = shift;
    $uri =~ s|^/perl/|/home/httpd/perl/|;
    return $uri;
  }</code></pre>
<p>You can easily derive the right translation by looking at the <code>Alias</code>
directive. The above <code>mytrans()</code> function is matching our <code>Alias</code>:</p>
<pre><code>
  Alias /perl/ /home/httpd/perl/</code></pre>
<p>After defining the URI to filename translation function, you should
pass it during the creation of the <code>Apache::RegistryLoader</code> object:</p>
<pre><code>
  my $rl = Apache::RegistryLoader-&gt;new(trans =&gt; \&amp;mytrans);</code></pre>
<p>I won't show any benchmarks here, since the effect is absolutely the
same as with preloading modules.</p>


<h3><a name="modules_initializing_at_server_startup">Modules Initializing at Server Startup</a></h3>
<p>We have just learned that it's important to preload the modules and
scripts at the server startup.  It turns out that it's not enough for
some modules and you have to prerun their initialization code to get
more memory pages shared. Basically you will find an information about
specific modules in their respective manpages. I will present a few
examples of widely used modules where the code can be initialized.</p>

<h4><a name="initializing_dbi.pm">Initializing DBI.pm</a></h4>
<p>The first example is the <code>DBI</code> module. As you know, <code>DBI</code> works with
many database drivers in the <code>DBD::</code> namespace, such as
<code>DBD::mysql</code>. It's not enough to preload <code>DBI</code>; you should
initialize <code>DBI</code> with the <code>driver(s)</code> that you are going to use (usually a
single driver is used) if you want to minimize memory use after
forking the child processes. Note that you want to do this under
mod_perl and other environments where shared memory is 
important. In other circumstances, you shouldn't initialize drivers.</p>
<p>You probably know already that under mod_perl you should use the
<code>Apache::DBI</code> module to make the connection persistent, unless you want
to open a separate connection for each user -- in which case, you should
not use this module. <code>Apache::DBI</code> automatically loads <code>DBI</code> and
overrides some of its methods, so you should continue coding just
as though you were simply using the <code>DBI</code> module.</p>
<p>Just as with modules preloading, our goal is to find the startup
environment that will lead to the smallest ``difference'' between the
shared and normal memory reported, which would mean a smaller total memory
usage.</p>
<p>And again, in order to make it easy to measure, I will use only one
child process. To do this, I will use these settings in <em>httpd.conf</em>:</p>
<pre><code>
  MinSpareServers 1
  MaxSpareServers 1
  StartServers 1
  MaxClients 1
  MaxRequestsPerChild 100</code></pre>
<p>I'm going to run memory benchmarks on five different versions of the
<em>startup.pl</em> file.  I always preload these modules:</p>
<pre><code>
  use Gtop();
  use Apache::DBI(); # preloads DBI as well</code></pre>
<dl>
<dt><strong><a name="item_option">option 1</a></strong>
</dt>
<dd>
Leave the file unmodified.
</dd>

<dt><strong>option 2</strong>
</dt>
<dd>
Install MySQL driver (I will use MySQL RDBMS for our test):
</dd>
<dd>
<pre><code>
  DBI-&gt;install_driver(&quot;mysql&quot;);</code></pre>
</dd>
<dd>
<p>It's safe to use this method, since just like with <code>use()</code>, if it
can't be installed it'll <code>die()</code>.</p>
</dd>

<dt><strong>option 3</strong>
</dt>
<dd>
Preload MySQL driver module:
</dd>
<dd>
<pre><code>
  use DBD::mysql;</code></pre>
</dd>

<dt><strong>option 4</strong>
</dt>
<dd>
Tell <code>Apache::DBI</code> to connect to the database when the child process
starts (<code>ChildInitHandler</code>) - no driver is preloaded before the child
gets spawned!
</dd>
<dd>
<pre><code>
  Apache::DBI-&gt;connect_on_init('DBI:mysql:test::localhost',
                             &quot;&quot;,
                             &quot;&quot;,
                             {
                              PrintError =&gt; 1, # warn() on errors
                              RaiseError =&gt; 0, # don't die on error
                              AutoCommit =&gt; 1, # commit executes
                              # immediately
                             }
                            )
  or die &quot;Cannot connect to database: $DBI::errstr&quot;;</code></pre>
</dd>
</dl>
<p>Here is the <code>Apache::Registry</code> test script that I have used:</p>
<pre><code>
  preload_dbi.pl
  --------------
  use strict;
  use GTop ();
  use DBI ();
    
  my $dbh = DBI-&gt;connect(&quot;DBI:mysql:test::localhost&quot;,
                         &quot;&quot;,
                         &quot;&quot;,
                         {
                          PrintError =&gt; 1, # warn() on errors
                          RaiseError =&gt; 0, # don't die on error
                          AutoCommit =&gt; 1, # commit executes
                                           # immediately
                         }
                        )
    or die &quot;Cannot connect to database: $DBI::errstr&quot;;
  
  my $r = shift;
  $r-&gt;send_http_header('text/plain');
  
  my $do_sql = &quot;show tables&quot;;
  my $sth = $dbh-&gt;prepare($do_sql);
  $sth-&gt;execute();
  my @data = ();
  while (my @row = $sth-&gt;fetchrow_array){
    push @data, @row;
  }
  print &quot;Data: @data\n&quot;;
  $dbh-&gt;disconnect(); # NOP under Apache::DBI
  
  my $proc_mem = GTop-&gt;new-&gt;proc_mem($$);
  my $size  = $proc_mem-&gt;size;
  my $share = $proc_mem-&gt;share;
  my $diff  = $size - $share;
  printf &quot;%8s %8s %8s\n&quot;, qw(Size Shared Diff);
  printf &quot;%8d %8d %8d (bytes)\n&quot;,$size,$share,$diff;</code></pre>
<p>The script opens a connection to the database <em>'test'</em> and issues a
query to learn what tables the databases has.  When the data is
collected and printed the connection would be closed in the regular
case, but <code>Apache::DBI</code> overrides it with empty method.  When the
data is processed, some code to print the memory usage follows -- this
should already be familiar to you.</p>
<p>The server was restarted before each new test.</p>
<p>So here are the results of the five tests that were conducted, sorted
by the <em>Diff</em> column:</p>
<ol>
<li>
After the first request:
<pre><code>
  Version     Size   Shared     Diff        Test type
  --------------------------------------------------------------------
        1  3465216  2621440   843776  install_driver
        2  3461120  2609152   851968  install_driver &amp; connect_on_init
        3  3465216  2605056   860160  preload driver
        4  3461120  2494464   966656  nothing added
        5  3461120  2482176   978944  connect_on_init</code></pre></li>

<li>
After the second request (all the subsequent request showed the same
results):
<pre><code>
  Version     Size   Shared    Diff         Test type
  --------------------------------------------------------------------
        1  3469312  2609152   860160  install_driver
        2  3481600  2605056   876544  install_driver &amp; connect_on_init
        3  3469312  2588672   880640  preload driver
        4  3477504  2482176   995328  nothing added
        5  3481600  2469888  1011712  connect_on_init</code></pre></li>
</ol>

<p>Now what do we conclude from looking at these numbers. First, we see
that only after a second reload do we get the final memory footprint for
a specific request in question (if you pass different arguments the
memory usage might and will be different).</p>
<p>But both tables show the same pattern of memory usage.  We can clearly
see that the real winner is the <em>startup.pl</em> file's version where the
MySQL driver was installed (1).  Since we want to have a connection
ready for the first request made to the freshly spawned child process,
we generally use the second version (2), which uses somewhat more
memory, but has almost the same number of shared memory pages.  The
third version only preloads the driver, resulting in smaller shared
memory.  The last two versions having nothing initialized (4) and
having only the <code>connect_on_init()</code> method used (5).  The former is a
little bit better than the latter, but both significantly worse than
the first two versions.</p>
<p>To remind you why do we look for the smallest value in the column
<em>diff</em>, recall the real memory usage formula:</p>
<pre><code>
  RAM_dedicated_to_mod_perl = diff * number_of_processes
                            + the_processes_with_largest_shared_memory</code></pre>
<p>Notice that the smaller the diff is, the bigger the number of
processes you can have using the same amount of RAM.  Therefore, every
100K difference counts, when you multiply it by the number of
processes. If we take the number from the version (1) vs. (4)
and assume that we have 256M of memory dedicated to mod_perl processes,
we will get the following numbers using the formula derived from the
above formula:</p>
<pre><code>
               RAM - largest_shared_size
  N_of Procs = -------------------------
                        Diff</code></pre>
<pre><code>
                268435456 - 2609152
  (ver 1)  N =  ------------------- = 309
                      860160</code></pre>
<pre><code>
                268435456 - 2469888
  (ver 5)  N =  ------------------- = 262
                     1011712</code></pre>
<p>So you can see the difference - 17 percent more child processes in the first
version.</p>

<h4><a name="initializing_cgi.pm">Initializing CGI.pm</a></h4>
<p><code>CGI.pm</code> is a big module that by default postpones the compilation of
its methods until they are actually needed, thus making it possible to
use it under a slow mod_cgi handler without adding a big
overhead. That's not what we want under mod_perl, and if you use
<code>CGI.pm</code> you should precompile the methods that you are going to use
at the server startup in addition to preloading the module.  Use the
compile method for that:</p>
<pre><code>
  use CGI;
  CGI-&gt;compile(':all');</code></pre>
<p>where you should replace the tag group <code>:all</code> with the real tags and
group tags that you are going to use if you want to optimize the
memory usage.</p>
<p>I'm going to compare the shared memory footprint by using a script that
is backward compatible with mod_cgi. You will see that you can improve
the performance of these kind of scripts as well, but if you really want
a fast code think about porting it to use <code>Apache::Request</code> for the CGI
interface, and some other module for HTML generation.</p>
<p>So here is the <code>Apache::Registry</code> script that I'm going to use to
make the comparison:</p>
<pre><code>
  preload_cgi_pm.pl
  -----------------
  use strict;
  use CGI ();
  use GTop ();</code></pre>
<pre><code>
  my $q = new CGI;
  print $q-&gt;header('text/plain');
  print join &quot;\n&quot;, map {&quot;$_ =&gt; &quot;.$q-&gt;param($_) } $q-&gt;param;
  print &quot;\n&quot;;
  
  my $proc_mem = GTop-&gt;new-&gt;proc_mem($$);
  my $size  = $proc_mem-&gt;size;
  my $share = $proc_mem-&gt;share;
  my $diff  = $size - $share;
  printf &quot;%8s %8s %8s\n&quot;, qw(Size Shared Diff);
  printf &quot;%8d %8d %8d (bytes)\n&quot;,$size,$share,$diff;</code></pre>
<p>The script initializes the <code>CGI</code> object, sends a HTTP header and then
prints all the arguments and values that were passed to the script if
there were any. As usual, at the end, I print the memory usage.</p>
<p>As usual, I am going to use a single child process, using the usual
settings in <em>httpd.conf</em>:</p>
<pre><code>
  MinSpareServers 1
  MaxSpareServers 1
  StartServers 1
  MaxClients 1
  MaxRequestsPerChild 100</code></pre>
<p>I'm going to run memory benchmarks on three different versions of
the <em>startup.pl</em> file.  I always preload this module:</p>
<pre><code>
  use Gtop();</code></pre>
<dl>
<dt><strong>option 1</strong>
</dt>
<dd>
Leave the file unmodified.
</dd>

<dt><strong>option 2</strong>
</dt>
<dd>
Preload <code>CGI.pm</code>:
</dd>
<dd>
<pre><code>
  use CGI ();</code></pre>
</dd>

<dt><strong>option 3</strong>
</dt>
<dd>
Preload <code>CGI.pm</code> and pre-compile the methods that I'm going to use in
the script:
</dd>
<dd>
<pre><code>
  use CGI ();
  CGI-&gt;compile(qw(header param));</code></pre>
</dd>
</dl>
<p>The server was restarted before each new test.</p>
<p>So here are the results of the three tests that were conducted, sorted
by the <em>Diff</em> column:</p>
<ol>
<li>
After the first request:
<pre><code>
  Version     Size   Shared     Diff        Test type
  --------------------------------------------------------------------
        1  3321856  2146304  1175552  not preloaded
        2  3321856  2326528   995328  preloaded
        3  3244032  2465792   778240  preloaded &amp; methods+compiled</code></pre></li>

<li>
After the second request (all the subsequent request showed the same
results):
<pre><code>
  Version     Size   Shared    Diff         Test type
  --------------------------------------------------------------------
        1  3325952  2134016  1191936 not preloaded
        2  3325952  2314240  1011712 preloaded
        3  3248128  2445312   802816 preloaded &amp; methods+compiled</code></pre></li>
</ol>
<p>The first version shows the results of the script execution when
<code>CGI.pm</code> wasn't preloaded. The second version has the module preloaded.
The third is when it's both preloaded and the methods that are going to
be used are precompiled at the server startup.</p>
<p>By looking at version one of the second table, we can conclude
that preloading adds about 20K to the shared size. As I have mentioned at
the beginning of this section, that's how <code>CGI.pm</code> was implemented -- to
reduce the load overhead. This means that preloading CGI almost
hardly changes anything. But if we compare the second and the third
versions, then we will see a significant difference of 207K
(1011712-802816), and I have only used a few methods (the <em>header</em>
method loads a few more methods transparently for a user). Imagine how
much memory I'm going to save if I'm going to precompile all the
methods that I'm using in other scripts that use <code>CGI.pm</code> and do a
little bit more than the script that I have used in the test.</p>
<p>But even in our simple case using the same formula, what do we
see? (assuming that I have 256MB dedicated for mod_perl)</p>

<csquery path="q/21" where="cs_rid != {cs_rid}">


<pre><code>
               RAM - largest_shared_size
  N_of Procs = -------------------------
                        Diff
						
                268435456 - 2134016
  (ver 1)  N =  ------------------- = 223
                      1191936
					  
                268435456 - 2445312
  (ver 3)  N =  ------------------- = 331
                     802816</code></pre>
<p>If I preload <code>CGI.pm</code> and precompile a few methods that I use in
the test script, I can have 50 percent more child processes than when I
don't preload and precompile the methods that I am going to use.</p>
<p>I've heard that the 3.x generation of <code>CGI.pm</code> will be less bloated,
but it's in a beta state as of this writing.</p>


<h3><a name="increasing_shared_memory_with_mergemem">Increasing Shared Memory With mergemem</a></h3>
<p><code>mergemem</code> is an experimental utility for linux, which looks <em>very</em>
interesting for us mod_perl users:
<a href="http://www.complang.tuwien.ac.at/ulrich/mergemem/">http://www.complang.tuwien.ac.at/ulrich/mergemem/</a></p>
<p>It looks like it could be run periodically on your server to find and
merge duplicate pages. It won't halt your httpds during the merge,
this aspect has been taken into consideration already during the
design of mergemem: Merging is not performed with one big system call.
Instead most operation is in userspace, making a lot of small system
calls.</p>
<p>Therefore, blocking of the system should not happen.  And, if it really
should turn out to take too much time you can reduce the priority of
the process.</p>
<p>The worst case that can happen is this: <code>mergemem</code> merges two pages
and immediately afterward, they will be split.  The split costs about
the same as the time consumed by merging.</p>
<p>This software comes with a utility called <code>memcmp</code> to tell you how
much you might save.</p>


<h3><a name="references">References</a></h3>
<ul>
<li>
The mod_perl site's URL: <a href="http://perl.apache.org/">http://perl.apache.org/</a></li>

<li>
mergemem project
<a href="http://www.complang.tuwien.ac.at/ulrich/mergemem/">http://www.complang.tuwien.ac.at/ulrich/mergemem/</a></li>
</ul>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1414" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/12/p6pdigest/20021201.html" rel="bookmark">This week on Perl 6 (11/24-12/01, 2002)</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2002-12-01T00:00:00-08:00">December  1, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>Oh look, it's only Monday evening and Piers has started writing this
week's summary. What is the world coming to?</p>
<p>As usual, we start with the internals list.</p>

<h4><a name="c#/parrot_status">C#/Parrot Status</a></h4>
<p>During last week's discussion of C# and Parrot, Nicholas Clark
confessed that floating point fills him with fear. Rhys Weatherley
attempted to assure him by saying that C# doesn't require floating
point overflow detection. Dan pointed out that, regardless of C#'s
needs, we'd need overflow detection for our own purposes.</p>
<p>Gopal V posted a <em>dotgnu.ops</em> file, implementing the conversion ops
that the DotGNU project needs. Leopold T&ouml;tsch dropped unsubtle
hints about the NEED FOR TESTS and did a certain amount of patch
polishing before applying it with added tests. Gopal commented that
Parrot people make it almost too easy. Several other patches to the
ops got added in order to take into account portability to such common
hardware as Crays, PPC and ARM.</p>
<p><a href="http://groups.google.com/groups?threadm=3DE1751F.37C5EDFF%40zip.com.au">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20021125180947.A7838%40md3.vsnl.net.in">http://groups.google.com/groups</a></p>

<h4><a name="nci_stuff_(mostly)_done">NCI stuff (mostly) done</a></h4>
<p>Dan offered a few progress reports on the state of the Native Call
Interface, which is nearing completion, and produced a document on how
to use it (essentially, you edit <em>call_types.txt</em>). James Mastros
suggested that a good deal of what was in the post should be included
as comments at the top of <em>call_types.txt</em> and that maybe
<em>call_types.txt.</em> should be renamed to something like
<em>nci_types.txt</em>.</p>
<p>Leon Brocard had a go at using this new functionality to call out to
libSDL but had some problems with it needing to have <code>libpthread</code>
loaded.</p>
<p><a href="http://groups.google.com/groups?threadm=a05200f02ba08753d75ab%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=a05200f03ba087c070d25%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=a05200f05ba088339bced%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>

<h4><a name="changes_to_parrot/docs/jit.pod">Changes to <em>parrot/docs/jit.pod</em></a></h4>
<p>Leo T&ouml;tsch committed a few changes to the JIT documentation,
which caused Nicholas Clark to wonder why some of the behaviour was as
described. And then my head started hurting. As far as your summarizer
is concerned, JIT is Really Cool Scary Magic that makes it go faster,
so I will continue with my shameless handwaving whenever this topic
comes up. I <em>think</em> this thread had something to do with making sure
that the mapping between parrot registers and hardware registers is
efficient.</p>
<p>
<a href="http://groups.google.com/groups?threadm=20021126101901.Y51965%40plum.flirble.org">http://groups.google.com/groups</a></p>


<h3><a name="befunge93_no!_befunge98!">Befunge-93? No! Befunge-98!</a></h3>
<p>Jerome Quelin wondered if the <em>$PARROT/languages/Befunge-93</em>
directory could be renamed into <em>$PARROT/languages/befunge</em> because,
as soon as Parrot supports objects he intends to implement the Befunge
98 specs, and a Befunge 98 interpreter can be used to interpret
Befunge 93 code. Jerome's wish was Robert Spier's Command, and the
directory has now been moved. Nicholas Clark muttered something about
subversion and VMS (where subversion is a CVS replacement which,
amongst other things, allows you to rename directories without causing
confusion.)</p>
<p><a href="http://groups.google.com/groups?threadm=200211281822.56745.jquelin%40mongueurs.net">http://groups.google.com/groups</a></p>

<h4><a name="this_week's_patches">This week's patches</a></h4>
<p>For the first time in quite a while this week, several people gave Leo
T&ouml;tsch a run for his money in `most patches to Parrot' stakes.</p>
<p>Patches to Parrot this week include:</p>
<ul>
<li>
More JIT changes: Register usage array, block allocation
<p>Leo has been doing more magic with the JIT system, but Daniel
Grunblatt raised a query about <code>ALLOCATE_REGISTER_ALWAYS</code>.</p></li>

<li>
Config test for i386 fcomip
<p>Leo added a test to see if the fcomip operation is available to the
JIT system.</p></li>

<li>
Use IMCC instead of assemble.pl
<p>J&uuml;rgen B&ouml;mmels has hacked IMCC to accept normal .pasm
files. This leads to dramatic (350%) speed increases in assembly, but
causes several of the tests to fail because IMCC has no macro
support. J&uuml;rgen intends to add macro support to IMCC if this
approach proves acceptable. Leo liked it a lot, suggesting that, until
IMCC gets native macros it should be possible to use assemble.pl's
preprocessor option to get macro free .pasm files. The patch was
applied.</p></li>

<li>
Introducing debug features in Befunge
<p>Jerome Quelin patched the Befunge interpreter to add the beginnings
of real debugger support. He threatens a `fully-functional debugger
within the Befunge interpreter with breakpoints, dumping the
playfield, status line and more'. Nicholas Clark was scared, but
applied the patch anyway.</p>
<p>Jerome later supplied a patch adding single stepping, playfield
dumping an a rudimentary UI. If Nicholas Clark was still scared he
didn't show it, and applied the patch.</p></li>

<li>
Replace 'perl' with 'parrot' in the PDDs
<p>Alin Iacob noticed that, in several places, the PDDs (Parrot Design
Documents) use 'Perl' where they should probably use 'Parrot', and
submitted a patch to fix things.</p></li>

<li>
Long double support in i386/Linux JIT
<p>Leo supplied a patch fixing the `long double issue' in the i386/Linux
JIT core.</p></li>
</ul>
<p>On rereading that list I see that Leo is still comfortably in the lead
as most prolific patcher. Somehow it didn't seem that way during the
week.</p>

<h4><a name="multiarray_usage">Multiarray usage</a></h4>
<p>Jerome Quelin wanted to use multiarrays but couldn't understand how
they work, so he asked the list. Leo T&ouml;tsch provided a pile of
answers and a short discussion ensued. I think Jerome chose to use a
PerlArray of PerlArrays in the end. Leo pointed out that multiarrays
come into their own for 'big packed arrays'.</p>
<p><a href="http://groups.google.com/groups?threadm=200211291622.59079.jquelin%40mongueurs.net">http://groups.google.com/groups</a></p>


<h3><a name="meanwhile,_in_perl6language">Meanwhile, in perl6-language</a></h3>
<p>By gum but you American chaps take Thanksgiving seriously don't you?
There was grand total of 32 messages in perl6-language this week. I
have the feeling I could just concatenate them and this section would
be no longer than the usual perl6-language summary. But that would be
the wrong kind of Lazy.</p>

<h4><a name="dynamic_scoping">Dynamic Scoping</a></h4>
<p>The discussion of Ralph Mellor's proposal about dynamic scoping and
implicit argument passing continued. In response to last week's
summary Ralph clarified that he suggested implicit argument passing as
a way of eliminating globals; the perceived thread safety thing was
beside the point.</p>
<p>Back in the thread (and in a post I discussed last week, my filtering
is obviously confused), Larry provided some clarifications and
suggested extensions to the currying mechanism which would address
some of Ralph's concerns. Ralph responded with a pile of posts and
suggested extending the currying idea still further.</p>
<p><a href="http://groups.google.com/groups?threadm=20021125181919.GA10720%40wall.org">http://groups.google.com/groups</a></p>

<h4><a name="status_summary;_next_steps">Status Summary; next steps</a></h4>
<p>Michael Lazzaro posted a summary of where the perl6-documentation
people had got to and a list of `next Big Deals'. Bryan C. Warnock
pointed out that almost all of the Big Deals should really be
discussed on perl6-language rather than perl6-documentation and
wondered again about the scope of perl6-documentation and how it
differs from perl6-language. Larry told us that ``p6d and p6l just have
different deliverables.  p6l is looking at the elephant from above,
while p6d is looking at the elephant from below.  But it's the same
elephant.  (Unless it's a camel.)''. Larry also addressed the Big
Deals.</p>
<p>Michael also posted his ideas about what the documentation list was
for and where was the appropriate place to discuss things. Bryan
worried that p6d was in danger of trying to go faster than the design
of the language and asked that the documentation list ``refrain from
rampant p6l-ish speculation.'' He went on to suggest that people be
kind to Piers, which was nice of him. In a later post, he offered
<em>his</em> vision of what the difference between the lists should
be. In another subthread, Garrett Goebel offered his vision too
(obviously a 'vision' week).</p>
<p><a href="http://groups.google.com/groups?threadm=A320A81C-00AB-11D7-9C01-00050245244A%40cognitivity.com">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20021126174742.GC18937%40wall.org">http://groups.google.com/groups</a> -- Larry's vision</p>
<p><a href="http://groups.google.com/groups?threadm=E8F31882-016D-11D7-ACF7-00050245244A%40cognitivity.com">http://groups.google.com/groups</a> -- Michael's vision</p>
<p><a href="http://groups.google.com/groups?threadm=1038529348.2257.170.camel%40wakko">http://groups.google.com/groups</a> -- Bryan's vision</p>
<p><a href="http://groups.google.com/groups?threadm=71BEC0D4E1DED3118F7A009027B12028010BE66A%40EXCH_MISSION">http://groups.google.com/groups</a> - Garrett's vision</p>

<h4><a name="just_wondering...">Just wondering...</a></h4>
<p>Piers Cawley pointed out that it's nearly 6 months since the last
Apocalypse, and wondered when we could expect the next one. Larry
reckons it'd be a lot faster if we'd stop asking interesting
questions. Apparently he was planning to have a draft out this week,
but made the mistake of buying the extended Fellowship of the Ring DVD
set, so that was him out of commission for a few days. Hopefully we'll
see something within the next week or so (before Christmas, please...)
but the timing is dependent on whether Gloria's family played games
Larry likes over Thanksgiving. (So far in the current week, Larry
hasn't said whether he played games or did design.) Jonathan Scott
Duff asked for the email addresses of Larry's in-laws so he could ask
them to play the appropriate games.</p>
<p>And this pr&eacute;cis is now almost longer than the original
thread...</p>


<h3><a name="in_brief">In Brief</a></h3>
<p>Bryan Hundven wondered about writing an entire Operating System on top
of Parrot. At least, I <em>think</em> that's what he wondered about.</p>
<p>Everybody ignored Leon's nabirfuck patch. (You know, I think I may be
misspelling the wrong bit of that...)</p>
<p>The Documentation group finished up their work on numeric literals and
started work on string literals.</p>


<h3><a name="who's_who_in_perl_6">Who's Who in Perl 6?</a></h3>
<dl>
<dt><strong><a name="item_who_are_you%3f">Who are you?</a></strong>
</dt>
<dd>
Zach Lipton, [zach at zachlipton dot com]
</dd>

<dt><strong><a name="item_what_do_you_do_for%2fwith_perl_6%3f">What do you do for/with Perl 6?</a></strong>
</dt>
<dd>
I'm the maintainer of tinderbox (<a href="http://tinderbox.perl.org">http://tinderbox.perl.org</a>) and
percy (the annoying little ircbot on #parrot who tells people when
tinderbox status changes. I also attempt to get bonsai to work on
perl.org to make the lives of many others much easier. Occasionally, I
tinker with configure and the testing suite, but rarely get anything
useful to happen.
</dd>

<dt><strong><a name="item_where_are_you_coming_from%3f">Where are you coming from?</a></strong>
</dt>
<dd>
I'm mostly coming from the Mozilla project where I do a wide amount of
various miscellaneous stuff including working on Bugzilla and
Technology Evangelism (no, not televangelism, you may continue your
religion). Oh yes, mustn't forget school, the, erm, uh, um, most
important place where I learn all sorts of interesting things.
</dd>

<dt><strong><a name="item_when_do_you_think_perl_6_will_be_released%3f">When do you think Perl 6 will be released?</a></strong>
</dt>
<dd>
What? You mean that there is more to Perl 6 than Parrot?
</dd>

<dt><strong><a name="item_why_are_you_doing_this%3f">Why are you doing this?</a></strong>
</dt>
<dd>
It's great to be able to help out with such a great project and give
back to the Perl community. Also, it's great experience and just plain
fun.
</dd>

<dt><strong><a name="item_you_have_5_words%2e_describe_yourself%2e">You have 5 words. Describe yourself.</a></strong>
</dt>
<dd>
Um, erm, hi, uh, yea!
</dd>

<dt><strong><a name="item_do_you_have_anything_to_declare%3f">Do you have anything to declare?</a></strong>
</dt>
<dd>
I promise that I will eventually have bonsai completely installed on
perl.org and working correctly!
</dd>
</dl>


<h3><a name="acknowledgements">Acknowledgements</a></h3>
<p>It's been a quiet week this week, presumably because of Thanksgiving,
and I'm writing this on Tuesday morning, still on the train, which has
been very unusual of late.</p>
<p>Proofreading services were once again provided by Aspell and me. Any
errors should be laid at the door of Kevin Atkinson, the author of
Aspell.</p>
<p>I've been seeing a little more mail about Perl 6 this week, including
a set of questionnaire answers from Abigail that I was tempted to push
up to the front of the queue this week, but which I think I'll save
for later. Speaking of the questionnaire, the answer queue currently
contains only three posts, so if you'd like to answer the questions
Zach just answered and send them to me at <em><a href="mailto:5Ws@bofh.org.uk">mailto:5Ws@bofh.org.uk</a></em>
I'd be grateful.</p>
<p>Several people have pointed out that my autogenerated URLs for
messages in perl6-documentation don't actually work. Apparently google
isn't yet picking that group up, so this week I don't provide any
links to messages in the documentation list. It's my understanding
that, as they produce final docs these will be available from some
fixed website, yet to be decided on. Once that's set up I'll start
linking to that.</p>
<p>Time for the chorus again:</p>
<p>If you didn't like this summary, what are you doing still reading it?
If you did like it, please consider one or both of the following
options:</p>
<ul>
<li>
Send money to the Perl Foundation at
<a href="http://donate.perl-foundation.org/">http://donate.perl-foundation.org/</a> and help support the ongoing
development of Perl 6.</li>

<li>
Send feedback, flames, money and/or a trip to Japan to
<em><a href="mailto:pdcawley@bofh.org.uk">mailto:pdcawley@bofh.org.uk</a></em>.</li>
</ul>
<p>The fee paid for publication of these summaries on perl.com is paid
directly to the Perl Foundation.</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2002/11/">&laquo; November 2002</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2003/01/">January 2003 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
