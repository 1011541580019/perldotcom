<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.02" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
    
    <link rel="prev bookmark" href="/pub/2002/12/20021208.html" title="This week on Perl 6 (12/02-08, 2002)" />
    <link rel="next bookmark" href="/pub/2002/12/hohoho.html" title="How Perl Powers Christmas" />
    
    
    <title>Programming with Mason - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <div id="top_advert"> 
<!-- Put any landscape advert in here -->
<a href="http://www.perlfoundation.org/" target="_new">
<img src="/i/tpf_banner.png" width="468" height="60" /></a>
        </div> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description"></div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1410" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Programming with Mason</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Dave Rolsky</span> on <abbr class="published" title="2002-12-11T00:00:00-08:00">December 11, 2002 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p><i>Dave Rolsky and Ken Williams are the authors of 
<a href="http://www.oreilly.com/catalog/perlhtmlmason/">Embedding Perl in HTML with Mason</a>.</i></p>



<p>Mason is a powerful framework for generating dynamic text, and is
especially useful when creating complex, featureful Web sites.  For
those (hopefully few) folks who haven't yet heard of Mason, it is a
Perl-based templating framework comparable to frameworks such as 
Apache::ASP, Embperl, and Template Toolkit.  Like the first two, and
unlike the latter, Mason operates by embedding Perl in text.</p>

<p>Mason is based around the idea of a <i>component</i>.  A component is
roughly equivalent to a Perl subroutine, and can contain text and/or
code.  Here is a <i>very</i> simple, but complete component that has both
text and code:</p>

<pre><code>
 % my $planet = "World";
 Hello, &lt;% $planet %>!
</code></pre>

<p>When Mason runs this code, the output is:</p>

<pre><code>
 Hello, World!
</code></pre>

<csperl file="grab" domain="on" record="b/795" template="article_sidebar.view">

<p>The rest of this article assumes at least a minimal familiarity with
Mason, though if you're at all familiar with other templating systems,
you'll probably be able to grok the code we show.  For more details, I
would of course recommend <i>Embedding Perl in HTML with Mason</i>,
written by Ken Williams and myself.  Mason also comes with its own
documentation, which can be seen online at <a 
href="http://www.masonhq.com/">www.masonhq.com</a>.</p>

<p>As with any powerful and flexible system, Mason is applicable to a lot
of problems, and there is always more than one way to do it.  It is a
<i>Perl</i>-based system, after all!</p>

<p>Below you'll find some cookbook recipes for solving a few typical Web
application problems.  All the recipes assume that you are using the
latest version of Mason, which at the time of this writing is 1.15,
though most of them will work untouched with older versions.</p>

<h3>Putting a Session ID in All URLs</h3>

<p>If you've ever written a dynamic Web application, then it's likely that
you've used sessions to store data as the user moves through the
application.  Typically, sessions are identified by session IDs that are
stored in a cookie.</p>

<p>If you cannot use cookies, then you can store the session ID in the URL.
There are security and application problems with this approach (as well
as with the user of cookies), but those are outside the scope of this
article.  The mod_perl user list archives at <a href="http://marc.theaimsgroup.com/?l=apache-modperl">marc.theaimsgroup.com/?l=apache-modperl</a> contain a number of discussions related to this topic.</p>

<p>Putting the session ID in the URL can be a hassle, because
it means that you have to somehow process all the URLs you generate.
Using Mason, this isn't as difficult as it would be otherwise.  There
are at least two ways to do this.</p>

<p>The first would be to put a filter in your top level <code>autohandler</code>
component:</p>

<pre><code>
  &lt;%filter>
   s/href="([^"])+"/'href="' . add_session_id($1) . '"'/eg;
   s/action="([^"])+"/'href="' . add_session_id($1) . '"'/eg;
  &lt;/%filter>
</code></pre>

The <code>add_session_id()</code> subroutine, which should be defined in a
module, might look something like this:

<pre><code>
  sub add_session_id {
      my $url = shift;

      return $url if $url =~ m{^\w+://}; # Don't alter external URLs

      if ($url =~ /\?/) {
  	  $url =~ s/\?/?session_id=$MasonBook::Session{_session_id}&/;
      } else {
          $url .= "?session_id=$MasonBook::Session{_session_id}";
      }

      return $url;
  }
</code></pre>

<p>This routine accounts for external links as well as links with or
without an existing query string.</p>

<p>The drawback to putting this in a <code>&lt;%filter&gt;</code> section is that it
only filters URLs in the content generated by components, and misses any URLs that might be in headers, such as in a redirect.  Therefore, you'd need to handle those cases separately with this solution.</p>

<p>Another solution would be to create all URLs (including those
intended for redirects) via a dedicated component or subroutine that 
adds the session id.  This latter solution is probably a better
idea, as it handles redirects properly.  The drawback with this
strategy is that you'll have a Mason component call for every link,
instead of just regular HTML.</p>

<p>Here is just such a component:</p>

<pre><code>
  &lt;%args>
   $scheme   => 'http'
   $username => undef
   $password => ''
   $host     => undef
   $port     => undef
   $path
   %query    => ()
   $fragment => undef
  &lt;/%args>
  &lt;%init>
   my $uri = URI->new;

   if ($host) {
       $uri->scheme($scheme);

       if (defined $username) {
           $uri->authority( "$username:$password" );
       }

       $uri->host($host);
       $uri->port($port) if $port;
   }

   # Sometimes we may want to include a path in a query string as part
   # of the path but the URI module will escape the question mark.
   my $q;

   if ( $path =~ s/\?(.*)$// ) {
       $q = $1;
   }

   $uri->path($path);

   # If there was a query string, we integrate it into the query
   # parameter.
   if ($q) {
       %query = ( %query, split /[&=]/, $q );
   }

   $query{session_id} = $UserSession{session_id};

   # $uri->query_form doesn't handle hash ref values properly
   while ( my ( $key, $value ) = each %query ) {
       $query{$key} = ref $value eq 'HASH' ? [ %$value ] : $value;
   }

   $uri->query_form(%query) if %query;

   $uri->fragment($fragment) if $fragment;
  &lt;/%init>
  &lt;% $uri->canonical | n %>\
</code></pre>

<p>If you didn't want to put the session ID in the query string, then you
might instead make it part of the URL path.  The application could
retrieve the session id from incoming requests by using a mod_perl
handler during the URL translation stage of request handling.</p>

<p>This component provides a programmatic interface to URL 
generation.  Here is an example of how to use it, assuming that 
you've saved it as a component called <code>/url</code>:</p>

<pre><code>
   ... some HTML ...
   Look at &lt;a href="&lt;&amp; /url, path => "books.html" &>">our books&lt;/a>
   or &lt;a href="&lt;&amp; /url, host => "www.oreilly.com"
                        path => "/catalog" &>">O'Reilly's&lt;/a>.
   ... some HTML ...
</code></pre>

<h3>Making Use of Autoflush</h3>

<p>Every once in a while, you may have to output a very large component or a 
file to the client.  If you simply let this accumulate in the output buffer, you could use up a lot of memory.  Furthermore, the slow response time may make the user think that the site has stalled.</p>

<p>Here is an example that sends out the contents of a potentially large
file without sucking up lots of memory.</p>

<pre><code>
  &lt;%args>
   $filename
  &lt;/%args>
  &lt;%init>
   local *FILE;
   open FILE, "&lt; $filename" or die "Cannot open $filename: $!";
   $m->autoflush(1);
   while (&lt;FILE>) {
       $m->print($_);
   }
   $m->autoflush(0);
  &lt;/%init>
</code></pre>

<p>If each line wasn't too huge, then you might just flush the buffer every
once in a while:</p>

<pre><code>
  &lt;%args>
   $filename
  &lt;/%args>
  &lt;%init>
   local *FILE;
   open FILE, "&lt; $filename" or die "Cannot open $filename: $!";
   while (&lt;FILE>) {
       $m->print($_);
       $m->flush_buffer unless $. % 10;
   }
   $m->flush_buffer;
  &lt;/%init>
</code></pre>

<p>The <code>unless $. % 10</code> bit makes use of the special Perl variable
<code>$.</code>, which is the current line number of the file being read.  If
this number modulo 10 is equal to zero, then we flush the buffer.  This
means that we flush the buffer every 10 lines.  (Replace the number
10 with any desired value.)</p>

<h3>User Authentication and Authorization</h3>

<p>One problem that Web sites have to solve over and over again is user
authentication and authorization.  These two topics are related but
not the same, as some might think.  Authentication is the process of
figuring out if someone is who they say they are, and usually involves
checking passwords or keys.  Authorization comes after
this, when we want to determine whether a particular person is
allowed to perform a certain action.</p>

<p>There are a number of modules on CPAN that are intended to help do
these things under <code>mod_perl</code>.  In fact, Apache has separate request-handling phases for both authentication and authorization that
<code>mod_perl</code> can handle.  It is certainly possible to use these modules
with Mason.</p>

<p>You can also do authentication and authorization using Mason
components. Authentication will usually involve some sort of request
for a login and a password, after which you give the user some sort of
token (either in a cookie or a session) that indicates that they have
been authenticated.  You can then check the validity of this token for
each request.</p>

<p>If you have such a token, then authorization simply consists of
checking that the user to whom the token belongs is allowed to perform
a given action.</p>

<h3>Using Apache::AuthCookie</h3>

<p>The <code>Apache::AuthCookie</code> module, available from CPAN, is a module
that handles both authentication and authorization via <code>mod_perl</code> and
can be easily hooked into Mason.  Rather than go through all the
details of configuring <code>Apache::AuthCookie</code>, which requires various
settings in your server config file, let's just skip all that and show
you how you'd make the interface to Mason.</p>

<p><code>Apache::AuthCookie</code> requires that you create a "login script" that
will be executed the first time a browser tries to access a protected
area.  Calling this a script is actually somewhat misleading since it
is really a page rather than a script (though it could be a script
that generates a page).  Regardless, using a Mason component for your
"login script" merely requires that you specify the path to your Mason
component for the login script parameter.</p>

<p>We'll call this "script" <code>AuthCookieLoginForm.comp</code>:</p>

<pre><code>
  &lt;html>
  &lt;head>
  &lt;title>Mason Book AuthCookie Login Form&lt;/title>
  &lt;/head>
  &lt;body>
  &lt;p>
  Your attempt to access this document was denied
  (&lt;% $r->prev->subprocess_env("AuthCookieReason") %>).  Please enter
  your username and password.
  &lt;/p>

  &lt;form action="/AuthCookieLoginSubmit">
  &lt;input type="hidden" name="destination" value="&lt;% $r->prev->uri %>">
  &lt;table align="left">
   &lt;tr>
    &lt;td align="right">&lt;b>Username:&lt;/b>&lt;/td>
    &lt;td>&lt;input type="text" name="credential_0" size="10" maxlength="10">&lt;/td>
   &lt;/tr>
   &lt;tr>
    &lt;td align="right">&lt;b>Password:&lt;/b>&lt;/td>
    &lt;td>&lt;input type="password" name="credential_1" size="8" maxlength="8">&lt;/td>
   &lt;/tr>
   &lt;tr>
    &lt;td colspan="2" align="center">&lt;input type="submit" value="Continue">&lt;/td>
   &lt;/tr>
  &lt;/table>
  &lt;/form>

  &lt;/body>
  &lt;/html>
</code></pre>

<p>This component is modified version of the example login script
included with the <code>Apache::AuthCookie</code> distribution.</p>

<p>The action used for this form, <code></AuthCookieLoginSubmit></code>, is
configured as part of your AuthCookie configuration in your
<code>httpd.conf</code> file.</p>

<p>That's about all it takes to glue <code>Apache::AuthCookie</code> and Mason together.  The rest of 
authentication and authorization is handled by configuring <code>mod_perl</code> to
use <code>Apache::AuthCookie</code> to protect anything on your site that needs
authorization.  A very simple configuration might include the
following directives:</p>

<pre><code>
  PerlSetVar MasonBookLoginScript /AuthCookieLoginForm.comp

  &lt;location /authcookieloginsubmit>
    AuthType MasonBook::AuthCookieHandler
    AuthName MasonBook
    SetHandler  perl-script
    PerlHandler MasonBook::AuthCookieHandler->login
  &lt;/location>

  &lt;location /protected>
    AuthType MasonBook::AuthCookieHandler
    AuthName MasonBook
    PerlAuthenHandler MasonBook::AuthCookieHandler->authenticate
    PerlAuthzHandler  MasonBook::AuthCookieHandler->authorize
    require valid-user
  &lt;/location>
</code></pre>

The <code>MasonBook::AuthCookieHandler</code> module would look like this:

<pre><code>
  package MasonBook::AuthCookieHandler;

  use strict;

  use base qw(Apache::AuthCookie);

  use Digest::SHA1;

  my $secret = "You think I'd tell you?  Hah!";

  sub authen_cred {
      my $self = shift;
      my $r = shift;
      my ($username, $password) = @_;

      # implementing _is_valid_user() is out of the scope of this chapter
      if ( _is_valid_user($username, $password) ) {
          my $session_key =
            $username . '::' . Digest::SHA1::sha1_hex( $username, $secret );
          return $session_key;
      }
  }

  sub authen_ses_key {
      my $self = shift;
      my $r = shift;
      my $session_key = shift;

      my ($username, $mac) = split /::/, $session_key;

      if ( Digest::SHA1::sha1_hex( $username, $secret ) eq $mac ) {
          return $session_key;
      }
  }
</code></pre>

<p>This provides the minimal interface an <code>Apache::AuthCookie</code> subclass
needs to provide to get authentication working.</p>
















<h3>Doing It My Way (Thanks Frank)</h3>

<p>But what if you don't want to use <code>Apache::AuthCookie</code>?  For example,
your site may need to work without using cookies.  No doubt this was
exactly what Frank Sinatra was thinking about when he sang "My Way,"
so let's do it our way.</p>

<p>First, we will show an example authentication system that only uses
Mason and passes the authentication token around via the URL
(actually, via a session).</p>

<p>This example assumes that we already have some sort of session system
that passes the session id around as part of the URL, as discussed
previously.</p>

<p>We start with a quick login form.  We will call this component
<code>login_form.html</code>:</p>

<pre><code>
  &lt;%args>
   $username => ''
   $password => ''
   $redirect_to => ''
   @errors => ()
  &lt;/%args>
  &lt;html>
  &lt;head>
  &lt;title>Mason Book Login&lt;/title>
  &lt;/head>

  &lt;body>

  % if (@errors) {
  &lt;h2>Errors&lt;/h2>
  %   foreach (@errors) {
  &lt;b>&lt;% $_ | h %>&lt;/b>&lt;br>
  %   }
  % }

  &lt;form action="login_submit.html">
  &lt;input type="hidden" name="redirect_to" value="&lt;% $redirect_to %>">
  &lt;table align="left">
   &lt;tr>
    &lt;td align="right">&lt;b>Login:&lt;/b>&lt;/td>
    &lt;td>&lt;input type="text" name="username" value="&lt;% $username %>">&lt;/td>
   &lt;/tr>
   &lt;tr>
    &lt;td align="right">&lt;b>Password:&lt;/b>&lt;/td>
    &lt;td>&lt;input type="password" name="password" value="&lt;% $password %>">&lt;/td>
   &lt;/tr>
   &lt;tr>
    &lt;td colspan="2" align="center">&lt;input type="submit" value="Login">&lt;/td>
   &lt;/tr>
  &lt;/table>
  &lt;/form>

  &lt;/body>
  &lt;/html>
</code></pre>

<p>This form uses some of the same techniques we show in Chapter 8 ("Building a
Mason Site") to pre-populate the form and to handle errors.</p>

<p>Now let's make the component that handles the form submission.  This
component, called <code>login_submit.html</code>, will check the username and
password and, if they are valid, place an authentication token into
the user's session:</p>

<pre><code>
  &lt;%args>
   $username
   $password
   $redirect_to
  &lt;/%args>
  &lt;%init>
   if (my @errors = check_login($username, $password) {
       $m->comp( 'redirect.mas',
                  path => 'login_form.html',
                  query => { errors => \@errors,
                             username => $username,
                             password => $password,
                             redirect_to => $redirect_to } );
   }
 
   $MasonBook::Session{username} = $username;
   $MasonBook::Session{token} =
       Digest::SHA1::sha1_hex( 'My secret phrase', $username );
 
   $m->comp( 'redirect.mas',
             path => $redirect_to );
  &lt;/%init>
</code></pre>

<p>This component simply checks (via magic hand waving) that the username
and password are valid and if they are, it generates an
authentication token, which is added to the user's session.  To
generate this token, we take the username, which is also in the
session, and combine it with a secret phrase.  We then generate a MAC
from those two things.</p>

<p>The authentication and authorization check looks like this:</p>

<pre><code>
  if ( $MasonBook::Session{token} ) {
      if ( $MasonBook::Session{token} eq
           Digest::SHA1::sha1_hex( 'My secret phrase',
                                   $MasonBook::Session{username} ) {

          # R&lt;... valid login, do something here>
      } else {
          # R&lt;... someone is trying to be sneaky!>
      }
  } else { # no token
       my $wanted_page = $r->uri;
       
       # Append query string if we have one.
       $wanted_page .= '?' . $r->args if $r->args;

       $m->comp( 'redirect.mas',
                  path => '/login/login_form.html',
                  query => { redirect_to => $wanted_page } );
  }
</code></pre>

<p>We could put all the pages that require authorization in a single
directory tree and have a top-level autohandler in that tree do the
check.  If there is no token to check, then we redirect the browser to
the login page, and after a successful login they'll return, assuming
that they submit valid login credentials.</p>

<h3>Access Controls With Attributes</h3>

<p>The components we saw previously assumed that there are only two
access levels, unauthenticated and authenticated.  A more complicated
version of this code might involve checking that the user has a
certain access level or role.</p>

<p>In that case, we'd first check that we had a valid authentication
token and then go on to check that the user actually had the
appropriate access rights.  This is simply an extra step in the
authorization process.</p>

<p>Using attributes, we can easily define access controls for different
portions of our site.  Let's assume that we have four access levels,
"Guest," "User," "Editor" and "Admin."  Most of the site is public,
and viewable by anyone.  Some parts of the site require a valid login,
while some require a higher level of privilege.</p>

<p>We implement our access check in our top-level autohandler,
<code></autohandler></code>, from which all other components <i>must</i> inherit in
order for the access control code to be effective.</p>

<pre><code>

  &lt;%init>
   my $user = get_user();  # again, hand waving
 
   my $required_access = $m->base_comp->attr('required_access');
 
   unless ( $user->has_access_level($required_access) ) {
      # R&lt;... do something like send them to another page>
   }
 
   $m->call_next;
  &lt;/%init>
  &lt;%attr>
   required_access => 'Guest'
  &lt;/%attr>
</code></pre>

<p>It is crucial that we set a default access level in this autohandler.
By doing this, we are saying that by default, all components are
accessible by all people, since every visitor will have at least
"Guest" access.</p>

<p>We can override this default elsewhere.  For example, in a component
called <code>/admin/autohandler</code>, we might have:</p>

<pre><code>
  &lt;%attr>
   required_access => 'Admin'
  &lt;/%attr>
</code></pre>

<p>As long as all the components in the <code></admin/></code> directory inherit from
the <code></admin/autohandler></code> component and don't override the
<code>required_access</code> attribute, we have effectively limited that
directory (and its subdirectories) to administration users only.  If we, for
some reason, had an individual component in the <code></admin/></code> directory
that we wanted editors to be able to see, we could simply set the
"required_access" attribute for that component to "Editor."</p>

<h3>Managing DBI Connections</h3>

<p>Not infrequently, we see people on the Mason users list asking
questions about how to handle caching DBI connections.</p>

<p>Our recipe for this is really simple:</p>

<pre><code>
  use Apache::DBI
</code></pre>

<p>Rather than reinventing the wheel, use <code>Apache::DBI</code>, which provides
the following features:</p>

<ul>

<li><p>It is completely transparent to use.  Once you've used it, you simply
call <code>DBI->connect()</code> as always and <code>Apache::DBI</code> gives you an
existing handle if one is available.</p></li>

<li><p>It makes sure that the handle is live, so that if your RDBMS goes down
and then back up, your connections still work just fine.</p>
</li>


<li><p>It does not cache handles made before Apache forks, as many DBI
drivers do not support using a handle after a fork.</p>
</li>

</ul>

<h3>Generating Config Files</h3>

<p>Config files are a good candidate for generation by Mason.  For
example, your production and staging Web server config files might
differ in only a few areas.  Changes to one usually will need to be
propagated to another.  This is especially true with <code>mod_perl</code>,
where Web server configuration can basically be part of a Web-based
application.</p>

<p>On top of this, you may decide to set up a per-developer environment,
either by having each developer run the necessary software on their
own machine, or by starting Web servers on many different ports on a
single development server.  In this scenario, a template-driven config
file generator becomes even more appealing.</p>

<p>Here's a simple script to drive this generation.  This script assumes
that all the processes are running on one shared development machine.</p>

<pre><code>
  #!/usr/bin/perl -w

  use strict;

  use Cwd;
  use File::Spec;
  use HTML::Mason;
  use User::pwent;

  my $comp_root =
      File::Spec->rel2abs( File::Spec->catfile( cwd(), 'config' ) );

  my $output;
  my $interp =
      HTML::Mason::Interp->new( comp_root  => $comp_root,
				out_method => \$output,
			      );

  my $user = getpwuid($&lt;);

  $interp->exec( '/httpd.conf.mas', user => $user );

  my $file =  File::Spec->catfile( $user->dir, 'etc', 'httpd.conf' );
  open FILE, ">$file" or die "Cannot open $file: $!";
  print FILE $output;
  close FILE;
</code></pre>

<p>A <code>httpd.conf.mas</code> component might look like this:</p>

<pre><code>
  ServerRoot &lt;% $user->dir %>

  PidFile &lt;% File::Spec->catfile( $user->dir, 'logs', 'httpd.pid' ) %>

  LockFile &lt;% File::Spec->catfile( $user->dir, 'logs', 'httpd.lock' ) %>

  Port &lt;% $user->uid + 5000 %>

  # loads Apache modules, defines content type handling, etc.
  &lt;& standard_apache_config.mas &>

  &lt;perl>
   use lib &lt;% File::Spec->catfile( $user->dir, 'project', 'lib' ) %>;
  &lt;/perl>

  DocumentRoot &lt;% File::Spec->catfile( $user->dir, 'project', 'htdocs' ) %>

  PerlSetVar MasonCompRoot &lt;% File::Spec->catfile( $user->dir, 'project', 'htdocs' ) %>
  PerlSetVar MasonDataDir &lt;% File::Spec->catfile( $user->dir, 'mason' ) %>

  PerlModule HTML::Mason::ApacheHandler

  &lt;filesmatch "\.html$">
   SetHandler perl-script
   PerlHandler HTML::Mason::ApacheHandler
  &lt;/filesmatch>

  &lt;%args>
  $user
  &lt;/%args>
</code></pre>

<p>This points the server's document root to the developer's working
directory.  Similarly, it adds the <code>project/lib</code> directory to Perl's
<code>@INC</code> via <code>use lib</code> so that the user's working copy of the
project's modules are seen first.  The server will listen on a port
equal to the user's user ID, plus 5,000.</p>

<p>Obviously, this is an incomplete example.  It doesn't specify where
logs will go, or other necessary config items.  It also doesn't handle
generating the config file for a server intended to be run by the root
user on a standard port.</p>

<h3>If You Want More ...</h3>

<p>These recipes were adapted from Chapter 11, "Recipes," of <i>Embedding
Perl in HTML With Mason</i>.  And, of course, the book contains a lot
more than just recipes.  If you're interested in learning more about
Mason, the book is a great place to start.</p>

<p>Also, don't forget to check out the Mason HQ site at
<a href="http://www.masonhq.com/">www.masonhq.com/</a>, which contains online documentation,
user-contributed code and docs, and links to the Mason users mailing
list, which is another great resource for developers using Mason.</p>


<hr size="1" noshade="noshade" />

<p>
O'Reilly &amp; Associates recently released (October 2002) <a href="http://www.oreilly.com/catalog/perlhtmlmason/">Embedding Perl in HTML with Mason</a>.
</p>

<ul>
<li><p>
<a href="http://www.oreilly.com/catalog/perlhtmlmason/chapter/index.html">Sample Chapter 5, Advanced Features</a>, is available 
free online. 
</p></li>

<li><p>
You can also look at the <a href="">Table of Contents</a>, the 
<a href="">Index</a>, and the <a href="">Full Description</a> of 
the book.
</p></li>

<li><p>
For more information, or to order the book, 
<a href="">click here</a>.</p></li>  
</ul>









                                    </div>


                                </div>
                                <div class="asset-footer">

    


                                    <div class="entry-tags">
                                        <h4>Tags<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?blog_id=2&amp;tag=Embedding%20Perl&amp;limit=20';return false;" rel="tag">Embedding Perl</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?blog_id=2&amp;tag=HTML&amp;limit=20';return false;" rel="tag">HTML</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?blog_id=2&amp;tag=Mason&amp;limit=20';return false;" rel="tag">Mason</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?blog_id=2&amp;tag=Perl&amp;limit=20';return false;" rel="tag">Perl</a></li>
                                        </ul>
                                    </div>

                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2010/07/">July 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.02" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
