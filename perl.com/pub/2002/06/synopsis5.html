<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.02" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
    
    <link rel="prev bookmark" href="/pub/2002/06/mod-perl.html" title="Improving mod_perl Sites' Performance: Part 2" />
    <link rel="next bookmark" href="/pub/2002/07/axkit.html" title="Taglib TMTOWTDI" />
    
    
    <title>Synopsis 5 - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <div id="top_advert"> 
<!-- Put any landscape advert in here -->
<a href="http://www.perlfoundation.org/" target="_new">
<img src="/i/tpf_banner.png" width="468" height="60" /></a>
        </div> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description"></div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1318" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Synopsis 5</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Damian Conway</span> on <abbr class="published" title="2002-06-26T00:00:00-08:00">June 26, 2002 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S05.html">Synopsis 5</a> for the current design information.</p>

<p>
<h3>A summary of the changes in Apocalypse 5:</h3>
<h3><a name="unchanged_features">Unchanged features</a></h3></p>
<p>
<ul>
<li>
Capturing: (...)</li>

<li>
Repetition quantifiers: *, +, and ?</li>

<li>
Alternatives:  |</li>

<li>
Backslash escape:  \</li>

<li>
Minimal matching suffix:   ??,  *?,  +?
</li></ul></p>
<p>
</p>

<h3><a name="modifiers">Modifiers</a></h3>
<ul>
<li>
The extended syntax (<code>/x</code>) is no longer required...it's the default.
</li><br />
<li>
There are no <code>/s</code> or <code>/m</code> modifiers (changes to the meta-characters replace them - see below).
</li><br />
<li>
There is no <code>/e</code> evaluation modifier on substitutions; 
use <code>s/pattern/$( code() )/</code> instead.
</li><br />
<li>
The <code>/g</code> modifier has been renamed to <code>e</code> (for <code>each</code>).
</li><br />
<li>
Modifiers are now placed as adverbs at the <em>start</em> of a match/substitution:
<pre>
    @matches = m:ei/\s* (\w*) \s* ,?/;</pre>
</li><br />
<li>
The single-character modifiers also have longer versions:
<pre>
        :i        :ignorecase
        :e        :each</pre>
</li><br />
<li>
The <code>:c</code> (or <code>:cont</code>) modifier causes the match to continue from the string's current <code>.pos</code>:
<pre>
    m:c/ pattern /        # start at end of
                          # previous match on $_</pre>
</li><br />
<li>
The new <code>:o</code> (<code>:once</code>) modifier replaces the Perl 5 <code>?...?</code> syntax:
<pre>
    m:once/ pattern /    # only matches first time</pre>
</li><br />
<li>
The new <code>:w</code> (<code>:word</code>) modifier causes whitespace sequences to be replaced by <code>\s*</code> or <code>\s+</code> subpattern:
<pre>
    m:w/ next cmd =   &lt;condition&gt;/</pre>
</li><br />

<li>
Same as:
<pre>
    m/ \s* next \s+ cmd \s* = \s* &lt;condition&gt;/</pre>
</li><br />
<li>
The new <code>:uN</code> modifier specifies Unicode level:
<pre>
    m:u0/ .&lt;2&gt; /        # match two bytes
    m:u1/ .&lt;2&gt; /        # match two codepoints
    m:u2/ .&lt;2&gt; /        # match two graphemes
    m:u3/ .&lt;2&gt; /        # match language dependently</pre>
</li><br />
<li>
The new <code>:p5</code> modifier allows Perl 5 regex syntax to be used instead:
<pre>
    m:p5/(?mi)^[a-z]{1,2}(?=\s)/</pre>
</li><br />
<li>
Any integer modifier specifies a count. What kind of count is determined by the character that follows.
</li><br />
<li>
If followed by an <code>x</code>, it means repetition:
<pre>
    s:4x{ (&lt;ident&gt;) = (\N+) $$}{$1 =&gt; $2};</pre>
<pre>
    # same as:</pre>
<pre>
    s{ (&lt;ident&gt;) = (\N+) $$}{$1 =&gt; $2} for 1..4;</pre>
</li><br />
<li>
If followed by an <code>st</code>, <code>nd</code>, <code>rd</code>, or <code>th</code>, it means find the <em>N</em>th occurance:
<pre>
    s:3rd/(\d+)/@data[$1]/;</pre>
<pre>
    # same as:</pre>
<pre>
    m/(\d+)/ &amp;&amp; m:c/(\d+)/ &amp;&amp; s:c/(\d+)/@data[$1]/;</pre>
</li><br />
<li>
With the new <code>:any</code> modifier, the regex will match every possible way (including overlapping) and return all matches.
<pre>
    $str = &quot;abracadabra&quot;;</pre>
<pre>
    @substrings = $str =~ m:any/ a (.*) a /;</pre>
<pre>
    # br brac bracad bracadabr c cad cadabr d dabr br</pre>
</li><br />
<li>
The <code>:i</code>, <code>:w</code>, <code>:c</code>, <code>:uN</code>, and <code>:p5</code> modifiers can be placed inside the regex (and are lexically scoped):
<pre>
    m/:c alignment = [:i left|right|cent[er|re]] /</pre>
</li><br />
<li>
User-defined modifiers will be possible
<pre>
        m:fuzzy/pattern/;</pre>
</li><br />
<li>
Single letter flags can be ``chained'':
<pre>
        s:ewi/cat/feline/</pre>
</li><br />
<li>
User-defined modifiers can also take arguments:
<pre>
        m:fuzzy('bare')/pattern/;</pre>
</li><br />
<li>
Hence parentheses are no longer valid regex delimiters
</li><br /></ul>
<p>
</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S05.html">Synopsis 5</a> for the current design information.</p>

<h3><a name="changed_metacharacters">Changed metacharacters</a></h3>
<ul>
<li>
A dot <code>.</code> now matches <em>any</em> character including newline. (The <code>/s</code> modifier is gone.)
</li><br />
<li>
<code>^</code> and <code>$</code> now always match the start/end of a string, like the old <code>\A</code> and <code>\z</code>. (The <code>/m</code> modifier is gone.)
</li><br />
<li>
A <code>$</code> no longer matches an optional preceding <code>\n</code> so it's necessary to say <code>\n?$</code> if that's what you mean.
</li><br />
<li>
<code>\n</code> now matches a logical (platform independent) newline not just <code>\012</code>.
</li><br />
<li>
The <code>\A</code>, <code>\Z</code>, and <code>\z</code> metacharacters are gone.
</li><br /></ul>
<p>
</p>
<hr size="1" noshade="noshade">
<h3><a name="new_metacharacters">New metacharacters</a></h3>
<ul>
<li>
Because <code>/x</code> is default:
<ul>
<li>
<code>#</code> now always introduces a comment.
</li><br />
<li>
Whitespace is now always metasyntactic, i.e. used only for layout and not matched literally (but see the :w modifier described above).
</li><br /></ul>
<li>
<code>^^</code> and <code>$$</code> match line beginnings and endings. (The <code>/m</code> modifier is gone.)
</li><br />
<li>
<code>.</code> matches an ``anything'', while <code>\N</code> matches an ``anything except newline''. (The <code>/s</code> modifier is gone.)
</li><br /></ul>
<p>
</p>
<hr size="1" noshade="noshade">
<h3><a name="bracket_rationalization">Bracket rationalization</a></h3>
<ul>
<li>
<code>(...)</code> still delimits a capturing group.
</li><br />
<li>
<code>[...]</code> is no longer a character class.
</li><br />

<li>
It now delimits a non-capturing group.
</li><br />
<li>
<code>{...}</code> is no longer a repetition quantifier.
</li><br />
<li>
It now delimits an embedded closure.
</li><br />
<li>
You can call Perl code as part of a regex match.
</li><br />
<li>
Embedded code does not usually affect the match - it is only used for side-effects:
<pre>
    / (\S+) { print &quot;string not blank\n&quot;; $text = $1; }
       \s+  { print &quot;but does contain whitespace\n&quot; }
    /</pre>
</li><br />
<li>
It can affect the match if it calls <code>fail</code>:
<pre>
    / (\d+) {$1&lt;256 or fail} /</pre>
</li><br />
<li>
<code>&lt;...&gt;</code> are now extensible metasyntax delimiters or ``assertions'' (i.e. they replace <code>(?...)</code>).
</li><br /></ul>
<p>
</p>
<hr size="1" noshade="noshade">
<h3><a name="variable_(non)interpolation">Variable (non-)interpolation</a></h3>



<ul>
<li>
In Perl 6 regexes, variables don't interpolate.
</li><br />
<li>
Instead they're passed ``raw'' to the regex engine, which can then decide how to handle them (more on that below).
</li><br />
<li>
The default way in which the engine handles a scalar is to match it as a \Q[...] literal (i.e.it does not treat the interpolated string as a subpattern).
</li><br />
<li>
In other words, a Perl 6:    / $var /
<p>is like a Perl 5:            / \Q$var\E /</p>
</li><br />
<li>
(To get regex interpolation use an assertion - see below)
</li><br />
<li>
An interpolated array:
<pre>
    / @cmds /</pre>
<p>is matched as if it were an alternation of its elements:</p>
<pre>
    / [ @cmds[0] | @cmds[1] | @cmds[2] | ... ] /</pre>
</li><br />
<li>
And, of course, each one is matched as a literal.
</li><br />
<li>
An interpolated hash matches a <code>/\w+/</code> and then requires that sequence to be a valid key of the hash.
</li><br />
<li>
So:
<pre>
    / %cmds /</pre>
</li><br />
<li>
is like:
<pre>
    / (\w+) { fail unless exists %cmds{$1} } /</pre>
</li><br /></ul>
<p>
</p>
<hr size="1" noshade="noshade">
<h3><a name="extensible_metasyntax_(<...>)">Extensible metasyntax (<code>&lt;...&gt;</code>)</a></h3>
<ul>
<li>
The first character after <code>&lt;</code> determines the behaviour of the assertion.
</li><br />
<li>
A leading alphabetic character means it's a grammatical assertion (i.e. a subpattern or a named character class - see below):
<pre>
    / &lt;sign&gt;? &lt;mantissa&gt; &lt;exponent&gt;? /</pre>
</li><br />
<li>
The special named assertions include:
<pre>
    / &lt;before pattern&gt; /    # was /(?=pattern)/
    / &lt;after pattern&gt; /     # was /(?&lt;pattern)/ 
                            # but now a real pattern!</pre>
<pre>
    / &lt;ws&gt; /                # match any whitespace</pre>
<pre>
    / &lt;sp&gt; /                # match a space char</pre>
</li><br />
<li>
A leading number, pair of numbers, or pair of scalars means it's a repetition specifier:
<pre>
    / value was (\d&lt;1,6&gt;) with (\w&lt;$m,$n&gt;) /</pre>
</li><br />
<li>
A leading <code>$</code>, <code>@</code>, <code>%</code>, or <code>&amp;</code> interpolates a variable or subroutine return value as a regex rather than as a literal:
<pre>
    / &lt;$key_pat&gt; = &lt;@value_alternatives&gt; /</pre>
</li><br />
<li>
A leading <code>(</code> indicates a code assertion:
<pre>
    / (\d&lt;1,3&gt;) &lt;( $1 &lt; 256 )&gt; /</pre>
</li><br />
<li>
Same as:
<pre>
    / (\d&lt;1,3&gt;) {$1&lt;256 or fail} /</pre>
</li><br />
<li>
A leading <code>{</code> indicates code that produces a regex to be interpolated into the pattern at that point:
<pre>
    / (&lt;ident&gt;)  &lt;{ cache{$1} //= get_body($1) }&gt; /</pre>
</li><br />
<li>
A leading <code>[</code> indicates an enumerated character class:
<pre>
    / &lt;[a-z_]&gt;* /</pre>
</li><br />
<li>
A leading <code>-</code> indicates a complemented character class:
<pre>
    / &lt;-[a-z_]&gt; &lt;-&lt;alpha&gt;&gt; /</pre>
</li><br />
<li>
A leading <code>'</code> indicates an interpolated literal match (including whitespace):
<pre>
    / &lt;'match this exactly (whitespace matters)'&gt; /</pre>
</li><br />
<li>
The special assertion <code>&lt;.&gt;</code> matches any logical grapheme (including a Unicode combining character sequences):
<pre>
    / seekto = &lt;.&gt; /  # Maybe a combined char</pre>
</li><br />
<li>
A leading <code>!</code> indicates a negated meaning (a zero-width assertion except for repetition specifiers):
<pre>
    / &lt;!before _&gt;    # We aren't before an _
      \w&lt;!1,3&gt;       # We match 0 or &gt;3 word chars
    /</pre>
</li><br /></ul>
<p>
</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S05.html">Synopsis 5</a> for the current design information.</p>

<h3><a name="backslash_reform">Backslash reform</a></h3>
<ul>
<li>
The <code>\p</code> and <code>\P</code> properties become intrinsic grammar rules (<code>&lt;prop ...&gt;</code> and <code>&lt;!prop ...&gt;</code>).
</li><br />
<li>
The <code>\L...\E</code>, <code>\U...\E</code>, and <code>\Q...\E</code> sequences become <code>\L[...]</code>, <code>\U[...]</code>, and <code>\Q[...]</code> (<code>\E</code> is gone).
</li><br />
<li>
Note that <code>\Q[...]</code> will rarely be needed since raw variables interpolate as <code>eq</code> matches, rather than regexes.
</li><br />
<li>
Backreferences (e.g. <code>\1</code>) are gone; <code>$1</code> can be used instead, because it's no longer interpolated.
</li><br />
<li>
New backslash sequences, <code>\h</code> and <code>\v</code>, match horizontal and vertical whitespace respectively, including Unicode.
</li><br />
<li>
<code>\s</code> now matches any Unicode whitespace character.
</li><br />
<li>
The new backslash sequence <code>\N</code> matches anything except a logical newline; it is the negation of <code>\n</code>.
</li><br />
<li>
A series of other new capital backslash sequences are also the negation of their lower-case counterparts:
<ul>
<li>
<code>\H</code> matches anything but horizontal whitespace.
</li><br />
<li>
<code>\V</code> matches anything but vertical whitespace.
</li><br />
<li>
<code>\T</code> matches anything but a tab.
</li><br />
<li>
<code>\R</code> matches anything but a return.
</li><br />
<li>
<code>\F</code> matches anything but a formfeed.
</li><br />
<li>
<code>\E</code> matches anything but an escape.
</li><br />
<li>
<code>\X...</code> matches anything but the specified hex character.
</li><br /></ul>
</ul>
<p>
</p>
<hr size="1" noshade="noshade">
<h3><a name="regexes_are_rules">Regexes are rules</a></h3>
<ul>
<li>
The Perl 5  <code>qr/pattern/</code> regex constructor is gone.
</li><br />
<li>
The Perl 6 equivalents are:
<pre>
    rule { pattern }    # always takes {...} as delimiters
    rx/ pattern /       # can take (almost any) chars as delimiters</pre>
</li><br />



<li>
If either needs modifiers, they go before the opening delimiter:
<pre>
    $regex = rule :ewi { my name is (.*) };
    $regex = rx:ewi/ my name is (.*) /;</pre>
</li><br />
<li>
The name of the constructor was changed from <code>qr</code> because it's no longer an interpolating quote-like operator.
</li><br />
<li>
As the syntax indicates, it is now more closely analogous to a <code>sub {...}</code> constructor.
</li><br />
<li>
In fact, that analogy will run <em>very</em> deep in Perl 6.
</li><br />
<li>
Just as a raw <code>{...}</code> is now always a closure (which may still execute immediately in certain contexts and be passed as a reference in others)...
</li><br />
<li>
...so too a raw <code>/.../</code> is now always a regex (which may still match immediately in certain contexts and be passed as a reference in others).
</li><br />
<li>
Specifically, a <code>/.../</code> matches immediately in a void or Boolean context, or when it is an explicit argument of a <code>=~</code>.
</li><br />
<li>
Otherwise it's a regex constructor.
</li><br />
<li>
So this:
<pre>
    $var = /pattern/;</pre>
<p>no longer does the match and sets <code>$var</code> to the result.</p>
</li><br />
<li>
Instead it assigns a regex reference to <code>$var</code>.
</li><br />
<li>
The two cases can always be distinguished using <code>m{...}</code> or <code>rx{...}</code>:
<pre>
    $var = m{pattern};    # Match regex, assign result
    $var = rx{pattern};   # Assign regex itself</pre>
</li><br />
<li>
Note that this means that former magically lazy usages like:
<pre>
    @list = split /pattern/, $str;</pre>
<p>are now just consequences of the normal semantics.</p>
</li><br />
<li>
It's now also possible to set up a user-defined subroutine that acts like grep:
<pre>
    sub my_grep($selector, *@list) {
        given $selector {
            when RULE  { ... }
            when CODE  { ... }
            when HASH  { ... }
            # etc.
        }
    }</pre>
</li><br />
<li>
Using <code>{...}</code> or <code>/.../</code> in the scalar context of the first argument causes it to produce a <code>CODE</code> or <code>RULE</code> reference, which the switch statement then selects upon.
</li><br /></ul>
<p>
</p>
<hr size="1" noshade="noshade">
<h3><a name="backtracking_control">Backtracking control</a></h3>
<ul>
<li>
Backtracking over a single colon causes the regex engine not to retry the preceding atom:
<pre>
    m:w/ \( &lt;expr&gt; [ , &lt;expr&gt; ]* : \) /</pre>
<p>(i.e. there's no point trying fewer <code>&lt;expr&gt;</code> matches, if there's no closing parenthesis on the horizon)</p>
</li><br />
<li>
Backtracking over a double colon causes the surrounding group to immediately fail:
<pre>
    m:w/ [ if :: &lt;expr&gt; &lt;block&gt;
         | for :: &lt;list&gt; &lt;block&gt;
         | loop :: &lt;loop_controls&gt;? &lt;block&gt;
         ]
    /</pre>
<p>(i.e. there's no point trying to match a different keyword if one was already found but failed)</p>
</li><br />
<li>
Backtracking over a triple colon causes the current rule to fail outright (no matter where in the rule it occurs):
<pre>
    rule ident {
          ( [&lt;alpha&gt;|_] \w* ) ::: { fail if %reserved{$1} }
        | &quot; [&lt;alpha&gt;|_] \w* &quot;
    }</pre>
<pre>
    m:w/ get &lt;ident&gt;? /</pre>
<p>(i.e. using an unquoted reserved word as an identifier is not permitted)</p>
</li><br />
<li>
Backtracking over a <code>&lt;commit&gt;</code> assertion causes the entire match to fail outright, no matter how many subrules down it happens:
<pre>
    rule subname {
        ([&lt;alpha&gt;|_] \w*) &lt;commit&gt; { fail if %reserved{$1} }
    }
    m:w/ sub &lt;subname&gt;? &lt;block&gt; /</pre>
<p>(i.e. using a reserved word as a subroutine name is instantly fatal to the ``surrounding'' match as well)</p>
</li><br />
<li>
A &lt;cut&gt; assertion always matches successfully, and has the side effect of deleting the parts of the string already matched.
</li><br />
<li>
Attempting to backtrack past a &lt;cut&gt; causes the complete match to fail (like backtracking past a &lt;commit&gt;. This is because there's now no preceding text to backtrack into.
</li><br />
<li>
This is useful for throwing away successfully processed input when matching from an input stream or an iterator of arbitrary length.
</li><br /></ul>
<p>
</p>














<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S05.html">Synopsis 5</a> for the current design information.</p>

<h3><a name="named_regexes">Named Regexes</a></h3>
<ul>
<li>
The analogy between <code>sub</code> and <code>rule</code> extends much further.
</li><br />
<li>
Just as you can have anonymous subs and named subs...
</li><br />
<li>
...so too you can have anonymous regexes and <em>named</em> regexes:
<pre>
    rule ident { [&lt;alpha&gt;|_] \w* }</pre>
<pre>
    # and later...</pre>
<pre>
    @ids = grep /&lt;ident&gt;/, @strings;</pre>
</li><br />
<li>
As the above example indicates, it's possible to refer to named regexes, such as:
<pre>
    rule serial_number { &lt;[A-Z]&gt; \d&lt;8&gt; })
    rule type { alpha | beta | production | deprecated | legacy }</pre>
<p>in other regexes as named assertions:</p>
<pre>
    rule identification { [soft|hard]ware &lt;type&gt; &lt;serial_number&gt; }</pre>
</li><br /></ul>
<p>
</p>
<hr size="1" noshade="noshade">
<h3><a name="nothing_is_illegal">Nothing is illegal</a></h3>
<ul>
<li>
The null pattern is now illegal.
</li><br />
<li>
To match whatever the prior successful regex matched, use:
<pre>
    /&lt;prior&gt;/</pre>
</li><br />
<li>
To match the zero-width string, use:
<pre>
    /&lt;null&gt;/</pre>
</li><br /></ul>
<p>
</p>
<hr size="1" noshade="noshade">
<h3><a name="hypothetical_variables">Hypothetical variables</a></h3>
<ul>
<li>
In embedded closures it's possible to bind a variable to a value that only ``sticks'' if the surrounding pattern successfully matches.
</li><br />
<li>
A variable is declared with the keyword <code>let</code> and then bound to the desired value:
<pre>
    / (\d+) {let $num := $1} (&lt;alpha&gt;+)/</pre>
</li><br />
<li>
Now <code>$num</code> will only be bound if the digits are actually found.
</li><br />
<li>
If the match ever backtracks past the closure (i.e. if there are no alphabetics following), the binding is ``undone''.
</li><br />
<li>
This is even more interesting in alternations:
<pre>
    / [ (\d+)      { let $num   := $1 }
      | (&lt;alpha&gt;+) { let $alpha := $2 }
      | (.)        { let $other := $3 }
      ]
    /</pre>
</li><br />
<li>
There is also a shorthand for assignment to hypothetical variables:
<pre>
    / [ $num  := (\d+)
      | $alpha:= (&lt;alpha&gt;+)
      | $other:=(.)
      ]
    /</pre>
</li><br />
<li>
The numeric variables (<code>$1</code>, <code>$2</code>, etc.) are also ``hypothetical''.
</li><br />
<li>
Numeric variables can be assigned to, and even re-ordered:
<pre>
    my ($key, $val) = m:w{ $1:=(\w+) =\&gt; $2:=(.*?)
                         | $2:=(.*?) \&lt;= $1:=(\w+)
                         };</pre>
</li><br />
<li>
Repeated captures can be bound to arrays:
<pre>
    / @values:=[ (.*?) , ]* /</pre>
</li><br />
<li>
Pairs of repeated captures can be bound to hashes:
<pre>
    / %options:=[ (&lt;ident&gt;) = (\N+) ]* /</pre>
</li><br />
<li>
Or just capture the keys (and leave the values undef):
<pre>
    / %options:=[ (&lt;ident&gt;) = \N+ ]* /</pre>
</li><br />
<li>
Subrules (e.g. <code>&lt;rule&gt;</code>) also capture their result in a hypothetical variable of the same name as the rule:
<pre>
    / &lt;key&gt; =\&gt; &lt;value&gt; { %hash{$key} = $value } /</pre>
</li><br /></ul>
<p>
</p>
<hr size="1" noshade="noshade">
<h3><a name="return_values_from_matches">Return values from matches</a></h3>
<ul>
<li>
A match always returns a ``match object'', which is also available as (lexical) <code>$0</code>
</li><br />
<li>
The match object evaluates differently in different contexts:
<ul>
<li>
in boolean context it evaluates as true or false (i.e. did the match succeed?):
<pre>
    if /pattern/ {...}
    # or:
    /pattern/; if $0 {...}</pre>
</li><br />
<li>
in numeric context it evaluates to the number of matches:
<pre>
    $match_count += m:e/pattern/;</pre>
</li><br />
<li>
in string context it evaluates to the captured substring (if there was exactly one capture in the pattern) or to the entire text that was matched (if the pattern does not capture, or captures multiple elements):
<pre>
    print %hash{$text =~ /,? (&lt;ident&gt;)/};
    # or: 
    $text =~ /,? (&lt;ident&gt;)/  &amp;&amp;  print %hash{$0};</pre>
</li><br /></ul>
<li>
<em>Within</em> a regex, <code>$0</code> acts like a hypothetical variable.
</li><br />
<li>
It controls what a regex match returns (like <code>$$</code> does in yacc)
</li><br />
<li>
Use <code>$0:=</code> to override the default return behaviour described above:
<pre>
    rule string1 { (&lt;[&quot;'`]&gt;) ([ \\. | &lt;-[\\]&gt; ]*?) $1 }</pre>
<pre>
    $match = m/&lt;string1&gt;/;  # default: $match includes 
                            # opening and closing quotes</pre>
<pre>
    rule string2 { (&lt;[&quot;'`]&gt;) $0:=([ \\. | &lt;-[\\]&gt; ]*?) $1 }</pre>
<pre>
    $match = m/&lt;string2&gt;/;  # $match now excludes quotes
                            # because $0 explicitly bound 
                            # to second capture only</pre>
</li><br /></ul>
<p>
</p>














<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S05.html">Synopsis 5</a> for the current design information.</p>

<h3><a name="matching_against_nonstrings">Matching against non-strings</a></h3>
<ul>
<li>
Anything that can be tied to a string can be matched against a regex. This feature is particularly useful with input streams:
<pre>
    my @array := &lt;$fh&gt;;           # lazy when aliased
    my $array is from(\@array);   # tie scalar</pre>
<pre>
    # and later...</pre>
<pre>
    $array =~ m/pattern/;         # match from stream</pre>
</li><br /></ul>
<p>
</p>
<hr size="1" noshade="noshade">
<h3><a name="grammars">Grammars</a></h3>
<ul>
<li>
Potential ``collision'' problem with named regexes
</li><br />
<li>
Of course, a named <code>ident</code> regex shouldn't clobber someone else's <code>ident</code> regex.
</li><br />
<li>
So some mechanism is needed to confine regexes to a namespace.
</li><br />
<li>
If subs are the model for rules, then modules/classes are the obvious model for aggregating them.
</li><br />
<li>
Such collections of rules are generally known as ``grammars''.
</li><br />
<li>
Just as a class can collect named actions together:
<pre>
    class Identity {
        method name { &quot;Name = $.name&quot; }
        method age  { &quot;Age  = $.age&quot;  }
        method addr { &quot;Addr = $.addr&quot; }</pre>
<pre>
        method desc {
            print .name(), &quot;\n&quot;,
                  .age(),  &quot;\n&quot;,
                  .addr(), &quot;\n&quot;;
        }</pre>
<pre>
        # etc.
    }</pre>
</li><br />
<li>
So too a grammar can collect a set of named rules together:
<pre>
    grammar Identity {
        rule name :w { Name = (\N+) }
        rule age  :w { Age  = (\d+) }
        rule addr :w { Addr = (\N+) }
        rule desc {
            &lt;name&gt; \n
            &lt;age&gt;  \n
            &lt;addr&gt; \n
        }</pre>
<pre>
        # etc.
    }</pre>
</li><br />
<li>
Like classes, grammars can inherit:
<pre>
    grammar Letter {
        rule text     { &lt;greet&gt; &lt;body&gt; &lt;close&gt; }</pre>
<pre>
        rule greet :w { [Hi|Hey|Yo] $to:=(\S+?) , $$}</pre>
<pre>
        rule body     { &lt;line&gt;+ }</pre>
<pre>
        rule close :w { Later dude, $from:=(.+) }</pre>
<pre>
        # etc.
    }</pre>
<pre>
    grammar FormalLetter is Letter {</pre>
<pre>
        rule greet :w { Dear $to:=(\S+?) , $$}</pre>
<pre>
        rule close :w { Yours sincerely, $from:=(.+) }</pre>
<pre>
    }</pre>
</li><br />
<li>
Inherit rule definitions (polymorphically!)
</li><br />
<li>
So there's no need to respecify body, line, etc.
</li><br />
<li>
Perl 6 will come with at least one grammar predefined:
<pre>
    grammar Perl {    # Perl's own grammar</pre>
<pre>
        rule prog { &lt;line&gt;* }</pre>
<pre>
        rule line { &lt;decl&gt;
                  | &lt;loop&gt;
                  | &lt;label&gt; [&lt;cond&gt;|&lt;sideff&gt;|;]
        }</pre>
<pre>
        rule decl { &lt;sub&gt; | &lt;class&gt; | &lt;use&gt; }</pre>
<pre>
        # etc. etc.
    }</pre>
</li><br />
<li>
Hence:
<pre>
    given $source_code {
        $parsetree = m/&lt;Perl::prog&gt;/;
    }</pre>
</li><br /></ul>
<p>
</p>
<hr size="1" noshade="noshade">
<h3><a name="transliteration">Transliteration</a></h3>
<ul>
<li>
The tr/// quote-like operator now also has a subroutine form.
</li><br />
<li>
It can be given either a single <code>PAIR</code>:
<pre>
    $str =~ tr( 'A-C' =&gt; 'a-c' );</pre>
</li><br />
<li>
Or a hash (or hash ref):
<pre>
    $str =~ tr( {'A'=&gt;'a', 'B'=&gt;'b', 'C'=&gt;'c'} );
    $str =~ tr( {'A-Z'=&gt;'a-z', '0-9'=&gt;'A-F'} );
    $str =~ tr( %mapping );</pre>
</li><br />
<li>
Or two arrays (or array refs):
<pre>
    $str =~ tr( ['A'..'C'], ['a'..'c'] );
    $str =~ tr( @UPPER, @lower );</pre>
</li><br />
<li>
Note that the array version can map one-or-more characters to one-or-more characters:
<pre>
    $str =~ tr( [' ',      '&lt;',    '&gt;',    '&amp;'    ],
                ['&amp;nbsp;', '&amp;lt;', '&amp;gt;', '&amp;amp;' ]);</pre>
</li><br /></ul>

<p><i>

</i></p>

<p><i>

</i></p>

<hr size="1" noshade />

<p>Return to <a href="/">Perl.com</a>.</p>







                                    </div>


                                </div>
                                <div class="asset-footer">

    
                                    <div class="entry-categories">
                                        <h4>Categories<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="/pub/perl-6/" rel="tag">Perl 6</a></li>
                                        </ul>
                                    </div>
    


                                    <div class="entry-tags">
                                        <h4>Tags<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?blog_id=2&amp;tag=pattern%20matching%20apocalypse&amp;limit=20';return false;" rel="tag">pattern matching apocalypse</a></li>
                                        </ul>
                                    </div>

                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2010/07/">July 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.02" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
