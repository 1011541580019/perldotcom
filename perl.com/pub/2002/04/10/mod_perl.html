<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/2002/04/10/mod_perl.html">
<dc:title>Installing mod_perl without superuser privileges</dc:title>
<dc:description> As you have seen from my previous articles, mod_perl enabled Apache consists of two main components: Perl modules and Apache itself. While installing Apache without root privileges is easy, one should know how to install Perl modules in a...</dc:description>
<dc:creator>Stas Bekman</dc:creator>
<dc:date>2002-04-10T00:00:00-08:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    
    <link rel="prev bookmark" href="/pub/2002/04/01/exegesis4.html" title="Exegesis 4" />
    <link rel="next bookmark" href="/pub/2002/04/16/axkit.html" title="XSP, Taglibs and Pipelines" />
    
    
    <title>Installing mod_perl without superuser privileges - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1284" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Installing mod_perl without superuser privileges</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Stas Bekman</span> on <abbr class="published" title="2002-04-10T00:00:00-08:00">April 10, 2002 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        

<p>As you have seen from my previous articles, mod_perl enabled Apache
consists of two main components: Perl modules and Apache itself.
While installing Apache without root privileges is easy,
one should know how to install Perl modules in a nonsystem-wide
location. In this article, I'll demonstrate ways to complete this
task.</p>

<p>In the examples, I'll use <em>stas</em> as a username,
and <em>/home/stas</em> as the home directory for that user.</p>

<h3><a name="installing perl modules into a directory of choice">Installing Perl Modules Into a Directory of Choice</a></h3>

<p>Since without superuser permissions you aren't allowed to install
modules into system directories such as <em>/usr/lib/perl5</em>, you need to
find out how to install the modules under your home directory.  It's
easy.</p>
<p>First, you have to decide where to install the modules.  The simplest
approach is to simulate the portion of the <em>/</em> file system relevant
to Perl under your home directory.  Actually we need only two
directories:</p>
<pre><code>
  /home/stas/bin
  /home/stas/lib</code></pre>
<p>We don't have to create them, since that will be done automatically
when the first module is installed.  Ninety-nine percent of the files will go into the
<em>lib</em> directory.  Occasionally, when some module distribution comes
with Perl scripts, these will go into the <em>bin</em> directory.  This
directory will be created if it doesn't exist.</p>

<p>Let's install the <em>CGI.pm</em> package, which includes a few other
<code>CGI::*</code> modules.  As usual, download the package from the CPAN
repository, unpack it and <code>chdir</code> to the newly created directory.</p>
<p>Now do a standard <code>perl Makefile.PL</code> to prepare a <em>Makefile</em>, but
this time tell <code>MakeMaker</code> to use your Perl installation directories
instead of the defaults.</p>
<pre><code>
  % perl Makefile.PL PREFIX=/home/stas</code></pre>
<p><code>PREFIX=/home/stas</code> is the only part of the installation process
that is different from usual.  Note that if you don't like how
<code>MakeMaker</code> chooses the rest of the directories, or if you are using
an older version that requires an explicit declaration of all
the target directories, then do this:</p>
<pre><code>
  % perl Makefile.PL PREFIX=/home/stas \
    INSTALLPRIVLIB=/home/stas/lib/perl5 \
    INSTALLSCRIPT=/home/stas/bin \
    INSTALLSITELIB=/home/stas/lib/perl5/site_perl \
    INSTALLBIN=/home/stas/bin \
    INSTALLMAN1DIR=/home/stas/lib/perl5/man  \
    INSTALLMAN3DIR=/home/stas/lib/perl5/man3</code></pre>
<p>The rest is as usual:</p>
<pre><code>
  % make
  % make test
  % make install</code></pre>
<p><code>make install</code> installs all the files in the private repository.
Note that all the missing directories are created automatically, so
there is no need to create them.  Here (slightly
edited) is what it does :</p>
<pre><code>
  Installing /home/stas/lib/perl5/CGI/Cookie.pm
  Installing /home/stas/lib/perl5/CGI.pm
  Installing /home/stas/lib/perl5/man3/CGI.3
  Installing /home/stas/lib/perl5/man3/CGI::Cookie.3
  Writing /home/stas/lib/perl5/auto/CGI/.packlist
  Appending installation info to /home/stas/lib/perl5/perllocal.pod</code></pre>
<p>If you have to use the explicit target parameters, then instead of a single
<code>PREFIX</code> parameter, you will find it useful to create a file called,
for example, <em>~/.perl_dirs</em> (where <em>~</em> is <code>/home/stas</code> in our
example) containing:</p>
<pre><code>
    PREFIX=/home/stas \
    INSTALLPRIVLIB=/home/stas/lib/perl5 \
    INSTALLSCRIPT=/home/stas/bin \
    INSTALLSITELIB=/home/stas/lib/perl5/site_perl \
    INSTALLBIN=/home/stas/bin \
    INSTALLMAN1DIR=/home/stas/lib/perl5/man  \
    INSTALLMAN3DIR=/home/stas/lib/perl5/man3</code></pre>
<p>From now on, any time you want to install Perl modules locally, you
simply execute:</p>
<pre><code>
  % perl Makefile.PL `cat ~/.perl_dirs`
  % make
  % make test
  % make install</code></pre>
<p>Using this method, you can easily maintain several Perl module
repositories.  For example, you could have one for production Perl and
another for development:</p>
<pre><code>
  % perl Makefile.PL `cat ~/.perl_dirs.production`</code></pre>
<p>or</p>
<pre><code>
  % perl Makefile.PL `cat ~/.perl_dirs.develop`</code></pre>
  


<h3><a name="making your scripts find the locally installed modules">Making Your Scripts Find the Locally Installed Modules</a></h3>
<p>Perl modules are generally placed in four main directories.  To find
these directories, execute:</p>
<pre><code>
  % perl -V</code></pre>
<p>The output contains important information about your Perl
installation.  At the end you will see:</p>
<pre><code>
  Characteristics of this binary (from libperl):
  Built under linux
  Compiled at Apr  6 1999 23:34:07
  @INC:
    /usr/lib/perl5/5.00503/i386-linux
    /usr/lib/perl5/5.00503
    /usr/lib/perl5/site_perl/5.005/i386-linux
    /usr/lib/perl5/site_perl/5.005
    .</code></pre>
    
 
<p>It shows us the content of the Perl special variable <code>@INC</code>, which is
used by Perl to look for its modules.  It is equivalent to the <code>PATH</code>
environment variable in Unix shells that is used to find executable
programs.</p>

<csperl file="grab" domain="on" record="b/832" template="b/article_sidebar2.view">

<p>Notice that Perl looks for modules in the <em>.</em> directory too, which
stands for the current directory. It's the last entry in the above
output.</p>
<p>Of course, this example is from version <em>5.00503</em> of Perl installed on
my x86 architecture PC running Linux.  That's why you see
<em>i386-linux</em> and <em>5.00503</em>.  If your system runs a different version
of Perl, operating system, processor or chipset architecture, then
some of the directories will have different names.</p>
<p>I also have a perl-5.6.1 installed under <code>/usr/local/lib/</code> so when
I do:</p>
<pre><code>
  % /usr/local/bin/perl5.6.1 -V</code></pre>
<p>I see:</p>
<pre><code>
  @INC:
    /usr/local/lib/perl5/5.6.1/i586-linux
    /usr/local/lib/perl5/5.6.1
    /usr/local/lib/site_perl/5.6.1/i586-linux
    /usr/local/lib/site_perl</code></pre>
    
<table width="150" border="0" cellspacing="0" cellpadding="4" align="right">
<tr> 
<td width="150" valign="top" height="4" bgcolor="#6699cc"></td></tr> 
<tr>
<td bgcolor="#efefef">
<p class="headline" align="center">Previously in the Series
</p>
<p class="secondary">
<a href="/pub/a/2002/03/22/modperl.html">mod_perl in 30 minutes</a><br /><br />
<a href="/pub/a/2002/02/26/whatismodperl.html">Why mod_perl?</a>


</td></tr> <tr><td width="150" valign="top" height="4" bgcolor="#6699cc"> </td></tr></table>
 
<p>Note that it's still <em>Linux</em>, but the newer Perl version uses the
version of my Pentium processor (thus the <em>i586</em> and not <em>i386</em>).
This makes use of compiler optimizations for Pentium processors when
the binary Perl extensions are created.</p>
<p>All the platform specific files, such as compiled C files glued to
Perl with <code>XS</code> or <code>SWIG</code>, are supposed to go into the
<code>i386-linux</code>-like directories.</p>
<p><strong>Important:</strong> As we have installed the Perl modules into nonstandard
directories, we have to let Perl know where to look for the four
directories.  There are two ways to accomplish this:  You can 
set the <code>PERL5LIB</code> environment variable or you can modify the
<code>@INC</code> variable in your scripts.</p>
<p>Assuming that we use perl-5.00503, in our example the directories are:</p>
<pre><code>
    /home/sbekman/lib/perl5/5.00503/i386-linux
    /home/sbekman/lib/perl5/5.00503
    /home/sbekman/lib/perl5/site_perl/5.005/i386-linux
    /home/sbekman/lib/perl5/site_perl/5.005</code></pre>
<p>As mentioned before, you find the exact directories by executing
<code>perl -V</code> and replacing the global Perl installation's base
directory with your home directory.</p>
<p>Modifying <code>@INC</code> is quite easy.  The best approach is to use the
<code>lib</code> module (pragma), by adding the following snippet at the top of
any of your scripts that require the locally installed modules.</p>
<pre><code>
  use lib qw(/home/stas/lib/perl5/5.00503/
             /home/stas/lib/perl5/site_perl/5.005);</code></pre>
<p>Another way is to write code to modify <code>@INC</code> explicitly:</p>
<pre><code>
  BEGIN {
    unshift @INC,
      qw(/home/stas/lib/perl5/5.00503
         /home/stas/lib/perl5/5.00503/i386-linux
         /home/stas/lib/perl5/site_perl/5.005
         /home/stas/lib/perl5/site_perl/5.005/i386-linux);
        }</code></pre>
<p>Note that with the <code>lib</code> module we don't have to list the
corresponding architecture specific directories, since it adds them
automatically if they exist (to be exact, when <em>$dir/$archname/auto</em>
exists).</p>
<p>Also, notice that both approaches <em>prepend</em> the directories to be
searched to <code>@INC</code>.  This allows you to install a more recent module
into your local repository and Perl will use it instead of the older
one installed in the main system repository.</p>


<p>Both approaches modify the value of <code>@INC</code> at compilation time.  The
<code>lib</code> module uses the <em>BEGIN</em> block as well, but internally.</p>















<p>Now, let's assume the following scenario.  I have installed the <code>LWP</code>
package in my local repository.  Now I want to install another module
(e.g. mod_perl) that has <code>LWP</code> listed in its prerequisites list.  I
know that I have <code>LWP</code> installed, but when I run <code>perl Makefile.PL</code>
for the module I'm about to install I'm told that I don't have <code>LWP</code>
installed.</p>
<p>There is no way for Perl to know that we have some locally installed
modules.  All it does is search the directories listed in <code>@INC</code>, and
since the latter contains only the default four directories (plus the
<em>.</em> directory), it cannot find the locally installed <code>LWP</code> package.
We cannot solve this problem by adding code to modify <code>@INC</code>, but
changing the <code>PERL5LIB</code> environment variable will do the trick.  If
you are using <code>t?csh</code> for interactive work, then do this:</p>
<pre><code>
  setenv PERL5LIB /home/stas/lib/perl5/5.00503:
  /home/stas/lib/perl5/site_perl/5.005</code></pre>
<p>It should be a single line with directories separated by colons (<code>:</code>)
and no spaces.  If you are a <code>(ba)?sh</code> user, then do this:</p>
<pre><code>
  export PERL5LIB=/home/stas/lib/perl5/5.00503:
  /home/stas/lib/perl5/site_perl/5.005</code></pre>
<p>Again, make it a single line.  If you use bash, then you can use multi-line
commands by terminating split lines with a backslash (<code>\</code>), like this:</p>
<pre><code>
  export PERL5LIB=/home/stas/lib/perl5/5.00503:\
  /home/stas/lib/perl5/site_perl/5.005</code></pre>
<p>As with <code>use lib</code>, Perl automatically prepends the architecture
specific directories to <code>@INC</code> if those exist.</p>
<p>When you have done this, verify the value of the newly configured
<code>@INC</code> by executing <code>perl -V</code> as before.  You should see the
modified value of <code>@INC</code>:</p>
<pre><code>
  % perl -V

  Characteristics of this binary (from libperl): 
  Built under linux
  Compiled at Apr  6 1999 23:34:07
  %ENV:
    PERL5LIB=&quot;/home/stas/lib/perl5/5.00503:
    /home/stas/lib/perl5/site_perl/5.005&quot;
  @INC:
    /home/stas/lib/perl5/5.00503/i386-linux
    /home/stas/lib/perl5/5.00503
    /home/stas/lib/perl5/site_perl/5.005/i386-linux
    /home/stas/lib/perl5/site_perl/5.005
    /usr/lib/perl5/5.00503/i386-linux
    /usr/lib/perl5/5.00503
    /usr/lib/perl5/site_perl/5.005/i386-linux
    /usr/lib/perl5/site_perl/5.005
    .</code></pre>
<p>When everything works as you want it to, add these commands to your
<em>.tcshrc</em> or <em>.bashrc</em> file.  The next time you start a shell, the
environment will be ready for you to work with the new Perl.</p>
<p>Note that if you have a <code>PERL5LIB</code> setting, then you don't need to alter
the <code>@INC</code> value in your scripts.  But if, for example, someone else
(who doesn't have this setting in the shell) tries to execute your
scripts, then Perl will fail to find your locally installed modules. The
best example is a crontab script that <em>might</em> use a different SHELL
environment and, therefore, the <code>PERL5LIB</code> setting won't be available
to it.</p>
<p>So the best approach is to have both the <code>PERL5LIB</code> environment
variable and the explicit <code>@INC</code> extension code at the beginning of
the scripts as described above.</p>

<h3><a name="the cpan.pm shell and locally installed modules">The CPAN.pm Shell and Locally Installed Modules</a></h3>
<p>The <code>CPAN.pm</code> shell saves a great deal of time when dealing
with the installation of Perl modules and keeping them up to date.  It does
the job for us, even detecting the missing modules listed in
prerequisites, fetching and installing them.  So you may wonder
whether you can use <code>CPAN.pm</code> to maintain your local repository as
well.</p>
<p>When you start the <code>CPAN</code> interactive shell, it searches first for
the user's private configuration file and then for the system-wide
one.  When I'm logged as user <code>stas</code>, the two files on my setup are:</p>
<pre><code>
    /home/stas/.cpan/CPAN/MyConfig.pm
    /usr/lib/perl5/5.00503/CPAN/Config.pm</code></pre>
<p>If there is no <code>CPAN</code> shell configured on your system, then when you start
the shell for the first time it will ask you a dozen configuration
questions and then create the <em>Config.pm</em> file for you.</p>
<p>If you already have it system-wide configured, then you should have a
<code>/usr/lib/perl5/5.00503/CPAN/Config.pm</code>.  If you have a different
Perl version, then alter the path to use your Perl's version number when
looking up the file.  Create the directory (<code>mkdir -p</code> creates the
whole path at once) where the local configuration file will go:</p>
<pre><code>
  % mkdir -p /home/stas/.cpan/CPAN</code></pre>
<p>Now copy the system wide configuration file to your local one.</p>
<pre><code>
  % cp /usr/lib/perl5/5.00503/CPAN/Config.pm \
  /home/stas/.cpan/CPAN/MyConfig.pm</code></pre>
<p>The only thing left is to change the base directory of <em>.cpan</em> in
your local file to the one under your home directory.  On my machine, I
replace <code>/usr/src/.cpan</code> (that's where my system's <code>.cpan</code> directory
resides) with <code>/home/stas</code>.  I use Perl, of course!</p>
<pre><code>
  % perl -pi -e 's|/usr/src|/home/stas|' \
  /home/stas/.cpan/CPAN/MyConfig.pm</code></pre>
<p>Now you have the local configuration file ready, you have to tell it
what special parameters you need to pass when executing the <code>perl
Makefile.PL</code> stage.</p>
<p>Open the file in your favorite editor and replace line:</p>
<pre><code>
  'makepl_arg' =&gt; q[],</code></pre>
<p>with:</p>
<pre><code>
  'makepl_arg' =&gt; q[PREFIX=/home/stas],</code></pre>
<p>Now you've finished the configuration.  Assuming that you are logged
in as the same user you have prepared the local installation for
(<em>stas</em> in our example), start it like this:</p>
<pre><code>
  % perl -MCPAN -e shell</code></pre>
<p>From now on, any module you try to install will be installed locally.
If you need to install some system modules, then just become the superuser
and install them in the same way.  When you are logged in as the
superuser, the system-wide configuration file will be used instead of
your local one.</p>
<p>If you have used more than just the <code>PREFIX</code> variable, then modify
<em>MyConfig.pm</em> to use them.  For example, if you have used these
variables:</p>
<pre><code>
    perl Makefile.PL PREFIX=/home/stas \
    INSTALLPRIVLIB=/home/stas/lib/perl5 \
    INSTALLSCRIPT=/home/stas/bin \
    INSTALLSITELIB=/home/stas/lib/perl5/site_perl \
    INSTALLBIN=/home/stas/bin \
    INSTALLMAN1DIR=/home/stas/lib/perl5/man  \
    INSTALLMAN3DIR=/home/stas/lib/perl5/man3</code></pre>
<p>then replace <code>PREFIX=/home/stas</code> in the line:</p>
<pre><code>
  'makepl_arg' =&gt; q[PREFIX=/home/stas],</code></pre>
<p>with all the variables from above, so that the line becomes:</p>
<pre><code>
  'makepl_arg' =&gt; q[PREFIX=/home/stas \
    INSTALLPRIVLIB=/home/stas/lib/perl5 \
    INSTALLSCRIPT=/home/stas/bin \
    INSTALLSITELIB=/home/stas/lib/perl5/site_perl \
    INSTALLBIN=/home/stas/bin \
    INSTALLMAN1DIR=/home/stas/lib/perl5/man  \
    INSTALLMAN3DIR=/home/stas/lib/perl5/man3],</code></pre>
<p>If you arrange all the above parameters in one line, then you can remove
the backslashes (<code>\</code>).</p>













<h3><a name="making a local apache installation">Making a Local Apache Installation</a></h3>
<p>Just like with Perl modules, if you don't have permissions to install
files into the system area, then you have to install them locally under your
home directory.  It's almost the same as a plain installation, but you
have to run the server listening to a port number greater than 1024,
since only root processes can listen to lower-numbered ports.</p>
<p>Another important issue you have to resolve is how to add startup and
shutdown scripts to the directories used by the rest of the system
services.  You will have to ask your system administrator to assist
you with this issue.</p>
<p>To install Apache locally, all you have to do is to tell <code>.configure</code>
in the Apache source directory what target directories to use.  If you
are following the convention that I use, which makes your home
directory look like the <code>/</code> (base) directory, then the invocation
parameters would be:</p>
<pre><code>
  ./configure --prefix=/home/stas</code></pre>
<p>Apache will use the prefix for the rest of its target directories
instead of the default <code>/usr/local/apache</code>.  If you want to see what
they are, then before you proceed add the <em>--show-layout</em> option:</p>
<pre><code>
  ./configure --prefix=/home/stas --show-layout</code></pre>
<p>You might want to put all the Apache files under <code>/home/stas/apache</code>
following Apache's convention:</p>
<pre><code>
  ./configure --prefix=/home/stas/apache</code></pre>
<p>If you want to modify some or all of the names of the automatically
created directories:</p>
<pre><code>
  ./configure --prefix=/home/stas/apache \
    --sbindir=/home/stas/apache/sbin
    --sysconfdir=/home/stas/apache/etc
    --localstatedir=/home/stas/apache/var \
    --runtimedir=/home/stas/apache/var/run \
    --logfiledir=/home/stas/apache/var/logs \
    --proxycachedir=/home/stas/apache/var/proxy</code></pre>
<p>That's all!</p>
<p>Also remember that you can start the script only under a user and
group you belong to.  You must set the <code>User</code> and <code>Group</code> directives
in <em>httpd.conf</em> to appropriate values.</p>

<h3><a name="manual local mod_perl enabled apache installation">Manual Local mod_perl Enabled Apache Installation</a></h3>
<p>Now that we have learned how to install local Apache and Perl modules
separately, let's see how to install mod_perl enabled Apache in our
home directory.  It's almost as simple as doing each one separately,
but there is one wrinkle you need to know about that I'll mention at
the end of this section.</p>
<p>Let's say you have unpacked the Apache and mod_perl sources under
<em>/home/stas/src</em> and they look like this:</p>
<pre><code>
  % ls /home/stas/src
  /home/stas/src/apache_x.x.x
  /home/stas/src/mod_perl-x.xx</code></pre>
<p>where <em>x.xx</em> are the version numbers as usual.  You want the Perl
modules from the mod_perl package to be installed under
<em>/home/stas/lib/perl5</em> and the Apache files to go under
<em>/home/stas/apache</em>.  The following commands will do that for you:</p>
<pre><code>
  % perl Makefile.PL \
  PREFIX=/home/stas \
  APACHE_PREFIX=/home/stas/apache \
  APACHE_SRC=../apache_x.x.x/src \
  DO_HTTPD=1 \
  USE_APACI=1 \
  EVERYTHING=1
  % make &amp;&amp; make test &amp;&amp; make install 
  % cd ../apache_x.x.x
  % make install</code></pre>
<p>If you need some parameters to be passed to the <code>.configure</code> script,
as we saw in the previous section, then use <code>APACI_ARGS</code>.  For example:</p>
<pre><code>
  APACI_ARGS='--sbindir=/home/stas/apache/sbin, \
    --sysconfdir=/home/stas/apache/etc, \
    --localstatedir=/home/stas/apache/var, \
    --runtimedir=/home/stas/apache/var/run, \
    --logfiledir=/home/stas/apache/var/logs, \
    --proxycachedir=/home/stas/apache/var/proxy'</code></pre>
<p>Note that the above multi-line splitting will work only with <code>bash</code>,
<code>tcsh</code> users will have to list all the parameters on a single line.</p>
<p>Basically the installation is complete.  The only remaining problem is
the <code>@INC</code> variable.  This won't be correctly set if you rely on the
<code>PERL5LIB</code> environment variable unless you set it explicitly in a
startup file that is <code>require</code>'d before loading any other module
that resides in your local repository.  A much nicer approach is to
use the <code>lib</code> pragma as we saw before, but in a slightly different
way -- we use it in the startup file and it affects all the code that
will be executed under mod_perl handlers.  For example:</p>
<pre><code>
  PerlRequire /home/stas/apache/perl/startup.pl</code></pre>
<p>where <code>startup.pl</code> starts with:</p>
<pre><code>
  use lib qw(/home/stas/lib/perl5/5.00503/
             /home/stas/lib/perl5/site_perl/5.005);</code></pre>
<p>Note that you can still use the hard-coded <code>@INC</code> modifications in
the scripts themselves, but be aware that scripts modify <code>@INC</code> in
<code>BEGIN</code> blocks and mod_perl executes the <code>BEGIN</code> blocks only when it
performs script compilation.  As a result, <code>@INC</code> will be reset to
its original value after the scripts are compiled and the hard-coded
settings will be forgotten.</p>
<p>The only place you can alter the ``original'' value is during the server
configuration stage either in the startup file or by putting</p>
<pre><code>
  PerlSetEnv Perl5LIB \
  /home/stas/lib/perl5/5.00503/:/home/stas/lib/perl5/site_perl/5.005</code></pre>
<p>in <em>httpd.conf</em>, but the latter setting will be ignored if you use
the <code>PerlTaintcheck</code> setting, and I hope you do use it.</p>
<p>The remainder of the mod_perl configuration and use is just the same as if
you were installing mod_perl as a superuser.</p>

<h3><a name="local mod_perl enabled apache installation with cpan.pm">Local mod_perl Enabled Apache Installation with CPAN.pm</a></h3>
<p>Assuming that you have configured <code>CPAN.pm</code> to install Perl modules
locally as explained earlier in this article, the installation is 
simple.  Start the <code>CPAN.pm</code> shell, set the arguments to be passed to
<code>perl Makefile.PL</code> (modify the example setting to suit your needs),
and tell &lt;CPAN.pm&gt; to do the rest for you:</p>
<pre><code>
  % perl -MCPAN -eshell
  cpan&gt; o conf makepl_arg 'DO_HTTPD=1 USE_APACI=1 EVERYTHING=1 \
        PREFIX=/home/stas APACHE_PREFIX=/home/stas/apache'
  cpan&gt; install mod_perl</code></pre>
<p>When you use <code>CPAN.pm</code> for local installations, after the mod_perl
installation is complete, you must make sure that the value of
<code>makepl_arg</code> is restored to its original value.</p>
<p>The simplest way to do this is to quit the interactive shell by typing
<em>quit</em> and re-entering it. But if you insist, then here is how to make it work
without quitting the shell. You really want to skip this :)</p>
<p>If you want to continue working with <code>CPAN</code> *without* quitting the
shell, then you must:</p>

<table width="150" border="0" cellspacing="0" cellpadding="4" align="right">
<tr> 
<td width="150" valign="top" height="4" bgcolor="#6699cc"></td></tr> 
<tr>
<td bgcolor="#efefef">
<p class="headline" align="center">Previously in the Series
</p>
<p class="secondary">
<a href="/pub/a/2002/03/22/modperl.html">mod_perl in 30 minutes</a><br /><br />
<a href="/pub/a/2002/02/26/whatismodperl.html">Why mod_perl?</a>


</td></tr> <tr><td width="150" valign="top" height="4" bgcolor="#6699cc"> </td></tr></table>
<ol>
<li><strong><a name="item_remember_the_value_of_makepl_arg">remember the value of <code>makepl_arg</code></a></strong><br>

<li><strong><a name="item_change_it_to_suit_your_new_installation">change it to suit your new installation</a></strong><br>

<li><strong><a name="item_build_and_install_mod_perl">build and install mod_perl</a></strong><br>

<li><strong><a name="item_restore_it_after_completing_mod_perl_installation">restore it after completing mod_perl installation</a></strong><br>

</ol>
<p>this is quite a cumbersome task as of this writing, but I believe that
<code>CPAN.pm</code> will eventually be improved to handle this more easily.</p>
<p>So if you are still with me, then start the shell as usual:</p>
<pre><code>
  % perl -MCPAN -eshell</code></pre>
<p>First, read the value of the <code>makepl_arg</code>:</p>
<pre><code>
  cpan&gt; o conf makepl_arg</code></pre>
<pre><code>
  PREFIX=/home/stas</code></pre>
<p>It will be something like <code>PREFIX=/home/stas</code> if you configured
<code>CPAN.pm</code> to install modules locally.  Save this value:</p>
<pre><code>
  cpan&gt; o conf makepl_arg.save PREFIX=/home/stas</code></pre>
<p>Second, set a new value, to be used by the mod_perl installation
process.  (You can add parameters to this line, or remove them,
according to your needs.)</p>
<pre><code>
  cpan&gt; o conf makepl_arg 'DO_HTTPD=1 USE_APACI=1 EVERYTHING=1 \
        PREFIX=/home/stas APACHE_PREFIX=/home/stas/apache'</code></pre>
<p>Third, let &lt;CPAN.pm&gt; build and install mod_perl for you:</p>
<pre><code>
  cpan&gt; install mod_perl</code></pre>
<p>Fourth, reset the original value to <code>makepl_arg</code>.  We do this by
printing the value of the saved variable and assigning it to
<code>makepl_arg</code>.</p>
<pre><code>
  cpan&gt; o conf makepl_arg.save</code></pre>
<pre><code>
  PREFIX=/home/stas</code></pre>
<pre><code>
  cpan&gt; o conf makepl_arg PREFIX=/home/stas</code></pre>
<p>Not so neat, but a working solution.  You could have written the value
on a piece of paper instead of saving it to <code>makepl_arg.save</code>, but
you are more likely to make a mistake that way.</p>

<h3><a name="references">References</a></h3>
<ul>
<li>
The Apache site's URL: <a href="http://www.apache.org">http://www.apache.org</a>
<p></p>
<li>
The mod_perl site's URL: <a href="http://perl.apache.org">http://perl.apache.org</a>
<p></p>
<li>
CPAN is the Comprehensive Perl Archive Network. The Master site's URL
is <a href="http://cpan.org/.">http://cpan.org/.</a> CPAN is mirrored at more than 100 sites
worldwide. (http://cpan.org/SITES.html)
<p></p></ul>






                                    </div>


                                </div>
                                <div class="asset-footer">


                                    <div class="entry-tags">
                                        <h4>Tags<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=mod_perl%20superuser%20root&amp;limit=20';return false;" rel="tag">mod_perl superuser root</a></li>
                                        </ul>
                                    </div>

                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
