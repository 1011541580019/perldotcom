<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: February 2002 Archives</title>


    <link rel="prev" href="/pub/2002/01/" title="January 2002" />
    <link rel="next" href="/pub/2002/03/" title="March 2002" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">February 2002 Archives</h1>





                            
                            <div id="entry-1262" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/02/26/whatismodperl.html" rel="bookmark">Why mod_perl?</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Stas Bekman</span> on <abbr class="published" title="2002-02-26T00:00:00-08:00">February 26, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
             

<p>In this article, I'll give an initial introduction to mod_perl, make
you want to give it a try and present a few examples of the well-known
sites that are powered by mod_perl enabled Apache.</p>

<h3><a name="what is mod_perl">What Is mod_perl?</a></h3>

<p>mod_perl is at the heart of the Apache/Perl integration project, which
brings together the full power of the Perl programming language and
the Apache Web server.</p>

<p>From the outset, Apache was designed so that you can extend it by the
addition of ``modules.''  Modules can do anything you need to do, such
as rewrite HTTP requests, restrict access to certain pages and perform
database lookups.  Modules are normally written in C, which
can be hard work.  mod_perl is a module that allows you to do all of these
things, and more, by using Perl -- making the development much
quicker than C.  Apache is the most popular Web server on the Internet
and mod_perl is one of the most popular modules for extending it.</p>


<h3><a name="why is mod_perl so popular">Why Is mod_perl So Popular?</a></h3>

<p>If you love Perl and your favorite Web server is Apache, then you will love
mod_perl at first sight. Once you try it in action, you will never look
back -- you will find mod_perl has everything you need.  But even if you
do find that there is something missing, then just speak up.  Before you
can count to three, someone will have made it for you. Which, of course,
will make you want to give something in return. Eventually you will
contribute something on your own, and that will save time for a huge
mod_perl community so that they can create even more things for others
to use.</p>
<csperl file="grab" domain="on" record="b/832" template="b/article_sidebar.view">

<p>You get the picture -- mod_perl empowers its users, who in turn
empower mod_perl, which in turn empowers its users, who in
turn ... . It's as simple as the nuclear reaction you learned about at
school, or will learn at some point :)</p>
<p>With mod_perl it is possible to write Apache modules entirely in Perl. This allows you to easily do things that are more difficult or impossible
in regular CGI programs, such as running sub-requests, writing your
authentication and logging handlers.</p>
<p>The primary advantages of mod_perl are power and speed. You have full
access to the inner workings of the Web server and you can intervene
at any stage of HTTP request processing. This allows for customized
processing of the various phases; for example, URI to filename
translation, authorization, response generation and logging.</p>
<p>There are big savings in startup and compilation times.  Having the
Perl interpreter embedded in the server saves the very considerable
overhead of starting an external interpreter for any HTTP request
that needs to run Perl code. At least as important is code caching:
the modules and scripts are loaded and compiled only once, when the
server is first started.  Then for the rest of the server's life the
scripts are served from the cache, so the server only has to run the
pre-compiled code.  In many cases, this is as fast as running compiled C
programs.</p>
<p>There is little run-time overhead. In particular, under mod_perl,
there is no need to start a separate process per request, as is often
done with other Web-server extensions. The most wide-spread such
extension mechanism, the Common Gateway Interface (CGI), is replaced
entirely with Perl code that handles the response generation phase of
request processing. Bundled with mod_perl are two general purpose
modules for this purpose: <code>Apache::Registry</code>, which can transparently
run existing unmodified Perl CGI scripts and <code>Apache::PerlRun</code>, which
does a similar job but allows you to run scripts that are to some
extent ``dirtier.''</p>
<p>mod_perl allows you to configure your Apache server and handlers in
Perl (using the <code>PerlSetVar</code> directive and the &lt;Perl&gt;
sections). This makes the administration of servers with many virtual
hosts and complex configuration a piece of cake. Hey, you can even
define your own configuration directives!</p>


<h3><a name="how fast and stable is mod_perl">How Fast and Stable Is mod_perl?</a></h3>
<p>Many people ask, ``How much of a performance improvement does mod_perl
give?'' Well, it all depends on what you are doing with mod_perl --
and possibly whom you ask. Developers report speed boosts from 200 percent to
2,000 percent. The best way to measure is to try it and see for yourself! (see
<a href="http://perl.apache.org/tidbits.html">http://perl.apache.org/tidbits.html</a> and
<a href="http://perl.apache.org/stories/">http://perl.apache.org/stories/</a> for the facts).</p>
<p>Every second of every day, thousands of Web sites all over the world
are using mod_perl to serve hundreds of thousands of Web pages.
Apache and mod_perl are some of the best-tested programs ever written.
Of course, they are continually being developed and improved, but you
do not have to work on the ``bleeding edge'' of development -- you can
use the stable products for your sites and let others do the testing
of the new versions for you.</p>
<p>I want to show you just a few of the many busy and popular sites
that are driven by mod_perl. A thousand words can't substitute the
experience. Visit the sites and feel the difference. They will
persuade you that mod_perl rules!</p>
<ul>
<li>
<strong>ValueClick</strong> -- <a href="http://www.valueclick.com/">http://www.valueclick.com/</a> serves more than 70 million
requests per day from about 20 machines.  Each response is dynamic,
with all sorts of calculation, storing, logging, counting -- you name
it. <strong>All</strong> of their ``application'' programming is done in Perl.</li>
<p></p>
<li>
<strong>Singles Heaven</strong> -- <a href="http://singlesheaven.com">http://singlesheaven.com</a> is a <strong>Match Maker</strong> site
with 35,000+ members and growing. The site is driven by mod_perl, DBI,
<code>Apache::DBI</code> (which provides a persistence to DB connections) and
MySQL. The speed is enormous, chatting with mod_perl is a
pleasure. Every page is generated by about 10 SQL queries, for it does
many dynamic checks on every page -- like checking for new e-mails,
users who are watched by various watchdogs and many more. You don't
feel these queries are actually happening, the speed is as fast as the
<em>"Hello World'"</em> script.</li>
<p></p>
<li>
<strong>Internet Movie Database (Ltd)</strong> -- <a href="http://www.moviedatabase.com/">http://www.moviedatabase.com/</a> -
serves about 2 million page views per day. All database lookups are
handled inside Apache via mod_perl. Each request also goes through
several mod_perl handlers and the output is then reformatted on the
fly with mod_perl SSI to embed advertising banners and give different
views of the site depending on the hostname used.</li>
<p></p>
<li>
<strong>CMPnet</strong> -- <a href="http://www.cmpnet.com,">http://www.cmpnet.com,</a> a technology information network
serves about 600k page views per day.</li>
<p></p>
<li>
<strong>CitySearch.com</strong> -- <a href="http://www.citysearch.com/">http://www.citysearch.com/</a> is providing online
city guides for more than 100 cities worldwide, citysearch.com helps
people find and plan what they want to do and then lets them take
action, offering local transactions such as buying event tickets and
making hotel and restaurant reservations online. Its traffic exceeds
100 million page views a month.</li>
</ul>

<h3><a name="how many sites are running a mod_perl enabled apache webserver">How Many Sites Are Running a mod_perl Enabled Apache Web Server?</a></h3>
<p>According to Netcraft ( <a href="http://netcraft.com">http://netcraft.com</a> ), as of August 2001 - 18
million hosts are running the free Apache Web server, which is about
60 percent of all checked in survey hosts!</p>
<a href="http://www.netcraft.com/survey/">Here is the
graph</a> of "Server Share in Internet Web Sites."<p>What about mod_perl? <a href="http://perl.apache.org/netcraft/">http://perl.apache.org/netcraft/</a> reports that
sites running mod_perl account for 2,823,060 host names and 283,180
unique IP addresses. This is actually an underestimate, since when
hosts are scanned for running Web servers only well-known ports are
checked (80, 81, 8080 and a few others). If a server runs on unusual
port, then it does not enter the count unless the owner has manually added
it to the Netcraft database. Here is a graph of the growth in mod_perl
usage:</p>
<img src="/pub/2002/02/26/graphics/mod_perl.jpg" height="257" width="450" border="0"
alt="mod_perl growth graph"><p>For the latest numbers see <a href="http://perl.apache.org/netcraft/">http://perl.apache.org/netcraft/</a> .</p>


<h3><a name="the road ahead">The Road Ahead</a></h3>
<p>You probably are excited about the release of Apache 2.0, the next
generation of the best Web server. The major new features of this new
generation of the Web server are threaded processes, which should make
the server more scalable, and, of course, the very-welcomed filtering
layer.</p>
<p>You probably are not less excited about the recent release of Perl
5.6, whose main new feature is (almost) stable support for threads,
something that existed in the previous Perl version but which was
quite shaky.</p>
<p>What has all this to do with mod_perl you ask? mod_perl 2.0 is being
developed at this very moment and will benefit enormously from the new
Apache and Perl features. The most important improvement will be a
reduced process size -- a parsed Perl opcodes tree will be almost
completely shared between threads of the same process.</p>
<p>Do you believe in coincidences? Both Perl 5.6 and Apache 2.0 were
released in the same week in March 2000. Looks very suspicious to
me. If you get the obvious conspiracy uncovered, then please let me know.</p>
<p>Of course, there are lots of bumps ahead of us. It will take time
before all our applications will be able to benefit from the threading
features. The main reason lies in fact that most of the Perl modules
available from CPAN aren't thread safe. But you shouldn't despair. You
can turn off threads for Perl code that is not thread safe or that
uses modules that aren't thread safe.</p>


<h3><a name="i want mod_perl now, where do i get it">I Want mod_perl Now, Where Do I Get It?</a></h3>
<p>mod_perl's home is <a href="http://perl.apache.org">http://perl.apache.org</a>.  From the site you will be
able to download the latest mod_perl software and various
documentation; find commercial products and free third-party modules;
read the success stories; and learn more about mod_perl.</p>
<p>It's quite important to get yourself subscribed to the mod_perl
list. If you want know what happens with mod_perl, if you want to know
what new features are being developed, if you want to influence and
contribute or if you simply want to get help, then you don't want to
skip this mailing list. To subscribe to the list send an empty e-mail
to <a href="mailto:modperl-subscribe@apache.org">modperl-subscribe@apache.org</a> .</p>


<h3><a name="are there any mod_perl books and documentation">Are There Any mod_perl Books and Documentation?</a></h3>
Lincoln Stein and Doug MacEachern wrote <a
href="http://www.modperl.com/"><b>Writing Apache Modules with Perl and
C</b></a> . It can be purchased online from <a
href="http://www.ora.com/catalog/wrapmod/">O'Reilly </a> and <a
href="http://www.amazon.com/exec/obidos/ASIN/156592567X/writinapachemodu">
Amazon.com</a>.<p>You will find a vast list of mod_perl documentation on the mod_perl
home page: <a href="http://perl.apache.org/">http://perl.apache.org/</a> .</p>


<h3><a name="i love mod_perl, i want to know who wrote this great free product!">I Love mod_perl, I Want to Know Who Wrote This Great Free Product!</a></h3>
<p>Well, Doug MacEachern is the person to blame :).  He is the guy who
gave mod_perl to the mod_perl community. He is the Linus of the
mod_perl project.</p>
<p>But as you know in a big community, there are always people who love to
help, and there is a bunch of developers from all around the world who
patch mod_perl, develop entire Perl modules for it, debug the server
and advocate it. I'm afraid the list of contributing developers is too
long to include here. But you are welcome to join the mod_perl mailing
list and see all these folks in action. I promise you, you won't
regret the show, since you are going to learn much more than just
about mod_perl. See for yourself.</p>


<h3><a name="getting involved">Getting Involved</a></h3>
<p>If you are using mod_perl or planning to use it, then it's a good idea to
subscribe to the users mod_perl mailing list. You should send an empty
e-mail to <a href="mailto:modperl-subscribe@apache.org">modperl-subscribe@apache.org</a> in order to do that.</p>
<p>If you are interested in helping out with development of mod_perl 2.0,
then you are welcome to join us. There are many features that are still
need implementing and a lot of testing has to be done. So there is a
lot of work if you are knowledgeable developer or even if you just a
newbie. And the more help we get the sooner we bring mod_perl 2.0 into
production shape. You can subscribe to the developers mailing list by
sending an e-mail to <a href="mailto:dev-subscribe@perl.apache.org">dev-subscribe@perl.apache.org</a>.</p>
<p>If you are familiar with mod_perl, then you probably know about the big fat
mod_perl guide that I maintain with help of many people
(http://perl.apache.org/guide/). However, mod_perl 2.0 has quite a few
things changed so the new documentation project has been started. You
are welcome to check the updates on the <a href="http://perl.apache.org/">http://perl.apache.org/</a> site
and subscribe to the documentation mailing list to stay up to date by
sending e-mail to <a href="mailto:docs-dev-subscribe@perl.apache.org">docs-dev-subscribe@perl.apache.org</a> .</p>


<h3><a name="references">References</a></h3>
<ul>
<li>
The Apache site's URL: <a href="http://www.apache.org/">http://www.apache.org/</a>
<p></p>
<li>
The mod_perl site's URL: <a href="http://perl.apache.org/">http://perl.apache.org/</a>
<p></p>
<li>
CPAN is the Comprehensive Perl Archive Network. The Master site's URL
is <a href="http://cpan.org/.">http://cpan.org/.</a> CPAN is mirrored at more than 100 sites
worldwide. (http://cpan.org/SITES.html)
<p></p></ul>








        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1260" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/02/20/css.html" rel="bookmark">Preventing Cross-site Scripting Attacks</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Paul Lindner</span> on <abbr class="published" title="2002-02-20T00:00:00-08:00">February 20, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
                <h3>Introduction</h3>
    <p>
      The cross-site scripting attack is one of the most common, yet
      overlooked, security problems facing web developers today.  A web
      site is vulnerable if it displays user-submitted content without
      checking for malicious script tags.  
    </p>
    <p>
      Luckily, Perl and mod_perl provide us with easy solutions to
      this problem.  We highlight these built-in solutions and also a
      introduce a new mod_perl module: <i>Apache::TaintRequest</i>.
      This module helps you secure mod_perl applications by applying
      perl's powerful "tainting" rules to HTML output.
    </p>

    <h3>What is "Cross-Site Scripting"?</h3>
    
    <p>
      Lately the news has been full of reports on web site security lapses.
      Some recent headlines include the following grim items:

      <a href="http://news.cnet.com/news/0-1003-200-7764433.html">
	Security problems open Microsoft's Wallet</a>, 
      <a href="http://news.cnet.com/news/0-1007-200-4030388.html">
	Schwab financial site vulnerable to attack</a>, or
      <a href="http://techupdate.zdnet.com/techupdate/stories/main/0,14179,2808729,00.html">
	New hack poses threat to popular Web services</a>.  In all
	these cases the root problem was caused by a <i>Cross-Site
	Scripting</i> attack.  Instead of targeting holes in your
	server's operating system or web server software, the attack
	works directly against the users of your site.  It does this
	by tricking a user into submitting web scripting code
	(JavaScript, Jscript, etc.) to a dynamic form on the targeted
	web site.  If the web site does not check for this scripting
	code it may pass it verbatim back to the user's browser where
	it can cause all kinds of damage.
    </p>
    <p>
      Consider the following URL:</p>

    <blockquote>
      <code>http://www.example.com/search.pl?text=&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code>
    </blockquote>

    <p>
      If an attacker can get us to select a link like this,and the
      Web application does not validate input, then our browser will
      pop up an alert showing our current set of cookies.This
      particular example is harmless; an attacker can do much more
      damage, including stealing passwords, resetting your home
      page, or redirecting you to another Web site.
    </p>
    <p>
      Even worse, you might not even need to select the link for this to
      happen.  If the attacker can make your application display a 
      chunk of html, you're in trouble.  Both the <b>IMG</b> and
      <b>IFRAME</b> tags allow for a new URL to load when html is displayed.
      For example the following HTML chunk is sent by the 
      <a href="http://www.cert.org/incident_notes/IN-2001-14.html">BadTrans</a>
      Worm.  This worm uses the load-on-view feature provided by the IFRAME tag
      to infect systems running Outlook and Outlook Express.
    </p>
    <pre><code>
  --====_ABC1234567890DEF_====
  Content-Type: multipart/alternative;
           boundary="====_ABC0987654321DEF_===="

  --====_ABC0987654321DEF_====
  Content-Type: text/html;
           charset="iso-8859-1"
  Content-Transfer-Encoding: quoted-printable


  &lt;HTML&gt;&lt;HEAD&gt;&lt;/HEAD&gt;&lt;BODY bgColor=3D#ffffff&gt;
  &lt;iframe src=3Dcid:EA4DMGBP9p height=3D0 width=3D0&gt;
  &lt;/iframe&gt;&lt;/BODY&gt;&lt;/HTML&gt;
  --====_ABC0987654321DEF_====--

  --====_ABC1234567890DEF_====
  Content-Type: audio/x-wav;
           name="filename.ext.ext"
  Content-Transfer-Encoding: base64
  Content-ID: &lt;EA4DMGBP9p&gt;</code>
</pre>

    <p>
      This particular example results in executable code running on the
      target computer.   The attacker could just as easily insert HTML
      using the URL format described earlier, like this:
    </p>
    <blockquote><code>
      &lt;iframe src="http://www.example.com/search.pl?text=&lt;script&gt;alert(document.cookie)&lt;/script&gt;"&gt;</code>
    </blockquote>

    <p>
      The "cross-site" part of "cross-site scripting" comes into
      play when dealing with the web browser's internal restrictions
      on cookies.  The JavaScript interpreter built into modern web
      browsers only allows the originating site to access it's own
      private cookies.  By taking advantage of poorly coded scripts
      the attacker can bypass this restriction.
    </p>
    
    <p>
      Any poorly coded script, written in Perl or otherwise, is a
      potential target.  The key to solving cross-site scripting
      attacks is to never, ever trust data that comes from the web
      browser.  Any input data should be considered guilty unless
      proven innocent.
    </p>
    
    <h3>Solutions</h3>
    
    <p>
      There are a number of ways of solving this problem for Perl and
      mod_perl systems.  All are quite simple, and should be used
      everywhere there might be the potential for user submitted data
      to appear on the resulting web page.
    </p>
    
    <p>
      Consider the following script <i>search.pl</i>.  It is a simple
      CGI script that takes a given parameter named 'text' and prints
      it on the screen.
    </p>

    <pre><code>
        #!/usr/bin/perl
        use CGI;

        my $cgi = CGI->new();
        my $text = $cgi->param('text');

        print $cgi->header();
        print "You entered $text";
</code></pre>

    <p>
      This script is vulnerable to cross-site scripting attacks
      because it blindly prints out submitted form data.  To rid
      ourselves of this vulnerability we can either perform input
      validation, or insure that user-submitted data is always HTML
      escaped before displaying it.</p> 

    <p>We can add input validation to our script by inserting the
    following line of code before any output.  This code eliminates
    everything but letters, numbers, and spaces from the submitted
    input.
    </p>

    <pre><code>
        $text =~ s/[^A-Za-z0-9 ]*/ /g;
</code></pre>

    <p>
      This type of input validation can be quite a chore.  Another
      solution involves escaping any HTML in the submitted data.  We
      can do this by using the HTML::Entities module bundled in the
      libwww-perl CPAN distribution.  The HTML::Entities module
      provides the function HTML::Entities::encode().  It encodes HTML
      characters as HTML entity references.  For example, the character
      <b>&lt;</b> is converted to <b>&amp;lt;</b>, <b>&quot;</b> is
      converted to <b>&amp;quot;</b>, and so on.  Here is a version of
      <i>search.pl</i> that uses this new feature.
    </p>

    <pre><code>
        #!/usr/bin/perl
        use CGI;
        use HTML::Entities;

        my $cgi = CGI->new();
        my $text = $cgi->param('text');

        print $cgi->header();
        print "You entered ", HTML::Entities::encode($text);
</code></pre>


    <h3>Solutions for mod_perl</h3>

    <p>
      All of the previous solutions apply to the mod_perl programmer
      too.  An Apache::Registry script or mod_perl handler can use the
      same techniques to eliminate cross-site scripting holes. For
      higher performance you may want to consider switching calls from
      HTML::Entities::encode() to mod_perl's much faster
      Apache::Util::escape_html() function.  Here's an example of an
      Apache::Registry script equivilant to the preceding
      <I>search.pl</I> script.
    </p>
<pre><code>
        use Apache::Util;
        use Apache::Request;

        my $apr = Apache::Request->new(Apache->request);

        my $text = $apr->param('text');

        $r->content_type("text/html");
        $r->send_http_header;
        $r->print("You entered ", Apache::Util::html_encode($text));
</code></pre>

   <p>
      After a while you may find that typing
      Apache::Util::html_encode() over and over becomes quite tedious,
      especially if you use input validation in some places, but not
      others.  To simplify this situation consider using the
      Apache::TaintRequest module.  This module is available from CPAN
      or from the <a href="http://www.modperlcookbook.org/">mod_perl
      Developer's Cookbook</a> web site.
    </p>

    <p>
      Apache::TaintRequest automates the tedious process of HTML
      escaping data.  It overrides the print mechanism in the mod_perl
      Apache module.  The new <I>print</I> method tests each chunk of text
      for taintedness.  If it is tainted the module assumes the worst and
      html-escapes it before printing.  
    </p>
    <p>
      Perl contains a set of built-in security checks know as <i>taint
      mode</i>.  These checks protect you by insuring that
      <i>tainted</i> data that comes from somewhere outside your
      program is not used directly or indirectly to alter files,
      processes, or directories. Apache::TaintRequest extends this
      list of <i>dangerous</i> operations to include printing HTML to
      a web client. To <i>untaint</i> your data just process it with a
      regular expression.  Tainting is the Perl web developer's most
      powerful defense against security problems.  Consult the
      <b>perlsec</b> man page and use it for every web application you
      write.
    <p>
      To activate Apache::TaintRequest simply add the following
      directive to your httpd.conf.
    </p>
    <pre>       PerlTaintCheck on    </pre>
    <p>
      This activates taint mode for the entire mod_perl server.
    </p>
    <p>
      The next thing we need to do modify our script or handler to use
      Apache::TaintRequest instead of Apache::Request.  The preceding
      script might look like this:
    </p>
    <pre><code>
        use Apache::TaintRequest;

        my $apr = Apache::TaintRequest->new(Apache->request);

        my $text = $apr->param('text');

        $r->content_type("text/html");
        $r->send_http_header;

        $r->print("You entered ", $text);

        $text =~ s/[^A-Za-z0-9 ]//;
        $r->print("You entered ", $text);
</code></pre>

    <p>
      This script starts by storing the tainted form data 'text' in
      $text.  If we print this data we will find that it is
      automatically HTML escaped.  Next we do some input validation on
      the data.  The following print statement does not result in any
      HTML escaping of data.
    </p>

    <h3>Tainting + Apache::Request....  Apache::TaintRequest</h3>

    <p>
      The implementation code for Apache::TaintRequest is quite
      simple. It's a subclass of the Apache::Request module, which
      provides the form field and output handling.  We override the
      <i>print</i> method, because that is where we HTML escape the
      data.  We also override the <i>new</i> method -- this is where
      we use Apache's TIEHANDLE interface to insure that output to
      STDOUT is processed by our print() routine.
    </p>
    <p>
      Once we have output data we need to determine if it is tainted.
      This is where the <i>Taint</i> module (also available from CPAN)
      becomes useful.  We use it in the <i>print</i> method to
      determine if a printable string is tainted and needs to be HTML
      escaped.  If it is tainted we use the mod_perl function
      Apache::Util::html_escape() to escape the html.
    </p>

    <pre><code>
package Apache::TaintRequest;

use strict;
use warnings;

use Apache;
use Apache::Util qw(escape_html);
use Taint qw(tainted);

$Apache::TaintRequest::VERSION = '0.10';
@Apache::TaintRequest::ISA = qw(Apache);

sub new {
  my ($class, $r) = @_;

  $r ||= Apache->request;

  tie *STDOUT, $class, $r;

  return tied *STDOUT;
}


sub print {
  my ($self, @data) = @_;

  foreach my $value (@data) {
    # Dereference scalar references.
    $value = $$value if ref $value eq 'SCALAR';

    # Escape any HTML content if the data is tainted.
    $value = escape_html($value) if tainted($value);
  }

  $self->SUPER::print(@data);
}
</code></pre>

    <p>
      To finish off this module we just need the TIEHANDLE interface
      we specified in our <i>new()</i> method.  The following code
      implements a <i>TIEHANDLE</i> and <i>PRINT</i> method. 
    </p>



<pre><code>
sub TIEHANDLE {
  my ($class, $r) = @_;

  return bless { r => $r }, $class;
}

sub PRINT {
  shift->print(@_);
}
</code></pre>

    <p>
      The end result is that Tainted data is escaped, and untainted
      data is passed unaltererd to the web client.
    </p>

    <h3>Conclusions</h3>
    <p>
      Cross-site scripting is a serious problem.  The solutions, input
      validation and HTML escaping are simple but must be applied
      every single time.  An application with a single overlooked form
      field is just as insecure as one that does no checking whatsoever.
    </p>
    <p>
      To insure that we always check our data Apache::TaintRequest was
      developed.  It builds upon Perl's powerful data tainting feature
      by automatically HTML escaping data that is not input validated
      when it is printed.
    </p>
    <h3>Resources</h3>
    <ul>
      <li><a href="http://www.cert.org/advisories/CA-2000-02.html">CERT Advisory CA-2000-02 Malicious HTML Tags Embedded in Client Web Requests</a></li>
      <li><a href="http://www.modperlcookbook.org">The mod_perl Developer's Cookbook</a></li>
      <li><a href="http://www.modperlcookbook.org/code.html">Download Apache::TaintRequest</a></li>
    </ul>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1264" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/02/p6pdigest/20020209.html" rel="bookmark">This Fortnight on Perl 6 (27 Jan - 9 Feb 2002)</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Bryan Warnock</span> on <abbr class="published" title="2002-02-12T00:00:00-08:00">February 12, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
                  <h3><a name="Notes">Notes</a></h3>

</p>

<p>

You can subscribe to an email version of this summary by sending an empty
message to 
<a href="mailto:perl6-digest-subscribe@netthink.co.uk">perl6-digest-subscribe@netthink.co.uk</a>.
</p>

<p>
This summary, as with past summaries, can be found in
<a href="http://members.home.com/bcwarno/Perl6/digests/">here</a>.  (Note that this is an @Home address, and will change sometime this
month.)  Please send additions, submissions, corrections, kudos, 
and complaints to 
<a href="mailto:bwarnock@capita.com">bwarnock@capita.com</a>.
</p>

<p>
Perl 6 is the major redesign and rewrite of the Perl language.  Parrot is
the virtual machine that Perl 6 (and other languages) will be written for.
For more information on the Perl 6 and Parrot development efforts, visit
<a href="http://dev.perl.org/perl6/">dev.perl.org</a> and
<a href="http://www.parrotcode.org/">parrotcode.org</a>.
</p>

<p>
For the two week period, there were 410 messages across 110 threads, 
with 64 authors contributing.  Quite a few patches.
<h3><a name="Parrot_Is_Broken">Parrot Is Broken</a></h3>

</p>

<p>

Parrot is
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg08358.html">broken</a> until the keyed access interface to arrays and hashes are fixed.  This shouldn't
take long, but be warned if you decide to play with Parrot.
<h3><a name="Speed">Speed</a></h3>

</p>

<p>

Raptor
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg08274.html">was impressed</a> with the speed that Parrot is running through code, and asked if the numbers
were true.  Sadly, 
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg08285.html">not really</a>.
<h3><a name="Unicode_Strings">Unicode Strings</a></h3>

</p>

<p>

Larry Wall gave
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg08156.html">his input</a> on how Unicode and Strings should interrelate in Perl 6.
<blockquote></p>

<p>
But within Perl, character strings are simply sequences of integers.
The internal representation must be optimized for this concept, not for
any particular Unicode representation, whether UTF-8 or UTF-16 or
UTF-32.  Any of these could be used as underlying representations, but
the abstraction of sequences of integers must be there explicitly in
the internal high-level string API.  To oversimplify, the high-level
API must not have any parameters whose type contains the string &quot;UTF&quot;.
</blockquote>

<h3><a name="The_Regex_Engine">The Regex Engine</a></h3>



<p>

Ashley Winters
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg08143.html">had a beef</a> with the current regex engine, and how it's not being written in pure Parrot
opcodes.  These replies from 
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg08147.html">Brent Dax</a>,
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg08179.html">Bryan Warnock</a>, and
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg08146.html">Angel Faus</a> respond to Ashley's concerns.
<h3><a name="Perl_6_On_Mono">Perl 6 On Mono</a></h3>

</p>

<p>

Aaron Sherman 
<a href="http://archive.develooper.com/perl6-language@perl.org/msg09130.html">asked</a> whether targeting Mono's CIL wasn't a better idea than writing our own VM.
Brent Dax
<a href="http://archive.develooper.com/perl6-language@perl.org/msg09131.html">quoted</a> the
<a href="http://www.parrotcode.org/faq/">FAQ</a>, but Paolo Molaro 
<a href="http://archive.develooper.com/perl6-language@perl.org/msg09134.html">wasn't so sure</a>.
<h3><a name="Is_Perl_6_Perl">Is Perl 6 Perl?</a></h3>

</p>

<p>

Aaron Sherman also
<a href="http://archive.develooper.com/perl6-language@perl.org/msg09089.html">asked</a> whether Perl 6 should, in fact, be called Perl.  Here's 
<a href="http://archive.develooper.com/perl6-language@perl.org/msg09112.html">one particular response</a>.
<h3><a name="The_Parrot_Spotlight">The Parrot Spotlight</a></h3>

</p>

<p>

Jeff Goff has been programming in Perl since roughly 1994, and designing
Parrot since November 2001. He's the author of the PMC base types, the
miniperl and Scheme compilers, and is currently redesigning the PMC
classes and working on Unicode support.
</p>

<p>
Aside from Perl, Parrot, compilers, neural networks and genetic
algorithms, his non-computer interests include origami, juggling,
voracious reading, and playing guitar (seven notes and holding). He's
owned by the unofficial Parrot mascot, a precocious baby African Grey
named 
<a href="http://members.home.net/bcwarno/Perl6/percy.jpg">Percy</a>, who he's been known to speak to in Japanese. Percy usually
gives him blank stares, but was once heard to mutter 'Speak English,
idiot.'
</p>

<hr>

<a href="http://members.home.com/bcwarno/Perl6/">Bryan C. Warnock</a>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1258" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/02/12/bigo.html" rel="bookmark">Optimizing Your Perl</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <abbr class="published" title="2002-02-12T00:00:00-08:00">February 12, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            


<p>Is your Perl program taking too long to run?  This might be because
you've chosen a data structure or algorithm that takes a long time to
run.  By rethinking how you've implemented a function, you might be
able to realize huge gains in speed.</p>

<h3><a name="some simple complexity theory">Some Simple Complexity Theory</a></h3>
<p>Before we can talk about speeding up something, we need a way to
describe how long something takes.  Because we're talking about
algorithms that may have varying amounts of input, the actual "time"
to do something isn't conclusive.  Computer scientists and
mathematicians use a system called big-O notation to describe the
order of magnitude of how long something will take.  Big-O notation
represents a worst-case analysis.  There are other notations to
represent the magnitude of minimum and actual runtimes.</p>

<p>Don't let the talk of computer scientists and mathematicians scare you.  The next few paragraphs talk about a way to describe the
difference between orders of magnitude such as a second, minute, hour
or day.  Or 1, 10, 100 and 1,000.  You don't need to know any fancy or
scary math to understand it.</p>

<p>It's simple.  If the runtime of a function is constant, then this is
written as O(1).  (Note the capital or "big" O.)  Constant means that
no matter how much data is processed, (i.e., how much input there is)
the time doesn't change.</p>

<p>If the runtime is directly related to the amount of input
(a.k.a. linear), then this is O(n).  If there is twice as much input, then the
algorithm will take twice as long to run.  Some functions are <code>O(n^2)</code>
(quadratic) or <code>O(n^3)</code> (cubic) or even worse.</p>
<p>Because we are only looking at orders of magnitude (is the operation
going to take one minute or one hour) we can ignore constant factors and
smaller terms.  <code>O(2n)</code> and <code>O(n)</code> are equivalent.  
As are <code>O(n+1)</code> and
<code>O(n)</code> or <code>O(n^2+n)</code> and <code> O(n^2)</code>.  The smaller term 
is insignificant
compared to the larger.</p>

<p>There are rules for analyzing code and determining its big-O, but the
simplest way is to look at how many times you iterate over the data.
if you don't iterate, then it's O(1).  If you iterate over it once, then it's
O(n).  If you have two nested loops, then it's probably O(n^2).</p>

<p><img src="/pub/2002/02/12/graphics/graph-orders.jpg" alt="Orders"></p>

<h3><a name="example #1: graphing">Example #1: Graphing</a></h3>

<p>I developed a new graph module for a project at my day job, because
the <a href="http://search.cpan.org/search?dist=Graph">existing
one</a> was overkill, yet did not support a feature I needed.  It was
easy to implement and worked very well, until the graph got very
big.  I needed flattened subgraphs to do dependency checks, but it was
taking more than two minutes to compute (on a 1Ghz P3) for a 1,000 node
graph.  I needed the computation to be much faster, or my users would
get mad.</p>
<p>My initial Graph module looked like this.  (Simplified to only show
relevant parts.)</p>
<pre><code>
 package Graph; # for Directed Graphs
 use strict;
 sub new {
  my $this = { edges =&gt; [],
               vertices =&gt; {} };
  bless $this, &quot;Graph&quot;;
 }
 sub add_edge { # from x to y
  my ($this,$x,$y) = @_;
  $this-&gt;{vertices}{$x}++;
  $this-&gt;{vertices}{$y}++;
  push @{$this-&gt;{edges}},[$x=&gt;$y];
 }
 sub in_edges {
  my ($this,$v) = @_;
  grep { $_-&gt;[1] eq $v } @{$this-&gt;{edges}};
 }</code></pre>
<p>The add_edge method is <code>O(1)</code> because it will always take the same
amount of time no matter how many nodes/edges are in the graph.  The
in_edges method is <code>O(n)</code> because it has to iterate over each edge in
the graph.  (The iteration is "inside" the grep.)</p>
<p>The problematic section of the code looked like this:</p>
<pre><code>
 sub flat_subgraph {
    my ($graph,$start) = @_;
    my %seen;
    my @worklist = ($start);
    while (@worklist) {
      my $x = shift @worklist;
      push @worklist, $graph-&gt;in_edges($x) 
         unless $seen{$x}++;
    }
    return keys %seen;
 }</code></pre>
<p>And I actually needed to do that for multiple vertices;</p>
<pre><code>
  my %dependencies;
  for (keys %{$graph-&gt;{vertices}}) {
   $dependencies{$_} = [ flat_subgraph( $graph, $_ ) ];
  }</code></pre>
<p>This would make the entire flattening operation O(n^3).  ( The
dependency loop is O(n), flat_subgraph is effectively O(n), and
in_edges is O(n)).  That means that it takes much longer to compute as
the Graph becomes bigger.  (Imagine a curve with the following values:
1,8,27,64..., that's the curve of relative times.)</p>

<h3><a name="caching">Caching</a></h3>
<p>With my users expecting instant feedback, something had to be done. 
The first thing I tried was to cache the in_edges computation.</p>
<pre><code>
 sub in_edges {
  my ($this,$v) = @_;
  if (exists $this-&gt;{cache}{in_edges}{$v}) {
      return @{$this-&gt;{cache}{in_edges}{$v}};
  } else {
    my @t = grep { $_-&gt;[1] eq $v } @{$this-&gt;{edges}};
    $this-&gt;{cache}{in_edges}{$v} = [@t];
    return @t;
   }
 }</code></pre>
 

<p>This helped, but not as much as I had hoped.  The in_edges calculation
was still expensive when it wasn't cached.  It's still <code>O(n)</code> in
the worst case, but becomes <code>O(1)</code> when cached.  On average, that means
the entire flattening operation is somewhere between <code>O(n^2)</code> and <code>O(n^3)</code>,
which is still potentially slow.</p>

<p>In situations where the same functions are called with the same
arguments, caching can be useful.  Mark-Jason Dominus has written
a module called Memoize, which makes it easy to write caching
functions.  See his Web site 
<a href="http://perl.plover.com/MiniMemoize/">http://perl.plover.com/MiniMemoize/</a> for
more information.</p>

<h3><a name="change the structure">Change the Structure</a></h3>
<p>The next thing I tried was to change the Graph data structure.  When I
originally designed it, my goal was simplicity, not necessarily
speed.  Now speed was becoming important and I had to make changes.</p>
<p>I modified graph so that in_edges were calculated when the new edge
was being added.</p>
<pre><code>
 package Graph; # for Directed Graphs
 use strict;
 sub new {
  my $this = { edges =&gt; [],
               vertices =&gt; {},
               in_edges =&gt; {} };
  bless $this, &quot;Graph&quot;;
 }
 sub add_edge { # from x to y
  my ($this,$x,$y) = @_;
  $this-&gt;{vertices}{$x}++;
  $this-&gt;{vertices}{$y}++;
  push @{$this-&gt;{in_edges}{$y}}, $x;
  push @{$this-&gt;{edges}},[$x=&gt;$y];
 }
 sub in_edges {
  my ($this,$v) = @_;
  return @{$this-&gt;{in_edges}{$v}};
 }</code></pre>
<p>add_edge remains <code>O(1)</code> - it still executes in a constant time.
in_edges is <code>O(1)</code> as well now; its runtime will not vary based on the
number of edges.</p>
<p>This was the solution I needed, getting a full flattening down from
more than four minutes to only six seconds.</p>














<h3><a name="the importance of good interfaces">The Importance of Good Interfaces</a></h3>
<p>One of the things that made this fiddling possible was a good design
for the Graph module's interface.  The interface hid all the details
of the internals from me, so that different implementations could be
plugged in.  (This is actually how I did the testing, I had a regular
Graph, a Graph::Cached, and a Graph::Fast.  Once I decided that I
liked Graph::Fast the best, I renamed it to just Graph.)</p>
<p>I'm glad I designed Graph the way I did.  I put simplicity and design
first.  There is a phrase you might have heard: "Premature
optimization is the root of all evil."  If I had optimized the Graph
module first, then I might have ended up with more complicated code that
didn't work in all cases.  My initial cut of Graph was slow, but
worked consistently.  Optimization happened later, after I had a
baseline I could return to, to guarantee proper operation.</p>

<h3><a name="example #2: duplicate message filter">Example #2: Duplicate Message Filter</a></h3>

<p>You don't always need to try and optimize code to the fullest extent.
Optimizing code takes your time and energy, and it isn't always worth
it.  If you spend two days to shave two seconds off a program, then it's
probably not worth it.  (Unless of course, that program is running
hundreds of times each day.)  If a program is "fast enough", then making it
faster isn't worth it.</p>
<p>Our second example is a duplicate message filter for e-mail.  This
filter is useful when you receive cc's of messages also sent to
mailing lists you are on, but you don't want to see both.</p>
<p>The general idea behind this filter is simple.</p>
<pre><code>
  skip $message if seen $message-&gt;id;</code></pre>
<p>It's only the seen function that interests us.  It searches some form
of cache of id's.  How we implement it can have a large effect on the
speed of our mailfilter.  (For more information on filtering mail with
perl, take a look at 
<a href="http://search.cpan.org/search?dist=Mail-Audit">Mail::Audit</a>.)</p>
<p>The two most obvious methods that come to mind for implementing seen
are a simple linear search (O(n)) or the use of a persistent
database/hash table to do the lookup.  O(1).  I'll ignore the cost of
maintaining the database, eliminating old Message-Id's, etc.</p>
<p>A linear approach writes out the message id's with some sort of
separator.  Some programs use null bytes, others use newlines.</p>
<p>The database/hash method stores the message id's in a binary database like a
DBM or Berkeley DB file.  At the expense of using more disk space,
lookups are generally faster.</p>
<p>But - there's one more factor to take into account - overhead.  The
linear search has little overhead, while the DB file has a large
overhead.  (Overhead here means time to open the file and initialize
the appropriate data structures.)</p>
<pre><code>
 TABLE: Comparison
 
  Records | Comment
  -----------------
    100   | linear is 415% faster
    250   | linear is 430% faster
    500   | hash is 350% faster
   1000   | hash is 690% faster</code></pre>
<p>I performed a set of timings with a rough example implementation on my
P2/400, and received the above results.  The hash lookup speeds remained
constant, while the linear lookup dropped off rapidly after 250 items
in the cache.</p>
<p>Returning to the big picture, we need to take our message-id cache
size into account when determining the method to use.  For this kind
of cache, there's usually not a reason to keep a huge amount of
entries around, only two or three days worth should catch most
duplicate messages.  (And probably even one day's worth in most cases.)</p>
<p>For this problem, an <code>O(1)</code> solution is possible, but the constant time
it takes might be higher than an <code>O(n)</code> solution.  Both cases are
trivial to implement, but in some situations it will be difficult to
implement <code>O(1)</code> - and not worth it either.</p>

<h3><a name="conclusion">Conclusion</a></h3>

<p>Perl is a powerful language, but it doesn't prevent the
programmer from making poor decisions and shooting him/herself in the
foot.  One mistake is to choose the wrong data structure or algorithm
for the job.  By using a little bit of complexity theory, it's
possible to optimize your code and get huge speed gains.</p>
<p>I've only touched the surface of big-O notation and complexity
theory.  It's a highly researched topic that delves into the deep dark
corners of math and computers.  But, hopefully there's enough here to
give you a basic tool set.</p>
<p>As the second example showed, you don't necessarily want to spend too
much time thinking about optimization.  Over-optimization isn't always
worth it.</p>

<h3><a name="for more information">For More Information</a></h3>
<dl>
<dt><strong><a name="item_Google">Google</a></strong><br />
<dd>
<pre>
 <a href="http://www.google.com/search?q=big-O+complexity">http://www.google.com/search?q=big-O+complexity</a></pre>
<dt><strong><a name="item_Introduction_to_the_Theory_of_Computation">Introduction to the Theory of Computation</a></strong><br />
<dd>
Part Three of Sipser, Michael. "Introduction to the Theory of
Computation". PWS Publishing Company. Boston, MA. 1997.
<p></p>
<dt><strong><a name="item_Algorithms_and_Complexity%2C_Internet_Edition">Algorithms and Complexity, Internet Edition</a></strong><br />
<dd>
<a href="http://www.cis.upenn.edu/%7Ewilf/AlgComp3.html">http://www.cis.upenn.edu/~wilf/AlgComp3.html</a>
<p></p></dl>

<h3><a name="special thanks">Special Thanks</a></h3>
<p>Walt Mankowski</p>






        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1256" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/02/05/visperl.html" rel="bookmark">Visual Perl</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Eric Promislow</span> on <abbr class="published" title="2002-02-06T00:00:00-08:00">February  6, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            

<p>Jumbo shrimp, military intelligence - Visual Perl? ActiveState built its 
reputation by bringing Perl to the Windows platform, thereby extending the 
reach of Perl and the size and nature of the Perl community.  However, 
regardless of the Windows port, many Perl programmers don't hesitate to voice 
their preference for text-based editors (like vi and emacs) over 
Windows-based integrated development environments (IDEs). Some Perl gurus find 
text-based editors the most efficient way to code.  But for 
programmers who are new to Perl, and programmers who primarily work in 
graphical environments such as Windows, the intuitive, visual nature of 
IDEs help them to learn languages and produce code more quickly.</p>

<p>ActiveState's combined expertise in Perl and the Windows platform, and our  
stated goal of bringing open-source programming languages to a wider developer 
audience, has led to our interest in developing IDEs.  We have three particular 
goals:</p>
  

<ol>
  <li>to create an intuitive editing environment</li>
  <li>to deliver much of the functionality that powerful text-based editors
  offer, but without the initial learning curve</li>
  <li>to add language-specific features, such as real-time syntax
  checking, debugging, colorizing and online help</li>
</ol>


<p>Therefore, in addition to developing our own 
<a href="http://www.ActiveState.com/Products/Komodo">Komodo</a> IDE, ActiveState 
has participated in Microsoft's Visual Studio Integration Program (VSIP) and 
developed three plug-ins 
(<a href="http://www.ActiveState.com/Products/Visual_Perl">Visual Perl</a>,
<a href="http://www.ActiveState.com/Products/Visual_Python">Visual Python</a> and 
<a href="http://www.ActiveState.com/Products/Visual_XSLT">Visual XSLT</a>) for 
Microsoft's 
<a href="http://msdn.microsoft.com/vstudio">Visual Studio .NET</a>.</p>

<p>Integrating Perl support into Visual Studio .NET required extending Visual 
Studio to provide Perl-specific functionality.  For example, Visual Perl 
includes module-based code completion, pop-up hints for Perl keywords and 
module functions, a context-sensitive Perl language reference and emacs-like 
auto-indenting, brace matching, and block selection. Additionally, Visual Perl 
makes use of standard Visual Studio .NET functionality through the graphical 
debugger, the class view (for browsing functions), sophisticated project 
management, etc.</p>  

<h3>Visual Perl and .NET</h3>

<p></p>

<p>In a separate initiative, ActiveState has developed 
<a href="http://www.activestate.com/Products/Perl_Dev_Kit/">PerlNET</a>, 
a tool for building .NET-compliant components with Perl.  PerlNET is 
part of ActiveState's Perl Dev Kit 4.0, and Visual Perl integrates with 
the Perl Dev Kit, allowing developers to create .NET-compliant components 
(and also Windows applications, services and controls) from within Visual 
Studio .NET.</p>

<p>PerlNET and Visual Perl make it easier to build multi-language applications. 
Previously, the easiest way to build Windows applications quickly was 
with Visual Basic.  However, Visual Basic has drawbacks with regards to the 
the speed at which the applications run.  Also, VB is not the most commodious
language for developers accustomed to modern constructs such as associative arrays, 
dynamic functions, closures, run-time eval and regular expression matching 
with full backtracking.</p>

<p>Microsoft has addressed this by creating a modernized ".NET" version of 
Visual Basic, and with the creation of C#, which provides a near-functional 
equivalent to Visual Basic .NET (some would say "superior, but functionally close").  
Additionally, any language that can target the .NET runtime engine can be used to
build components, and multilanguage interoperability is
transparent.  In a nutshell, you can use a high-level language to
script the UI, write back-end components in Perl, and tie the two
together almost effortlessly.  All you have to do is:</p>

<ul>
	<li>tell Visual Perl that a particular Perl project should be
  converted to a .NET DLL, and add the interface definition for the
  component in one or more "=for interface" POD comments</li>
	<li>assign the code in the Perl-sourced DLL a namespace</li>
	<li>point the client application to the Perl-sourced DLL, and use
  that namespace</li>
</ul>
	
<h3>Visual Perl and .NET: Making it Happen</h3>

<p>As an example, the process of building a .NET-compliant application 
goes something like this:</p>

<ol>
	<li>Quickly build a front-end in C# or Visual Basic .NET using Win Forms to
  populate a form with UI widgets.  Double-click on the widgets to
  script common events ("..._Click" for buttons, "..._TextChanged"
  for changing text fields).</li>
	<li>When it's time to add more processing to the back end,
  add a Perl project to the current Visual Studio .NET solution, and treat it
  like a Perl package.  Define the constructor, add methods and
  fields to the interface definition block, and then define the new methods 
	and fields.</li>
	<li>Like other Perl component builders, you should test and
	debug your Perl code before converting it into a DLL.  The
	simplest way is to put a
<pre>

	<code>unless (caller) { ... }</code></pre>

block at the end of your module, before the final "1;", and drive your package
	from that.</li>
	
<li>Configure the Perl project as the "startup" project, then run the Perl 
	component straight through, outside Visual Perl's debugger. (You can run 
	programs in a DOS command shell, or in the "Run Window" within Visual Studio 
	.NET.  Both support standard IO, including stdin.)</li>
	<li>Change the project type from "Standard" to "Managed DLL," change the 
	"startup" project to the C# project, then build and run.</li>
</ol>













<h3>Getting the Job Done with Visual Perl</h3>

<p>.NET aside, we worked hard to make Visual Perl an attractive alternative 
to emacs, vim and other editors favored by Perl programmers.  Visual Studio 
.NET provides an editing environment familiar to developers who have always 
worked in Windows. But many Perl programmers cut their hash variables on 
emacs and vi, and are wary of giving up the powerful functionality of those 
editors.</p>

<p>However, implementing "vi" and "emacs" keystroke bindings wasn't 
the way to go.  "Ctrl-X" has a long-established meaning in the GUI world, and
we weren't about to let developers accidentally delete a chunk of selected text  
when they meant to start a multi-keystroke command.</p>

<p>So, while we couldn't preserve the keystrokes, we could go some way toward 
preserving the functionality. Visual Perl features:</p>

<ul>
	<li>configurable auto-indenting that provides the ability to set the level of 
	indent, specify whether to insert spaces or tabs, and whether to
  auto-indent based on nesting constructs</li>
	<li>auto-indenting based on the Camel book style, so it's
	sensitive to the location of enclosing braces and parentheses</li>
	<li>the ability to show matching bracketing characters</li>
	<li>keyboard shortcuts for moving to matching brackets, or selecting a 
	block within the matching brackets</li>
	<li>keyboard shortcuts for commenting and un-commenting blocks of selected 
	text</li>
	<li>the ability to collapse and expand blocks of code with a single mouse 
	click</li>
	<li>incremental searching, both forward and backward (although we hope 
	to extend this functionality with incremental regular expression 
	searches)</li>  
</ul>

<p>Visual Perl's colorizer is aware of some of Perl's more arcane constructs, including
here-documents (stacked or plain), regex substitutions with different delimiters 
on the pattern and replacement, and ?-delimited regular expressions.  And  
Visual Studio .NET's Options dialog lets you assign whatever color combination 
you want to each style.</p>

<p>Other features include the class browser, which is used to quickly navigate 
to the functions in the files loaded in a project. Integrated context-sensitive 
help provides quick information on Perl keywords.  You can right click on a 
"use" or "require" statement, and view help for the imported module within 
the Visual Studio .NET environment. The debugger supports debugging of remote 
Perl programs, not just the program loaded in the IDE.</p>

<p>Visual Perl uses the Visual Studio .NET code completion framework to help 
walk the user through "::"-separated names when importing modules. It 
recognizes when an instance of a package is bound to a variable, and 
presents available methods when "-&gt;" is typed after the variable.  Visual Perl 
isn't doing anything fancy here; it's simply assuming that good developers 
try to maintain a many-to-one relationship between their variable names and 
the types the variables are labels for. So when Visual Perl sees that a 
variable called "$ua" is an instance of LWP::UserAgent, it assumes that other 
instances of that variable are as well. This definitely isn't thorough, and 
assumes that a value keeps its name on both sides of a function call, but it 
works the way that many people work.</p>

<h3>Visual Perl and Web Services</h3>

<p>Visual Perl's code completion is also available for Web services. Once
a Web service has been associated with a variable, a list of available
methods in the Web service, and their call signatures, will pop up
when you type "-&gt;".</p>

<p>ActiveState has participated in the development of a
scripting-language-agnostic framework for consuming Web services,
called the Simple Web Services API.  It works with Python and 
PHP, as well as Perl.  Among other things, it allows you to bind to
and call methods on a Web service with a minimal amount of code.  For
Perl, this line suffices to bind a variable to a Web service:
<br/>
<br/>
<code>$var = WebService::ServiceProxy-&gt;new (wsdl string)</code>
<br/>
<br/>
Calling methods off the service is as simple as invoking an object method:
<br/>
<br/>
<code>$var-&gt;<i>method</i>(<i>args...</i>)</code>
<br/>
</p>

<p>Once a variable has been bound to a Web service, typing the '-&gt;' will
drop a list of methods the Web service exports, and typing the '('
after the method name will raise a call tip that walks through the
arguments.</p>

<p>This is similar to SOAP::Lite, but has the advantage of working
in several languages, as well as handling features such as
overloaded methods, and supporting method names that contain Unicode
characters that can't be used in Perl identifiers.</p>


<h3>Conclusion</h3>

<p>ActiveState's work with Visual Studio .NET and the .NET Framework furthers 
our commitment to expanding the use of Perl. Visual Perl expands the language 
set available to developers using Microsoft's ubiquitous Visual Studio IDE, and 
PerlNET extends Perl by providing compliancy with the .NET Framework.</p>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2002/01/">&laquo; January 2002</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2002/03/">March 2002 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
