<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/2002/05/07/mod_perl.html">
<dc:title>The Perl You Need To Know - Part 2</dc:title>
<dc:description> Introduction In this article, we continue to talk about the essential Perl basics that you should know before starting to program for mod_perl. Tracing Warnings Reports Sometimes it&apos;s hard to understand what a warning is complaining about. You see...</dc:description>
<dc:creator>Stas Bekman</dc:creator>
<dc:date>2002-05-07T00:00:00-08:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    
    <link rel="prev bookmark" href="/pub/2002/04/30/cpants.html" title="Becoming a CPAN Tester with CPANPLUS" />
    <link rel="next bookmark" href="/pub/2002/05/07/optree.html" title="Where Wizards Fear To Tread" />
    
    
    <title>The Perl You Need To Know - Part 2 - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1296" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">The Perl You Need To Know - Part 2</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Stas Bekman</span> on <abbr class="published" title="2002-05-07T00:00:00-08:00">May  7, 2002 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        
<!-- sidebar begins -->
<!-- no -->
<!-- sidebar ends -->
<h3><a name="introduction">Introduction</a></h3>
<p>In this article, we continue to talk about the essential Perl basics that you should know before starting to program for mod_perl.</p>


<h3><a name="tracing warnings reports">Tracing Warnings Reports</a></h3>
<p>Sometimes it's hard to understand what a warning is complaining
about.  You see the source code, but you cannot understand why some
specific snippet produces that warning.  The mystery often results from
the fact that the code can be called from different places if it's
located inside a subroutine.</p>
<p>Here is an example:</p>
<pre><code>
  warnings.pl
  -----------
  #!/usr/bin/perl -w

  use strict;

  correct();
  incorrect();

  sub correct{
    print_value(&quot;Perl&quot;);
  }

  sub incorrect{
    print_value();
  }

  sub print_value{
    my $var = shift;
    print &quot;My value is $var\n&quot;;
  }</code></pre>
<p>In the code above, <code>print_value()</code> prints the passed value.  Subroutine
<code>correct()</code> passes the value to print, but in subroutine <code>incorrect()</code> we
forgot to pass it. When we run the script:</p>
<pre><code>
  % ./warnings.pl</code></pre>
<p>we get the warning:</p>
<pre><code>
  Use of uninitialized value at ./warnings.pl line 16.</code></pre>
<p>Perl complains about an undefined variable <code>$var</code> at the line that
attempts to print its value:</p>
<pre><code>
  print &quot;My value is $var\n&quot;;</code></pre>
<p>But how do we know why it is undefined? The reason here obviously is
that the calling function didn't pass the argument. But how do we know
who was the caller? In our example, there are two possible callers, in
the general case there can be many of them, perhaps located in other
files.</p>
<p>We can use the <code>caller()</code> function, which tells who has called us, but
even that might not be enough: It's possible to have a longer sequence
of called subroutines, and not just two. For example, here it is sub
<code>third()</code> which is at fault, and putting sub <code>caller()</code> in sub <code>second()</code>
would not help:</p>
<pre><code>
  sub third{
    second();
  }
  sub second{
    my $var = shift;
    first($var);
  }
  sub first{
    my $var = shift;
   print &quot;Var = $var\n&quot;
  }</code></pre>
<p>The solution is quite simple. What we need is a full calls stack trace
to the call that triggered the warning.</p>
<p>The <code>Carp</code> module comes to our aid with its <code>cluck()</code> function. Let's
modify the script by adding a couple of lines.  The rest of the script
is unchanged.</p>
<pre><code>
  warnings2.pl
  -----------
  #!/usr/bin/perl -w

  use strict;
  use Carp ();
  local $SIG{__WARN__} = \&amp;Carp::cluck;

  correct();
  incorrect();

  sub correct{
    print_value(&quot;Perl&quot;);
  }

  sub incorrect{
    print_value();
  }

  sub print_value{
    my $var = shift;
    print &quot;My value is $var\n&quot;;
  }</code></pre>
<p>Now when we execute it, we see:</p>
<pre><code>
  Use of uninitialized value at ./warnings2.pl line 19.
    main::print_value() called at ./warnings2.pl line 14
    main::incorrect() called at ./warnings2.pl line 7</code></pre>
<p>Take a moment to understand the calls stack trace. The deepest calls
are printed first. So the second line tells us that the warning was
triggered in print_value(); the third, that <code>print_value()</code> was
called by subroutine, incorrect().</p>
<pre><code>
  script =&gt; incorrect() =&gt; print_value()</code></pre>

<table cellspacing="12" cellpadding="0" border="0" align="right" width="200"><tr><td>
<center><img src="/images/pixel-hub.gif" width="200" height="2" hspace="0" vspace="10" border="0" alt=" " /><br />
<center><a href="http://conferences.oreilly.com/oscon/"><img src="/images/os2002/oscon-sidebar.gif" alt="O'Reilly Open Source Convention -- July 22-26, San Diego, CA." width="143" height="78" border="0" /></a></center>
<p class="smalllist"><strong>From the Frontiers of Research to the Heart of the Enterprise</strong></p>
</center>
<p class="secondary"><a href="http://conferences.oreillynet.com/cs/os2002/view/e_sess/3032">mod_perl 2.0, the Next Generation</a>
Stas Bekman will provide an overview of what's new in mod_perl 2.0 and what else is planned for the future in his talk at the upcoming <a href="http://conferences.oreillynet.com/os2002/">O'Reilly Open Source Convention</a>, this July 22-26, in San Diego.</p>
<center><img src="/images/pixel-hub.gif" width="200" height="2" hspace="0" vspace="0" border="0" alt=" " /></center>
</td></tr></table>
<p>We go into <code>incorrect()</code> and indeed see that we forgot to pass the
variable. Of course, when you write a subroutine such as <code>print_value</code>, it
would be a good idea to check the passed arguments before starting
execution. We omitted that step to contrive an easily debugged example.</p>
<p>Sure, you say, I could find that problem by simple inspection of the
code!</p>
<p>Well, you're right. But I promise you that your task would be quite
complicated and time consuming if your code has some thousands of
lines.  In addition, under mod_perl, certain uses of the <code>eval</code>
operator and ``here documents'' are known to throw off Perl's line
numbering, so the messages reporting warnings and errors can have
incorrect line numbers. This can be easily fixed by helping compiler
with <code>#line</code> directive. If you put the following at the beginning of
the line in your script:</p>
<pre><code>
 #line 125</code></pre>
<p>then it will tell the compiler that the <strong>next</strong> line is number 125 for
reporting needs. Of course, the rest of the lines would be adapted as
well.</p>
<p>Getting the trace helps a lot.</p>

<h3><a name="my() scoped variable in nested subroutines"><code>my()</code> Scoped Variable in Nested Subroutines</a></h3>

<p>Before we proceed let's make the assumption that we want to develop
the code under the <code>strict</code> pragma. We will use lexically scoped
variables (with help of the <code>my()</code> operator) whenever it's possible.</p>

<h4><a name="the poison">The Poison</a></h4>
<p>Let's look at this code:</p>
<pre><code>
  nested.pl
  -----------
  #!/usr/bin/perl

  use strict;

  sub print_power_of_2 {
    my $x = shift;

    sub power_of_2 {
      return $x ** 2; 
    }

    my $result = power_of_2();
    print &quot;$x^2 = $result\n&quot;;
  }

  print_power_of_2(5);
  print_power_of_2(6);</code></pre>
<p>Don't let the weird subroutine names fool you, the <code>print_power_of_2()</code>
subroutine should print the square of the number passed to it. Let's
run the code and see whether it works:</p>
<pre><code>
  % ./nested.pl

  5^2 = 25
  6^2 = 25</code></pre>
<p>Ouch, something is wrong. May be there is a bug in Perl and it doesn't
work correctly with the number 6? Let's try again using 5 and 7:</p>
<pre><code>
  print_power_of_2(5);
  print_power_of_2(7);</code></pre>
<p>And run it:</p>
<pre><code>
  % ./nested.pl

  5^2 = 25
  7^2 = 25</code></pre>
<p>Wow, does it works only for 5? How about using 3 and 5:</p>
<pre><code>
  print_power_of_2(3);
  print_power_of_2(5);</code></pre>
<p>and the result is:</p>
<pre><code>
  % ./nested.pl

  3^2 = 9
  5^2 = 9</code></pre>
<p>Now we start to understand -- only the first call to the
<code>print_power_of_2()</code> function works correctly. This makes us think that
our code has some kind of memory for the results of the first
execution, or it ignores the arguments in subsequent executions.</p>


<h4><a name="the diagnosis">The Diagnosis</a></h4>
<p>Let's follow the guidelines and use the <code>-w</code> flag:</p>
<pre><code>
  #!/usr/bin/perl -w</code></pre>
<p>Under Perl version 5.6.0+ we use the <code>warnings</code> pragma:</p>
<pre><code>
  #!/usr/bin/perl
  use warnings;</code></pre>
<p>Now execute the code:</p>
<pre><code>
  % ./nested.pl

  Variable &quot;$x&quot; will not stay shared at ./nested.pl line 9.
  5^2 = 25
  6^2 = 25</code></pre>
<p>We have never seen such a warning message before and we don't quite
understand what it means. The <code>diagnostics</code> pragma will certainly
help us. Let's prepend this pragma before the <code>strict</code> pragma in our
code:</p>
<pre><code>
  #!/usr/bin/perl -w

  use diagnostics;
  use strict;</code></pre>
<p>And execute it:</p>
<pre><code>
  % ./nested.pl
</code></pre>
<p>
  Variable &quot;$x&quot; will not stay shared at ./nested.pl line 10 (#1)
</p>
<p>
    (W) An inner (nested) named subroutine is referencing a lexical
    variable defined in an outer subroutine.
</p>
<p>
    When the inner subroutine is called, it will probably see the value of
    the outer subroutine's variable as it was before and during the
    *first* call to the outer subroutine; in this case, after the first
    call to the outer subroutine is complete, the inner and outer
    subroutines will no longer share a common value for the variable.  In
    other words, the variable will no longer be shared.
</p>
<p>
    Furthermore, if the outer subroutine is anonymous and references a
    lexical variable outside itself, then the outer and inner subroutines
    will never share the given variable.
</p>
<p>
    This problem can usually be solved by making the inner subroutine
    anonymous, using the sub {} syntax.  When inner anonymous subs that
    reference variables in outer subroutines are called or referenced,
    they are automatically rebound to the current values of such
    variables.
<pre><code>
  5^2 = 25
  6^2 = 25</code></pre>
<p>Well, now everything is clear. We have the <strong>inner</strong> subroutine
<code>power_of_2()</code> and the <strong>outer</strong> subroutine <code>print_power_of_2()</code> in our
code.</p>
<p>When the inner <code>power_of_2()</code> subroutine is called for the first time,
it sees the value of the outer <code>print_power_of_2()</code> subroutine's <code>$x</code>
variable. On subsequent calls the inner subroutine's <code>$x</code> variable
won't be updated, no matter what new values are given to <code>$x</code> in the
outer subroutine.  There are two copies of the <code>$x</code> variable, no
longer a single one shared by the two routines.</p>














<h4><a name="the remedy">The Remedy</a></h4>
<p>The <code>diagnostics</code> pragma suggests that the problem can be solved by
making the inner subroutine anonymous.</p>
<p>An anonymous subroutine can act as a <em>closure</em> with respect to
lexically scoped variables. Basically, this means that if you define a
subroutine in a particular <strong>lexical</strong> context at a particular moment,
then it will run in that same context later, even if called from
outside that context.  The upshot of this is that when the subroutine
<strong>runs</strong>, you get the same copies of the lexically scoped variables
that were visible when the subroutine was <strong>defined</strong>.  So you can
pass arguments to a function when you define it, as well as when you
invoke it.</p>
<p>Let's rewrite the code to use this technique:</p>
<pre><code>
  anonymous.pl
  --------------
  #!/usr/bin/perl

  use strict;

  sub print_power_of_2 {
    my $x = shift;

    my $func_ref = sub {
      return $x ** 2;
    };

    my $result = &amp;$func_ref();
    print &quot;$x^2 = $result\n&quot;;
  }

  print_power_of_2(5);
  print_power_of_2(6);</code></pre>
<p>Now <code>$func_ref</code> contains a reference to an anonymous function, which
we later use when we need to get the power of two. (In Perl, a
function is the same thing as a subroutine.) Since it is anonymous,
the function will automatically be rebound to the new value of the
outer scoped variable <code>$x</code>, and the results will now be as expected.</p>
<p>Let's verify:</p>
<pre><code>
  % ./anonymous.pl

  5^2 = 25
  6^2 = 36</code></pre>
<p>So we can see that the problem is solved.</p>


<h3><a name="when you cannot get rid of the inner subroutine">When You Cannot Get Rid of the Inner Subroutine</a></h3>
<p>First, you might wonder, why in the world will someone need to define
an inner subroutine? Well, for example, to reduce some of Perl's script
startup overhead you might decide to write a daemon that will compile
the scripts and modules only once, and cache the pre-compiled code in
memory. When some script is to be executed, you just tell the daemon
the name of the script to run and it will do the rest and do it much
faster since compilation has already taken place.</p>
<p>Seems like an easy task; and it is. The only problem is once the
script is compiled, how do you execute it? Or let's put it another
way: After it was executed for the first time and it stays compiled in
the daemon's memory, how do you call it again? If you could get all
developers to code their scripts so each has a subroutine called <code>run()</code>
that will actually execute the code in the script, then we've solved
half the problem.</p>
<p>But how does the daemon know to refer to some specific script if they
all run in the <code>main::</code> name space? One solution might be to ask the
developers to declare a package in each and every script, and for the
package name to be derived from the script name. However, since there
is a chance that there will be more than one script with the same name
but residing in different directories, then in order to prevent
namespace collisions the directory has to be a part of the package
name, too. And don't forget that the script may be moved from one
directory to another, so you will have to make sure that the package
name is corrected each time the script gets moved.</p>
<p>But why enforce these strange rules on developers, when we can arrange
for our daemon to do this work? For every script that the daemon is
about to execute for the first time, the script should be wrapped
inside the package whose name is constructed from the mangled path to
the script and a subroutine called run(). For example, if the daemon is
about to execute the script <em>/tmp/hello.pl</em>:</p>
<pre><code>
  hello.pl
  --------
  #!/usr/bin/perl
  print &quot;Hello\n&quot;;</code></pre>
<p>then prior to running it, the daemon will change the code to be:</p>
<pre><code>
  wrapped_hello.pl
  ----------------
  package cache::tmp::hello_2epl;

  sub run{
    #!/usr/bin/perl 
    print &quot;Hello\n&quot;;
  }</code></pre>
<p>The package name is constructed from the prefix <code>cache::</code>, each
directory separation slash is replaced with <code>::</code>, and nonalphanumeric characters are encoded so that for example <code>.</code> (a dot)
becomes <code>_2e</code> (an underscore followed by the ASCII code for a dot in
hex representation).</p>
<pre><code>
 % perl -e 'printf &quot;%x&quot;,ord(&quot;.&quot;)'</code></pre>
<p>prints: <code>2e</code>. The underscore is the same you see in URL encoding
except the <code>%</code> character is used instead (<code>%2E</code>), but since <code>%</code> has
a special meaning in Perl (prefix of hash variable) it couldn't be
used.</p>
<p>Now when the daemon is requested to execute the script
<em>/tmp/hello.pl</em>, all it has to do is to build the package name as
before based on the location of the script and call its <code>run()</code>
subroutine:</p>
<pre><code>
  use cache::tmp::hello_2epl;
  cache::tmp::hello_2epl::run();</code></pre>
<p>We have just written a partial prototype of the daemon we wanted. The
only outstanding problem is how to pass the path to the script to the
daemon. This detail is left as an exercise for the reader.</p>
<p>If you are familiar with the <code>Apache::Registry</code> module, then you know that
it works in almost the same way. It uses a different package prefix
and the generic function is called <code>handler()</code> and not run(). The
scripts to run are passed through the HTTP protocol's headers.</p>
<p>Now you understand that there are cases where your normal subroutines
can become inner, since if your script was a simple:</p>
<pre><code>
  simple.pl
  ---------
  #!/usr/bin/perl 
  sub hello { print &quot;Hello&quot; }
  hello();</code></pre>
<p>Wrapped into a <code>run()</code> subroutine it becomes:</p>
<pre><code>
  simple.pl
  ---------
  package cache::simple_2epl;

  sub run{
    #!/usr/bin/perl 
    sub hello { print &quot;Hello&quot; }
    hello();
  }</code></pre>
<p>Therefore, <code>hello()</code> is an inner subroutine and if you have used <code>my()</code>
scoped variables defined and altered outside and used inside hello(),
it won't work as you expect starting from the second call, as was
explained in the previous section.</p>


<h4><a name="remedies for inner subroutines">Remedies for Inner Subroutines</a></h4>
<p>First of all, there is nothing to worry about, as long as you don't
forget to turn the warnings On.  If you do happen to have the <em>``my()
Scoped Variable in Nested Subroutines''</em> problem, then Perl will always
alert you.</p>
<p>Given that you have a script that has this problem, what are the ways
to solve it? There are many of them and we will discuss some of them
here.</p>
<p>We will use the following code to show the different solutions.</p>
<pre><code>
  multirun.pl
  -----------
  #!/usr/bin/perl -w

  use strict;

  for (1..3){
    print &quot;run: [time $_]\n&quot;;
    run();
  }

  sub run{
    my $counter = 0;

    increment_counter();
    increment_counter();

    sub increment_counter{
      $counter++;
      print &quot;Counter is equal to $counter !\n&quot;;
    }

  } # end of sub run</code></pre>
<p>This code executes the <code>run()</code> subroutine three times, which in turn
initializes the <code>$counter</code> variable to 0 each time it is executed
and then calls the inner subroutine <code>increment_counter()</code> twice. Sub
<code>increment_counter()</code> prints <code>$counter</code>'s value after incrementing
it. One might expect to see the following output:</p>
<pre><code>
  run: [time 1]
  Counter is equal to 1 !
  Counter is equal to 2 !
  run: [time 2]
  Counter is equal to 1 !
  Counter is equal to 2 !
  run: [time 3]
  Counter is equal to 1 !
  Counter is equal to 2 !</code></pre>
<p>But as we have already learned from the previous sections, this is not
what we are going to see. Indeed, when we run the script we see:</p>
<pre><code>
  % ./multirun.pl
  Variable &quot;$counter&quot; will not stay shared at ./nested.pl line 18.
  run: [time 1]
  Counter is equal to 1 !
  Counter is equal to 2 !
  run: [time 2]
  Counter is equal to 3 !
  Counter is equal to 4 !
  run: [time 3]
  Counter is equal to 5 !
  Counter is equal to 6 !</code></pre>
<p>Obviously, the <code>$counter</code> variable is not reinitialized on each
execution of run(). It retains its value from the previous execution,
and sub <code>increment_counter()</code> increments that.</p>
<p>One of the workarounds is to use globally declared variables, with the
<code>vars</code> pragma.</p>
<pre><code>
  multirun1.pl
  -----------
  #!/usr/bin/perl -w

  use strict;
  use vars qw($counter);

  for (1..3){
    print &quot;run: [time $_]\n&quot;;
    run();
  }

  sub run {

    $counter = 0;

    increment_counter();
    increment_counter();

    sub increment_counter{
      $counter++;
      print &quot;Counter is equal to $counter !\n&quot;;
    }

  } # end of sub run</code></pre>
<p>If you run this and the other solutions offered below, then the expected
output will be generated:</p>
<pre><code>
  % ./multirun1.pl

  run: [time 1]
  Counter is equal to 1 !
  Counter is equal to 2 !
  run: [time 2]
  Counter is equal to 1 !
  Counter is equal to 2 !
  run: [time 3]
  Counter is equal to 1 !
  Counter is equal to 2 !</code></pre>
<p>By the way, the warning we saw before has gone, and so has the
problem, since there is no <code>my()</code> (lexically defined) variable used
in the nested subroutine.</p>












<p>Another approach is to use fully qualified variables. This is better,
since less memory will be used, but it adds a typing overhead:</p>
<pre><code>
  multirun2.pl
  -----------
  #!/usr/bin/perl -w

  use strict;

  for (1..3){
    print &quot;run: [time $_]\n&quot;;
    run();
  }

  sub run {

    $main::counter = 0;

    increment_counter();
    increment_counter();

    sub increment_counter{
      $main::counter++;
      print &quot;Counter is equal to $main::counter !\n&quot;;
    }

  } # end of sub run</code></pre>
<p>You can also pass the variable to the subroutine by value and make the
subroutine return it after it was updated. This adds time and memory
overheads, so it may not be good idea if the variable can be very
large, or if speed of execution is an issue.</p>
<p>Don't rely on the fact that the variable is small during the
development of the application, it can grow quite big in situations
you don't expect. For example, a simple HTML form text entry
field can return a few megabytes of data if one of your users is bored
and wants to test how good your code is. It's not uncommon to see
users copy-and-paste 10Mb core dump files into a form's text fields
and then submit it for your script to process.</p>
<pre><code>
  multirun3.pl
  -----------
  #!/usr/bin/perl -w

  use strict;

  for (1..3){
    print &quot;run: [time $_]\n&quot;;
    run();
  }

  sub run {

    my $counter = 0;

    $counter = increment_counter($counter);
    $counter = increment_counter($counter);

    sub increment_counter{
      my $counter = shift;

      $counter++;
      print &quot;Counter is equal to $counter !\n&quot;;

      return $counter;
    }

  } # end of sub run</code></pre>
<p>Finally, you can use references to do the job. The version of
<code>increment_counter()</code> below accepts a reference to the <code>$counter</code>
variable and increments its value after first dereferencing it. When
you use a reference, the variable you use inside the function is
physically the same bit of memory as the one outside the function.
This technique is often used to enable a called function to modify
variables in a calling function.</p>
<pre><code>
  multirun4.pl
  -----------
  #!/usr/bin/perl -w

  use strict;

  for (1..3){
    print &quot;run: [time $_]\n&quot;;
    run();
  }

  sub run {

    my $counter = 0;

    increment_counter(\$counter);
    increment_counter(\$counter);

    sub increment_counter{
      my $r_counter = shift;

      $$r_counter++;
      print &quot;Counter is equal to $$r_counter !\n&quot;;
    }

  } # end of sub run</code></pre>
<p>Here is yet another and more obscure reference usage. We modify the
value of <code>$counter</code> inside the subroutine by using the fact that
variables in <code>@_</code> are aliases for the actual scalar parameters. Thus
if you called a function with two arguments, then those would be stored in
<code>$_[0]</code> and <code>$_[1]</code>. In particular, if an element <code>$_[0]</code> is
updated, then the corresponding argument is updated (or an error occurs if
it is not updatable as would be the case of calling the function with
a literal, e.g. <em>increment_counter(5)</em>).</p>
<pre><code>
  multirun5.pl
  -----------
  #!/usr/bin/perl -w

  use strict;

  for (1..3){
    print &quot;run: [time $_]\n&quot;;
    run();
  }

  sub run {

    my $counter = 0;

    increment_counter($counter);
    increment_counter($counter);

    sub increment_counter{
      $_[0]++;
      print &quot;Counter is equal to $_[0] !\n&quot;;
    }

  } # end of sub run</code></pre>
<p>The approach given above is generally not recommended because most
Perl programmers will not expect <code>$counter</code> to be changed by the
function; the example where we used <code>\$counter</code>,
i.e. pass-by-reference would be preferred.</p>
<p>Here is a solution that avoids the problem entirely by splitting the
code into two files: The first is really just a wrapper and loader,
the second file contains the heart of the code.</p>
<pre><code>
  multirun6.pl
  -----------
  #!/usr/bin/perl -w

  use strict;
  require 'multirun6-lib.pl' ;

  for (1..3){
    print &quot;run: [time $_]\n&quot;;
    run();
  }</code></pre>
<p>Separate file:</p>
<pre><code>
  multirun6-lib.pl
  ----------------
  use strict ;

  my $counter;
  sub run {
    $counter = 0;
    increment_counter();
    increment_counter();
  }

  sub increment_counter{
    $counter++;
    print &quot;Counter is equal to $counter !\n&quot;;
  }

  1 ;</code></pre>
<p>Now you have at least six workarounds to choose from.</p>
<p>For more information, please refer to perlref and perlsub manpages.</p>

<table width="150" border="0" cellspacing="0" cellpadding="4" align="right">
<tr> 
<td width="150" valign="top" height="4" bgcolor="#6699cc"></td></tr> 
<tr>
<td bgcolor="#efefef">
<p class="headline" align="center">Previously in the Series
</p>
<p class="secondary">
<a href="/pub/a/2002/04/23/mod_perl.html">The Perl You Need To Know</a><br /><br />
<a href="/pub/a/2002/04/10/mod_perl.html">Installing mod_perl without superuser privileges</a><br /><br />
<a href="/pub/a/2002/03/22/modperl.html">mod_perl in 30 minutes</a><br /><br />
<a href="/pub/a/2002/02/26/whatismodperl.html">Why mod_perl?</a>


</td></tr> <tr><td width="150" valign="top" height="4" bgcolor="#6699cc"> </td></tr></table>

<h3><a name="perldoc's rarely known but very useful options">perldoc's Rarely Known But Very Useful Options</a></h3>
<p>It's a known fact that one cannot become a Perl hacker and especially
mod_perl hacker without knowing how to read Perl documentation and
search through it.  Books are good, but an easily accessible and
searchable Perl reference at your fingertips is a great time saver. It
always has the up-to-date information for the version of perl you're
using.</p>
<p>Of course, you can use online Perl documentation at the Web. I prefer
<a href="http://theoryx5.uwinnipeg.ca/CPAN/perl/">http://theoryx5.uwinnipeg.ca/CPAN/perl/</a> to the official URL:
<a href="/pub/v/documentation">http://www.perl.com/pub/v/documentation</a> is very slow :( . The
<code>perldoc</code> utility provides you with access to the documentation
installed on your system.  To find out what Perl manpages are
available execute:</p>
<pre><code>
  % perldoc perl</code></pre>
<p>To find what functions perl has, execute:</p>
<pre><code>
  % perldoc perlfunc</code></pre>
<p>To learn the syntax and to find examples of a specific function, you
would execute (e.g. for <code>open()</code>):</p>
<pre><code>
  % perldoc -f open</code></pre>
<p>Note: In perl5.005_03 and earlier, there is a bug in this and the
<code>-q</code> options of <code>perldoc</code>.  It won't call <code>pod2man</code>, but will
display the section in POD format instead.  Despite this bug it's
still readable and very useful.</p>
<p>The Perl FAQ (<em>perlfaq</em> manpage) is in several sections.  To search
through the sections for <code>open</code> you would execute:</p>
<pre><code>
  % perldoc -q open</code></pre>
<p>This will show you all the matching question-and-answer sections,
still in POD format.</p>
<p>To read the <em>perldoc</em> manpage you would execute:</p>
<pre><code>
  % perldoc perldoc</code></pre>

<h3><a name="references">References</a></h3>
<ul>
<li>
Online documentation:
<a href="http://theoryx5.uwinnipeg.ca/CPAN/perl/">http://theoryx5.uwinnipeg.ca/CPAN/perl/</a>
<a href="/pub/v/documentation/">http://www.perl.com/pub/v/documentation/</a>
<p></p>
<li>
The book ``<em>Programming Perl</em>'' 3rd edition by L.Wall, T. Christiansen
and J.Orwant (also known as the ``<em>Camel</em>'' book, named after the camel
picture on the cover of the book). You want to refer to Chapter 8 that
talks about nested subroutines among other things.
<p></p>
<li>
The <em>perlref</em> and <em>perlsub</em> man pages.
<p></p></ul>



                                    </div>


                                </div>
                                <div class="asset-footer">


                                    <div class="entry-tags">
                                        <h4>Tags<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=mod_perl%20perl%20subroutines%20stay%20shared&amp;limit=20';return false;" rel="tag">mod_perl perl subroutines stay shared</a></li>
                                        </ul>
                                    </div>

                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
