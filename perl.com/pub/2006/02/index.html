<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: February 2006 Archives</title>


    <link rel="prev" href="/pub/2006/01/" title="January 2006" />
    <link rel="next" href="/pub/2006/03/" title="March 2006" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">February 2006 Archives</h1>





                            
                            <div id="entry-686" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2006/02/23/advanced_subroutines.html" rel="bookmark">Advanced Subroutine Techniques</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Rob Kinyon</span> on <abbr class="published" title="2006-02-23T00:00:00-08:00">February 23, 2006 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<p>In "<a href="/pub/a/2005/11/03/subroutines.html">Making Sense of Subroutines</a>," I wrote about what subroutines are and why you want to use them. This article expands on that topic, discussing some of the more common techniques for subroutines to make them even more useful.</p>

<p>Several of these techniques are advanced, but you can use each one by itself without understanding the others. Furthermore, not every technique is useful in every situation. As with all techniques, consider these as tools in your toolbox, not things you have to do every time you open your editor.</p>

<h3>Named Arguments</h3>

<h4>Positional Arguments</h4>

<p>Subroutines, by default, use "positional arguments." This means that the arguments to the subroutine must occur in a specific order. For subroutines with a small argument list (three or fewer items), this isn't a problem.</p>

<pre><code>sub pretty_print {
    my ($filename, $text, $text_width) = @_;

    # Format $text to $text_width somehow.

    open my $fh, '&gt;', $filename
        or die "Cannot open '$filename' for writing: $!\n";

    print $fh $text;

    close $fh;

    return;
}

pretty_print( 'filename', $long_text, 80 );</code></pre>

<h4>The Problem</h4>

<p>However, once everyone starts using your subroutine, it starts expanding what it can do. Argument lists tend to expand, making it harder and harder to remember the order of arguments.</p>

<pre><code>sub pretty_print {
    my (
        $filename, $text, $text_width, $justification, $indent,
        $sentence_lead
    ) = @_;

    # Format $text to $text_width somehow. If $justification is set, justify
    # appropriately. If $indent is set, indent the first line by one tab. If
    # $sentence_lead is set, make sure all sentences start with two spaces.

    open my $fh, '&gt;', $filename
        or die "Cannot open '$filename' for writing: $!\n";

    print $fh $text;

    close $fh;

    return;
}

pretty_print( 'filename', $long_text, 80, 'full', undef, 1 );</code></pre>

<p>Quick--what does that <code>1</code> at the end of the subroutine mean? If it took you more than five seconds to figure it out, then the subroutine call is unmaintainable. Now, imagine that the subroutine isn't right there, isn't documented or commented, and was written by someone who is quitting next week.</p>

<h4>The Solution</h4>

<p>The most maintainable solution is to use "named arguments." In Perl 5, the best way to implement this is by using a hash reference. Hashes also work, but they require additional work on the part of the subroutine author to verify that the argument list is even. A hashref makes any unmatched keys immediately obvious as a compile error.</p>

<pre><code>sub pretty_print {
    my ($args) = @_;

    # Format $args-&gt;{text} to $args-&gt;{text_width} somehow.
    # If $args-&gt;{justification} is set, justify appropriately.
    # If $args-&gt;{indent} is set, indent the first line by one tab.
    # If $args-&gt;{sentence_lead} is set, make sure all sentences start with
    # two spaces.

    open my $fh, '&gt;', $args-&gt;{filename}
        or die "Cannot open '$args-&gt;{filename}' for writing: $!\n";

    print $fh $args-&gt;{text};

    close $fh;

    return;
}

pretty_print({
    filename      =&gt; 'filename',
    text          =&gt; $long_text,
    text_width    =&gt; 80,
    justification =&gt; 'full',
    sentence_lead =&gt; 1,
});</code></pre>

<p>Now, the reader can immediately see exactly what the call to <code>pretty_print()</code> is doing.</p>

<h4>And Optional Arguments</h4>

<p>By using named arguments, you gain the benefit that some or all of your arguments can be optional without forcing our users to put <code>undef</code> in all of the positions they don't want to specify.</p>

<csperl file="grab" domain="on" record="b/1714" template="b/article_sidebar2.view">













<h3>Validation</h3>

<p>Argument validation is more difficult in Perl than in other languages. In C or Java, for instance, every variable has a type associated with it. This includes subroutine declarations, meaning that trying to pass the wrong type of variable to a subroutine gives a compile-time error. By contrast, because <code>perl</code> flattens everything to a single list, there is no compile-time checking at all. (Well, there kinda is with prototypes.)</p>

<p>This has been such a problem that there are dozens of modules on CPAN to address the problem. The most commonly recommended one is <a href="http://search.cpan.org/perldoc?Params::Validate"><code>Params::Validate</code></a>.</p>

<h3>Prototypes</h3>

<p>Prototypes in Perl are a way of letting Perl know exactly what to expect for a given subroutine, at compile time. If you've ever tried to pass an array to the <code>vec()</code> built-in and you saw <code>Not enough arguments for vec</code>, you've hit a prototype.</p>

<p>For the most part, prototypes are more trouble than they're worth. For one thing, Perl doesn't check prototypes for methods because that would require the ability to determine, at compile time, which class will handle the method. Because you can alter <code>@ISA</code> at runtime--you see the problem. The main reason, however, is that prototypes aren't very smart. If you specify <code>sub foo ($$$)</code>, you cannot pass it an array of three scalars (this is the problem with <code>vec()</code>). Instead, you have to say <code>foo( $x[0], $x[1], $x[2] )</code>, and that's just a pain.</p>

<p>Prototypes <em>can</em> be very useful for one reason--the ability to pass subroutines in as the first argument. <a href="http://search.cpan.org/perldoc?Test::Exception"><code>Test::Exception</code></a> uses this to excellent advantage:</p>

<pre><code>sub do_this_to (&amp;;$) {
    my ($action, $name) = @_;

    $action-&gt;( $name );
}

do_this_to { print "Hello, $_[0]\n" } 'World';
do_this_to { print "Goodbye, $_[0]\n" } 'cruel world!';</code></pre>

<h3>Context Awareness</h3>

<p>Using the <code>wantarray</code> built-in, a subroutine can determine its calling context. Context for subroutines, in Perl, is one of three things--list, scalar, or void. List context means that the return value will be used as a list, scalar context means that the return value will be used as a scalar, and void context means that the return value won't be used at all.</p>

<pre><code>sub check_context {
    # True
    if ( wantarray ) {
        print "List context\n";
    }
    # False, but defined
    elsif ( defined wantarray ) {
        print "Scalar context\n";
    }
    # False and undefined
    else {
        print "Void context\n";
    }
}

my @x       = check_context();  # prints 'List context'
my %x       = check_context();  # prints 'List context'
my ($x, $y) = check_context();  # prints 'List context'

my $x       = check_context();  # prints 'Scalar context'

check_context();                # prints 'Void context'</code></pre>

<p>For CPAN modules that implement or augment context awareness, look at <a href="http://search.cpan.org/perldoc?Contextual::Return"><code>Contextual::Return</code></a>, <a href="http://search.cpan.org/perldoc?Sub::Context"><code>Sub::Context</code></a>, and <a href="http://search.cpan.org/perldoc?Return::Value"><code>Return::Value</code></a>.</p>

<p>Note: you can misuse context awareness heavily by having the subroutine do something completely different when called in scalar versus list context. Don't do that. A subroutine should be a single, easily identifiable unit of work. Not everyone understands all of the different permutations of context, including your standard Perl expert.</p>

<p>Instead, I recommend having a standard return value, except in void context. If your return value is expensive to calculate and is calculated only for the purposes of returning it, then knowing if you're in void context may be very helpful. This can be a premature optimization, however, so always measure (benchmarking and profiling) before and after to make sure you're optimizing what needs optimizing.</p>

<h3>Mimicking Perl's Internal Functions</h3>

<p>A lot of Perl's internal functions modify their arguments and/or use <code>$_</code> or <code>@_</code> as a default if no parameters are provided. A perfect example of this is <code>chomp()</code>. Here's a version of <code>chomp()</code> that illustrates some of these techniques:</p>

<pre><code>sub my_chomp {
    # This is a special case in the chomp documentation
    return if ref($/);

    # If a return value is expected ...
    if ( defined wantarray ) {
        my $count = 0;
        $count += (@_ ? (s!$/!!g for @_) : s!$/!!g);
        return $count;
    }
    # Otherwise, don't bother counting
    else {
        @_ ? do{ s!$/!!g for @_ } : s!$/!!g;
        return;
    }
}</code></pre>

<ul>
<li>Use <code>return;</code> instead of <code>return undef;</code> if you want to return nothing. If someone assigns the return value to an array, the latter creates an array of one value (<code>undef</code>), which evaluates to true. The former will correctly handle all contexts.</li>

<li>If you want to modify <code>$_</code> if no parameters are given, you have to check <code>@_</code> explicitly. You cannot do something like <code>@_ = ($_) unless @_;</code> because <code>$_</code> will lose its magic.</li>

<li>This doesn't calculate <code>$count</code> unless <code>$count</code> is useful (using a check for void context).</li>

<li>The key is the aliasing of <code>@_</code>. If you modify <code>@_</code> directly (as opposed to assigning the values in <code>@_</code> to variables), then you modify the actual parameters passed in.</li>
</ul>

<h3>Conclusion</h3>

<p>I hope I have introduced you to a few more tools in your toolbox. The art of writing a good subroutine is very complex. Each of the techniques I have presented is one tool in the programmer's toolbox. Just as a master woodworker wouldn't use a drill for every project, a master programmer doesn't make every subroutine use named arguments or mimic a built-in. You must evaluate each technique every time to see if it will make the code more maintainable. Overusing these techniques will make your code <em>less</em> maintainable. Using them appropriately will make your life easier.</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-684" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2006/02/16/mldbm.html" rel="bookmark">Managing Rich Data Structures</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Dave Baker</span> on <abbr class="published" title="2006-02-16T00:00:00-08:00">February 16, 2006 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->

<p>As a Perl beginner, I wrote many scripts that created text files to store
snippets of data. Eventually I had hundreds of little text files in a data
directory, each one holding one piece of information in the form of a text
string. I decided to move from snippets to a single database. Here's how I did
it.</p>

<p>I didn't go all the way to creating a relational database with SQL, in part
because I had not yet learned to use Perl modules to work with such databases.
Plus I wanted to try the apparently simpler technique described in Chapters 11
and 14 of <a href="http://www.oreilly.com/catalog/perlckbk2/">Perl Cookbook,
2nd Edition</a>, namely the use of one of the DBM libraries. I was intrigued by
the idea of creating and using a database without needing to learn SQL or run a
database server such as PostgreSQL or MySQL.</p>

<p>One of my scripts created HTML for a clickable banner ad; the HTML would be
inserted into an HTML email newsletter I publish daily. For any particular
issue, the script pulled data from three different text files, each of which
held a different piece of information in the form of a text string on the
file's first and only line:</p>

<ul>
<li>The URL of the advertiser's web page, to which the reader would be taken when the banner is clicked,</li>
<li>The location of the .gif file (the banner), or</li>
<li>A one-line headline that would appear above the banner.</li>
</ul>

<p>A different script created those files and named them according to (i) the
type of data in the file and (ii) the date of the newsletter in which the ad
would appear. For example, data for the December 9, 2005 ad was contained in
three files named <em>url_2005_12_09</em>, <em>gif_2005_12_09</em> and
<em>headline_2005_12_09</em>.</p>

<h3>A Hash of Hashes</h3>

<p>First I considered the kind of data structure needed to hold the data. I
looked at the relationship between the three text files. It became clear that I
basically had a hash for each ad. The data for any particular ad consisted of
three different keys and their values: URL, gif and headline. The name of any
particular file would provide the key (the type of information contained in the
file). The contents of the file would provide the key's value.</p>

<p>I thought about finding some way to store those hashes as an array of
anonymous hashes (one hash per ad), but then I realized that an array wouldn't
let me access a particular ad's data easily. The hashes would be in the order
in which I saved them into the array, but that wouldn't translate easily to the
ad for a particular date. For example, how would I know where to find the data
for next Monday's newsletter? Is it in <code>$array[8] </code> or
<code>$array[17]</code>? </p>

<p>Hmm. Each anonymous hash could be identified by a particular date--the key
(!) to locating the ad for any particular date. What kind of data structure
associates a unique key with a value? A hash, of course! My data would fit
nicely into a hash of hashes.</p>

<p>The name I chose for the hash was <code>%data_for_ad_on</code>. Choosing a
hash name that ends in a preposition provides a more natural-reading and
meaningful name; the key for data for the December 8, 2005 banner ad would be
<code>2005_12_08</code>, for example, and the way to access the value
associated with that key would be <code>$data_for_ad_on{2005_12_08}</code>.</p>

<p>In code, this is how the data for two days of newsletters could be
represented as a hash of hashes:</p>

<pre><code>%data_for_ad_on = (

  '2005_12_08' =&gt; { 'url'      =&gt; 'http://roadrunners-r-us.com/index.html',
                    'gif'      =&gt; 'http://myserver.com/banners/roadrunners_banner.gif',
                    'headline' =&gt; 'Use Roadrunners R Us for speedy, reliable deliveries!',
                  },

  '2005_12_09' =&gt; { 'url'      =&gt; 'http://acme.com/index.html',
                    'gif'      =&gt; 'http://myserver.com/banners/acme_banner.gif',
                    'headline' =&gt; 'Look to Acme for quality, inexpensive widgets!',
                  },
);</code></pre>

<p>The keys of the named hash are 2005_12_08 and 2005_12_09. Each key's value
is a reference to an anonymous hash that contains its own keys and values. When
a hash is created using braces instead of parentheses, its value is a reference
to that unnamed, "anonymous" hash. I need to use a reference because a hash is
permitted to contain only scalar keys and scalar values; another hash can't be
stored as a value. A reference to that hash works, because it acts like a
scalar.</p>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1714" template="b/article_sidebar2.view">
<!-- sidebar ends -->

<h3>Storing the Data</h3>

<p>Now I knew what the data structure would be; but how would I store it? Being
Perl, of course there's more than one way to store data to disk. Some of those
solutions involve the parsing of potentially large amounts of data and then the
need to programmatically find a particular desired piece of data, however.</p>

<p>I came across a single-file database solution in Recipes 11.14 and 14.6 of
<em>Perl Cookbook, 2nd Edition</em>. These describe the use of a DBM file on
disk. A Perl script can read data from a DBM file as if it were contained in a
hash in memory. For data having unique keys, it's a great fit. In addition to
data persistence from one run of your script to the next, using a DBM database
file means your script won't need to read all the data into memory. Instead,
you pull up only data associated with a particular key. This applies especially
to large data sets; a DBM database file on disk might hold data for hundreds of
thousands of keys.</p>

<p>A straightforward but tedious way to get data into a DBM file is shown
below. The code creates a database called ad_data.db and inserts data for two
newsletters.</p>

<pre><code>#!/usr/local/bin/perl
use strict;
use warnings;
use MLDBM qw( DB_File Storable );
use Fcntl qw( :flock O_CREAT O_RDWR );

my $db = '/www/cgi-bin/databases/ad_data.db';
my %data_for_ad_on;

tie %data_for_ad_on, 'MLDBM', $db, O_CREAT|O_RDWR, 0644
  or die "Trouble opening $db, stopped: $!";

%data_for_ad_on = (
  '2005_12_09' =&gt; { 'url'      =&gt; 'http://acme.com/index.html',
                    'gif'      =&gt; 'http://myserver.com/banners/acme_banner.gif',
                    'headline' =&gt; 'Look to Acme for quality, inexpensive widgets!',
                  },

  '2005_12_08' =&gt; { 'url'      =&gt; 'http://roadrunners-r-us.com/index.html',
                    'gif'      =&gt; 'http://myserver.com/banners/roadrunners_banner.gif',
                    'headline' =&gt; 'Use Roadrunners R Us for speedy, reliable deliveries!',
                  },
);</code></pre>

<p>After the script is run, the data contained in <code>%data_for_ad_on</code>
are saved automatically into the DBM database file named
<code>/www/cgi-bin/databases/ad_data.db</code>.</p>

<p>The secret is Perl's <code>tie</code> function. It associates a particular
hash (here named <code>%data_for_ad_on </code>) with a "class" and a file. A
class that works for "complex" data (data containing references) is the <a
href= "http://search.cpan.org/perldoc?MLDBM">MLDBM</a> module, available from
CPAN.</p>

<p>Note: if the values being stored are scalars only, a tied hash using the
DB_File module as the class, rather than the <code>MLDBM</code> module, will be
much easier to work with. I'm using <code>MLDBM</code> because my values
include references to data structures. I'll discuss some of
<code>MLDBM</code>'s limitations later in this article.</p>

<p>The script shown above uses the <a
href="http://search.cpan.org/perldoc?Fcntl">Fcntl</a> module to make it easier
to create or update the DBM database file. The imported <code>
O_CREAT|O_RDWR</code> parameters tell the script to create the database file if
it doesn't yet exist or to update (read/write) the file if it exists.</p>

<p>The <code>DB_File</code> and <code>Storable</code> parameters passed to
<code>MLDBM</code> specify the particular kind of DBM database to use and the
serialization module to use. They handle the behind-the-scenes conversion of
references into strings. (A recent version of <code>MLDBM</code> is necessary
to be able to specify such parameters.) <code>DB_File</code> won't work with
every system, however, because it depends upon your system's configuration,
like all DBM modules. In particular, the Berkeley DB library (a C library) must
be present; see the <code>DB_File</code> documentation for details. You can get
another DBM module from CPAN if <code>DB_File</code> won't work for you.</p>

<p>Manually entering hash keys and their values into a script is time-consuming
and error-prone, of course. I prefer to programmatically add data created or
copied from existing files, and used a script to copy data from my hundreds of
text files into the DBM database file.<p>

<pre><code>#!/usr/local/bin/perl -T
use strict;
use warnings;
use MLDBM qw( DB_File Storable );
use Fcntl qw( :flock O_CREAT O_RDWR );

my $db = '/www/cgi-bin/databases/ad_data.db';
my %data_for_ad_on;

tie %data_for_ad_on, 'MLDBM', $db, O_CREAT|O_RDWR, 0644
  or die "Can't open $db: $!";

my $data_dir = '/www/cgi-bin/newsletter_data_text_files';

opendir my $dir_handle, $data_dir
  or die "Can't open $data_dir, stopped: $!";

# All of the data files are in the same directory; each file's name
# is url_YYYY_MM_DD, gif_YYYY_MM_DD or headline_YYYY_MM_DD (where
# YYYY is the year, MM is the month, with a leading zero if needed,
# and DD is the day of the month, with a leading zero if needed).
# No other files in that directory end with YYYY_MM_DD.

my @data_files = grep { /\d\d\d\d_\d\d_\d\d$/ } readdir $dir_handle;

close $dir_handle;

my $entry;
foreach my $file ( @data_files ) {

  # Test the filename to see if the file contains the advertiser's
  # URL...

  if ($file =~ /^url_(\d\d\d\d_\d\d_\d\d)/ ) {

      $entry = $data_for_ad_on{$1};

      open (FILE, "$data_dir/$file") or die;
      my $url = do { local $/; &lt;FILE&gt; };
      close FILE;

      $entry-&gt;{url}       = $url;
      $data_for_ad_on{$1} = $entry;
      print "Advertiser's URL for $1 has been saved.\n";

  # Test the filename to see if the file contains the .gif location...

  } elsif ($file =~ /^gif_(\d\d\d\d_\d\d_\d\d)/ ) {

      $entry = $data_for_ad_on{$1};

      open (FILE, "$data_dir/$file") or die;
      my $gif = do { local $/; &lt;FILE&gt; };
      close FILE;

      $entry-&gt;{gif}       = $gif;
      $data_for_ad_on{$1} = $entry;
      print ".gif file location for $1 has been saved.\n";

  # Test the filename to see if the file contains the headline...

  } elsif ($file =~ /^headline_(\d\d\d\d_\d\d_\d\d)/ ) {

      $entry = $data_for_ad_on{$1};

      open (FILE, "$data_dir/$file") or die;
      my $headline = do { local $/; &lt;FILE&gt; };
      close FILE;

      $entry-&gt;{headline}  = $headline;
      $data_for_ad_on{$1} = $entry;
      print "Headline for $1 has been saved.\n";
  }

}</code></pre>

<p>A limitation of <code>MLDBM</code> is that you can't work piecemeal with the
data structures (the values for keys in the tied hash). You must retrieve a
copy of the data structure in the form of a reference (<code>$entry</code> in
the example); use that reference to add, update or delete parts of the data
structure; and then save the reference back to the database in order for
<code>MLDBM</code> to put the changed data structure back onto disk. This is
because the data structure is no longer tied, once it has been retrieved from
disk.</p>

<p>For example, the script above works piecemeal with the data structure: it
builds one key at a time in the anonymous hash.  A temporary variable called
$entry holds a reference to the retrieved anonymous hash, which now exists in
memory; then <code>$entry</code> is used to dereference the anonymous hash (and
to select a named key in the hash, on the right side of the infix operator);
then the script alters a part of that data structure (assigning a value to the
named key); then the now-changed anonymous hash is saved back into the database
file on disk by assigning <code>$entry</code> to the key.</p>

<p>As shown in earlier examples, an entire data structure can be stored as the
value of a key in the tied hash without fetching the existing data structure
(if any) associated with that key. In such a case, you're overwriting any
existing data structure completely, so there is no need to fetch the existing
data structure first or to work with it using the temporary variable
technique.</p>

<p>Note: a recently added CPAN module called <code>DBM_Deep</code> allows tied
hashes of complex data as does <code>MLDBM</code>, but appears to avoid the
need for fetching data first in order to work with it through a temporary
variable.</p>

<p>By the way, <code>MLDBM</code> allows stored data structures to be arrays,
not just hashes. Hence <code>MLDBM</code> might be a good disk-based storage
solution for you if a hash of arrays works best to hold your data. Plus,
whether you're storing a hash of hashes or a hash of arrays, those stored
hashes or arrays are permitted to contain values that consist of even more
hashes or arrays!</p>

<p>Another thing to know about <code>MLDBM</code> is that file locking is not
provided automatically. The solution presented in this article works well in a
single-user environment, but data corruption is possible when more than one
instance of the script (or more than one script) needs to access the disk-based
data while another process is writing to it. See section 10.2.1 of <a
href="http://www.oreilly.com/catalog/cgi2/">CGI Programming with Perl</a> for
an example of file locking with the DB_File DBM module.</p>

<h3>Reading HoH Data</h3>

<p>Here is a portion of a script that prints a report for my stored newsletter
data.</p>

<p>I reach into the <code>%data_for_ad_on</code> hash by specifying a key (the
date of a particular newsletter); the key's associated value is a reference to
the anonymous hash holding ad data for that date.  Use infix (arrow) notation
to dereference the anonymous hash and also to access a specified key.</p>

<pre><code>tie %data_for_ad_on, 'MLDBM', $db, O_RDWR, 0644
  or die "Can't open $db: $!";

my @newsletter_dates = sort keys %data_for_ad_on;

foreach my $date ( @newsletter_dates ) {

   my $url      = $data_for_ad_on{$date}-&gt;{url};
   my $gif      = $data_for_ad_on{$date}-&gt;{gif};
   my $headline = $data_for_ad_on{$date}-&gt;{headline};

   print "\nHere are details for the banner ad in the $date newsletter:\n";
   print "          Advertiser's URL: $url\n";
   print "        Location of banner: $gif\n";
   print "     Headline above banner: $headline\n";
}</code></pre>

<p>A temporary variable to work with the data was unnecessary because I was
merely reading data. I had no need to save a changed data structure back to
disk after working with it. A temporary variable would be needed as a reference
to the data structure, as noted earlier, if I were adding, updating or deleting
something in the data structure, in order to save the changed data structure
back to disk.</p>

<p>Nevertheless, a temporary variable is useful for storing a fetched data
structure even when a tied hash is being used only to read data from disk. The
<code>MLDBM</code> documentation points out that disk fetch occurs each time a
script names a key in the tied hash; a new copy of the entire data structure
for that key gets created with each fetch. For efficiency, scripts that merely
    read data work better if the data structure for a particular key is stored
    first into a temporary variable and the script works with that single copy
    of data in memory. For example, the lines in the preceding code that get
    values for <code>$url</code>, <code>$gif</code>, and <code>$headline</code>
    should be rewritten to cut the number of fetches from three to one:</p>

<pre><code>   my $entry    = $data_for_ad_on{$date};
   my $url      = $entry-&gt;{url};
   my $gif      = $entry-&gt;{gif};
   my $headline = $entry-&gt;{headline};
</code></pre>

<h3>Updating HoH Data</h3>

<p>My next task was to update existing data. An advertiser informed me that its
web page had changed. The advertiser's banner ad in a particular upcoming
newsletter needed to point to the new page rather than to the URL I had stored
earlier for the ad. So I tried this:</p>

<pre><code>tie %data_for_ad_on, 'MLDBM', $db, O_CREAT|O_RDWR, 0644
  or die "Can't open $db: $!";

$data_for_ad_on{'2005_12_14'}-&gt;{url}
  = 'http://roadrunners-r-us.com/new_home_page.html';   # WRONG</code></pre>

<p>Despite the apparently correct syntax, the line marked "# WRONG" did not
change the data in the tied hash. <code>MLDBM</code> can't add, update or
delete just a part of a data structure stored on disk; it must retrieve the
entire data structure first. Unfortunately that doesn't happen automatically
when a part of the tied hash is used as an lvalue (the left side of an
assignment).</p>

<p>Here is the correct syntax for updating part of a data structure:</p>

<pre><code>my $entry = $data_for_ad_on{'2005_12_14'};                        # Get
$entry-&gt;{url} = 'http://roadrunners-r-us.com/new_home_page.html'; # Change
$data_for_ad_on{'2005_12_14'} = $entry;                           # Save</code></pre>

<p>A different kind of update would be to add a new kind of information to an
existing data structure. Until now I have been working with each ad's data as
an anonymous hash of three keys because I only had three pieces of information
per ad. Here's how I can modify the data structure for any particular ad--that
is, the value of any particular key in the tied hash--to include a fourth piece
of information. I'll record whether or not a particular ad has been billed.</p>

<pre><code>tie %data_for_ad_on, 'MLDBM', $db, O_CREAT|O_RDWR, 0644
  or die "Can't open $db: $!";

my $entry = $data_for_ad_on{'2005_12_02'};  # Get
$entry-&gt;{has_been_billed} = 'yes';           # Change (by creating a key and value)
$data_for_ad_on{'2005_12_02'} = $entry;      # Save
</code></pre>

<p>Adding a fourth key as shown is not remarkable because it's done the same
way I created the original three keys. But note how I've added a fourth key to
just one of the ads (for the 2005_12_02 newsletter). I don't need to define
such a fourth key in each of the other anonymous hashes because
<code>MLDBM</code> doesn't require that the anonymous hashes have the same
structure.</p>

<p>Now that I've added a fourth key to one of the ads, I want to see that key's
information when I run my report, even though the information for each of the
other newsletters is incomplete. Just as with a hash in memory, the
<code>exists</code> operator can test for the existence of a key in a tied
hash, or test for the existence of a key in one of the stored anonymous hashes.
The earlier reporting script can be improved:</p>

<pre><code>foreach my $date ( @newsletter_dates ) {

   my $entry    = $data_for_ad_on{$date};
   my $url      = $entry-&gt;{url};
   my $gif      = $entry-&gt;{gif};
   my $headline = $entry-&gt;{headline};

   my $has_been_billed = exists ( $entry-&gt;{has_been_billed} ) ?
                         $entry-&gt;{has_been_billed}
                         : 'Billing status is unknown';

   print "\nHere are details for the banner ad in the $date newsletter:\n";
   print "            Advertiser's URL: $url\n";
   print "          Location of banner: $gif\n";
   print "       Headline above banner: $headline\n";
   print "  Has advertiser been billed? $has_been_billed\n";
}
</code></pre>

<p>Note how a default value is provided for <code>$has_been_billed</code> (the
string 'Billing status is unknown'). If
<code>$entry-&gt;{has_been_billed}</code> had been assigned to
<code>$has_been_billed</code> without providing a default value, the script (if
it is using the <code>warnings</code> pragma) would report "Use of
uninitialized value in concatenation (.) or string" every time it processes the
"Has advertiser been billed?" statement for an anonymous hash that has no
<code>'has_been_billed'</code> key. The value of a nonexistent key in a hash is
undefined, whether or not the hash is tied.</p>

<p>Because the value of a nonexistent key in a hash is undefined, remember when
working with <code>MLDBM</code> not to assume your tied hash's keys will return
either a reference to a data structure or a reference to an empty data
structure. For example, this code produces a runtime error if the '2005_12_32'
key does not exist in the tied hash (there is no December 32) and the script is
using the strict pragma:</p>

<code><pre>my $entry = $data_for_ad_on{2005_12_32};
my %named_hash = %{ $entry };

if ( $named_hash{url} ) {
    print "The advertiser's URL for the ad dated 2005_12_32 is $named_hash{url}.\n";

} else {
    print "We have no URL on file for the ad dated 2005_12_32.\n";
}</code></pre>

<p>The runtime error would be 'Can't use string ("") as a HASH ref while "strict refs" in use' on the line number of <code>my %named_hash = %{ $entry }</code>. The code doesn't create a named hash that has no elements.</p>

<h3>Conclusion</h3>

<p>I hope this article helps you move from a swamp of weedy text files into the simplicity of a single disk-based database file. A DBM database file enables you to work with your data as if it were a single hash of keys and their values.</p>

<p>The <code>MLDBM</code> module extends the "hash on a disk" capability by letting you store a key's value as a hash, as illustrated in this article, or store a key's value as an array.<p>

<p><code>MLDBM</code> requires a special technique for working piecemeal with
stored hashes (or stored arrays). Also, the solution described works well in my
single-user environment; file locking to protect the disk-based data would
become important in a multi-user environment such as a script executed by a
publicly accessible web server.  Still, you get all this hash-like goodness for
key-based data without running a relational database server or using SQL,
without parsing large amounts of disk-based data, and without storing all the
data in memory first.</p>

<p>Happy hashing!</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-682" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2006/02/09/debug_mod_perl.html" rel="bookmark">Debugging and Profiling mod_perl Applications</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Frank Wiles</span> on <abbr class="published" title="2006-02-09T00:00:00-08:00">February  9, 2006 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<p>Because of the added complexity of being <em>inside</em> of the Apache web server, debugging <a href="http://perl.apache.org/"><code>mod_perl</code></a> applications is often not as straightforward as it is with regular Perl programs or CGIs. Is the problem with your code, Apache, a CPAN module you are using, or within <code>mod_perl</code> itself? How do you tell? Sometimes traditional debugging techniques will not give you enough information to find your problem.</p>

<p>Perhaps, instead, you're baffled as to why some code you just wrote is running so slow. You're probably asking yourself, "Isn't this <code>mod_perl</code> stuff supposed to improve my code's performance?" Don't worry, slow code happens even to the best of us. How do you profile your code to find the problem?</p>

<p>This article shows how to use the available CPAN modules to debug and profile your <code>mod_perl</code> applications.</p>

<h3>Traditional Debugging Methods</h3>

<p>The tried-and-true <code>print</code> statement is the debugger's best friend. Used wisely this, can be the easiest and fastest way of figuring out what is amiss in your program. Can't figure out why your sales tax subroutine is always off by 14 cents? Add several <code>print</code> statements just before, just after, and all around inside of that particular subroutine. Use them to show the value of key variables at each step in the process. You can direct the output straight onto the page in your browser, or if you prefer, into hidden HTML comments. Typically this is all that you need to spot your problems. It's flexible and easy to implement and understand.</p>

<p>Another common approach is to place <code>die()</code> and/or <code>warn()</code> statements as you trace through your code, isolating the problem. <code>die()</code> is especially useful if you do not want your program to continue executing, possibly because the errors will corrupt your otherwise valid testing data. The main benefit of using <code>warn</code> over a simple <code>print</code> statement is that the output goes instead to the appropriate Apache <em>error_log</em>. This keeps your debugging information out of the user interface and gives you the ability to log and spot errors long after they occurred for the user. Simply <code>tail</code> your <em>error_log</em> in another window and you can watch it all day long. If you're into that sort of thing.</p>

<p>For example, if you had some code like:</p>

<pre><code>sub handler {
    my $r   =   shift;

    # Set content type
    $r-&gt;content_type( 'text/html' );

    my $req = Apache2::Request-&gt;new($r);
   
    # Compute sales tax if we are told to do so
    my $tax = 0;
    if( $req-&gt;param('compute_sales_tax') ) {
        my $tax = compute_sales_tax($r, $req-&gt;param('total_amount');
    }

    # Code to display results to the browser....
}</code></pre>

<p>... you might find a problem during testing. Your initial search leads you to believe that either the code never calls the <code>compute_sales_tax()</code> function or the function always returns zero. You can add some simple debugging statements:</p>

<pre><code>sub handler {
    my $r   =   shift;
   
    # Set content type
    $r-&gt;content_type( 'text/html' );

    my $req = Apache2::Request-&gt;new($r);
   
    # Compute sales tax if we are told to do so
    my $tax = 0;

    # Debugging statements
    warn("Tax at start '$tax'");
    warn('compute_sales_tax ' . $req-&gt;param('compute_sales_tax') );

    if( $req-&gt;param('compute_sales_tax') ) {

        # Debugging
        warn("Tax before sub '$tax'");
        my $tax = compute_sales_tax($r, $req-&gt;param('total_amount');
        warn("Tax after sub '$tax'");
    }

    warn("Tax after if '$tax'");

    # Code to display results to the browser....
}</code></pre>

<p>Assuming that the page that directs the user to this code has set <code>compute_sales_tax</code> to a <code>true</code> value, you will see something similar to:</p>

<pre><code>Tax at start '0' at line 5
compute_sales_tax 1 at line 6
Tax before sub '0' at line 12
Tax after sub '1.36' at line 14
Tax after if '0' at line 17</code></pre>

<p>If you read through this, you see that <code>compute_sales_tax()</code> is indeed being called, otherwise you would not see the "Tax before/after" <code>warn</code> outputs. Directly after the subroutine call you can see that <code>$tax</code> holds a suitable value. However, after the <code>if</code> block, <code>$tax</code> reverts back to zero. Upon closer examination, you might find that the bug is the <code>my</code> before the call to <code>compute_sales_tax()</code>. This creates a locally scoped variable named <code>$tax</code> and does not assign it to the <code>$tax</code> variable in the outer block, which causes it to stay zero and makes it seem that <code>compute_sales_tax()</code> was never called.</p>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/832" template="b/article_sidebar2.view">
<!-- sidebar ends -->













<h3>When to Use <code>Apache::DB</code></h3>

<p>Using <code>print</code>, <code>die</code>, and <code>warn</code> statements in your code will help you find and fix 99 percent of the bugs you may run across when building <code>mod_perl</code> applications. Too bad there is still that pesky remaining 1 percent that will make you tear your hair out in clumps and wish you had gone into selling insurance instead of programming. Luckily there is <a href="http://search.cpan.org/perldoc?Apache::DB">Apache::DB</a> to help keep the glare off our collective heads at next year's Perl conference to a minimum.</p>

<p>Sometime, despite all of your attempts to see what is going wrong, you will find yourself in a situation where:</p>

<ul>
<li>Your code causes Apache to segfault and you can't for the life of you figure out why.</li>

<li>It appears that your code segfaults inside of a subroutine or method you are calling in a CPAN module you are using.</li>

<li>You have more debugging statements than actual code.</li>
</ul>

<p>You could spend time hacking up your other installed modules, such as those from CPAN, with debugging statements--but this only means you will have to return later and remove all of it. You could take an easier route and debug your <code>mod_perl</code> application with a real source debugger.</p>

<p>Using the Perl debugger allows you to see directly into what is happening to your code and data. You can step through your code line by line, as Perl executes it. Because you are following the same <em>flow</em>, there is no chance that you are making any bad assumptions. You might even consider it WYSIWYG, albeit without a GUI.</p>

<h3>Using <code>Apache::DB</code></h3>

<p>While <code>Apache::DB</code> works with both <code>mod_perl</code> 1.x and <code>mod_perl</code> 2.x, all of the examples in this article use <code>mod_perl</code> 2.0. Once you have installed <code>Apache::DB</code> from CPAN, using it is fairly simple. It does, however, require that you make a few Apache configuration changes. Assuming you have a <code>mod_perl</code> handler installed at <code>/modperl/</code> on your system, your configuration needs to resemble this:</p>

<pre><code>&lt;Location /modperl&gt;
  SetHandler perl-script
  PerlResponseHandler My::Modperl::Handler
  PerlFixupHandler +Apache::DB
&lt;/Location&gt;</code></pre>

<p>You also need to modify either the appropriate <code>&lt;Perl&gt;&lt;/Perl&gt;</code> section or your <em>startup.pl</em> file to include:</p>

<pre><code>use APR::Pool ();
use Apache::DB ();
Apache::DB-&gt;init();</code></pre>

<p>If you are working in a <code>mod_perl</code> 1.0 environment, the only change is that you should not include the <code>use APR::Pool ();</code> directive.</p>

<p>Note that you must call <code>Apache::DB-&gt;init();</code> prior to whatever code you are attempting to debug. To be safe, I always just put it as the very first thing in my <em>startup.pl</em>.</p>

<p>Once you have modified your configuration, the last step is to launch your Apache server with the <code>-X</code> command-line option. This option tells Apache to launch only one back-end process and to not fork into the background. If you don't use this option, you can't guarantee that your debugger has connected to same Apache child as your browser.</p>

<p>With this Apache daemon tying up your command prompt, simply browse to your application. As you will see, the shell running <code>httpd</code> has been replaced with a Perl debugging session. This debugging session is tied directly to your application and browser. If you look at your browser it will appear to hang waiting for a response; this is due to the fact your Apache server is waiting on you to work with the debugger.</p>

<p>Perl's debugger is very similar to other debuggers you may have used. You can step through your code line by line, skip entire subroutines, set break points, and display and/or change the value of variables with it.</p>

<p>It might be useful to read through <a
href="http://perldoc.perl.org/perldebtut.html"><code>man
perldebtut</code></a>, a introductory tutorial on using the debugger. For a
more complete reference to all of the available commands, see <a
href="http://perldoc.perl.org/perldebug.html"><code>man perldebug</code></a>.
This list should be just enough to get you started:</p>

<table>
<tr>
<th width="115">Command</th>
<th>Description</th>
</tr>

<tr valign="top">
<td><code>p&nbsp;<em>expression</em></code>
</td>
<td>This prints out the value of an expression or variable, just like the <code>print</code> directive in Perl.</td>
</tr>

<tr valign="top">
<td><code>x&nbsp;<em>expression</em></code>
</td>
<td>This evaluates an expression and prettily prints it for you. Use it to make complex data structures readable.</td>
</tr>

<tr valign="top">
<td><code>s</code>
</td>
<td>This tells the debugger to take a single <em>step</em>. A step is a single statement. If the next statement is a subroutine, the debugger will treat it as only one statement; you will not be able to step through each statement of that subroutine and the flow will continue without descending into it.</td>
</tr>

<tr valign="top">
<td><code>n</code>
</td>
<td>This tells the debugger to go to the next statement. If the next statement is a subroutine, you will descend into it and be able to step through each line of that subroutine.</td>
</tr>

<tr valign="top">
<td><code>l&nbsp;<em>line</em></code>
</td>
<td>Display a particular line of source code.</td>
</tr>

<tr valign="top">
<td><code>M</code>
</td>
<td>Display all loaded modules.</td>
</tr>
</table>

<h3>Code Profiling with <code>Apache::DProf</code></h3>

<p><a href="http://search.cpan.org/perldoc?Apache::DProf"><code>Apache::DProf</code></a> provides the necessary hooks for you to get some coarse profiling information about your code. By coarse, I mean only information on a subroutine level. It will show you the number of times a subroutine is called along with duration information.</p>

<p>Essentially, <code>Apache::DProf</code> wraps <a href="http://search.cpan.org/perldoc?Devel::DProf"><code>Devel::DProf</code></a> for you, making your life much easier. It is <em>possible</em> to use <code>Devel::DProf</code> by itself, but it assumes that you are running a normal Perl program from the command line and not in a persistent <code>mod_perl</code> environment. This isn't optimal, because while you can shoehorn <code>Devel::DProf</code> into working, you'll end up profiling all of the code used at server startup when you really only care about the runtime code.</p>

<p>Using <code>Apache::DProf</code> is relatively straightforward. All you need to do is include <code>PerlModule Apache::DProf</code> in your <em>httpd.conf</em> and restart your server.</p>













<p>As an example, here's a small application to profile. This code, while not all that useful, will help illustrate the major differences between these two profiling modules:</p>

<pre><code>package PerlTest;

sub handler {
    my $r = shift;
  
    $r-&gt;content_type( 'text/plain' );
  
    handle_request($r);

    return( Apache2::Const::OK );
}

sub handle_request {
    my $r = shift;

    $r-&gt;print( "Handling request....\n" );

    cleanup_request($r);

}

sub cleanup_request {
    my $r = shift;

    $r-&gt;print( "Cleaning up request....\n" );

    sleep(5);     # Take some time in this section
}

1;</code></pre>

<p>When you profile a module with <code>Apache::Dprof</code>, it will create a directory named <em>dprof/</em> in your server's <em>logs/</em> directory. Under this directory will be subdirectories named after the PID of each Apache child your server has. This allows you to profile code over a long period of time on a production system to see where your real bottlenecks are. Often, <em>faking</em> a typical user session does not truly represent how your users interact with your application and having the real data is beneficial.</p>

<p>After your server has run for a while, you need to stop it and revert your configuration, removing the <code>PerlModule Apache::DProf</code> you just inserted. This is due to the fact that <code>Apache::DProf</code> does not write its data to disk until the server child ends.</p>

<p>Viewing the profiling data is exactly the same as with <code>Devel::DProf</code>. Choose a particular Apache child directory in <em>$SERVER_ROOT/logs/dprof/</em> and run <code>dprofpp</code> on the corresponding <em>tmon.out</em> file.</p>

<p>After beating on the code sample above for awhile with <code>ab</code>, here are the results <code>Apache::DProf</code> gave me:</p>

<pre><code>Total Elapsed Time = 1082.402 Seconds
  User+System Time =        0 Seconds
Exclusive Times
%Time ExclSec CumulS #Calls sec/call Csec/c  Name
 0.00   0.004  0.001    687   0.0000 0.0000  RevSys::PerlTest::cleanup_request
 0.00       - -0.000      1        -      -  warnings::import
 0.00       - -0.000      1        -      -  APR::Pool::DESTROY
 0.00       - -0.000      1        -      -  strict::import
 0.00       - -0.000      1        -      -  Apache2::XSLoader::load
 0.00       - -0.000      3        -      -  Apache2::RequestIO::BEGIN
 0.00       - -0.000      2        -      -  RevSys::PerlTest::BEGIN
 0.00       - -0.003    687        -      -  Apache2::RequestRec::content_type
 0.00       - -0.006   1374        -      -  Apache2::RequestRec::print
 0.00       - -0.012    687        -      -  RevSys::PerlTest::handle_request
 0.00       - -0.024    687        -      -  RevSys::PerlTest::handler</code></pre>

<p>As expected, <code>cleanup_request()</code> shows the most time used per call. The report also shows stats for the other function calls you would expect as well as the ones that happen <em>behind the scenes</em>.</p>

<h3>Code Profiling with <code>Apache::SmallProf</code></h3>

<p>While <code>Apache::DProf</code> will show you which subroutines use the most system resources, sometimes that is not enough information. <a href="http://search.cpan.org/perldoc?Apache::SmallProf"><code>Apache::SmallProf</code></a> gives you fine-grained details in a line-by-line profile of your code.</p>

<p>Setup is similar to both of two previous modules. Add into a <code>&lt;Perl&gt;</code> section or your <em>startup.pl</em> file the code:</p>

<pre><code>use APR::Pool ();
use Apache::DB ();
Apache::DB-&gt;init();</code></pre>

<p>You also need to add <code>PerlFixupHandler Apache::SmallProf</code> into the <code>&lt;Directory&gt;</code> or <code>&lt;Location&gt;</code> block that refers to your <code>mod_perl</code> code.</p>

<p>Like <code>Apache::DProf</code>, <code>Apache::SmallProf</code> writes all of the profiling data into <em>$SERVER_ROOT/logs/smallprof/</em>. One interesting difference between <code>Apache::DProf</code> and <code>Apache::SmallProf</code> is that the latter writes a profile for each module in use. This is helpful because you already know which subroutines are slow and which packages they are in, from your first round of profiling with <code>Apache::DProf</code>. By focusing on those modules you can find your troubled code much faster.</p>

<p>Viewing <code>Apache::SmallProf</code> data is, however, a little different from <code>Apache::DProf</code>. A module profile looks like this:</p>

<table>
<tr>
<td><code>&lt;number&gt;</code></td>
<td><code>&lt;wall time&gt;</code></td>
<td><code>&lt;cpu time&gt;</code></td>
<td><code>&lt;line number&gt;</code></td>
<td><code>&lt;source line&gt;</code></td>
</tr>
</table>

<p><code>&lt;number&gt;</code> is the number of times this particular line was executed, <code>&lt;wall time&gt;</code> is the actual time passed, and <code>&lt;cpu time&gt;</code> is the amount of time the CPU spent working on that line. The remaining two pieces of data are the line number in the file and the actual source on that line.</p>

<p>You can just open up the profiles generated by <code>Apache::SmallProf</code> and look at the results. However, this doesn't get to the heart of the matter very quickly. Sorting the profile by the amount of time spent on each line gets you where you want to go:</p>

<pre><code>$ <strong>sort -nrk 2 logs/smallprof/MyHandler.pm | more</strong></code></pre>

<p>This command sorts the profile for <code>MyHandler.pm</code> by the wall time of each line. If you use this same sort on the output from <code>Apache::SmallProf</code> on the example code, you will see something similar to this:</p>

<pre><code># <strong>sort -nrk 2 PerlTest.pm.prof | more</strong>
    1 5.000785 0.000000         29:    sleep( 5 );
    1 0.008177 0.000000         13:    return( Apache2::Const::OK );
    1 0.007431 0.010000         21:    cleanup_request( $r );
    3 0.001343 0.000000          4:use Apache2::RequestIO;
    1 0.000176 0.000000         33:1;
    3 0.000164 0.000000          3:use Apache2::RequestRec;
    1 0.000093 0.000000         19:    $r-&gt;print( "Handling request......\n" );
    1 0.000067 0.000000         11:    handle_request( $r );
    1 0.000058 0.000000          9:    $r-&gt;content_type( 'text/plain' );
    1 0.000058 0.000000         28:    $r-&gt;print( "Cleaning up request......\n" );</code></pre>

<p>As you can see, <code>Apache::SmallProf</code> has zeroed right in on our <code>sleep()</code> call as the source of our performance problems.</p>

<h3>Conclusion</h3>

<p>Hopefully, this article has given you enough of an introduction to these modules that you can begin using them in your development efforts. The next time you face a seemingly unsolvable bug or performance issue, you have a few more weapons in your arsenal.</p>

<p>If you have trouble getting any of these three modules to work, please don't hesitate to contact me directly. If you need <code>mod_perl</code> help in general, I strongly suggest you join the <code>mod_perl</code> mailing list. You can often get an answer to your <code>mod_perl</code> question in a few hours, if not minutes.</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-680" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2006/02/02/x11_gui_testing.html" rel="bookmark">Test-Driving X11 GUIs</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">George Nistorica</span> on <abbr class="published" title="2006-02-02T00:00:00-08:00">February  2, 2006 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<h3>Driving X11 GUIs using X11::GUITest</h3>

<h3>Introduction</h3>

<p>Interfaces to GUI applications like <a href="http://developer.kde.org/documentation/library/kdeqt/kde3arch/dcop.html">DCOP</a> or <a href="http://www.freedesktop.org/Software/dbus">D-BUS</a> allow you to interact with GUI applications in order to get at their internal states or set some arbitrary states.</p>

<p>Sometimes GUIs don't allow for such interaction and you need to "click" them. If you're writing such an application, you need some sort of regression tests for it to make sure your widget/windows are as accessible as they should be. If this is the case, there is a Perl module to help you: <a href="http://search.cpan.org/perldoc?X11::GUITest">X11::GUITest</a>.</p>

<p>Be aware that <code>X11::GUITest</code> allows you to drive a GUI, but you can't "read" data written in a widget, such as a button or an edit box. More on this in the Limitations section below.</p>

<p>To install <code>X11::GUITest</code>, run:</p>

<pre><code>$ <strong>perl -MCPAN -e 'shell'</strong>
<strong>install X11::GUITest</strong>
<strong>quit</strong></code></pre>

<h3>A Simple Example</h3>

<p>I've included two example programs. One is <a href="/2006/02/02/examples/tested.pl"><em>tested.pl</em></a> and it serves as an example GUI. The other is <a href="/2006/02/02/examples/tester.pl"><em>tester.pl</em></a> that starts and drives the tested program.</p>

<p>You need Tk installed for the tested GUI. Tk comes as a package in most GNU/Linux distributions or other *NIX OSes. Download both files in the same folder, run <em>./tester.pl</em>, and watch.</p>

<p>What are they doing and how do they work?</p>

<h3>Starting a GUI</h3>

<p>First thing to do prior to driving a GUI is to start the driven program. While you can use <code>fork</code> and <code>exec</code> or any other means, <code>X11::GUITest</code> comes with a routine of its own.</p>

<p>Use <code>StartApp( $tested_application );</code> to start a GUI, which results in starting the desired application in an asynchronous manner.</p>

<p>If you want to start an application and wait for it to finish before going on, use <code>RunApp</code>.</p>

<h3>Finding a Window</h3>

<p>After having the GUI started, you need to search for it among the other open windows on your desktop. For this, use <code>FindWindowLike()</code>, <code>WaitWindowLike()</code>, or <code>WaitWindowViewable()</code>, depending on what you need. Their names are pretty much self-explanatory.</p>

<p>Usually you need to have only one instance of the tested application started:</p>

<pre><code>@windows = FindWindowLike( $tested_app_title );
print "* Number of $tested_app_title windows found: ", scalar @windows, "\n";

if ( @windows == 1 ) {
     print "* Only one instance found, going on ...\n";
} else {
    print "* The number of $tested_app_title instances is different than 1\n";
    print "exiting ...\n";
    exit;
}</code></pre>

<p><code>FindWindowLike()</code> returns a list of windows that match the search criteria, which is a regular expression to match against the window title. In case there is more than one window that matches the criteria, either you have the same window started multiple times, or the regular expression isn't specific enough.</p>

<h3>Sending Keyboard Events to an Application</h3>

<p>Having found the window, (when you know that there is only one, you can access it as the first element of <code>@windows</code>, namely <code>$windows[0]</code>), you probably want to send it some keystrokes. Use <code>SendKeys()</code> to do this.</p>

<p>If you are having a busy X server, or just want your testing to be easy for the human eye to watch, set the delay between the keystrokes (in milliseconds) with <code>SetKeySendDelay()</code>:</p>

<pre><code>SetKeySendDelay( $delay );</code></pre>

<p>To send <code>Alt</code>+<code>O</code>, followed by a delay of <code>$delay</code> milliseconds, then <code>e</code>:</p>

<pre><code>SendKeys( '%(o)e' );</code></pre>

<p>Besides sending plain text to an application, like sending the infamous "Hello World" to an editor window, you may have noticed that the previous example sent a combination of keys. Do so by using modifiers. The modifier keys are:</p>

<ul>
<li><code>^</code>, <code>Ctrl</code></li>

<li><code>%</code>, <code>Alt</code></li>

<li><code>+</code>, <code>Shift</code></li>
</ul>

<p>The <code>X11::GUITest</code> documentation has a complete list of special keys and their "encodings."</p>

<p>You may also find it useful to use <code>QuoteStringForSendKeys()</code> in the case of complicated strings.</p>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1796" template="b/article_sidebar2.view">
<!-- sidebar ends -->













<h3>Sending Mouse Events to an Application</h3>

<p>Sending keys may be not enough in some situations. Having an application that has keyboard shortcuts is nice, but not all of them support it. Sometimes you may need to send mouse events.</p>

<p>To get the absolute position of the appropriate window on your desktop:</p>

<pre><code>my ($x, $y, $width, $height) = GetWindowPos($edit_windows[0]);</code></pre>

<p>Suppose that you want to click right in the middle of it. First, compute the position of the middle of the window:</p>

<pre><code>$x += $width  / 2;
$y += $height / 2;</code></pre>

<p>Now move the mouse:</p>

<pre><code>MoveMouseAbs( $x, $y );</code></pre>

<p>Then press the right mouse button:</p>

<pre><code>PressMouseButton M_RIGHT;</code></pre>

<p>Do something useful, and then release the mouse button. (Don't forget to do that when you're using <code>PressMouseButton</code>; otherwise, you may experience "strange" desktop behavior when your testing application exits.)</p>

<pre><code>ReleaseMouseButton M_RIGHT</code></pre>

<p>You could replace <code>PressMouseButton()</code> and <code>ReleaseMouseButton()</code> with <code>ClickMouseButton()</code> if you don't have anything to do between pressing and releasing the mouse button.</p>

<p>In the example programs, there's something to do--navigating the context menu with keystrokes.</p>

<h3>Moving a Window</h3>

<p>This is a neat and interesting feature: the ability to move windows. While it is useful to impress your friends with having their favorite mail program moving up and down, its utility lies in the fact that you can arrange the tested windows on the desktop so they are all visible.</p>

<pre><code>MoveWindow( $window_id, $x, $y );</code></pre>

<h3>Limitations</h3>

<p>As you may have noticed reading the example code, there is almost no way of validating the fact that you are indeed interacting with the right widget or window. The functions you can use for this are <code>FindWindow*</code> or <code>WaitWindow*</code>, which return a list of windows whose titles match an arbitrary regexp, and the functions that deal with child windows, such as <code>IsChild()</code> and <code>GetChildWindows()</code>.</p>

<p>While you may pass the window ID to a testing program, using external means to validate the tested application (such as indicating the coordinates on the screen), the problem is that you can't grab a widget's contents.</p>

<p>Also, while you might be tempted to parse the child tree of an application to get from the main window to one of its children, this doesn't work every time. Plenty of GUIs spawn other windows at the top level, and the spawned windows have as root window the topmost window (which is the desktop).</p>

<p>Here's an example of the problem that uses Mozilla Firefox. Before running the test, you must meet some prerequisites:</p>

<ul>
<li>Back up your preferences before running the tests.</li>

<li>Go to Edit -&gt; Preferences -&gt; General -&gt; Connection Settings and set it to "Direct connection to the Internet."</li>

<li>Click OK, and then OK, and close the browser.</li>
</ul>

<p>Now run the <em><a href="/2006/02/02/examples/Firefox.pl">Firefox.pl</a></em> example code.</p>

<p>The test program assumes that when the Preferences window pops up, the General menu is selected.</p>

<p>Open Mozilla Firefox again, go to Preferences, select the Web Features menu, click OK, and exit the browser.</p>

<p>Rerun the <em>Firefox.pl</em> program, and watch it.</p>

<p>It has no idea which menu is selected, because every menu component belongs to the same window, having the same title.</p>













<h3>Writing GUIs for Testability</h3>

<p>Having in mind the strengths and weaknesses of <code>X11::GUITest</code>, it's critical to design graphical user interfaces that are easy to test. This way, you shorten your maintenance time, as you can have a tester program that can help check that the GUI hasn't lost some of its windows in the development/maintenance process.</p>

<p>Of course, when displaying a license text when your GUI starts, you don't have the means to check that the contents are unchanged using <code>X11::GUITest</code>.</p>

<p>What you can do is to ensure that all child windows are "in place" and that a user can access them in the same way as he/she could in previous versions.</p>

<p>If you define ways of navigating the GUI using keyboard shortcuts so that you can reach any "leaf" window starting from the top-level window, then it's trivial for a test program to navigate the same way you do and ensure that all windows are reachable as they were in previous versions.</p>

<p>Consider the following code based on the tested Tk program:</p>

<pre><code>$menu{'OTHER'} = $menu_bar-&gt;cascade(
    -label   =&gt; 'Other',
    -tearoff =&gt; 0,
);

$menu{'OTHER'}-&gt;command(
    -label   =&gt; 'Editor',
    -command =&gt; sub {
        edit_window();
    }
);</code></pre>

<p>It defines a piece of menu from the overall menu of the application. As you may notice, there are no keyboard shortcuts that you can use to access the Editor window.</p>

<p>Thinking of testability, you could go to some lengths to test this piece of code to ensure that the Editor window is reachable and that it indeed pops up. You could record the application's position on the screen and then click the Other button, then move the mouse over the Editor button and click it. I'm sure you can spot some caveats here, among them:</p>

<ul>
<li>You need to make sure that the application is always on the screen at some known coordinates (use <code>GetWindowPos()</code>) or maybe that the test always moves the window to the same place (use <code>MoveWindow()</code>).</li>

<li>You have to take into consideration font size changes, localization, and resolution changes so that you are sure you are clicking in the right place.</li>
</ul>

<p>This kind of testing is fragile and error-prone. You can make things simpler and more robust: add keyboard shortcuts for each action. You gain two main benefits: you make some users (like me) happier and ease the testing process. You just need to define all the "paths" that you need to "walk" and define the child window titles so you know you've reached them.</p>

<p>Here's a slight adjustment to the tested application so that it provides keyboard shortcuts:</p>

<pre><code>$menu{'OTHER'} = $menu_bar-&gt;cascade(
    -label   =&gt; '~Other',
    -tearoff =&gt; 0,
);

$menu{'OTHER'}-&gt;command(
    -label   =&gt; '~Editor',
    -command =&gt; sub {
        edit_window();
    }
);

sub edit_window {
    # some initialization code here ...

    $edit_window = $main_window-&gt;Toplevel();

    # Set the title of the Editor window
    $edit_window-&gt;title("This is an edit window");

    # the rest of the code here ....

}</code></pre>

<p>This piece of code is easier to test. Navigate the application until you reach the Editor window:</p>

<pre><code>SendKeys('%(o)e');</code></pre>

<p>Now you should have the Editor window spawned. Grab a list of windows having the title matching the Editor window's title:</p>

<pre><code>@edit_windows = FindWindowLike( $edit_title );</code></pre>

<p>Check to see whether the Editor window is present. Also, there should be only one Editor window started:</p>

<pre><code>if ( @edit_windows == 1 ) {
    # code here
} else {
    # we have zero or more than one Editor window, so something is not quite
    # right
}</code></pre>

<p>This kind of code is easy to extend, as you can store the application window hierarchy in some external file outside of the program source (in some sort of markup language file, or anything that suits your needs). Having this external definition of the windows' hierarchy and their properties, the tester program can read the same file the tested application uses; thus, both know the same keyboard shortcuts and window titles.</p>

<p>Program logic errors and/or bugs in underlying libraries used are easier to catch before you release the software.</p>

<h3>Conclusion</h3>

<p>As you can see, there is no easy way to test an entire GUI application with <code>X11::GUITest</code>, but you can test the important parts. Also, for some actions you can use a mixed approach, such as initiating an event using the application interface (connecting to a remote server protected with a user/password auth scheme) and picking the results from a log file.</p>

<p>While the testing done in the previous paragraph is necessary, it is not sufficient. It would be great if there were someone willing to pick up the module and research whether it could be possible for <code>X11::GUITest</code> to be able to fetch data from the widgets, making it possible to "read" the contents of a window (from a text widget, for example).</p>

<p>This kind of testing is more complete than simply driving the GUI.</p>

<p>Of course, you could also use <code>X11::GUITest</code> to write a "record and playback" application. You might only need <code>GetMousePos()</code>, <code>IsMouseButtonPressed()</code>, and the other mouse functions. As I said earlier, in my opinion this kind of testing is too fragile.</p>

<p>The problem is that you can't validate the contents of the windows.</p>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2006/01/">&laquo; January 2006</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2006/03/">March 2006 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
