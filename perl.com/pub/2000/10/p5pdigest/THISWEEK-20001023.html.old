</P>

<P>


<!-- This week on perl5-porters (09--23 Oct 2000) -->

<br />
<!::field::date::><br />
<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#What_is_our_Unicode_model">What is our Unicode model?</a>
  <li><a href="#Why_not_use_sfio">Why not use sfio?</a>
  <li><a href="#More_than_256_Files__sysopen">More than 256 Files / sysopen</a>
  <li><a href="#What_if_cc_changes">What if cc changes?</a>
  <li><a href="#Unicode_on_EBCDIC">Unicode on EBCDIC</a>
  <li><a href="#AIX_Is_Confused">AIX Is Confused</a>
  <li><a href="#Unicode_split_fixed">Unicode split fixed!</a>
  <li><a href="#Fixes_to_Carp">Fixes to Carp</a>
  <li><a href="#open_might_fail">open() might fail</a>
  <li><a href="#Perl_5_is_5">Perl 5 is 5!</a>
  <li><a href="#Flip_flop_bug">Flip-flop bug</a>
  <li><a href="#Exiting_a_subroutine_via_next_strikes_again">Exiting a subroutine via next strikes again!</a>
  <li><a href="#New_constant_sub_mechanism">New constant sub mechanism</a>
  <li><a href="#Regex_segfaulting">Regex segfaulting</a>
  <li><a href="#use_vars_lets_you_do_naughty_things">use vars lets you do naughty things</a>
  <li><a href="#Various">Various</a>
</ul>

      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>simon@brecon.co.uk</CODE>.
</P>

<P>
For family reasons, I wasn't able to get the summary out last week;
please note that this is a special bumper double issue, covering the
last two weeks. 
<H3><a name="What_is_our_Unicode_model">What is our Unicode model?</a></H3>

</P>

<P>

The big debate these past couple of weeks has been what our Unicode
model actually means: What 
<CODE>use bytes</CODE> should really do, whether it's all right to upgrade values to UTF8
without telling anyone, and so on. If you're at all interested in how
Perl's Unicode strategy works - or, as some would claim, doesn't - take
a look at 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00261.html">this thread</a>. There were nearly a hundred messages in the thread, and it went off
into discussion of line disciplines, the mechanism by which Unicode data
will be read from external sources such as files. The thread also
sparked up a bit of private email, and the following things were
resolved:
<ul><li></P>

<P>

It doesn't matter if data gets upgraded to UTF8 internally; if there is
a place where it does matter, that's a bug.
<li></P>

<P>

Line disciplines need to happen before anything else.
<li></P>

<P>

<CODE>use bytes</CODE> does make sense. Honest.
</ul></P>

<P>

A lot of the thread was taken up with technical details about how line
disciplines should be implemented; having line disciplines will mean
we'll almost certainly need our own version of stdio or something very
like it.
<H3><a name="Why_not_use_sfio">Why not use sfio?</a></H3>

</P>

<P>

The obvious alternative to implementing our own version of stdio is, of
course, steal someone else's, and so the Nicks (Clarke and Ing-Simmons)
began looking at 
<a href="http://www.research.att.com/sw/tools/sfio/">ATT's sfio</a> library.
</P>

<P>
sfio claims to do what we want from it, and its developers (David Korn -
yes, him - and Phong Vo) posted to p5p to reassure us that it would be
suitable, and that the new license allows it to be distributed with
Perl; so it looks like that's a very big possibility.
</P>

<P>
It will need to be ported to VMS and some other platforms, but between
us and the sfio guys, this shouldn't be a problem, and it would benefit
all the other sfio users out there too. Let's get to it!
<H3><a name="More_than_256_Files__sysopen">More than 256 Files / sysopen</a></H3>

</P>

<P>

Piotr Piatkowski reported that you can't open more than 256 files on
Solaris. Well, that turns out to be standard Solaris behaviour,
but you
should be able to get around it with 
<CODE>sysopen</CODE>, since that calls the underlying operating system's 
<CODE>open</CODE> directly, right? However, it turns out that isn't the case - 
<CODE>sysopen</CODE> actually calls 
<CODE>fopen</CODE>, which is wrong! A bug report wasn't opened for this, and there
wasn't a fix.
<H3><a name="What_if_cc_changes">What if cc changes?</a></H3>

</P>

<P>

Jarkko 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00371.html">noted</a> that since people are now shipping Perl with their commercial Unix
distributions, the compilers they compile Perl under - say, Sun cc - may
well not be the compiler that the user ends up with - typically,
something like FSF gcc. This causes problems when adding CPAN modules -
Sarathy suggested the answer was to hack the Config.pm, and also to have
packaged module distributions. (Like the module .debs and .rpms)
ActiveState's PPM was suggested as a natural way to do this, and it has
recently been released onto CPAN.
<H3><a name="Unicode_on_EBCDIC">Unicode on EBCDIC</a></H3>

</P>

<P>

Perl 5.6 on EBCDIC is slowly getting together; 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00400.html">Ignasi Roca</a> noticed a bug, and attempted a fix, but Peter Prymmer and I were
already on to it. Peter also contributed a lot of miscellaneous patches
to places where the test suites implied ASCII. 
<H3><a name="AIX_Is_Confused">AIX Is Confused</a></H3>

</P>

<P>

Guy Hulbert helped us 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00575.html">get AIX on its feet</a> after it seemed to be having some difficulties about the contents of
<CODE>struct tm</CODE>. Merijn then contributed
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00642.html">README.aix</a>, which had been mysteriously left unwritten. Guy also identified a few
more issues, which I believe have been fixed but I'm not sure.
<H3><a name="Unicode_split_fixed">Unicode split fixed!</a></H3>

</P>

<P>

Last time, I reported problems with 
<CODE>split</CODE> and Unicode; the good news is, Jarkko has
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00612.html">fixed it</a>. I also contributed a fix to the wide-character-
<CODE>~</CODE> issue identified last time, which didn't work on 64-bit operating
systems. Jarkko and I simultaneously discovered this was a bug in 
<CODE>pp_chr</CODE> which was restricted to 32-bit values because it took a
<CODE>U32</CODE> off the stack - when you're dealing with characters these days,
anything up to and including a 
<CODE>UV</CODE> is fair game.
</P>

<P>
In other Unicode news, there was a bug in which doing something like 
<CODE>"$1$utf8"</CODE> caused a read-only variable error; Jarkko fixed it, and Nicholas Clark
produced some tests.
<H3><a name="Fixes_to_Carp">Fixes to Carp</a></H3>

</P>

<P>

Ben Tilly produced a 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00617.html">big patch </a> to address some
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00605.html">errant and confusing behaviour </a> in Carp; unfortunately, this appeared
to cause more of the test suits to fail than before. The patch hasn't
been revisited as far as I can tell, so someone might want to take a
look at it.
<H3><a name="open_might_fail">open() might fail</a></H3>

</P>

<P>

Jarkko was evidently in &quot;astute&quot; mode this fortnight, asking
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00697.html">"what to do when open/fopen/fdopen fail?"</a>. This potentially interesting thread got bogged down by a lot of
language-lawyering about 
<CODE>errno</CODE>. This usually happens with 
<CODE>errno</CODE>.
<H3><a name="Perl_5_is_5">Perl 5 is 5!</a></H3>

</P>

<P>

Perl 5 became 5 years old sometime last week. I say &quot;sometime&quot; because
there was a little debate as to when birthdays are celebrated with
respect to timezone. Yes, I thought it was incredulous, too, but here's
the 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00847.html">original release message</a> as kept by Jeff Okamoto.
<H3><a name="Flip_flop_bug">Flip-flop bug</a></H3>

</P>

<P>

Jeff Pinyan noticed that the flip-flop operator in scalar context (
<CODE>if 1...20</CODE> and so on) has 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00777.html">interesting problems</a> when there isn't an open filehandle. I fixed this, badly, but Hugo
fixed it tidily; Mark-Jason Dominus called for a documentation patch,
which hasn't appeared yet. If someone wants to read the thread and make
the suggested change, that would be lovely!
<H3><a name="Exiting_a_subroutine_via_next_strikes_again">Exiting a subroutine via next strikes again!</a></H3>

</P>

<P>

Alexander Farber found a 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00860.html">small File::Find example</a> which caused segfaults. There's a workaround in place in the current
development Perl, but the fact remains that exiting a subroutine via
next can, and does, cause segfaults. This would be a good thing for
someone who's feeling bold to investigate.
<H3><a name="New_constant_sub_mechanism">New constant sub mechanism</a></H3>

</P>

<P>

John Tobey came up with a 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00939.html">reimplementation of newCONSTSUB</a>. What's that, then? Well, when you 
<CODE>use constant</CODE> or create a sub like like
<CODE>sub foo () { 42 }</CODE>, Perl optimizes this and creates a special subroutine which is inlined
at compile time. His new version seems to save about 70% of space, but
of 
<B>what</B> space and under <B>what</B> conditions I couldn't tell you. This one, however, also optimises
<CODE>sub () { return 42; }</CODE> by creating a &quot;constant&quot; flag for a 
<CODE>CV</CODE>. Adding the extra flag meant that things like 
<CODE>dump.c</CODE> and 
<CODE>B::*</CODE> had to be updated, which John duly did. Nice, thorough job.
<H3><a name="Regex_segfaulting">Regex segfaulting</a></H3>

</P>

<P>

There's been rather a lot of segfaults this time.
Marc Lehmann 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00931.html">noticed one with regexps</a>. Andreas did the regression testing, and Hugo fixed it; Ilya came in to
help explain the details and the pitfalls.
<H3><a name="use_vars_lets_you_do_naughty_things">use vars lets you do naughty things</a></H3>

</P>

<P>

Robert Spier was doing a bit of bug archaeology, and found that
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-10/msg00961.html">use vars lets you do naughty things</a>; in particular, it lets you create variables like 
<CODE>$f;</CODE> that you can't easily access. He provided a patch which caused  
<CODE>use vars</CODE> when combined with
<CODE>use strict q/vars/</CODE> to croak on unreasonable variable names. This raises interesting
philosophical issues - should we be allowed to say
<pre>use vars q($x $y;$z);</pre></P>

<P>
What do you think?
<H3><a name="Various">Various</a></H3>

</P>

<P>

In other news, the usual collection of bug reports, bug fixes, non-bug
reports, questions, answers, and no spam. No flamage; or at least,
nothing memorably amusing.
</P>

<P>
Until next week I remain, your humble and obedient servant,
</P>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Cozens</a>
