<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: November 2000 Archives</title>


    <link rel="prev" href="/pub/2000/10/" title="October 2000" />
    <link rel="next" href="/pub/2000/12/" title="December 2000" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">November 2000 Archives</h1>





                            
                            <div id="entry-1752" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/11/repair3x.html" rel="bookmark">Red Flags Return</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="2000-11-28T00:00:00-08:00">November 28, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- <a name="what's wrong with this picture">What's Wrong With This Picture?</a> -->

<p>Astute readers had a number of comments about last week's
<a href="/pub/2000/11/repair3.html"><cite>Program Repair Shop and Red Flags</cite></a> article.</p> 

<h3><a name="control flow puzzle">Control Flow Puzzle</a></h3> 


<p>In the article, I had a section of code that looked like this:</p> 
<pre>       $_ = &lt;INFO&gt; until !defined($_) || /^(\* Menu:|\037)/;
       return @header if !defined($_) || /^\037/;</pre> 
			
<p>I disliked the structure and especially the repeated tests.  I played
with it, changing it to</p> 

<p><table width="180" cellspacing="0" cellpadding="4" align="right" border="1"><tr><td align="center" valign="top" bgcolor="#6699cc">
<font color="#ffffff">Table of Contents</td>
</tr>

<tr>
<td>
<p class="fine">
&#149;<a href="#control flow puzzle">Control Flow Puzzle</a><br />
&#149;<a href="#pattern matching">Pattern Matching</a><br />
&#149;<a href="#synthetic variables">Synthetic Variables</a><br />
&#149;<a href="#send more code">Send More Code</a><br />

</td>
</tr>
</p>
</table>

<pre>
        while (&lt;INFO&gt;) {
          last if /^\* Menu:/;
          return @header if /^\037/;
        }
        return @header unless defined $_;</pre> 
<p>and then used Simon Cozens' suggestion of</p> 
<pre>
        do { 
          $_ = &lt;INFO&gt;; 
          return @header if /^\037/ || ! defined $_ 
        } until /^\* Menu:/ ;</pre> 
		
<p>This still bothered me, because <code>do...until</code> is unusual.
But I was out of time, so that's what I used.</p> 

<p>Readers came up with two interesting alternatives.
Jeff Pinyan suggested:</p> 

<pre>
        while (&lt;INFO&gt;) {
          last if /^\* Menu:/;
          return %header if /^\037/ or eof(INFO);
        }</pre> 
		
<p>This is perfectly straightforward, and the only reason I didn't think
of it was because of my prejudice against <code>eof()</code>.  In the article, I
recommended avoiding <code>eof()</code>, and that's a good rule of thumb.  But
in this case, I think it was probably the wrong way to go.</p> 

<p>After I saw Jeff's solution, I thought more about <code>eof()</code> and tried
to remember what its real problems are.  The conclusion I came to is
that the big problem with <code>eof()</code> occurs when you use it on a
filehandle that is involved in an interactive dialogue, such as a
terminal.</p> 

<p>Consider code like this:</p> 
<pre>
        my ($name, $fav_color);
        print &quot;Enter your name: &quot;;
        chomp($name = &lt;STDIN&gt;);
        unless (eof(STDIN)) {
          print &quot;Enter your favorite color: &quot;;
          chomp($fav_color = &lt;STDIN&gt;);
        }
</pre> 

<p>This seems straightforward, but it doesn't work.  (Try it!)  After 
user enters their name, we ask for <code>eof()</code>.  This tries to read
another character from <code>STDIN</code>, which means that the program is
waiting for user input <i>before</i> printing the second prompt!  The
program hangs forever at the <code>eof</code> test, and the only way it can
continue is if the user clairvoyantly guesses that they are supposed
to enter their favorite color.  If they do that, then the program will
print the prompt and immediately continue.  Not very useful behavior!
And under some circumstances, this can cause deadlock.</p> 

<p>However, in the example program I was discussing, no deadlock is
possible because the information flows in only one direction - from a
file into the program.  So the use of <code>eof()</code> would have been safe.</p> 

<p>Ilya Zakharevich suggested a solution that I like even better:</p> 
<pre>
      while (&lt;INFO&gt;) {
          return do_menu() if /^\* Menu:/;
          last if /^\037/;
      }
      return %header;</pre> 
	  
<p>Here, instead of requiring the loop to fall through to process the
menu, we simply put the menu-processing code into a subroutine and
process it inside the loop.</p> 

<p>Ilya also pointed out that the order of the tests in the original code
is backward:</p> 

<pre>
	return @header if /^\037/ || ! defined $_</pre> 

<p>It should have looked like this:</p> 

<pre>
	return @header if ! defined $_  || /^\037/;</pre> 

<p>Otherwise, we're trying to do a pattern-match operation on a possibly
undefined value.</p> 

<p>Ilya also suggested another alternative:</p> 
<pre>
    READ_A_LINE: {
      return %header if not defined ($_ = &lt;INFO&gt;) or /^\037/;
      redo READ_A_LINE unless /^\* Menu:/;
    }</pre> 
	
<p>Randal Schwartz suggested something similar.  This points out a
possible rule of thumb: When Perl's control-flow constructions don't
seem to be what you want, try decorating a bare block.</p> 

<h3><a name="oops!">Oops!</a></h3> 

<p>I said:</p> <blockquote> now invoke the function like this:

<pre>
	$object = Info_File-&gt;new('camel.info');
</pre> </blockquote>  

<p>Unfortunately, the function in question was named <code>open_info_file</code>,
not <code>new</code>.  The call should have been</p> 

<pre>
	$object = Info_File-&gt;open_info_file('camel.info');</pre> 

<p>I got the call right in my test program (of <em>course</em> I had a test
program!) but then mixed up the name when I wrote the article.  Thanks
to Adam Turoff for spotting this.</p> 

<h3><a name="pattern matching">Pattern Matching</a></h3> 

<p>In the article, I replaced this:</p> 
<pre>
	($info_file) = /File:\s*([^,]*)/;
        ($info_node) = /Node:\s*([^,]*)/;
        ($info_prev) = /Prev:\s*([^,]*)/;
        ($info_next) = /Next:\s*([^,]*)/;
        ($info_up)   = /Up:\s*([^,]*)/;</pre> 
		
<p>With this:</p> 

<pre>
	for my $label (qw(File Node Prev Next Up)) {
          ($header{$label}) = /$label:\s*([^,]*)/;
        }</pre> 
		
<p>Then I complained that Perl must recompile the regex each time
through the loop, five times per node.  Ilya pointed out
the obvious solution:</p> 

<pre>
	 $header{$1} = $2 
	     while /(File|Node|Prev|Next|Up):\s*([^,]*)/g;
</pre> 

<p>I wish I had thought of this, because you can produce it almost
mechanically.  In fact, I think my original code betrays a red flag
itself.  Whenever you have something like this:</p> 

<pre>
	for $item (LIST) {
          something involving m/$item/;
        }</pre> 
		
<p>this is a red flag, and you should consider trying to replace it with
this:</p> 

<pre>
	my $pat = join '|', LIST;
        Something involving m/$pat/o;</pre> 
		
<p>As a simple example, consider this common construction:</p> 

<pre>
	@states = ('Alabama', 'Alaska', ..., 
	           'West Virginia', 'Wyoming');
        $matched = 0;
        for $state (@states) {
          if ($input =~ /$state/) { 
            $matched = 1; last;
          }
        }</pre> 
		
<p>It's more efficient to use this instead:</p> 

<pre>
	my $pat = join '|', @states;
        $matched = ($input =~ /$pat/o);</pre> 
		
<p>Applying this same transformation to the code in my original program
yields Ilya's suggestion.</p> 

<h3><a name="synthetic variables">Synthetic Variables</a></h3> 

<p>My code looked like this:</p> 

<pre>
	while (&lt;INFO&gt;) {
          return 1 if /^\037/;    # end of node, success.
          next unless /^\* \S/;   # skip non-menu-items
          if (/^\* ([^:]*)::/) {  # menu item ends with ::
              $key = $ref = $1;
          } elsif (/^\* ([^:]*):\s*([^.]*)[.]/) {
              ($key, $ref) = ($1, $2);
          } else {
              print STDERR &quot;Couldn't parse menu item\n\t$_&quot;;
              next;
          }
          $info_menu{$key} = $ref;
        }</pre> 
		
<p>Ilya pointed out that in this code, <code>$key</code> and <code>$ref</code> may be synthetic variables.  A synthetic variable isn't intrinsic to
the problem you're trying to solve; rather, they're an artifact of the
way the problem is expressed in a programming language.  I think
<code>$key</code> and <code>$ref</code> are at least somewhat natural, because the problem
statement <em>does</em> include menu items with names that refer to nodes,
and <code>$key</code> is the name of a menu item and <code>$ref</code> is the node it
refers to.  But some people might prefer Ilya's version:</p> 

<pre>
       while (&lt;INFO&gt;) {
           return 1 if /^\037/;        # end of node, success.
           next unless s/^\* (?=\S)//; # skip non-menu-items
           $info_menu{$1} = $1, next if /^([^:]*)::/; 
           $info_menu{$1} = $2, next if /^([^:]*):\s*(.*?)\./;
           print STDERR &quot;Couldn't parse menu item\n\t* $_&quot;;
       }</pre> 
	   
<p>Whatever else you say about it, this reduces the code from eleven
lines to six, which is good.</p> 

<h3><a name="old news">Old News</a></h3> 

<p>Finally, a belated correction.  In the <em>second</em> <a href="/pub/2000/06/commify.html"><cite>Repair Shop and Red Flags Article</cite></a> way back in June, I got the notion that you shouldn't use string
operations on numbers.  While I still think this is good advice, I
then tried to apply it outside of the domain in which it made sense.</p> 

<p>I was trying to transform a number like 12345678 into an array like 
<code>('12', ',', '345', ',', '678')</code>.  After discussing several strategies, all
of which worked, I
ended with the following nonworking code:</p> 

<pre>
	sub convert {
          my ($number) = shift;
          my @result;
          while ($number) {
            push @result, ($number % 1000) , ',';
            $number = int($number/1000);
          }
          pop @result;      # Remove trailing comma
          return reverse @result;
        }</pre> 
		
<p>If you ask this subroutine to convert the number 1009, you get <code>('1',
',', '9')</code>, which is wrong; it should have been <code>(1, ',', '009')</code>.
Many people wrote to point this out; I think Mark Lybrand was
the first.  Oops!  Of course, you can fix this with <code>sprintf</code>, but
really the solutions I showed earlier in the article are better.</p> 

<p>The problem here is that I became too excited about my new idea.  
I still think it's usually a red flag to treat a number like a
string.  But there's an exception:  When you are formatting a number
for output, you <em>have</em> to treat it like a string, because output is
always a string.  I think Charles Knell hit the nail on the head here:</p> 

<blockquote> By inserting commas into the returned value, you ultimately
        treat the number as a string. Why not just give in and admit
        you're working with a string.
</blockquote> 

<p>Thanks, Charles.</p> 

<p>People also complained that the subroutine returns a rather peculiar
list instead of a single scalar, but that was the original author's
decision and I didn't want to tamper with it without being sure why he
had done it that way.  People also took advantage of the opportunity
to send in every bizarre, convoluted way they would think of to
accomplish the same thing (or even a similar thing), often saying
something like this:</p>

 <blockquote> You are doing way too much work!  Why don't you simply use
        this, like everyone else does?
<pre>
	sub commify {
          $_ = shift . '*';
          &quot;nosehair&quot; while s/(.{1,3})\*/*,$1/;
          substr($_,2);
        }
</pre> </blockquote>

<p>I think this just shows that all code is really simple if you already
happen to understand it.</p>

<h3><a name="send more code">Send More Code</a></h3> 

<p>Finally, thanks to everyone who wrote in, especially the people I
didn't mention.  These articles have been quite popular, and I'd like
to continue them.  But that can't happen unless I have code to
discuss.  So if you'd like to see another ``Red Flags'' article, please
consider sending me a 20- to 50-line section of your own code.  If you
do, I won't publish the article without showing it to you beforehand.</p>  



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1744" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/11/gnome2.html" rel="bookmark">Programming GNOME Applications with Perl - Part 2</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2000-11-28T00:00:00-08:00">November 28, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- <a name="programming gnome applications with perl, part two">Programming GNOME Applications with Perl, Part Two</a> -->

<br />
<a name="__index__"></a><!-- INDEX BEGIN -->
<p><table width="180" cellspacing="0" cellpadding="4" align="right" border="1">
<tr>
<td align="center" valign="top" bgcolor="#6699cc">
<font color="#ffffff">Table of Contents</td>
</tr>

<tr>
<td>
<p class="fine">
&#149;<a href="#the cookbook application">The Cookbook Application</a><br />
&#149;<a href="#the main screen">The Main Screen</a><br />
&#149;<a href="#columned lists">Columned Lists</a><br />
&#149;<a href="#displaying recipes">Displaying Recipes</a><br />
&#149;<a href="#where we are, and where we're going">Where We Are, And Where We're Going</a><br />
&#149;<a href="#notes on the last article">Notes on the Last Article</a><br />

</td>
</tr>
</p>
</table>
	<!-- INDEX END -->

<p>Last month's article examined how to create a simple
``Hello World'' application using Gtk+ and GNOME. This month, we'll
build a more sophisticated application - one to
store and retrieve recipes.</p>
<p>

<h3><a name="the cookbook application">The Cookbook Application</a></h3>
<p>Before we write a single line of code, let's see how we're
going to design this. First, we'll look at the user interface, and then
see what that means for our program design.</p>

<p>When designing user interfaces, we need to consider what provides users with the most useful and intuitive view of
their data, without overcrowding them. What do we need to be able to
get at easily when we're using the application? There are two parts to
this question: actions that we can perform, and data we can see.</p>

<p>In terms of the data, I decided that the best way to organize the
available recipes was as a list, just like the table of contents in a
recipe book; scroll up and down the list to see the recipe titles, and
then click on one title to display the whole recipe. We could also
display some useful information next to each title. I decided that the
most useful things to know would be the cooking time and the date that
the recipe was added.</p>

<p>Now we can look at the actions that will be performed - these will be turned into
the toolbar buttons. One of the most useful features I wanted was
the ability to give the program a list of ingredients that I have and
have it tell me things I could cook with them. I also wanted to be
able to maintain several different cookbooks, so ``Save'' and ``Open''
were natural choices. Of course, you need to be able to add new
recipes, so an ``Add'' button would be useful, too. Note that I didn't
want a ``Delete'' button - deleting a recipe is something that'll
probably happen rarely, and even then, you don't want to make it
<strong>too</strong> easy to do. Finally, you need to be able to exit.</p>

<p>That's the interface for the main screen, and this is
what it would look like:</p>

<img src="/pub/2000/11/gnome-main1.jpg" border="0" width="450"><p>Now we can think about the data we need to store. We'll need
to store recipes with their titles,
dates and cooking times. If we want to search by ingredient, we should
also store what ingredients each recipe needs. It would
also be handy to have a complete list of all the ingredients we know
about, and we'll also have some user configuration settings.</p>
<p>Initially, I considered putting the recipes in an SQL database, but
decided against it for two reasons: first, connecting recipes to
ingredients was unnecessarily complicated, and the whole thing seemed
a little overkill, and second, GNOME applications traditionally
store all their data in XML files so that data can be easily passed
between apps. In the end, I decided to store the configuration
settings plus the list of ingredients we know about in a single XML file,
and have the recipe book in a separate file.</p>

<h3><a name="the main screen">The Main Screen</a></h3>

<p>Now that we know what the interface is going to look like for the main
screen, we can start coding it. We'll start with the menu items and
the toolbar, just like before.</p>
<pre>
        #!/usr/bin/perl -w
        use strict;
        use Gnome;

        my $NAME    = 'gCookBook';
        my $VERSION = '0.1';

        init Gnome $NAME;

        my $app = new Gnome::App $NAME, $NAME;
		
        signal_connect $app 'delete_event', 
          sub { Gtk-&gt;main_quit; return 0 };

        $app-&gt;create_menus(
           {
          type =&gt; 'subtree',
          label =&gt; '_File',
          subtree =&gt; [
                { 
                 type =&gt; 'item',
                 label =&gt; '_New',
                 pixmap_type =&gt; 'stock',
                 pixmap_info =&gt; 'Menu_New'
                },
                {
                 type =&gt; 'item',
                 label =&gt; '_Open...',
                 pixmap_type =&gt; 'stock',
                 pixmap_info =&gt; 'Menu_Open'
                },
                {
                 type =&gt; 'item',
                 label =&gt; '_Save',
                 pixmap_type =&gt; 'stock',
                 pixmap_info =&gt; 'Menu_Save'
                },
                {
                 type =&gt; 'item',
                 label =&gt; 'Save _As...',
                 pixmap_type =&gt; 'stock',
                 pixmap_info =&gt; 'Menu_Save As'
                },
                {
                 type =&gt; 'separator'
                },
                {
                 type =&gt; 'item',
                 label =&gt; 'E_xit',
                 pixmap_type =&gt; 'stock',
                 pixmap_info =&gt; 'Menu_Quit',
                 callback =&gt; sub { Gtk-&gt;main_quit; return 0 }
                }
                 ]
           },
           { 
          type =&gt; 'subtree',
          label =&gt; '_Edit',
          subtree =&gt; [
                {
                 type =&gt; 'item',
                 label =&gt; 'C_ut',
                 pixmap_type =&gt; 'stock',
                 pixmap_info =&gt; 'Menu_Cut',
                },
                {
                 type =&gt; 'item',
                 label =&gt; '_Copy',
                 pixmap_type =&gt; 'stock',
                 pixmap_info =&gt; 'Menu_Copy'
                },
                {
                 type =&gt; 'item',
                 label =&gt; '_Paste',
                 pixmap_type =&gt; 'stock',
                 pixmap_info =&gt; 'Menu_Paste'
                }
                 ]
           },
           {
          type =&gt; 'subtree',
          label =&gt; '_Settings',
          subtree =&gt; [
                {
                 type =&gt; 'item',
                 label =&gt; '_Preferences...',
                 pixmap_type =&gt; 'stock',
                 pixmap_info =&gt; 'Menu_Preferences',
                 callback =&gt; \&amp;show_prefs
                }
                 ]
           },
           {
          type   =&gt; 'subtree',
          label  =&gt; '_Help',
          subtree =&gt; [
                {type =&gt; 'item', 
                 label =&gt; '_About...',
                 pixmap_type =&gt; 'stock',
                 pixmap_info =&gt; 'Menu_About',
                 callback =&gt; \&amp;about_box
                }
             ]
           }
          );

    $app-&gt;create_toolbar(
           {
            type     =&gt; 'item',
            label    =&gt; 'Cook',
            pixmap_type =&gt; 'stock',
            pixmap_info =&gt; 'Search',
            hint     =&gt; 'Find a recipe by ingedients'
           },
           {
            type     =&gt; 'item',
            label    =&gt; 'Add',
            pixmap_type =&gt; 'stock',
            pixmap_info =&gt; 'Add',
            hint     =&gt; 'Add a new recipe'
           },
           {
            type     =&gt; 'item',
            label    =&gt; 'Open...', 
            pixmap_type =&gt; 'stock',
            pixmap_info =&gt; 'Open',
            hint     =&gt; &quot;Open a recipe book&quot;
           },
           {
            type     =&gt; 'item',
            label    =&gt; 'Save', 
            pixmap_type =&gt; 'stock',
            pixmap_info =&gt; 'Save',
            hint     =&gt; &quot;Save this recipe book&quot;
           },
           { 
            type     =&gt; 'item',
            label    =&gt; 'Exit',
            pixmap_type =&gt; 'stock',
            pixmap_info =&gt; 'Quit',
            hint     =&gt; &quot;Leave $NAME&quot;,
            callback  =&gt; sub { Gtk-&gt;main_quit;}
           }
          );

    $app-&gt;set_default_size(600,400);

    my $bar = new Gnome::AppBar 0,1,&quot;user&quot; ;
    $bar-&gt;set_status(&quot;&quot;);
    $app-&gt;set_statusbar( $bar );

    show_all $app;

    main Gtk;

    sub about_box {
      my $about = new Gnome::About $NAME, $VERSION,
      &quot;(C) Simon Cozens, 2000&quot;, [&quot;Simon Cozens&quot;], 
      &quot;This program is released under the 
          same terms as Perl itself&quot;;
      show $about;
      }
</pre>

<h3><a name="columned lists">Columned Lists</a></h3>

<p>Next, we have to show the list of recipes. This is usually done with a <code>CList</code>, or ``columned list,'' widget. However, the standard Gtk
<code>CList</code> widget is a little unfriendly to deal with: You can only put
data into it, and you can't find out what is in the list, so you have
to maintain a separate array containing the data; columned lists
usually re-sort themselves when a column title is clicked on, but the
programmer has to handle this case himself; data has to be referenced
by column number, not by column name; and so on.</p>

<p>Since I realized this was going to be unpleasant every time I wanted a
columned list, I wrote a module called <code>Gtk::HandyCList</code> that
encapsulates all these features. (You'll need to download that module
from CPAN if you want to try this. Make sure you get version
0.02, since we use the <code>hide</code> method down below, which is new in that
version.)</p>

<p>To add it to our program, we first need data to display! Let's
create a dummy array of data, like this:</p>
<pre>
        my @cookbook = (
                [ &quot;Frog soup&quot;, &quot;29/08/99&quot;, &quot;12&quot;],
                [ &quot;Chicken scratchings&quot;, &quot;12/12/99&quot;, &quot;40&quot;],
                [ &quot;Pork with beansprouts in a garlic
                    butter sauce and a really really long name
                    that we have to scroll to see&quot;,
                  &quot;1/1/99&quot;, 30],
                [ &quot;Eggy bread&quot;, &quot;10/10/10&quot;, 3]
               );</pre>
<p>Now we need to load the module itself, so:</p>

<pre>    use Gtk::HandyCList;</pre>

<p>Because we want this list to be scrollable, we put it inside a
different widget that handles scroll bars - a 
<code>Gtk::ScrolledWindow</code>.</p>
<pre>
  my $scrolled_window = new Gtk::ScrolledWindow( undef, undef );
  $scrolled_window-&gt;set_policy( 'automatic', 'always' );</pre>
  
<p>Now we create the HandyCList. First, we specify the column names that will be used, then we set up the sizes for each column.</p>
<pre>
  my $list = new Gtk::HandyCList qw(Name Date Time);
  $list-&gt;sizes(350,150,100);</pre>
  
<p>As I mentioned, we want to be able to re-sort the data when we click on the column
headings. To make this work we have to tell
the module <strong>how</strong> to sort each column. It knows about alphabetical
and numeric sorting, but we'll have to tell it about sorting
by date by providing it with a subroutine reference. We also set the
shadow so that it looks pretty.</p>
<pre>
  $list-&gt;sortfuncs(&quot;alpha&quot;, \&amp;sort_date, &quot;number&quot;);
  $list-&gt;set_shadow_type('out');</pre>
  
<p>Now we give the data to the list:</p>
<pre>
  $list-&gt;data(@cookbook);</pre>
  
<p>Next, we add the list to our scrolled window, and tell the application
that its main contents are the scrolled window:</p>
<pre>
  $scrolled_window-&gt;add($list);
  $app-&gt;set_contents($scrolled_window);</pre>
  
<p>Finally, we'll receive the signal sent when a recipe is clicked on,
and use that to display the recipe.</p>
<pre>
  $list-&gt;signal_connect( &quot;select_row&quot;, \&amp;display_recipe);</pre>
  
<p>Of course, we need to write those two subroutines, <code>sort_date</code> and
<code>display_recipe</code>. Let's leave the latter one for now, and polish off
the date sorting. Here's how I'd write it, because I'm British:</p>
<pre>
        sub sort_date {
          my ($ad, $am, $ay) = ($_[0] =~ m|(\d+)/(\d+)/(\d+)|);
          my ($bd, $bm, $by) = ($_[1] =~ m|(\d+)/(\d+)/(\d+)|);
          return $ay &lt;=&gt; $by || $am &lt;=&gt; $bm || $ad &lt;=&gt; $bd;
        }</pre>
		
<p>Exercise for the reader: make this subroutine locale-aware.</p>

<p>By now, you should have an application that displays a
list of recipes along with their dates and cooking times. Play with
it, click on the column headings and watch it re-sort, resize the
windows and the columns, and see what happens.</p>

<h3><a name="displaying recipes">Displaying Recipes</a></h3>
<p>Now let's tackle displaying the recipes. This is where things get more complex. First, we have to store the text for
the recipes. We want to store them, along with the
titles, dates and cooking times, in the <code>@cookbook</code> array. So
let's add another column to that array, like so:</p>
<pre>
    my @cookbook = (
        [ &quot;Frog soup&quot;, &quot;29/08/99&quot;, &quot;12&quot;, 
          &quot;Put frog in water. Slowly raise water temperature 
           until frog is cooked.&quot;],
        [ &quot;Chicken scratchings&quot;, &quot;12/12/99&quot;, &quot;40&quot;, 
          &quot;Remove fat from chicken, and fry 
	   under a medium grill&quot;],
        [ &quot;Pork with beansprouts in a garlic butter sauce 
           and a really really long name that we have to
           scroll to see&quot;,
          &quot;1/1/99&quot;, 30, 
	  &quot;Pour boiling water into packet and stir&quot;],
        [ &quot;Eggy bread&quot;, &quot;10/10/10&quot;, 3, 
	  &quot;Fry bread. Fry eggs. Combine.&quot;]
           );
</pre>

<p>We don't want to display this information on the main
list, so we need to change the data that we're passing to the
<code>Gtk::HandyCList</code>:</p>
<pre>
 - my $list = new Gtk::HandyCList qw(Name Date Time);
 + my $list = new Gtk::HandyCList qw(Name Date Time Recipe);
 + $list-&gt;hide(&quot;Recipe&quot;);</pre>
 
<p>(If you don't remember what that syntax means, it's ``take out the line
starting with the minus, and add in the lines starting with a plus.'')</p>

<p>Now that we have the recipes stored inside our data structure, we want
to be able to see them. We'll use a widget called
<code>Gnome::Less</code>, which is named after the Unix utility <code>less</code>. It's a
file browser, but we can also give it strings to display.</p>

<p>Let's stop and think about what we're going to do. We need to catch
the signal that tells us that the user has double-clicked on a
recipe. Then, we want to pop up a window, create a <code>Gnome::Less</code>
widget inside that window containing the recipe text and allow the
user to dismiss the window. We've already connected the ``mouse click''
signal to a subroutine called <code>display_recipe</code>, so it's time to write
that subroutine.</p>
<pre>
    sub display_recipe {
      my ($clist, $row, $column, $mouse_event) = @_;
      return unless $mouse_event-&gt;{type} eq &quot;2button_press&quot;;</pre>
	  
<p>First, we receive the parameters passed by the signal. The first thing
we get is the object that caused the signal - our <code>HandyCList</code>
widget. That determines what other parameters get sent. In the
case of a <code>HandyCList</code>, it's the row and column in the list that
received the mouse click, and a <code>Gtk::Gdk::MouseEvent</code> object that
tells us what sort of click it was. In our case, we only want to act
on a double click, which is where the type is <code>&quot;2button_press&quot;</code>. If
this isn't the case, we return.</p>
<pre>
      my %recipe = %{($clist-&gt;data)[$row]};</pre>
	  
<p>Given that we know the row that received the signal, we can 
extract that row from the <code>HandyCList</code> via the <code>data</code> method.
<code>Data</code> is a get-set method, which means we can either store data into
the list with it, or we can use it to retrieve the data from the
list. Each row is stored as a hash reference, which we dereference to
a real hash.</p>
<pre>
      my $recipe_str = $recipe{Name}.&quot;\n&quot;;
      $recipe_str .= &quot;-&quot; x length($recipe{Name}).&quot;\n\n&quot;;
      $recipe_str .= &quot;Cooking time : $recipe{Time}\n&quot;;
      $recipe_str .= &quot;Date created : $recipe{Date}\n\n&quot;;
      $recipe_str .= $recipe{Recipe};</pre>

<p>Next, we build the string that we're going to display, using the
hash values we've recovered.</p>
<pre>
      my $db = new Gnome::Dialog($recipe{Name});
      my $gl = new Gnome::Less;
      my $button = new Gtk::Button( &quot;Close&quot; );
      $button-&gt;signal_connect( &quot;clicked&quot;, sub { $db-&gt;destroy } );</pre>
	  
<p>We now create three widgets: the pop-up dialog box window (we pass
the recipe's name as a window title), the pager that will display the
recipe and a close button. We also connect a signal so that when the
button is clicked, the dialog box is destroyed.
</p>
<pre>

      $db-&gt;action_area-&gt;pack_start( $button, 1, 1, 0 );
      $db-&gt;vbox-&gt;pack_start($gl, 1, 1, 0);</pre>

<p>A dialog box consists of two areas: an ``action area'' at the bottom
that should contain the available ``actions,'' or buttons, and a vbox
at the top where we put our messages. Accordingly, we pack our
button into the action area and our <code>Less</code> widget into the vbox</p>
<pre>
      $gl-&gt;show_string($recipe_str);
      show_all $db;
    }</pre>
<p>Finally, we tell the pager what string it should display, and then show
the dialog box. We can now display recipes.</p>
<p>

<h3><a name="where we are, and where we're going">Where We Are, And Where We're Going</a></h3>
The full source of the application so far can be found <a
href="/2000/11/gcookbook.pl">here</a>.

<p>So far, we've only dealt with static data, hard-coded into the
application, which isn't a very real-life scenario. Next time, we'll
look at adding and deleting recipes, as well as saving and restoring
cookbooks to disk using XML. Once that's done, we'll have the core of
a basic cookbook application. In the final part of this tutorial,
we'll add more features, such as searching by ingredients.</p>

<h3><a name="notes on the last article">Notes on the Last Article</a></h3>

<p>Several people wrote me after <a href="/pub/2000/10/gnome.html">last month's article</a> saying that they
couldn't get the GNOME versions of the application working; if that's
a problem, you need to be using the latest version of the
Gnome.pm module. The one on CPAN is <em>not</em> the latest - instead,
use the one from the Gnome.pm Web site, at
<a href="http://projects.prosa.it/gtkperl">http://projects.prosa.it/gtkperl</a>.</p>

<p>I also got my knuckles rapped for saying that ``GNOME is the Unix
desktop.'' Fair play - the other project that's providing the same sort
of environment for Unix is KDE, but for a long time it was hampered by
developers' suspicion of TrollTech and their QPL license. At the same
time, big players like Sun and IBM were putting money into
the GNOME Foundation to <em>make</em> GNOME the Unix desktop, so it seemed a
fair thing to say.</p>

<p>Now most people are happy that the same big players have also set up the KDE League. (From
<a href="http://www.kde.org/announcements/gfresponse.html">http://www.kde.org/announcements/gfresponse.html:</a> `Now we have been
asked ``Will KDE ever create a KDE Foundation in the same sense as the
GNOME Foundation?'' The answer to this is no, absolutely not.' You tell
'em, guys.) KDE looks to be a worthy alternative to GNOME. Obviously,
I prefer GNOME, but as <a href="http://segfault.org">http://segfault.org</a> puts it: ``KDE - GNOME War -
Casualties so far: 0''.</p>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1760" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/11/p5pdigest/THISWEEK-20001127.html" rel="bookmark">This Week on p5p 2000/11/27</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2000-11-27T00:00:00-08:00">November 27, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            </P>

<P>


<!-- This week on perl5-porters (21-27 Nov 2000) -->

<br />
<br /><ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#Regexp_Engine">Regexp Engine</a>
  <li><a href="#SOCKS_and_Sockets">SOCKS and Sockets</a>
  <li><a href="#for_map_and_grep">for, map and grep</a>
  <li><a href="#Encode_Licensing">Encode Licensing</a>
  <li><a href="#PERL5OPT">PERL5OPT</a>
  <li><a href="#Unicode_on_Big_Iron">Unicode on Big Iron</a>
  <li><a href="#Carp">Carp</a>
  <li><a href="#SvTEMP">SvTEMP</a>
  <li><a href="#Locales_and_floats">Locales and Floats</a>
  <li><a href="#Low_hanging_fruit">Low-Hanging Fruit</a>
  <li><a href="#Miscellaneous">Miscellaneous</a>
</ul>

      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an e-mail version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>simon@brecon.co.uk</CODE></P>

<P>
This week was very busy, and saw nearly 400 posts. Unfortunately, I was
also very busy, so this report is slightly late. 
<H3><a name="Regexp_Engine">Regexp Engine</a></H3>

</P>

<P>

First, Jarkko has this to say about his progress with the 
<a href="/pub/2000/11/p5pdigest/THISWEEK-20001120.html#Fixing_The_Regexp_Engine">polymorphic regular expression node</a> problem:
<blockquote></P>

<P>
To this I can add that if so far I had been happily bouncing around
the strange lands of Reg-Ex and shouting back &quot;Dragons?  What dragons?&quot;
to people frantically waving their hands (safely beyond the borders,
funny that)... now I can attest to nasty monsters being fully alive,
and full of flame ... the match variables are now under control
(I *think*) -- but the character classes are mean, mostly because the
data structures implementing them are so different between the byte
and character cases, merging the code using them is, errrm, fun?
I'm currently dodging core dumps falling from the sky, but I think
I'm running in generally right direction ...
</blockquote></P> 

<P>
Ilya also questioned the methodology of merging character and byte
nodes, and Jarkko explained further what he was doing. 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg01077.html">Read about it.</a><H3><a name="SOCKS_and_Sockets">SOCKS and Sockets</a></H3>

</P>

<P>

Jens Hamisch noticed a problem with the SOCKS support: Perl had aliased 
<CODE>close</CODE> to 
<CODE>fclose</CODE> without making a distinction between file and socket cases. SOCKS
provides wrapper functions around a lot of the I/O library, but it
expects people to call 
<CODE>close</CODE> rather than
<CODE>fclose</CODE> on sockets. 
</P>

<P>
Jens provided a patch, but it only seemed to scratch the surface, so Nick 
suggested that, since others had pointed out that playing 
<CODE>stdio</CODE> on sockets was not exactly recommended, we should work the SOCKS
support into our 
<CODE>stdio</CODE> emulation as part of PerlIO.
</P>

<P>
The thread continued to discuss the finer intricacies of PerlIO, 
<CODE>stdio</CODE> and SOCKS support; if that's your thing,
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg01181.html">Read about it.</a><H3><a name="for_map_and_grep">for, map and grep</a></H3>

</P>

<P>

There was a long discussion, prompted by Jarkko, about how it would be 
nice if 
<CODE>for</CODE> could be used more like 
<CODE>map</CODE> or  
<CODE>grep</CODE>, and vice versa, allowing you to say things like:
</P>

</P><PRE>
    map $a { $_ += $a } @array
    grep $a { ... grep $b { $a + $b } } @array
</PRE>

<P>
and also
</P>

</P><PRE>
    for (@a) { ... } if $thing
    $total += $_ for @a if $thing
    
This led to a general discussion of dream syntax for post-expression
modifiers, including things such as:
</PRE>

</P><PRE>
    do_this if $that unless $the_other
</PRE>

<P>
There was no concensus or any patches, but it was fun anyway.
</P>

<P>
It also spawned an interesting sub-thread, which related to the fact
that the implementation of 
<CODE>qw//</CODE> has changed and now the values it produces are read-only in a 
<CODE>for</CODE> loop, hence things like
</P>

</P><PRE>
    map { s/foo/bar/; $_ } qw(good food) 
</PRE>

<P>
now produce an error. Some people thought this was bad, some thought it
was good, some thought it was a bug fix, others thought it was an
unnecessary semantic change. A suggestion was to have some kind of
copy-on-write method so that changing a value in an iterator creates a
copy of the value that is no longer read-only.
</P>

<P>
The whole thread eventually came down to the fact that everyone wants
``Perl to Do What They Mean,'' but ``What They Mean May Not Be What Other
People Mean.''
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00989.html">Read about it.</a></P>

<P>

<H3><a name="Encode_Licensing">Encode Licensing</a></H3>

</P>

<P>
Remember I told you that we used the Encode files from Tcl? Well, as
Nick was preparing documentation on the file format for the conversion
tables, Jarkko spotted the license. Oops! 
</P>

<P>
While Tcl is open-source, the terms it's distributed under aren't the
same terms as Perl, so there was some ooh-ing and aah-ing about whether
it could be let in there. Sarathy piped up and said we should do the
same as we did for 
<CODE>File::Glob</CODE> - include the data, and keep the licensing terms as part of that 
extension.
<H3><a name="PERL5OPT">PERL5OPT</a></H3>

</P>

<P>

Dominus noted that the environment variable 
<CODE>PERL5OPT</CODE>, which claims to behave exactly like switches on the Perl command
command line, doesn't actually behave like that: 
</P>

</P><PRE>
    PERL5OPT=-a -b perl program.pl
</PRE>

<P>
actually turns out to be interpreted as 
</P>

</P><PRE>
    perl '-a -b' program.pl
</PRE>

<P>
which meant that you couldn't have more than one 
<CODE>-M</CODE> clause. It also turned out (as reported to me by Rich Lafferty) that
</P>

</P><PRE>
    PERL5OPT='-Mstrict; print "Hello\n"'
</PRE>

<P>
has rather unpleasant results, and there was some discussion as to
whether this was a security problem.
</P>

<P>
Your humble author produced a patch to have the variable interpreted
properly, and Dominus came up with a neat set of tests; however, both
patch and test appeared to be slightly buggy, so that's not quite
resolved just yet.
<H3><a name="Unicode_on_Big_Iron">Unicode on Big Iron</a></H3>

</P>

<P>

Peter Prymmer has been making OS/390 Perl better; it now passes a
whopping 94.12 percent of its tests. However, I complained that the reason that
it was passing some of those was that we were hiding the fact that
Unicode didn't work. There was some, uhm, heated debate before we all
ascertained that we really did want Unicode to work, and we looked into
the problems that are stopping it. 
</P>

<P>
The nice thing about Unicode for ASCII machines is that the bottom 128
characters are the same, so you don't even need to think about
them. The nasty thing about Unicode for EBCDIC machines is that they're
not ASCII machines, and so there has to be some kind of translation
going on. The plan is to introduce an array that converts EBCDIC to
ASCII, and we'll see where that gets us.
<H3><a name="Carp">Carp</a></H3>

</P>

<P>

Ben Tilly has been thinking for a while about the 
<CODE>Carp</CODE> module; it has convoluted and messy internal semantics. 
</P>

<P>
Here's how the problem comes about: Carp has to report errors on behalf of 
your module - let's call it module 
<CODE>A</CODE> - but from the point of view of code that uses module A. OK, so far? 
</P>

<P>
However, what happens if the error messages are not generated
by module 
<CODE>A</CODE> directly, but are lexical warnings produced by the 
<CODE>warnings</CODE> pragma? Obviously, you don't want 
<CODE>Carp</CODE> to be churning out warnings that claim to come from the guts of 
<CODE>warnings.pm</CODE>. So, 
<CODE>Carp</CODE> has to know to skip over certain modules that are internal to
Perl, and go further up the stack. There's an undocumented
variable that allows you to skip over stack frames, but Ben considers
this messy, and with good reason.
</P>

<P>
Worse, it's possible to get infinite loops when package inheritance
comes into play. Ben is working on ideas on how to
get around it, and Hugo and others have been helping him think about
this.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg01297.html">Read about it.</a></P>

<P>

<H3><a name="SvTEMP">SvTEMP</a></H3>

</P>

<P>
If you say 
</P>

</P><PRE>
        sub foo { "a" } @foo=(foo())[0,0];
</PRE>

<P>
you might be surprised to find that your array only has one element. The
problem is that when a subroutine returns a list, the SV members of the
list are marked as temporary, on the assumption that something is going
to scoop them up and use them. This saves us making copies of the SVs
and then throwing them away later. Unfortunately, what happened here is
that 
<CODE>foo</CODE> returned a single value, which something did indeed scoop up and use.
When the second part of the slice tries to take another value, there's
nothing on the list.
</P>

<P>
Benjamin Holzman had a look at this and produced a patch that turned
off the 
<CODE>SvTEMP</CODE> marking of anything about to be used in an array assignment. Sarathy
pointed out that this wasn't exactly right, because 
<CODE>SvTEMP</CODE> means several different things. Benjamin tried again, using another bit
to indicate whether the value could be stolen without a copy.
Sarathy was concerned by the use of a &quot;whole bit&quot; for this task, and
suggested a simpler answer: checking for both 
<CODE>SvTEMP</CODE> and also participation in an array assign:
</P>

</P><PRE>
     SvTEMP(sv) && !(PL_op && PL_op->op_type == OP_AASSIGN)
</PRE>

<P>
Bejamin then revised his patch, which Jarkko applied.
<H3><a name="Locales_and_floats">Locales and Floats</a></H3>

</P>

<P>

There's a horrible problem with locales: (Jarkko would argue that
locales are horrible problems) 
[printf &quot;%e&quot;] should probably be locale-aware in the scope of
<CODE>use locale</CODE>. This means that, theoretically, it should be tainted, because locale
data can be corrupted.
</P>

<P>
So what about 
<CODE>print 0.0+$x</CODE> - that also does a floating-point conversion. Should that be locale-aware under 
<CODE>use locale</CODE>? Should it be automatically tainted? This was a tricky discussion, and
it seems it's a problem that's been hanging around for a long time,
and probably won't be solved soon. You can, however,
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg01310.html">take a look at the thread for yourself</a>.
<H3><a name="Low_hanging_fruit">Low-Hanging Fruit</a></H3>

</P>

<P>

Here are a couple of jobs that people can look into if they have a 
spare moment:
</P>

<P>
Hugo found that 
<CODE>make distclean</CODE> was creating some 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg01306.html">dangerously long shell lines</a>. Andreas found a 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00995.html">scoping bug with %H</a>, and Ilya replied explaining
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg01168.html">how to fix it</a>. This 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg01332.html">report of a segfault</a> could be worth waving a debugger over.
<H3><a name="Miscellaneous">Miscellaneous</a></H3>

</P>

<P>

Jarkko said &quot;Thanks, applied&quot; 15 times this week.
</P>

<P>
Until next week, I remain your humble and obedient servant,
</P>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Cozens</a>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1758" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/11/p5pdigest/THISWEEK-20001120.html" rel="bookmark">This Week on p5p 2000/11/20</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2000-11-20T00:00:00-08:00">November 20, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            ></P>

<P>


<!-- This week on perl5-porters (13-20 Nov 2000) -->

<br />
<br /><ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#Fixing_the_Regexp_Engine">Fixing the Regexp Engine</a>
  <li><a href="#UTF8_and_Charnames">UTF8 and Charnames</a>
  <li><a href="#PerlIO_again">PerlIO (again)</a>
  <li><a href="#head3_again">=head3 (again)</a>
  <li><a href="#New_subspm">New subs.pm</a>
  <li><a href="#Congratulations">Congratulations</a>
  <li><a href="#Various">Various</a>
</ul>

      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an e-mail version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>simon@brecon.co.uk</CODE></P>

<P>
There were more than 250 messages this week.
<H3><a name="Fixing_the_Regexp_Engine">Fixing the Regexp Engine</a></H3>

</P>

<P>

There's been a lot of work on the regular-expression engine this week,
from Jarkko and Ilya. If you recall, there have been two major problems
with the regular-expression engine. First, there's re-entrancy. What this means is that if you try to say
</P>

</P><PRE>
    m/something(?{s|foo|bar|})bad/
</PRE>

<P>
then by the time you get to 
<CODE>bad</CODE>, the engine will be confused,
because it can't restore context properly after the 
<CODE>s|foo|bar</CODE>. It can now, thanks to Ilya, who noted:
<blockquote></P>

<P>
 
Why such a trivial patch should wait for me to do it?!
</P>

<P>
Doing a similar edit of regexec() is left as an exercise to the
reader.
</blockquote></P>

<P>

Jarkko retaliated, &quot;Most us mortals find the 
<CODE>reg*.[hc]</CODE> rather daunting.&quot; I note that the &quot;trivial patch&quot; was 89k.
</P>

<P>
The second problem is recursion; (See
<a href="/pub/2000/11/p5pdigest/THISWEEK-20001107.html#The_Regex_Stack_Problem">coverage two weeks ago</a>)
what this means is that things
such as the pathological example that Dan Brumlevel produced this week
causes stack overflows:
</P>

</P><PRE>
    '' =~ ($re = qr((??{$i++ < 10e4 ? $re : ''})));
</PRE>

<P>
Ilya also started work on &quot;flattening&quot; the regular expression engine to
remove this recursion. While his patch doesn't solve the problem, it
mitigates it considerably and also allows stack unwinding on things like
alternation.
</P>

<P>
The famous &quot;polymorphic regular expression&quot; problem also saw some work,
thanks to Jarkko. This problem occurs when matching inside UTF8 strings;
it goes a little like this: Given a character string which contains
character 300, which is represented in UTF8 as character 196 followed by
character 172, should character 172 match? Of course, it shouldn't, but
it currently does. What's needed is to turn each &quot;node&quot; of a regular
expression into something that can make sense as a character and
also as a series of bytes, and then it can behave appropriately when matched
in 
<CODE>byte</CODE> mode and in character mode.  (See
<a href="/pub/2000/07/p5pdigest/THISWEEK-20000702.html#Unicode_Regex_Matching">previous discussion of this</a>.)
</P>

<P>
Jarkko reports that most of it is now working, apart from the special
match variables (
<CODE>$&</CODE>, 
<CODE>$`</CODE> and 
<CODE>$'</CODE>) and the POSIX character classes.
<H3><a name="UTF8_and_Charnames">UTF8 and Charnames</a></H3>

</P>

<P>

Andrew McNaughton found that 
<CODE>Charnames</CODE> didn't produce UTF8-encoded strings on code points less than 255. He
produced some patches to make it do so, but Nick and I
didn't believe that it should be UTF8-encoding if it doesn't need
to be. Perl's UTF8 encoding is done lazily - strings are upgraded if Perl
can't avoid upgrading them.
<H3><a name="PerlIO_again">PerlIO (again)</a></H3>

</P>

<P>

Nick's sterling work on PerlIO continues, and this week he raised the
question of where to store the defaults that 
<CODE>use open</CODE> sets; currently, there are four bits set in the CV, two for input and two
for output. However, since this only gives you four states, it's not
exactly extensible to user-defined disciplines. The suggestion from
Sarathy was to use the same area used by the lexical warnings pragma.
The whole thread contains a good discussion about how the semantics of
PerlIO disciplines will pad out.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00780.html">Read about it.</a></P>

<P>

<H3><a name="head3_again">=head3 (again)</a></H3>

</P>

<P>
Casey Tweten's unstinting drive to make POD support 
<CODE>=head3</CODE> and further levels continues. He first patched the documentation, and
then patched 
<CODE>Pod::Checker</CODE> to make sure it wouldn't complain about the new levels. Russ Allbery
 released a new version of the podlaters to support them.
<H3><a name="New_subspm">New subs.pm</a></H3>

</P>

<P>

Jeff Pinyan put forward a new 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00822.html">version of subs.pm</a> which is supposed to deal with pre-declaring prototypes and attributes.
It needed a little smoothing out, but it's looking quite good now.
<H3><a name="Congratulations">Congratulations</a></H3>

</P>

<P>

Two sets of congratulations are in order this week. First, to the
dedicated team of bug squashers; there are now less than 1,000
open bugs in Perl, and none of those is considered fatal.
</P>

<P>
Congratulations are also due to Perl hacker Mark Fisher, who just
become a daddy.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00934.html">Read about it.</a></P>

<P>

<H3><a name="Various">Various</a></H3>

</P>

<P>
Quite a lot of useful minor fixes, and a few noninteresting bug
reports. Lots of the usual test results. Only two flames this week, and
one each from your illustrious perl5-porters digest authors. You'd think
we'd know better.
</P>

<P>
Until next week I remain, your humble and obedient servant,
</P>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Cozens</a>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1742" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/11/begperl3.html" rel="bookmark">Beginner's Introduction to Perl - Part 3</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Doug Sheppard</span> on <abbr class="published" title="2000-11-20T00:00:00-08:00">November 20, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- A little <code>s///</code> and <code>m//</code> -->

<p><em>Editor's note: this venerable series is undergoing updates.  You might be interested in the newer versions, available at:</em></p>

<ul>
<li><a href="/pub/2008/04/23/a-beginners-introduction-to-perl-510.html">A Beginner's Introduction to Perl 5.10</a>
<li><a href="/pub/2008/05/07/beginners-introduction-to-perl-510-part-2.html">A
Beginner's Introduction to Files and Strings with Perl 5.10</a>
<li><a href="http://news.oreilly.com/2008/06/a-beginners-introduction-to-pe.html">A
Beginner's Introduction to Regular Expressions with Perl 5.10</a></li>
<li><a href="http://broadcast.oreilly.com/2008/09/a-beginners-introduction-to-pe.html">A Beginner's Introduction to Perl Web Programming</a></li>
</ul>

<br />
<br />
<p><table
width="180" cellspacing="0" cellpadding="4" align="right" border="1">
<tr> <td align="center" valign="top" bgcolor="#6699cc"> <font
color="#ffffff">Table of Contents</td> </tr> <tr> <td> <p
class="fine">
&#149;<b><a
href="/pub/2000/10/begperl1.html">Part 1 of this
series</a></b><br />
&#149;<b><a
href="/pub/2000/11/begperl2.html">Part 2 of this
series</b></a><br />
&#149;<b><a href="/pub/2000/12/begperl4.html">Part 4 of this series</a></b><br />
&#149;<b><a href="/pub/2000/12/begperl5.html">Part 5 of this series</a></b><br />
&#149;<b><a href="/pub/2001/01/begperl6.html">Part 6 of this series</a></b><br /><br />
 &#149;<a href="#simple matching">Simple
matching</a><br /> &#149;<a
href="#metacharacters">Metacharacters</a><br /> &#149;<a
href="#character classes">Character classes</a><br /> &#149;<a
href="#flags">Flags</a><br /> &#149;<a
href="#subexpressions">Subexpressions</a><br /> &#149;<a href="#watch
out!">Watch out!</a><br /> &#149;<a href="#search and replace">Search
and replace</a><br /> &#149;<a href="#play around!">Play around!</a>
</td> </tr> </p> </table> <p>We've covered flow control,

math and string operations, and files in the first two articles in this series.  Now we'll look at Perl's
most powerful and interesting way of playing with strings,
<em>regular expressions</em>, or <em>regexes</em> for short.  (The rule is this:
after the 50th time you type ``regular expression,'' you find you
type ``regexp'' the next 50 times.)</p> <p>Regular expressions are complex enough that you could write a whole
book on them (and, in fact, someone did - <em>Mastering Regular
Expressions</em> by Jeffrey Friedl).</p> <h3><a name="simple matching">Simple matching</a></h3> <p>The simplest regular expressions are <em>matching</em> expressions.  They
perform tests using keywords like <code>if</code>, <code>while</code> and
<code>unless</code>. Or, if you want to be really clever, tests that you can use with
<code>and</code> and <code>or</code>.  A matching regexp will return a true value if whatever
you try to match occurs inside a string.  When you want to
use a regular expression to match against a string, you use the special
<code>=~</code> operator:</p> <pre> $user_location = &quot;I see thirteen black cats under a ladder.&quot;;
    if ($user_location =~ /thirteen/) {
        print &quot;Eek, bad luck!\n&quot;;
    }
	</pre>
	
<p>Notice the syntax of a regular expression: a string within a pair of
slashes.  The code <code>$user_location =~ /thirteen/</code> asks whether the
literal string <code>thirteen</code> occurs anywhere inside
<code>$user_location</code>.  If it does, then the test evaluates true;
otherwise, it evaluates false.</p>

<h3><a name="metacharacters">Metacharacters</a></h3>

<p>A <em>metacharacter</em> is a character or sequence of characters that has
special meaning.  We've discussed metacharacters in the context of
double-quoted strings, where the sequence <code>\n</code> mean the newline
character, not a backslash, and the character <code>n</code> and
<code>\t</code> means the tab character.</p>

<p>Regular expressions have a rich vocabulary of metacharacters that let
you ask interesting questions such as, ``Does this expression occur at the end
of a string?'' or ``Does this string contain a series of numbers?''</p> <p>The two simplest metacharacters are <code>^</code> and <code>$</code>.  These indicate
``beginning of string'' and ``end of string,'' respectively.  For example,
the regexp <code>/^Bob/</code> will match ``Bob was here,'' ``Bob'' and ``Bobby.''  It
won't match ``It's Bob and David,'' because Bob doesn't show up at the
beginning of the string.  The <code>$</code> character, on the other hand, means
that you are matching the end of a string.  The regexp <code>/David$/</code> will
match ``Bob and David,'' but not ``David and Bob.''  Here's a simple routine
that will take lines from a file and only print URLs that seem to indicate
HTML files:</p> <pre>for $line (&lt;URLLIST&gt;) {
        # &quot;If the line starts with http: and ends with html....&quot;
        if (($line =~ /^http:/) and
            ($line =~ /html$/)) {
            print $line;
        }
    }</pre> <p>Another useful set of metacharacters is called <em>wildcards</em>.  If you've
ever used a Unix shell or the Windows DOS prompt, you're familiar with
wildcards characters like <code>*</code> and <code>?</code>.  For example when you type <code>ls a*.txt</code>, you see all filenames that begin with the letter <code>a</code> and
end with <code>.txt</code>.  Perl is a bit more complex, but works
on the same general principle.</p> <p>In Perl, the generic wildcard character is <code>.</code>.  A period inside a
regular expression will match <em>any</em> character, except a newline.  For
example, the regexp <code>/a.b/</code> will match anything that contains <code>a</code>,
another character that's not a newline, followed by <code>b</code> - ``aab,'' ``a3b,''
``a b,'' and so forth.</p> <p>If you want to <em>literally</em> match a metacharacter, you must escape it
with a backslash.  The regex <code>/Mr./</code> matches anything
that contains ``Mr'' followed by another character.  If you only want
to match a string that actually contains ``Mr.,'' you must use
<code>/Mr\./</code>.</p> <p>On its own, the <code>.</code> metacharacter isn't very useful, which is why Perl
provides three wildcard <em>quantifiers</em>:  <code>+</code>, <code>?</code> and <code>*</code>.  Each
quantifier means something different.</p> <p>The <code>+</code> quantifier is the easiest to understand: It means to match the
immediately preceding character or metacharacter <em>one or more times</em>.
The regular expression <code>/ab+c/</code> will match ``abc,'' ``abbc,'' ``abbbc'' and
so on.</p> <p>The <code>*</code> quantifier matches the immediately preceding character or
metacharacter <em>zero or more times</em>.  This is different from the <code>+</code> quantifier!  <code>/ab*c/</code> will match ``abc,'' ``abbc,'' and so on, just like
<code>/ab+c/</code> did, but it'll also match ``ac,'' because there are zero
occurences of <code>b</code> in that string.</p> <p>Finally, the <code>?</code> quantifier will match the preceding character <em>zero
or one times</em>.  The regex <code>/ab?c/</code> will match ``ac'' (zero occurences
of <code>b</code>) and ``abc'' (one occurence of <code>b</code>).  It won't match ``abbc,'' ``abbbc''
and so on.</p> <p>We can rewrite our URL-matching code to use these metacharacters.  This'll
make it more concise.  Instead of using two separate
regular expressions (<code>/^http:/</code> and <code>/html$/</code>), we combine them
into one regular expression:  <code>/^http:.+html$/</code>.  To understand
what this does, read from left to right: This regex will match any
string that <em>starts with ``http:''</em> followed by <em>one or more occurences
of any character</em>, and <em>ends with ``html''</em>.  Now, our routine is:</p> <pre> for $line (&lt;URLLIST&gt;) {
        if ($line =~ /^http:.+html$/) {
           print $line;
        }
    }</pre> <p>Remember the <code>/^something$/</code> construction - it's very useful!</p> <h3><a name="character classes">Character classes</a></h3> <p>We've already discussed one special metacharacter, <code>.</code>, that matches
any character except a newline.  But you'll often want to match
only specific types of characters.  Perl provides several metacharacters
for this.  &lt;\d&gt; will match a single digit, <code>\w</code> will match any single
``word'' character (which, to Perl, means a letter, digit or underscore),
and <code>\s</code> matches a whitespace character (space and tab, as well as the
<code>\n</code> and <code>\r</code> characters).</p> <p>These metacharacters work like any other character: You can match
against them, or you can use quantifiers like <code>+</code> and <code>*</code>.  The regex
<code>/^\s+/</code> will match any string that begins with whitespace, and <code>/\w+/</code> will match a string that contains at least one word.  (But remember that
Perl's definition of ``word'' characters includes digits and the underscore,
so whether or not you think <code>_</code> or <code>25</code> are words, Perl does!)</p> <p>One good use for <code>\d</code> is testing strings to see whether they contain numbers.
For example, you might need to verify that a string contains an
American-style phone number, which has the form <code>555-1212</code>.  You could
use code like this:</p> <pre> unless ($phone =~ /\d\d\d-\d\d\d\d/) {
 print &quot;That's not a phone number!\n&quot;;
    }</pre> <p>All those <code>\d</code> metacharacters make the regex hard to read.
Fortunately, Perl allows us to improve on that.  You can use numbers inside
curly braces to indicate a <em>quantity</em> you want to match, like this:</p> <pre> unless ($phone =~ /\d{3}-\d{4}/) {
 print &quot;That's not a phone number!\n&quot;;
   }</pre> <p>The string <code>\d{3}</code> means to match exactly three numbers, and <code>\d{4}</code> matches exactly four digits.  If you want to use a range of numbers, you
can separate them with a comma; leaving out the second number makes the
range open-ended.  <code>\d{2,5}</code> will match two to five digits, and
&lt;\w{3,}&gt; will match a word that's at least three characters long.</p> <p>You can also <em>invert</em> the <code>\d</code>, <code>\s</code> and <code>\w</code> metacharacters to refer
to anything <em>but</em> that type of character.  <code>\D</code> matches nondigits; <code>\W</code> matches any character that <em>isn't</em> a letter, digit or underscore;
and <code>\S</code> matches anything that isn't whitespace.</p> <p>If these metacharacters won't do what you want, you can define your
own.  You define a character class by enclosing a list of the allowable
characters in square brackets.  For example,
a class containing only the lowercase vowels is <code>[aeiou]</code>.
<code>/b[aeiou]g/</code> will match any string that contains ``bag,'' ``beg,'' ``big,''
``bog'' or ``bug''.  You use dashes to indicate a range of characters,
like <code>[a-f]</code>.  (If Perl didn't give us the <code>\d</code> metacharacter, we could do
the same thing with <code>[0-9]</code>.)  You can combine character classes with
quantifiers:</p> <pre> if ($string =~ /[aeiou]{2}/) {
 print &quot;This string contains at least
        two vowels in a row.\n&quot;;
    }</pre> <p>You can also invert character classes by beginning them with the <code>^</code> character.  An inverted character class will match anything you <em>don't</em> list.  <code>[^aeiou]</code> matches every character except the lowercase vowels.
(Yes, <code>^</code> can also mean ``beginning of string,'' so be careful.)</p> <h3><a name="flags">Flags</a></h3> <p>By default, regular expression matches are case-sensitive (that is,
<code>/bob/</code> doesn't match ``Bob'').  You can place <em>flags</em> after a regexp
to modify their behaviour.  The most commonly used flag is <code>i</code>, which
makes a match case-insensitive:</p> <pre> $greet = &quot;Hey everybody, it's Bob and David!&quot;;
    if ($greet =~ /bob/i) {
        print &quot;Hi, Bob!\n&quot;;
    }</pre> <p>We'll talk about more flags later.</p> <h3><a name="subexpressions">Subexpressions</a></h3> <p>You might want to check for more than one thing at a time.  For example,
you're writing a ``mood meter'' that you use to scan outgoing e-mail for
potentially damaging phrases.  You can use the pipe character <code>|</code> to
separate different things you are looking for:</p> <pre> # In reality, @email_lines would come from your email text, 
   # but here we'll just provide some convenient filler.
   @email_lines = (&quot;Dear idiot:&quot;,
                   &quot;I hate you, you twit.  You're a dope.&quot;,
                   &quot;I bet you mistreat your llama.&quot;,
                   &quot;Signed, Doug&quot;);

   for $check_line (@email_lines) {
       if ($check_line =~ /idiot|dope|twit|llama/) {
           print &quot;Be careful!  This line might
	          contain something offensive:\n&quot;,
                 $check_line, &quot;\n&quot;;
       }
   }</pre> <p>The matching expression <code>/idiot|dope|twit|llama/</code> will be true
if ``idiot,'' ``dope,'' ``twit'' or ``llama'' show up anywhere in the
string.</p> <p>One of the more interesting things you can do with regular expressions
is <em>subexpression matching</em>, or grouping.  A subexpression is like another,
smaller regex buried inside your larger regexp, and is placed inside
parentheses.  The string that caused the subexpression
to match will be stored in the special variable <code>$1</code>.  We can use
this to make our mood meter more explicit about the problems
with your e-mail:</p>  <pre> for $check_line (@email_lines) {
       if ($check_line =~ /(idiot|dope|twit|llama)/) {
           print &quot;Be careful!  This line contains the
                  offensive word $1:\n&quot;,
                 $check_line, &quot;\n&quot;;
       }
   }</pre> <p>Of course, you can put matching expressions in your subexpression.  Your mood
watch program can be extended to prevent you from sending e-mail that
contains more than three exclamation points in a row.  We'll use the special
<code>{3,}</code> quantifier to make sure we get <em>all</em> the exclamation points.</p> <pre> for $check_line (@email_lines) {
        if ($check_line =~ /(!{3,})/) {
            print &quot;Using punctuation like '$1' 
                   is the sign of a sick mind:\n&quot;,
                  $check_line, &quot;\n&quot;;
        }
    }</pre> <p>If your regex contains more than one subexpression, the results will be
stored in variables named <code>$1</code>, <code>$2</code>, <code>$3</code> and so on.  Here's some code
that will change names in ``lastname, firstname'' format back to normal:</p> <pre> $name = &quot;Wall, Larry&quot;;
   $name =~ /(\w+), (\w+)/;
   # $1 contains last name, $2 contains first name

   $name = &quot;$2 $1&quot;;
   # $name now contains &quot;Larry Wall&quot;
</pre> <p>You can even nest subexpressions inside one another - they're ordered as they
open, from left to right.  Here's an example of how to retrieve the full
time, hours, minutes and seconds separately from a string that contains
a timestamp in <code>hh:mm:ss</code> format.  (Notice that we're using the
<code>{1,2}</code> quantifier so that a timestamp like ``9:30:50'' will be matched.)</p> <pre> $string = &quot;The time is 12:25:30 and I'm hungry.&quot;;
    $string =~ /((\d{1,2}):(\d{2}):(\d{2}))/;
    @time = ($1, $2, $3, $4);</pre> <p>Here's a hint that you might find useful: You can assign <em>to</em> a
list of scalar values whenever you're assigning <em>from</em> a list.  If you
prefer to have readable variable names instead of an array, try using this
line instead:</p> <pre> ($time, $hours, $minutes, $seconds) = ($1, $2, $3, $4);</pre> <p>Assigning to a list of variables when you're using subexpressions
happens often enough that Perl gives you a handy shortcut:</p> <pre> ($time, $hours, $minutes, $seconds) =
         ($string =~ /((\d{1,2}):(\d{2}):(\d{2}))/);
</pre> <h3><a name="watch out!">Watch out!</a></h3> <p>Regular expressions have two traps that generate bugs in
your Perl programs: They always start at the beginning of the string,
and quantifiers always match as much of the string as possible.</p> <p>Here's some simple code for counting all the numbers in
a string and showing them to the user.  We'll use <code>while</code> to loop
over the string, matching over and over until we've counted all
the numbers.</p> <pre> $number = &quot;Look, 200 5-sided, 4-colored pentagon maps.&quot;;
    while ($number =~ /(\d+)/) {
        print &quot;I found the number $1.\n&quot;;
        $number_count++;
    }
    print &quot;There are $number_count numbers here.\n&quot;;</pre> <p>This code is actually so simple it doesn't work!  When you run it, Perl
will print <code>I found the number 200</code> over and over again.  Perl
always begins matching at the beginning of the string, so it
will always find the 200, and never get to the following numbers.</p> <p>You can avoid this by using the <code>g</code> flag with your regex.  This flag
will tell Perl to remember where it was in the string when it returns
to it.  When you insert the <code>g</code> flag, our code looks like this:</p> <pre> $number = &quot;Look, 200 5-sided, 4-colored pentagon maps.&quot;;
    while ($number =~ /(\d+)/g) {
        print &quot;I found the number $1.\n&quot;;
        $number_count++;
    }
    print &quot;There are $number_count numbers here.\n&quot;;</pre> <p>Now we get the results we expected:</p> <pre> I found the number 200.
    I found the number 5.
    I found the number 4.
    There are 3 numbers here.</pre> <p>The second trap is that a quantifier will always match as many characters
as it can.  Look at this example code, but don't run it yet:</p> <pre> $book_pref = &quot;The cat in the hat is where it's at.\n&quot;;
    $book_pref =~ /(cat.*at)/;
    print $1, &quot;\n&quot;;
</pre> <p>Take a guess: What's in <code>$1</code> right now?  Now run the code.  Does this
seem counterintuitive?</p> <p>The matching expression <code>(cat.*at)</code> is greedy. It contains
<code>cat in the hat is where it's at</code> because that's the largest string
that matches.  Remember, read left to right: ``cat,'' followed
by any number of characters, followed by ``at.''  If you want to
match the string <code>cat in the hat</code>, you have to rewrite your regexp
so it isn't as greedy.  There are two ways to do this:</p> <p>1. Make the match more precise (try <code>/(cat.*hat)/</code> instead).  Of course,
this still might not work - try using this regexp against <code>The cat in
the hat is who I hate</code>.</p> <p>2. Use a <code>?</code> character after a quantifier to specify nongreedy matching.
<code>.*?</code> instead of <code>.*</code> means that Perl will try to match the <em>smallest</em> string possible instead of the largest:</p> <pre> # Now we get &quot;cat in the hat&quot; in $1.
  $book_pref =~ /(cat.*?at)/;
</pre> <h3><a name="search and replace">Search and replace</a></h3> <p>Now that we've talked about <em>matching</em>, there's one other
thing regular expressions can do for you: <em>replacing</em>.</p> <p>If you've ever used a text editor or word processor, you're familiar
with the search-and-replace function.  Perl's regexp facilities include
something similar, the <code>s///</code> operator, which has the following syntax:
<code>s/regex/replacement string/</code>.  If the string you're testing matches
<em>regex</em>, then whatever matched is replaced with the contents of
<em>replacement string</em>.  For instance, this code will change
a cat into a dog:</p> <pre> $pet = &quot;I love my cat.\n&quot;;
    $pet =~ s/cat/dog/;
    print $pet;</pre> <p>You can also use subexpressions in your matching expression, and use
the variables <code>$1</code>, <code>$2</code> and so on, that they create.  The replacement
string will substitute these, or any other variables, as if it were a
double-quoted string.  Remember our code for changing <code>Wall, Larry</code> into <code>Larry Wall</code>?  We can rewrite it as a single <code>s///</code> statement!</p> <pre> $name = &quot;Wall, Larry&quot;;
    $name =~ s/(\w+), (\w+)/$2 $1/;  # &quot;Larry Wall&quot;</pre> <p><code>s///</code> can take flags, just like matching expressions.  The two most
important flags are <code>g</code> (global) and <code>i</code> (case-insensitive).
Normally, a substitution will only happen <em>once</em>, but specifying the 
<code>g</code> flag will make it happen as long as the regex matches the string.
Try this code, and then remove the <code>g</code> flag and try it again:</p> <pre> $pet = &quot;I love my cat Sylvester, and my other cat Bill.\n&quot;;
   $pet =~ s/cat/dog/g;
   print $pet;</pre> <p>Notice that without the <code>g</code> flag, Bill doesn't turn into a dog.
</p> <p>The <code>i</code> flag works just as it did when we were only using matching
expressions: It forces your matching search to be case-insensitive.</p>  <h3><a name="putting it all together">Putting it all together</a></h3> <p>Regular expressions have many practical uses.  We'll look at a httpd
log analyzer for an example.  In our last article, one of the play-around
items was to write a simple log analyzer.  Now, let's make it a bit more
interesting: a log analyzer that will break down your log results by
file type and give you a list of total requests by hour.</p> <p>(<a href="/pub/2000/11/a3-httpd.pl">Complete source code</a>.)</p>  <p>First, let's look at a sample line from a httpd log:</p> <pre> 127.12.20.59 - - [01/Nov/2000:00:00:37 -0500] 
	&quot;GET /gfx2/page/home.gif HTTP/1.1&quot; 200 2285
</pre> <p>The first thing we want to do is split this into fields.  Remember that
the <code>split()</code> function takes a regular expression as its first argument.
We'll use <code>/\s/</code> to split the line at each whitespace character:</p> <pre> @fields = split(/\s/, $line);</pre> <p>This gives us 10 fields.  The ones we're concerned
with are the fourth field (time and date of request), the seventh (the
URL), and the ninth and 10th (HTTP status code and size in bytes of
the server response).</p> <p>First, we'd like to make sure that we turn any request for a URL that
ends in a slash (like <code>/about/</code>) into a request for the index page from
that directory (<code>/about/index.html</code>).  We'll need to escape out the
slashes so that Perl doesn't mistake them for terminators in our <code>s///</code> statement.</p> <pre> $fields[6] =~ s/\/$/\/index.html/;</pre> <p>This line is difficult to read, because anytime we come across a literal
slash character we need to escape it out.  This problem is so
common, it has acquired a name: <em>leaning-toothpick syndrome</em>.  Here's a useful
trick for avoiding the leaning-toothpick syndrome: You can replace the slashes
that mark regular expressions and <code>s///</code> statements with any other matching
pair of characters, like <code>{</code> and <code>}</code>.  This allows us to write a 
more legible regex where we don't need to escape out the slashes:</p> <pre> $fields[6] =~ s{/$}{/index.html};</pre> <p>(If you want to use this syntax with a matching expression, you'll need
to put a <code>m</code> in front of it.  <code>/foo/</code> would be rewritten as <code>m{foo}</code>.)</p> <p>Now, we'll assume that any URL request that returns a status code of 200
(request OK) is a request for the file type of the URL's extension (a
request for <code>/gfx/page/home.gif</code> returns a GIF image).  Any URL request
without an extension returns a plain-text file.  Remember that the
period is a metacharacter, so we need to escape it out!</p> <pre> if ($fields[8] eq '200') {
           if ($fields[6] =~ /\.([a-z]+)$/i) {
               $type_requests{$1}++;
           } else {
               $type_requests{'txt'}++;
           }
        }</pre> <p>Next, we want to retrieve the <em>hour</em> each request took place.  The hour
is the first string in <code>$fields[3]</code> that will be two digits surrounded
by colons, so all we need to do is look for that.  Remember that Perl
will stop when it finds the first match in a string:</p> <pre> # Log the hour of this request
        $fields[3] =~ /:(\d{2}):/;
        $hour_requests{$1}++;</pre> <p>Finally, let's rewrite our original <code>report()</code> sub.  We're doing the
same thing over and over (printing a section header and the contents
of that section), so we'll break that out into a new sub.  We'll
call the new sub <code>report_section()</code>:</p> <pre> sub report {
    print ``Total bytes requested: '', $bytes, ``\n'';</p> print &quot;\n&quot;;
    report_section(&quot;URL requests:&quot;, %url_requests);
    report_section(&quot;Status code results:&quot;, %status_requests);
    report_section(&quot;Requests by hour:&quot;, %hour_requests);
    report_section(&quot;Requests by file type:&quot;, %type_requests);
}
</pre> <p>The new <code>report_section()</code> sub is very simple:</p> <pre> sub report_section {
    my ($header, %type) = @_;</p> print $header, &quot;\n&quot;;
    for $i (sort keys %type) {
        print $i, &quot;: &quot;, $type{$i}, &quot;\n&quot;;
    }

    print &quot;\n&quot;;
}
</pre> <p>We use the <code>keys</code> function to return a list of the keys in the <code>%type</code> hash, and the <code>sort</code> function to put it in alphabetic order.  We'll
play with <code>sort</code> a bit more in the next article.</p> <h3><a name="play around!">Play around!</a></h3> <p>As usual, here are some sample exercises:</p> <p>1.  A rule of good writing is ``avoid the passive voice.''
Instead of <em>The report was read by Carl</em>, 
say <em>Carl read the report</em>.  Write a program that reads a file of sentences
(one per line), detects and eliminates the passive voice, and prints
the result.  (Don't worry about irregular verbs or capitalization, though.)</p> <p><a href="/pub/2000/11/a3-activate.pl">Sample solution</a>.  
<a href="/pub/2000/11/a3-sentences.txt">Sample test sentences</a>.</p>  <p>2.  You have a list of phone numbers.  The list is messy, and the only
thing you know is that there are either seven or 10 digits in each number
(the area code is optional), and if there's an extension, it will show up
after an ``x'' somewhere on the line.  ``416 555-1212,'' ``5551300X40'' and
``(306) 555.5000 ext 40'' are all possible.  Write a <code>fix_phone()</code> sub that
will turn all of these numbers into the standard format ``(123) 555-1234'' or
``(123) 555-1234 Ext 100,'' if there is an extension.  Assume that the
default area code is ``123.''</p> <p><a href="/pub/2000/11/a3-phone.pl">Sample solution</a>.</p>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1756" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/11/p5pdigest/THISWEEK-20001114.html" rel="bookmark">This Week on p5p 2000/11/14</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2000-11-14T00:00:00-08:00">November 14, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- This week on perl5-porters (08-14 Nov 2000) -->

<br />
<br />      </P>
<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#stat_vs_lstat">stat vs. lstat</a>
  <li><a href="#Threads_and_POSIX">Threads and POSIX</a>
  <li><a href="#PerlIO">PerlIO</a>
  <li><a href="#READMESolaris">README.Solaris</a>
  <li><a href="#Locales">Locales</a>
  <li><a href="#Integer_handling_revisited">Integer handling revisited</a>
  <li><a href="#head3">=head3</a>
  <li><a href="#Little_fixes">Little fixes</a>
  <li><a href="#Various">Various</a>
</ul>

<P>

<H3><a name="Notes">Notes</a></H3>

</P>

<P>
You can subscribe to an e-mail version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
simon@brecon.co.uk
</P>

<P>
There were 348 messages this week.  
</P>

<P>
Dominus mentioned this during his tenure, but now it's my turn: these
reports are only made possible due to the generosity of O'Reilly and
Associates, who keep me in caffeine.
<H3><a name="stat_vs_lstat">stat vs. lstat</a></H3>

</P>

<P>

David Dyck was using 
<CODE>find2perl</CODE> and turned up a couple of problems with 
<CODE>lstat</CODE>. The problem is that 
<CODE>lstat _</CODE> produces a warning because it thinks that
<CODE>_</CODE> is a filehandle, and you can't 
<CODE>lstat</CODE> a filehandle. (Only a filename)
</P>

<P>
David produced a patch to take care of this, but then discovered that 
<CODE>lstat</CODE> and the  
<CODE>-l</CODE> filetest were acting differently; you shouldn't be allowed to follow
<CODE>stat('something')</CODE> with 
<CODE>lstat _</CODE>. Again, David produced another patch to cause a fatal error if you try.
</P>

<P>
He also noticed that  
<CODE>-l FH</CODE> dies, whereas 
<CODE>lstat FH</CODE> doesn't, but nobody has looked into that yet.
</P>

<P>
Also in the &quot;file tests&quot; area, Rich Morin quoted the camel book:
<blockquote></P>

<P>
   &quot;Because Perl has to read a file to do the -T test, you don't want
   to use -T on special files that might hang or give you other kinds
   of grief.&quot;
</blockquote></P>

<P>
and commented that maybe Perl should test to see whether someone is planning
to do a 
<CODE>-T</CODE> or a 
<CODE>-B</CODE> test on a special file, and &quot;keep itself out of trouble&quot;.
</P>

<P>
Kurt Starsinic pointed out that there were times when you do want to
test, for example, a named pipe, and Perl shouldn't restrict the programmer from
doing so. Nick said it'll all be OK when we have PerlIO working.
</P>

<P>

<H3><a name="Threads_and_POSIX">Threads and POSIX</a></H3>

</P>

<P>
Kurt was indulging in bug archaeology and turned up something spooky
relating to signals and threads. He asked for an explanation of how
the signal model changes between nonthreaded and threaded Perl, which
Dan Sugalski 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00356.html">duly provided</a>. The rest of that thread (ho, ho) is worth reading, if you're interested
in how threads work with Perl.
<H3><a name="PerlIO">PerlIO</a></H3>

</P>

<P>

As usual, there's a lot of good work going on with PerlIO, and quite a
lot of the bulk of this week's traffic was taken up with PerlIO-related
test results, bug reports and discussion.
</P>

<P>
To remind you, PerlIO is going to be a complete IO library for Perl,
which, among other things, allows us to insert filters at various
stages of the input and output process. This means that, for instance,
data can be transparently converted to UTF8 from other character sets.
</P>

<P>
Nick mentioned that he'd like to test PerlIO a lot, so it
would be appreciated if those following the Perl development sources
could do something like the following:
<pre></P>

</P><PRE>
    ./Configure -Duseperlio -d
    make
    ...
    PERLIO=stdio  make test
    PERLIO=perlio make test
    PERLIO=mmap   make test
</pre></PRE>

<P>
and report results. (
<CODE>mmap</CODE> may not be available, depending on platform.) Dominic Dunlop fixed the
MachTen hints to stop it for claiming to support  
<CODE>mmap</CODE>, since any attempt to use the function just causes the program to abort
due to an error.
</P>

<P>
Robin Barker found that PerlIO-over-
<CODE>stdio</CODE> breaks large file support; Nick found that this was a problem with 64-bit support and that Perl was using 
<CODE>fseek</CODE> where it should have been using 
<CODE>fseeko</CODE>.
</P>

<P>
Nicholas Clark did some work on 
<CODE>IO::Handle</CODE> and some other IO calls, and found that the return values weren't particularly
intuitive; Perl was reporting the raw return values from  
<CODE>stdio</CODE> rather than true or false. This becomes problematic, of course,
when the IO model isn't 
<CODE>stdio</CODE>. He produced some fixes for 
<CODE>ungetc</CODE> and 
<CODE>getpos</CODE>, and he also noted that if we're using
<CODE>sfio</CODE> then we shouldn't treat 
<CODE>sftell</CODE> as if it were 
<CODE>ftell</CODE>, as there's yet another return value inconsistency.
</P>

<P>

Nicholas also came up with a 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00604.html">"dumb shell" </a>to allow a shell with a
per-process current directory on systems that don't have one, which
should make dealing with subdirectories during building easier, and
might also help with cross-compiling Perl.
</P>

<P>
Nick Ing-Simmons also asked 
<blockquote></P>

<P>
Now that PerlIO is in the mainline I _really_ need to know
what to do next in terms of making it useful.
</P>

<P>
This means knowing what it &quot;should&quot; look like to perl5
</blockquote></P>

<P>
There followed a useful discussion of the proposed API; 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00390.html">Read about it.</a></P>

<P>
It was also determined that one should open a file containing Latin data
as follows:
</P>

<P>
[ XL indementum tum biguttam tum latin-1 inquementum tum LatinFile inquementum evolute meo fho morive errorum. ]
</P>

<P>
and that Perl programs dealing with data in Japanese are implicity
permitted to seppuku.
<H3><a name="READMESolaris">README.Solaris</a></H3>

</P>

<P>

Andy Dougherty produced a README.Solaris, which Jarkko, Russ, Alan and
many others looked over and improved; later on, he produced a final
version to be integrated, along with some other Solaris fixes. This was
applied to the tree, and then some people picked over it a little more.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00559.html">Read about it.</a></P>

<P>

<H3><a name="Locales">Locales</a></H3>

</P>

<P>
Jarkko's old nemesis was out in force this week. Robin Barker and
Larry Virden found that the UTF8 locales didn't work properly - this was
not really a surprise, since Jarkko had disabled the tests as they
require the fabled polymorphic regular expression support. (This means
that  
<CODE>/(.)/</CODE> should be equally happy capturing a UTF8 character as a non-UTF8
character.) Lupe Christoph found that most of the tests work OK, as
there's only two that require polymorphic regexes. Jarkko grudgingly
re-enabled them - locales are Not His Friend.
</P>

<P>
Vadim Konovalov produced a little fix to make the locale tests work, and
added a test for the MS-DOS Russian code page; seems like Perl is now
happy to speak Russian even on MS-DOS systems.
<H3><a name="Integer_handling_revisited">Integer handling revisited</a></H3>

</P>

<P>

If you remember a month ago, there was a discussion on 
<a href="/pub/2000/10/p5pdigest/THISWEEK-20001008.html#Integer_and_floating_point_handling">integer and floating point handling</a>, in which it was suggested that adding two integers together at
run-time should result in an integer, rather than a floating point.
</P>

<P>
Jarkko and Nicholas Clark have been looking into this, and Jarkko
produced a patch; it looked to me like the complexity of determining
whether it's possible to sum two integers without overflowing is going
to cause a slowdown, and Perl usually trades space for speed.
</P>

<P>
However, Nicholas mentioned that on the StrongARM architecture, floating
points are all emulated, and thus keeping everything integer might
actually speed it up.
<H3><a name="head3">=head3</a></H3>

</P>

<P>

Casey Tweten produced a patch that allowed 
<CODE>Pod::Man</CODE> to deal with 
<CODE>=head3</CODE> and above. Russ Allbery disapproved, on the grounds that the 
<CODE>man</CODE> translator should not be singled out - if we're going to do this, we
should change the documentation for POD, and all the other translators.
Andy pointed out that it's OK to update the translators one at a time,
since it's not really reasonable to blitz through them all in one go.
However, 
<CODE>perlpod.pod</CODE> should be updated. (Nobody's done this yet.)
</P>

<P>
Tim Jenness pointed out that the LaTeX translator already deals with  
<CODE>=head3</CODE> and 
<CODE>=head4</CODE>.
<H3><a name="Little_fixes">Little fixes</a></H3>

</P>

<P>

Since last week, I concentrated on things that nobody fixed, this time
we'll have a whirlwind tour of things that people did get fixed.
</P>

<P>
The 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00271.html">VMS and Cygwin flock fix</a> we mentioned last week were implemented, thanks to Craig Berry and
Andy Dougherty. 
</P>

<P>
Eric Fifer brought the Cygwin port up to date with Cygwin 1.1.5. (Great
work as ever, Eric!) 
</P>

<P>
Harold Morris, one of the Amdahl UTS people produced some patches to
help Perl run under UTS; Lupe Christoph had some of the regular
expression-test suite explain why it was failing if it did. Lots of
people fixed up documentation, so I won't mention them all. Casey Tweten
did some good work, including adding an 
<CODE>import</CODE> method to 
<CODE>Class::Struct</CODE>. Nicholas Clark fixed some FreeBSD 
<CODE>stdio</CODE> declarations. Robin Barker picked up some dodgy casts between pointers
and integers.
<H3><a name="Various">Various</a></H3>

</P>

<P>

As usual, plenty of small bug reports, patches, irrelevant questions,
the complete absence of flames, and only one spam.
</P>

<P>
Until next week I remain, your humble and obedient servant,
</P>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Cozens</a>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1750" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/11/repair3.html" rel="bookmark">Program Repair Shop and Red Flags</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="2000-11-14T00:00:00-08:00">November 14, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- Program Repair Shop and Red Flags: Parsing Info Files -->

<br />
<br /><a name="__index__"></a>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#what's wrong with this picture">What's wrong with this picture?</a></li>
	<li><a href="#the interface">The Interface</a></li>
	<li><a href="#the code">The Code</a></li>
	<ul>

		<li><a href="#open_info_file"><code>open_info_file</code></a></li>
		<li><a href="#start_info_file"><code>start_info_file</code></a></li>
		<li><a href="#start_next_part"><code>start_next_part</code></a></li>
		<li><a href="#read_next_node"><code>read_next_node</code></a></li>
		<li><a href="#looking for the menu">Looking for the menu</a></li>
	</ul>

	<li><a href="#putting it all together">Putting It All Together</a></li>
	<li><a href="#red flags">Red Flags</a></li>
	<ul>

		<li><a href="#don't repeat code">Don't Repeat Code</a></li>
		<li><a href="#eof()"><code>eof()</code></a></li>
		<li><a href="#return 0 and return undef"><code>return 0</code> and <code>return undef</code></a></li>
	</ul>

	<li><a href="#brief confession">Brief Confession</a></li>
</ul>
<!-- INDEX END -->

<hr>
<p>
<h3><a name="what's wrong with this picture">What's wrong with this picture?</a></h3>
<p>Once again I'm going to have a look at a program written by a Perl
beginner and see what I can do to improve it.</p>
<p>This month's program comes from a very old Usenet post.  It was posted
seven years ago - on Nov. 12, 1993, to be exact - on the
<code>comp.lang.perl</code> newsgroup.  (At that time <code>comp.lang.perl.misc</code> had
not yet been created.)</p>
<p>The program is a library of code for reading GNU ``info'' files.
Info files are a form of structured documentation used by the GNU
project.  If you use the emacs editor, you can browse info files by
using the <code>C-h i</code> command, for example.  An info file is made up of
many <em>nodes</em>, each containing information about a certain
topic.  The nodes are arranged in a tree structure.  Each node has a
header with some meta-information; one item recorded in the header of
each node is the name of that node's parent in the documentation tree.
Most nodes also have a menu of their child nodes.  Each node also has
pointers to the following and preceding nodes so that you can read
through all the nodes in order.</p>
<p>
<hr>
<h3><a name="the interface">The Interface</a></h3>
<p>The code we'll see has functions for opening info files and for reading
in nodes and parsing the information in their headers and menus.  
But before I start discussing the code, I'll show the documentation.
Here it is, copied directly from that 7-year-old Usenet posting,
typos and all:</p>
<pre>
    To use the functions:  Call



            &amp;open_info_file(INFO_FILENAME);


    to open the filehandle `INFO' to the named info file.
    Then call


            &amp;get_next_node;


    repeatedly to read the next node in the info file; variables
            $info_file
            $info_node
            $info_prev
            $info_next
            $info_up


    are set if the corresponding fields appear in the node's
    header, and if the node has a menu, it is loaded into
    %info_menu.  When `get_next-node' returns false, you have
    reached end-of-file or there has been an error.</pre>
<p>Right away, we can see a major problem.  The code is supposed to be a
library of utility functions.  But the only communication between the
library and the main program is through a series of global variables
with names like <code>$info_up</code>.  This, of course, is terrible
style.  The functions cannot be used in any program that happens to
have a variable named <code>$info_up</code>, and if you do use it in such a
program, you can introduce bizarre, hard-to-find bugs that result from
the way the library smashes whatever value that variable had before.
The library might even interfere with itself!  If you had something
like this:</p>
<pre>
        &amp;get_next_node;
        foo();
        print $info_node;</pre>
<p>then you might not get the results you expect.  If <code>foo()</code> happens to
<em>also</em> call <code>get_next_node</code>, it will discard the value of
<code>$info_node</code> that the main code was planning to print.</p>
<p>These are the types of problems that functions and local
variables were intended to solve.   In this case, it's easy to solve
the problems:  Just have <code>get_next_node</code> return a list of the node
information, instead of setting a bunch of hardwired global variables.
If the caller of the function wants to set the variables itself, it is
still free to do that:</p>
<pre>
        %next_node = &amp;get_next_node;
        ($info_file, $info_node, $info_prev, $info_next, $info_up)
            = @next_node{qw(File Node Prev Next Up)};
        %info_menu = %{$next_node{Menu}}
</pre>
<p>Or not:</p>
<pre>
        my (%node) = &amp;get_next_node;
        my ($next) = $node{Next};
</pre>
<p>If for some reason the caller of <code>get_next_node</code> <em>likes</em> the global
variables, they can still have the original interface:</p>
<pre>
        sub get_next_node_orig {
          my %next_node = &amp;get_next_node;
          ($info_file, $info_node, $info_prev, $info_next, $info_up)
              = @next_node{qw(File Node Prev Next Up)};
          %info_menu = %{$next_node{Menu}}
        }</pre>
<p>This shows that no functionality has been lost; it is just as powerful
to return a list of values as it is to set the global variables
directly.</p>
<p>
<hr>
<h3><a name="the code">The Code</a></h3>
<p>Now we'll see the code itself.  
<a href="/2000/11/info.pl">The entire program is available here</a>.
We will be looking at one part at a time.</p>
<p>
<h4><a name="open_info_file"><code>open_info_file</code></a></h4>
<p>The first function that the
user calls is the <code>open_info_file</code> function:</p>
<pre>
    83  sub open_info_file {
    84      ($info_filename) = @_;
    85      (open(INFO, &quot;$info_filename&quot;)) 
	      || die &quot;Couldn't open $info_filename: $!&quot;;
    86      return &amp;start_info_file;
    87  }</pre>
<p>Before I discuss the design problems here, there's a minor syntactic
issue: The quotation marks around <code>&quot;$info_filename&quot;</code> are useless.
Perl uses the <code>&quot;...&quot;</code> notation to say ``Construct a string.''  But
<code>$info_filename</code> is <em>already</em> a string, so making it into a string
is at best a waste of time.  Moreover, the extra quotation marks can
sometimes cause subtle bugs.  Consider this innocuous-looking code:</p>
<pre>
        my ($x) = @_;
        do_something(&quot;$x&quot;);</pre>
<p>If <code>$x</code> was a string, this still works.  But if <code>$x</code> was a
<em>reference</em>, it probably fails.  Why?  Because <code>&quot;$x&quot;</code> constructs a
string that looks like a reference but isn't, and if <code>do_something</code>
is expecting a reference, it will be disappointed.  Such errors can be
hard to debug, because the string that <code>do_something</code> gets looks 
like a reference when you print it out.  The <code>use strict 'refs'</code>
pragma was designed to catch exactly this error.  With <code>use strict
'refs'</code> in scope, <code>do_something</code> will probably raise an error like</p>
<pre>
    Can't use string (&quot;SCALAR(0x8149bbc)&quot;) as an ARRAY ref...
</pre>
<p>Without <code>use strict 'refs'</code>, you get a subtle and silent bug.</p>
<p>But back to the code.  <code>open_info_file</code> calls <code>die</code> if it can't open
the specified file for any reason.  It would probably be more
convenient and consistent to have it simply return a failure code in
this case; this is what it does if the <code>open</code> succeeds, but then
<code>start_next_part</code> fails.  It's usually easier for the calling code to
deal with a simple error return than with an exception, all the more
so in 1993, when Perl didn't have exception handling.  I would rewrite
the function like this:</p>
<pre>
        sub open_info_file {
            ($info_filename) = @_;
            open(INFO, $info_filename) || return;
            return start_info_file();
        }</pre>
<p>I also got rid of some superfluous parentheses and changed the 1993
<code>&amp;function</code> syntax to a more modern <code>function()</code> syntax.
It's tempting to try to make <code>$info_filename</code> into a private
variable, but it turns out that other functions need to see it later,
so the best we can do is make it a file-scoped lexical, private to the
library, but shared among all the functions in the library.</p>
<p>Finally, a design issue:  The filehandle name <code>INFO</code> is hard-wired
into the function.  Since filehandle names are global variables, this
is best avoided for the same reason that we wanted to get rid of the
<code>$info_node</code> variable earlier:  If some other part of the program
happens to have a filehandle named <code>INFO</code>, it's going to be very
surprised to find it suddenly attached to a new file.</p>
<p>There are a number of ways to solve this.  The best one available in
Perl 4 is to have the caller pass in the filehandle it wants to use,
as an argument to <code>open_info_file</code>.  Then the call is effectively
using the filehandle as an object.  In this case, however, this
doesn't work as well as we'd like, because, as we'll see later, the
library needs to be able to associate the name of the file with the
filehandle.  In the original library, this was easy, because the
filename was always stored in the global variable <code>$info_filename</code>
and the filehandle was always <code>INFO</code>.  The downside of this simple
solution is the library couldn't have two info files open at
once.  There are solutions to this in Perl 4, but they're only of
interest to Perl 4 programmers, so I won't go into detail.</p>
<p>The solution in Perl 5 is to use an <em>object</em> to represent an open
info file.  Whenever the caller wants to operate on the file, it
passes the object into the library as an argument.  The object can
carry around the open filehandle and the filename.  Since the data
inside the object is private, it doesn't interfere with any other data
in the program.  The caller can have several files open at once, and
distinguish between them because each file is represented by its own
object.</p>
<p>To make this library into an object-oriented class only requires a few
small changes.  We add</p>
<pre>
        package Info_File;</pre>
<p>at the top, and rewrite <code>open_info_file</code> like this:</p>
<pre>
    sub open_info_file {
        my ($class, $info_filename) = @_;
        my $fh = new FileHandle;        
        open($fh, $info_filename) || return;
        my $object = { FH =&gt; $fh, NAME =&gt; $info_filename };
        bless $object =&gt; $class;
        return unless $object-&gt;start_info_file;            
        return $object;
    }
</pre>
<p>We now invoke the function like this:</p>
<pre>
     $object = Info_File-&gt;new('camel.info');</pre>
<p>The <code>new FileHandle</code> line constructs a fresh new filehandle.  The
next line opens the filehandle, as usual.  The line</p>
<pre>
     my $object = { FH =&gt; $fh, NAME =&gt; $info_filename };</pre>
<p>constructs the object, which is simply a hash.  The object contains
all the information that the library will need to use in order to deal
with the info file - in this case, the open filehandle and the
original filename.  The <code>bless</code> function converts the hash into a
full-fledged object of the <code>Info_File</code> class.  Finally, the</p>
<pre>
        $object-&gt;start_info_file;</pre>
<p>invokes the <code>start_info_file</code> function with <code>$object</code> as its
argument, just like calling <code>start_info_file($object)</code>.  The special
``arrow'' syntax for objects is enabled by the <code>bless</code> on the previous
line.  This notation indicates a <em>method call</em> on the object;
<code>start_info_file</code> is the <em>method</em>.  A method is just an ordinary
subroutine.  A method call on an object is like any other subroutine
call, except that the object itself is passed as an argument to the
subroutine.</p>
<p>That was a lot of space to spend on one three-line function, but many
of the same issues are going to pop up over and over, and it's good to
see them in a simple context.</p>
<p>
<h3><a name="start_info_file"><code>start_info_file</code></a></h3>
<pre>

    47  # Discard commentary before first node of info file
    48  sub start_info_file {
    49      $_ = &lt;INFO&gt; until (/^\037/ || eof(INFO));
    50      return &amp;start_next_part if (eof(INFO)) ;
    51      return 1;
    52  }</pre>
<p>An info file typically has a preamble before the first node, usually
containing a copyright notice and a license.  When the user opens an
info file, the library needs to skip this preamble to get to the
nodes, which are the parts of interest.  That is what
<code>start_info_file</code> does.  The preamble is separated from the first
node by a line that begins with the obscure <code>\037</code> character, which
is control-underscore.  The function will read through the file line
by line, looking for the first line that begins with the obscure
character.  If it finds such a line, it immediately returns success.  
Otherwise, it moves on to the next ``part,'' which I'll explain later.</p>
<p>As I explained in earlier articles, a ``red flag'' is an immediate
warning sign that you have done something wrong.  Use of the <code>eof()</code>
function is one of the clearest and brightest red flags in Perl.  It
is almost always a mistake to use <code>eof()</code>.</p>
<p>The problem with <code>eof()</code> is that it tries to see into the future,
whether the <em>next</em> read from the filehandle will return an
end-of-file condition.  It's impossible to actually see the future, so
what it really does is try to read some data.  If there isn't any, it
reports that the next read will also report end-of-file.  If not, it
has to put back the data that it just read.  This can cause weird
problems, because <code>eof()</code> is reading extra data that you might not
have meant to read.</p>
<p><code>eof()</code> is one of those functions like <code>goto</code> that looks useful at
first, but then it turns out that there is almost always a better way
to accomplish the same thing.  In this case, the code is more
straightforward and idiomatic like this:</p>
<pre>
    sub start_info_file {
        while (&lt;INFO&gt;) {
          return 1  if /^\037/;
        }
        &amp;start_next_part;
    }</pre>
<p>Perl will automatically exit the <code>while</code> loop when it reaches the end
of the file, and in that case we can unconditionally call
<code>start_next_part</code>.  Inside the loop, we examine the current line to
see whether it is the separator, and return success if it is.  The
assignment to <code>$_</code> and the check for end-of-file are now all
implicit.</p>
<p>In the object-oriented style, <code>start_info_file</code> expects to get an
object, originally constructed by <code>open_info_file</code>, as its argument.
This object will contain the filehandle that the function will read
from in place of <code>INFO</code>.  The rewriting into OO style is
straightforward:</p>
<pre>
    sub start_info_file {
        my ($object) = @_;
        my $fh = $object-&gt;{FH};
        while (&lt;$fh&gt;) {
          return 1 if /^\037/;
        }
        $object-&gt;start_next_part;
    }</pre>
<p>Here we extract the filehandle from the object by asking for
<code>$object-&gt;{$fh}</code>, and then use the filehandle <code>$fh</code> in place of
<code>INFO</code>.  The call to <code>start_next_part</code> changes into a method call on
the object, which means that the object is implicitly passed to the
<code>start_next_part</code> function so that <code>start_next_part</code> <em>also</em> has
access to the object, including the filehandle buried inside it.</p>
<p>
<h3><a name="start_next_part"><code>start_next_part</code></a></h3>
<p>I promised to explain what <code>start_next_part</code> does, and now we're
there.  An info file is not a single file; it might be split into
several separate files, each containing some of the nodes.  If the
main info file is named <code>camel.info</code>, there might be additional
nodes in the files <code>camel.info-1</code>, <code>camel.info-2</code> and so on.  This
means that when we get to the end of an info file we are not finished;
we have to check to see whether it continues in a different file.
<code>start_next_part</code> does this.</p>
<pre>
    54  # Look for next part of multi-part info file.  Return 0
    55  # (normal failure) if it isn't there---that just means
    56  # we ran out of parts.  die on some other kind of failure.
    57  sub start_next_part {
    58      local($path, $basename, $ext);
    59      if ($info_filename =~ /\//) {
    60          ($path, $basename) 
		    = ( $info_filename =~ /^(.*)\/(.*)$/ );
    61      } else {
    62          $basename = $info_filename;
    63          $path = &quot;&quot;;
    64      }
    65      if ($basename =~ /-\d*$/) {
    66          ($basename, $ext) 
		    = ($basename =~ /^([^-]*)-(\d*)$/);
    67      } else {
    68          $ext = 0;
    69      }
    70      $ext++;
    71      $info_filename = &quot;$path/$basename-$ext&quot;;
    72      close(INFO);
    73      if (! (open(INFO, &quot;$info_filename&quot;)) ) {
    74          if ($! eq &quot;No such file or directory&quot;) {
    75              return 0;
    76          } else {
    77              die &quot;Couldn't open $info_filename: $!&quot;;
    78          }
    79      }
    80      return &amp;start_info_file;
    81  }</pre>
<p>The main point of this code is to take a filename like
<code>/usr/info/camel.info-3</code> and change it into
<code>/usr/info/camel.info-4</code>.  It has to handle a special case:
<code>/usr/info/camel.info</code> must become <code>/usr/info/camel.info-1</code>.  After
computing the new filename, it tries to open the next part of the info
file.  If successful, it calls <code>start_info_file</code> to skip the preamble
in the new part.</p>
<p>The first thing to notice here is that the function is performing more work than it needs to.  It carefully separates the filename into
a directory name and a base name, typically <code>/usr/info</code> and
<code>camel.info-3</code>.  But this step is unnecessary, so let's
eliminate it.</p>
<pre>
    sub start_next_part {
        local($name, $ext);
        if ($info_filename =~ /-\d*$/) {
            ($name, $ext) 
                = ($info_filename =~ /^([^-]*)-(\d*)$/);
        } else {
            $ext = 0;
        }
        $ext++;
        $info_filename = &quot;$name-$ext&quot;;
        # ... no more changes ...
    }</pre>
<p>This immediately reduces the size of the function by 25 percent.
Now we notice that the two pattern matches that remain are almost the
same.  This is the red flag of all red flags:  Any time a program
does something twice, look to see whether you can get away with doing it
only once.  Sometimes you can't.  This time, we can:
</p>
<pre>
    sub start_next_part {
        local($name, $ext);
        if ($info_filename =~ /^([^-]*)-(\d*)$/) {
            ($name, $ext) = ($1, $2);
        } else {
            $name = $info_filename; $ext = 0;
        }
        $ext++;
        $info_filename = &quot;$name-$ext&quot;;
        # ... no more changes ...
    }</pre>
<p>This is somewhat simpler, and it paves the way for a big improvement:
The <code>$name</code> variable is superfluous, because its only purpose is to
hold an intermediate result.  The real variable of interest is
<code>$info_filename</code>.  <code>$name</code> is what I call a <em>synthetic variable</em>:
It's an artifact of the way we solve the problem, and is inessential
to the problem itself.   In this case, it's easy to eliminate:</p>
<pre>
    sub start_next_part {
        if ($info_filename =~ /^([^-]*)-(\d*)$/) {
            $info_filename = $1 . '-' . ($2 + 1);
        } else {
            $info_filename .= '-1';
        }
        # ... no more changes ...
    }</pre>
<p>If the pattern matches, then <code>$1</code> contains the base name, typically
<code>/usr/info/camel.info</code>, and <code>$2</code> contains the numeric suffix,
typically <code>3</code>.  There is no need to copy these into named variables
before using them; we can construct the new filename,
<code>/usr/info/camel.info-4</code> directly from <code>$1</code> and <code>$2</code>.  If the
pattern doesn't match, we construct the new file name by appending
<code>-1</code> to the old file name; this turns <code>/usr/info/camel.info</code> into
<code>/usr/info/camel.info-1</code>.</p>
<p>That takes care of the top half of the function; now let's look at the
bottom half:</p>
<pre>
    sub start_next_part {
        if ($info_filename =~ /^([^-]*)-(\d*)$/) {
            $info_filename = $1 . '-' . ($2 + 1);
        } else {
            $info_filename .= '-1';
        }
        close(INFO);
        if (! (open(INFO, &quot;$info_filename&quot;)) ) {
            if ($! eq &quot;No such file or directory&quot;) {
                return 0;
            } else {
                die &quot;Couldn't open $info_filename: $!&quot;;
            }
        }
        return &amp;start_info_file;
    }</pre>
<p>The <code>close(INFO)</code> is unnecessary, because the <code>open</code> on the
following line will perform an implicit close.  If the file can't be
opened the function looks to find out why.  If the reason is that the next
part doesn't exist, then we're really at the end, and it quietly
returns failure, but if there was some other sort of error, it
aborts.  In keeping with our change to <code>open_info_file</code>, we will
eliminate the <code>die</code> and let the caller die itself, if that is desirable:</p>
<pre>
    sub start_next_part {
        if ($info_filename =~ /^([^-]*)-(\d*)$/) {
            $info_filename = $1 . '-' . ($2 + 1);
        } else {
            $info_filename .= '-1';
        }
        return unless open(INFO, $info_filename);
        return &amp;start_info_file;
    }</pre>
<p>I made a few other minor changes here: Superfluous quotation marks
around <code>$info_filename</code> are gone, and <code>if !</code> has turned into
<code>unless</code>.  Also, I replaced <code>return 0</code> with <code>return</code>.  <code>return 0</code>
and <code>return undef</code> are red flags: They are attempts to make a
function that returns a false value.  But if the function is invoked
in a list context, return values of <code>0</code> and <code>undef</code> are interpreted
as true, not false, because they are one-element lists, and the only
false lists are empty ones:</p>
<pre>
    sub false {
      return 0;
    }

    @a = false();
    if (@a) {          
      print &quot;ooops!\n&quot;;
    }</pre>
<p>The correct way for a function to return a boolean false value in Perl
is almost always a simple <code>return</code> as we have here.  In scalar
context, this returns an undefined value; in list context, it returns
an empty list.</p>
<p>The function has gone from 20 lines to 7.   Refitting it for
object-oriented style does not make it much bigger:</p>
<pre>
    sub start_next_part {
        my ($object) = @_;
        my $info_filename = $object-&gt;{NAME};
        if ($info_filename =~ /^([^-]*)-(\d*)$/) {
            $info_filename = $1 . '-' . ($2 + 1);
        } else {
            $info_filename .= '-1';
        }
        my $fh = $object-&gt;{FH};
        return unless open($fh, $info_filename);
        $object-&gt;{NAME} = $info_filename;         # ***
        return $object-&gt;start_info_file;
    }</pre>
<p>Here we extract the info file's filename from the object using
<code>$object-&gt;{NAME}</code>, which we originally set up back in
<code>open_info_file</code>.  We also extract the filehandle from the object
using <code>$object-&gt;{FH}</code> as we did in <code>start_info_file</code>.  If we
successfully open the new file, we store the changed filename back
into the object, for next time; this occurs on the line marked <code>***</code>.</p>
<p>
<h3><a name="read_next_node"><code>read_next_node</code></a></h3>
<p>Finally, we get to the heart of the library.  <code>read_next_node</code>
actually reads a nodeful of information and returns it to the caller.
(The first thing to notice is that the documentation calls this
function <code>get_next_node</code>, which is wrong.  But that's an easy fix.)</p>
<p>As far as this function is concerned, the node has three parts.  The
first line is the header of the node, which contains the name of the
node; pointers to the previous and next nodes; and other
metainformation.  Then there's a long stretch of text, which is the
documentation that the node was intended to contain.  Somewhere near
the bottom of the text is a menu of pointers to other nodes.  
<code>read_next_node</code> is interested in the header line and the menu.  It
has three sections:  One section to handle the header line, one
section to skip the following text until it sees the menu and one
section to parse the menu.  We'll deal with these one at a time.</p>
<pre>
     1  # Read next node into global variables.  Assumes that file 
     2  # pointer is positioned at the header line that starts a 
     3  # node.  Leaves file pointer positioned at header line of 
     4  # next node. Programmer: note that nodes are separated by 
     5  # a &quot;\n\037\n&quot; sequence.  Reutrn true on 
	  success, false on failure
     6  sub read_next_node {
     7      undef %info_menu;
     8      $_ = &lt;INFO&gt;;                # Header line
     9      if (eof(INFO)) {
    10          return &amp;start_next_part &amp;&amp; &amp;read_next_node;
    11      }
    12  
    13      ($info_file) = /File:\s*([^,]*)/;
    14      ($info_node) = /Node:\s*([^,]*)/;
    15      ($info_prev) = /Prev:\s*([^,]*)/;
    16      ($info_next) = /Next:\s*([^,]*)/;
    17      ($info_up)   = /Up:\s*([^,]*)/;</pre>
<p>Not much needs to change here.  The <code>undef %info_menu</code> was an
appropriate initialization when <code>%info_menu</code> was a global variable,
but our function isn't going to use global variables; it's going to
return the menu information as part of its return list, so we replace
this line with <code>my %info_menu</code>.  The <code>eof()</code> test is a red flag
again; it's probably more straightforward to simply check whether <code>$_</code> is
defined.  If it's undefined, then the function has reached the
end of the file, and needs to try to open the next part.  If that
succeeds, then it calls itself recursively to read the first node from
the new part.  The <code>&amp;&amp;</code> used here to sequence those two operations is
concise, if a little peculiar.  Unfortunately, it won't work any more
now that <code>read_next_node</code> returns a list of data, because <code>&amp;&amp;</code>
always evaluates its arguments in scalar context.  This section of the
code needs to change to:</p>
<pre>
        $_ = &lt;INFO&gt;;                # Header line
        if (! defined $_) {
            return unless  &amp;start_next_part;      
            return &amp;read_next_node;
        }</pre>
<p>The recursive call might be considered a little strange, because it's
essentially performing a <code>goto</code> back up to the top of the function,
and some people might express that with a simple <code>while</code> loop.  But
it's not really obvious that that would be clearer, so I decided to
leave the recursive call in.</p>
<p>The subsequent lines extract parts of the header into the global
variables <code>$info_file</code>, <code>$info_node</code> and so on.   Since we need to
make these items into a data structure to be returned from the function, 
rather than a set of global variables, it's natural to try this:</p>
<pre>
        ($header{File}) = /File:\s*([^,]*)/;
        ($header{Node}) = /Node:\s*([^,]*)/;
        ($header{Prev}) = /Prev:\s*([^,]*)/;
        ($header{Next}) = /Next:\s*([^,]*)/;
        ($header{Up})   =   /Up:\s*([^,]*)/;
</pre>
This works, but as I mentioned before, repeated code is the biggest
red flag of all.   The similarity of these five lines  suggests that we
should try a loop instead:</p>
<pre>
        for my $label (qw(File Node Prev Next Up)) {
          ($header{$label}) = /$label:\s*([^,]*)/;
        }</pre>
<p>Here five lines have become two.  The downside, however, is that Perl has to recompile the pattern five
times for each node, because the value of <code>$label</code> keeps changing.
There are three things we can do to deal with this.  We can ignore it,
we can apply the <code>qr//</code> operator to precompile the patterns, or we
can try to make the five variable patterns into a single constant
pattern.  My vote here, as for most questions of micro-optimization,
is to ignore it unless it proves to be a real problem.
The <code>qr//</code> solution will be an adequate fallback in that case.</p>
<p>I did also consider combining them into one pattern, but that turns 
into a disaster:</p>
<pre>
    ($file, $node, $prev, $next, $up) = 
      /File:\s*([^,]*),\s*Node:\s*([^,]*),\s*
       Next:\s*([^,]*),\s*Prev:\s*([^,]*),\s*
       Up:\s*([^,]*)/x;</pre>
<p>Actually, it's worse than that, because some of the five items might be
missing from the header line, so we must make each part optional:</p>
<pre>
    ($file, $node, $prev, $next, $up) = 
      /(?:File:\s*([^,]*),)?\s*(?:Node:\s*([^,]*),)?\s*
       (?:Next:\s*([^,]*),)?\s*(?:Prev:\s*([^,]*),)?\s*
       (?:Up:\s*([^,]*))?/x;</pre>
<p>Actually, it's even worse, because the original author was programming
in Perl 4 and didn't have <code>(?:...)</code> or <code>/x</code>.  So that tactic really
didn't work out.</p>
<p>This brings up an important point that I don't always emphasize as
much as I should: It's not always obvious what tactics are best until
you have tried them.  When I write these articles, I make false
starts.  I rewrite the code one way, and discover that there are
unexpected problems and the gains aren't as big as I thought they
were.  Then, I try another way and see if it looks better.  Sometimes
it turns out I was wrong, and the original code wins, as it did in
this case.</p>
<p>When you're writing your own code, it won't always be clear how best
to proceed.  Try it both ways and see which looks better, then throw
away the one you don't like as much.</p>
<p>In this article, I had originally planned to rework the library into
something that would still have functioned under Perl 4.  I wrote a
lot of text explaining how to do this.  But it turned out that the only good solution was objects, so I did it over, and that's
what you see.</p>
<p>The moral:  Never be afraid to do it over.</p>

<h3><a name="looking for the menu">Looking for the menu</a></h3>
<p>OK, end of digression.  The function has processed the header line;
now it needs to skip the intervening text until it finds the menu part
of the node:</p>
<pre>
    19      $_ = &lt;INFO&gt; until /^(\* Menu:|\037)/ || eof(INFO);
    20      if (eof(INFO)) {
    21          return &amp;start_next_part;
    22      } elsif (/^\037/) { 
    23          return 1; # end of node, so return success.
    24      }</pre>
<p>The menu follows a line labeled <code>* Menu:</code>.  If the function sees
the end of the node or the end of the file before it sees <code>* Menu</code>,
then the node has no menu.  There's a bug here:  The function should
return immediately at the end of the node, regardless of whether it is
also the end of the file.  As originally written, it calls
<code>start_next_part</code> at the end of the file, which might fail (if the
current node was the last one) and reports the failure back to the
caller when it should have reported success.  Fixing the bug and
eliminating <code>eof()</code> yields this:</p>
<pre>
    $_ = &lt;INFO&gt; until !defined($_) || /^(\* Menu:|\037)/;
    return @header if !defined($_) || /^\037/;</pre>
<p>The repeated tests bothered me there, but the best alternative
formulation I could come up with was:</p>
<pre>
    while (&lt;INFO&gt;) {
      last if /^\* Menu:/;
      return %header if /^\037/;
    }
    return %header unless defined $_;</pre>
<p>I asked around, and Simon Cozens suggested</p>
<pre>
    do { 
      $_ = &lt;INFO&gt;; 
      return %header if /^\037/ || ! defined $_ 
    } until /^\* Menu:/ ;</pre>
<p>I think I like this best, because it makes the <code>/^\* Menu:/</code> into the
main termination condition, which is as it should be.  On the other
hand, <code>do...until</code> is unusual, and you don't get the implicit
read into <code>$_</code>.  But four versions of the same code is plenty, so
let's move on.</p>
<p>Finally our function is ready to read the menu.  A typical menu looks
like this:</p>
<pre>
        * Menu:

        * Numerical types::
        * Exactness::
        * Implementation restrictions::
        * Syntax of numerical constants::
        * Numerical operations::
        * Numerical input and output::</pre>
<p>Each item has a title (which is displayed to the user) and a node name
(which is the node that the user visits next if they select that menu
item).  If the title and node name are different, the menu item looks
like this:</p>
<pre>
        * The title:       The node name.</pre>
<p>If they're the same (as is often the case) the menu item ends in <code>::</code>
as in the examples above.  The menu-reading code has to handle both
cases:</p>
<pre>
    27      local($key, $ref);
    28      while (&lt;INFO&gt;) {    
    29          return 1 if /^\037/;    # end of node, success.
    30          next unless /^\* \S/;   # skip non-menu-items
    31          if (/^\* ([^:]*)::/) {  # menu item ends with ::
    32              $key = $ref = $1;
    33          } elsif (/^\* ([^:]*):\s*([^.]*)[.]/) {
    34              ($key, $ref) = ($1, $2);
    35          } else {
    36              print STDERR &quot;Couldn't parse menu item\n\t$_&quot;;
    37              next;
    38          }
    39          $info_menu{$key} = $ref;
    40      }</pre>
<p>I think this code is lovely.  I would do only two things differently.
First, I would change the error message to include the filename and
line number of the malformed menu entry.  Perl's built-in <code>$.</code>
variable makes this easy, and the current behavior makes it too
difficult for the programmer to locate the source of the problem.  And
second, instead of <code>return</code>ing directly out of the loop, I would
use <code>last</code>, because the return value <code>(%header, Menu
=&gt; \%menu)</code> is rather
complicated and the code below the loop will have to return the same
thing anyway.</p>
<p>In the original prgram, that <code>return</code> line calls <code>start_info_file</code>
again if the function reads to the end of the current part while still
reading the menu.  This isn't correct; it should simply return
success and let the next call to <code>read_next_node</code> worry about
opening the new part.</p>
<p>The rewritten version of <code>read_next_node</code> looks like this:</p>
<pre>
    sub read_next_node {
        $_ = &lt;INFO&gt;;                # Header line
        if (! defined $_) {
            return unless  &amp;start_next_part;      
            return &amp;read_next_node;
        }

        my (%header, %menu);
        for my $label (qw(File Node Prev Next Up)) {
          ($header{$label}) = /$label:\s*([^,]*)/;
        }

        do { 
          $_ = &lt;INFO&gt;; 
          return %header if /^\037/ || ! defined $_ 
        } until /^\* Menu:/ ;



        while (&lt;INFO&gt;) {    
            my ($key, $ref);
            last if /^\037/;        # end of node
            next unless /^\* \S/;   # skip non-menu-items
            if (/^\* ([^:]*)::/) {  # menu item ends with ::
                $key = $ref = $1;
            } elsif (/^\* ([^:]*):\s*([^.]*)[.]/) {
                ($key, $ref) = ($1, $2);
            } else {
                warn &quot;Couldn't parse menu item at line $. 
                      of file $info_file_name&quot;;
                next;
            }
            $menu{$key} = $ref;
        }

        return (%header, Menu =&gt; \%menu);
    }</pre>
<p>The code didn't get shorter this time, but that's because it was
pretty good to begin with.  After making a few straightforward changes
to convert it to object-oriented style, we get:</p>
<pre>
    sub read_next_node {
        my ($object) = @_;
        my ($fh) = $object-&gt;{FH};
        local $_ = &lt;$fh&gt;;           # Header line
        if (! defined $_) {
            return unless  $object-&gt;start_next_part;      
            return $object-&gt;read_next_node;
        }

        my (%header, %menu);
        for my $label (qw(File Node Prev Next Up)) {
          ($header{$label}) = /$label:\s*([^,]*)/;
        }

        do { 
          $_ = &lt;$fh&gt;; 
          return %header if /^\037/ || ! defined $_ 
        } until /^\* Menu:/ ;

        while (&lt;$fh&gt;) {    
            my ($key, $ref);
            last if /^\037/;        # end of node
            next unless /^\* \S/;   # skip non-menu-items
            if (/^\* ([^:]*)::/) {  # menu item ends with ::
                $key = $ref = $1;
            } elsif (/^\* ([^:]*):\s*([^.]*)[.]/) {
                ($key, $ref) = ($1, $2);
            } else {
                warn &quot;Couldn't parse menu item at line $. 
                      of file $object-&gt;{NAME}&quot;;
                next;
            }
            $menu{$key} = $ref;
        }

        return (%header, Menu =&gt; \%menu);
    }
</pre>
<p><a href="/2000/11/Info_File.pm">The entire object-oriented module is
        available here</a>.
<p>
A simple example program that demonstrates the use of the library:

<pre>
    use Info_File;
    my $file = shift;
    my $info = Info_File-&gt;open_info_file($file)
      or die "Couldn't open $file: $!; aborting";
    while (my %node = $info-&gt;read_next_node) {
      print $node{Node},"\n";  # print the node name
    }
</pre>
<p>
<hr>
<h3><a name="putting it all together">Putting It All Together</a></h3>
<p>This time the code hasn't gotten any smaller; it's the same
size as it was before.  Some parts got smaller, but there was some
overhead associated with the conversion to object-oriented style that
made the code bigger again.</p>
<p>But the OO style got us several big wins.  The interface got better;
the library no longer communicates through global variables and no
longer smashes <code>INFO</code>.  It also gained the capability to process
two or more info files simultaneously, or the same info file more than
once, which is essential if it's to be useful in any large project.
Flexibility has increased also: It would require only a few extra
lines to provide the ability to search for any node or to seek back to
a node by name.</p>
<p>
<hr>
<h3><a name="red flags">Red Flags</a></h3>
<p>A summary of the red flags we saw this time:</p>
<p>
<!-- <a name="don't repeat code">Don't Repeat Code</a> -->
<p>The Cardinal Rule of Computer Programming is that if you wrote the
same code twice, you probably did something wrong.  At the very least,
you may be setting yourself up for a maintenance problem later on when
someone changes the code in one place and not in another.</p>
<p>Programming languages are chock-full of features designed to prevent
code duplication from the very lowest levels (features such as <code>$a[3]
+= $b</code> instead of <code>$a[3] = $a[3] + $b</code> to the very highest (features
such as DLLs and pipes.)  In between these levels are essential
features such as subroutines and modules.</p>
<p>Each time you see you have written the same code more than once, give
serious thought to how you might eliminate all but one instance.</p>
<p>
<h4><a name="eof()"><code>eof()</code></a></h4>
<p>The Perl <code>eof()</code> function is almost always a bad choice.  It's
typically overused by beginners and by people who have been
programming in Pascal for too long.</p>
<p>Perl returns an unambiguous end-of-file condition by yielding an
undefined value.  Perl's I/O operators are designed to make it
convenient to check for this.  The <code>while(&lt;FH&gt;)</code> construction
even does so automatically.  Explicit checking of <code>eof()</code> is almost
never required or desirable.</p>
<p>
<h4><a name="return 0 and return undef"><code>return 0</code> and <code>return undef</code></a></h4>
<p>This is often an attempt to return a value that will be perceived by
the caller as a Boolean false.  But in list context, it will test as
true, not false.  Unless the function <em>always</em> returns a single
scalar, even in list context, it is usually a better choice to use
plain <code>return;</code> to yield a false value.</p>
<p>Some programmers write <code>wantarray() ? () : undef</code>, which does the
same thing but is more verbose and confusing.</p>
<p>
<hr>
<h3><a name="brief confession">Brief Confession</a></h3>
<p>The program discussed in this article was indeed written by a Perl
beginner.  I wrote it in 1993 when I had only been programming in Perl
for a few months.  I must have been pleased with it, because it was
the first Perl program that I posted in a public forum.</p>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1754" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/11/p5pdigest/THISWEEK-20001107.html" rel="bookmark">This Week on p5p 2000/11/07</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2000-11-07T00:00:00-08:00">November  7, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            </P>

<P>




<!-- This week on perl5-porters (31 Oct - 07 Nov 2000) -->

<br />
<br /><ul>  <li><a href="#Notes">Notes</a>
  <li><a href="#Error_number_parsing">Error number parsing</a>
  <li><a href="#VMS_hackery">VMS hackery</a>
  <li><a href="#The_fcrypt_of_mystery">The (f)crypt of mystery</a>
  <li><a href="#Yet_more_self_ties">Yet more self-ties</a>
  <li><a href="#Rsync_vs_FTPing_the_patches">Rsync vs. FTP'ing the patches</a>
  <li><a href="#Changes_to_READMEaix">Changes to README.aix</a>
  <li><a href="#The_Regex_Stack_Problem">The Regex Stack Problem </a>
  <li><a href="#Things_nobodys_fixed">Things nobody's fixed</a>
  <li><a href="#Craig_Berry">Craig Berry</a>
  <li><a href="#Various">Various</a>
</ul>

      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>simon@brecon.co.uk</CODE></P>

<P>
Apologies for the slightly late appearance of this report; I aim to get
them out every Monday, but I'm hoping you were all so distracted by the
US election that you didn't notice yet. This week was pretty heavy,
reaching either 300 or 550 messages depending on whether you count
unique mails or duplicates. However, there wasn't much in the way of  
<B>hugely</B>  interesting content.
<H3><a name="Error_number_parsing">Error number parsing</a></H3>

</P>

<P>

An innocent-looking patch to 
<CODE>t/lib/io_multihomed.t</CODE> managed to turn up some problems with 
<CODE>Errno.pm</CODE>. (Good work Casey Tweten for finally tracking that down, after what
looked like a rather agonizing debugging session...)
</P>

<P>
If you didn't know, the 
<CODE>Errno</CODE> module is automatically generated by reading the system's 
<CODE>errno.h</CODE> file when Perl is being built. However, it looks like some people's
systems and libc implementations use macros that are too difficult for
Perl to parse automatically, and this meant that some error constants (you
know, like 
<CODE>EINPROGRESS</CODE> and
<CODE>ETOOSTUPID</CODE> and so on.) were not getting picked up. (Tom Hughes noticed this on
RedHat 7.0 as well.) The solution is to use the 
<CODE>-dM</CODE> flag to gcc; there's not much we can do for non-gcc right now.
<H3><a name="VMS_hackery">VMS hackery</a></H3>

</P>

<P>

There was a lot of work on VMS this week: firstly, in the area of file
locking. Peter Prymmer reported that 
<CODE>t/lib/st-lock.t</CODE> failed since VMS doesn't really have locking. Peter Farley piped up and
said that this was also the case on DOS and DJGPP, and the work-around
there was to null-op the locking tests. Andy Dougherty mentioned that
a permanent fix would be to define a 
<CODE>d_fcntl_can_lock</CODE> Configure variable to determine whether or not 
<CODE>fcntl</CODE> is any use. Craig Berry had suggested this idea before; Andy provided
 the patch.
</P>

<P>
Peter also noticed that one of Jarkko's patches had broken the 
<CODE>POSIX</CODE> module; there were also some problems with erronous output confusing
the test harnesses, so that the tests were passing but were still
reporting failures.
</P>

<P>
After all that, Perl on VMS now passes all tests, and there was much
rejoicing!
<H3><a name="The_fcrypt_of_mystery">The (f)crypt of mystery</a></H3>

</P>

<P>

Richard Proctor is trying to compile Perl on RiscOS (and take over the
RiscOS pumpkin) however is having problems in that 
<CODE>fcrypt</CODE> isn't prototyped on that system. He tried to force the issue with a
couple of casts, but Jarkko wasn't impressed; the Right Way to do it is
to have a separate 
<CODE>riscos/</CODE> directory and put the platform-specific things in there. Nicholas Clark
remarked that the 
[fcrypt] support was &quot;weird&quot;:
<blockquote></P>

<P>
There are 4 references to FCRYPT
but nothing anywhere (even in a port subdirectory) defines the macro.
The macro isn't of the usual HAS_ or I_ forms.
Does anyone know where it originates?
</blockquote></P>

<P>
Nobody did, which is... well, weird. However, we found out where
Riscos's 
<CODE>UnixLib</CODE> got its
<CODE>fcrypt</CODE> implementation from. 
</P>

<P>
Andy Dougherty suggested that the other right way to do it would be to
define (and test for) a configure symbol 
<CODE>d_fcrypt_proto</CODE> which then turns into 
<CODE>HAS_FCRYPT_PROTO</CODE>.
</P>

<P>
No patches were forthcoming.
<H3><a name="Yet_more_self_ties">Yet more self-ties</a></H3>

</P>

<P>

Randy Ray has a module (
<CODE>Perl-RPM</CODE>) which uses a self-tie; he found that the reference count of a
self-tied object is two, where you'd expect it to be one. Alan replied
that self-ties are badly broken (hey, don't we know it...) and Jarkko
announced that we could really do with someone who's prepared to tackle
this issue and get it sorted out. Randy promised to try and have a look.
</P>

<P>
Steffen Bayer suggested that you could just manually set the reference
count back to one, which struck Alan as somewhat sick. Steffen
responded:
<blockquote></P>

<P>

IMO, this is a matter of opinion. :-)
</P>

<P>
There's nothing fundamentally evil about setting the refcount to a lower
value, because this just triggers the DESTROY() event sooner than it
would normally.
</blockquote></P>

<P>
But Nick noted that you can't ensure that you're not going to create any
more references to the object during DESTROYing, so this really is
fundamentally evil after all.
<H3><a name="Rsync_vs_FTPing_the_patches">Rsync vs. FTP'ing the patches</a></H3>

</P>

<P>

Merijn Brand complained of a discrepancy between the patch archive
(That's  
<TT>rsync://ftp.linux.activestate.com/perl-current-diffs/</TT> or
<a href="ftp://ftp.linux.activestate.com/pub/staff/gsar/APC/perl-current-diffs">ftp://ftp.linux.activestate.com/pub/staff/gsar/APC/perl-current-diffs</a>) and the latest source tree. (
<TT>rsync://ftp.linux.activestate.com/perl-current/</TT> or 
<a href="ftp://ftp.linux.activestate.com/pub/staff/gsar/APC/perl-current">ftp://ftp.linux.activestate.com/pub/staff/gsar/APC/perl-current</a>.)
</P>

<P>
Sarathy explained that
<blockquote></P>

<P>
The rsync mirror is automatic and syncs with the repository every five
minutes.
</P>

<P>
Updating the patch area still requires manual intervention (with all
the goofiness that implies, which you've noted) and is typically on
a daily cycle.  Making this process automatic is on my tuit list,
but don't ask me when.
</blockquote></P>

<P>
The thread went a little off topic into the mechanics of setting up a
rsync server, but lead to  
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00073.html">a contribution to perlhack </a> from Merijn explaining how to keep in sync with the Perl source.
<H3><a name="Changes_to_READMEaix">Changes to README.aix</a></H3>

</P>

<P>

We've recently been telling AIX users that they need to upgrade their
compilers in order to compile Perl, so Merijn send in a patch to
README.aix to tell them how to do so.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00152.html">Read about it.</a></P>

<P>

Jarkko also decided it was time we had a README.Solaris; volunteers are
being sought.
<H3><a name="The_Regex_Stack_Problem">The Regex Stack Problem </a></H3>

</P>

<P>

Sam Smith found a regular expression which will crash the engine with a
segfault - further investigation showed it was the engine recursing too
deeply and exceeding the maximum stack depth. Dominic Dunlop explained
that it was difficult to fix this one, as writing stack checking code
portably is quite a challenge, and fixing the root of the problem -
changing the regex engine from recursion to iteration - is
somewhat Herculean.
</P>

<P>
Dominic further explained that he had a stack checking patch but it
depended on the system having the BSD resource limit functions 
<CODE>getrlimit</CODE> and 
<CODE>setrlimit</CODE>. He also couldn't find a nice way of making this all play sensibly with
threads. At the time, Ilya had countered that the problem should really
be fixed by rewriting the engine to be iterative; Dominic had tried
this, but it was very tricky and slowed the whole thing down by about
30% - this was due to the extra memory allocation of the structures that
needed to be copied between levels. Jarkko came up with a few ideas,
most promising being the use of a custom stack. 
</P>

<P>
The work-around is to increase the process's stack size using 
<CODE>ulimit</CODE>; it was suggested that perl should be able to use 
<CODE>setrlimit</CODE> to extend its own stack size when necessary. This was frowned upon by
Jarkko - limits are imposed for a reason.
</P>

<P>
Anyone who's got infinite patience and sanity may want to consider
hacking at removing the recursion, but so far Dominic and Hugo look like
the only people patient and sane enough.
<H3><a name="Things_nobodys_fixed">Things nobody's fixed</a></H3>

</P>

<P>

A few bug reports nobody's investigated yet, for those of you with a
spare minute:
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00043.html">xsubpp truncates files</a></P>

<P>
,
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00060.html">the AUTOLOAD behaviour changed in 5.6</a>, and
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00221.html">UTF |= is broken</a>. 
</P>

<P>
Enjoy!
<H3><a name="Craig_Berry">Craig Berry</a></H3>

</P>

<P>

Craig Berry deserves a special mention for his huge contribution to p5p
this week - we saw nearly three hundred messages from him. However, on
closer examination, 284 of them turned out to be the same, thanks to a
malicious copy of CC Mail belonging to somewhere completely
different.  (It wasn't Craig's fault at all.)
<H3><a name="Various">Various</a></H3>

</P>

<P>

I leave you with a veritable smorgasbord of misdirected queries, test
reports, FAQs, off-topic posts, and people spamming the list about how
much spam there was on the list, and until next week I remain, your
humble and obedient servant,
</P>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Cozens</a>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1740" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/11/begperl2.html" rel="bookmark">Beginner's Introduction to Perl - Part 2</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Doug Sheppard</span> on <abbr class="published" title="2000-11-07T00:00:00-08:00">November  7, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- The other two Rs -->

<p><em>Editor's note: this venerable series is undergoing updates.  You might be interested in the newer versions, available at:</em></p>

<ul>
<li><a href="/pub/2008/04/23/a-beginners-introduction-to-perl-510.html">A Beginner's Introduction to Perl 5.10</a>
<li><a href="/pub/2008/05/07/beginners-introduction-to-perl-510-part-2.html">A
Beginner's Introduction to Files and Strings with Perl 5.10</a>
<li><a href="http://news.oreilly.com/2008/06/a-beginners-introduction-to-pe.html">A
Beginner's Introduction to Regular Expressions with Perl 5.10</a></li>
<li><a href="http://broadcast.oreilly.com/2008/09/a-beginners-introduction-to-pe.html">A Beginner's Introduction to Perl Web Programming</a></li>

</ul>

<br />
<br /><p><table width="180" cellspacing="0" cellpadding="4" align="right" border="1">
<tr>
<td align="center" valign="top" bgcolor="#6699cc">
<font color="#ffffff">Table of Contents</td>
</tr>

<tr>
<td>
<p class="fine">
&#149;<b><a href="/pub/2000/10/begperl1.html">Part 1 of
this series</a></b><br />
&#149;<b><a href="/pub/2000/11/begperl3.html">Part 3 of this series</a></b><br />
&#149;<b><a href="/pub/2000/12/begperl4.html">Part 4 of this series</a></b><br />
&#149;<b><a href="/pub/2000/12/begperl5.html">Part 5 of this series</a></b><br />
&#149;<b><a href="/pub/a/2001/01/begperl6.html">Part 6 of this series</a></b><br /><br />

&#149;<a href="#comparison operators">Comparison operators</a><br />
&#149;<a href="#while and until"><code>while</code> and <code>until</code></a><br />
&#149;<a href="#string comparisons">String comparisons</a><br />
&#149;<a href="#more fun with strings">More fun with strings</a><br />
&#149;<a href="#filehandles">Filehandles</a><br />
&#149;<a href="#writing files">Writing files</a><br />
&#149;<a href="#live free or die!">Live free or die!</a><br />
&#149;<a href="#subs">Subs</a><br />
&#149;<a href="#putting it all together">Putting it all together</a><br />
&#149;<a href="#play around!">Play around!</a><br />
           
</td>
</tr>
</p>
</table>

<p>In our last article, we talked about the core elements of Perl:
variables (scalars, arrays, and hashes), math operators and some
basic flow control (the <code>for</code> statement).  Now it's time to interact
with the world.</p>
<p>In this installment, we're going to discuss how to slice and dice strings,
how to play with files and how to define your own functions.  But first,
we'll discuss one more core concept of the Perl language: conditions
and comparisons.</p>
<p>
<h3><a name="comparison operators">Comparison operators</a></h3>
<p>There's one important element of Perl that we skipped in the last
article: <em>comparison operators</em>.  Like all good programming languages, Perl
allows you ask questions such as ``Is this number greater than that number?''
or ``Are these two strings the same?'' and do different things depending
on the answer.</p>
<p>When you're dealing with numbers, Perl has four important operators:
<code>&lt;</code>, <code>&gt;</code>, <code>==</code> and <code>!=</code>.  These are the ``less than,'' ``greater
than,'' ``equal to'' and ``not equal to'' operators.  (You can also use <code>&lt;=</code>,
``less than or equal to,'' and <code>&gt;=</code>, ``greater than or equal to.)</p>
<p>You can use these operators along with one of Perl's <em>conditional</em> keywords,
such as <code>if</code> and <code>unless</code>.  Both of these keywords take a condition that Perl
will test, and a block of code in curly brackets that Perl will run if the
test works.  These two words work just like their English equivalents - an
<code>if</code> test succeeds if the condition turns out to be true, and an <code>unless</code>
test succeeds if the condition turns out to be false:</p>
<pre>
    if ($year_according_to_computer == 1900) {
        print &quot;Y2K has doomed us all!  Everyone to the compound.\n&quot;;
    }

    unless ($bank_account &gt; 0) {
        print &quot;I'm broke!\n&quot;;
    }</pre>
<p>Be careful of the difference between <code>=</code> and <code>==</code>!  One equals sign means
``assignment'', two means ``comparison for equality''.  This is a common,
evil bug:</p>
<pre>
    if ($a = 5) {
        print &quot;This works - but doesn't do what you want!\n&quot;;
    }</pre>
<p>Instead of testing whether <code>$a</code> is equal to five, you've made <code>$a</code> equal
to five and clobbered its old value.  (In a later article, we'll discuss a
way to make sure this bug won't occur in running code.)</p>
<p>Both <code>if</code> and <code>unless</code> can be followed by an <code>else</code> statement and
code block, which executes if your test failed.  You can also use <code>elsif</code>
to chain together a bunch of <code>if</code> statements:</p>
<pre>
    if ($a == 5) {
        print &quot;It's five!\n&quot;;
    } elsif ($a == 6) {
        print &quot;It's six!\n&quot;;
    } else {
        print &quot;It's something else.\n&quot;;
    }

    unless ($pie eq 'apple') {
        print &quot;Ew, I don't like $pie flavored pie.\n&quot;;
    } else {
        print &quot;Apple!  My favorite!\n&quot;;
    }</pre>
<p>
<h3><a name="while and until"><code>while</code> and <code>until</code></a></h3>
<p>Two slightly more complex keywords are <code>while</code> and <code>until</code>.
They both take a condition and a block of code, just like <code>if</code> and <code>unless</code>,
but they act like loops similar to <code>for</code>.  Perl tests the condition, runs the
block of code and runs it over and over again for as long as the condition
is true (for a <code>while</code> loop) or false (for a <code>until</code> loop).</p>
<p>Take a look at the following code and try to guess what it
will do before reading further:</p>
<pre>
   $a = 0;

   while ($a != 3) {
       $a++;
       print &quot;Counting up to $a...\n&quot;;
   }

   until ($a == 0) {
       $a--;
       print &quot;Counting down to $a...\n&quot;;
   }</pre>
<p>Here's what you see when you run this program:</p>
<pre>
    Counting up to 1...
    Counting up to 2...
    Counting up to 3...
    Counting down to 2...
    Counting down to 1...
    Counting down to 0...</pre>
<p>
<h3><a name="string comparisons">String comparisons</a></h3>
<p>So that's how you compare numbers.  Now, what about strings?  The most
common string comparison operator is <code>eq</code>, which tests for <em>string
equality</em> - that is, whether two strings have the same value.</p>
<p>Remember the pain that is caused when you mix up <code>=</code> and <code>==</code>?  Well,
you can also mix up <code>==</code> and <code>eq</code>.  This is one of the few cases where
it <em>does</em> matter whether Perl is treating a value as a string or a number.
Try this code:</p>
<pre>
    $yes_no = &quot;no&quot;;
    if ($yes_no == &quot;yes&quot;) {
        print &quot;You said yes!\n&quot;;
    }</pre>
<p>Why does this code think you said yes?  Remember that Perl automatically
converts strings to numbers whenever it's necessary; the <code>==</code> operator
implies that you're using numbers, so Perl converts the value of <code>$yes_no</code>
(``no'') to the number 0, and ``yes'' to the number 0 as well.  Since this
equality test works (0 is equal to 0), the <code>if</code> block gets run.  Change
the condition to <code>$yes_no eq &quot;yes&quot;</code>, and it'll do what it should.</p>
<p>Things can work the other way, too.  The number five is <em>numerically</em>
equal to the string <code>&quot; 5 &quot;</code>, so comparing them to <code>==</code> works.  But when
you compare five and <code>&quot; 5 &quot;</code> with <code>eq</code>, Perl will convert the number to
the string <code>&quot;5&quot;</code> first, and then ask whether the two strings have the same value.
Since they don't, the <code>eq</code> comparison fails.  This code fragment will
print <code>Numeric equality!</code>, but not <code>String equality!</code>:</p>
<pre>
    $a = 5;
    if ($a == &quot; 5 &quot;) { print &quot;Numeric equality!\n&quot;; }
    if ($a eq &quot; 5 &quot;) { print &quot;String equality!\n&quot;; }</pre>
<p>
<h3><a name="more fun with strings">More fun with strings</a></h3>
<p>You'll often want to manipulate strings: Break them into smaller pieces,
put them together and change their contents.  Perl offers
three functions that make string manipulation easy and fun:  <code>substr()</code>,
<code>split()</code> and <code>join()</code>.</p>
<p>If you want to retrieve part of a string (say, the first four
characters or a 10-character chunk from the middle), use the
<code>substr()</code> function.  It takes either two or three parameters: the
string you want to look at, the character position to start at (the
first character is position 0) and the number of
characters to retrieve.  If you leave out the number of characters,
you'll retrieve everything up to the end of the string.</p>
<pre>
    $a = &quot;Welcome to Perl!\n&quot;;
    print substr($a, 0, 7);     # &quot;Welcome&quot;
    print substr($a, 7);        # &quot; to Perl!\n&quot;</pre>
<p>A neat and often-overlooked thing about <code>substr()</code> is that you can use
a <em>negative</em> character position.  This will retrieve a substring
that begins with many characters from the <em>end</em> of the string.</p>
<pre>
     $a = &quot;Welcome to Perl!\n&quot;;
     print substr($a, -6, 4);      # &quot;Perl&quot;</pre>
<p>(Remember that inside double quotes, <code>\n</code> represents the single new-line
character.)</p>
<p>You can also manipulate the string by using <code>substr()</code> to assign a
new value to part of it.  One useful trick is using a length of zero to
<em>insert</em> characters into a string:</p>
<pre>
    $a = &quot;Welcome to Java!\n&quot;;
    substr($a, 11, 4) = &quot;Perl&quot;;   # $a is now &quot;Welcome to Perl!\n&quot;;
    substr($a, 7, 3) = &quot;&quot;;        #       ... &quot;Welcome Perl!\n&quot;;
    substr($a, 0, 0) = &quot;Hello. &quot;; #       ... &quot;Hello. Welcome Perl!\n&quot;;</pre>
<p>Next, let's look at <code>split()</code>.  This function breaks apart a
string and returns a list of the pieces.  <code>split()</code> generally
takes two parameters: a <em>regular expression</em> to split the string
with and the string you want to split.  (We'll discuss regular
expressions in more detail in the next article; for the moment, we're
only going to use a space.  Note the special syntax for a regular
expression: <code>/ /</code>.)  The characters you split won't show up in
any of the list elements.</p>
<pre>
    $a = &quot;Hello. Welcome Perl!\n&quot;;
    @a = split(/ /, $a);   # Three items: &quot;Hello.&quot;, &quot;Welcome&quot;, &quot;Perl!\n&quot;</pre>
<p>You can also specify a third parameter: the maximum number of items to
put in your list.  The splitting will stop as soon as your list
contains that many items:</p>
<pre>
    $a = &quot;Hello. Welcome Perl!\n&quot;;
    @a = split(/ /, $a, 2);   # Two items: &quot;Hello.&quot;, &quot;Welcome Perl!\n&quot;;</pre>
<p>Of course, what you can split, you can also <code>join()</code>.  The <code>join()</code>
function takes a list of strings and attaches them together with a
specified string between each element, which may be an empty string:</p>
<pre>
    @a = (&quot;Hello.&quot;, &quot;Welcome&quot;, &quot;Perl!\n&quot;);
    $a = join(' ', @a);       # &quot;Hello. Welcome Perl!\n&quot;;
    $b = join(' and ', @a);   # &quot;Hello. and Welcome and Perl!\n&quot;;
    $c = join('', @a);        # &quot;Hello.WelcomePerl!\n&quot;;</pre>
<p>
<h3><a name="filehandles">Filehandles</a></h3>
<p>Enough about strings.  Let's look at files - after all, what good is
string manipulation if you can't do it where it counts?</p>
<p>To read from or write to a file, you have to <em>open</em> it.  When you
open a file, Perl asks the operating system if the file can be accessed -
does the file exist if you're trying to read it (or can it be created
if you're trying to create a new file), and do you have the necessary
file permissions to do what you want?  If you're allowed to use the file,
the operating system will prepare it for you, and Perl will give you
a <em>filehandle</em>.</p>
<p>You ask Perl to create a filehandle for you by using the <code>open()</code> function,
which takes two arguments: the filehandle you want to create and the file
you want to work with.  First, we'll concentrate on reading files.  The
following statement opens the file <code>log.txt</code> using the filehandle <code>LOGFILE</code>:</p>
<pre>
    open (LOGFILE, &quot;log.txt&quot;);</pre>
<p>Opening a file involves several behind-the-scenes tasks that Perl and
the operating system undertake together, such as checking that the file you
want to open actually exists (or creating it if you're trying to create
a new file) and making sure you're allowed to manipulate the file (do you
have the necessary file permissions, for instance).  Perl will do all
of this for you, so in general you don't need to worry about it.</p>
<p>Once you've opened a file to read, you can retrieve lines from it by
using the <code>&lt;&gt;</code> construct.  Inside the angle brackets, place
the name of your filehandle.  What is returned by this depends on what
you <em>want</em> to get: in a scalar context (a more technical way of
saying ``if you're assigning it to a scalar''), you retrieve the next
line from the file, but if you're looking for a list, you get a list of
all the remaining lines in the file.  (One common trick is to use
<code>for $lines (&lt;FH&gt;)</code> to retrieve all the lines from a file -
the <code>for</code> means you're asking a list.)</p>
<p>You can, of course, <code>close</code> a filehandle that you've opened.  You don't
always have to do this, because Perl is clever enough to close a filehandle
when your program ends or when you try to reuse an existing filehandle.
It's a good idea, though, to use the <code>close</code> statement.  Not only will
it make your code more readable, but your operating system has
built-in limits on the number of files that can be open at once, and
each open filehandle will take up valuable memory.</p>
<p>Here's a simple program that will display the contents of the file
<code>log.txt</code>, and assumes that the first line of the file is its title:</p>
<pre>
    open (LOGFILE, &quot;log.txt&quot;) or die &quot;I couldn't get at log.txt&quot;;
    # We'll discuss the &quot;or die&quot; in a moment.

    $title = &lt;LOGFILE&gt;;
    print &quot;Report Title: $title&quot;;
    for $line (&lt;LOGFILE&gt;) {
        print $line;
    }
    close LOGFILE;</pre>
<p>
<h3><a name="writing files">Writing files</a></h3>
<p>You also use <code>open()</code> when you are writing to a file.  There are two
ways to open a file for writing: <em>overwrite</em> and <em>append</em>.
When you open a file in overwrite mode, you erase whatever it
previously contained.  In append mode, you attach your new data to the
end of the existing file without erasing anything that was already
there.</p>
<p>To indicate that you want a filehandle for writing, you put a single
<code>&gt;</code> character before the filename you want to use.  This opens
the file in overwrite mode.  To open it in append mode, use two
<code>&gt;</code> characters.</p>
<pre>
     open (OVERWRITE, &quot;&gt;overwrite.txt&quot;) or die &quot;$! error trying to overwrite&quot;;
     # The original contents are gone, wave goodbye.

     open (APPEND, &quot;&gt;&gt;append.txt&quot;) or die &quot;$! error trying to append&quot;;
     # Original contents still there, we're adding to the end of the file</pre>
<p>Once our filehandle is open, we can use the humble <code>print</code> statement
to write to it.  Specify the filehandle you want to write to and a
list of values you want to write:</p>
<pre>
    print OVERWRITE &quot;This is the new content.\n&quot;;
    print APPEND &quot;We're adding to the end here.\n&quot;, &quot;And here too.\n&quot;;</pre>
<p>
<h3><a name="live free or die!">Live free or die!</a></h3>
<p>You noticed that most of our <code>open()</code> statements are followed by
<code>or die &quot;some sort of message&quot;</code>.  This is because we live in an
imperfect world, where programs don't always behave exactly the way we
want them to.  It's always possible for an <code>open()</code> call to fail;
maybe you're trying to write to a file that you're not allowed to write,
or you're trying to read from a file that doesn't exist.  In Perl, you
can guard against these problems by using <code>or</code> and <code>and</code>.</p>
<p>A series of statements separated by <code>or</code> will continue until you hit
one that works, or returns a true value.  This line of code will
either succeed at opening <code>OUTPUT</code> in overwrite mode, or cause Perl
to quit:</p>
<pre>
    open (OUTPUT, &quot;&gt;$outfile&quot;) or die &quot;Can't write to $outfile: $!&quot;;</pre>
<p>The <code>die</code> statement ends your program with an error message.  The
special variable <code>$!</code> contains Perl's explanation of the error.  In
this case, you might see something like this if you're not allowed
to write to the file.  Note that you get both the actual error message
(``Permission denied'') and the line where it happened:</p>
<pre>
    Can't write to a2-die.txt: Permission denied at ./a2-die.pl line 1.</pre>
<p>Defensive programming like this is useful for making your programs more
error-resistant - you don't want to write to a file that you haven't
successfully opened!</p>
<p>Here's an example: As part of your job, you write a program that records
its results in a file called <code>vitalreport.txt</code>.  You use the following code:</p>
<pre>
    open VITAL, &quot;&gt;vitalreport.txt&quot;;</pre>
<p>If this <code>open()</code> call fails (for instance, <code>vitalreport.txt</code> is owned
by another user who hasn't given you write permission), you'll never
know it until someone looks at the file afterward and wonders why the
vital report wasn't written.  (Just imagine the joy if that ``someone'' is
your boss, the day before your annual performance review.)  When you use
<code>or die</code>, you avoid all this:</p>
<pre>
    open VITAL, &quot;&gt;vitalreport.txt&quot; or die &quot;Can't write vital report: $!&quot;;</pre>
<p>Instead of wondering whether your program wrote your vital report,
you'll immediately have an error message that both tells you what
went wrong and on what line of your program the error occurred.</p>
<p>You can use <code>or</code> for more than just testing file operations:</p>
<pre>
    ($pie eq 'apple') or ($pie eq 'cherry') or ($pie eq 'blueberry')
        or print &quot;But I wanted apple, cherry, or blueberry!\n&quot;;</pre>
<p>In this sequence, if you have an appropriate pie, Perl skips the rest
of the chain.  Once one statement works, the rest are ignored.
The <code>and</code> operator does the opposite: It evaluates your chain of
statements, but stops when one of them <em>doesn't</em> work.</p>
<pre>
   open (LOG, &quot;log.file&quot;) and print &quot;Logfile is open!\n&quot;;</pre>
<p>This statement will only show you the words <em>Logfile is open!</em> if the
<code>open()</code> succeeds - do you see why?</p>
<p>
<h3><a name="subs">Subs</a></h3>
<p>So far, our Perl programs have been a bunch of statements in series.
This is OK if you're writing very small programs, but as your needs
grow, you'll find it's limiting.  This is why most modern programming
languages allow you to define your own functions; in Perl, we call them
<em>subs</em>.</p>
<p>A sub is defined with the <code>sub</code> keyword, and adds a new function to
your program's capabilities.  When you want to use this new function,
you call it by name.  For instance, here's a short definition of a sub
called <code>boo</code>:</p>
<pre>
    sub boo {
        print &quot;Boo!\n&quot;;
    }

    boo();   # Eek!</pre>
<p>(Older versions of Perl required that you precede the name of a sub with the
<code>&amp;</code> character when you call it.  You no longer have to do this, but if you
see code that looks like <code>&amp;boo</code> in other people's Perl, that's why.)</p>
<p>Subs are useful because they allow you to break your program into
small, reusable chunks.  If you need to analyze a string in four
different places in your program, it's much easier to write one
<code>&amp;analyze_string</code> sub and call it four times.  This way,
when you make an improvement to your string-analysis routine,
you'll only need to do it in one place, instead of four.</p>
<p>In the same way that Perl's built-in functions can take parameters and
can return values, your subs can, too.  Whenever you call a sub, any
parameters you pass to it are placed in the special array <code>@_</code>.  You
can also return a single value or a list by using the <code>return</code>
keyword.</p>
<pre>
    sub multiply {
        my (@ops) = @_;
        return $ops[0] * $ops[1];
    }

    for $i (1 .. 10) {
         print &quot;$i squared is &quot;, multiply($i, $i), &quot;\n&quot;;
    }</pre>
<p>Why did we use the <code>my</code> keyword?  That indicates that the variables
are private to that sub, so that any existing value for the <code>@ops</code> array
we're using elsewhere in our program won't get overwritten.  This
means that you'll evade a whole class of hard-to-trace bugs in your
programs.  You don't <em>have</em> to use <code>my</code>, but you also don't <em>have</em> to
avoid smashing your thumb when you're hammering nails into a board.
They're both just good ideas.</p>
<p>You can also use <code>my</code> to set up local variables in a sub without
assigning them values right away.  This can be useful for loop indexes
or temporary variables:</p>
<pre>
    sub annoy {
        my ($i, $j);
        for $i (1 .. 100) {
            $j .= &quot;Is this annoying yet?\n&quot;;
        }
        print $j;
    }</pre>
<p>If you don't expressly use the <code>return</code> statement, the sub returns
the result of the last statement.  This implicit return value can sometimes
be useful, but it does reduce your program's readability.  Remember
that you'll read your code many more times than you write it!</p>
<p>
<h3><a name="putting it all together">Putting it all together</a></h3>
<p>At the end of the first article we had a simple interest calculator.
Now let's make it a bit more interesting by writing our interest
table to a file instead of to the screen.  We'll also break our code
into subs to make it easier to read and maintain.</p>

<p><a href="/pub/2000/11/compound_interest_file.pl">[Download
this program]</a></p>

<pre>
        #!/usr/local/bin/perl -w



        # compound_interest_file.pl - the miracle of compound interest, part 2


        # First, we'll set up the variables we want to use.
        $outfile = &quot;interest.txt&quot;;  # This is the filename of our report.
        $nest_egg = 10000;          # $nest_egg is our starting amount
        $year = 2000;               # This is the starting year for our table.
        $duration = 10;             # How many years are we saving up?
        $apr = 9.5;                 # This is our annual percentage rate.


        &amp;open_report;
        &amp;print_headers;
        &amp;interest_report($nest_egg, $year, $duration, $apr);
        &amp;report_footer;


        sub open_report {
            open (REPORT, &quot;&gt;$outfile&quot;) or die &quot;Can't open report: $!&quot;;
        }


        sub print_headers {
            # Print the headers for our report.
            print REPORT &quot;Year&quot;, &quot;\t&quot;, &quot;Balance&quot;, &quot;\t&quot;, &quot;Interest&quot;, &quot;\t&quot;,
                         &quot;New balance&quot;, &quot;\n&quot;;
        }


        sub calculate_interest {
            # Given a nest egg and an APR, how much interest do we collect?
            my ($nest_egg, $apr) = @_;


            return int (($apr / 100) * $nest_egg * 100) / 100;
        }


        sub interest_report {
            # Get our parameters.  Note that these variables won't clobber the
            # global variables with the same name.
            my ($nest_egg, $year, $duration, $apr) = @_;


            # We have two local variables, so we'll use my to declare them here.
            my ($i, $line);


            # Calculate interest for each year.
            for $i (1 .. $duration) {
                $year++;
                $interest = &amp;calculate_interest($nest_egg, $apr);


                $line = join(&quot;\t&quot;, $year, $nest_egg, $interest,
                             $nest_egg + $interest) . &quot;\n&quot;;


                print REPORT $line;

                $nest_egg += $interest;
            }
        }

        sub report_footer {
            print REPORT &quot;\n Our original assumptions:\n&quot;;
            print REPORT &quot;   Nest egg: $nest_egg\n&quot;;
            print REPORT &quot;   Number of years: $duration\n&quot;;
            print REPORT &quot;   Interest rate: $apr\n&quot;;

            close REPORT;
        }

</pre>
<p>Notice how much clearer the program logic becomes when you break it down
into subs.  One nice quality of a program written as small, well-named
subs is that it almost becomes <em>self-documenting</em>.  Take a look
at these four lines from our program:</p>
<pre>
     open_report;
     print_headers;
     interest_report($nest_egg, $year, $duration, $apr);
     report_footer;
</pre>
<p>Code like this is invaluable when you come back to it six months later
and need to figure out what it does - would you rather spend your time
reading the entire program trying to figure it out or read four lines that
tell you the program 1) opens a report file, 2) prints some headers,
3) generates an interest report, and 4) prints a report footer?</p>
<p>You'll also notice we use <code>my</code> to set up local variables in the
<code>interest_report</code> and <code>calculate_interest</code> subs.  The value of
<code>$nest_egg</code> in the main program never changes.  This is useful at the
end of the report, when we output a footer containing our original
assumptions.  Since we never specified a local <code>$nest_egg</code> in
<code>report_footer</code>, we use the global value.</p>
<p>
<h3><a name="play around!">Play around!</a></h3>
<p>In this article, we've looked at files (filehandles, <code>open()</code>, <code>close()</code>,
and <code>&lt;&gt;</code>), string manipulation (<code>substr()</code>, <code>split()</code> and
<code>join()</code>) and subs.  Here's a pair of exercises - again, one simple and
one complex:</p>
<ul>
<li>
You have a file called <code>dictionary.txt</code> that contains dictionary
definitions, one per line, in the format ``word <code>space</code>
definition''.  (<a href="/2000/11/dictionary.txt">Here's a sample</a>.)
Write a program that will look up a word from the command line.
(Hints: <code>@ARGV</code> is a special array that contains your command line
arguments and you'll need to use the three-argument form of
<code>split()</code>.)  Try to enhance it so that your dictionary can also
contain words with multiple definitions in the format ``word <code>space</code>
definition:alternate definition:alternate definition, etc...''.
<p></p>
<li>
Write an analyzer for your Apache logs.  You can find a brief
description of the common log format at
<a href="http://www.w3.org/Daemon/User/Config/Logging.html">http://www.w3.org/Daemon/User/Config/Logging.html</a>.  Your analyzer
should count the total number of requests for each URL, the
total number of results for each status code and the total number of
bytes output.
<p></p></ul>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1746" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/11/jarkko.html" rel="bookmark">Hold the Sackcloth and Ashes</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Jarkko Hietaniemi</span> on <abbr class="published" title="2000-11-03T00:00:00-08:00">November  3, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- Hold the Sackcloth and Ashes -->


<br />
<br /><p>(This is a slightly edited and expanded version of the reply
 I sent to <code>perl6-meta@perl.org</code> spurred by Mark-Jason Dominus
 sending the URL to his critique on the Perl 6 RFC process.)</p>

<hr>

<p>I agree partly on Mark-Jason Dominus' critique, but not fully.
</p>

<p>He did point out several shortcomings that I agree with: we should have
exercised tighter control by requiring authors to record the opposing
opinions or pointed-out deficiencies, and in general by defining
better the roles of the workgroup chairs or moderators, and giving
those moderators the power to force changes or even drop controversial
or simply bad RFCs.
</p>

<p>But I certainly don't agree that the whole process was a fiasco.
</p>

<p>Firstly, now, for the first time in the Perl history, we opened up the
floodgates, so the speak, and had at least some sort of (admittedly
weakly) formalized protocol of submitting ideas for enhancement,
instead of the shark tank known as the perl5-porters (p5p).
</p>

<p>(On the other hand, we do need shark tanks.  If an idea wasn't solid
 enough to survive the p5p ordeal by fire, it probably wasn't solid
 enough to begin with.  In p5p you also ultimately had to have the
 code to prove your point.)
</p>

<p>Secondly, what was -- and still is -- sorely missing form the p5p
process is writing things down.  The first round of the Perl 6 RFCs
certainly weren't shining examples of how RFCs should be written,
but at least they were written down.  Unless an idea is written down,
it is close to impossible to discuss it in any serious terms in the
email medium.  Also, often writing down an idea is a very good way
to organize your thoughts better, possibly even leading into seeing
why the idea wouldn't work anyway.
</p>

<p>Thirdly, to continue on the theme of the first point, now we have a
record of the kind of things people want, seven years after Perl 5
came out.  Not necessarily a representative list, not perhaps a
well thought-out list, but a list.  The ideas are quite often
suggested in a much too detailed way, or they are trying to shoehorn new
un-Perlish ways into Perl, suggesting things that clearly do not
belong to a language core, breaking backward compatibility, and other
evil things.  But now we have an idea of the kind of things (both
language-wise and application/data-wise) people want to do in Perl and
with Perl, or don't like about Perl.
</p>

<p>Based on that feedback Larry can design Perl 6 to be more flexible,
to accommodate as many as possible of those requests in some way.
Not all of them, and most of them will probably be implemented in some
more Perlish way than suggested, and I guess often in some much more
lower level way than the RFC submitter thought it should be done.
After all, Perl is a general-purpose programming language, not a
language designed for some specific application task, nor is Perl
a language with theoretical axes to grind, as Larry points out in
his <a href="http://dev.perl.org/~ask/als/">Atlanta Linux Showcase talk</a>.
</p>

<p>Without the RFC process we wouldn't have had that feedback.
</p>

<p>I vehemently disagree with the quip that we would have been better off
by everybody just sending Larry their suggestions.  Now we did have a
process: it was public, it was announced, it began, we had rules, we
had discussions, it had a definite deadline.
</p>

<p>The state of the IMPLEMENTATION sections is not a cause for great
concern.  At this stage of Perl 6 where no code exists any deep
implementation details would be pointless.  For many relatively
small RFC ideas that would cause only surface changes to the language
"trivial" is a perfectly good implementation description.
</p>

<p>We certainly expected (I certainly expected) RFCs of deeper technical
level and detail, with more implementation plans or details, or with
more background research on existing practices in other languages or
application areas.  But obviously our expectations were wrong, and we
will have to work with what we got.
</p>

<p>On the whole I think the process was a success.  Of course it, like
everything, could have been conducted better, with tighter rein, but
we do have a good start into Perl 6 as a result.
</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2000/10/">&laquo; October 2000</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2000/12/">December 2000 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
