</P>

<P>




<!-- This week on perl5-porters (31 Oct -- 07 Nov 2000) -->

<br />
<!::field::date::><br /><ul>  <li><a href="#Notes">Notes</a>
  <li><a href="#Error_number_parsing">Error number parsing</a>
  <li><a href="#VMS_hackery">VMS hackery</a>
  <li><a href="#The_fcrypt_of_mystery">The (f)crypt of mystery</a>
  <li><a href="#Yet_more_self_ties">Yet more self-ties</a>
  <li><a href="#Rsync_vs_FTPing_the_patches">Rsync vs. FTP'ing the patches</a>
  <li><a href="#Changes_to_READMEaix">Changes to README.aix</a>
  <li><a href="#The_Regex_Stack_Problem">The Regex Stack Problem </a>
  <li><a href="#Things_nobodys_fixed">Things nobody's fixed</a>
  <li><a href="#Craig_Berry">Craig Berry</a>
  <li><a href="#Various">Various</a>
</ul>

      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>simon@brecon.co.uk</CODE></P>

<P>
Apologies for the slightly late appearance of this report; I aim to get
them out every Monday, but I'm hoping you were all so distracted by the
US election that you didn't notice yet. This week was pretty heavy,
reaching either 300 or 550 messages depending on whether you count
unique mails or duplicates. However, there wasn't much in the way of  
<B>hugely</B>  interesting content.
<H3><a name="Error_number_parsing">Error number parsing</a></H3>

</P>

<P>

An innocent-looking patch to 
<CODE>t/lib/io_multihomed.t</CODE> managed to turn up some problems with 
<CODE>Errno.pm</CODE>. (Good work Casey Tweten for finally tracking that down, after what
looked like a rather agonizing debugging session...)
</P>

<P>
If you didn't know, the 
<CODE>Errno</CODE> module is automatically generated by reading the system's 
<CODE>errno.h</CODE> file when Perl is being built. However, it looks like some people's
systems and libc implementations use macros that are too difficult for
Perl to parse automatically, and this meant that some error constants (you
know, like 
<CODE>EINPROGRESS</CODE> and
<CODE>ETOOSTUPID</CODE> and so on.) were not getting picked up. (Tom Hughes noticed this on
RedHat 7.0 as well.) The solution is to use the 
<CODE>-dM</CODE> flag to gcc; there's not much we can do for non-gcc right now.
<H3><a name="VMS_hackery">VMS hackery</a></H3>

</P>

<P>

There was a lot of work on VMS this week: firstly, in the area of file
locking. Peter Prymmer reported that 
<CODE>t/lib/st-lock.t</CODE> failed since VMS doesn't really have locking. Peter Farley piped up and
said that this was also the case on DOS and DJGPP, and the work-around
there was to null-op the locking tests. Andy Dougherty mentioned that
a permanent fix would be to define a 
<CODE>d_fcntl_can_lock</CODE> Configure variable to determine whether or not 
<CODE>fcntl</CODE> is any use. Craig Berry had suggested this idea before; Andy provided
 the patch.
</P>

<P>
Peter also noticed that one of Jarkko's patches had broken the 
<CODE>POSIX</CODE> module; there were also some problems with erronous output confusing
the test harnesses, so that the tests were passing but were still
reporting failures.
</P>

<P>
After all that, Perl on VMS now passes all tests, and there was much
rejoicing!
<H3><a name="The_fcrypt_of_mystery">The (f)crypt of mystery</a></H3>

</P>

<P>

Richard Proctor is trying to compile Perl on RiscOS (and take over the
RiscOS pumpkin) however is having problems in that 
<CODE>fcrypt</CODE> isn't prototyped on that system. He tried to force the issue with a
couple of casts, but Jarkko wasn't impressed; the Right Way to do it is
to have a separate 
<CODE>riscos/</CODE> directory and put the platform-specific things in there. Nicholas Clark
remarked that the 
[fcrypt] support was &quot;weird&quot;:
<blockquote></P>

<P>
There are 4 references to FCRYPT
but nothing anywhere (even in a port subdirectory) defines the macro.
The macro isn't of the usual HAS_ or I_ forms.
Does anyone know where it originates?
</blockquote></P>

<P>
Nobody did, which is... well, weird. However, we found out where
Riscos's 
<CODE>UnixLib</CODE> got its
<CODE>fcrypt</CODE> implementation from. 
</P>

<P>
Andy Dougherty suggested that the other right way to do it would be to
define (and test for) a configure symbol 
<CODE>d_fcrypt_proto</CODE> which then turns into 
<CODE>HAS_FCRYPT_PROTO</CODE>.
</P>

<P>
No patches were forthcoming.
<H3><a name="Yet_more_self_ties">Yet more self-ties</a></H3>

</P>

<P>

Randy Ray has a module (
<CODE>Perl-RPM</CODE>) which uses a self-tie; he found that the reference count of a
self-tied object is two, where you'd expect it to be one. Alan replied
that self-ties are badly broken (hey, don't we know it...) and Jarkko
announced that we could really do with someone who's prepared to tackle
this issue and get it sorted out. Randy promised to try and have a look.
</P>

<P>
Steffen Bayer suggested that you could just manually set the reference
count back to one, which struck Alan as somewhat sick. Steffen
responded:
<blockquote></P>

<P>

IMO, this is a matter of opinion. :-)
</P>

<P>
There's nothing fundamentally evil about setting the refcount to a lower
value, because this just triggers the DESTROY() event sooner than it
would normally.
</blockquote></P>

<P>
But Nick noted that you can't ensure that you're not going to create any
more references to the object during DESTROYing, so this really is
fundamentally evil after all.
<H3><a name="Rsync_vs_FTPing_the_patches">Rsync vs. FTP'ing the patches</a></H3>

</P>

<P>

Merijn Brand complained of a discrepancy between the patch archive
(That's  
<TT>rsync://ftp.linux.activestate.com/perl-current-diffs/</TT> or
<a href="ftp://ftp.linux.activestate.com/pub/staff/gsar/APC/perl-current-diffs">ftp://ftp.linux.activestate.com/pub/staff/gsar/APC/perl-current-diffs</a>) and the latest source tree. (
<TT>rsync://ftp.linux.activestate.com/perl-current/</TT> or 
<a href="ftp://ftp.linux.activestate.com/pub/staff/gsar/APC/perl-current">ftp://ftp.linux.activestate.com/pub/staff/gsar/APC/perl-current</a>.)
</P>

<P>
Sarathy explained that
<blockquote></P>

<P>
The rsync mirror is automatic and syncs with the repository every five
minutes.
</P>

<P>
Updating the patch area still requires manual intervention (with all
the goofiness that implies, which you've noted) and is typically on
a daily cycle.  Making this process automatic is on my tuit list,
but don't ask me when.
</blockquote></P>

<P>
The thread went a little off topic into the mechanics of setting up a
rsync server, but lead to  
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00073.html">a contribution to perlhack </a> from Merijn explaining how to keep in sync with the Perl source.
<H3><a name="Changes_to_READMEaix">Changes to README.aix</a></H3>

</P>

<P>

We've recently been telling AIX users that they need to upgrade their
compilers in order to compile Perl, so Merijn send in a patch to
README.aix to tell them how to do so.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00152.html">Read about it.</a></P>

<P>

Jarkko also decided it was time we had a README.Solaris; volunteers are
being sought.
<H3><a name="The_Regex_Stack_Problem">The Regex Stack Problem </a></H3>

</P>

<P>

Sam Smith found a regular expression which will crash the engine with a
segfault - further investigation showed it was the engine recursing too
deeply and exceeding the maximum stack depth. Dominic Dunlop explained
that it was difficult to fix this one, as writing stack checking code
portably is quite a challenge, and fixing the root of the problem -
changing the regex engine from recursion to iteration - is
somewhat Herculean.
</P>

<P>
Dominic further explained that he had a stack checking patch but it
depended on the system having the BSD resource limit functions 
<CODE>getrlimit</CODE> and 
<CODE>setrlimit</CODE>. He also couldn't find a nice way of making this all play sensibly with
threads. At the time, Ilya had countered that the problem should really
be fixed by rewriting the engine to be iterative; Dominic had tried
this, but it was very tricky and slowed the whole thing down by about
30% - this was due to the extra memory allocation of the structures that
needed to be copied between levels. Jarkko came up with a few ideas,
most promising being the use of a custom stack. 
</P>

<P>
The work-around is to increase the process's stack size using 
<CODE>ulimit</CODE>; it was suggested that perl should be able to use 
<CODE>setrlimit</CODE> to extend its own stack size when necessary. This was frowned upon by
Jarkko - limits are imposed for a reason.
</P>

<P>
Anyone who's got infinite patience and sanity may want to consider
hacking at removing the recursion, but so far Dominic and Hugo look like
the only people patient and sane enough.
<H3><a name="Things_nobodys_fixed">Things nobody's fixed</a></H3>

</P>

<P>

A few bug reports nobody's investigated yet, for those of you with a
spare minute:
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00043.html">xsubpp truncates files</a></P>

<P>
,
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00060.html">the AUTOLOAD behaviour changed in 5.6</a>, and
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00221.html">UTF |= is broken</a>. 
</P>

<P>
Enjoy!
<H3><a name="Craig_Berry">Craig Berry</a></H3>

</P>

<P>

Craig Berry deserves a special mention for his huge contribution to p5p
this week - we saw nearly three hundred messages from him. However, on
closer examination, 284 of them turned out to be the same, thanks to a
malicious copy of CC Mail belonging to somewhere completely
different.  (It wasn't Craig's fault at all.)
<H3><a name="Various">Various</a></H3>

</P>

<P>

I leave you with a veritable smorgasbord of misdirected queries, test
reports, FAQs, off-topic posts, and people spamming the list about how
much spam there was on the list, and until next week I remain, your
humble and obedient servant,
</P>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Cozens</a>

