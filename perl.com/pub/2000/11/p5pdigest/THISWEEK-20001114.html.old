
<!-- This week on perl5-porters (08--14 Nov 2000) -->

<br />
<!::field::date::><br />      </P>
<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#stat_vs_lstat">stat vs. lstat</a>
  <li><a href="#Threads_and_POSIX">Threads and POSIX</a>
  <li><a href="#PerlIO">PerlIO</a>
  <li><a href="#READMESolaris">README.Solaris</a>
  <li><a href="#Locales">Locales</a>
  <li><a href="#Integer_handling_revisited">Integer handling revisited</a>
  <li><a href="#head3">=head3</a>
  <li><a href="#Little_fixes">Little fixes</a>
  <li><a href="#Various">Various</a>
</ul>

<P>

<H3><a name="Notes">Notes</a></H3>

</P>

<P>
You can subscribe to an e-mail version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
simon@brecon.co.uk
</P>

<P>
There were 348 messages this week.  
</P>

<P>
Dominus mentioned this during his tenure, but now it's my turn: these
reports are only made possible due to the generosity of O'Reilly and
Associates, who keep me in caffeine.
<H3><a name="stat_vs_lstat">stat vs. lstat</a></H3>

</P>

<P>

David Dyck was using 
<CODE>find2perl</CODE> and turned up a couple of problems with 
<CODE>lstat</CODE>. The problem is that 
<CODE>lstat _</CODE> produces a warning because it thinks that
<CODE>_</CODE> is a filehandle, and you can't 
<CODE>lstat</CODE> a filehandle. (Only a filename)
</P>

<P>
David produced a patch to take care of this, but then discovered that 
<CODE>lstat</CODE> and the  
<CODE>-l</CODE> filetest were acting differently; you shouldn't be allowed to follow
<CODE>stat('something')</CODE> with 
<CODE>lstat _</CODE>. Again, David produced another patch to cause a fatal error if you try.
</P>

<P>
He also noticed that  
<CODE>-l FH</CODE> dies, whereas 
<CODE>lstat FH</CODE> doesn't, but nobody has looked into that yet.
</P>

<P>
Also in the &quot;file tests&quot; area, Rich Morin quoted the camel book:
<blockquote></P>

<P>
   &quot;Because Perl has to read a file to do the -T test, you don't want
   to use -T on special files that might hang or give you other kinds
   of grief.&quot;
</blockquote></P>

<P>
and commented that maybe Perl should test to see whether someone is planning
to do a 
<CODE>-T</CODE> or a 
<CODE>-B</CODE> test on a special file, and &quot;keep itself out of trouble&quot;.
</P>

<P>
Kurt Starsinic pointed out that there were times when you do want to
test, for example, a named pipe, and Perl shouldn't restrict the programmer from
doing so. Nick said it'll all be OK when we have PerlIO working.
</P>

<P>

<H3><a name="Threads_and_POSIX">Threads and POSIX</a></H3>

</P>

<P>
Kurt was indulging in bug archaeology and turned up something spooky
relating to signals and threads. He asked for an explanation of how
the signal model changes between nonthreaded and threaded Perl, which
Dan Sugalski 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00356.html">duly provided</a>. The rest of that thread (ho, ho) is worth reading, if you're interested
in how threads work with Perl.
<H3><a name="PerlIO">PerlIO</a></H3>

</P>

<P>

As usual, there's a lot of good work going on with PerlIO, and quite a
lot of the bulk of this week's traffic was taken up with PerlIO-related
test results, bug reports and discussion.
</P>

<P>
To remind you, PerlIO is going to be a complete IO library for Perl,
which, among other things, allows us to insert filters at various
stages of the input and output process. This means that, for instance,
data can be transparently converted to UTF8 from other character sets.
</P>

<P>
Nick mentioned that he'd like to test PerlIO a lot, so it
would be appreciated if those following the Perl development sources
could do something like the following:
<pre></P>

</P><PRE>
    ./Configure -Duseperlio -d
    make
    ...
    PERLIO=stdio  make test
    PERLIO=perlio make test
    PERLIO=mmap   make test
</pre></PRE>

<P>
and report results. (
<CODE>mmap</CODE> may not be available, depending on platform.) Dominic Dunlop fixed the
MachTen hints to stop it for claiming to support  
<CODE>mmap</CODE>, since any attempt to use the function just causes the program to abort
due to an error.
</P>

<P>
Robin Barker found that PerlIO-over-
<CODE>stdio</CODE> breaks large file support; Nick found that this was a problem with 64-bit support and that Perl was using 
<CODE>fseek</CODE> where it should have been using 
<CODE>fseeko</CODE>.
</P>

<P>
Nicholas Clark did some work on 
<CODE>IO::Handle</CODE> and some other IO calls, and found that the return values weren't particularly
intuitive; Perl was reporting the raw return values from  
<CODE>stdio</CODE> rather than true or false. This becomes problematic, of course,
when the IO model isn't 
<CODE>stdio</CODE>. He produced some fixes for 
<CODE>ungetc</CODE> and 
<CODE>getpos</CODE>, and he also noted that if we're using
<CODE>sfio</CODE> then we shouldn't treat 
<CODE>sftell</CODE> as if it were 
<CODE>ftell</CODE>, as there's yet another return value inconsistency.
</P>

<P>

Nicholas also came up with a 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00604.html">"dumb shell" </a>to allow a shell with a
per-process current directory on systems that don't have one, which
should make dealing with subdirectories during building easier, and
might also help with cross-compiling Perl.
</P>

<P>
Nick Ing-Simmons also asked 
<blockquote></P>

<P>
Now that PerlIO is in the mainline I _really_ need to know
what to do next in terms of making it useful.
</P>

<P>
This means knowing what it &quot;should&quot; look like to perl5
</blockquote></P>

<P>
There followed a useful discussion of the proposed API; 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00390.html">Read about it.</a></P>

<P>
It was also determined that one should open a file containing Latin data
as follows:
</P>

<P>
[ XL indementum tum biguttam tum latin-1 inquementum tum LatinFile inquementum evolute meo fho morive errorum. ]
</P>

<P>
and that Perl programs dealing with data in Japanese are implicity
permitted to seppuku.
<H3><a name="READMESolaris">README.Solaris</a></H3>

</P>

<P>

Andy Dougherty produced a README.Solaris, which Jarkko, Russ, Alan and
many others looked over and improved; later on, he produced a final
version to be integrated, along with some other Solaris fixes. This was
applied to the tree, and then some people picked over it a little more.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00559.html">Read about it.</a></P>

<P>

<H3><a name="Locales">Locales</a></H3>

</P>

<P>
Jarkko's old nemesis was out in force this week. Robin Barker and
Larry Virden found that the UTF8 locales didn't work properly - this was
not really a surprise, since Jarkko had disabled the tests as they
require the fabled polymorphic regular expression support. (This means
that  
<CODE>/(.)/</CODE> should be equally happy capturing a UTF8 character as a non-UTF8
character.) Lupe Christoph found that most of the tests work OK, as
there's only two that require polymorphic regexes. Jarkko grudgingly
re-enabled them - locales are Not His Friend.
</P>

<P>
Vadim Konovalov produced a little fix to make the locale tests work, and
added a test for the MS-DOS Russian code page; seems like Perl is now
happy to speak Russian even on MS-DOS systems.
<H3><a name="Integer_handling_revisited">Integer handling revisited</a></H3>

</P>

<P>

If you remember a month ago, there was a discussion on 
<a href="http://www.perl.com/pub/2000/10/p5pdigest/THISWEEK-20001008.html#Integer_and_floating_point_handling">integer and floating point handling</a>, in which it was suggested that adding two integers together at
run-time should result in an integer, rather than a floating point.
</P>

<P>
Jarkko and Nicholas Clark have been looking into this, and Jarkko
produced a patch; it looked to me like the complexity of determining
whether it's possible to sum two integers without overflowing is going
to cause a slowdown, and Perl usually trades space for speed.
</P>

<P>
However, Nicholas mentioned that on the StrongARM architecture, floating
points are all emulated, and thus keeping everything integer might
actually speed it up.
<H3><a name="head3">=head3</a></H3>

</P>

<P>

Casey Tweten produced a patch that allowed 
<CODE>Pod::Man</CODE> to deal with 
<CODE>=head3</CODE> and above. Russ Allbery disapproved, on the grounds that the 
<CODE>man</CODE> translator should not be singled out - if we're going to do this, we
should change the documentation for POD, and all the other translators.
Andy pointed out that it's OK to update the translators one at a time,
since it's not really reasonable to blitz through them all in one go.
However, 
<CODE>perlpod.pod</CODE> should be updated. (Nobody's done this yet.)
</P>

<P>
Tim Jenness pointed out that the LaTeX translator already deals with  
<CODE>=head3</CODE> and 
<CODE>=head4</CODE>.
<H3><a name="Little_fixes">Little fixes</a></H3>

</P>

<P>

Since last week, I concentrated on things that nobody fixed, this time
we'll have a whirlwind tour of things that people did get fixed.
</P>

<P>
The 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-11/msg00271.html">VMS and Cygwin flock fix</a> we mentioned last week were implemented, thanks to Craig Berry and
Andy Dougherty. 
</P>

<P>
Eric Fifer brought the Cygwin port up to date with Cygwin 1.1.5. (Great
work as ever, Eric!) 
</P>

<P>
Harold Morris, one of the Amdahl UTS people produced some patches to
help Perl run under UTS; Lupe Christoph had some of the regular
expression-test suite explain why it was failing if it did. Lots of
people fixed up documentation, so I won't mention them all. Casey Tweten
did some good work, including adding an 
<CODE>import</CODE> method to 
<CODE>Class::Struct</CODE>. Nicholas Clark fixed some FreeBSD 
<CODE>stdio</CODE> declarations. Robin Barker picked up some dodgy casts between pointers
and integers.
<H3><a name="Various">Various</a></H3>

</P>

<P>

As usual, plenty of small bug reports, patches, irrelevant questions,
the complete absence of flames, and only one spam.
</P>

<P>
Until next week I remain, your humble and obedient servant,
</P>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Cozens</a>

