</P>

<P>


<!-- This week on perl5-porters (15--21 May 2000) -->

<br />
<!::field::date::><br />
<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#my_x_if_0;_Trick"><code>my $x if 0;</code> Trick</a>
  <li><a href="#Zero_padded_numbers_in_formats">Zero-padded numbers in formats</a>
  <li><a href="#Forbidden_Declarations">Forbidden Declarations</a>
  <li><a href="#Port_to_WindowsCE">Port to Windows/CE</a>
  <li><a href="#chat2pl_is_Still_There"><code>chat2.pl</code> is Still There</a>
  <li><a href="#pod2latex"><code>pod2latex</code></a>
  <li><a href="#Long_Regexes">Long Regexes</a>
  <li><a href="#UTF8_Hash_Keys">UTF8 Hash Keys</a>
  <li><a href="#UTF8_String_Patches">UTF8 String Patches</a>
  <li><a href="#mktablespl_has_Been_Addressed"><code>mktables.pl</code> has Been Addressed</a>
  <li><a href="#More_Environmental_Problems">More Environmental Problems</a>
  <li><a href="#readonly_Pragma"><code>readonly</code> Pragma</a>
  <li><a href="#Tutorials">Tutorials</a>
  <li><a href="#Brad_Appleton_replies_to_my_remarks_about_Pod::Parser">Brad Appleton replies to my remarks about <code>Pod::Parser</code></a>
  <li><a href="#Various">Various</a>
</ul>

      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>mjd-perl-thisweek-YYYYMM@plover.com</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
<H3><a name="my_x_if_0;_Trick"><code>my $x if 0;</code> Trick</a></H3>

</P>

<P>

This week's big big thread (81 messages) had the unfortunate title 'Is
perlbug broken', because Ben Tilly's original message to 
<CODE>perlbug</CODE>  bounced and he resent it with that new subject.  The subject 
<em>should</em> have been 'Improperly persistent lexicals'.
</P>

<P>
The original question concerned the following example:
</P>

<P>

<pre>        use strict;
        &amp;persistent_lex() foreach 1..5;
</P>

</P><PRE>
        sub persistent_lex {
            my @array = () if 0;
            push @array, "x";
            print @array, "\n";
        }
</pre></PRE>

<P>
Here the array behaves like a static variable, and is not created
afresh each time 
<CODE>persistent_lex</CODE> is called; it accumulates more and more 
<CODE>x</CODE>es each time.  A number of people said that this was a feature, and
that its behavior is obvious if you understand the implementation.
Several explanations were advanced, but most of them were wrong.
I think Nat Torkington got it right; earlier respondents didn't.
</P>

<P>
The obvious explanation is: 
<CODE>my</CODE> creates a lexical variable, and then at run time, initializes it each
 time the block is entered; the 
<CODE>if 0</CODE> suppresses the runtime initialization so that the  variable  retains
 its value.  To see why this is not a sufficient explanation, consider
 the following example, which creates two closures:
</P>

<P>

<pre>        use strict;
        my $a =  make_persistent_lex();
        $a-&gt;()  foreach 1..5;
        my $b =  make_persistent_lex();
        $b-&gt;()  foreach 1..5;
</P>

</P><PRE>
        sub make_persistent_lex {
            return sub {
              my @array if 0;
              push @array, "x";
              print @array, "\n";
            };
        }
</pre></PRE>

<P>
Here the variable 
<CODE>@array</CODE>is <em>shared</em> between the two closures.  If you omit the 
<CODE>if 0;</CODE> then 
<CODE>$a</CODE> and 
<CODE>$b</CODE> get separate variables.  
</P>

<P>
Nat Torkington did provide an explanation which I think is correct,
with Jan Dubois filling in some of the technical details.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00736.html">Jan's description of the guts.</a></P>

<P>

Some people suggested documenting this 'feature'.  Tom said that Larry
had told him not to do that because he didn't want to reply on
supporting it.  Larry affirmed this:
<blockquote><b>Jan Dubois:</b> I think this behavior is a side effect of the implementation and shouldn't be documented as a feature.  It should at best be "undefined" behavior  that may change in the future (IMHO).<p><b>Larry:</b> In Ada parlance, use of this feature would be considered erroneous. </blockquote> </P>

<P>

Simon Cozens said to me later that if p5p can't understand the
'feature', it should not be documented as a feature.  I think there's
some truth in that.   Barrie Slaymaker suggested that Perl issue a
warning in this case.  
</P>

<P>
The thread also contained a side discussion about whether or not 5.6.0
is stable and reliable.
<H3><a name="Zero_padded_numbers_in_formats">Zero-padded numbers in formats</a></H3>

</P>

<P>

John Peacock provided a patch that allows you to specify that numbers
displayed in formats can be zero-filled.
(Remember formats?  You print a formatted report
with the 
<CODE>write</CODE> function.) 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00664.html">Read about it.</a></P>

<P>

</P>

<P>
Tom asked why not use 
<CODE>sprintf</CODE>.  John replied that the patch to the 
<CODE>format</CODE> code is simple and that the 
<CODE>sprintf</CODE> solution requires a lot more Perl code than just using a zero-filled
format picture.
</P>

<P>
Matt Sergeant asked why formats hadn't been spun off into an external
module.  Damian Conway apparently has a paper on that.  Dan Sugalski
replied that they probably need some access to the lexer.  I suspect
that the real reason is that nobody really cared very much.  Dan did
add that formats need an overhaul:
<blockquote><b>Dan Sugalski:</b> Formats could certainly use an overhaul--a footer capability'd be nice, as  would the ability to use lexicals. Between that and a rewrite of BigInt and BigFloat for speed would allow you to grab an awful lot of the Cobol Cattle  Crowd...</blockquote> </P>

<P>

<H3><a name="Forbidden_Declarations">Forbidden Declarations</a></H3>

</P>

<P>
I pointed out that if you get the error 
</P>

</P><PRE>
        In string, @X::Y must now be written as \@X::Y...
</PRE>

<P>
you cannot fix it by declaring the array with 
<CODE>our</CODE> as the manual suggests, because there is an arbitrary restriction on 
<CODE>our</CODE>.  I supplied a patch to remove this, but I expect it will not go in,
because the arbitrary restriction was put there on purpose several
months ago. 
</P>

<P>
Tom replied that
</P>

</P><PRE>
        { package X; our @Y; }
</PRE>

<P>
will work.
</P>

<P>

<H3><a name="Port_to_WindowsCE">Port to Windows/CE</a></H3>

</P>

<P>
Jarkko Hietaniemi forwarded an article that Ned Konz had posted on 
<CODE>comp.lang.perl.moderated</CODE>, saying that he was working on a port of Perl to Windows/CE, which I gather
 is a version of Windows that runs on a palmtop.  Ned mentioned a
number of potential problems he foresaw. 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00556.html">Ned's Article</a></P>

<P>

Simon Cozens referred him to 'microperl', which he said had been
created with the intention of porting Perl to small operating systems.
<blockquote><b>Simon:</b> It does remove a lot of the Unixisms, plus it takes the size of the core down to the bare essentials. I'd start there. </blockquote> </P>

<P>

Nat Torkington mentioned in passing that a Windows/CE port would
probably go some way toward making a Palm Pilot port possible,
and Simon protested that he would probably have one ready `in a couple
of weeks'.  He says that the hardest problem was getting the lexer to
fit into the Palm's small code segments.
<H3><a name="chat2pl_is_Still_There"><code>chat2.pl</code> is Still There</a></H3>

</P>

<P>

Peter Scott mentioned 
<CODE>chat2.pl</CODE> in connection with something in the FAQ, and Randal Schwartz, the
original author, replied that it should probably never have been
included in the first place; he wrote it for a particular purpose back
in the mists of time, posted it to 
<CODE>comp.lang.perl</CODE> a couple of times in response to people who seemed to want to do
something similar, and Larry included it into the Perl 4 distribution
without asking him if it was OK.  Randal says that if he had been
planning to release it, he would have written it differently, and that
that's why it's never been really complete.  He also said he was glad
it had been dropped from the distribution.  Then he discovered that it 
<i>hadn't</i> been dropped, and seemed rather shocked.
</P>

<P>
Summary: Don't use 
<CODE>chat2.pl</CODE>.
<H3><a name="pod2latex"><code>pod2latex</code></a></H3>

</P>

<P>

Tim Jenness suggested replacing the old 
<CODE>pod2latex</CODE> with his new version based on
<CODE>POD::LaTeX</CODE>.  There was no discussion.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00560.html">Read about it.</a></P>

<P>

<H3><a name="Long_Regexes">Long Regexes</a></H3>

</P>

<P>
Michael Shields demonstrated a sample email message that made the 
<CODE>Mail::Header</CODE> module take an unusually long time to parse the header.  He then
supplied a patch, suggested by Ronald Kimball, that made the relevant
regex finish more quickly.  (Ronald's original suggestion wasn't quite
correct; he supplied a second alternative later.)
</P>

<P>
Mike Guy pointed out that even without the
patch the regex completed quickly  under 5.6.0, because the regex
optimizations are better.  However, Ilya says that this particular
optimization is buggy:  It only works under certain circumstances, and
he did not implement a check for those circumstances.  But he could
not make a test case where the optimization fails.  He asked for help
doing this.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00585.html">Ilya's request for a test case.</a></P>

<P>
Ben Tilly and Ilya had long and extremely interesting discussion of
next-character-peeking optimiztions that is required reading for
anyone who is interested in the guts of the regex engine or who might
someday want to be the Regex Engine Pumpking.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00582.html">The root of this discussion.</a></P>

<P>
There was a sidetrack:  John Macdonald suggested that there could  be
a standard module that would provide efficient, correct regexes for
common cases such as matching a string that contains balanced
parentheses.    Damian Conway pointed out that his 
<CODE>Text::Balanced</CODE> module does precisely this.
</P>

<P>

<H3><a name="UTF8_Hash_Keys">UTF8 Hash Keys</a></H3>

</P>

<P>
M.J.T. Guy asked what the intentions were regarding UTF8 hash keys.
Nick Ing-Simmons replied that he recalled that they would be enabled
per-hash, and that each hash would either have all UTF8 keys or no
UTF8 keys.  Andreas pointed out that there had been an extensive
discussion of this in the past.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/cgi-bin/w3glimpse/perl5-porters?query=hash+keys+utf8&errors=0&case=on&maxfiles=100&maxlines=30">Extensive Discussion</a><H3><a name="UTF8_String_Patches">UTF8 String Patches</a></H3>

</P>

<P>

Simon discovered that single-quoted strings were not having their
UTF8-ness handled properly, and provided a patch.  Short summary: The
SV has a UTF8 flag on it, and if you extract the C string part of the
UTF8 SV and make a new SV with the same string, you also have to set
the UTF8 flag on the new SV or Perl won't treat it the same.   Simon
also provided a patch to 
<CODE>perlguts</CODE> that discusses this.
<H3><a name="mktablespl_has_Been_Addressed"><code>mktables.pl</code> has Been Addressed</a></H3>

</P>

<P>

James Bence stepped up to answer Larry's request that 
<CODE>mktables.pl</CODE> be refurbished.
</P>

<P>

<a href="http://www.perl.com/pub/2000/05/p5pdigest/THISWEEK-20000507.html#mktablesPLNeeds_Work">Earlier Summary</a><H3><a name="More_Environmental_Problems">More Environmental Problems</a></H3>

</P>

<P>

Jonathan Leffler forwarded a problem that had come up on the DBI
mailing list relating to the way Perl uses the environment; if some
other library <em>also</em> tries to modify the environment, this messes up 
Perl and can cause core dumps.  Jonathan forwarded an archive of some
discussion of this same problem in 1997, and I remember it also came
up last November.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00589.html">Jonathan's message.</a></P>

<P>

<a href="http://www.perl.com/pub/1999/11/p5pdigest/THISWEEK-19991121.html#Wandering_Environment">Summary of November discussion.</a></P>

<P>

Several solutions of various types were proposed.
<H3><a name="readonly_Pragma"><code>readonly</code> Pragma</a></H3>

</P>

<P>

Mark Summerfield wants to make a pragma called 
<CODE>readonly</CODE> that declares a read-only scalar variable.  This is different from
 what 
<CODE>use constant</CODE> does because the 'constants' generated by 
<CODE>use constant</CODE> have a special syntax that  doesn't always work.  For example: 
</P>

</P><PRE>
        use constant PI => 3;
        $hash{PI} = 'pi';
</PRE>

<P>
The key here is 
<CODE>PI</CODE>, not 
<CODE>3</CODE>.  Several alternative suggestions were advanced; the nicer ones
seemed to be William Setzer's 
<CODE>Const</CODE> module which is a tiny XS that just sets the 
<CODE>READONLY</CODE> flag in the SV.   Unfortunately, it doesn't seem to be on CPAN.  Tom
 did post the entire code, which is only a couple of paragraphs long.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00777.html">Const.pm</a></P>

<P>

<H3><a name="Tutorials">Tutorials</a></H3>

</P>

<P>

Ken Rietz offered to write more tutorials or to coordinate the writing
of tutorials, and asked for suggestions.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00761.html">See the message if you want to make a suggestion.</a></P>

<P>

<H3><a name="Brad_Appleton_replies_to_my_remarks_about_Pod::Parser">Brad Appleton replies to my remarks about <code>Pod::Parser</code></a></H3>

</P>

<P>
Two weeks ago I posted a lot of stuff about Pod and the
Pod-translating software, and Brad Appleton, the author of 
<CODE>Pod::Parser</CODE>, felt that some of it was unfair, and also pointed out a number of
real errors that I made.  Brad has been kind enough to provide an
article correcting my mistakes.
</P>

<P>

<a href="http://www.perl.com/pub/2000/05/podparser.html">Brad's reply.</a><H3><a name="Various">Various</a></H3>

</P>

<P>

<pre>        p5p: B+++(--) F+ Q+++ A+++ F+ S+ J++ L+
</pre><!-- Thanks to John Porter for this extremely funny idea. --></P>

<P>

Until next week I remain, your humble and obedient servant,
</P>

<P>

</P>

<hr>

<a href="mailto:mjd-perl-thisweek-200005+@plover.com">Mark-Jason Dominus</a>
