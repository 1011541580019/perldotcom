<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: May 2000 Archives</title>


    <link rel="prev" href="/pub/2000/04/" title="April 2000" />
    <link rel="next" href="/pub/2000/06/" title="June 2000" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">May 2000 Archives</h1>





                            
                            <div id="entry-1684" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/05/p5pdigest/THISWEEK-20000528.html" rel="bookmark">This Week on p5p 2000/05/28</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="2000-05-28T00:00:00-08:00">May 28, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            </P>

<P>


<!-- This week on perl5-porters (22-28 May 2000) -->

<br />
<br />

<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#Regex_Engine_Enhancements">Regex Engine Enhancements</a>
  <li><a href="#eq_and_UTF8_operator"><code>eq</code> and UTF8 operator</a>
  <li><a href="#Caching_of_the_getby_Functions">Caching of the <code>get</code>*<code>by</code>* Functions</a>
  <li><a href="#Forbidden_Declarations_Continued">Forbidden Declarations Continued</a>
  <li><a href="#Perl_in_the_News">Perl in the News</a>
  <li><a href="#readonly_Pragma_Continues"><code>readonly</code> Pragma Continues</a>
  <li><a href="#Magical_Autoincrement">Magical Autoincrement</a>
  <li><a href="#Doctor_Doctor_it_Hurts_When_I_Do_This">Doctor, Doctor, it Hurts When I Do This!</a>
  <li><a href="#use_strict_formatting"><code>use strict 'formatting'</code></a>
  <li><a href="#Complex_Expressions_in_Formats">Complex Expressions in Formats</a>
  <li><a href="#packU"><code>pack("U")</code></a>
  <li><a href="#Various">Various</a>
</ul>

      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>mjd-perl-thisweek-YYYYMM@plover.com</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
</P>

<P>
This week's report is a little early, because tomorrow I have to leave
to go on the Perl Whirl.   Next week's report will be late, for the
same reason.  
</P>

<P>
Quite a lot of discussion this month, much of it rather pointless.
Not one of our better weeks, I'm afraid.  
<H3><a name="Regex_Engine_Enhancements">Regex Engine Enhancements</a></H3>

</P>

<P>

Ben Tilly, Ilya Zakharevich, and 
Fran&ccedil;ois D&eacute;sarm&eacute;nien had a discussion about an alternative implementation of the regex
engine.    I'm going to try to summarize the necessary background as
briefly as possible.
</P>

<P>
The regex engine is a state machine.  The engine looks through the
characters in the target string one at a time and makes a state
transition on each one; at the end of the string it looks to see if it
is in an `accepting state' and if so, the pattern matches.  What regex
you get depends on how the states are arranged and what are the
transitions between them.
</P>

<P>
The basic problem that all regex engines face is that a certain state
might have two different transitions on the same condition.  For
example, suppose you are matching 
<CODE>/foo(b*)bar/</CODE> and you have seen 
<CODE>foo</CODE> already.  You are now in a state that expects to see an upcoming 
<CODE>b</CODE>.  When you see the 
<CODE>b</CODE>, however, you get two choices:  You can go back to the same state and
look for another 
<CODE>b</CODE>, or you can go on to the next state and look for an 
<CODE>a</CODE>.  If the string is 
<CODE>foobbbar</CODE> then the first choice is correct; if the string is 
<CODE>foobar</CODE> then the second choice is correct.
</P>

<P>
There are basically two ways to deal with this.  One way is to use a
representation of the state machine that keeps track of all the states
that the machine could be in at once.  In the example above, it would
note that the machine might be in either of the two possible states.
Future transitions might lead to more uncertainty about the state that
the machine was actually in.  At the end of the string, the engine
just checks to see if 
<em>any</em>  of the possible result states are acceptingstates, and if so, it reports that there is a match.  This is called
the 'DFA' approach.
</P>

<P>
The other approach  is to take
one of the two choices arbitrarily and remember that if the match does
not work out, you can backtrack and try the other alternative
instead.  This is called the 'NFA' approach, and it is what Perl does.
It choses to go back and try the 
current state first, before it tries going on to the next state; that
is what makes Perl's 
<CODE>*</CODE> operator greedy.  For the non-greedy 
<CODE>*?</CODE> operator it just chooses the other alternative first.  
</P>

<P>
Both approaches have upsides and downsides.  Downsides of the NFA
approach: It is generally slower at run-time.  It is more difficult to
handle non-greedy matching and backreferences.  Downsides of the DFA
approach: It is prone to take a very long time for certain regexes,
because of its habit of trying many equivalent alternatives one at a
time.  Also, it is very hard to specify that you want the longest
possible match---consider writing a Perl regex that matches whichever
of 
<CODE>/elsif|\w+/</CODE> is longer.  This is easy to implement if you use an NFA.
</P>

<P>
Ben's idea is that you would start with an NFA and then apply a
well-known transformation to turn it into a DFA.  
The well-known transformation is that each state in the DFA
corresponds to a set of states that the original NFA could have been
in; Ben's idea is that you can retain the information about the order
in which the states would have been visited, and use those ordered
sets of NFA states as single DFA states.
The problem with
this sort of construction is that under some circumstances the number of states
explodes exponentially---if the original NFA had 
<var>n</var> states then the resulting DFA could have up to  2<sup><var>n</var></sup> states.  With Ben's idea this is evenworse, because the resulting DFA might have up to 
<var>(n+1)!</var> states.  But as Ben points out, in practice it is usually well-behaved.
You would be trading off an unusual run-time bad behavior for a
(probably) more unusual  compile-time bad behavior.  On the other
hand, if Ben's scheme went bad at compile time, it would go really bad
and eat all your memory.  Also, it is really unclear how to handle
backreferences with his scheme.  Ben waved his hands over this and
Ilya did not have any ideas about how to do it.
</P>

<P>
There was some discussion of various other regex matters.  Ben had
formerly suggested a 
<CODE>(?\/)</CODE> operator that matches the empty string but
which inhibits backtracking; if the engine tries to backtrack past it,
it fails.  SNOBOL had something like this, called 
<CODE>FENCE</CODE>.  Ilya said he did not want to do this because he thought all the
useful uses were already covered by 
<CODE>(?>...)</CODE> and because he did not want to implement a feature that was only
 explainable in terms of backtracking.  He also said you could get
 this behavior by doing 
</P>

</P><PRE>
        (?:|(?{die}))
</PRE>

<P>
and putting the regex match into an 
<CODE>eval</CODE> block.  (Did you get that?  It first tries to match the empty string,
 to the left of the 
<CODE>|</CODE>, and if that doesn't work, it tries to match 
<CODE>(?{die})</CODE>, which throws an exception.)
</P>

<P>
Ben suggested that the regex engine could have a hook in it that would
call an alternative regex engine, handing it the string to be matched
and the current position, and the subengine would return a value
saying how far it had matched up to; this would facilitate trying out
alternative implementations or new features.
</P>

<P>
Ilya spent some time discussion new features he thought might be
useful.  
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg01056.html">One such message.</a></P>

<P>

When Ilya mentioned SNOBOL is went into SNOBOL-berserk mode and posted a
twelve-page excerpt from the SNOBOL book about SNOBOL pattern-matching
optimizations, which was not particularly relevant to the rest of the
discussion.  
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00853.html">Root of this thread</a><H3><a name="Perl_in_the_News">Perl in the News</a></H3>

</P>

<P>

<a href="http://news.cnet.com/news/0-1007-200-1939586.html?tag=st.ne.1002.tgif.ni">The News</a></P>

<P>
Dick Hardt was quoted out of context.  This led to a really boring and
offtopic advocacy discussion.  
<!-- ``Why is Perl perceived as slow and bloated?''  Duh, maybe because it's slow and bloated? -->Several people
were asked to take the discussion to the advocacy mailing list.  This
meant that they cc'ed the discussion to both lists.  Brilliant.
</P>

<P>
Folks, I love the advocacy list because then people who want to have
interminable discussions about why Perl is considered slow and bloated
have somewhere to do it where I don't have to hear it.  Maybe someday
I will commit a heinous crime and be sentenced to produce a weekly
summary of discussion on the Perl Advocacy mailing list, and I will be
unable to plea-bargain my way to a lesser offense that carries the
death penalty.  Until then, please do me a favor and keep advocacy
discussion out of p5p.
<H3><a name="Doctor_Doctor_it_Hurts_When_I_Do_This">Doctor, Doctor, it Hurts When I Do This!</a></H3>

</P>

<P>

<blockquote><b>Garrett Goebel:</b> <pre>my $val = shift; <br>substr($bitstring,2,4) = pack('p',$val); </pre><p><b>Ilya Zakharevich:</b><p> Do not.<br>Hope this helps,<br>Ilya</p></blockquote></P>

<P>

<H3><a name="eq_and_UTF8_operator"><code>eq</code> and UTF8 operator</a></H3>

</P>

<P>

Clark Cooper asked why a UTF8 string will not compare 
<CODE>eq</CODE> to a non-UTF8 string whose bytes are identical.
</P>

<P>
Ilya replied that the short answer is that they should not compare 
<CODE>eq</CODE> because they represent different sequences of characters. 
</P>

<P>
He then elaborated and said that the internal representation does not
matter; that a string is a sequence of characters, and a character is
just an integer in some range.  In old Perls the range was 0..255; now
the range is 0..(2**64-1), and the details about how these integers
are actually represented is not part of the application's business.
<H3><a name="Caching_of_the_getby_Functions">Caching of the <code>get</code>*<code>by</code>* Functions</a></H3>

</P>

<P>

Last week Steven Parkes complained that when he used the 
<CODE>LWP::UserAgent</CODE> module, each new agent caused a call to one of the 
<CODE>getprotoby</CODE>* functions, which opened the 
<CODE>/etc/protocols</CODE> file and searched it.  Many agents, many searches.  He pointed out
 that there is no way to get 
<CODE>LWP::protocol::http</CODE> or 
<CODE>IO::Socket::inet::_sock_info</CODE>, the culprit functions, to cache the protocol information.
</P>

<P>
Ben Tilly suggested adding a caching layer to those functions, or
having the standard modules use a cached version.  Tom pointed out
that the uncached call only takes 1/6000 second on his machine, so it
is unlikely to be a real problem in practice,  and
that the caching is hard to get right in general.   Russ pointed out
that it is a very bad idea to have application-level caching of 
<CODE>gethostby</CODE>* and 
<CODE>getaddrby</CODE>* calls, because such caching ignores the TTL in the DNS record.
Other points raised:  Caching of DNS information is already done in
the 
<CODE>named</CODE>, and correctly.  Any caching of DNS information done at the 
<CODE>gethostby</CODE>* level is guaranteed to be wrong.
</P>

<P>

<H3><a name="Forbidden_Declarations_Continued">Forbidden Declarations Continued</a></H3>

</P>

<P>

Last week I complained about the error 
</P>

</P><PRE>
        In string, @X::Y must now be written as \@X::Y...
</PRE>

<P>
In the ensuing discussion, I suggested that this error message be
removed.  We have been threatening since 1993 that
<blockquote>Someday it will simply assume that an unbackslashed<code>@</code> interpolates an  array.</blockquote></P>

<P>

Sarathy said that he thought this should have appened two years ago,
so I provided a patch.  Interpolating an undeclared array into a
string is no longer a fatal error; instead, it will raise the warning 
</P>

</P><PRE>
        Array @X::Y will be interpolated in string
</PRE>

<P>
if you have warnings enabled.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00850.html">The patch.</a></P>

<P>

<a href="http://www.plover.com/~mjd/perl/at-error.html">This article has a detailed explanation of the history of this error message.</a></P>

<P>

<a href="/pub/2000/05/p5pdigest/THISWEEK-20000521.html#Forbidden_Declarations">Previous Discussion</a><H3><a name="readonly_Pragma_Continues"><code>readonly</code> Pragma Continues</a></H3>

</P>

<P>

<a href="/pub/2000/05/p5pdigest/THISWEEK-20000521.html#readonly_Pragma">Previous Discussion</a></P>

<P>
Mark Summerfield does not like any of the alternatives that were
proposed.  There are several 
<CODE>tie</CODE>-based solutions which are too slow.  He does not like William
Setzer's 
<CODE>Const</CODE> module because at happens at run time so you have to declare the
 readonly variable separately from the place you make it constant.
(I wonder if 
</P>

</P><PRE>
        const my $x = 12;
</PRE>

<P>
would work?)
</P>

<P>
He also complained that even if you mark a scalar as readonly, someone
else can go into the glob and replace the entire scalar, with
</P>

</P><PRE>
        *pi = \3;
</PRE>

<P>
A couple of people replied that if someone wants to change your
read-only value so badly that they are willing to hack the symbol
table to do it, then they should be allowed to do so.
</P>

<P>
Tom posted what I think was a quote from Larry saying that
</P>

</P><PRE>
        my $PI : constant = 4 * atan2(1,1);
</PRE>

<P>
was coming up eventually.
<H3><a name="Magical_Autoincrement">Magical Autoincrement</a></H3>

</P>

<P>

Vadim Konovalov complained that
</P>

</P><PRE>
        $a = 'a';
        $a==5;
        $a++;
</PRE>

<P>
Increments 
<CODE>$a</CODE> to 1 instead of to 
<CODE>b</CODE>.  This is as documented:
</P>

<P>

<blockquote>The auto-increment operator has a little extra builtin magic to it.  If you increment a variable that is numeric, <b>or that has ever been used in a numeric context</b>, you get a normal increment.  </blockquote><H3><a name="use_strict_formatting"><code>use strict 'formatting'</code></a></H3>

</P>

<P>

Ben Tilly suggested a 
<CODE>use strict 'formatting'</CODE> declaration that would tell Perl to issue a diagnostic whenever the
 indentation and the braces were inconsistent.  However, he did not
 provide a patch.
</P>

<P>

</P>

<P>

<H3><a name="Complex_Expressions_in_Formats">Complex Expressions in Formats</a></H3>

</P>

<P>
H. Merijn Brand points out that complex variable references, such as 
<CODE>$e[1]{101}</CODE> seem to be illegal in formats.  However, he did not provide a patch.
<H3><a name="packU"><code>pack("U")</code></a></H3>

</P>

<P>

Meng Wong pointed out that 
<CODE>pack("U")</CODE>, which is documented as
</P>

</P><PRE>
        [pack] A Unicode character number.  Encodes to UTF-8
        internally.  Works even if C&lt;use utf8> is not in effect.
</PRE>

<P>
does not produce a UTF8 string.  Simon provided a patch for that.
Then a discussion between Ilya, Sarathy, and Gisle Aas ensued about
whether this was the right thing to do.  Gidle said it was not, and
asked what 
<CODE>pack("UI")</CODE> should produce.  Sarathy said that 
<CODE>"U"</CODE> packs a character in the UTF-8 encoding, and UTF-8 is encoded with
 bytes; therefore the result of the 
<CODE>pack</CODE> should be bytes, not another UTF-8 string.  Ilya asked then what
 should happen if someone did
</P>

</P><PRE>
        $a = pack "A20 I", $string, $number;
</PRE>

<P>
where 
<CODE>$string</CODE> contained characters with values larger than 255.  Sarathy said that 
<CODE>"A"</CODE> is defined to be ASCII, so it should die.  Then Ilya pointed out that
 if it did that there would be no way to take a UTF8 string and insert
 it into a 20-byte fixed-width field.  Discussion went on, and I was
 not able to discern a clear conclusion.
<H3><a name="Various">Various</a></H3>

</P>

<P>

A large collection of bug reports, bug fixes, non-bug reports,
questions, answers, and a small amount and spam.   No serious flamage
however.
</P>

<P>
Until next week I remain, your humble and obedient servant,
</P>

<hr>

<a href="mailto:mjd-perl-thisweek-200005+@plover.com">Mark-Jason Dominus</a>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1682" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/05/p5pdigest/THISWEEK-20000521.html" rel="bookmark">This Week on p5p 2000/05/21</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="2000-05-21T00:00:00-08:00">May 21, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            </P>

<P>


<!-- This week on perl5-porters (15-21 May 2000) -->

<br />
<br />
<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#my_x_if_0;_Trick"><code>my $x if 0;</code> Trick</a>
  <li><a href="#Zero_padded_numbers_in_formats">Zero-padded numbers in formats</a>
  <li><a href="#Forbidden_Declarations">Forbidden Declarations</a>
  <li><a href="#Port_to_WindowsCE">Port to Windows/CE</a>
  <li><a href="#chat2pl_is_Still_There"><code>chat2.pl</code> is Still There</a>
  <li><a href="#pod2latex"><code>pod2latex</code></a>
  <li><a href="#Long_Regexes">Long Regexes</a>
  <li><a href="#UTF8_Hash_Keys">UTF8 Hash Keys</a>
  <li><a href="#UTF8_String_Patches">UTF8 String Patches</a>
  <li><a href="#mktablespl_has_Been_Addressed"><code>mktables.pl</code> has Been Addressed</a>
  <li><a href="#More_Environmental_Problems">More Environmental Problems</a>
  <li><a href="#readonly_Pragma"><code>readonly</code> Pragma</a>
  <li><a href="#Tutorials">Tutorials</a>
  <li><a href="#Brad_Appleton_replies_to_my_remarks_about_Pod::Parser">Brad Appleton replies to my remarks about <code>Pod::Parser</code></a>
  <li><a href="#Various">Various</a>
</ul>

      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>mjd-perl-thisweek-YYYYMM@plover.com</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
<H3><a name="my_x_if_0;_Trick"><code>my $x if 0;</code> Trick</a></H3>

</P>

<P>

This week's big big thread (81 messages) had the unfortunate title 'Is
perlbug broken', because Ben Tilly's original message to 
<CODE>perlbug</CODE>  bounced and he resent it with that new subject.  The subject 
<em>should</em> have been 'Improperly persistent lexicals'.
</P>

<P>
The original question concerned the following example:
</P>

<P>

<pre>        use strict;
        &amp;persistent_lex() foreach 1..5;
</P>

</P><PRE>
        sub persistent_lex {
            my @array = () if 0;
            push @array, "x";
            print @array, "\n";
        }
</pre></PRE>

<P>
Here the array behaves like a static variable, and is not created
afresh each time 
<CODE>persistent_lex</CODE> is called; it accumulates more and more 
<CODE>x</CODE>es each time.  A number of people said that this was a feature, and
that its behavior is obvious if you understand the implementation.
Several explanations were advanced, but most of them were wrong.
I think Nat Torkington got it right; earlier respondents didn't.
</P>

<P>
The obvious explanation is: 
<CODE>my</CODE> creates a lexical variable, and then at run time, initializes it each
 time the block is entered; the 
<CODE>if 0</CODE> suppresses the runtime initialization so that the  variable  retains
 its value.  To see why this is not a sufficient explanation, consider
 the following example, which creates two closures:
</P>

<P>

<pre>        use strict;
        my $a =  make_persistent_lex();
        $a-&gt;()  foreach 1..5;
        my $b =  make_persistent_lex();
        $b-&gt;()  foreach 1..5;
</P>

</P><PRE>
        sub make_persistent_lex {
            return sub {
              my @array if 0;
              push @array, "x";
              print @array, "\n";
            };
        }
</pre></PRE>

<P>
Here the variable 
<CODE>@array</CODE>is <em>shared</em> between the two closures.  If you omit the 
<CODE>if 0;</CODE> then 
<CODE>$a</CODE> and 
<CODE>$b</CODE> get separate variables.  
</P>

<P>
Nat Torkington did provide an explanation which I think is correct,
with Jan Dubois filling in some of the technical details.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00736.html">Jan's description of the guts.</a></P>

<P>

Some people suggested documenting this 'feature'.  Tom said that Larry
had told him not to do that because he didn't want to reply on
supporting it.  Larry affirmed this:
<blockquote><b>Jan Dubois:</b> I think this behavior is a side effect of the implementation and shouldn't be documented as a feature.  It should at best be "undefined" behavior  that may change in the future (IMHO).<p><b>Larry:</b> In Ada parlance, use of this feature would be considered erroneous. </blockquote> </P>

<P>

Simon Cozens said to me later that if p5p can't understand the
'feature', it should not be documented as a feature.  I think there's
some truth in that.   Barrie Slaymaker suggested that Perl issue a
warning in this case.  
</P>

<P>
The thread also contained a side discussion about whether or not 5.6.0
is stable and reliable.
<H3><a name="Zero_padded_numbers_in_formats">Zero-padded numbers in formats</a></H3>

</P>

<P>

John Peacock provided a patch that allows you to specify that numbers
displayed in formats can be zero-filled.
(Remember formats?  You print a formatted report
with the 
<CODE>write</CODE> function.) 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00664.html">Read about it.</a></P>

<P>

</P>

<P>
Tom asked why not use 
<CODE>sprintf</CODE>.  John replied that the patch to the 
<CODE>format</CODE> code is simple and that the 
<CODE>sprintf</CODE> solution requires a lot more Perl code than just using a zero-filled
format picture.
</P>

<P>
Matt Sergeant asked why formats hadn't been spun off into an external
module.  Damian Conway apparently has a paper on that.  Dan Sugalski
replied that they probably need some access to the lexer.  I suspect
that the real reason is that nobody really cared very much.  Dan did
add that formats need an overhaul:
<blockquote><b>Dan Sugalski:</b> Formats could certainly use an overhaul--a footer capability'd be nice, as  would the ability to use lexicals. Between that and a rewrite of BigInt and BigFloat for speed would allow you to grab an awful lot of the Cobol Cattle  Crowd...</blockquote> </P>

<P>

<H3><a name="Forbidden_Declarations">Forbidden Declarations</a></H3>

</P>

<P>
I pointed out that if you get the error 
</P>

</P><PRE>
        In string, @X::Y must now be written as \@X::Y...
</PRE>

<P>
you cannot fix it by declaring the array with 
<CODE>our</CODE> as the manual suggests, because there is an arbitrary restriction on 
<CODE>our</CODE>.  I supplied a patch to remove this, but I expect it will not go in,
because the arbitrary restriction was put there on purpose several
months ago. 
</P>

<P>
Tom replied that
</P>

</P><PRE>
        { package X; our @Y; }
</PRE>

<P>
will work.
</P>

<P>

<H3><a name="Port_to_WindowsCE">Port to Windows/CE</a></H3>

</P>

<P>
Jarkko Hietaniemi forwarded an article that Ned Konz had posted on 
<CODE>comp.lang.perl.moderated</CODE>, saying that he was working on a port of Perl to Windows/CE, which I gather
 is a version of Windows that runs on a palmtop.  Ned mentioned a
number of potential problems he foresaw. 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00556.html">Ned's Article</a></P>

<P>

Simon Cozens referred him to 'microperl', which he said had been
created with the intention of porting Perl to small operating systems.
<blockquote><b>Simon:</b> It does remove a lot of the Unixisms, plus it takes the size of the core down to the bare essentials. I'd start there. </blockquote> </P>

<P>

Nat Torkington mentioned in passing that a Windows/CE port would
probably go some way toward making a Palm Pilot port possible,
and Simon protested that he would probably have one ready `in a couple
of weeks'.  He says that the hardest problem was getting the lexer to
fit into the Palm's small code segments.
<H3><a name="chat2pl_is_Still_There"><code>chat2.pl</code> is Still There</a></H3>

</P>

<P>

Peter Scott mentioned 
<CODE>chat2.pl</CODE> in connection with something in the FAQ, and Randal Schwartz, the
original author, replied that it should probably never have been
included in the first place; he wrote it for a particular purpose back
in the mists of time, posted it to 
<CODE>comp.lang.perl</CODE> a couple of times in response to people who seemed to want to do
something similar, and Larry included it into the Perl 4 distribution
without asking him if it was OK.  Randal says that if he had been
planning to release it, he would have written it differently, and that
that's why it's never been really complete.  He also said he was glad
it had been dropped from the distribution.  Then he discovered that it 
<i>hadn't</i> been dropped, and seemed rather shocked.
</P>

<P>
Summary: Don't use 
<CODE>chat2.pl</CODE>.
<H3><a name="pod2latex"><code>pod2latex</code></a></H3>

</P>

<P>

Tim Jenness suggested replacing the old 
<CODE>pod2latex</CODE> with his new version based on
<CODE>POD::LaTeX</CODE>.  There was no discussion.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00560.html">Read about it.</a></P>

<P>

<H3><a name="Long_Regexes">Long Regexes</a></H3>

</P>

<P>
Michael Shields demonstrated a sample email message that made the 
<CODE>Mail::Header</CODE> module take an unusually long time to parse the header.  He then
supplied a patch, suggested by Ronald Kimball, that made the relevant
regex finish more quickly.  (Ronald's original suggestion wasn't quite
correct; he supplied a second alternative later.)
</P>

<P>
Mike Guy pointed out that even without the
patch the regex completed quickly  under 5.6.0, because the regex
optimizations are better.  However, Ilya says that this particular
optimization is buggy:  It only works under certain circumstances, and
he did not implement a check for those circumstances.  But he could
not make a test case where the optimization fails.  He asked for help
doing this.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00585.html">Ilya's request for a test case.</a></P>

<P>
Ben Tilly and Ilya had long and extremely interesting discussion of
next-character-peeking optimiztions that is required reading for
anyone who is interested in the guts of the regex engine or who might
someday want to be the Regex Engine Pumpking.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00582.html">The root of this discussion.</a></P>

<P>
There was a sidetrack:  John Macdonald suggested that there could  be
a standard module that would provide efficient, correct regexes for
common cases such as matching a string that contains balanced
parentheses.    Damian Conway pointed out that his 
<CODE>Text::Balanced</CODE> module does precisely this.
</P>

<P>

<H3><a name="UTF8_Hash_Keys">UTF8 Hash Keys</a></H3>

</P>

<P>
M.J.T. Guy asked what the intentions were regarding UTF8 hash keys.
Nick Ing-Simmons replied that he recalled that they would be enabled
per-hash, and that each hash would either have all UTF8 keys or no
UTF8 keys.  Andreas pointed out that there had been an extensive
discussion of this in the past.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/cgi-bin/w3glimpse/perl5-porters?query=hash+keys+utf8&errors=0&case=on&maxfiles=100&maxlines=30">Extensive Discussion</a><H3><a name="UTF8_String_Patches">UTF8 String Patches</a></H3>

</P>

<P>

Simon discovered that single-quoted strings were not having their
UTF8-ness handled properly, and provided a patch.  Short summary: The
SV has a UTF8 flag on it, and if you extract the C string part of the
UTF8 SV and make a new SV with the same string, you also have to set
the UTF8 flag on the new SV or Perl won't treat it the same.   Simon
also provided a patch to 
<CODE>perlguts</CODE> that discusses this.
<H3><a name="mktablespl_has_Been_Addressed"><code>mktables.pl</code> has Been Addressed</a></H3>

</P>

<P>

James Bence stepped up to answer Larry's request that 
<CODE>mktables.pl</CODE> be refurbished.
</P>

<P>

<a href="/pub/2000/05/p5pdigest/THISWEEK-20000507.html#mktablesPLNeeds_Work">Earlier Summary</a><H3><a name="More_Environmental_Problems">More Environmental Problems</a></H3>

</P>

<P>

Jonathan Leffler forwarded a problem that had come up on the DBI
mailing list relating to the way Perl uses the environment; if some
other library <em>also</em> tries to modify the environment, this messes up 
Perl and can cause core dumps.  Jonathan forwarded an archive of some
discussion of this same problem in 1997, and I remember it also came
up last November.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00589.html">Jonathan's message.</a></P>

<P>

<a href="/pub/1999/11/p5pdigest/THISWEEK-19991121.html#Wandering_Environment">Summary of November discussion.</a></P>

<P>

Several solutions of various types were proposed.
<H3><a name="readonly_Pragma"><code>readonly</code> Pragma</a></H3>

</P>

<P>

Mark Summerfield wants to make a pragma called 
<CODE>readonly</CODE> that declares a read-only scalar variable.  This is different from
 what 
<CODE>use constant</CODE> does because the 'constants' generated by 
<CODE>use constant</CODE> have a special syntax that  doesn't always work.  For example: 
</P>

</P><PRE>
        use constant PI => 3;
        $hash{PI} = 'pi';
</PRE>

<P>
The key here is 
<CODE>PI</CODE>, not 
<CODE>3</CODE>.  Several alternative suggestions were advanced; the nicer ones
seemed to be William Setzer's 
<CODE>Const</CODE> module which is a tiny XS that just sets the 
<CODE>READONLY</CODE> flag in the SV.   Unfortunately, it doesn't seem to be on CPAN.  Tom
 did post the entire code, which is only a couple of paragraphs long.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00777.html">Const.pm</a></P>

<P>

<H3><a name="Tutorials">Tutorials</a></H3>

</P>

<P>

Ken Rietz offered to write more tutorials or to coordinate the writing
of tutorials, and asked for suggestions.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00761.html">See the message if you want to make a suggestion.</a></P>

<P>

<H3><a name="Brad_Appleton_replies_to_my_remarks_about_Pod::Parser">Brad Appleton replies to my remarks about <code>Pod::Parser</code></a></H3>

</P>

<P>
Two weeks ago I posted a lot of stuff about Pod and the
Pod-translating software, and Brad Appleton, the author of 
<CODE>Pod::Parser</CODE>, felt that some of it was unfair, and also pointed out a number of
real errors that I made.  Brad has been kind enough to provide an
article correcting my mistakes.
</P>

<P>

<a href="/pub/2000/05/podparser.html">Brad's reply.</a><H3><a name="Various">Various</a></H3>

</P>

<P>

<pre>        p5p: B+++(--) F+ Q+++ A+++ F+ S+ J++ L+
</pre><!-- Thanks to John Porter for this extremely funny idea. --></P>

<P>

Until next week I remain, your humble and obedient servant,
</P>

<P>

</P>

<hr>

<a href="mailto:mjd-perl-thisweek-200005+@plover.com">Mark-Jason Dominus</a>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1676" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/05/podparser.html" rel="bookmark">Pod::Parser Notes</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Brad Appleton</span> on <abbr class="published" title="2000-05-20T00:00:00-08:00">May 20, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- <code>Pod::Parser</code> Notes -->

<br />
<br /><p>Some of my co-workers noticed the p5p weekly summary discussing
(among other things) <code>Pod::Parser</code>. They mentioned it to
me, and said they thought it cast me in an unfavorable light. So I'd
like to clear up a few things that may have been missing or
misunderstood from the summary....</p>

<p>I freely admit <code>Pod::Parser</code> has had very little
performance optimization optimization attempted. (I've mentioned this
before on p5p and pod-people and have asked for help).  I certainly
agree with many of the issues of POD format that Mark raised.  But I
think it is very important to note that most of the slowness of
<code>Pod::Parser</code> has less to do with POD format itself, and
more to do with the cost of creating an flexible & extensible O-O
framework to meet the needs of pod-parsing in general (not just tasks
specific to translating POD to another output format).</p>

<p>Most of the overhead in <code>Pod::Parser</code> is from parsing
line-by-line (to track line numbers and give better diagnostics) and
from providing numerous places in the processing pipeline for
callbacks and "hook" methods. Since <code>Pod::Parser</code> uses O-O
methods to provide lots of pre/post processing hooks at line and file
and command/sequence level granularity, the overhead from
method-lookup resolution is quite high. (In fact I'd lay odds that at
least a 10X performance speedup could be had optimizing away the
method lookups at run time to precompute them once at the
beginning.)</p>

<p>Regarding the "benchmark" of 185X as a prospective performance
target for podselect (which uses <code>Pod::Select</code> which uses
<code>Pod::Parser</code> :-), please realize that podselect's purpose
in life is to do a whole lot more than what Tom's lean-and-mean POD
dumper script does.  It so happens that podselect will do this same
task if given no arguments. But its <em>real</em> reason for existence is to
select specific sections of the PODs to be spit out based on matching
criteria specified by the user. This is what <code>Pod::Usage</code>
employs in order to format only the usage-msg-related sections of a
POD.</p>

<p>When I mentioned podselect in this thread on p5p, I was just
pointing out that existing code - which is already designed to have
hooks for reuse, can fulfill the same functional task - I didn't
intend to claim it was comparable in performance.  I don't think that
the "185X" figure is reasonable to achieve for
<code>Pod::Parser</code>. Not only is there imore parsing that
<code>Pod::Parser</code> has to do, but most of that overhead comes
from enabling better diagnostics and extensibility for purposes above
and beyond what Tom's script implements for one very specific and
limited purpose.</p>

<p>185X may be a fair benchmark for something whose purpose is limited
in scope to that particular thing, but I think not so for something
with much broader scope and applicability and use like
<code>Pod::Parser</code>. Not that speed improvement still isn't
needed - but I think a 50X improvement would a more reasonable
benchmark, and IMHO within the realm of what's reasonably
possible.</p>

<p>In another place - I think the summary may have missed a reply I
made to p5p about the structure of <code>Pod::Parser</code>
"output". Its not just spitting out tags or a linear stream, and it
will spit-out parse-trees <em>if</em> you ask it to.</p>

<p>I agree that there is a need for a module to impose more structure,
but the notion that <code>Pod::Parser</code> must somehow be the
module that does this is a misconception
IMHO. <code>Pod::Parser</code> was deliberately created to be a
flexible framework to build on top of and there is nothing to stop
someone from creating a module" on top of <code>Pod::Parser</code> to
do all the nicer stuff.</p>

<p>But much of that "nicer" stuff will break a lot of existing code if
its added into <code>Pod::Parser</code> - because
<code>Pod::Parser</code> is used for more than just translation to
another output format. I've recommended many times on p5p and
elsewhere that someone create a <code>Pod::Compiler</code> or
<code>Pod::Translator</code> to impose this added structure (and the
existing <code>Pod::Checker</code> module might be a good start).</p>

<p>Also, the summary suggests that <code>Pod::Parser</code> and Russ'
POD modules have been "under development for years."  I think maybe
Mark meant to write that various POD-related parsing and
translating/formatting modules have been under development for
years. In particular, I believe Russ only just started on his
"pod-lators" modules in the past year.</p>

<p><code>Pod::Parser</code> development started years earlier, but
it's "gestation period" was only about 6 months before a useful and
working version was available.  Since then, I've done bugfixes and
enhancements over the last 2-3 years.  The main addition of
significant functionality was adding the capability for parse-trees,
(and the development of a test-suite for pod "stuff", which was too
long in coming :-). It didn't become part of the core perl
distribution until v5.6 because it was necessary to wait until some
kind folks (like Russ') took the time to re-write the most common
<code>pod2xxx</code> modules to use the same base parsing code
provided in <code>Pod::Parser</code>.</p>

<p>Now - I'm not claiming <code>Pod::Parser</code> is perfect - but I
felt the summary left out some important points that add more balance
to the discussion.  Could <code>Pod::Parser</code> be faster? You
betcha! Could it be lots faster? Sure.  Is it unusable for its most
common purpose? Not at all IMHO. Is it unusable for processing large
numbers of PODs? Quite likely. But as I said, thats not because of
POD, thats because of the need for designed in flexibility.</p>

<p>At least now there is a common base of POD parsing code to focus our
collective optimizing efforts upon instead of lots of parsing engines
from disparate <code>pod2xxx</code> modules. Now that it's in the core, maybe it will
encourage more people to focus on optimizing the common base parser for
POD-stuff (which I've been wanting help with for years <tt>:-)</tt></p>

<pre>
-- 
Brad Appleton &lt;bradapp@enteract.com&gt;  <a href="http://www.bradapp.net/">http://www.bradapp.net/</a>
  "And miles to go before I sleep." -- Robert Frost
</pre>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1674" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/05/cobol.html" rel="bookmark">Perl Meets COBOL</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="2000-05-15T00:00:00-08:00">May 15, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- Perl Meets COBOL -->

<br />
<P>A few weeks ago I went to do a four-day beginning Perltraining at a local utility company.  It was quite different
from other training classes I'd given.  Typically, my
students have some Unix and C experience.  These students,
however, had never seen Unix before -- they were mostly COBOL
programmers, working in the MVS operating system for IBM
mainframe computers.</p>

<p>Fortunately, I have had some experience programming IBM
mainframes, so I wasn't completely unprepared for
this. When we contract classes, we always make sure that the
clients understand that the classes are for experienced
programmers.  In this case that backfired a little bit -- we
were asking the wrong question.  Almost all my students were
experienced programmers, but not in the way I expected.
After several years of teaching Perl classes, I have some
idea of what to expect, and the COBOL folks turned all my
expectations upside down.</p>

<p>For example, when I teach a programming class to
experienced programmers, I take for granted that everyone
understands the notion of block structure, in C or Pascal
perhaps.  People familiar with this idea look at the code
and see the blocks automatically.  But the COBOL folks had
not seen this before and had to learn it from scratch.
Several times I was showing an example program, and one of
the students would ask what part of the code was controlled
by a <code>while</code> clause.</p>

<p>This tended to put me into I-am-talking-to-novices mode,
and my automatic reaction was to slow down and explain every
little thing, such as what a variable is.  But this
response was inappropriate and incorrect, and I had to
consciously suppress it.  The COBOL programmers were
<em>not</em> novices; they were, as promised, experienced
programmers, and it would have been patronizing (and a
waste of time) to explain to them what a variable was; of
course they already know about variables.  In fact, they
often surprised me with the extent of their knowledge.  To
explain the <code>$|</code> variable, I started to talk
about I/O buffering, and suddenly I realized that everyone was
bored. "Do you already know about this?'' I asked.  Yes,
everyone was already familiar with buffering.  That was a
first for me; I've never had a class that knew about
buffering already.</p>

<p>I didn't have to explain filehandles; they already knew
about filehandles.  But they used jargon to talk about them
that wasn't the jargon I was familiar with.  "Oh,  you're
establishing addressibility on the file,'' someone said.
They seemed pleased at how easy it was in Perl to establish
addressibility on a file.</p>

<p>That reminded me of a story about the mainframe people
seeing Unix for the first time back in the 1970s. They
asked how you allocate a file on Unix.  Dennis Ritchie
explained that you didn't have to allocate a file, you just
create it, but they didn't get it.  Finally he showed them:</p>

<pre>
        cat &gt; file
</pre>

<p>and the mainframe people were astounded.  "You mean
that's <em>all</em>?''  This was a little  like that
sometimes.  They were impressed by things I had always taken
for granted, and underwhelmed by things that often impress C
programmers.</p> 

<p>Some things they picked up on much better than other programmers I
have taught.  As soon as I explained the pattern <code>/cat$/</code>, someone
pointed out that that 
if you read in a record from a file, the record shouldn't match 
the pattern even if it does appear to end with <code>cat</code>, because 
the record will have a newline character on the end, and thus will end with
<code>cat\n</code>, not <code>cat</code>.  I had to explain what <code>$</code>
really does:  It matches at the end of the string, or just
before the newline if the string ends with a newline.
I had never had to explain that before, because I had never met
anyone before who had picked up on that so fast.  Usually Perl programmers
remain blissfully unaware of this problem for years until someone
points it out to them.  At Perl conferences, when I explain
what <code>$</code> really does, about
half the audience is thunderstruck.</p>

<p>I'm not sure why it was that the COBOL folks realized so
quickly that there was something fishy about <code>$</code>.
But I have an idea: The IBM mainframe file model is totally
different from the Unix or NT model.  Instead of being a
stream of bytes, an IBM file is a sequence of fixed-size
records, and there is good OS support for reading a single
record.  Any program can instantly and efficiently retrieve
record #3497 from a file; doing this on a Unix system
requires toil.  On a mainframe, records aren't terminated
with <code>\n</code> or anything else; they're just records,
and when you ask the OS for a record, you get it, with no
<code>\n,</code> or additional cruft.  So to the COBOL
programmers the idea of variable-length,
<code>\n</code>-terminated records was new and strange, and
they must have been constantly aware of that ever-present,
irritating <code>\n</code>, the way you're aware of a stone
in your boot when you're hiking.  They couldn't forget about
it the way seasoned Unix programmers do, so they saw how it
sticks out of the explanation of <code>$</code> in a way
that a Unix programmer doesn't notice.  

<p>After I got back I talked to Clinton Pierce, who has a lot
more experience training COBOL programmers than I do.
Clinton says that his students also find the file-as-stream
notion strange and new:</p>

<blockquote> <p>Reading lines of text (records) and taking
time to parse them into fields seems redundant.  This
usually starts a long discussion about why Perl programs
bother to construct formatted text files -- only to have to
parse them apart again, instead of simply letting the
record-reading library routines parse things for you.
</p></blockquote>

<p>This is an interesting contrast to the Unix point of
view, which is that the OS needs to support record-oriented
I/O about as much as it needs to support trigonometric
functions -- that is, not at all.</p>

<p>The different file models led to some other surprises.
One of the exercises in the class asks the students to make
a copy of a file in which all the lines that begin with
<code>#</code> have an extra <code>#</code> inserted on the
front.  The sample solution looks like this:</p>

<code>
<pre>
        while (&lt;&gt;) {
          print '#' if substr($_, 0, 1) eq '#';
          print;
        }
</pre>
</code>

<p> The COBOL programmers found this bizarre.  One of them
asked if a beginner could reasonably be expected to come up
with something like that.  At first I wasn't sure, and then
I thought back and remembered that in the past, many
students <em>had</em> come up with that solution.  In fact,
I had taught some classes in which <em>every</em> student
decided to do it that way.  Then I thought some more and
realized that those were classes full of C programmers, and
that it was a very natural way to solve the problem -- if you
were already a C programmer.</p>

<p>Clinton points out that on the mainframe, there's an extra
step between linking an application and running it:  You
have to explicitly load it into memory.  The
edit-compile-run cycle on System/370 is a lot longer than
in the Unix world, partly because Unix has such a
lightweight process creation model.  Clinton says that the one
thing mainframe programmers find strangest is the way Perl
collapses the edit-compile-link-load-run-debug cycle down to
only two steps.</p> 

<p>Clinton also says that his students tend to have trouble
with inter-process communication, such as as backticks or
system().  I don't have enough experience to understand the
details here, but I can verify that it was hard to get the
point of this across to people who didn't have prior
experience in the Unix "tools" environment.   Opening a pipe
to a separate program doesn't make a lot of sense unless you
live in a world like Unix where you have a lot of useful
little programs lying around that you can open pipes to.  To
explain <em>piped open</em>, I had to concoct an example about a
data gathering program that writes its output directly to
the report generator program without using an intermediate
temporary file.  The students appreciated the benefit of
avoiding the temporary file, but the example really misses
the point, because it omits the entire Unix "tools"
philosophy.  But I was taken by surprise and wasn't prepared
to evangelize Unix to folks who had never seen a pipe
before.  However, Clinton does report that his COBOL
students take naturally to the idea of modules and of
loading some other program's functionality into your own as
a library routine.</p>

<p>It was an eye-opening experience, and it uncovered a lot
 of assumptions I didn't realize I had.  I hope I get to do
 it again sometime.  </p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1680" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/05/p5pdigest/THISWEEK-20000514.html" rel="bookmark">This Week on p5p 2000/05/14</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="2000-05-14T00:00:00-08:00">May 14, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            </P>

<P>


<!-- This week on perl5-porters (8-15 May 2000) -->

<br />
<br /><ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#Regex_Stress_Testing">Regex Stress Testing</a>
  <li><a href="#Another_Thread_Safing_Patch">Another Thread-Safing Patch</a>
  <li><a href="#Enormous_perldoc_discussion_winds_up">Enormous <code>perldoc</code> discussion winds up</a>
  <li><a href="#Build_patches_for_OS2">Build patches for OS/2</a>
  <li><a href="#Regex_Engine">Regex Engine</a>
  <li><a href="#Method_calls_on_unblessed_references">Method calls on unblessed references</a>
  <li><a href="#Version_Tuples_Broken?">Version Tuples Broken?</a>
  <li><a href="#Negative_Subscripts_for_Tied_Arrays">Negative Subscripts for Tied Arrays</a>
  <li><a href="#Upcoming_corrections">Upcoming corrections</a>
  <li><a href="#Various">Various</a>
</ul>

      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>mjd-perl-thisweek-YYYYMM@plover.com</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
</P>

<P>
It was tempting to just post `nothing happened this week'.  Lots of
small patches to fix various 5.6.0 misbehaviors, and reports of new
5.6.0 misbehaviors.  An unusual number of people who should have known
better posting requests for dumb trivial features.  Low traffic.  Few
big discussions.
<H3><a name="Regex_Stress_Testing">Regex Stress Testing</a></H3>

</P>

<P>

Jarkko Hietaniemi wrote a module called 
<CODE>Regex::PreSuf</CODE> which accepts a list of words and builds a regex that recognizes only
those words.  Mike Giroux suggested that the large regexes generated
by this module could be used to stress-test the regex engine.  (Avi
Finkel's 
<CODE>String::REPartition</CODE> module might be used similarly.)
</P>

<P>
Ilya said it would be better to add the trie code from 
<CODE>Regex::PreSuf</CODE> to the regex engine.  Jarkko replied that he would prefer to eat live
 rattlesnakes.
</P>

<P>

<H3><a name="Another_Thread_Safing_Patch">Another Thread-Safing Patch</a></H3>

</P>

<P>
Dan Sugalski sent a replacement for his patch that makes the 
<CODE>lock()</CODE> function thread-safe.  It also exposes 
<CODE>lock()</CODE> functionality to XS subroutines, and some other things.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00352.html">See the patch.</a></P>

<P>
Also in thread news: A user posted a message asking why threads
weren't fully supported, and Dan replied at some length.  (Summary:
Because it's hard.) 
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00382.html">Dan's reply.</a><blockquote><b>Marek Rouchal:</b> Bottom line: I'd be very happyabout fully working threads in Perl 5.6.1<p><b>Dan Sugalski:</b>You and me both. :) I wouldn't hold my breath.<p></blockquote> </P>

<P>

<H3><a name="Enormous_perldoc_discussion_winds_up">Enormous <code>perldoc</code> discussion winds up</a></H3>

</P>

<P>

As quickly as it arrived, last week's discussion of docmuentation
issues has ended.  The only discussion of note this week was a message
from Mark Fisher with a reference to a 1971 paper that compared
automatic indexing with manual indexing.  Would-be indexers should
probably take a look at this.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00387.html">Mark's message.</a></P>

<P>

<a href="http://cs-tr.cs.cornell.edu/Dienst/UI/2.0/Describe/ncstrl.cornell/TR71-115">Gerald Salton's paper.</a><H3><a name="Build_patches_for_OS2">Build patches for OS/2</a></H3>

</P>

<P>

Rocco Caputo made some changes to fix the build process on OS/2.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00357.html">Read about it.</a><H3><a name="Regex_Engine">Regex Engine</a></H3>

</P>

<P>

In the course of trying to investigate a bug in the regex engine, Hugo
van der Sanden critiqued the code style and comments.  This led to a
brief but interesting discussion about the code there.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00271.html">Original bug report</a></P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00362.html">Hugo's critique message</a><H3><a name="Method_calls_on_unblessed_references">Method calls on unblessed references</a></H3>

</P>

<P>

John Tobey submitted a patch to enable
</P>

</P><PRE>
        $r->method(arg, ...)
</PRE>

<P>
when 
<CODE>$r</CODE> is unblessed.  If I understand correctly, the method is looked up in
a package  named 
<CODE>HASH</CODE> or 
<CODE>ARRAY</CODE> or whatever.
</P>

<P>
Randal said that this had come up some years ago, and the consensus
was not to do it, since it would make erroneous method calls harder to
catch. 
</P>

<P>
I was not able to find this discussion.  John found a 1996 message
from Tim Bunce that referred to an even earlier discussion of this
same idea.  (Tim submitted a patch similar to John's.)  If anyone can
dig up a pointer to the original discussion, please let me know.
</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/9607/msg00750.html">Tim's really old message.</a><H3><a name="Version_Tuples_Broken?">Version Tuples Broken?</a></H3>

</P>

<P>

Ian Phillipps pointed out two problems with version tuples.   But Ilya
said that no, the problem was not with the tuples, but with the
results produced by the 
<CODE>unpack</CODE> and 
<CODE>print</CODE> functions when extracting the result.  Mike Guy then pointed out that
</P>

</P><PRE>
        (256.255.254 . 257.258.259) eq (256.255.254.257.258.259)
</PRE>

<P>
is 
<em>false</em>.</P>

<P>
Sarathy said that this is because 
<CODE>eq</CODE> is broken; it'll be fixed in 5.6.1.
<H3><a name="Negative_Subscripts_for_Tied_Arrays">Negative Subscripts for Tied Arrays</a></H3>

</P>

<P>

Michael Schwern complained that if you have a tied array, and you do
</P>

</P><PRE>
        $array[-1]
</PRE>

<P>
Perl does not call 
<CODE>$o->FETCH(-1)</CODE>, but rather instead it calls 
<CODE>$o->FETCHSIZE()</CODE> to find out how long the array is, say 80 elements, and then invokes 
<CODE>$o->FETCH(79)</CODE> to get the last element.  Nick Ing-Simmons, the author of the tied
 array implementation, said that
that was how it 
was supposed to work, and changing it will break existing code.
<H3><a name="Upcoming_corrections">Upcoming corrections</a></H3>

</P>

<P>

Brad Appleton, the author of the 
<CODE>Pod::Parser</CODE> module suite, felt that some of my comments from the previous report
were unfair.  In particular, he says that the current 
<CODE>Pod::Parser</CODE> implementation is incomplete, was designed for flexibility rather
 than speed, and he is sure that large speed gains could be easily
had. 
Brad is preparing a long and informative reply, which I
 expect to include in next week's report.
</P>

<P>

<H3><a name="Various">Various</a></H3>

</P>

<P>
A large collection of bug reports, bug fixes, non-bug reports,
questions, answers, and a small amaount of flamage and spam. 
</P>

<P>
Until next week I remain, your humble and obedient servant,
</P>

<P>

</P>

<P>

</P>

<P>

</P>

<P>

</P>

<hr>

<a href="mailto:mjd-perl-thisweek-200005+@plover.com">Mark-Jason Dominus</a>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1678" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/05/p5pdigest/THISWEEK-20000507.html" rel="bookmark">This Week on p5p 2000/05/07</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="2000-05-07T00:00:00-08:00">May  7, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- This week on perl5-porters (1-7 May 2000) -->

<ul>
  <li><a href="#Notes">Notes</a> </li>
  <li><a href="#Moderation_is_Imminent">Moderation is Imminent</a>
  <ul>
      <li><a href="#Simons_Guide_to_p5p">Simon's Guide to p5p</a> </li>
    </ul>
  </li>
  <li><a href="#Big_Discussion_of_perldoc_and_Indexing">Big Discussion of <code>perldoc</code> and Indexing</a>
  <ul>
      <li><a href="#X">X<></a> </li>
      <li><a href="#splitpod"><code>splitpod</code></a> </li>
      <li><a href="#Aliases">Aliases</a> </li>
      <li><a href="#perldoc_Wishlist"><code>perldoc</code> Wishlist</a> </li>
      <li><a href="#Toms_Plan">Tom's Plan</a> </li>
      <li><a href="#Editorial_Opinion_Section">Editorial Opinion Section</a> </li>
      <li><a href="#Mark_Fishers_man_Replacement">Mark Fisher's <code>man</code> 
        Replacement</a> </li>
      <li><a href="#Pod::Parser_Output_Model"><code>Pod::Parser</code> Output 
        Model</a> </li>
      <li><a href="#roffitall"><code>roffitall</code></a> </li>
    </ul>
  </li>
  <li><a href="#Patches_to_perlre">Patches to <code>perlre</code></a> </li>
  <li><a href="#mktablesPL_Needs_Work"><code>mktables.PL</code> Needs Work</a> 
  </li>
  <li><a href="#Jarkko_is_Still_Trying_to_Give_Away_the_Configure_Pumpkin">Jarkko 
    is Still Trying to Give Away the <code>Configure</code> Pumpkin</a> </li>
  <li><a href="#Pushing_into_Hashes">Pushing into Hashes</a> </li>
  <li><a href="#Damians_Assignment_Overloader">Damian's Assignment Overloader</a> 
  </li>
  <li><a href="#Various">Various</a> </li>
</ul>

<h3><a name="Notes" id="Notes">Notes</a></h3>

<p>You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></p>

<p> Please send corrections and additions to <code>mjd-perl-thisweek-YYYYMM@plover.com</code> 
  where <code>YYYYMM</code> is the current year and month. </p>
<h3><a name="Moderation_is_Imminent" id="Moderation_is_Imminent">Moderation is Imminent</a></h3>



<p>

As I mentioned a few weeks ago, Sarathy suggested a light-handed
moderation scheme back in March, in the wake of a number of gigantic
flame wars that resulted in the departure of several important people
from the list.
</p>

<p>
The discussion of Damian Conway's overloading module (see below)
sparked a return to this topic.</p>


<p>

This is very important, and you be sure to read Sarathy's actual
proposal for the details.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-04/msg00574.html">The proposal.</a></p>

<p>
<a href="/pub/2000/04/p5pdigest/THISWEEK-20000423.html#p5p_to_become_Refereed">Earlier summary</a>
</p>
<p> Sarathy said that last time he had mentioned it, he had received suggestions 
  that the following people be referees: </p>
<ul>
  <li> Nathan Torkington</li>
  <li> Kurt Starsinic</li>
  <li> Chip Salzenberg</li>
  <li> Mark-Jason Dominus</li>
  <li> Simon Cozens</li>
  <li> Damian Conway</li>
  <li> Russ Allbery</li>
</ul>


<p>
He then asked thse people if they wanted to be referees.  As far as I
know, only Simon and I have accepted so far.</p>


<p>
There was some discussion of the technical mechanics of the
refereeing, and it looks like it is going to happen.  </p>



<h4><a name="Simons_Guide_to_p5p" id="Simons_Guide_to_p5p">Simon's Guide to p5p</a></h4>



<p>
In the course of this, Simon posted a document he had written about
how to use p5p.</p>


<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00306.html">Simon's guide to p5p.</a></p>

<h3><a name="Big_Discussion_of_perldoc_and_Indexing" id="Big_Discussion_of_perldoc_and_Indexing">Big Discussion of <code>perldoc</code> and Indexing</a></h3>

<p>
Forty-eight percent of this week's 350 messages were related to 
<code>perldoc</code> in one way or another.
</p>

<p>
The discussion started when Johan Vromans suggested that 
<code>perldoc</code> be extended to do something reasonable with 
<code>perldoc -f foreach</code>, analogous to the way 
<code>perldoc -f print</code> is presently treated.  Sarathy agreed with this; Tom Christiansen
objected strenuously.  I 
think that the point of Tom's objection  was that it is very easy to just
grep the entire manual for the term you want to find, that even on
non-unix crippleware platforms, 
<code>grep</code> can be implemented as a one-line Perl program, and that people whould
be encouraged to understand their own power to search the manuals,
rathern than being encouraged to depend on a canned solution like 
<code>perldoc</code>.  I think there's something to be said for this, but Tom did not seem
to find much agreement among the other p5pers.
</p>

<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-04/msg01122.html">Root of the thread</a></p>

<p>
Several interesting topics developed from this.  First, Tom announced that
he had been writing a new manual page, 
<code>perlrtfm</code>, which would explain how the manual was organized and how to use it
effectively. 
</p>

<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00065.html">Draft version of perlrtfm. </a></p>

<p>
Ilya said that the mapping from keywords to manual sections should not
be hardwired into 
<code>perldoc</code>, but rather should be in an index file somewhere.  Nick Ing-Simmons
agreed, and I've believed this
for a long time.  
<code>grep</code> is very nice, and works well much of the time, but as almost any user
 of a web search engine can tell you, sometimes the document you're
 looking for doesn't happen to contain the keyword it should.  I went
 looking for an example of this and found one right away:  If you want
 to find the remainder after division, and grep for 
<code>remainder</code>, you do <em>not</em> locate the section in 
<code>perlop</code> about the modulus operator.  A well-constructed index would fix this.
</p>

<p>
Tom pointed out that to construct and maintain an index
would be a tremendous amount of labor.  
</p>

<p>
Ilya talked about the IBM-Book format documents for Perl on OS/2,
which has a command that does a full-text search on the documentation
and yields the best match.
</p>

<p>
Matthias Neeracher said that 'shuck', the Macintosh documentation browser,
made use of an index, and would work better if the index data were
better to begin with.
</p>

<p> The indexing project needs a champion and an army of volunteers. If you're 
  interested in applying for either position, drop me a note and I'll try to match 
  up interested parties. </p>
<h4><a name="X" id="X">X<></a></h4>

<p>

Pod has always documented an 
<code>X<></code> tag 'for indexing'.  But the documents never said how it worked or
 what the format of the contents should be, and it was never really used.
In 5.6, it appears exactly twice in the entire documentation set, and
the documentation for 
<code>X<></code> itself says only:
</p>

<pre>
         X&lt;index>        An index entry
</pre>

<p>
Tom said that if an index were contructed, it should use the 
<code>X<></code> tag to mark up the pods with index entries.  I pointed out that the
big downside of that is that if there are many 
<code>X<></code> tags, they render the pod text itself less readable.  But I don't
 think anyone advanced a better suggestion.  I sent some mail about
 possible semantics for 
<code>X<></code>, based on my (limited) indexing experience.  (Among other things, I
am writing a book about Perl in a Pod-like markup language and I am
using 
<code>X<></code> to indicate an index entry.
</p>

<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00033.html">Indexing notes.</a></p>

<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00083.html">More indexing notes.</a></p>

<p>
Tom also pointed out that 
</p>

<pre>
        =for index
</pre>

<p> could be used to indicate that the following chunk of text was a sequence 
  of index entries. </p>
<h4><a name="splitpod" id="splitpod"><code>splitpod</code></a></h4>

<p>
An entry in the software-nobody-knows-about category:  In the
Perl pod directory is a program called 
<code>splitpod</code> which will break a single pod file into multiple files.  For example, 
</p>

<pre>
        splitpod perlfunc.pod
</pre>

<p>
creates many pod files named 
<code>abs.pod</code>, 
<code>accept.pod</code>, ..., 
<code>y.pod</code>.  You can then 
<code>pod2man</code> these separately or whatever.
</p>


<h4><a name="Aliases" id="Aliases">Aliases</a></h4>

<p>
Ilya suggested that Pod support an alias directive to define a new
escape sequence that would be equivalent to some other escape
sequence.  For example:
</p>

<pre>
        =for macro B <= Y
</pre>

<p> makes <code>Y&lt;some text&gt;</code> synonymous with <code>B&lt;some text&gt;</code>. 
  That way you could use <code>Y</code> to indicate bold sans-serif text (for 
  example) but the standard translators such as <code>pod2text</code> would still 
  know to render it the same as <code>B<...></code>. </p>
<h4><a name="perldoc_Wishlist" id="perldoc_Wishlist"><code>perldoc</code> Wishlist</a></h4>


<p>

Ben Tilly posted a wishlist for Perl's documentation, including that
the output of 
<code>perldoc</code> should include the name of the file that it had found the
 documentation in.  This would help remind people that the
 documentation is actually in a file somewhere and is not available
 only from the 
<code>perldoc</code> magic genie.
</p>

<p> <a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00086.html">Ben's 
  other wishes</a></p>
<h4><a name="Toms_Plan" id="Toms_Plan">Tom's Plan</a></h4>

<p> While people were posting all sorts of ideas for enhancements to <code>perldoc</code>, 
  Tom Christiansen posted his own ideas about how to solve some of the deeper 
  underlying problems of Perl's documentation: </p>
<blockquote><p><b>Tom:</b> First, dramatically reorganize the documentation,more or less along the lines that Sarathy has alluded to:reference, tutorials, internals.</p> <p>Second, throw the wholeperldoc code out and start from scratch with a real design specthat does not psychotically deviate from its purpose.</p><p>Third, provide real tools for unrelated things, likeidentifying where Perl finds its standard module path.  Modulesneed tools.</p></blockquote>

<p>

He also showed a demonstration of some simpler tools that might replace
the large, bloated 
<code>perldoc</code>. 
</p>

<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00123.html">Here's the demo</a></p>

<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00210.html">Later demo</a></p>

<p>
Tom also pointed out later that unlike 
<code>perldoc</code>, these tools don't have to parse Pod except in a very simple and
rudimentary way.  Brad Appleton put in that the 
<code>Pod::Select</code>module would do the same sort of parsing, and Tom replied that it was
entirely useless for disgorging documentation, because it is between 
fifty and a hundred times slower than the naive approach, and nobody wants to use
a documentation program that takes ten seconds to cough up
the documentation.  
</p>

<p>
Brad says that 
<code>Pod::Parser</code> could be made faster, but I wonder if it can really be made faster
enough.  On one of my tests, Tom's little cheap script outperformed 
<code>Pod::Select</code> by a factor of <b>185</b>.  Brad also asked for help on this; people
 interested in speeding up 
<code>Pod::Parser</code> should contact him.
</p>

<p>
Brad also asked for help in extending the test suite for these
modules.
</p>

<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00035.html">Brad's call for assistance.</a></p>


<h4><a name="Editorial_Opinion_Section" id="Editorial_Opinion_Section">Editorial Opinion Section</a></h4>

<p>
Discussions like this last make me think there's something seriously
wrong with Pod.  It was designed as a simple, readable format.  But if
it takes that long to parse it fully, then the plan has failed,
because the parsing should not be so difficult.
</p>

<p>
The new batch of Pod translating modules that Brad Appleton and Russ
Allbery have been working on have been under development for <em>years</em>.
That shouldn't have happened.  And I don't think it's the fault of
Brad and Russ; I think it's that Pod itself is badly designed, and
turns out to be much harder to handle than it looks at first.  I've
tried on several occasions to write Pod and Pod-like translators, and
that's what I've found.
</p>

<p> Pod is very nice in some ways, but it has severe problems. The goal was to 
  have a documenation system that was easy for people to read, easy for people 
  to write, and easy for programs to handle and translate. It wins on the first 
  two; Pod is much easier to read or write than anything comparable. But for algorithmic 
  processing, it seems that there are two options: You can run quick and dirty 
  and ignore most of the details, or you can get everything right at the expense 
  of using a surprisingly large amount of code and running extremely slowly. </p>
<blockquote><p><b>Ben:</b> <code>perldoc</code> needs anoverhaul.</p> <p><b>Tom:</b> It shall be completely obliterated,replaced by a fa&ccedil;ade.</p> </blockquote>


<h4><a name="Mark_Fishers_man_Replacement" id="Mark_Fishers_man_Replacement">Mark Fisher's <code>man</code> Replacement</a></h4>

<p>
Mark Fisher announced that he had written a 
<code>man</code>-like tool for Perl.  Unfortunately, it is not available yet.
</p>

<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00205.html">Mark's announcement</a></p>

<p> Randal Schwartz suggested that whatever becomes of <code>perldoc</code>, that 
  <code>perl -man</code> invoke the documentation system. He points out that many 
  corporate IT folks get the <code>perl</code> binary installed correctly, and 
  omit all the support programs like <code>perldoc</code>. </p>
<h4><a name="Pod::Parser_Output_Model" id="Pod::Parser_Output_Model"><code>Pod::Parser</code> Output Model</a></h4>


<p>

Ton Hospel asked if 
<code>Pod::Parser</code> was doing all it needed to.  At present, it just parses up the pod at
 the lowselt level and gives you back a list of tags.  Then it is up
 to the translator program to decide what to do with them.  Ton asks
 if perhaps 
<code>Pod::Parser</code> should be more involved with policy.  For example, consider this:
</p>



<pre>
        =begin comment
     
        foo
</pre>

<pre>
        =head 1
</pre>

<pre>
        =end comment
</pre>

<p>

Everything between the 
<code>=begin comment</code> and 
<code>=end comment</code> directives is ignored.  Now consider this:
</p>

<pre>
        =begin comment
     
        foo
</pre>

<pre>
        =cut
</pre>

<pre>
        sub foo { ... }
</pre>

<pre>
        =head 1
</pre>

<pre>
        =end comment
</pre>

<p>
Does the 
<code>comment</code> section continue all the way to the 
<code>=end comment</code> directive, or does it stop at the 
<code>=cut</code> directive?
</p>

<p>
Ton suggests that 
<code>Pod::Parser</code> might generate a more abstract data tree representation of the
 document structure, and that the translators would work from that,
 instead of from the current lower-level representation, which is
 essentially a token stream.  That way different translators would not
 make different policy decisions about these sorts of issues.
</p>

<p> Larry said he had thought for some time that there should be a canonical Pod-to-XML 
  translator, and said that people kept agreeing to write one eventually. </p>
<h4><a name="roffitall" id="roffitall"><code>roffitall</code></a></h4>

<p>

A recent change to 
<code>Pod::Man</code> broke the 
<code>roffitall</code> program, which is another entry in the software-nobody-knows-about
category.  
<code>roffitall</code> lives in the 
<code>pod/</code> directory in the source tree, and when you run it, it 
 takes <em>all</em> the pods and turns them into one monster 1,400-page
 postscript file 
 with all the documentation in the world, including documentation for
 the standard modules, and a table of contents that it generated.
Did you know that?  I didn't.
</p>

<p> That is the end of the report on the gigantic multithread about <code>perldoc</code> 
  and related matters. </p>
<h3><a name="Patches_to_perlre" id="Patches_to_perlre">Patches to <code>perlre</code></a></h3>

<p>

Tom Christiansen submitted a major update to 
<code>perlre</code>. 
</p>

<p>
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-04/msg01128.html">The patch is here.</a></p>



<h3><a name="mktablesPLNeeds_Work" id="mktablesPLNeeds_Work"><code>mktables.PL</code> Needs Work</a></h3>

<p>

<code>unicode/lib/mktables.PL</code> is the program that generates the code-number-to-name mapping tables
 for unicode, so that you can say 
<code>\N{BLACK SMILING FACE}</code> and get the black smiling face character; it also generates the
 property lists so that you can say 
<code>\p{IsUpper}</code> to indicate any uppercase unicode character.    Larry identified a
 number of problems with this program that need to be addressed before
 5.6.1.  
</p>

<p>
Nobody replied, so if you're interested in helping, here's a chance to
be a hero.
</p>


<blockquote><b>Larry:</b> Anyway, anybody have any tuits thisweek?  I don't, and this really needs to get straightened outsoon.  Besides it's Perl hacking, not C hacking, and that'ssupposed to be fun. </blockquote>

<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00062.html">Read about it.</a></p>


<h3><a name="Jarkko_is_Still_Trying_to_Give_Away_the_Configure_Pumpkin" id="Jarkko_is_Still_Trying_to_Give_Away_the_Configure_Pumpkin">Jarkko is Still Trying to Give Away the <code>Configure</code> Pumpkin</a></h3>

<p>
Would you like become an Important Person?  Here's your opportunity.
</p>

<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00208.html">Jarkko provides some details about what is required.</a></p>


<h3><a name="Pushing_into_Hashes" id="Pushing_into_Hashes">Pushing into Hashes</a></h3>

<p>
Brett Denner suggested that 
</p>

<pre>
        push %hash, key => value, key2 => value2;
</pre>

<p>
be allowed. 
</p>

<p>
Response was generally negative.  Some points people brought up: There
is already an easy way to do that:
</p>

<pre>
        @hash{key1, key2} = (value1, value2)
</pre>

<p>
It creates an unfulfilled expectation that 
<code>pop</code>, 
<code>shift</code>, and 
<code>unshift</code> will also work on hashes.  It creates an unfulfilled expectation that 
</p>

<pre>
        %hash = (apple => 'red');
        push %hash, apple => 'green';
</pre>

<p>
will <em>not</em> overwrite 
<code>'red'</code>as in the array case.  Whatever meaning you want it to have is
easily provided by a subroutine:
</p>

<pre>
        sub hashpush(\%@) {
          my $hash = shift;
          while (@_) {
            my $key = shift;
            $hash->{$key} = shift;
          }
        }
</pre>

<p>
This has come up before, and Yitzchak Scott-Thoennes reminded us that
the outcome then was that
</p>

<pre>
        %hash = (%hash, key => value, ...);
</pre>

<p> should be optimized. Any volunteers? </p>
<h3><a name="Damians_Assignment_Overloader" id="Damians_Assignment_Overloader">Damian's Assignment Overloader</a></h3>

<p>

Damian Conway has a module that is supposed to provide a simple
interface to overloading assignment semantics, and in particular to
provide typed variables by preventing assignment of anything other
than a certain kind of object to a particular variable.  For example:
</p>

<pre>
        use Class::ifiedVars;
</pre>

<pre>
        classify $var => 'ClassName';
</pre>

<p>

Now if you try to assign a value to 
<code>$var</code> that is not an object of type 
<code>ClassName</code> or one of its subclasses, you get a run-time error.
</p>

<p>
There are a lot of other features also.  Damian plans to change the
name to something less abnormal.
<!-- fucked-up --></p>

<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-05/msg00272.html">Details here.</a></p>

<p>
Ilya asked how this was different from the 
<code>PREPARE</code> method of 
</p>

<pre>
        my Dog $snoopy;
</pre>

<p>
Damian replied that it was orthogonal to it.  For example:
</p>

<pre>
        my Dog $snoopy;
        $snoopy = Alligator->new();
        $snoopy->pat();      # Invokes Alligator::pat
        $snoopy->{age}++;    # Might update the wrong field
</pre>

<p>
Someone asked where 
<code>PREPARE</code> was documented.  Ilya replied that due to a bug in 5.6.0, it was
unimplemented.  
</p>

<p>

<a href="/pub/1999/12/p5pdigest/THISWEEK-19991226.html#Another_return_of_PREPARE">Previous discussion of <code>PREPARE</code>.</a></p>

<p> Damian and Ilya got into an extended exchange about whether or not the module 
  was a good idea. This resulted in Peter Scott asking when the refereeing would 
  be put in place. </p>
<h3><a name="Various" id="Various">Various</a></h3>

<p>

A large collection of bug reports, bug fixes, non-bug reports,
questions, answers, and a small amaount of flamage and spam. 
</p>

<p>
Until next week I remain, your humble and obedient servant,
</p>



<hr />
<a href="mailto:mjd-perl-thisweek-200005+@plover.com">Mark-Jason Dominus</a> 

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1664" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2000/04/raceinfo.html" rel="bookmark">Program Repair Shop and Red Flags</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="2000-05-02T00:00:00-08:00">May  2, 2000 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- <A NAME="What_s_wrong_with_this_picture_">What's wrong with this picture?</A> -->

<br />
<!-- INDEX BEGIN -->
<UL>

 <LI><A HREF="#What_s_wrong_with_this_picture_">What's wrong with this picture?</A>
 <UL>

  <LI><A HREF="#Reading_the_Input">Reading the Input</A>
  <LI><A HREF="#Computing_Average_and_Total_Time">Computing Average and Total Times</A>
  <LI><A HREF="#Sort_Order">Sort Order</A>
  <LI><A HREF="#Printing_the_Report">Printing the Report</A>
 </UL>

 <LI><A HREF="#Red_Flags">Red Flags</A>
 <UL>

  <LI><A HREF="#Get_Rid_of_Array_Size_Variables">Get Rid of Array Size Variables</A>
  <LI><A HREF="#Use_Compound_Data_Structures_Ins">Use Compound Data Structures Instead of Variable Families</A>
  <LI><A HREF="#Use_C_foreach_to_Loop_Over_Arra">Use <code>foreach</code> to Loop Over Arrays</A>
 </UL>

</UL>
<!-- INDEX END -->

<P>
Someone recently asked me to take a look at his report-generating program
because he wasn't able to get the final report sorted the way he wanted.

<P>
The program turned out to require only a minor change to get the report in
order, but it also turned out to be a trove of common mistakes--which is
wonderful, because I can use one program to show how to identify and fix
all the common mistakes at once!

<P>
First I'll show the program, and then I'll show how to make it better.
Here's the original. (Note: Lines of code may be broken for display purposes.)

<P>
<PRE>
     1  #!/usr/bin/perl
     2  use Getopt::Std;
     3  getopt('dV');
     4  $xferlog=&quot;./xferlog&quot;;
     5  $\ = &quot;\n&quot;;
     6  $i=0;
     7  open XFERLOG, $xferlog or die &quot;Cant't find file $xferlog&quot;;
     8  
     9  foreach $line (&lt;XFERLOG&gt;) {
    10        chomp($line);
    11        if (( $line =~ /$opt_d/i) &amp;&amp; ( $line !~ /_ o r/)) 
    12           {
    13           ($Fld1,$Fld2,$Fld3,$Fld4,$Fld5,$Fld6,$Fld7,$Fld8,
               $Fld9,$Fld10,$Fld11,$Fld12,$Fld13,$Fld14,$Fld15) = split(' ',$line);
 
    14            $uplist[$i] = join ' ',$Fld6, $Fld8, $Fld9, $Fld14, $Fld15;
    15            $time[$i]=$Fld6; $size[$i]=$Fld8; $file[$i]=$Fld9; 
               $user[$i]=$Fld14; $group[$i]=$Fld15;
      
    16            $username= join '@', $user[$i], $group[$i];
    17            push @{$table{$username}}, $uplist[$i];
    18            $i++;     
    19      }
    20  }
    21  close XFERLOG;
    22  
    23  undef %saw;
    24  # @newuser = grep(!$saw{$_}++, @user);
    25  $j=0;
    26  foreach  $username ( sort keys %table )
    27          {
    28          my @mylist = @{$table{$username}};
    29          $m=0;
    30          $totalsize=0;
    31          $totaltime=0;
    32          $gtotal=0;
    33          $x=0;
    34          $x=@mylist;
    35          for ($m = 0 ; $m &lt; ($x); $m++)
    36          {
    37                  ( $seconds, $size, $file, $user, $group) = split(' ', $mylist[$m]);
    38                  $totaltime = ($totaltime + $seconds);
    39                  $totalsize = ($totalsize + $size);
    40          }
    41          if ($totaltime==0) { $totaltime=1; }
    42          if ($totalsize==0) { $totalsize=1; }
    43          $avgtr = (($totalsize/$totaltime)/1024);
    44          $gtotal=($totalsize+$gtotal);
    45          $finale[$j]= join ' ', ($totalsize/(1024*1024)), $username, ($x), $totaltime, $avgtr;
    46  #       print $finale[$j];
    47          $j++;
    48  }
    49  @realfinal =  sort @finale;
    50  #print @finale;
    51  $p=0;
    52  $w=0;
    53  $w=@realfinal;
    54  #print $w;
    55  for ($p=($w-1) ; $p&gt;=0; $p--)
    56  {
    57          ($Size, $User, $Files, $Time, $AvgSpeed)= split &quot; &quot;, $realfinal[$p];
    58          $position= ($w-$p);
    59          $percent=(($Size/($gtotal/(1024*1024)))*100);
    60          printf (&quot;$position. $User $Files files &quot;);
    61          printf(&quot;%.2fMB&quot;, $Size) ;
    62          printf &quot; $Time(s) &quot;;
    63          printf (&quot;%.2f% &quot;, $percent);
    64          printf(&quot;%.2fK/s&quot;, $AvgSpeed);
    65          print &quot; &quot;;
    66  }
    67          
</PRE>
<P>
Let's start at the top, with the argument and file handling.

<P>
<PRE>     1  #!/usr/bin/perl
     2  use Getopt::Std;
     3  getopt('dV');
     4  $xferlog=&quot;./xferlog&quot;;
     5  $\ = &quot;\n&quot;;
     6  $i=0;
     7  open XFERLOG, $xferlog or die &quot;Cant't find file $xferlog&quot;;
     8  
     9  foreach $line (&lt;XFERLOG&gt;) {
        ...
    20  }
    21  close XFERLOG;
</PRE>
<P>
The name of the input file is hardwired on line 4. Getting the filename
from the command line is more flexible. We can leave the old filename in
place as a default, retaining compatibility with the original version. I've
also added error handling to the <CODE>getopt</CODE>
argument parsing.

<P>
<PRE> 
       getopt('dV') or die &quot;Usage: $0 [-d] [-V] [filename]\n&quot;;
        @ARGV = ('./xferlog') unless @ARGV;
        while (&lt;&gt;) {
          ...
        }
</PRE>        

<CODE>getopt</CODE> removes the options from
<CODE>@ARGV</CODE>, leaving only the filenames,
if any.  If there weren't any, we put the default filename,
<CODE>/.xferlog</CODE>, into <CODE>@ARGV</CODE> as if the user 
had supplied it themselves.
Since the <code>&lt;&gt;</CODE> operator reads from the files named in 
<CODE>@ARGV</CODE>, it
will read from <CODE>./xferlog</CODE> if no file was specified on the command
line.  Using <CODE>&lt;&gt;</CODE> handles <CODE>open</CODE> errors for us automatically,
and we can omit the <CODE>close</CODE> call because it's already taken care of
for us.  
<P>
Line 5 is superfluous, because <CODE>$\</CODE> already defaults to <CODE>"\n"</CODE>. Line 6 is
superfluous, since <CODE>$i</CODE> would be implicitly initialized to 0,
but it won't matter because we're going to get rid of <CODE>$i</CODE>
anyway.

<P>
I replaced the <CODE>foreach</CODE> loop with a <CODE>while</CODE> loop. The <CODE>foreach</CODE>
loaded the entire file into memory at once, then iterated over the list of
lines.  <CODE>while</CODE> reads one line at a time into <CODE>$_</CODE>, discarding each line after it has been examined. If the input file is
large, this will save a huge amount of memory. If available memory is
small, the original program might have run very slowly because of thrashing
problems; the new program is unlikely to have the same trouble, and might
run many times faster as a result.

<P>
<HR>
<!-- <A NAME="Reading_the_Input">Reading the Input</A> -->
<P>
<PRE>
     9  foreach $line (&lt;XFERLOG&gt;) {
    10        chomp($line);
    11        if (( $line =~ /$opt_d/i) &amp;&amp; ( $line !~ /_ o r/)) 
    12           {
    13           ($Fld1,$Fld2,$Fld3,$Fld4,$Fld5,$Fld6,$Fld7,$Fld8,
               $Fld9,$Fld10,$Fld11,$Fld12,$Fld13,$Fld14,$Fld15) = split(' ',$line);
      
    14            $uplist[$i] = join ' ',$Fld6, $Fld8, $Fld9, $Fld14, $Fld15;
    15            $time[$i]=$Fld6; $size[$i]=$Fld8; $file[$i]=$Fld9; 
               $user[$i]=$Fld14; $group[$i]=$Fld15;
      
    16            $username= join '@', $user[$i], $group[$i];
    17            push @{$table{$username}}, $uplist[$i];
    18            $i++;     
    19      }
    20  }
</PRE>
<P>
Here's my replacement:

<P>
<PRE>        while (&lt;&gt;) {
          chomp;
          if (/$opt_d/oi &amp;&amp;  ! /_ o r/) {
            my @Fld = split;
            my $uplist = {time =&gt; $Fld[5],      size =&gt; $Fld[7],
                          file =&gt; $Fld[8],      user =&gt; $Fld[13],
                          group =&gt; $Fld[14],
                         };
            my $username = &quot;$Fld[13]\@$Fld[14]&quot;;
            push @{$table{$username}}, $uplist;
          }
        }
</PRE>
<P>
Because the current line is in <CODE>$_</CODE> now instead of <CODE>$line</CODE>, we can
use the argumentless versions of <CODE>chomp</CODE> and <CODE>split</CODE> and the unbound version of the pattern match operators, which apply to
<CODE>$_</CODE> by default. I added the <CODE>/o</CODE> option on the first pattern match to tell Perl that <CODE>$opt_d</CODE>
will not change over the lifetime of the program.

<P>
Any time you have a series of variables named <code>$Fld1</code>, <code>$Fld2</code>, etc., it means
you made a mistake, because they should have been in an array. I've
replaced the <code>$Fld1</code>, <code>$Fld2</code>, ... family with a single array, <code>@Fld</code>.

<P>
<CODE>$uplist</CODE> was a problem before. It's a large string continaing
several fields. Later on, the program would have had to split this string
to get at the various fields; this is a waste of time because we have the
fields already split up right here and there's no point in joining them
just to split them up again later. Instead of turning the relevant fields
into a string, I've put them into an anonymous hash, indexed by key, so
that the filename is in $uplist-&gt;{file} instead of the third section of
a whitespace separated string.

<P>
This way of doing things is not only faster, it's more robust. If the input
file format changes so that a filename might contain space characters, we
only need to change the initial <CODE>split</CODE> that parses the input data itself. The original version of the program
would have needed to have the <CODE>join</CODE> changed also, as well as the later <CODE>split</CODE>
the re-separated the data. Storing the fields in a hash eliminates this
problem entirely.

<P>
I also eliminated the superfluous <code>@time</code>, 
<code>@size</code>, <code>@user</code>, <code>@group</code>, and
<CODE>@uplist</CODE> arrays. They were never used. Packaging all the
relevant data into a single hash obviates any possible use of these arrays
anyway. Because all the arrays have gone away, we no longer need the index
variable <code>$i</code>. Such a variable, which exists only to allow data to be added
to the end of an array, is rarely needed in Perl. It is almost always
preferable to use <CODE>push</CODE>. The <CODE>push</CODE> line itself is essentially the same.

<P>
<HR>
<!-- <A NAME="Computing_Average_and_Total_Time">Computing Average and Total Times</A> -->
<P>
This next section is way too long:

<P>
<PRE>
    23  undef %saw;
    24  # @newuser = grep(!$saw{$_}++, @user);
    25  $j=0;
    26  foreach  $username ( sort keys %table )
    27          {
    28          my @mylist = @{$table{$username}};
    29          $m=0;
    30          $totalsize=0;
    31          $totaltime=0;
    32          $gtotal=0;
    33          $x=0;
    34          $x=@mylist;
    35          for ($m = 0 ; $m &lt; ($x); $m++)
    36          {
    37                  ( $seconds, $size, $file, $user, $group) = split(' ', $mylist[$m]);
    38                  $totaltime = ($totaltime + $seconds);
    39                  $totalsize = ($totalsize + $size);
    40          }
    41          if ($totaltime==0) { $totaltime=1; }
    42          if ($totalsize==0) { $totalsize=1; }
    43          $avgtr = (($totalsize/$totaltime)/1024);
    44          $gtotal=($totalsize+$gtotal);
    45          $finale[$j]= join ' ', ($totalsize/(1024*1024)), $username, ($x), $totaltime, $avgtr;
    46  #       print $finale[$j];
    47          $j++;
    48  }
</PRE>
<P>
26 lines is too much for one block. A 26-line block should be rewritten if
possible, and if not, its guts should be scooped out and made into a
subroutine.

<P>
We can reduce this to about fifteen lines, so I won't use a subroutine
here. A lot of that reduction is simply elimination of unnecessary code. We
can scrap lines 23 and 24, which are never used. Line 25 is an unnecessary
initialization of <CODE>$j</CODE> whose only purpose is to track the length
of the <CODE>@finale</CODE> array; we can eliminate <code>$j</code>
entirely by changing this:

<P>
<PRE>    45          $finale[$j]= join ' ', ($totalsize/(1024*1024)), $username, ($x), $totaltime, $avgtr;
    46  #       print $finale[$j];
    47          $j++;
</PRE>
<P>
to say this instead:

<P>
<PRE>        push @finale, join ' ', ($totalsize/(1024*1024)), $username, ($x), $totaltime, $avgtr;
        # print $finale[-1];
</PRE>
<P>
Now let's work on that inner loop:

<P>
<PRE>    35          for ($m = 0 ; $m &lt; ($x); $m++)
    36          {
    37                  ( $seconds, $size, $file, $user, $group) = split(' ', $mylist[$m]);
    38                  $totaltime = ($totaltime + $seconds);
    39                  $totalsize = ($totalsize + $size);
    40          }
</PRE>
<P>
Any time you have a C-like <CODE>for</CODE> loop that loops over the indices of an array, you're probably making a
mistake. Perl has a <CODE>foreach</CODE>
construction that iterates over an array in a much simpler way:

<P>
<PRE>        for $item (@{$table{$username}}) {
          $totaltime += $item-&gt;{time};
          $totalsize += $item-&gt;{size};
        }
</PRE>
<P>
Here we reap the benefit of the anonymous hash introduced above. To get the
time and size we need only extract the hash values <CODE>time</CODE> and
<CODE>size</CODE>. In the original code, we had to do another <CODE>split</CODE>.

<P>
This allows us to eliminate the superfluous variables <code>$m</code>, <CODE>$x</CODE>
and <code>@mylist</code>, so we can remove lines 28, 29, 33, and 34. We've also used the
<code>+=</code> operator here to save extra mentions of the variable names on the
right-hand side of the <code>=</code>.

<P>
The modified code now looks like:

<P>
<PRE>
        foreach  $username ( sort keys %table ) {
          $totalsize=0;
          $totaltime=0;
          $gtotal=0;
          for $item (@{$table{$username}}) {
            $totaltime += $item-&gt;{time};
            $totalsize += $item-&gt;{size};
          }
          if ($totaltime==0) { $totaltime=1; }
          if ($totalsize==0) { $totalsize=1; }
          $avgtr = (($totalsize/$totaltime)/1024);
          $gtotal=($totalsize+$gtotal);

          push @finale, join ' ', ($totalsize/(1024*1024)), $username, ($x), $totaltime, $avgtr;
          #     print $finale[-1];
        }
</PRE>
<P>
This is already only half as large. But we can make it smaller and cleaner
yet. <CODE>$totalsize</CODE> and <CODE>$totaltime</CODE> are related, so
they should go on the same line. <CODE>$gtotal</CODE> is incorrectly set to
0 here. It is a grand total size of all the files downloaded, and any
initialization of it should be <EM>outside</EM> the loop. The check for <CODE>$totaltime==0</CODE>
is to prevent a divide-by-zero error in the computation of <code>$avgtr</code>, but no
such computation is performed for <code>$totalsize</code>, so the corresponding check is
wasted and should be eliminated:

<P>
<PRE>
        my  $gtotal=0;

        foreach  $username ( sort keys %table ) {
          my ($totalsize, $totaltime) = (0, 0);
          for $item (@{$table{$username}}) {
            $totaltime += $item-&gt;{time};
            $totalsize += $item-&gt;{size};
          }
          if ($totaltime==0) { $totaltime=1; }
          $avgtr = ($totalsize/$totaltime)/1024;
          $gtotal += $totalsize;
          push @finale, join ' ', ($totalsize/(1024*1024)), $username, ($x), $totaltime, $avgtr;
          #     print $finale[-1];
        }
</PRE>
<P>
For the computation of <code>$avgtr</code>, we can do better. The previous line has a
special case for when <CODE>$totaltime</CODE> is zero and the average is
undefined. In this case, <CODE>$avgtr</CODE> is set to an arbitrary and
bizarre value; if we sort by <CODE>$avgtr</CODE> later, these arbitrary
values will appear scattered throughout the rest of the data. It's better
to handle this exceptional condition explicitly, by replacing

<P>
<PRE>
          if ($totaltime==0) { $totaltime=1; }
          $avgtr = ($totalsize/$totaltime)/1024;
</PRE>
<P>
with

<P>
<PRE>
          if ($totaltime==0) { $avgtr = '---' }
          else { $avgtr = ($totalsize/$totaltime)/1024 }
</PRE>
<P>
Finally, the <CODE>join</CODE> here is committing the same error as the one we eliminated before. There's
no point in <CODE>join</CODE>ing when we're just going to have to <CODE>split</CODE> it again later anyway; the data are separate now so we might as well keep
them separate. The solution is similar; instead of joining the five data
items into a string, we parcel them into an anonymous hash so that we can
extract them by name when we need to. The final version of the loop looks
like this:

<P>
<PRE>
        foreach  $username ( sort keys %table ) {
          my ($totalsize, $totaltime) = (0, 0);
          for $item (@{$table{$username}}) {
            $totaltime += $item-&gt;{time};
            $totalsize += $item-&gt;{size};
          }

          if ($totaltime==0) { $avgtr = '---' } 
          else { $avgtr = ($totalsize/$totaltime)/1024 }
          $gtotal += $totalsize;

          push @finale, {size =&gt; $totalsize/(1024*1024),
                         username =&gt; $username, 
                         num_items =&gt; scalar @{$table{$username}}, 
                         totaltime =&gt; $totaltime,
                         avgtr =&gt; $avgtr,
                        };
          #     print $finale[-1];
        }
</PRE>
<P>
<HR>
<H2><A NAME="Sort_Order">Sort Order</A></H2>
<P>
Line 49 is the one that I was originally asked to change:

<P>
<PRE>    49  @realfinal =  sort @finale;
</PRE>
<P>
Now that <CODE>@finale</CODE> contains structured records, the change is
straightforward:

<P>
<PRE>        @realfinal = sort {$a-&gt;{size} &lt;=&gt; $b-&gt;{size}} @finale;
</PRE>
<P>
If you want to sort the final report by username instead, it's equally
straightforward: <CODE>@realfinal = sort {$a-&gt;{username}
cmp $b-&gt;{username}} @finale;</code>

<P>
<HR>
<H2><A NAME="Printing_the_Report">Printing the Report</A></H2>
<P>
Now we're into the home stretch:

<P>
<PRE>
    51  $p=0;
    52  $w=0;
    53  $w=@realfinal;
    54  #print $w;
    55  for ($p=($w-1) ; $p&gt;=0; $p--)
    56  {
    57          ($Size, $User, $Files, $Time, $AvgSpeed)= split &quot; &quot;, $realfinal[$p];
    58          $position= ($w-$p);
    59          $percent=(($Size/($gtotal/(1024*1024)))*100);
    60          printf (&quot;$position. $User $Files files &quot;);
    61          printf(&quot;%.2fMB&quot;, $Size) ;
    62          printf &quot; $Time(s) &quot;;
    63          printf (&quot;%.2f% &quot;, $percent);
    64          printf(&quot;%.2fK/s&quot;, $AvgSpeed);
    65          print &quot; &quot;;
    66  }
    67          
</PRE>
<P>
Here we have another C-style <CODE>for</CODE> loop that should be replaced by a simple <CODE>foreach</CODE> loop; this allows us to eliminate <CODE>$p</CODE> and <code>$w</code>. We can loop over
the reversed list if we want, or simply adjust the <CODE>sort</CODE> line above so that the items are sorted into the right (reversed) order to
begin with, which is probably better.

<P>
The percentage here is the only place in the program that we use <code>$gtotal</code>,
which needs to be converted to megabytes to match the <CODE>size</CODE>
fields in <code>@realfinal</code>. We may as well do this conversion up front. Making
these changes, and eliminating the <CODE>split</CODE> because the <CODE>@realfinal</CODE> data is structured, yields:

<P>
<PRE>
        $gtotal /= (1024*1024);  # In megabytes
        #print @finale;
        my $position = 1;
        for $user (@realfinal) {
                printf (&quot;$position. $user-&gt;{username} $user-&gt;{num_items} files &quot;);
                printf(&quot;%.2fMB&quot;, $user-&gt;{size}) ;
                printf &quot; $user-&gt;{totaltime}(s) &quot;;
                printf (&quot;%.2f% &quot;, ($user-&gt;{size}/$gtotal)*100); # percentage
                printf(&quot;%.2fK/s&quot;, $user-&gt;{avgtr});
                print &quot;\n&quot;;
                ++$position;
        }
</PRE>
<P>
It's probably a little cleaner to merge the many <CODE>printf</CODE>s into a single print;
another upside of this is that it's easier to see
what the format of the output will be:

<P>
<PRE>
        $gtotal /= (1024*1024);  # In megabytes
        #print @finale;
        my $position = 1;
        for $user (@realfinal) {
          printf (&quot;%d. %s %s files %.2fMB %.2f%% %.2fK/s\n&quot; , 
            $position, $user-&gt;{username}, $user-&gt;{num_items}        
            $user-&gt;{size}, ($user-&gt;{size}/$gtotal)*100, $user-&gt;{avgtr}
          );
          ++$position;
        }
</PRE>
<P>
That's enough. The new program is 33 lines long, not counting comments,
blank lines, and lines that have only a close brace. The original program
was 51 lines, so we've reduced the length of the program by more than
one-third. The original program had 41 scalar variables, 8 arrays, and 2
hashes, for a total of 51 named variables. The new program has 11 scalars,
3 arrays, and 1 hash, for a total of 14; we have eliminated more than
two-thirds of the variables. 15 of these were the silly <CODE>$Fld3</CODE>
variables, and another 22 weren't.

<P>
<HR>
<H1><A NAME="Red_Flags">Red Flags</A></H1>
<P>
A red flag is a warning sign that something is wrong. When you see a red
flag, you should immediately consider whether you have an opportunity to
make the code cleaner. I liked this program because it raised many red
flags:

<P>
<HR>
<H2><A NAME="Get_Rid_of_Array_Size_Variables">Get Rid of Array Size Variables</A></H2>
<P>
A variable whose only purpose is to track the number of items in an array
is a red flag; it should usually be eliminated. For example:

<P>
<PRE>
        while (...) {
          $array[$n] = SOMETHING;
          ++$n;
        }
</PRE>
<P>
should be replaced with

<P>
<PRE>
        while (...) {
          push @array, SOMETHING;
        }
</PRE>
<P>
eliminating <code>$n</code>.  

<P>
Notice that although the <CODE>$position</CODE> variable in the final
version of the program looks like it might be an index variable, it
actually serves a more important purpose than that: It appears in the final
output as a ranking.

<P>
<HR>
<H2><A NAME="Use_Compound_Data_Structures_Ins">Use Compound Data Structures Instead of Variable Families</A></H2>
<P>
A series of variables named <code>$f1</code>, <code>$f2</code>, etc., should always be replaced with
an array. For example:

<P>
<PRE>    ($Fld1,$Fld2,$Fld3,$Fld4,$Fld5,$Fld6) = split(' ',$line);
</PRE>
<P>
should be replaced with

<P>
<PRE>
    @Fld = split(' ',$line);
</PRE>
<P>
A similar statement can be made about hashes. If you have <CODE>$user_name</code>,
<code>$user_weight</code>, and <code>$user_login_date</code>, consider using one structure called
<CODE>%user</CODE> with keys <CODE>name</CODE>, <CODE>weight</CODE>, and <CODE>login_date</CODE>.

<P>
<HR>
<H2><A NAME="Use_C_foreach_to_Loop_Over_Arra">Use <code>foreach</code> to Loop Over Arrays</A></H2>
<P>
C-style <CODE>for</CODE> loops should be avoided. In particular,

<P>
<PRE>
        for ($i=0; $i &lt; @array; $i++) {
          SOMETHING($array[$i]);
        }
</PRE>
<P>
should be replaced with 

<P>
<PRE>
        foreach $item (@array) {
          SOMETHING($item);
        }
</PRE>
</BODY>

</HTML>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2000/04/">&laquo; April 2000</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2000/06/">June 2000 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
