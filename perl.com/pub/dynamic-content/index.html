<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.02" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
    <title>Perl.com: Dynamic Content Archives</title>


</head>
<body id="perl-com" class="mt-archive-listing mt-category-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <div id="top_advert"> 
<!-- Put any landscape advert in here -->
<a href="http://www.perlfoundation.org/" target="_new">
<img src="/i/tpf_banner.png" width="468" height="60" /></a>
        </div> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description"></div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">

                            
                            <h1 id="page-title" class="archive-title">Recently in <em>Dynamic Content</em> Category</h1>






                            
                            <div id="entry-848" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/11/bricolage-analysis.html" rel="bookmark">Document Modeling with Bricolage</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">David Wheeler</span> on <abbr class="published" title="2005-11-23T00:00:00-08:00">November 23, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<p>Previous Perl.com articles have reviewed <a href="/pub/a/2004/08/27/bricolage.html">where Bricolage fits into the universe of content management systems</a> and worked through <a href="/pub/a/2004/10/28/bricolage_installation.html">Bricolage installation</a> and <a href="/pub/a/2005/01/06/bricolage_configuration.html">Bricolage configuration</a>. Now it's time to go through the steps required to model the structure of an existing web page in Bricolage. Part of the motivation for the redesign of the <a href="http://www.bricolage.cc/" title="Visit the Bricolage website">Bricolage website</a> last summer was to create good examples of document types and templates for use in Bricolage itself. You can take advantage of that work by analyzing a page on the current Bricolage site to determine how to break it down into its basic elements.</p>

<p>First, here's a brief introduction to document types in Bricolage.</p>

<h3>The Elements of Bricolage Stories</h3>

<p>Bricolage features two types of documents: <em>stories</em> and <em>media</em>. Stories contain text content and metadata; media are just like stories, but can have a single media file associated with them (an image file, movie, sound file, PDF, etc.). Whether a document is a story document or a media document, <em>elements</em> define its structure.</p>

<p>Elements are the basic building blocks of all documents in Bricolage. There are two types of elements: <em>container elements</em> and <em>field elements</em>. Container elements can contain any number of fields and other container elements. Fields, on the other hand, contain text content. Bricolage presents fields as standard HTML fields such as text, textarea, pulldown, radio, etc.--even a date and time widget. In a document model, one container element is the top element and it, along with all of the fields and <em>subelements</em> it contains, constitutes the structural model for the content of documents based on it.</p>

<p>The important point here is that Bricolage encourages a highly structured model for your documents; documents based on the models are thus structurally consistent. It also makes it easy to write incredibly flexible templates to output content in a variety of formats. (The next article in this series will cover Bricolage templating.) Document models can also be deeply hierarchical, to whatever extent is necessary to accurately model the structure of the documents being managed. Be careful, though, because if the model has too many levels of hierarchy, it will be more difficult for users to conceptualize when editing documents, as well as more work to drill down into deeply nested elements in the Bricolage user interface.</p>

<h3>Document Analysis</h3>

<p><img src="/pub/2005/11/23/graphics/full_spread.jpg" width="207" height="397" alt="Bricolage.cc Article Screenshot" /><br />
<em>Figure 1. A screenshot of the article being analyzed</em>
</p>

<p><em>Document analysis</em> is the process of analyzing the layout of a document and breaking it down into its basic elements. Examining a page on a website, you must determine how all of the basic parts fit together and in what hierarchy, so that you can model the element structure necessary to accurately represent the document in Bricolage. That is, determine the container elements and fields that would be necessary to accurately recreate the document in Bricolage.</p>

<p>For the sake of this article, consider the structure of <a href="http://www.bricolage.cc/news/coverage/2002/12/18/online_tonight/index.html" title="David Wheeler Interviewed on Online Tonight">a typical page on the Bricolage website</a>, because it makes a nice representative sample of the elements articles on the site will likely need (see Figure 1).</p>

<h4>Identifying Content</h4>

<p>The first thing to do is to determine what part of that page constitutes <em>content</em> and what does not. The term "content" here distinguishes those parts of the page that are important to the document itself, as opposed to the site overall or to a section of the site. For example, the banner at the top of the page appears on every page on the site; it is not specific to this document, nor is it significant to the document's contents. Likewise, the footer section is global to the site and contributes nothing to the document. The Recent News list in the right-hand column also has nothing to do with the contents of the article, it being a simple list of the five most recent articles published on the entire site.</p>

<p>These other components are <em>includes</em>, because they're <em>included</em> on many pages--or even on every page of the site. It also doesn't hurt that web servers generally pull them into the layout via a server-side include technology (such as <code>mod_include</code>, HTML::Mason, PHP, or JSP). Because they're not significant to the content of the document, you can ignore them for the rest of this analysis. Figure 2 depicts everything that remains.</p>

<p><img src="/pub/2005/11/23/graphics/article.jpg" width="275" height="695" alt="Article Content Only" /><br />
<em>Figure 2. The important part of the document for the purposes of analysis: the actual content</em>
</p>

<h4>Defining the Top Element</h4>

<p>Having isolated the content of the page, you can start breaking its content down into its component parts. First, give the document type a name; this name will also be the name of the top-level element. Because this is an article in the Bricolage website, this is simple: it's <em>Article.</em></p>

<p>With that out of the way, it's time to pick out the field subelements of the document element. As fields are meaningful blocks of text, this is generally simple to do: they're headlines, paragraphs, subheads, and the like. Figure 2 indeed shows meaningful blocks of text:</p>

<dl>
<dt>Headline</dt>

<dd>This is the title of the article. In this case, it's "David Wheeler Interviewed on Online Tonight."</dd>

<dt>Dateline</dt>

<dd>This is the date for the article, here "2002.12.18."</dd>

<dt>Paragraph</dt>

<dd>These blocks of text make up the bulk of the content of the article. The first paragraph starts with "Bricolage maintainer and lead developer David Wheeler appeared on the Online Tonight with David Lawrence radio show."</dd>

<dt>Header</dt>

<dd>Section headers break up the content into sections, such as "How it All Started" and "Bricolage vs. Blogging Tools."</dd>
</dl>

<h4>Identifying Subelements</h4>

<p><img src="/pub/2005/11/23/graphics/related_image.jpg" width="267" height="322" alt="Related Image" /><br />
<em>Figure 3. The components making up a "Related Image" element</em>
</p>

<p>Pretty simple, right? Well the interesting part comes when you identify the container subelements of the layout. The way to do so is to look for areas where content has been logically grouped together as a unit; for instance, to combine an image and its caption. Such is exactly the case with the picture of David Lawrence. Call this container element a "Related Image," because it creates a link to an image document that's related to the current article content. Figure 3 illustrates the breakdown of the newly identified element: It has a link to a related media document and it has an "Alt Text" field and a "Caption" field.</p>

<p><img src="/pub/2005/11/23/graphics/related_audio.jpg" width="342" height="216" alt="Related Audio" /><br />
<em>Figure 4. The pieces of the "Related Audio" element include a tooltip (not shown)</em>
</p>

<p>Another clearly grouped collection of content is the box entitled "David Wheeler Takes to the Airwaves." This one has a link to an audio document and a description of its contents. It also has a speaker icon, but this isn't really content; it's more a hint to the viewer as to what she's linking to. That is, it's not content, but <em>presentation</em>. It adds no semantic meaning to the article. To parallel the "Related Image" subelement, call this one "Related Audio." Figure 4 highlights its subelements.</p>

<p><img src="/pub/2005/11/23/graphics/pull_quote.jpg" width="406" height="251" alt="Pull Quote" /><br />
<em>Figure 5. The "Pull Quote" element has a Paragraph field and an attribution field</em>
</p>

<p>Finally, there's one last subelement, the "Pull Quote." It simply groups together a quotation paragraph and an attribution. See Figure 5.</p>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/971" template="b/article_sidebar2.view">
<!-- sidebar ends -->













<h4>A Note on Layout</h4>

<p>Ideally, your analysis is now complete, as you've successfully identified all of the elements of our Article document type using this layout. There is one more thing to consider, though: the placement of the Related Audio, Related Image, and Pull Quote subelements.</p>

<p>The ideal in content management is to separate content from presentation. You've successfully done so here: you've identified the parts of an article (paragraphs, pull quotes, headers, etc.) without specifying anything about the layout (colors, type faces, spacing, placement, etc.). In looking at this example more closely, note that the related audio box is on the right, the related image is on the left, and the pull quote is on the right again. The question is, when a template formats this document for output, how will it determine what goes on the left and what goes on the right?</p>

<p>You might guess that related audio always goes on the right, related images always on the left, and pull quotes always on the right--but if an article has no related audio or pull quotes and five different related images, the layout would end up looking lopsided. Your editors (those who have the least bit of design sensibility) won't like that.</p>

<p>Another way to handle it is to come up with an algorithm to place these suckers. You might decide, for example, that between the three boxed subelements (Related Audio, Related Image, and Pull Quote), placement might rotate back and forth between the right and the left, or perhaps one on the right, two on the left, two on the right, etc. Of course, the problem with this approach is that, depending on how algorithmic you need it to be, the algorithm might be tricky to write. Plus, your editors still might not like it, and ask you, "Why can't I just tell it to put it on the left?"</p>

<p>Why not? The separation of content from presentation is the ideal, yes, but it's not always practical. Plus, sometimes, you can give people the sort of control they need without unduly sacrificing the separation. In this case, solve the problem simply by adding an extra field to each of the subelements: "Position," with two possible values, "right" and "left." Now, when an editor adds a pull quote to a document, she can specify the placement in such a way that the template can easily place it. As for the separation of content from presentation: this information is more metadata about the element than content, and you can ignore it when you need to create purely semantic representations (such as XML).</p>

<p>The upshot is that during a document analysis, you must pay careful attention to the semantically meaningful parts of a document and model the appropriate elements, and then weigh the importance of providing additional, non-semantic presentation metadata fields to give editors the control they need to get their jobs done. Go for the middle road and keep everyone happy.</p>

<p><img src="/pub/2005/11/23/graphics/table-1.gif" width="280" height="490" alt="Table 1" /><br />
<em>Table 1. The completed document model. In Bricolage, all subelements are optional, meaning that users can add any number of Related Image, Related Audio, and Pull Quote elements to a document.</em></p>

<h3>The Document Model</h3>

<p>Having performed your document analysis (and of course, in practice, you should examine several different pages on a site to ensure that you don't miss any elements that are present in some articles but not others), you can now synthesize the breakdown of the elements into a comprehensive model. In practice, that's pretty simple. See Table 1 for the complete representation. Based on the analysis, you've decided on the types of the fields (text, textarea, pulldown, etc.), whether they're a required part of the element they're in, and whether they're repeatable. For example, the headline of the article is required, but not repeatable, because all articles must have a headline but not more than one headline. Paragraphs, on the other hand, are not required, but there can be more than one. You can also say that paragraphs are required <em>and</em> repeatable, in which case at least one would need to be in the element. When doing your own document analysis, take the path that makes the most sense to you.</p>

<p>Container elements, on the other hand, currently have no such occurrence specification. You can add any number of any of the defined subelements to a document, including none. We may add <a href="http://bugs.bricolage.cc/show_bug.cgi?id=986" title="To do: Add Support for Pre-populating Subelements">occurrence specification for container elements</a> in a future version of Bricolage.</p>

<p>This example is pretty simple. However, the Article document type for the Bricolage website is quite a bit more complex. See the <a href="http://www.bricolage.cc/about/doc_models/article/" title="View the full Article document model">complete model of the Article document type</a>. In fact, the Bricolage site contains <a href="http://www.bricolage.cc/about/doc_models/" title="The Bricolage website document models">a graphical representation of all of the Bricolage website document models</a>. (I used the special <a href="http://www.bricolage.cc/templates/story/introspect.mc" title="Download the Bricolage introspection template">Bricolage introspection template</a> to generate the tables displaying the models.)</p>

<h3>Element Administration</h3>

<p><img src="/pub/2005/11/23/graphics/element_nav.jpg" width="163" height="400" alt="Navigate to the Element Manager" /><br />
<em>Figure 6. Navigate to the Element Type Manager and the Element Manager to administer elements</em>
</p>

<p>The next step is to model, in Bricolage, the elements you've discovered. There are two administrative tools to use to create the elements: The Element Type Manager and the Element Manager. To access these managers, use the Bricolage side menus (see Figure 6) to navigate to ADMIN -&gt; PUBLISHING -&gt; and select the appropriate manager. You will see a search interface to search for and edit element or element-type objects. Clicking the Edit link for an element type, for example, brings up the Element Type Profile, where you can edit the attributes of the element type.</p>

<h4>Element Types</h4>

<p>Each element in Bricolage has an associated <em>element type</em> that defines a few attributes that its associated element share. There are three different kinds of element types: <em>story element types</em>, which define the structure of story documents; <em>media element types</em>, which define the structure of media documents; and <em>subelement element types</em>, which define the structure of container subelements. See Figure 7 for a snippet of the element type interface. The attributes you can set on element types are:</p>

<p><img src="/pub/2005/11/23/graphics/story_et.jpg" width="290" height="226" alt="Stories Element Type" /><br />
<em>Figure 7. A segment of an element type profile called "Story"</em>
</p>

<dl>
<dt>Page</dt>

<dd>Indicates whether an element is a <em>page</em>. Sometimes documents need to have multiple pages through which readers can navigate. You may recognize multi-page documents from <a href="/" title="Perl.com">Perl.com</a>, where you navigate from page to page via Next Page and Previous Page links.</dd>

<dt>Fixed</dt>

<dd>A <em>fixed</em> document is typically one that does not have the date as a part of its URI. <em>Output channels</em> defined in Bricolage specify two URI formats for the documents published to them. One of those formats is the "fixed URI format." If a story based on an element has the "Fixed" checkbox checked in its element type, the story uses the "fixed URI format." Otherwise, it'll use the non-fixed URI format. (The next article will cover output channels in detail.)</dd>

<dt>Related Story</dt>

<dd>Elements associated with an element type with the <em>Related Story</em> checkbox checked can have an associated story document. This is useful for creating lists of stories related to the current story, for example.</dd>

<dt>Related Media</dt>

<dd>The <em>Related Media</em> checkbox is just like the Related Story checkbox, except that it allows the creation of a relationship to a media document rather than to a story document. The Related Image and Related Audio elements depend on this checkbox being checked.</dd>

<dt>Media Type</dt>

<dd>This applies only to media element types--that is, elements that define the structure of media documents. This attribute is a pulldown list, featuring the options Image, Video, Audio, or Other. Of these options, only Image has any effect; image elements automatically have fields associated with them for height, width, color depth, and a few others. Bricolage automatically populates these fields when you upload an image file.</dd>
</dl>

<p>Given how element types work, the Article document type requires the following element types:</p>

<dl>
<dt>Audio</dt>

<dd>There are some media documents to manage. The first is Audio, required to manage the audio recordings associated with the Related Audio subelement. The Audio element type is a media element type with its media type set to Audio, surprisingly enough.</dd>

<dt>Image</dt>

<dd>The Image element type sets attributes for image document types. It is just like the Audio element type, except that it has its media type set to Image instead of Audio. Go figure.</dd>

<dt>Story</dt>

<dd>This defines the shared attributes of story elements, of which the Article element is one. It does not use a fixed URL (so that the article's cover date shows up in the URI), and has neither a related story nor related media. The Page attribute is irrelevant to this element type.</dd>

<dt>Subelement</dt>

<dd>This simple element type defines generic subelements. There are no special attributes of these subelements, so don't check any. The Pull Quote subelement is an example: it's not a page, and it doesn't have an associated media document or story document.</dd>

<dt>Related Media</dt>

<dd>This subelement element type defines elements that have media files associated with them. It has its Related Media checkbox checked, and will be used to define Related Audio and Related Image elements.</dd>
</dl>

<p><img src="/pub/2005/11/23/graphics/new_element.jpg" width="344" height="360" alt="Creating the Related Image element" /><br />
<em>Figure 8. Creating the Related Image element</em>
</p>













<h4>Elements</h4>

<p>Now it's time for the building blocks. You defined several elements in your analysis of the Bricolage.cc page. Now you need to model them in Bricolage, basing each on an element type. When administering elements, you typically first create those farthest down the hierarchy, because you'll need to have them available to associate when you create those farther up. Start with the Pull Quote, Related Image, and Related Audio elements, and then create the Article story type element.</p>

<p>First create the Related Image element (Figure 8). The Key Name field uniquely identifies the element throughout Bricolage, while the burner determines the kind of templates that will be used to format Related Image elements. Be sure to select the Related Media element type! This is useful for many things, including giving templates the ability to easily get a handle on an element, as well as providing the file name for templates based on this element. It's generally a good idea to make the key name the same as the element name, but lowercased and with spaces replaced with underscores (uppercase letters and spaces are not allowed in key names).</p>

<p>The Burner pulldown list allows selection of the <em>burner</em> that will be used to format the element. As mentioned in the <a href="/pub/a/2004/08/27/bricolage.html" title="Content Management with Bricolage">Bricolage introduction article</a>, Bricolage currently supports three templating systems for formatting content: <a href="http://www.masonhq.com/" title="Mason HQ">Mason</a>, <a href="http://www.template-toolkit.org/" title="Template Toolkit home">Template Toolkit</a>, and <a href="http://html-template.sourceforge.net/" title="HTML::Template home">HTML::Template</a> (but with <a href="http://www.php.net/" title="PHP?">PHP</a> support arriving in the forthcoming Bricolage 1.10, due out in September; stay tuned!). The Bricolage objects that push stories through the templates in a particular output channel are <em>burners</em>, ostensibly because they "burn" files to disk (but rumor has it that the name <em>really</em> came about when the original developer of the Mason burner wanted to write a <code>burn_one()</code> method). I've selected Mason for this example because all of the Bricolage site templates use Mason.</p>

<p><img src="/pub/2005/11/23/graphics/custom_fields.jpg" width="385" height="267" alt="Element custom field definition" /><br />
<em>Figure 9. The fields subelements defined for the Related Image element</em>
</p>

<p>Click the Next button to create the Related Image element. Now you need to add any necessary subelements and fields. Look back at the model in Table 1: the Related Image element has no subelements, but it does have a few fields. Figure 9 pulls out the relevant part of the element profile. (Click an Edit link to edit an individual field element definition, or use the Add New Field section to add new fields to the element.) Note that you've already added the necessary fields. Should you decide that they should display in a different order, simply change the values of the numbered fields (changing one will cause the others to renumber automatically). You can also edit or delete each one to change its values.</p>

<p>The Add New Field section allows you to define new fields for the element, selecting from several available types (text, textarea, pulldown, date, etc.) and filling in the appropriate fields. Each option features different fields to fill in, but the important ones are:</p>

<dl>
<dt>Key Name</dt>

<dd>This field uniquely identifies the field among all the fields in the container element. While no field in a single element can have the same key name, a field in one element can have the same key name as a field in another element. Like container element key names, they must be lowercase and have no spaces. Again, I tend to use a key name that is the same as the name except for those two rules.</dd>

<dt>Label</dt>

<dd>This is the name of the field. A field can have the same name as another field, but that would be silly, now wouldn't it?</dd>

<dt>Default Value</dt>

<dd>The default value for a field when adding a new one to an element. For example, a URL field might have a default value of "http://" as a sort of reminder to editors as to what belongs in the field. It might also make sense to use the most common value for the default (such as with the Position field, where the default is "left").</dd>

<dt>Size</dt>

<dd>The size of the field in the display. Text fields use this value to set the width of the field (in characters), while Select fields use it to set the number of values to be displayed in a scrollable select field. The textarea field has Rows and Columns fields, instead, to indicate the size at which to display the field in the interface.</dd>

<dt>Maximum Size</dt>

<dd>The maximum size of the allowed value. This option limits the length of a text or textarea value to a certain number of letters.</dd>

<dt>Required</dt>

<dd>Indicates whether, when adding a new element, the field will be included in the element or the editor needs to add by the editor. The "required" moniker is unfortunate in this case, because it <em>does not</em> mean that the field is required to have a value, only that it's required to be present in the user interface.</dd>

<dt>Repeatable</dt>

<dd>Indicates whether or not a field is repeatable. For example, a paragraph field would be repeatable, because we want an editor to be able to add more than one paragraph to a story.</dd>

<dt>Position</dt>

<dd>Indicates the order in which the field appears in the user interface. This value affects only required fields, and causes all required fields to be displayed in the order indicated. This does not prevent an editor from reordering fields, however.</dd>

<dt>Options</dt>

<dd>This field allows you to specify a range of values for a field. It applies only to Radio Button, Pulldown, and Select fields. Each value goes on a single line, with the option first and then an optional label, separated by a comma.</dd>

<dt>Allow Multiple</dt>

<dd>This checkbox is specific to the Select field. When checked, users can select more than one value.</dd>
</dl>

<p>You may edit each of these fields, with the exception of the key name, by clicking its Edit link.</p>

<p>Following the model (Table 1), creating the necessary fields for the Related Audio element becomes simple. The Title, Link Text, and Tooltip fields are simple non-repeating text fields; the Description is a non-repeating textarea field; and the Position field is a non-repeating pulldown field. It's fine to accept the default values for the other fields (size, columns, rows, max size, etc.). For the Position field, however, add two values to the Options field:</p>

<pre><code>left,Left
right,Right</code></pre>

<p>Also set the default value. I've opted for "left" (and, indeed, that's what shows up as the default value for the field in Figure 9), but you could also set it to "right."</p>

<p>Creating the Related Audio and Pull Quote elements is much the same. The only difference is in the fields included and in the selection of an element type (Related Audio is a Related Media type, like Related Image, but Pull Quote is a Subelement).</p>

<p>Now, the Article element--the element that determines the structure of all articles, and therefore defines the Article document type--is a bit different. Defining its fields is of course the same, but you actually have modeled more fields than you need. You see, all documents in Bricolage have a Title field and a Cover Date. You can use these in place of custom Headline and Dateline fields; therefore, you don't have to define them. What's left, Paragraph and Header, define in the same way as fields in all elements.</p>

<p><img src="/pub/2005/11/23/graphics/subelements.jpg" width="500" height="118" alt="Subelements of Article" /><br />
<em>Figure 10. The subelements of the Article element. Click the Add Subelement button to search for other elements and add them to Article</em>
</p>

<p>Defining subelements is almost the same, although the other elements had no subelements of their own. Figure 10 shows the Existing Subelements section of the element profile. In this example, the Related Audio and Related Image subelements have already been associated with the Article element, but you still need to add the Pull Quote element. Click the Add Subelement button to bring up a page very similar to the element manager: there's a search box, and you can view the results of your search. Unlike the element manager, however, this interface displays only subelements (that is, those elements that are associated with subelement element types, not story or media element types). Type in and search on the string "pull", and then when you get the search results, select the Add to Element checkbox, and click the Add Elements button. Figure 11 illustrates this process.</p>

<p><img src="/pub/2005/11/23/graphics/add_subelement.jpg" width="500" height="195" alt="Adding the Pull Quote subelement" /><br />
<em>Figure 11. Use the search field to find the element you want, check the "Add to Element" checkbox, and click the Add Elements button.</em>
</p>

<p>Now the Article document type is complete! Well, almost. I've left out that there are other fields to fill in for story type and media type elements: <em>sites</em> and output channels. Because Bricolage is designed to manage multiple sites, each story or media type element must be associated with one or more sites. Each site associated with the element can create documents based on the element. By default, Bricolage has only one Site, Default, so you can just leave it associated with the Article element (if your installation has only one site, then that one site will be associated with all new story and media type elements).</p>

<p>As for output channels, each site has a primary output channel associated with the element. You can add extra output channels as needed. Bricolage has a single output channel by default, called Web, and you can leave this as the selected value. Again, the next article will cover output channels in more depth.</p>

<p><em>Now</em> the Article document type is complete, and you're ready to start creating documents based on it.</p>













<h3>Categories</h3>

<p>There is one final topic to discuss before you can create a story document based on the Article document type: categories. <em>Categories</em> are hierarchically organized content locations. Think of them as similar to a file system of directories (or folders, for you Mac fans out there). Indeed, categories in Bricolage are used in the URIs of story and media documents, so the translation is close (modulo date parts and slugs). They are also used to categorize content, so it makes sense to create category hierarchies that make sense for your site.</p>

<p><img src="/pub/2005/11/23/graphics/new_category.jpg" width="423" height="226" alt="Creating a new category" /><br />
<em>Figure 12. Create new categories starting with top-level categories added as subcategories to the root category, "/"</em>
</p>

<p>For example, if your site were a newspaper featuring movie and book reviews, you might want to create a category named Reviews as a subcategory of the root category ("/"), and then subcategories of the Reviews category named Books and Movies. The full URIs for these categories would be <code>/reviews</code>, <code>/reviews/books</code>, and <code>/reviews/movies</code>, respectively.</p>

<p>To create categories for your site, navigate to the Categories manager under ADMIN -&gt; PUBLISHING and click "Add a New Category" for each category you wish to add. The root category already exists for each site, so start by creating your top-level categories and make your way down. See Figure 12 for an example creating a top-level Reviews category.</p>

<p><img src="/pub/2005/11/23/graphics/workflow_nav.jpg" width="161" height="361" alt="Navigating to the Story workflow" /><br />
<em>Figure 13. Navigate to the Story workflow and click New Story to create and edit a new story</em>
</p>

<h3>Document Editing</h3>

<p>Having created the categories you need, you can create a story document based on the Article story type. Open the Story workflow in the side navigation and select New Story (Figure 13) to bring up the New Story screen shown in Figure 14. Enter a title and slug. A <em>slug</em> is a very short hint (one or two words, separated by an underscore or dash) as to the contents of the story. Generally, the slug should complement the category selection rather than repeat it. For example, if you were creating a review of <em>The Princess Bride</em> in your <code>/reviews/books</code> category, you might make the slug "princess_bride." Select the Article story type, and cover date and click the Create button. This action creates a new story in the Story workflow and puts it on that workflow's "start desk," in this case the Edit desk.</p>

<p><img src="/pub/2005/11/23/graphics/new_story.jpg" width="406" height="211" alt="Creating a new story" /><br />
<em>Figure 14. Create a new story based on the Article story type. Be sure to enter a meaningful slug and cover date, and put the article in the relevant category</em>
</p>

<p><img src="/pub/2005/11/23/graphics/story_content.jpg" width="445" height="404" alt="Editing story content" /><br />
<em>Figure 15. Add fields and elements to the story in the Content section of the story profile</em>
</p>

<p>The new story will then open in the story profile. The first section of the profile, Properties, mostly covers the same data points as the New Story screen. It's the second section, Content, that is most interesting (Figure 15). The bottom of this section has an Add Element button and a select list. From this list, you can select the fields or container subelements you'd like to add to the story. After adding a field, you can edit it, as with the Teaser and Long Teaser fields in Figure 15.</p>

<p>Notice that the names of the elements available in the Add Element select list is identical to the names of the container elements and fields associated with your modeled Article story type element. Because these are the only content containers that editors can add to a story, the structural integrity of the story strictly adheres to the model you created. The advantage is that the structure of the stories to be published to the site will be consistent across stories. This approach enables the maintenance of document standards and styles across a site, which can be very important in a large organization with thousands of pages of content to maintain. It also allows for simple yet extremely flexible templating, so that you can output documents in a variety of formats (XHTML, RSS, PDF, etc.) while maintaining identity and design standards.</p>

<p>Why are container elements and fields all listed together in one select list? Because as an editor works on a story, she doesn't need to think in great detail about what to add. It's unnatural for a writer to have to stop and think, "Do I want to add a container element or a field?" as she decides from which list to select. She only has to think, "I need to add a paragraph" or "I think a pull quote would work well here." The difference is important to us a document modelers and, later, as template developers, but for editors, the distinction is irrelevant.</p>

<p><img src="/pub/2005/11/23/graphics/subelement.jpg" width="442" height="186" alt="Editing the Related Image subelement" /><br />
<em>Figure 16. Edit the fields of the Related Image subelement. Click the Edit button in the Related Media section to search for an image document to relate to this element</em>
</p>

<p>If you elect to add a subelement, say by selecting the Related Image option, you will then see the profile for that element. Figure 16 illustrates the Related Image element profile. Note how the required fields for this element (Title, Alt Text, Position, and Caption) are in the profile. Furthermore, because this is a related media element, there's an extra section called, curiously enough, Related Media. By clicking the Edit button, you can search your existing media documents to create a relationship, much as you searched for subelements to add to an element in the element manager. In Bricolage 1.10.0, you can also upload a media file directly in this interface, implicitly creating a media document in the same category and with the same cover date as the current story.</p>

<p>Click the Save button to save the element. Back in the main story profile, the new Related Image subelement will appear in the Content Section. You can re-order elements and fields by selecting new values from the Position select lists adjacent to each element. To edit a field, simply do so directly. To edit the Related Media subelement again, click its Edit button and you'll return to its profile.</p>

<p>Before finishing with this story, there's one more editing interface that's important to know. Adding individual fields to a story so as to keep their contents in independent records is all well and good, but the first time you tell an editor that she has to add each paragraph one at a time, duck. Just as an editor doesn't want to think about whether to add a container element or field to a story, she also doesn't want to have to go to a select list, click a button, and wait for a browser reload every time she wants to add a single paragraph.</p>

<p><img src="/pub/2005/11/23/graphics/sbe.jpg" width="444" height="470" alt="Super Bulk Edit" /><br />
<em>Figure 17. Super Bulk Edit allows editors to use POD-like syntax to edit all of the fields in an element in a single textarea box</em>
</p>

<p>For this reason, Bricolage features two other interfaces for editing. The first, Bulk Edit, allows editors to edit all instances of a repeatable field in a single textarea. This is convenient if the majority of the content of a story is paragraphs, for example. The editor can simply write all the paragraphs she wants in a textarea box, separating each with a blank line. To use it, simply select the type of repeatable field to edit and click the Bulk Edit button to the right of the Add Element button and list.</p>

<p>Most documents are not simple lists of paragraphs though (if they were, you wouldn't need a tool as sophisticated as Bricolage). Instead, they're a mix of different blocks of content; the so-called Super Bulk Edit feature will likely prove to be more useful. To use it, select Super Bulk Edit from the Bulk Edit select list and then click the Bulk Edit button. Doing so will bring up the screen depicted in Figure 17. Here, you can edit all of the fields and subelements of the current element in a single textarea field. Each individual field or subelement has <a href="http://search.cpan.org/dist/Pod-Simple/lib/perlpod.pod" title="Read the POD documentation on CPAN">POD</a>-like tags that start with an equal sign (<code>=</code>) and end with the key name of the element or field. The tags for subelements each exist on a line by themselves, while field tags identify the field to which the contents below them belong. You can even select a default element (say, Paragraph) from the Default Element select list, and then any blocks of text that have no POD tag will default to that element. This approach makes it easy for writers to edit all the different parts of an element without having to select, reload, and wait for every one. They can also create and reorder subelements, although they cannot change the contents of subelements themselves.</p>

<p>Click Save to return to the story profile, and the Save button there to save the story and return to My Workspace. Now you have created a story based on the article model. Go ahead, create as many more as you like.</p>

<h3>Up Next: Templating</h3>

<p>The next article will show how to write your first templates in Bricolage to format stories for output, so that you can actually see how your documents will look when they're published. Stay tuned!</p>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-796" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/07/navwidgets.html" rel="bookmark">Building Navigation Menus</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Shlomi Fish</span> on <abbr class="published" title="2005-07-07T00:00:00-08:00">July  7, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>Navigation menus are a group of links given at one side of the page that
allows users to navigate to different places of a website.  Navigation menus
allow site visitors to explore other pages of the site and to find what
they want more easily.  For example, <a href="http://www.paulgraham.com/">Paul
Graham's home page</a> contains a simple navigation menu made out of images.  It
doesn't change as the site visitor move to different pages of the site.  The <a
href="http://www.kde.org/">KDE desktop environment</a> home page contains a more
sophisticated menu.  Click on <a href="http://www.kde.org/screenshots/">the
link to the screenshots</a> to see a submenu for links to screenshots from
multiple versions of KDE.  Other menu items have similar expansions.</p>

<h3>Common Patterns in Navigation Menus and Site Flow</h3>

<p>There are several patterns in maintaining navigation menus and general site
flow.</p>

<h4>A Tree of Items</h4>

<p>Usually, the items in the navigation menus are a tree structure (as is the
case for the KDE site) or a flat list. Sometimes, branches of the tree can
<em>expand</em> or collapse depending on the current page. This prevents
having to display the entire tree at once.</p>

<h4>Next/Previous/Up Links to Traverse a Site</h4>

<p>Many sites provide links to traverse the pages of the site in order: a
<em>Next</em> link to go to the next page, a <em>Previous</em> link to go to
the previous page, an <em>Up</em> link to go to the section containing the
current page, a <em>Contents</em> link to go to the main page, and so on.</p>

<p>HTML can represent these links by using <code>&lt;head&gt;</code> tag and
<code>&lt;link rel=&quot;next&quot; href=&quot;&quot; /&gt;</code>. directives. Mozilla, 
Firefox, and Opera all support these tags. They can be also visible in the HTML
as normal links, as is the case with <a
href="http://www.gnu.org/software/make/manual/html_node/make_toc.html">GNU
Documentation</a>.</p>

<h4>Site Maps and Breadcrumb Trails</h4>

<p>Other navigation aids provided by sites include a <i>site map</i> (like <a
href="http://www.catb.org/~esr/sitemap.html">the one on Eric S. Raymond's
home page</a>) and a <i>breadcrumb trail</i>. A breadcrumb trail is a path of the
components of the navigation menu that leads to the current page. The <a
href="http://search.cpan.org/dist/Module-Build/lib/Module/Build/Cookbook.pm">documentation
for Module::Build::Cookbook</a> on <a
href="http://search.cpan.org/">search.cpan.org</a> provides an example (&quot;Ken
Williams &gt; Module-Build &gt; Module::Build::Cookbook,&quot; in this case).</p>

<h4>Hidden Pages and Skipped Pages</h4>

<p>Hidden pages are part of the site flow (the next/previous scheme) but don't
appear in the navigation menu. Skipped pages are the opposite: they appear in
the navigation menu, but are not part of the site flow.</p>

<h3>Introducing HTML::Widgets::NavMenu</h3>

<p>How do you create menus?  <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/">HTML::Widgets::NavMenu</a>
is a <a href="http://www.cpan.org/">CPAN</a> module for maintaining navigation
menus and site flow in general. It supports all of the above-mentioned patterns and
some others, has a comprehensive test suite, and is under active maintenance. I
have successfully used this module to maintain the site flow logic for such
sites as <a href="http://www.shlomifish.org/">my personal home page</a> and <a
href="http://perl-begin.berlios.de/">the Perl Beginners' Site</a>.  Other
people use it for their own sites.</p>

<p>This makes it easy to generate and maintain such navigation menus in Perl.
It is generic enough so that it can generate static HTML or dynamic HTML on the
fly for use within server-side scripts (CGI, <i>mod_perl</i>, etc.).</p>

<p>To install it, use a CPAN front end by issuing a command such as <code>perl
-MCPANPLUS -e &quot;install HTML::Widgets::NavMenu&quot;</code> or <code>perl -MCPAN -e
&quot;install HTML::Widgets::NavMenu&quot;</code>.</p>

<h3>A Simple Example</h3>

<p>Here's a simple example: a navigation tree that contains a home page and two
other pages.</p>

<p>You can see <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/simple/H-W-NM-simple.pl">the
complete code for this example</a>:</p>

<pre><code>#!/usr/bin/perl

use strict;
use warnings;

use HTML::Widgets::NavMenu;
use File::Path;</code></pre>

<p>This is the standard way to begin a Perl script. It imports the module and
the <code>File::Path</code> module, both of which it uses later.</p>

<pre><code>my $css_style = &lt;&lt;&quot;EOF&quot;;
a:hover { background-color : palegreen; }
.body {
.
.
.
EOF</code></pre>

<p>This code defines a CSS stylesheet to make things nicer visually.</p>

<pre><code>my $nav_menu_tree =
{
    'host'  =&gt; &quot;default&quot;,
    'text'  =&gt; &quot;Top 1&quot;,
    'title' =&gt; &quot;T1 Title&quot;,
    'subs'  =&gt;
    [
        {
            'text' =&gt; &quot;Home&quot;,
            'url'  =&gt; &quot;&quot;,
        },
        {
            'text'  =&gt; &quot;About Me&quot;,
            'title' =&gt; &quot;About Myself&quot;,
            'url'   =&gt; &quot;me/&quot;,
        },
        {
            'text'  =&gt; &quot;Links&quot;,
            'title' =&gt; &quot;Hyperlinks to other Pages&quot;,
            'url'   =&gt; &quot;links/&quot;,
        },
    ],
};</code></pre>

<p>Now this is important. This is the tree that describes the navigation menu.
It is a standard nested Perl 5 data structure, with well-specified keys.  These
keys are:</p>

<ul>

<li><code>host</code>: A specification of the host on which the sub-tree
starting from that node resides.  HTML::Widgets::NavMenu menus can span several
hosts on several domains. In this case, the menu uses just one host, so
<code>default</code> here is fine.</li>

<li><code>text</code>: What to place inside of the <code>&lt;a&gt;...&lt;/a&gt;</code> tag (or
alternatively, the <code>&lt;b&gt;</code> tag, if it's the current page).</li>

<li><code>title</code>: Text to place as a <code>title</code> attribute to a
hyperlink (usually displayed as a tooltip). It can display more detailed
information, helping to keep the link text itself short.</li>

<li><code>url</code>: The path within the host where this item resides. Note
that all URLs are relative to the top of the host, not the URL of their
supernode. If the supernode has a path of <i>software/</i> and you wish
the subnode to have a path of <i>software/gimp/</i>, specify <code>url
=&gt; 'software/gimp/'</code>.</li>

<li><code>subs</code>: An array reference that contains the node's sub-items.
Normally, this will render them in a submenu.</li>

</ul>

<p>One final note: HTML::Widgets::NavMenu does not render the top item. The
rendering starts from its sub-items.</p>

<pre><code>my %hosts =
(
    'hosts' =&gt;
    {
        'default' =&gt;
        {
            'base_url' =&gt; (&quot;http://web-cpan.berlios.de/modules/&quot; .
                &quot;HTML-Widgets-NavMenu/article/examples/simple/dest/&quot;),
        },
    },
);</code></pre>

<p>This is the hosts map, which holds the hosts for the site.  Here there is
only one host, called <code>default</code>.</p>

<pre><code>my @pages =
(
    {
        'path'    =&gt; &quot;&quot;,
        'title'   =&gt; &quot;John Doe's Homepage&quot;,
        'content' =&gt; &lt;&lt;'EOF',
&lt;p&gt;
Hi! This is the homepage of John Doe. I hope you enjoy your stay here.
&lt;/p&gt;
EOF
    },
    .
    .
    .
);</code></pre>

<p>The purpose of this array is to enumerate the pages, giving each one the
<code>&lt;title&gt;</code> tag, the <code>&lt;h1&gt;</code> title, and the content that it contains. It's
not part of HTML::Widgets::NavMenu, but rather something that this script uses to
render meaningful pages.</p>

<pre><code>foreach my $page (@pages)
{
    my $path     = $page-&gt;{'path'};
    my $title    = $page-&gt;{'title'};
    my $content  = $page-&gt;{'content'};
    my $nav_menu =

        HTML::Widgets::NavMenu-&gt;new(
            path_info     =&gt; &quot;/$path&quot;,
            current_host  =&gt; &quot;default&quot;,
            hosts         =&gt; \%hosts,
            tree_contents =&gt; $nav_menu_tree,
        );

    my $nav_menu_results = $nav_menu-&gt;render();
    my $nav_menu_text    = join(&quot;\n&quot;, @{$nav_menu_results-&gt;{'html'}});
    
    my $file_path = $path;
    if (($file_path =~ m{/$}) || ($file_path eq &quot;&quot;))
    {
        $file_path .= &quot;index.html&quot;;
    }
    my $full_path = &quot;dest/$file_path&quot;;
    $full_path =~ m{^(.*)/[^/]+$};

	# mkpath() throws an exception if it isn't successful, which will cause
	# this program to terminate.  This is what we want.
    mkpath($1, 0, 0755);
    open my $out, &quot;&gt;&quot;, $full_path or
        die &quot;Could not open \&quot;$full_path\&quot; for writing: $!\n&quot;;
    
    print {$out} &lt;&lt;&quot;EOF&quot;;
&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;
&lt;!DOCTYPE html
     PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;
     &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;$title&lt;/title&gt;
&lt;style type=&quot;text/css&quot;&gt;
$css_style
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;navbar&quot;&gt;
$nav_menu_text
&lt;/div&gt;
&lt;div class=&quot;body&quot;&gt;
&lt;h1&gt;$title&lt;/h1&gt;
$content
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
EOF

    close($out);
}</code></pre>

<p>This loop iterates over all the pages and renders each one in turn. If the
directory up to the file does not exist, the program creates it by using the
<code>mkpath()</code> function. The most important lines are:</p>

<pre><code>    my $nav_menu =
        HTML::Widgets::NavMenu-&gt;new(
            path_info     =&gt; &quot;/$path&quot;,
            current_host  =&gt; &quot;default&quot;,
            hosts         =&gt; \%hosts,
            tree_contents =&gt; $nav_menu_tree,
        );

    my $nav_menu_results = $nav_menu-&gt;render();
    my $nav_menu_text    = join(&quot;\n&quot;, @{$nav_menu_results-&gt;{'html'}});</code></pre>

<p>This code initializes a new navigation menu, giving it four named
parameters. <code>path_info</code> is the path within the host. Note that, as
opposed to the paths in the navigation menu, it starts with a slash. This is to
allow some CGI-related redirections. <code>current_host</code> is the current
host (again, it's <code>default</code>). Finally, <code>hosts</code> and
<code>tree_contents</code> point to hosts and the tree of contents, respectively.</p>

<p>The object <code>render()</code> method returns the results in a hash
reference, with the navigation menu results as an array of tags pointed by the
<code>html</code> key. The code finally <code>join</code>s and returns
them.</p>

<p>The program produces <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/simple/dest/">this
result</a>, with three entries, placed in a <code>&lt;ul&gt;</code>.  When a
user visits a page, the corresponding menu entry displays in bold and has its
link removed.</p>

<h3>A More Complex Example</h3>

<p>Now consider <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/complex/H-W-NM-complex.pl">a
more complex example</a>. This time, the tree is considerably larger and
contains nested items. There are now <code>subs</code> of other pages.</p>

<p>The <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/complex/dest/">final
site</a> has a menu. When accessing a page (for example, <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/complex/dest/me/">the
"About Myself" page</a>) its expands so visitors can see its sub-items.</p>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/771" template="b/article_sidebar.view">
<!-- sidebar ends -->

<h3>Adding More Navigation Aids</h3>

<p>The next step is to add a breadcrumb trail, navigation links, and a site
map to the site. You can inspect <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/with-embellishments/H-W-NM-embellish.pl">the
new code</a> to see if you understand it and <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/with-embellishments/dest/">view
the final site</a>.</p>

<p>The breadcrumb trail appears right at the top of the site. Below it is a
toolbar with navigation links like &quot;next,&quot; &quot;previous,&quot; and &quot;up.&quot; Finally,
there's <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/with-embellishments/dest/site-map/">a
site map</a>.  Here are the salient points of the <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/complex-2-embellish-delta.diff"
title="the difference from the previous version in patch format">code's
modifications</a>:</p>

<ol>

<li>The code loads the <a href="http://www.template-toolkit.org/">Template
Toolkit</a> to render the page, then fills in the variables of the template to
define the template itself and to process it into the output file.</li>

<li>The CSS stylesheet has several new styles, to make the modified page look
nicer.</li>

<li>A template portion to transform a breadcrumb-trail object as returned by
HTML::Widgets::NavMenu into HTML. It should be easy to understand.</li>

<li>The bottom of the navigation menu tree now has an entry with a link to the
site map page.</li>

<li>The site map is now part of the <code>@pages</code> array.  It initializes
an <code>HTML::Widgets::NavMenu</code> with the appropriate URL, and then uses
its <code>gen_site_map()</code> function.</li>

<li>There is new code used to generate the navigation links. These links are a
hash reference with the keys being the relevance of the link and the value
being an object supplying information about the link (such as
<code>direct_url()</code> or <code>title()</code>).  There are two loops 
that renders each link into both the HTML <code>&lt;head&gt;</code> tag
<code>&lt;link&gt;</code> elements, or the toolbar to present on the page.</li>

<li>The text of the breadcrumb trail is a <code>join</code> of their HTML
representations.</li>

<li>The generated HTML template includes the new page elements.</li>

</ol>

<h3>Fine-Grained Site Flow</h3>

<p>The <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-site-flow/H-W-NM-fine-grained-site-flow.pl">final
example</a> modifies the site to have a more sophisticated site flow. <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/embellish-2-fine-grained-delta.diff">Looking
at the changes</a> shows several more additions.  Their implications are:</p>

<ol>

<li>Both English resum&eacute;s have a <code>'skip' =&gt; 1,</code> pair. This
caused these pages to <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-site-flow/dest/me/resumes/">appear
in the navigation menu</a>, but not to be part of the traversal flow.  Clicking
&quot;next&quot; at that page will skip them both.  Pressing &quot;prev&quot; at <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-site-flow/dest/humour/">the
page that follows them</a> leads to the page that precedes them.</li>

<li>The Humour section has its <code>'show_always'</code> attribute set,
causing it to expand on all pages of the site.</li>

<li><code>'expand'</code> is a regular expression for the Software section. As
a result, accessing <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-site-flow/dest/perl/japhs/">a
page not specified in the navigation menu</a> but that matches that regular
expression causes the Software section to expand there.</li>

<li><a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-site-flow/dest/software-tools">
The software tools page</a> entry has the attribute <code>'hide' =&gt;
1</code>.  This removes it from the navigation menu but allows it to appear in
the site flow.  Clicking on &quot;next&quot; on <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-site-flow/dest/open-source/bits.html">the
preceding page</a> will reach it.</li>

</ol>

<h3>A CGI Script</h3>

<p>Until now, the examples have demonstrated generating a set of static HTML
pages. The code can also run dynamically on a server. One approach is to use
the ubiquitous <a href="http://search.cpan.org/dist/CGI.pm/">CGI.pm</a>, which
comes bundled with Perl.</p>

<p>Converting to <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/cgi-script/H-W-NM-serve.pl.html">the
CGI script</a> required <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-2-cgi.diff.html"
rel="patch">few changes</a>. Inside of the page loop, the code checks if the page
matches the CGI path info (the path appended after the CGI script name). If
so, the code calls the <code>render_page()</code> function.</p>

<p><code>render_page()</code> is similar to the rest of the loop except that it
prints the output to <code>STDOUT</code> <em>after</em> the CGI header. Finally, after the
loop ends, the code checks that it has found a page.  If not, it displays an
error page.</p>

<p>Note that the way this script looks for a suitable page is suboptimal. A
better-engineered script might keep the page paths in a persistent hash or
other data structure from which to look up the path info.</p>

<h3>Conclusion</h3>

<p>This article demonstrated how to use HTML::Widgets::NavMenu to maintain
navigation menus and organize site flow. Reading its documentation may reveal
other useful features. Now you no longer have an excuse for lacking the
niceties demonstrated here on your site. Happy hacking!</p>

<h3>Acknowledgments</h3>

<p>Thanks to Diego Iastrubni, Aankehn, and chromatic (my editor) for giving some useful commentary on early drafts of this document.</p>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-778" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/06/catalyst.html" rel="bookmark">Catalyst</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Jesse Sheidlower</span> on <abbr class="published" title="2005-06-02T00:00:00-08:00">June  2, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<p>Web frameworks are an area of significant interest at the moment. Now that
we've all learned the basics of web programming, we're ready to get the
common stuff out of the way to concentrate on the task at hand; no one wants to
spend time rewriting the same bits of glue to handle parameter processing,
request dispatching, and the like.</p>

<p>A model currently favored for web applications is <em>MVC</em>, or
Model-View-Controller. This design pattern, originally from Smalltalk, supports
the separation of the three main areas of an application--handling application
flow (Controller), processing information (Model), and outputting results
(View)--so that it is possible to change or replace any one without affecting
the others.</p>

<p>Catalyst is a new MVC framework for Perl. It is currently under rapid
development, but the core API is now stable, and a growing number of projects
use it.  Catalyst borrows from other frameworks, such as Ruby on Rails and
Apache Struts, but its main goal is to be a flexible, powerful, and fast
framework for developing any type of web project in Perl. This article, the
first of a series of two, introduces Catalyst and shows a simple application; a later
article will demonstrate how to write a more complex project.</p>

<h4>Inspirations</h4>

<p>Catalyst grew out of Maypole, an MVC framework developed by Simon Cozens
(and discussed last year on Perl.com; see "<a
href="/pub/a/2004/04/15/maypole.html">Rapid Web Application
Development with Maypole</a>," for example). Maypole works well for typical CRUD (Create, Retrieve, Update, Delete)
databases on the Web. It includes a variety
of useful methods and prewritten templates and template macros that make it
very easy to set up a powerful web database.  However, it focuses so strongly
on CRUD that it is less flexible for other tasks. One of the goals of Catalyst
is to provide a framework well suited for any web-related project.</p>

<p><a href="http://www.rubyonrails.org/">Ruby on Rails</a> was another
inspiration; this popular system has done much to promote interest in the Ruby
programming language. Features we borrowed from RoR are the use of helper
scripts to generate application components and the ability to have multiple
controllers in a single application. Both RoR and Struts allow the use of
forwarding within applications, which also proved useful for Catalyst.</p>

<h4>Features</h4>

<h5>Speed</h5>
<p>We planned Catalyst as an enterprise-level framework, able to handle a significant
    load. It makes heavy use of caching. Catalyst applications register their actions
    in the dispatcher at compile time, making it possible to process runtime requests
    quickly, without needing elaborate checks. Regex dispatches are all precompiled.
    Catalyst builds only the structures it needs, so there are no delays to generate
    (for example) unused database relations.</p>
<h5>Simplicity</h5>
<p><em>Components</em></p>
<p>Catalyst has many prebuilt components and plugins for common modules and tasks.
          For example, there are <code>View</code> classes available for Template Toolkit, HTML::Template,
          Mason, Petal, and PSP. Plugins are available for dozens of applications and
          functions, including <a
href="http://search.cpan.org/perldoc?Data::FormValidator">Data::FormValidator</a>,
          authentication based on LDAP or <a
href="http://search.cpan.org/perldoc?Class::DBI">Class::DBI</a>, several caching
          modules, <a
href="http://search.cpan.org/perldoc?HTML::FillInForm">HTML::FillInForm</a>,
          and XML-RPC.</p>
<p>Catalyst supports component auto-discovery; if you put a component in the
    correct place, Catalyst will find and load it automagically. Just place a Catalog
    controller in <em>/AppName/Controller/Catalog.pm</em> (or, in practice, in the
    shortened <em>/AppName/C/Catalog.pm</em>); there's no need to <code>use</code> each
    item. You can also declare plugins in the application class with short names,
    so that:</p>
<pre><code>use Catalyst qw/Email Prototype Textile/;</code></pre>
<p>will load <code>Catalyst::Plugin::Email</code>, <code>Catalyst::Plugin::Prototype</code>,
    and <code>Catalyst::Plugin::Textile</code> in one shot.</p>
<p><em>Development</em></p>
<p>Catalyst comes with a built-in lightweight HTTP server for development purposes.
    This runs on any platform; you can quickly restart it to reload any changes.
    This server functions similarly to production-level servers, so you can use
    it throughout the testing process--or longer; it's a great choice if you want
    to deliver a self-contained desktop application. Scalability is simple, though:
    when you want to move on, it is trivial to switch the engine to use plain CGI,
    <code>mod_perl1</code>, <code>mod_perl2</code>, FastCGI, or even the Zeus web server.</p>
<p>Debugging (Figure 1) and logging (Figure 2) support is also built-in. With
    debugging enabled, Catalyst sends very detailed reports to the error log, including
    summaries of the loaded components, fine-grained timing of each action and
    request, argument listings for requests, and more. Logging works by using the
    the <code>Catalyst::Log</code> class; you can log any action for debugging
    or information purposes by adding lines like:</p>
<pre><code>$c-&gt;log-&gt;info(&quot;We made it past the for loop&quot;);
$c-&gt;log-&gt;debug( $sql_query );</code></pre>
<p><img src="/pub/2005/06/02/graphics/log-screenshot.gif" width="515" height="411" alt="Log screenshot" /><br />
  <em>Figure 1. Logging</em></p>
<p>Crashes will display a flashy debug screen showing details of relevant data
    structures, software and OS versions, and the line numbers of errors.</p>
<p><img src="/pub/2005/06/02/graphics/debug-screenshot.gif" width="515" height="376" alt="Debug screenshot" /><br />
  <em>Figure 2. Debugging</em></p>
<p>Helper scripts, generated with Template Toolkit, are available for the main
    application and most components. These allow you to quickly generate starter code (including
    basic unit tests) for the application framework. With a single line,
    you can create a <code>Model</code> class based on <code>Class::DBI</code> that pulls in
    the appropriate Catalyst base model class, sets up the pattern for the CDBI
    configuration hash, and generates a <code>perldoc</code> skeleton.</p>
<h5>Flexibility</h5>
Catalyst allows you to use multiple models, views, and controllers--not just
as an option when setting up an application, but as a totally flexible part of
an application's flow. You can mix and match different elements within the same
application or even within the same method. Want to use <code>Class::DBI</code> for
your database storage and LDAP for authentication? You can have two models. Want
to use Template Toolkit for web display and <a
href="http://search.cpan.org/perldoc?PDF::Template">PDF::Template</a> for print
output? No problem. Catalyst uses a simple building-block approach to its add-ins:
if you want to use a component, you say so, and if you don't say so, Catalyst
won't use it. With so many components and plugins available, based on CPAN modules,
it's easy to use what you want, but you don't have to use something you don't
need. Catalyst features advanced URL-to-action dispatching. There are multiple
ways to map a URL to an action (that is, a Catalyst method), depending on your
requirements. First, there is literal dispatching, which will match a specific
path:
<pre><code>package MyApp::C::Quux;

# matches only http://localhost:3000/foo/bar/yada
sub baz : Path('foo/bar/yada') { }</code></pre>

<p>A top-level, or global, dispatch matches the method name directly at the application
  base:</p>

<pre><code>package MyApp::C::Foo;

# matches only http://localhost:3000/bar
sub bar : Global { }</code></pre>

<p>A local, or namespace-prefixed, dispatch acts only in the namespace derived
  from the name of your Controller class:</p>
<pre><code>package MyApp::C::Catalog::Product;

# matches http://localhost:3000/catalog/product/buy
sub buy : Local { }

package MyApp::C::Catalog::Order;

# matches http://localhost:3000/catalog/order/review
sub review : Local { }</code></pre>

<p>The most flexible is a regex dispatch, which acts on a URL that matches the
  pattern in the key. If you use capturing parentheses, the matched values are
  available in the <code>$c-&gt;request-&gt;snippets</code> array.</p>

<pre><code>package MyApp::C::Catalog;

# will match http://localhost:3000/item23/order189
sub bar : Regex('^item(\d+)/order(\d+)$') { 
   my ( $self, $c ) = @_;
   my $item_number  = $c-&gt;request-&gt;snippets-&gt;[0];
   my $order_number = $c-&gt;request-&gt;snippets-&gt;[1];
   # ...    
}</code></pre>

<p>The regex will act globally; if you want it to act only on a namespace, use
  the name of the namespace in the body of the regex:</p>

<pre><code>sub foo : Regex('^catalog/item(\d+)$') { # ...</code></pre>

<p>Finally, you can have private methods, which are never available through URLs.
  You can only reach them from within the application, with a namespace-prefixed
  path:</p>

<pre><code>package MyApp::C::Foo;
# matches nothing, and is only available via $c-&gt;forward('/foo/bar').
sub bar : Private { }</code></pre>

<p>A single <code>Context</code> object (<code>$context</code>, or more usually as its alias <code>$c</code>)
  is available throughout the application, and is the primary way of interacting
  with other elements. Through this object, you can access the request object
  (<code>$c-&gt;request-&gt;params</code> will return or set parameters, <code>$c-&gt;request-&gt;cookies</code> will
  return or set cookies), share data among components, and control the flow of
  your application. A response object contains response-specific information
  (<code>$c-&gt;response-&gt;status(404)</code>) and the <code>Catalyst::Log</code> class
  is made directly available, as shown above. The <code>stash</code> is a universal hash
  for sharing data among application components:</p>
  
<pre><code>$c-&gt;stash-&gt;{error_message} = &quot;You must select an entry&quot;;

# then, in a TT template:
[% IF error_message %]
   &lt;h3&gt;[% error_message %]&lt;/h3&gt;
[% END %]</code></pre>

<p>Stash values go directly into the templates, but the entire context object
  is also available:</p>
<pre><code>&lt;h1&gt;[% c.config.name %]&lt;/h1&gt;</code></pre>

<p>To show a Mason example, if you want to use <code>Catalyst::View::Mason</code>:</p>
<pre><code>% foreach my $k (keys $c-&gt;req-&gt;params) {
  param: &lt;% $k %&gt;: value: &lt;% $c-&gt;req-&gt;params-&gt;{$k} %&gt;
% }</code></pre>













<h3>Sample Application: MiniMojo, an Ajax-Based Wiki in 30 Lines of Written
Code</h3>

<p>Now that you have a sense of what Catalyst is, it's time to look at what it
can do. The example application is MiniMojo, a wiki based on <a
href="http://www.adaptivepath.com/publications/essays/archives/000385.php">Ajax</a>,
which is a JavaScript framework that uses the <code>XMLHttpRequest</code> object to create
highly dynamic web pages without needing to send full pages back and forth
between the server and client.</p>

<p>Remember that from the Catalyst perspective, Ajax is just a case of sending
more text to the browser, except that this text is in the form of client-side
JavaScript that talks to the server, rather than a boilerplate copyright notice
or a navigation sidebar.  It makes no difference to Catalyst.</p>

<h4>Installation</h4>

<p>Catalyst has a relatively large number of requirements; most, however, are
easy to install, along with their dependencies, from CPAN. The following list
should take care of everything you need for this project:</p>

<ul>
<li><a href="http://search.cpan.org/perldoc?Catalyst">Catalyst</a></li> 
<li><a
href="http://search.cpan.org/perldoc?Catalyst::Model::CDBI">Catalyst::Model::CDBI</a></li>
<li><a
href="http://search.cpan.org/perldoc?Class::DBI::SQLite">Class::DBI::SQLite</a></li> 
<li><a
href="http://search.cpan.org/perldoc?Catalyst::View::TT">Catalyst::View::TT</a> </li>
<li><a
href="http://search.cpan.org/perldoc?Catalyst::Plugin::Textile">Catalyst::Plugin::Textile</a> </li>
<li><a
href="http://search.cpan.org/perldoc?Catalyst::Plugin::Prototype">Catalyst::Plugin::Prototype</a></li> 
<li><a href="http://www.sqlite.org/">SQLite</a> (the
binary, not the Perl module)</li>
</ul>

<h4>Generate the Application Skeleton</h4>

<p>Run this command:</p>

<pre><code>$ catalyst.pl MiniMojo
$ cd MiniMojo</code></pre>

<p>You've just created the skeleton for your entire application, complete with
a helper script keyed to MiniMojo to generate individual classes, basic test
scripts, and more.</p>

<p>Run the built-in server:</p>

<pre><code>$ script/minimojo_server.pl</code></pre>

<p>MiniMojo is already running, though it isn't doing much
just yet. (You should have received a web page consisting solely
of the text &quot;Congratulations, MiniMojo is on Catalyst!&quot;)  Press
<code>Ctrl</code>-<code>C</code> to stop the server.</p>

<h4>Add Basic Methods to Your Application Class</h4>

<p>Add a private <code>end</code> action to your application class,
<em>lib/MiniMojo.pm</em>, by editing the new file:</p>

<pre><code>sub end : Private {
    my ( $self, $c ) = @_;
    $c-&gt;forward('MiniMojo::V::TT') unless $c-&gt;res-&gt;output;
}</code></pre>

<p>Catalyst automatically calls the <code>end</code> action at the end of a
request cycle.  It's one of four built-in Private actions. It's a typical
pattern in Catalyst to use <code>end</code> to forward the application to the
View component for rendering, though if necessary you could do it yourself (for
example, if you want to use different Views in the same application--perhaps
one to generate web pages with Template Toolkit and another to generate PDFs
with PDF::Template).</p>

<p>Replace the existing, helper-generated <code>default</code>
action in the same class with:</p>

<pre><code>sub default : Private {
    my ( $self, $c ) = @_;
    $c-&gt;forward('/page/show');
}</code></pre>

<p>In case the client has specified no other appropriate action, this will
forward on to the page controller's <code>show</code> method. As Private
actions, nothing can call these from outside the application. Any method from
within the application can call them.  The <code>default</code> action is
another built-in Private action, along with <code>begin</code>,
<code>auto</code>, and <code>end</code>.  Again, Catalyst calls them
automatically at relevant points in the request cycle.</p>

<h4>Set Up the Model (SQLite Database) and Use the Helper to Create Model
Classes</h4>

<p>Next, create a file, <em>minimojo.sql</em>, that contains the SQL for setting
up your <code>page</code> table in SQLite.</p>

<pre><code>-- minimojo.sql
CREATE TABLE page (
    id INTEGER PRIMARY KEY,
    title TEXT,
    body TEXT
);</code></pre>

<p>Create a database from it, using the <code>sqlite</code> command-line
program:</p>

<pre><code>$ sqlite minimojo.db &lt; minimojo.sql</code></pre>

<p>Depending on your setup, it might be necessary to call this as <code>sqlite3</code>.</p>

<p>Use the helper to create model classes and basic unit tests (Figure 3 shows
the results):</p>

<pre><code>$ script/minimojo_create.pl model CDBI CDBI dbi:SQLite:/path/to/minimojo.db</code></pre>

<p><img src="/pub/2005/06/02/graphics/model-create-screenshot.gif" width="515" height="372" alt="Model-creation screenshot" /><br
/><em>Figure 3. Creating the model</em></p>

<p>The <em>minimojo_create.pl</em> script is a helper that uses Template
Toolkit to automate the creation of particular modules. The previous command
creates a model (in contrast to a controller or a view) called
<em>CDBI.pm</em>, using the CDBI helper, setting the connection string to
<code>dbi:SQLite:/path/to/minimojo.db</code>, the database you just created. (Use the appropriate path for
your system.) The helper will write the models into <em>lib/MiniMojo/M/</em>.
There are various options for the helper scripts; the only requirement is the
type and the name. (You can create your own modules from scratch, without using
the helper.)</p>

<h4>Set Up the View (<code>Template::Toolkit</code>) and Use the Helper to
Create View Classes</h4>

<p>Use the helper to create a view class:</p>

<pre><code>$ script/minimojo_create.pl view TT TT</code></pre>

<p>View classes go into <em>lib/MiniMojo/V/</em>.</p>

<h4>Set Up a Controller Class Using the Helper</h4>

<p>Create a controller class called <code>Page</code> with the helper:</p>

<pre><code>$ script/minimojo_create.pl controller Page</code></pre>

<p>Controller classes live in <em>lib/MiniMojo/C/</em>.</p>

<p>Add a <code>show</code> action to <em>lib/MiniMojo/C/Page.pm</em>:</p>

<pre><code>sub show : Regex('^(\w+)\.html$') {
    my ( $self, $c ) = @_;
    $c-&gt;stash-&gt;{template} = 'view.tt';
    # $c-&gt;forward('page');
}</code></pre>

<p>The <code>Regex</code> dispatch matches a page in <i><code>foo</code>.html</i>, where
<code>foo</code> is any sequence of word characters. This sequence is available
in the <code>$context-&gt;request-&gt;snippets</code> array, where the <code>page</code>
action uses it to display an existing page or to create a new one. The rest of
this action sets the appropriate template and sends the application to the
<code>page</code> action. (Leave the <code>forward</code> command commented out until you have written the <code>page</code> action.)</p>

<p>Restart the server with <code>$ script/minimojo_server.pl</code> and point a web browser to <i>http://localhost:3000/show/</i> to see
the debug screen (you don't yet have the template that <code>show</code> is
trying to send people to).</p>

<p>Create <em>root/view.tt</em>:</p>

<pre><code>&lt;html&gt;
    &lt;head&gt;&lt;title&gt;MiniMojo&lt;/title&gt;&lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;MiniMojo is set up!&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>

<p>Test again by killing the server with <code>Ctrl</code>-<code>C</code> and restarting it, and go to
<i>http://localhost:3000/show/</i>. You should see the page you just
defined.</p>

<h4>Add the Display and Edit Code</h4>

<p>Modify the application class <em>lib/MiniMojo.pm</em> to include the
<code>Prototype</code> and <code>Textile</code> plugins:</p>

<pre><code>use Catalyst qw/-Debug Prototype Textile/;</code></pre>

<p>Note that you can use the plugins by specifying their base names; Catalyst
figures out what you mean without making you use
<code>Catalyst::Plugin::Prototype</code>.</p>

<p>Modify the <code>page</code> controller, <em>lib/MiniMojo/C/Page.pm</em>, to
add page-view and editing code:</p>

<pre><code>sub page : Private {
    my ( $self, $c, $title ) = @_;
    $title ||= $c-&gt;req-&gt;snippets-&gt;[0] || 'Frontpage';
    my $query = { title =&gt; $title };
    $c-&gt;stash-&gt;{page} = MiniMojo::M::CDBI::Page-&gt;find_or_create($query);
}</code></pre>

<p>The private <code>page</code> method sets a title--whether passed in to it,
taken from the <code>snippets</code> array (that matches the regex in
<code>show</code>), or defaulting to &quot;Frontpage.&quot; The <code>$query</code>
variable holds a hashref used for <code>Class::DBI</code>'s
<code>find_or_create</code> method, seeding the stash for the <code>page</code>
variable with the result of this CDBI query. At the end of the method, control
flow returns to the calling method.</p>

<p>Now uncomment the <code>$c-&gt;forward('page');</code> line in the <code>show</code> action.</p>

<pre><code>sub edit : Local {
    my ( $self, $c, $title ) = @_;
    $c-&gt;forward('page');
    $c-&gt;stash-&gt;{page}-&gt;body( $c-&gt;req-&gt;params-&gt;{body} )
      if $c-&gt;req-&gt;params-&gt;{body};
    my $body = $c-&gt;stash-&gt;{page}-&gt;body || 'Just type something...';
    my $html = $c-&gt;textile-&gt;process($body);

    my $base = $c-&gt;req-&gt;base;
    $html    =~ s{(?&lt;![\?\\\/\[])(\b[A-Z][a-z]+[A-Z]\w*)}
                 {&lt;a href=&quot;$base$1.html&quot;&gt;$1&lt;/a&gt;}g;

    $c-&gt;res-&gt;output($html);
}</code></pre>

<p>The <code>edit</code> method first forwards the action off to
<code>page</code>, so that the stash's <code>page</code> object contains the
result of the CDBI query. If there is a value for <code>body</code>, it will
use this; otherwise &quot;Just type something...&quot; is the default. The code then
processes the body with Textile, which converts plain text to HTML, and then runs
the body through a regex to convert camel-case text into links, with the URL
base taken from the Catalyst request object. Finally, it outputs the HTML.</p>

<h4>Set Up the Wiki with Ajax</h4>

<p>Modify <em>root/view.tt</em> to include Ajax code:</p>

<pre><code>&lt;html&gt;
     &lt;head&gt;&lt;title&gt;MiniMojo&lt;/title&gt;&lt;/head&gt;
     [% c.prototype.define_javascript_functions %]
     [% url = base _ 'page/edit/' _ page.title %]
     &lt;body Onload=&quot;new Ajax.Updater( 'view',  '[% url %]' )&quot;&gt;
         &lt;h1&gt;[% page.title %]&lt;/h1&gt;
         &lt;div id=&quot;view&quot;&gt;&lt;/div&gt;
         &lt;textarea id=&quot;editor&quot; rows=&quot;24&quot; cols=&quot;80&quot;&gt;[% page.body %]&lt;/textarea&gt;
         [% c.prototype.observe_field( 'editor', {
             url =&gt; url,
             with =&gt; &quot;'body='+value&quot;,
             update =&gt; 'view' }
         ) %]
     &lt;/body&gt;
&lt;/html&gt;</code></pre>

<p>The line:</p>

<pre><code>[% c.prototype.define_javascript_functions %]</code></pre>

<p>includes the whole <em>prototype.js</em> library in a <code>script</code>
block. Note that the <code>prototype</code> plugin is available in the context
object.</p>

<p>The section</p>

<pre><code>[% url = base _ 'page/edit/' _ page.title %] 
&lt;body Onload=&quot;new Ajax.Updater( 'view',  '[% url %]' )&quot;&gt;
&lt;h1&gt;[% page.title %]&lt;/h1&gt;
&lt;div id=&quot;view&quot;&gt;&lt;/div&gt;</code></pre>

<p>constructs the Ajax URL and updates the view <code>div</code> when loading
the page.</p>

<p>Finally:</p>

<pre><code>&lt;textarea id=&quot;editor&quot; rows=&quot;24&quot; cols=&quot;80&quot;&gt;[% page.body %]&lt;/textarea&gt;
    [% c.prototype.observe_field( 'editor', {
        url =&gt; url,
        with =&gt; &quot;'body='+value&quot;,
        update =&gt; 'view' }
    ) %]</code></pre>

<p>periodically checks the <code>textarea</code> for changes and makes an Ajax
request on demand.</p>

<p>That's it! Now you can re-run the server and your wiki is up and running
(Figure 4). To use the wiki, simply start typing in the <code>textarea</code>.
As you type, the wiki will regularly echo your entry above, passing it through
the formatter.  When you type something in camel case, it will automatically
create a link you can click to go to the new page.</p>

<p><img src="/pub/2005/06/02/graphics/running-wiki-screenshot.gif" width="515" height="376" alt="screenshot of the running wiki"
/><br /><em>Figure 4. The running wiki</em></p>

<p>Enjoy your new Catalyst-powered Ajax wiki!</p>

<h3>Resources</h3>

<p>For more information, see the Catalyst documentation, in particular the <a
href="http://search.cpan.org/perldoc?Catalyst::Manual::Intro">Catalyst::Manual::Intro
module</a>, which gives a thorough introduction to the framework. There are two
<a href="http://lists.rawmode.org/mailman/listinfo">Catalyst mailing lists</a>,
a general list and a developer list.  The best place to discuss Catalyst,
though, is the <i>#catalyst</i> IRC channel at <a
href="http://irc.perl.org">irc.perl.org</a>. The <a
href="http://catalyst.perl.org/">Catalyst home page</a> is currently just a
collection of a few links, but we will extend it in the near future.</p>

<p>Thanks to Catalyst lead developer Sebastian Riedel for help with this
article and, of course, for Catalyst itself.</p>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1714" template="b/article_sidebar2.view">
<!-- sidebar ends -->


        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/debugging/">&laquo; Debugging</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/editors/">Editors &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.02" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
