<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/2005/06/02/catalyst.html">
<dc:title>Catalyst</dc:title>
<dc:description> Web frameworks are an area of significant interest at the moment. Now that we&apos;ve all learned the basics of web programming, we&apos;re ready to get the common stuff out of the way to concentrate on the task at hand;...</dc:description>
<dc:creator>Jesse Sheidlower</dc:creator>
<dc:date>2005-06-02T00:00:00-08:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    
    <link rel="prev bookmark" href="/pub/2005/05/p6pdigest/20050526.html" title="This Week in Perl 6, May 18 - 24, 2005" />
    <link rel="next bookmark" href="/pub/2005/06/p6pdigest/20050602.html" title="This Week in Perl 6, May 25, 2005-May 31, 2005" />
    
    
    <title>Catalyst - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-778" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Catalyst</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Jesse Sheidlower</span> on <abbr class="published" title="2005-06-02T00:00:00-08:00">June  2, 2005 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<p>Web frameworks are an area of significant interest at the moment. Now that
we've all learned the basics of web programming, we're ready to get the
common stuff out of the way to concentrate on the task at hand; no one wants to
spend time rewriting the same bits of glue to handle parameter processing,
request dispatching, and the like.</p>

<p>A model currently favored for web applications is <em>MVC</em>, or
Model-View-Controller. This design pattern, originally from Smalltalk, supports
the separation of the three main areas of an application--handling application
flow (Controller), processing information (Model), and outputting results
(View)--so that it is possible to change or replace any one without affecting
the others.</p>

<p>Catalyst is a new MVC framework for Perl. It is currently under rapid
development, but the core API is now stable, and a growing number of projects
use it.  Catalyst borrows from other frameworks, such as Ruby on Rails and
Apache Struts, but its main goal is to be a flexible, powerful, and fast
framework for developing any type of web project in Perl. This article, the
first of a series of two, introduces Catalyst and shows a simple application; a later
article will demonstrate how to write a more complex project.</p>

<h4>Inspirations</h4>

<p>Catalyst grew out of Maypole, an MVC framework developed by Simon Cozens
(and discussed last year on Perl.com; see "<a
href="/pub/a/2004/04/15/maypole.html">Rapid Web Application
Development with Maypole</a>," for example). Maypole works well for typical CRUD (Create, Retrieve, Update, Delete)
databases on the Web. It includes a variety
of useful methods and prewritten templates and template macros that make it
very easy to set up a powerful web database.  However, it focuses so strongly
on CRUD that it is less flexible for other tasks. One of the goals of Catalyst
is to provide a framework well suited for any web-related project.</p>

<p><a href="http://www.rubyonrails.org/">Ruby on Rails</a> was another
inspiration; this popular system has done much to promote interest in the Ruby
programming language. Features we borrowed from RoR are the use of helper
scripts to generate application components and the ability to have multiple
controllers in a single application. Both RoR and Struts allow the use of
forwarding within applications, which also proved useful for Catalyst.</p>

<h4>Features</h4>

<h5>Speed</h5>
<p>We planned Catalyst as an enterprise-level framework, able to handle a significant
    load. It makes heavy use of caching. Catalyst applications register their actions
    in the dispatcher at compile time, making it possible to process runtime requests
    quickly, without needing elaborate checks. Regex dispatches are all precompiled.
    Catalyst builds only the structures it needs, so there are no delays to generate
    (for example) unused database relations.</p>
<h5>Simplicity</h5>
<p><em>Components</em></p>
<p>Catalyst has many prebuilt components and plugins for common modules and tasks.
          For example, there are <code>View</code> classes available for Template Toolkit, HTML::Template,
          Mason, Petal, and PSP. Plugins are available for dozens of applications and
          functions, including <a
href="http://search.cpan.org/perldoc?Data::FormValidator">Data::FormValidator</a>,
          authentication based on LDAP or <a
href="http://search.cpan.org/perldoc?Class::DBI">Class::DBI</a>, several caching
          modules, <a
href="http://search.cpan.org/perldoc?HTML::FillInForm">HTML::FillInForm</a>,
          and XML-RPC.</p>
<p>Catalyst supports component auto-discovery; if you put a component in the
    correct place, Catalyst will find and load it automagically. Just place a Catalog
    controller in <em>/AppName/Controller/Catalog.pm</em> (or, in practice, in the
    shortened <em>/AppName/C/Catalog.pm</em>); there's no need to <code>use</code> each
    item. You can also declare plugins in the application class with short names,
    so that:</p>
<pre><code>use Catalyst qw/Email Prototype Textile/;</code></pre>
<p>will load <code>Catalyst::Plugin::Email</code>, <code>Catalyst::Plugin::Prototype</code>,
    and <code>Catalyst::Plugin::Textile</code> in one shot.</p>
<p><em>Development</em></p>
<p>Catalyst comes with a built-in lightweight HTTP server for development purposes.
    This runs on any platform; you can quickly restart it to reload any changes.
    This server functions similarly to production-level servers, so you can use
    it throughout the testing process--or longer; it's a great choice if you want
    to deliver a self-contained desktop application. Scalability is simple, though:
    when you want to move on, it is trivial to switch the engine to use plain CGI,
    <code>mod_perl1</code>, <code>mod_perl2</code>, FastCGI, or even the Zeus web server.</p>
<p>Debugging (Figure 1) and logging (Figure 2) support is also built-in. With
    debugging enabled, Catalyst sends very detailed reports to the error log, including
    summaries of the loaded components, fine-grained timing of each action and
    request, argument listings for requests, and more. Logging works by using the
    the <code>Catalyst::Log</code> class; you can log any action for debugging
    or information purposes by adding lines like:</p>
<pre><code>$c-&gt;log-&gt;info(&quot;We made it past the for loop&quot;);
$c-&gt;log-&gt;debug( $sql_query );</code></pre>
<p><img src="/pub/2005/06/02/graphics/log-screenshot.gif" width="515" height="411" alt="Log screenshot" /><br />
  <em>Figure 1. Logging</em></p>
<p>Crashes will display a flashy debug screen showing details of relevant data
    structures, software and OS versions, and the line numbers of errors.</p>
<p><img src="/pub/2005/06/02/graphics/debug-screenshot.gif" width="515" height="376" alt="Debug screenshot" /><br />
  <em>Figure 2. Debugging</em></p>
<p>Helper scripts, generated with Template Toolkit, are available for the main
    application and most components. These allow you to quickly generate starter code (including
    basic unit tests) for the application framework. With a single line,
    you can create a <code>Model</code> class based on <code>Class::DBI</code> that pulls in
    the appropriate Catalyst base model class, sets up the pattern for the CDBI
    configuration hash, and generates a <code>perldoc</code> skeleton.</p>
<h5>Flexibility</h5>
Catalyst allows you to use multiple models, views, and controllers--not just
as an option when setting up an application, but as a totally flexible part of
an application's flow. You can mix and match different elements within the same
application or even within the same method. Want to use <code>Class::DBI</code> for
your database storage and LDAP for authentication? You can have two models. Want
to use Template Toolkit for web display and <a
href="http://search.cpan.org/perldoc?PDF::Template">PDF::Template</a> for print
output? No problem. Catalyst uses a simple building-block approach to its add-ins:
if you want to use a component, you say so, and if you don't say so, Catalyst
won't use it. With so many components and plugins available, based on CPAN modules,
it's easy to use what you want, but you don't have to use something you don't
need. Catalyst features advanced URL-to-action dispatching. There are multiple
ways to map a URL to an action (that is, a Catalyst method), depending on your
requirements. First, there is literal dispatching, which will match a specific
path:
<pre><code>package MyApp::C::Quux;

# matches only http://localhost:3000/foo/bar/yada
sub baz : Path('foo/bar/yada') { }</code></pre>

<p>A top-level, or global, dispatch matches the method name directly at the application
  base:</p>

<pre><code>package MyApp::C::Foo;

# matches only http://localhost:3000/bar
sub bar : Global { }</code></pre>

<p>A local, or namespace-prefixed, dispatch acts only in the namespace derived
  from the name of your Controller class:</p>
<pre><code>package MyApp::C::Catalog::Product;

# matches http://localhost:3000/catalog/product/buy
sub buy : Local { }

package MyApp::C::Catalog::Order;

# matches http://localhost:3000/catalog/order/review
sub review : Local { }</code></pre>

<p>The most flexible is a regex dispatch, which acts on a URL that matches the
  pattern in the key. If you use capturing parentheses, the matched values are
  available in the <code>$c-&gt;request-&gt;snippets</code> array.</p>

<pre><code>package MyApp::C::Catalog;

# will match http://localhost:3000/item23/order189
sub bar : Regex('^item(\d+)/order(\d+)$') { 
   my ( $self, $c ) = @_;
   my $item_number  = $c-&gt;request-&gt;snippets-&gt;[0];
   my $order_number = $c-&gt;request-&gt;snippets-&gt;[1];
   # ...    
}</code></pre>

<p>The regex will act globally; if you want it to act only on a namespace, use
  the name of the namespace in the body of the regex:</p>

<pre><code>sub foo : Regex('^catalog/item(\d+)$') { # ...</code></pre>

<p>Finally, you can have private methods, which are never available through URLs.
  You can only reach them from within the application, with a namespace-prefixed
  path:</p>

<pre><code>package MyApp::C::Foo;
# matches nothing, and is only available via $c-&gt;forward('/foo/bar').
sub bar : Private { }</code></pre>

<p>A single <code>Context</code> object (<code>$context</code>, or more usually as its alias <code>$c</code>)
  is available throughout the application, and is the primary way of interacting
  with other elements. Through this object, you can access the request object
  (<code>$c-&gt;request-&gt;params</code> will return or set parameters, <code>$c-&gt;request-&gt;cookies</code> will
  return or set cookies), share data among components, and control the flow of
  your application. A response object contains response-specific information
  (<code>$c-&gt;response-&gt;status(404)</code>) and the <code>Catalyst::Log</code> class
  is made directly available, as shown above. The <code>stash</code> is a universal hash
  for sharing data among application components:</p>
  
<pre><code>$c-&gt;stash-&gt;{error_message} = &quot;You must select an entry&quot;;

# then, in a TT template:
[% IF error_message %]
   &lt;h3&gt;[% error_message %]&lt;/h3&gt;
[% END %]</code></pre>

<p>Stash values go directly into the templates, but the entire context object
  is also available:</p>
<pre><code>&lt;h1&gt;[% c.config.name %]&lt;/h1&gt;</code></pre>

<p>To show a Mason example, if you want to use <code>Catalyst::View::Mason</code>:</p>
<pre><code>% foreach my $k (keys $c-&gt;req-&gt;params) {
  param: &lt;% $k %&gt;: value: &lt;% $c-&gt;req-&gt;params-&gt;{$k} %&gt;
% }</code></pre>













<h3>Sample Application: MiniMojo, an Ajax-Based Wiki in 30 Lines of Written
Code</h3>

<p>Now that you have a sense of what Catalyst is, it's time to look at what it
can do. The example application is MiniMojo, a wiki based on <a
href="http://www.adaptivepath.com/publications/essays/archives/000385.php">Ajax</a>,
which is a JavaScript framework that uses the <code>XMLHttpRequest</code> object to create
highly dynamic web pages without needing to send full pages back and forth
between the server and client.</p>

<p>Remember that from the Catalyst perspective, Ajax is just a case of sending
more text to the browser, except that this text is in the form of client-side
JavaScript that talks to the server, rather than a boilerplate copyright notice
or a navigation sidebar.  It makes no difference to Catalyst.</p>

<h4>Installation</h4>

<p>Catalyst has a relatively large number of requirements; most, however, are
easy to install, along with their dependencies, from CPAN. The following list
should take care of everything you need for this project:</p>

<ul>
<li><a href="http://search.cpan.org/perldoc?Catalyst">Catalyst</a></li> 
<li><a
href="http://search.cpan.org/perldoc?Catalyst::Model::CDBI">Catalyst::Model::CDBI</a></li>
<li><a
href="http://search.cpan.org/perldoc?Class::DBI::SQLite">Class::DBI::SQLite</a></li> 
<li><a
href="http://search.cpan.org/perldoc?Catalyst::View::TT">Catalyst::View::TT</a> </li>
<li><a
href="http://search.cpan.org/perldoc?Catalyst::Plugin::Textile">Catalyst::Plugin::Textile</a> </li>
<li><a
href="http://search.cpan.org/perldoc?Catalyst::Plugin::Prototype">Catalyst::Plugin::Prototype</a></li> 
<li><a href="http://www.sqlite.org/">SQLite</a> (the
binary, not the Perl module)</li>
</ul>

<h4>Generate the Application Skeleton</h4>

<p>Run this command:</p>

<pre><code>$ catalyst.pl MiniMojo
$ cd MiniMojo</code></pre>

<p>You've just created the skeleton for your entire application, complete with
a helper script keyed to MiniMojo to generate individual classes, basic test
scripts, and more.</p>

<p>Run the built-in server:</p>

<pre><code>$ script/minimojo_server.pl</code></pre>

<p>MiniMojo is already running, though it isn't doing much
just yet. (You should have received a web page consisting solely
of the text &quot;Congratulations, MiniMojo is on Catalyst!&quot;)  Press
<code>Ctrl</code>-<code>C</code> to stop the server.</p>

<h4>Add Basic Methods to Your Application Class</h4>

<p>Add a private <code>end</code> action to your application class,
<em>lib/MiniMojo.pm</em>, by editing the new file:</p>

<pre><code>sub end : Private {
    my ( $self, $c ) = @_;
    $c-&gt;forward('MiniMojo::V::TT') unless $c-&gt;res-&gt;output;
}</code></pre>

<p>Catalyst automatically calls the <code>end</code> action at the end of a
request cycle.  It's one of four built-in Private actions. It's a typical
pattern in Catalyst to use <code>end</code> to forward the application to the
View component for rendering, though if necessary you could do it yourself (for
example, if you want to use different Views in the same application--perhaps
one to generate web pages with Template Toolkit and another to generate PDFs
with PDF::Template).</p>

<p>Replace the existing, helper-generated <code>default</code>
action in the same class with:</p>

<pre><code>sub default : Private {
    my ( $self, $c ) = @_;
    $c-&gt;forward('/page/show');
}</code></pre>

<p>In case the client has specified no other appropriate action, this will
forward on to the page controller's <code>show</code> method. As Private
actions, nothing can call these from outside the application. Any method from
within the application can call them.  The <code>default</code> action is
another built-in Private action, along with <code>begin</code>,
<code>auto</code>, and <code>end</code>.  Again, Catalyst calls them
automatically at relevant points in the request cycle.</p>

<h4>Set Up the Model (SQLite Database) and Use the Helper to Create Model
Classes</h4>

<p>Next, create a file, <em>minimojo.sql</em>, that contains the SQL for setting
up your <code>page</code> table in SQLite.</p>

<pre><code>-- minimojo.sql
CREATE TABLE page (
    id INTEGER PRIMARY KEY,
    title TEXT,
    body TEXT
);</code></pre>

<p>Create a database from it, using the <code>sqlite</code> command-line
program:</p>

<pre><code>$ sqlite minimojo.db &lt; minimojo.sql</code></pre>

<p>Depending on your setup, it might be necessary to call this as <code>sqlite3</code>.</p>

<p>Use the helper to create model classes and basic unit tests (Figure 3 shows
the results):</p>

<pre><code>$ script/minimojo_create.pl model CDBI CDBI dbi:SQLite:/path/to/minimojo.db</code></pre>

<p><img src="/pub/2005/06/02/graphics/model-create-screenshot.gif" width="515" height="372" alt="Model-creation screenshot" /><br
/><em>Figure 3. Creating the model</em></p>

<p>The <em>minimojo_create.pl</em> script is a helper that uses Template
Toolkit to automate the creation of particular modules. The previous command
creates a model (in contrast to a controller or a view) called
<em>CDBI.pm</em>, using the CDBI helper, setting the connection string to
<code>dbi:SQLite:/path/to/minimojo.db</code>, the database you just created. (Use the appropriate path for
your system.) The helper will write the models into <em>lib/MiniMojo/M/</em>.
There are various options for the helper scripts; the only requirement is the
type and the name. (You can create your own modules from scratch, without using
the helper.)</p>

<h4>Set Up the View (<code>Template::Toolkit</code>) and Use the Helper to
Create View Classes</h4>

<p>Use the helper to create a view class:</p>

<pre><code>$ script/minimojo_create.pl view TT TT</code></pre>

<p>View classes go into <em>lib/MiniMojo/V/</em>.</p>

<h4>Set Up a Controller Class Using the Helper</h4>

<p>Create a controller class called <code>Page</code> with the helper:</p>

<pre><code>$ script/minimojo_create.pl controller Page</code></pre>

<p>Controller classes live in <em>lib/MiniMojo/C/</em>.</p>

<p>Add a <code>show</code> action to <em>lib/MiniMojo/C/Page.pm</em>:</p>

<pre><code>sub show : Regex('^(\w+)\.html$') {
    my ( $self, $c ) = @_;
    $c-&gt;stash-&gt;{template} = 'view.tt';
    # $c-&gt;forward('page');
}</code></pre>

<p>The <code>Regex</code> dispatch matches a page in <i><code>foo</code>.html</i>, where
<code>foo</code> is any sequence of word characters. This sequence is available
in the <code>$context-&gt;request-&gt;snippets</code> array, where the <code>page</code>
action uses it to display an existing page or to create a new one. The rest of
this action sets the appropriate template and sends the application to the
<code>page</code> action. (Leave the <code>forward</code> command commented out until you have written the <code>page</code> action.)</p>

<p>Restart the server with <code>$ script/minimojo_server.pl</code> and point a web browser to <i>http://localhost:3000/show/</i> to see
the debug screen (you don't yet have the template that <code>show</code> is
trying to send people to).</p>

<p>Create <em>root/view.tt</em>:</p>

<pre><code>&lt;html&gt;
    &lt;head&gt;&lt;title&gt;MiniMojo&lt;/title&gt;&lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;MiniMojo is set up!&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>

<p>Test again by killing the server with <code>Ctrl</code>-<code>C</code> and restarting it, and go to
<i>http://localhost:3000/show/</i>. You should see the page you just
defined.</p>

<h4>Add the Display and Edit Code</h4>

<p>Modify the application class <em>lib/MiniMojo.pm</em> to include the
<code>Prototype</code> and <code>Textile</code> plugins:</p>

<pre><code>use Catalyst qw/-Debug Prototype Textile/;</code></pre>

<p>Note that you can use the plugins by specifying their base names; Catalyst
figures out what you mean without making you use
<code>Catalyst::Plugin::Prototype</code>.</p>

<p>Modify the <code>page</code> controller, <em>lib/MiniMojo/C/Page.pm</em>, to
add page-view and editing code:</p>

<pre><code>sub page : Private {
    my ( $self, $c, $title ) = @_;
    $title ||= $c-&gt;req-&gt;snippets-&gt;[0] || 'Frontpage';
    my $query = { title =&gt; $title };
    $c-&gt;stash-&gt;{page} = MiniMojo::M::CDBI::Page-&gt;find_or_create($query);
}</code></pre>

<p>The private <code>page</code> method sets a title--whether passed in to it,
taken from the <code>snippets</code> array (that matches the regex in
<code>show</code>), or defaulting to &quot;Frontpage.&quot; The <code>$query</code>
variable holds a hashref used for <code>Class::DBI</code>'s
<code>find_or_create</code> method, seeding the stash for the <code>page</code>
variable with the result of this CDBI query. At the end of the method, control
flow returns to the calling method.</p>

<p>Now uncomment the <code>$c-&gt;forward('page');</code> line in the <code>show</code> action.</p>

<pre><code>sub edit : Local {
    my ( $self, $c, $title ) = @_;
    $c-&gt;forward('page');
    $c-&gt;stash-&gt;{page}-&gt;body( $c-&gt;req-&gt;params-&gt;{body} )
      if $c-&gt;req-&gt;params-&gt;{body};
    my $body = $c-&gt;stash-&gt;{page}-&gt;body || 'Just type something...';
    my $html = $c-&gt;textile-&gt;process($body);

    my $base = $c-&gt;req-&gt;base;
    $html    =~ s{(?&lt;![\?\\\/\[])(\b[A-Z][a-z]+[A-Z]\w*)}
                 {&lt;a href=&quot;$base$1.html&quot;&gt;$1&lt;/a&gt;}g;

    $c-&gt;res-&gt;output($html);
}</code></pre>

<p>The <code>edit</code> method first forwards the action off to
<code>page</code>, so that the stash's <code>page</code> object contains the
result of the CDBI query. If there is a value for <code>body</code>, it will
use this; otherwise &quot;Just type something...&quot; is the default. The code then
processes the body with Textile, which converts plain text to HTML, and then runs
the body through a regex to convert camel-case text into links, with the URL
base taken from the Catalyst request object. Finally, it outputs the HTML.</p>

<h4>Set Up the Wiki with Ajax</h4>

<p>Modify <em>root/view.tt</em> to include Ajax code:</p>

<pre><code>&lt;html&gt;
     &lt;head&gt;&lt;title&gt;MiniMojo&lt;/title&gt;&lt;/head&gt;
     [% c.prototype.define_javascript_functions %]
     [% url = base _ 'page/edit/' _ page.title %]
     &lt;body Onload=&quot;new Ajax.Updater( 'view',  '[% url %]' )&quot;&gt;
         &lt;h1&gt;[% page.title %]&lt;/h1&gt;
         &lt;div id=&quot;view&quot;&gt;&lt;/div&gt;
         &lt;textarea id=&quot;editor&quot; rows=&quot;24&quot; cols=&quot;80&quot;&gt;[% page.body %]&lt;/textarea&gt;
         [% c.prototype.observe_field( 'editor', {
             url =&gt; url,
             with =&gt; &quot;'body='+value&quot;,
             update =&gt; 'view' }
         ) %]
     &lt;/body&gt;
&lt;/html&gt;</code></pre>

<p>The line:</p>

<pre><code>[% c.prototype.define_javascript_functions %]</code></pre>

<p>includes the whole <em>prototype.js</em> library in a <code>script</code>
block. Note that the <code>prototype</code> plugin is available in the context
object.</p>

<p>The section</p>

<pre><code>[% url = base _ 'page/edit/' _ page.title %] 
&lt;body Onload=&quot;new Ajax.Updater( 'view',  '[% url %]' )&quot;&gt;
&lt;h1&gt;[% page.title %]&lt;/h1&gt;
&lt;div id=&quot;view&quot;&gt;&lt;/div&gt;</code></pre>

<p>constructs the Ajax URL and updates the view <code>div</code> when loading
the page.</p>

<p>Finally:</p>

<pre><code>&lt;textarea id=&quot;editor&quot; rows=&quot;24&quot; cols=&quot;80&quot;&gt;[% page.body %]&lt;/textarea&gt;
    [% c.prototype.observe_field( 'editor', {
        url =&gt; url,
        with =&gt; &quot;'body='+value&quot;,
        update =&gt; 'view' }
    ) %]</code></pre>

<p>periodically checks the <code>textarea</code> for changes and makes an Ajax
request on demand.</p>

<p>That's it! Now you can re-run the server and your wiki is up and running
(Figure 4). To use the wiki, simply start typing in the <code>textarea</code>.
As you type, the wiki will regularly echo your entry above, passing it through
the formatter.  When you type something in camel case, it will automatically
create a link you can click to go to the new page.</p>

<p><img src="/pub/2005/06/02/graphics/running-wiki-screenshot.gif" width="515" height="376" alt="screenshot of the running wiki"
/><br /><em>Figure 4. The running wiki</em></p>

<p>Enjoy your new Catalyst-powered Ajax wiki!</p>

<h3>Resources</h3>

<p>For more information, see the Catalyst documentation, in particular the <a
href="http://search.cpan.org/perldoc?Catalyst::Manual::Intro">Catalyst::Manual::Intro
module</a>, which gives a thorough introduction to the framework. There are two
<a href="http://lists.rawmode.org/mailman/listinfo">Catalyst mailing lists</a>,
a general list and a developer list.  The best place to discuss Catalyst,
though, is the <i>#catalyst</i> IRC channel at <a
href="http://irc.perl.org">irc.perl.org</a>. The <a
href="http://catalyst.perl.org/">Catalyst home page</a> is currently just a
collection of a few links, but we will extend it in the near future.</p>

<p>Thanks to Catalyst lead developer Sebastian Riedel for help with this
article and, of course, for Catalyst itself.</p>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1714" template="b/article_sidebar2.view">
<!-- sidebar ends -->


                                    </div>


                                </div>
                                <div class="asset-footer">


                                    <div class="entry-tags">
                                        <h4>Tags<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=Catalyst&amp;limit=20';return false;" rel="tag">Catalyst</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=MiniMojo&amp;limit=20';return false;" rel="tag">MiniMojo</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=Perl%20AJAX&amp;limit=20';return false;" rel="tag">Perl AJAX</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=Perl%20Ajax&amp;limit=20';return false;" rel="tag">Perl Ajax</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=Perl%20MVC&amp;limit=20';return false;" rel="tag">Perl MVC</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=Perl%20web%20apps&amp;limit=20';return false;" rel="tag">Perl web apps</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=Perl%20web%20framework&amp;limit=20';return false;" rel="tag">Perl web framework</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=Perl%20wiki&amp;limit=20';return false;" rel="tag">Perl wiki</a></li>
                                        </ul>
                                    </div>

                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
