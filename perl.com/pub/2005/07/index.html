<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: July 2005 Archives</title>


    <link rel="prev" href="/pub/2005/06/" title="June 2005" />
    <link rel="next" href="/pub/2005/08/" title="August 2005" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">July 2005 Archives</h1>





                            
                            <div id="entry-810" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/07/p6pdigest/20050728.html" rel="bookmark">This Week in Perl 6, July 20-26, 2005</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Matt Fowles</span> on <abbr class="published" title="2005-07-28T00:00:00-08:00">July 28, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>All--</p>

<p>Welcome to another Perl 6 summary, brought to you by microwaved Chinese food
and air conditioning. I love the modern era. Without further ado, I bring
you:</p>

<h3>Perl 6 Compilers</h3>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/72ef8db2a30decff/d6cdda584ed03036#d6cdda584ed03036">PxPerl</a></h4>

<p>Gr&eacute;goire P&eacute;an announced the release of PxPerl 5.8.7-3, allowing
easy access for people who want to play with Pugs and Parrot on Windows.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/59cbdc5407af6d1d/b5fab8f688683f68#b5fab8f688683f68">Test
Report for Windows</a></h4>

<p>Ronald Hill reported some failing tests for Pugs on Windows.  Fortunately,
given Pugs' development, there is a reasonable chance of having these problems
fixed. Unfortunately, given Pugs' development, no such information made it to
the list.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/b015b73040e20441/1468fa0cd2c60b47#1468fa0cd2c60b47">Parsing
Perl 6 Rules</a></h4>

<p>Nathan Gray wondered how Jeff Pinyan's parsing-Perl-6-rules project was
going. Jeff said that it did not get very far, but he posted what he did have
to <a href="http://feather.perl6.nl/~japhy/">his feather site</a>.</p>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1795" template="b/article_sidebar.view">
<!-- sidebar ends -->

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/82ee149bb2d85bc1/4d1fcdb883424696#4d1fcdb883424696">Pugs
Problems</a></h4>

<p>Vadim Konovalov found two problems while playing with <code>slurp</code>.
Adriano Ferreira showed him how to work around <code>slurp</code> not accepting
a <code>:raw</code> option. Nobody commented on the peculiar
<code>$*ARGS[0]</code> value when the argument is
<code>-foobarfluffy</code>.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/0011d8b97dee7e89/55fb939f0dee60c2#55fb939f0dee60c2">Official
Perl 6 Rules Grammar</a></h4>

<p>Patrick announced an &quot;official Perl 6 grammar,&quot; which he will maintain
closely with PGE in Parrot. It is incomplete at this point, but patches are
most welcome.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/e044f2bf561fe482/6bd06c83cd64f720#6bd06c83cd64f720">PIL
Nodes Descriptions</a></h4>

<p>Allison Randal posted a request for a clue batting, listing various types of
nodes in PIL and explaining her guesses at their descriptions.  Stuart Cook and
Patrick both provided a little help, although they did not address everything
on her list.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/e390005d62b36314/1f78076fe32525de#1f78076fe32525de">Perl
6 FAQ Patch</a></h4>

<p>Autrijus provided a patch for the Perl 6 FAQ to remove an outdated question.
Robert Spier applied the patch (modulo some confusion about staged versus live
copies).</p>

<h3>Parrot</h3>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/9d51af690526ca50/7ce11972f9700fc4#7ce11972f9700fc4">Opcode
Optimizability</a></h4>

<p>Curtis Rawls noted that it is often simpler from an optimizer writer's
standpoint to do constant folding and optimization on a smaller set of opcodes
(just one variant of <code>add</code> instead of five (seven, if you count
<code>inc</code> and <code>dec</code>)). Leo explained that removing these
opcodes isn't an option, but suggest to add to the FAQ the recommendation for
compiler writers to emit only the more verbose codes.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/5c57948de0eb65d5/4524a529265756a1#4524a529265756a1">Refcounting
Hash</a></h4>

<p>Nicholas Clark wants to use a hash to hold reference counts for Ponie
(something like <code>dod_register_pmc</code> in <em>pmc.c</em>), but he
doesn't want to duplicate code. Leo suggested that he move some of the code
into a PMC and then switch the real registry to use that PMC.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/64c78fe69846258d/5be1667694bf333b#5be1667694bf333b">New
PGE Test</a></h4>

<p>Mitchell N. Charity submitted a test for a &quot;large&quot; Pugs grammar.  It currently
fails. Patrick noted that the test likely came from <em>rx_grammar.pl</em> in
the Pugs distribution. This probably led to his above addition of an &quot;Official
Perl 6 Rules Grammar.&quot;</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/be7db5a4fa863bf4/e0016e90bd49ac12?utoken=2ft0QzcAAADWXQ4sS--whFjzzhFxvEM00gQo7AZl4XkybyOr3FDcx1wpJJKp5Fy_CeG7_g7HuOvyH7OCrUDUWaccdqfgXNOG">JIT
Emit Help</a></h4>

<p>Adam Preble decided that he would play with an x86_64 code generator.
Unfortunately, he hit some stumbling blocks. Leo offered to help him and
provided pointers from <i>#parrot</i>.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/84a72c2aaf83c847/d2efb9430a077b30#d2efb9430a077b30">Call
Opcode Cleanup</a></h4>

<p>Leo wants to clean up some of the various <code>invoke</code> opcodes. He
posted a request for comment, but Warnock applies. It seems that Leo's requests
for comments like this get Warnocked a lot.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/b3b8c5aecdcc2354/759b9235518ec3e9#759b9235518ec3e9"><code>spawnw</code>
Return Value</a></h4>

<p>Prompted by Jonathan Worthington submitting a patch to <a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/efb75561665e2c80/bb36e3935b3179ad#bb36e3935b3179ad">make
the <code>spawnw</code> tests pass on Windows</a> (applied), Jerry Gay opened a
TODO ticket for switching <code>spawnw</code> to return something object-like
to wrap platform-specific oddities.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/1791b6c68817f702/6ba2941807f35823#6ba2941807f35823">Bugs
in <em>ops2vim.pl</em></a></h4>

<p>Amir Karger noticed a bug in <em>ops2vim.pl</em> and suggested a fix. Jerry
Gay fixed it.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/3a36357193751b7c/f08ee194474ddbfe#f08ee194474ddbfe">Leo's
Ctx Branch Tests</a></h4>

<p>Jerry Gay and Leo worked together to get his branch passing a few more tests
on Windows. Nick Glencross wondered if the Python dynclasses tests were running,
too. Jonathan Worthington explained that they were being skipped for the
moment.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/5e7adae80c68ae2c/0702375e91fd82a8#0702375e91fd82a8">Raised
by the Aliens</a></h4>

<p>Matt Diephouse was surprised to discover that you cannot use
<code>addparent</code> with a PMC for either argument. He suggested that either should work or should have official documentation.</p>













<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/571902f4a4f653f2/9e8223e529f9ba66#9e8223e529f9ba66">Patches
Accumulating</a></h4>

<p>Leo requested that people with commit bits pick up some of the patches that
were building up, as he was running a little low on tuits.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/6ef439c886066b14/55e991eba8cdcd52#55e991eba8cdcd52">Dump
CFG</a></h4>

<p>Curtis Rawls moved the <code>dump_cfg</code> call from <em>reg_alloc.c</em>
to <em>cfg.c</em>. Leo applied the patch.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/f1a4315013d4c915/672164862ef435bc#672164862ef435bc"><code>string_to_cstring</code>
Leaks</a></h4>

<p>Jonathan Worthington plugged a few leaks caused by
<code>string_to_cstring</code>.  Leo applied the patch.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/e21b573a0ea70bde/65f90008008e2c3c#65f90008008e2c3c">Deleting
Globals/Lexicals</a></h4>

<p>Matt Diephouse noted that there was no way to delete globals or lexicals.
Leo posted one (untested) way to do it.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/6854673d53122c92/607b7bf7c9e361c8#607b7bf7c9e361c8">Generating
Win32 Executables</a></h4>

<p>Jonathan Worthington laid some groundwork for generating executables on
Windows. Leo applied the patch.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/f047dcf93759ecab/6e03ce901bb57ca5#6e03ce901bb57ca5">Library
Loading on Win32</a></h4>

<p>Jonathan Worthington beefed up the library searching logic in Parrot to be a
little more Windowsy. Leo applied the patch.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/8b4e5b0f87adba1d/57ed94ccb95085f8#57ed94ccb95085f8">PBC
Merge Utility</a></h4>

<p>Leo posted a request for a utility that could merge several PBC files into
one.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/2bf16c7f57ee1a2e/59ec396d410b5d29#59ec396d410b5d29">Calling
Super Methods</a></h4>

<p>Matt Diephouse noticed that there was no way to call the method from a super
class. Leo pointed out a way to do it by accessing the slots of the parent
directly.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/3b01415e4da2325f/20c2be9a86a7a693#20c2be9a86a7a693"><code>cmd</code>
Buffer Reallocation</a></h4>

<p>Greg Bacon fixed a bug in the reallocation of the <code>cmd</code> buffer on Win32.
Jonathan Worthington applied the patch.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/d819d5808bcfa1e3/0c0ef49282c078e7#0c0ef49282c078e7"><code>Data::Dump</code>
(PGE)</a></h4>

<p>Will Coleda added a TODO for making PGE's match objects compatible with
<code>Data::Dumper</code>.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/57829b80613a030f/eba85e09e75dd15e#eba85e09e75dd15e"><code>does
Hash</code></a></h4>

<p>Will Coleda wants <code>Data::Dumper</code> to check if an object
<code>does</code> <code>Hash</code> or <code>Array</code> and dump it thusly if
it has no default <code>dump</code>.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/5087777195497561/6f8550b9c3e177b1#6f8550b9c3e177b1"><em>rx.ops</em>'s
Future</a></h4>

<p>Will Coleda wondered about the future of the rx ops. Brent &quot;Dax&quot;
Royal-Gordon, who wrote them, recons they are not long for this world. He
mentioned though that the intstacks and the bitmap handling code might be worth
saving.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/caf85c11387a0550/d8343c914258b2f4#d8343c914258b2f4">Debugger-List Breakpoints</a></h4>

<p>Will Coleda noticed that the debugger was not quite compatible with Perl's.
Leo replied that the debugger's whole command loop was a mess that required a
turn of the crank.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/c5fec6e374846f70/ea379969e2c28c73#ea379969e2c28c73"><code>\u</code>
Escape Issues</a></h4>

<p>Will Coleda brought up an old ticket for some Unicode escape issues. Leo
asked for a test case.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/1460def887a4d5c6/2423989ff6a521de#2423989ff6a521de"><code>string</code>
-&gt; <code>int</code> Conversions</a></h4>

<p>Matt Diephouse noticed that there are no opcode octal and hex conversions.
Leo suggested adding one of the form <code>set Ix, Sy, Ibase
# Ibase = 2..36</code>.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/c471cd54c2f4d224/ef07478f722221f5#ef07478f722221f5">Make
<code>make languages</code> Failures Non-Fatal</a></h4>

<p>Bernhard Schmalhofer suggested that <code>make languages</code> should not
give up after the first failure, but should instead build the remaining
languages.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/2bf0400fe7338eef/5e293e31dfb2e70c#5e293e31dfb2e70c">Dynclasses
on Windows</a></h4>

<p>Nick Glencross and Jonathan Worthington discussed how to make dynclasses
build on Windows.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/292d52cb41823a62/7b5c88c024a74769#7b5c88c024a74769"><code>Resizable*Array</code>
Allocation</a></h4>

<p>Matt Fowles submitted a patch making all the various
<code>Resizeable*Array</code> PMCs share their allocation strategy. Bernhard
Schmalhofer applied the patch.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/b1fb0985a8682d17/42a030138f39041a#42a030138f39041a">MMD
Roundup: Take 2</a></h4>

<p>Nicholas Clark attempted to de-Warnock a suggested change by Leo.
Unfortunately, his thoughts on the matter were, &quot;This is really a call for the
designer to make, isn't it?&quot; Leo suggested starting a <em>WARNOCKED</em> file
for these things. Will countered that adding it to the DESIGN section in
<em>docs/ROADMAP</em>, would mean that Chip needs only look in one place.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/522f18e94ff1e97b/607ed4ce47a5eab6#607ed4ce47a5eab6">Parrot
Failures on Mac OS X</a></h4>

<p>Nicholas Clark forwarded some failures on Mac OS X to the Parrot list (from
the Ponie one).</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/e06edd0f30a68d33/a197458082a6d861#a197458082a6d861">Parrot
Needs <code>STDERR</code></a></h4>

<p>Nicholas Clark noticed that running Parrot with a closed <code>STDERR</code> makes Parrot
unhappy.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/4cd9e2926bc83d64/f8d878256d60c2a1#f8d878256d60c2a1">GMC</a></h4>

<p>Alexandre Buisse and many others have been talking about his Generation Mark
and Compact Garbage Collector. Plans are rapidly taking shape.</p>













<h3>Perl 6 Language</h3>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/43135a1d4f0bbfcc/80e0a74f25f015a0#80e0a74f25f015a0">User-Defined Context Behavior</a></h4>

<p>Ingo Blechschmidt wanted to know how to make his own custom class that would
act specially in list context. Thomas Sandla&szlig; suggested overloading
<code>&amp;infix:&lt;=&gt;</code>. Sadly, his answer doesn't seem to have made it to
Google Groups.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/c073d7300ae39e81/bd1f191a0b4b4dd7#bd1f191a0b4b4dd7">Hash
Creation with Duplicate Keys</a></h4>

<p>Ingo Blechschmidt noticed that in Perl 5 hash definitions, the rightmost
duplicate wins, whereas the leftmost wins in Perl 6. He wondered if this was a
bug or not. Luke explained that it was that way for named variable bindings.
Larry figured it should be that way <em>only</em> for named variable binding.
If Pugs has not done it yet, some brave soul could probably add tests and find
it implemented before they had finished committing.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/6961593735eeb3dc/1b1408f6f11c2504#1b1408f6f11c2504">Tail
Calls, Methods, and Currying</a></h4>

<p>Brent &quot;Dax&quot; Royal-Gordon wondered about tail calls, noting that the current
method (<code>$obj.can('meth').goto($obj, *@args);</code>) is kinda ugly. Larry
mused that <code>return g()</code> should go ahead and tail call. If the code
does not want a tailcall there, then it should avoid it manually.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/0e070011c30ef520/b9aafc0d0d0e27c7#b9aafc0d0d0e27c7">Pairs
and Binding Play Poorly Together</a></h4>

<p>Autrijus noted that pairs and bindings (such as in a <code>for</code> loop)
play badly together. Larry supposed that the <code>Bare</code> code object
could have parameters of type <code>Pair|Item</code> (note no
<code>Junction</code>) by default to solve this problem. Damian supported the
exclusion of <code>Junction</code>.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/b64f6f0757aba82f/e7c6e6b4fde0dd38#e7c6e6b4fde0dd38">Method
Introspection and Meta <code>meta.classes</code></a></h4>

<p>Chromatic wondered about subroutine and method introspection. Sam Vilain
thought he might want to look at Stevan Little's Perl 6 MetaModel. He also
talked about closing the loop on meta-meta-meta headaches. Apparently Smalltalk
has done this somewhere.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/69ce157a34ae688d/50c133e45c608ede#50c133e45c608ede">Big
Object Rethink</a></h4>

<p>Larry posted a fairly major rethink of member variables and methods.
Honestly I did not quite follow what he described, and there is a lot to
summarize--Hey! Look over there! ::PUNT:: Nothing to see here, move
along.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/087904100f8ba53c/fa49a0002e4742b9#fa49a0002e4742b9">Garbage
Collection API</a></h4>

<p>David Formosa (after being lightly chastized by an unknown summarizer)
started a new thread expanding on his desire for a GC API. I thought there were
replies to this, but they don't seem to have made it to Google.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/419828b0fad1dcb8/3eb110889aa7bc0d#3eb110889aa7bc0d">Exposing
the GC</a></h4>

<p>Piers Cawley thought that it might be useful to expose the GC to get an
array of all objects of a particular class. Brent &quot;Dax&quot; Royal-Gordon thought
that the ability to get such an array would be useful, but that it should
merely be an implementation detail of whether an array of weak refs or the GC
or Harry Potter was invoked.</p>

<h3>The Usual Footer</h3>

<p>To post to any of these mailing lists, please subscribe by sending email to
<code>perl6-internals-subscribe@perl.org</code>,
<code>perl6-language-subscribe@perl.org</code>, or
<code>perl6-compiler-subscribe@perl.org</code>. If you find these summaries
useful or enjoyable, please consider contributing to the Perl Foundation to
help support the development of Perl. You might also like to send feedback to
<csperl file="mailmunge" arg_email="ubermatt@gmail.com" arg_ending="." />
<ul>

<li><a href="http://donate.perl-foundation.org/">The Perl Foundation</a></li>
<li><a href="http://dev.perl.org/perl6/">Perl 6 development site</a></li>
<li><a href="http://planet.parrotcode.org/">Parrot Blog aggregator</a></li>

</ul>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1796" template="b/article_sidebar2.view">
<!-- sidebar ends -->

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-802" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/07/28/test_builder_p6.html" rel="bookmark">Porting Test::Builder to Perl 6</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author"><a class="fn url" href="http://www.modernperlbooks.com/">chromatic</a></span> on <abbr class="published" title="2005-07-28T00:00:00-08:00">July 28, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>Perl 6 development now proceeds in two directions. The first is from the
bottom up, with the creation and evolution of <a
href="http://www.parrotcode.org/">Parrot</a> and underlying code, including
the Parrot Grammar Engine. The goal there is to build the structure Perl 6
will need. The second direction is from the top down, with the <a
href="http://www.pugscode.org/">Pugs</a> project implementing Perl 6 initially
separate from Parrot, though recent additions allow an embedded Parrot to run
the parsed code and to emit valid Parrot PIR code.</p>

<p>Both projects are important and both help the design of Perl 6 and its
implementation. Parrot is valuable in that it demonstrates a solid
foundation for Perl 6 (and other similar languages); a far better
foundation than the internals of Perl 5 have become. Pugs is important
because it allows people to use Perl 6 productively now, with more features
every day.</p>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1796" template="b/article_sidebar.view">
<!-- sidebar ends -->

<h3>Motivation and Design</h3>

<p>Perl culture values testing very highly. Several years ago, at the
suggestion of Michael Schwern, I extracted the code that would become <a
href="http://search.cpan.org/perldoc/Test::Builder">Test::Builder</a> from <a
href="http://search.cpan.org/perldoc/Test::More">Test::More</a> and unified <a
href="http://search.cpan.org/perldoc/Test::Simple">Test::Simple</a> and
Test::More to share that back end. Now dozens of other testing modules, built upon Test::Builder, work
together seamlessly.</p>

<p>Pugs culture also values testing. However, there was no corresponding
Test::Builder for Perl 6 yet--there was only a single <a
href="http://svn.openfoundry.org/pugs/ext/Test/lib/Test.pm"><i>Test.pm</i></a> module
that did most of what the early version of Test::More did in Perl 5.</p>

<p>Schwern and I have discussed updates and refactorings of Test::Builder
for the past couple of years. We made some mistakes in the initial design.
As Perl 6 offers the chance to clean up Perl 5, so does a port of
Test::Builder to Perl 6 offer the chance to clean up some of the design
decisions we would make differently now.</p>

<p>Internally, Test::Builder provides a few testing and reporting functions
and keeps track of some test information. Most importantly, it contains a plan
consisting of the number of tests expected to run. It also holds a list of
details of every test it has seen. The testing and reporting functions add
information to this list of test details. Finally, the module contains
functions to report the test details in the standard <a
href="http://search.cpan.org/dist/Test-Harness/lib/Test/Harness/TAP.pod">TAP</a> format, so
that tools such as <a
href="http://search.cpan.org/perldoc/Test::Harness">Test::Harness</a> can
interpret the results correctly.</p>

<p>Test::Builder needs to do all of these things, but there are several
ways to design the module's internals. Some ways are better than
others.</p>

<p>The original Perl 5 version mashed all of this behavior together into
one object-oriented module. To allow the use of multiple testing modules
without confusing the count or the test details,
<code>Test::Builder::new()</code> always returns a singleton. All test
modules call the constructor to receive the singleton object and call the
test reporting methods to add details of the tests they handle.</p>

<p>This works, but it's a little inelegant. In particular, modules that test
test modules have to go to a lot of trouble to work around the design.  A more
flexible design would make things like <a
href="http://search.cpan.org/perldoc/Test::Builder::Tester">Test::Builder::Tester</a>
much easier to write.</p>

<p>The biggest change that Schwern and I have discussed is to separate the
varying responsibilities into separate modules. The <a
href="http://svn.openfoundry.org/pugs/ext/Test-Builder/lib/Test/Builder.pm">new
Test::Builder object in Perl 6</a> itself contains a <a
href="http://svn.openfoundry.org/pugs/ext/Test-Builder/lib/Test/Builder/TestPlan.pm">Test::Builder::TestPlan</a>
object that represents the plan (the number of tests to run), a <a
href="http://svn.openfoundry.org/pugs/ext/Test-Builder/lib/Test/Builder/Output.pm">Test::Builder::Output</a>
object that contains the filehandles to which to write TAP and diagnostic
output, and an array of tests' results (all <a
href="http://svn.openfoundry.org/pugs/ext/Test-Builder/lib/Test/Builder/Test.pm">Test::Builder::Test</a>
instances).</p>

<p>The default constructor, <code>new()</code>, still returns a singleton
by default. However, modules that use Test::Builder can create their own
objects, which perform the Test::Builder::TestPlan or Test::Builder::Output
roles and pass them to the constructor to override the default objects
created internally for the singleton. If a test module really needs a
separate Test::Builder object, the alternate <code>create()</code> method
creates a new object that no other module will share.</p>

<p>This strategy allows the Perl 6 version of <a
href="http://svn.openfoundry.org/pugs/ext/Test-Builder/lib/Test/Builder/Tester.pm">Test::Builder::Tester</a>
to create its own Test::Builder object that reports tests as normal and then
creates the shared singleton with output going to filehandles it can read
instead of <code>STDOUT</code> and <code>STDERR</code>.  The design appears to be sound; it took less
than two hours to go from the idea of T::B::T to a fully working
implementation--counting a break to eat ice cream.</p>

<h3>First Attempts</h3>

<p>Translating Perl 5 OO code into Perl 6 OO code was mostly straightforward,
despite my never having written any runnable Perl 6 OO code. (Also, Pugs
was not far enough along that objects worked.)</p>

<h4>What Went Right</h4>

<p>One nice revelation is that opaque objects are actually easier to work
with than blessed references. Even better, Perl 6's improved function
signatures reduce the necessity to write lots of boring boilerplate
code.</p>

<p>Breaking Test::Builder into separate pieces gave the opportunity for
several other refactorings. One of my favorite is &quot;Replace Condititional with
Polymorphism&quot;. There are four different types of tests that have different
reporting styles: <code>pass</code>, <code>fail</code>, <code>SKIP</code>, and <code>TODO</code>. It made sense to create separate
classes for each of those, giving each the responsibility and knowledge to
produce the correct TAP output. Thus I wrote Test::Builder::Test, a
fa&ccedil;ade factory class with a very smart constructor that creates and
returns the correct test object based on the given arguments. When
Test::Builder receives one of these test objects, it asks it to return the TAP
string, passes that message to its contained Test::Builder::TestOutput object,
and stores the test object in the list of run tests.</p>
<div align="center">
<a href="http://conferences.oreillynet.com/os2005/"><img src="http://conferences.oreillynet.com/images/os2005/banners/468x60.gif" width="468" height="60" hspace="10" vspace="10" border="0" alt="O'Reilly Open Source Convention 2005." /></a>
</div>












<h4>What Went Wrong</h4>

<p>Writing the base for all (or at least many) possible test modules is
tricky. In this case, it was trebly so. Not only was this the first bit of
practical OO Perl 6 code I'd written, but I had no way to test it, either
by hand (how I tested the Perl 5 version, before Schwern and I worked out a
way to write automated tests for it), or with automated tests. Pugs didn't
even have object support when I wrote this, though checking in this code
pushed OO support higher on the schedule.</p>

<h5>Infinite Loops in Construction</h5>

<p>Originally, I thought all test classes would inherit from
Test::Builder::Test. As Damian Conway pointed out, my technique created an
infinite loop. (He suggested that &quot;Don't make a fa&ccedil;ade factory class an
ancestor of the instantiable classes&quot; is a design mistake akin to &quot;Don't get
involved in a land war in Asia&quot; and mumbled something else about battles of
wits and Sicilians.) The code looked something like:</p>

<pre><code>  class Test::Builder::Test
  {
      my Test::Builder::Test $:singleton is rw;

      has Bool $.passed;
      has Int  $.number;
      has Str  $.diagnostic;
      has Str  $.description;

      method new (Test::Builder::Test $class, *@args)
      {
          return $:singleton if $:singleton;
          $:singleton = $class.create( @args );
          return $:singleton;
      }

      method create(
          $number, 
          $passed       =  1,
          ?$skip        =  0,
          ?$todo        =  0,
          ?$reason      = '',
          ?$description = '',
      )
      {
          return Test::Builder::Test::TODO.new(
              description =&gt; $description, reason =&gt; $reason, passed =&gt; $passed,
          ) if $todo;

          return Test::Builder::Test::Skip.new(
              description =&gt; $description, reason =&gt; $reason, passed =&gt; 1,
          ) if $skip;

          return Test::Builder::Test::Pass.new(
              description =&gt; $description, passed =&gt; 1,
          ) if $passed;

          return Test::Builder::Test::TODO.new(
              description =&gt; $description, passed =&gt; 0,
          ) if $todo;
      }
  }

  class Test::Builder::Test::Pass is Test::Builder::Test {}
  class Test::Builder::Test::Fail is Test::Builder::Test {}
  class Test::Builder::Test::Skip is Test::Builder::Test { ... }
  class Test::Builder::Test::TODO is Test::Builder::Test { ... }

  # ...</code></pre>

<p>Why is this a singleton? I have no idea; I typed that code into the
<em>wrong</em> module and continued writing code a few minutes later, thinking
that I knew what I was doing. The infinite loop stands out in my mind very
clearly now. Because all of the concrete test classes inherit from
Test::Builder::Test, they inherit its <code>new()</code> method; none of them
override it. Thus, they'll all call <code>create()</code> again (and none of
them override <em>that</em> either).</p>

<h5>Confusing Initialization</h5>

<p>I also struggled with the various bits and pieces of creating and
building objects in Perl 6. There are a lot of hooks and overrides
available, making the object system very flexible. However, without any
experience or examples or guidance, choosing between <code>new()</code>,
<code>BUILD()</code>, and <code>BUILDALL()</code> is difficult.</p>

<p>I realized I had no idea how to handle the singleton in Test::Builder.
At least, when I realized that (for now) Test::Builder could remain a
singleton, I didn't know how or where to create it.</p>

<p>I finally settled on putting it in <code>new()</code>, with code much
like that in the broken version of Test::Builder::Test previously.
<code>new()</code> eventually allocates space for, creates, and returns an
opaque object. <code>BUILD()</code> initializes it. This led me to write
code something like:</p>

<pre><code>  class Test::Builder;

  # ...

  has Test::Builder::Output   $.output;
  has Test::Builder::TestPlan $.plan;

  has @:results;

  submethod BUILD ( Test::Builder::Output ?$output, ?$TestPlan )
  {
      $.plan   = $TestPlan if $TestPlan;
      $.output = $output ?? $output :: Test::Builder::Output.new();
  }</code></pre>
<p>There's a difference here because most uses of Test::Builder set the
test plan explicitly later, after receiving the Test::Builder object. I
added a <code>plan()</code> method, too:</p>

<pre><code>  method plan ( $self:, Str ?$explanation, Int ?$num )
  {
      die &quot;Plan already set!&quot; if $self.plan;

      if ($num)
      {
          $self.plan = Test::Builder::TestPlan.new( expect =&gt; $num );
      }
      elsif $explanation ~~ 'no_plan'
      {
          $self.plan = Test::Builder::NullPlan.new();
      }
      else
      {
          die &quot;Unknown plan&quot;;
      }

      $self.output.write( $self.plan.header() );
  }</code></pre>
<p>There are some stylistic errors in the previous code. First, when
declaring an invocant, there's a colon but no comma. Second,
<code>fail</code> is much better than <code>die</code> (an assertion Damian
made that I take on faith, having researched more serious issues instead).
Third, the parenthesization of the cases in the <code>if</code> statement
is inconsistent.</p>













<h3>Final (Ha!) Version</h3>

<p>Shortly after I checked in the example code, Stevan Little began work on a
test suite (using <em>Test.pm</em>). I knew that Pugs didn't support many of
the necessary language constructs, but this allowed Pugs hackers to identify
necessary features and me to identify legitimate bugs and mistakes in the
code. (It's tricky to bootstrap test-driven development.)</p>

<p>After filling out the test suite, fixing all of the known bugs in my code,
talking other Pugs hackers into adding features I needed, and implementing
those I couldn't pawn off on others, Test::Builder works completely in Pugs
right now.  There is one remaining nice feature: splatty args in method calls.
But I'm ready to port <em>Test.pm</em> to the new back end and then write many,
many more useful testing modules--starting with a port of Mark Fowler's
Test::Builder::Tester written the night before this article went public!</p>

<p>The singleton creation in <code>Test::Builder</code> now looks like:</p>

<pre><code>  class Test::Builder-0.2.0;
  
  use Test::Builder::Test;
  use Test::Builder::Output;
  use Test::Builder::TestPlan;
  
  my  Test::Builder           $:singleton;
  has Test::Builder::Output   $.output handles 'diag';
  has Test::Builder::TestPlan $.testplan;
  has                         @:results;
  
  method new ( Test::Builder $Class: ?$plan, ?$output )
  {
      return $:singleton //= $Class.SUPER::new(
          testplan =&gt; $plan, output =&gt; $output
      );
  }
  
  method create ( Test::Builder $Class: ?$plan, ?$output )
  {
      return $Class.new( testplan =&gt; $plan, output =&gt; $output );
  }
  
  submethod BUILD
  (
      Test::Builder::TestPlan ?$.testplan,
      Test::Builder::Output   ?$.output = Test::Builder::Output.new()
  )
  {}</code></pre>
<p>Those test modules that want to use the default <code>$Test</code>
object directly can call <code>Test::Builder::new()</code> to return the
singleton, creating it if necessary. Test modules that need different
output or plan objects should call <code>Test::Builder::create()</code>.
(The test suite actually does this.)</p>

<p>Having removed the <code>Test::Builder</code> code from
<code>Test::Builder::Test</code>, I revised the latter, as well:</p>

<pre><code>  class Test::Builder::Test-0.2.0
  {
      method new (
          $number,     
          ?$passed      = 1,
          ?$skip        = 0,
          ?$todo        = 0,
          ?$reason      = '', 
          ?$description = '',
      )
      {
          return ::Test::Builder::Test::TODO.new(
              description =&gt; $description, passed =&gt; $passed, reason =&gt; $reason
          ) if $todo;

          return ::Test::Builder::Test::Skip.new(
              description =&gt; $description, passed =&gt;       1, reason =&gt; $reason
          ) if $skip;

          return ::Test::Builder::Test::Pass.new(
              description =&gt; $description, passed =&gt;       1,
          ) if $passed;

          return ::Test::Builder::Test::Fail.new(
              description =&gt; $description, passed =&gt;       0,
          );
      }
  }</code></pre>
<p>That's it. I moved the object attributes into roles.
<code>Test::Builder::Test::Base</code> is the basis for all tests,
encapsulating all of the attributes that tests share and providing the
important methods:</p>

<pre><code>  role Test::Builder::Test::Base
  {
      has Bool $.passed;
      has Int  $.number;
      has Str  $.diagnostic;
      has Str  $.description;

      submethod BUILD (
          $.description,
          $.passed,
          ?$.number     =     0,
          ?$.diagnostic = '???',
      ) {}

      method status returns Hash
      {
          return
          {
              passed      =&gt; $.passed,
              description =&gt; $.description,
          };
      }

      method report returns Str
      {
          my $ok          = $.passed ?? 'ok' :: 'not ok';
          my $description = &quot;- $.description&quot;;
          return join( ' ', $ok, $.number, $description );
      }

  }

  class Test::Builder::Test::Pass does Test::Builder::Test::Base {}
  class Test::Builder::Test::Fail does Test::Builder::Test::Base {}</code></pre>
<p><code>Test::Builder::Test::WithReason</code> forms the basis for <code>TODO</code>
and <code>SKIP</code> tests, adding the reason why the developer marked the test as
either:</p>


<pre><code>  role Test::Builder::Test::WithReason does Test::Builder::Test::Base
  {
      has Str $.reason;

      submethod BUILD ( $.reason ) {}

      method status returns Hash ( $self: )
      {
          my $status        = $self.SUPER::status();
          $status{&quot;reason&quot;} = $.reason;
          return $status;
      }
  }

  class Test::Builder::Test::Skip does Test::Builder::Test::WithReason { ... }
  class Test::Builder::Test::TODO does Test::Builder::Test::WithReason { ... }</code></pre>


<h4>What's Hard</h4>

<p>The two greatest difficulties I encountered in this porting effort were
in mapping my design to the new Perl 6 way of thinking and in working
around Pugs bugs and unsupported features. The former is interesting; it
may suggest places where other people will run into difficulties.</p>

<p>One of the trickiest parts of Perl 6's OO model to understand is the
interaction of the <code>new()</code>, <code>BUILD()</code>, and
<code>BUILDALL()</code> methods. Perl 5 provides very little in the way of
object support beyond <code>bless</code>. Though having finer-grained
control over object creation, initialization, and initializer dispatch will
be very useful, remembering the purposes of each method is very important,
lest you override the wrong one and end up with an infinite loop or
partially initialized object.</p>

<p>From rereading the design documents, experimenting, picking the brains
of other @Larry members, and thinking hard, my rules are:</p>

<ul>

<li><p>Leave <code>new()</code> alone.</p>

<p>This method creates the opaque object. Override it when you don't want
to return a new object of this class every time. Don't do initialization
here. Don't forget to call <code>SUPER::new()</code> if you actually want
an object.</p></li>

<li><p>Override <code>BUILD()</code> to add initialize attributes for objects
of <em>this</em> class.</p>

<p>Think of this as an initializer, not a constructor.</p></li>

<li><p>Override <code>BUILDALL()</code> when you want to change the order of
initialization.</p>

<p>I haven't needed this yet and don't expect to.</p></li>

</ul>

<p>Pugs-wise, find a good Haskell tutorial, find a really fast machine that
can run GHC 6.4, and look for lambdacamel mentors on <i>#pugs</i>. (My productivity
increased when Autrijus told me about Haskell's <code>trace</code> function.
He called it a refreshing desert in the oasis of referential
transparency.)</p>

<h4>What's Easy</h4>

<p>Was this exercise valuable? Absolutely! It reinforced my belief that
Perl 6 is not only Perlish, but that it's a fantastic revolution of Perl 5
in several ways:</p>

<ul>

<li>The object system is much better. Attributes and accessors require
almost no syntax, and that only in their declarations. Using attributes
feels Perlish, even if it's not manipulating hash keys.</li>

<li>Function signatures eliminate a lot of code. My initializers do a lot
of work, but they don't take much code. Some even have empty method bodies.
This is a big win, except for the poor souls who had to implement the
underlying binding code in Pugs. (That took a while.)</li>

<li>Roles are fantastic. Sure, I believed in them already, but being able
to use them without the hacks required in Perl 5 was even better.</li>

</ul>

<h4>Final Thoughts</h4>

<p>Schwern and I did put a lot of thought into the Perl 5 redesign we never
really did, and my code here really benefits from the lessons I learned from
the previous version. Still, even though I wrote code to a moving project that
didn't yet support all of the features I wanted, it was a great exercise.
<code>Test::Builder</code> is simpler, shorter, cleaner, and more flexible;
it's ready for everything the Perl 6 QA group can throw at it.</p>

<p><code>Test::Builder</code> isn't the only Perl 5 module being ported to
Perl 6. Other modules include ports of HTTP::Server::Simple,
Net::IRC, LWP, and <code>CGI</code>. There are even ports
underway for Catalyst and Maypole.</p>

<p>Perl 6 isn't ready yet, but it's closer every day. Now's a great time to
port some of your code to see how Perl 6 is still Perlish, but a
revolutionary step in refreshing new directions.</p>

<p><em>chromatic is the author of <a href="http://onyxneon.com/books/modern_perl/">Modern Perl</a>. In his spare time, he has been working on <a href="http://trendshare.org/how-to-invest/">helping novices understand stocks and investing</a>.</em></p>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-808" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/07/p6pdigest/20050721.html" rel="bookmark">This Week in Perl 6, July 13-19, 2005</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2005-07-21T00:00:00-08:00">July 21, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>Welcome to another Perl 6 summary, brought to you by the words
&quot;displacement&quot; and &quot;activity.&quot; So far today, I've caught up with everything
unread in NetNewsWire, my Flickr groups, every other mailing list I'm
subscribed to, and completed about five Sudoku. Now I'm dragging out this
introduction and I don't know why; I enjoy writing these things.</p>

<h3>This Week in <i>perl6-compiler</i></h3>

<p>This was another quiet week on the list. However, you only have to watch the
SVN commit log and the other stuff on <a
href="http://planetsix.perl-foundation.org/">PlanetSix</a> to know that things
are still proceeding apace. Last time I looked, it seemed that Stevan Little
was working on bootstrapping the Perl 5 implementation of the Perl 6 MetaModel
to implement it in terms of itself.</p>

<p>Rather mind-bogglingly, Pugs is now targeting JavaScript as well.</p>

<p>The current Pugs release is 6.2.8.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050714153213.GB73297@plum.flirble.org">Creating
Threads in <code>BEGIN</code></a></h4>

<p>Nicholas Clark posted what he described as a &quot;note to collective self&quot;
wondering about how Perl 6 will cope with people creating threads inside of 
<code>BEGIN</code> blocks. According to Luke, &quot;it won't.&quot; Larry thought that it
might be okay to create threads at <code>CHECK</code> time, so long as any
spawned threads didn't do any real work later than <code>CHECK</code> time.</p>

<h4><a
href="http://groups.google.com/groups?threadm=002a01c58944$c9231c30$0200a8c0@madaboutipv6">Perl
6 Modules</a></h4>

<p>Gav... (I presume the ellipsis is important to someone) wondered what he
needed to do to write Perl 6 modules. Nathan Gray pointed him at the <a
href="http://svn.openfoundry.org/pugs/docs/other/porting_howto">porting
how-to</a> in the Pugs distribution.</p>

<h4><a
href="http://groups.google.com/groups?threadm=200507151916.j6FJGm18017026@webmail.sunflower.com">Is
Namespace Qualification Really Required? </a></h4>

<p>Phil Crow came across some weirdness with namespace resolution. It seems
that you have to qualify function names explicitly in signatures. Autrijus
agreed that it was a bug and asked for Phil to write a TODO test.  Discussion
ensued--I think the fix is in SVN now.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050719180105.GA30311@vs2.capwiz.com">Parsing
Perl 6 Grammars</a></h4>

<p>Nathan Gray wondered about the state of Jeff &quot;Japhy&quot; Pinyan's effort to
implement a Perl 6 rules parser. Japhy said that it's been on hold for a while,
but that he'd started to work on it again, basing it on his earlier <a
href="http://search.cpan.org/perldoc/Regexp::Parser">Regexp::Parser</a>
module.</p>

<h3>Meanwhile, in <i>perl6-internals</i></h3>

<h4><a
href="http://groups.google.com/groups?threadm=20050713142025.GR73056@plum.flirble.org">PMC
Changes? </a></h4>

<p>Nicholas Clark wondered if the PMC layout is likely to remain stable, or if
there might be changes in relation to the generational garbage collector. In
particular, he wanted to know if the API would remain stable.  Leo thought that
there might be changes in the layout, but the API shouldn't change.</p>

<h4><a
href="http://groups.google.com/groups?threadm=643ED742-47AA-4D16-8A8A-BB956F020E90@coleda.com">ParTcl
Accelerator</a></h4>

<p>Will Coleda showed some timings for ParTcl, the Parrot implementation of Tcl,
and made a few suggestions about how to get things going faster.  Patrick and
Leo mused on the issues involved.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050713140849.GP73056@plum.flirble.org">Partitioning
PMCs</a></h4>

<p>Nicholas Clark had some questions about making PMCs and Ponie play well
together, with particular reference to using <code>SvFLAGS()</code>.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050713144138.GT73056@plum.flirble.org">Embedding/Extending
Interface</a></h4>

<p>Nicholas Clark wondered if Chromatic was still waiting for confirmation that
his automated embedding tools were the Right Thing. Apparently, Chromatic is
waiting for confirmation, but offered to send his existing patch, if only to
force the discussion.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050713144716.GU73056@plum.flirble.org">Ponie
Questions</a></h4>

<p>Nicholas Clark had a bunch of questions about various subsystems, mostly in
relation to Ponie. Leo came good with answers.</p>

<h4><a
href="http://groups.google.com/groups?threadm=cff4c4c41b42a1f39d7d4fe68f914841@perl.org">Parrot
Project Management</a></h4>

<p>I'm not sure if Will Coleda's suffering culture shock about the way Parrot
project management happens, or if we're really not doing it right.  The first
rule of Parrot/Perl 6 development is that if you really want something, then the
only way to guarantee that it gets done is to do it yourself. It's certainly
worked for me over the years.</p>

<h4><a
href="http://groups.google.com/groups?threadm=198c87380507140823527d4165@mail.gmail.com">Tcl
GC Issues--Solved</a></h4>

<p>Matt Diephouse announced that as of r8617 in SVN, the longstanding GC bug
that ParTcl occasionally tickled has been fixed. There was no rejoicing on
the list, but at least one summarizer was really pleased to hear it.</p>

<h4><a
href="http://groups.google.com/groups?threadm=42D853A9.8060902@gmail.com">GMC
for Dummies</a></h4>

<p>Summer of Code intern Alexandre Buisse, who is working on a new GC system
for Parrot, pointed us all at <a
href="http://perso.ens-lyon.fr/alexandre.buisse/divers/gmc_for_dummies.pod">an
introduction to the Generational Mark and Compact scheme</a> that he's working
to implement. He and Leo had a discussion about implications, assumptions, and
other stuff.</p>

<p>Bob Rogers asked some tricky questions relating to circular structures and
timely destruction. Discussion of this continues.</p>

<h4>
Register Allocation Fun
</h4>

<p>There was a flurry of patches from Curtis Rawls, who appears to be working on
refactoring and (one hopes) fixing the IMCC register allocator.  Way to go,
Curtis.</p>













<h4>
Meanwhile in <i>perl6-language</i>
</h4>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg20826.html">MML
Dispatch</a></h4>

<p>The ongoing discussion of the right way to dispatch multimethods is still,
um, going on. Damian and Luke appear to have a fundamental disagreement about
what the Right Thing is. &quot;Manhattan!&quot; &quot;Pure!&quot; &quot;Manhattan!&quot;--it's not quite
that bad, but they seem to have entrenched positions. Elsewhere in the thread,
Larry mused on which was more general, classes or roles. Thomas Sandla&szlig;
wondered how they stood in relation to types.</p>

<p>Your summarizer wondered how he was ever going to explain all this and
punted.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg20769.html">Method
Calls on <code>$self</code></a></h4>

<p>My eyes, they burn! At this rate, I'm simply going to use <code>$?SELF</code>
in all my Perl 6 classes. Larry's latest suggestion seems to please even fewer
people than <code>./method</code>, which is really saying something. As someone
who's not a fan of <code>./</code>, I found myself slightly surprised to agree
with Autrijus, who reckons you get used to it really quickly.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg20944.html">The
Perl 6 Library System</a></h4>

<p>In response to a question from Autrijus about coderefs in <code>@INC</code>,
or whatever Perl 6 is going to call it, Larry mused on the possible eventual
design of Perl 6's library system. It seemed to me that he was dropping a
rather heavy hint to any interested readers who might like to come up with a
first cut of Perl 6's library system.</p>

<p>Later, he did some thinking aloud about treating strings as arrays, or vice
versa.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg20913.html">Method
Resolution Order</a></h4>

<p>Stevan &quot;MetaModel&quot; Little cheered Larry's statement that methods, subs,
submethods, and &quot;anything in between&quot; all live in the same namespace. If you
want to give two code-like things the same name, then you must explicitly
declare them as multi.</p>

<p>Stevan went on to ask a bunch of questions about the semantics of method
resolution, so as to get the Perl 6 MetaModel working right. Discussion
ensued.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg20958.html"><code>Type::Class::Haskell</code>
Does Role</a></h4>

<p>I haven't the faintest idea what Yuval Kogman is talking about. Dammit, I
need to learn Haskell now. Luckily, Autrijus, Luke, David Formosa, and Damian
did seem to understand it. There was ASCII art and everything. Sadly, there's no
Unicode art, but it's only a matter of time.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg20959.html">Optimization
Pipeline</a></h4>

<p>Yuval Kogman posted an outline of the optimization pipeline idea that he'd
brought up in a Hackathon. If confess that it looks rather like something
discussed a few months (years?) ago that Chip shot down rather
convincingly. (I remember this because I took pretty much the same position as
Yuval, and I really didn't want to be convinced.)</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg20971.html">STM
Semantics, the Transactional Role</a></h4>

<p>Yuval Kogman discussed some issues with Software Transactional Memory (STM).
A short discussion ensued.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg20976.html">More
Method Resolution Order Questions</a></h4>

<p>Returning from reading up on method resolution orders and class precedence
lists, Stevan Little had a pile of questions and suggestions about Perl 6's
method resolution semantics. He pushed for using &quot;C3&quot; as Perl's algorithm of
choice and is implementing it in Perl6::MetaModel until and unless @Larry
decides differently. He's off to a flying start in that the One True Larry
thinks it's a good idea.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg20983.html">Accessor-Only Virtual Attributes</a></h4>

<p>Sam Vilain wondered what would happen if he made an &quot;accessor&quot; for an
attribute that didn't really exist. He wanted to be able to disguise accessor
methods as attributes within class and subclass scope (at least, I think that's
what he wants). Larry seemed to think he was barking up the wrong tree--class
attributes are only likely to be accessible using the <code>$.whatever</code>
form within their declaring class and not any subclasses. Larry's &quot;got some
driving to do&quot; so expect some more thoughts about this in the next summary.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg20985.html">Strange
Interaction Between Pairs and Named Binding</a></h4>

<p>Autrijus noted that, although</p>

<pre><code>for [1..10].pairs -&gt; Pair $x { say $x.value }</code></pre>

<p>works,</p>

<pre><code>for [1..10].pairs -&gt;      $x { say $x.value }</code></pre>

<p>doesn't, which is somewhat counter-intuitive. The problem is, the second cas
treats the pair as a named argument specifier. After discussion, Autrijus
suggested that the best thing might be to specify that the <code>Bare</code>
code object (which includes pointy and non-pointy blocks) have <code>Any</code>
as a default parameter type--essentially turning off the special behavior of
pairs when calling named blocks. I'm all for this myself, but Larry has yet to
speak.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg20997.html">How
Do Subroutines Check Types? </a></h4>

<p>Ingo Blechschmidt had some questions about specifying types in subroutine
definitions. Specifically, he wanted to be able to specify that a sub only take
instances of a class <code>Foo</code> and its subclasses but not the class <code>Foo</code> (or its
subclasses) itself. Thomas Sandla&szlig; thought that what Ingo wanted is the
default behavior and you actually have to do some work to get it to behave any
other way.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21001.html">Referring
to Package Variables in the Default Namespace</a></h4>

<p>Matthew Hodgson asked for some clarification of how the default package
namespace works. Apparently, Pugs and Synopsis 10 are slightly at odds.  Larry
had some answers. Matthew probably has some more questions.</p>

<h3>Crikey! That Went Quickly</h3>

<p>Or, for the traditionalists among you:</p>

<h3>Acknowledgements, Adverts, Apologies and Alliteration</h3>

<h4>
Hunting the Perfect Archive
</h4>

<p>I'm still on the lookout for a replacement for Google groups for my message
links. I need an archive that's up to date with the lists, and has URLs that
are easy to derive from <code>Message-ID</code>s. Bonus points for good thread handling.</p>

<h4><a href="http://geeksunite.org/">Help Chip</a></h4>

<p>Tell all your friends, this cannot stand.</p>

<h4>
The Usual Coda
</h4>

<p>If you find these summaries useful or enjoyable, please consider
contributing to the Perl Foundation to help support the development of
Perl.</p>

<ul>

<li><a href="http://donate.perl-foundation.org/">The Perl Foundation</a></li>
<li><a href="http://dev.perl.org/perl6/">Perl 6 development site</a></li>

</ul>

<p>Or, you can check out <a href="http://www.bofh.org.uk/">my website</a>.
Maybe now I'm back writing stuff I'll start updating it.  There are also <a
href="http://www.flickr.com/photos/pdcawley">vaguely pretty photos by
me</a>.</p>
<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1795" template="b/article_sidebar2.view">
<!-- sidebar ends -->

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-800" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/07/21/test_mockdbi.html" rel="bookmark">An Introduction to Test::MockDBI</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark Leighton Fisher</span> on <abbr class="published" title="2005-07-21T00:00:00-08:00">July 21, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<h3>Prelude</h3>

<p>How do you test DBI programs:</p>

<ul>

<li>Without having to modify your current program code or environment
settings?</li>

<li>Without having to set up multiple test databases?</li>

<li>Without separating your test data from your test code?</li>

<li>With tests for every bizarre value your program will ever have to
face?</li>

<li>With complete control over all database return values, along with all DBI
method return values?</li>

<li>With an easy, regex-based rules interface?</li>

</ul>

<p>You test with <a
href="http://search.cpan.org/perldoc?Test::MockDBI">Test::MockDBI</a>, that's
how. Test::MockDBI provides all of this by using Test::MockObject::Extends to
mock up the entire DBI API.  Without a solution like Test::MockDBI--a
solution that enables direct manipulation of the DBI--you'll have to trace
DBI methods through a series of test databases.</p>

<p>You can make test databases work, but:</p>

<ul>

<li>You'll need multiple (perhaps many) databases when you need multiple sets
of mutually inconsistent values for complete test coverage.</li>

<li>Some DBI failure modes are impossible to generate through any test
database.</li>

<li>Depending on the database toolset available, it may be difficult to insert
all necessary test values--for example, Unicode values in ASCII applications,
or bizarre file types in a document-manager application.</li>

<li>Test databases, by definition, are separate from their corresponding test
code. This increases the chance that the test code and the test data will fall
out of sync with each other.</li>

</ul>

<p>Using Test::MockDBI avoids these problems. Read on to learn how
Test::MockDBI eases the job of testing DBI applications.</p>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1795" template="b/article_sidebar.view">
<!-- sidebar ends -->

<h3>A Mock Up of the Entire DBI</h3>

<p>Test::MockDBI mocks up the entire DBI API by using <a
href="http://search.cpan.org/perldoc?Test::MockObject::Extends">Test::MockObject::Extends</a>
to substitute a Test::MockObject::Extends object in place of the <a
href="http://search.cpan.org/perldoc?DBI">DBI</a>. A feature of this approach
is that if the DBI API changes (and you use that change), you will notice
during testing if you haven't upgraded Test::MockDBI, as your program will
complain about missing DBI API method(s).</p>

<p>Mocking up the entire DBI means that you can add the DBI testing code into
an existing application without changing the initial application code--using
Test::MockDBI is entirely transparent to the rest of your application, as it
neither knows nor cares that it's using Test::MockDBI in place of the DBI.
This property of transparency is what drove me to develop Test::MockDBI, as it
meant I could add the Test::MockDBI DBI testing code to existing client
applications without modifying the existing code (handy, for us
consultants).</p>

<p>Further enhancing Test::MockDBI's transparency is the <code>DBI testing type</code>
class value. Testing is only enabled when the DBI testing type is non-zero, so
you can just leave the DBI testing code additions in your production code--users will not even know about your DBI testing code unless you tell them.</p>

<p>Mocking up the entire DBI also means that you have complete control of the
DBI's behavior during testing. Often, you can simulate a <code>SELECT</code>
DBI transaction with a simple state machine that returns just a few rows from
the (mocked up) database. Test::MockDBI lets you use a <code>CODEREF</code> to supply
database return values, so you can easily put a simple state machine into the
<code>CODEREF</code> to supply the necessary database values for testing. You could even put
a delay loop into the <code>CODEREF</code> when you need to perform speed tests on your
code.</p>

<h3>Rules-Based DBI Testing</h3>

<p>You control the mocked-up DBI of Test::MockDBI with one or more rules that
you insert as Test::MockDBI method calls into your program. The default DBI
method values provided by Test::MockDBI make the database appear to have a hole
in the bottom of it--all method calls return OK, but you can't get any data
out of the database. Rules for DBI methods that return database values (the
<code>fetch*()</code> and <code>select*()</code> methods) can use either a
value that they return directly for matching method calls, or a <code>CODEREF</code> called
to provide a value each time that rule fires. A rule matches when its DBI
testing type is the current testing type and the current SQL matches the rule's
regular expression. Rules fire in the order in which you declare them, so
usually you want to order your rules from most-specific to least-specific.</p>

<p>The DBI testing type is an unsigned integer matching <code>/^d+$/</code>.
When the DBI testing type is zero, there will be no DBI testing (or at least, no
mocked-up DBI testing) performed, and the program will use the DBI normally. A
zero DBI testing type value in a rule means the rule could fire for any
non-zero DBI testing type value--that is, zero is the wildcard DBI testing
type value for rules. Set the DBI testing type either by a first command-line
argument of the form:</p>

<pre><code>--dbitest[=DTT]</code></pre>

<p>where the optional <code>DTT</code> is the DBI testing type (defaulting to
one), or through Test::MockDBI's <code>set_dbi_test_type()</code> method.
Setting the DBI testing type through a first command-line argument has the
advantage of requiring no modifications to the code under test, as this
command-line processing is done so early (during <code>BEGIN</code> time for
Test::MockDBI) that the code under test should be ignorant of whether this
processing ever happened.</p>













<h3>DBI Return Values</h3>

<p>Test::MockDBI defaults to returning a success (true) value for all DBI
method calls. This fits well with the usual techniques of DBI programming,
where the first DBI error causes the program to stop what it is doing.
Test::MockDBI's <code>bad_method()</code> method creates a rule that forces a
failure return value on the specified DBI method when the current DBI testing
type and SQL match those of the rule. Arbitrary DBI method return value
failures like these are difficult (at best) to generate with a test database.</p>

<p>Test::MockDBI's <code>set_retval_scalar()</code> and
<code>set_retval_array()</code> methods create rules for what database values
to return. Set rules for scalar return values (<code>arrayrefs</code> and <code>hashrefs</code>) with
<code>set_retval_scalar()</code> and for array return value rules with
<code>set_retval_array()</code>. You can supply a value to be returned every
time the rule matches, which is good when extracting single rows out of the
database, such as configuration parameters.  Alternatively, pass a <code>CODEREF</code> that
will be called each time the rule fires to return a new value.  Commonly, with
<code>SELECT</code> statements, the DBI returns one or more rows, then returns an empty row
to signify the end of the data. A <code>CODEREF</code> can incorporate a state machine that
implements this &quot;return 1+ rows, then a terminator&quot; behavior quite easily.
Having individual state machines for each rule is much easier to develop with than
having one master state machine embedded into Test::MockDBI's core. (An early
alpha of Test::MockDBI used the master state machine approach, so I have
empirical evidence of this result--I am not emptily theorizing here.)</p>

<p>Depending on what tools you have for creating your test databases, it may be
difficult to populate the test database with all of the values you need to test
against. Although it is probably not so much the case today, only a few years
ago populating a database with Unicode was difficult, given the
national-charset-based tools of the day. Even today, a document management
system might be difficult to populate with weird file types. Test::MockDBI
makes these kinds of tests much easier to carry out, as you directly specify
the data for the mock database to return rather than using a separate test
database.</p>

<p>This ease of database value testing also applies when you need to test
against combinations of database values that are unlikely to occur in practice
(the old &quot;comparing apples to battleships&quot; problem). If you need to handle
database value corruption--as in network problems causing the return of
partial values from a Chinese database when the program is in the U.S.--this ability to completely specify the database return values could be
invaluable in testing. Test::MockDBI lets you take complete control of your
database return values without separating test code and test data.</p>

<h3>Simplicity: Test::MockDBI's Standard-Output-Based Interface</h3>

<p>This modern incarnation of the age-old stubbed-functions technique also uses
the old technique of &quot;<code>printf()</code> and scratch head&quot; as its output
interface. This being Perl we are working with, and not FORTRAN IV (thank
goodness), we have multiple options beyond the use of unvarnished standard
output.</p>

<p>One option that I think integrates well with DBI-using module testing is to
redirect standard output into a string using <a
href="http://search.cpan.org/perldoc?IO::String">IO::String</a>. You can then
match the string against the regex you are looking for. As you have already
guessed, use of pure standard output integrates well with command-line program
testing.</p>

<p>What you will look for, irrespective of where your code actually looks, is
the output of each DBI method as it executes--the method name and arguments--along with anything else your code writes to standard output.</p>

<h3>Bind Test Data to Test Code</h3>

<p>Because DBI and database return values are bound to your test programs when
using Test::MockDBI, there is less risk of test data getting out of sync with
the test code. A separate test database introduces another point of failure in
your testing process. Multiple test databases add yet another point of failure
for each database. Whatever you use to generate the test databases also
introduces another point of failure for each database.  I can imagine cases
where special-purpose programs for generating test databases might create
multiple points of failure, especially if the programs have to integrate data
from multiple sources to generate the test data (such as a VMS Bill of Materials
database and a Solaris PCB CAD file for a test database generation program
running on Linux).</p>

<p>One of the major advances in software engineering is the increasing ability
to gather and control related information together--the 1990s advance of
object-oriented programming in common languages is a testimony to this, from
which we Perl programmers reap the benefits in our use of CPAN. For many
testing purposes, there is no need for separate test databases. Without that
need for a separate test database, separating test data from test code only
complicates the testing process.  Test::MockDBI lets you bind together your
test code and test data into one nice, neat package. Binding is even closer
than code and comments, as comments can get out of sync with their code, while
the test code and test data for Test::MockDBI cannot get out of sync too far
without causing their tests to fail unexpectedly.</p>

<h3>When to Use Test::MockDBI</h3>

<p>DBI's <code>trace()</code>, <a
href="http://search.cpan.org/perldoc?DBD::Mock">DBD::Mock</a>, and
Test::MockDBI are complementary solutions to the problem of testing DBI
software. DBI's <code>trace()</code> is a pure tracing mechanism, as it does
not change the data returned from the database or the DBI method return values.
DBD::Mock works at level of a database driver, so you have to look at your DBI
testing from the driver's point of view, rather than the DBI caller's point of
view. DBD::Mock also requires that your code supports configurable DBI DSNs,
which may not be the case in all circumstances, especially when you must
maintain or enhance legacy DBI software.</p>

<p>Test::MockDBI works at the DBI caller's level, which is (IMHO) more natural
for testing DBI-using software (possibly a matter of taste: TMTOWTDI).
Test::MockDBI's interface with your DBI software is a set of easy-to-program,
regex-based rules, which incorporate a lot of power into one or a few lines of
code, thereby using Perl's built-in regex support to best advantage. This
binds test data and test code tightly together, reducing the chance of
synchronization problems between the test data and the test code. Using
Test::MockDBI does not require modifying the current code of the DBI software
being tested, as you only need additional code to enable Test::MockDBI-driven
DBI testing.</p>

<p>Test::MockDBI takes additional coding effort when you need to test DBI
program performance.  It may be that for performance testing, you want to use
test databases rather than Test::MockDBI. If you were in any danger of your
copy of <em>DBI.pm</em> becoming corrupted, I don't know whether you could
adequately test that condition with Test::MockDBI, depending on the corruption.
You would probably have to create a special mock DBI to test corrupted DBI code
handling, though you could start building the special mock DBI by inheriting
from Test::MockDBI without any problems from Test::MockDBI's design, as it
should be inheritance-friendly.</p>













<h3>Some Examples</h3>

<p>To make:</p>

<pre><code>$dbh = DBI-&gt;connect(&quot;dbi:AZ:universe&quot;, &quot;mortal&quot;, &quot;(none)&quot;);</code></pre>

<p>fail, add the rule:</p>

<pre><code>$tmd-&gt;bad_method(&quot;connect&quot;, 1,
    &quot;CONNECT TO dbi:AZ:universe AS mortal WITH \\(none\\)&quot;);</code></pre>

<p>(where <code>$tmd</code> is the only Test::MockDBI object, which you obtain
through Test::MockDBI's <code>get_instance()</code> method).</p>

<p>To make a SQL <code>SELECT</code> failure when using
<code>DBI::execute()</code>, use the rule:</p>

<pre><code>$tmd-&gt;bad_method(&quot;execute&quot;, 1,
    &quot;SELECT zip_plus_4 from zipcodes where state='IN'&quot;);</code></pre>

<p>This rule implies that:</p>

<ul>

<li>The <code>DBI::connect()</code> <code>succeeded()</code>.</li>

<li>The <code>DBI::prepare()</code> <code>succeeded()</code>.</li>

<li>But the <code>DBI::execute()</code> failed as it should.</li>

</ul>

<p>A common use of direct scalar return values is returning configuration data,
such as a U.S. zip code for an address:</p>

<pre><code>$tmd-&gt;set_retval_scalar(1,
 &quot;zip5.*'IN'.*'NOBLESVILLE'.*'170 WESTFIELD RD'&quot;,
 [ 46062 ]);</code></pre>

<p>This demonstrates using a regular expression, as matching SQL could then
look like this:</p>

<pre><code>SELECT
  zip5
FROM
  zipcodes
WHERE
  state='IN' AND
  city='NOBLESVILLE' AND
  street_address='170 WESTFIELD RD'</code></pre>

<p>and the rule would match.</p>

<p><code>SELECT</code>s that return one or more rows from the database are the
common case:</p>

<pre><code>my $counter = 0;                    # name counter
sub possibly_evil_names {
    $counter++;
    if ($counter == 1) {
        return ('Adolf', 'Germany');
    } elsif ($counter == 2) {
        return ('Josef', 'U.S.S.R.');
    } else {
        return ();
    }
}
$tmd-&gt;set_retval_array(1,
   &quot;SELECT\\s+name,\\s+country.*possibly_evil_names&quot;,
   \&amp;possibly_evil_names);</code></pre>

<p>Using a <code>CODEREF</code> (<code>\&amp;possibly_evil_names</code>) lets you easily add
the state machine for implementing a return of two names followed by an empty
array (because the code uses <code>fetchrow_array()</code> to retrieve each
row). SQL for this query could look like:</p>

<pre><code>SELECT
  name,
  country
FROM
  possibly_evil_names
WHERE
  year &lt; 2000</code></pre>

<h3>Summary</h3>

<p>Albert Einstein once said, &quot;Everything should be made as simple as possible,
but no simpler.&quot; This is what I have striven for while developing Test::MockDBI--the simplest possible useful module for testing DBI programs by mocking up
the entire DBI.</p>

<p>Test::MockDBI gives you:</p>

<ul>

<li>Complete control of DBI return values and database-returned data.</li>

<li>Returned database values from either direct value specifications or
<code>CODEREF</code>-generated values.</li>

<li>Easy, regex-based rules that govern the DBI's behavior, along with
intelligent defaults for the common cases.</li>

<li>Complete transparency to other code, so the code under test neither knows
nor cares that you are testing it with Test::MockDBI.</li>

<li>Test data tightly bound to test code, which promotes cohesiveness in your
testing environment, thereby reducing the chance that your tests might silently
fail due to loss of synchronization between your test data and your test
code.</li>

</ul>

<p>Test::MockDBI is a valuable addition to the arsenal of DBI testing
techniques.</p>





        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-806" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/07/p6pdigest/20050714.html" rel="bookmark">This Week in Perl 6, July 5-12, 2005</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Matt Fowles</span> on <abbr class="published" title="2005-07-14T00:00:00-08:00">July 14, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>All--</p>

<p>Welcome to another summary from the frog house, a house so green you can 
see it from outer space (according to Google Earth).</p>

<h3><i>Perl 6 Compiler</i></h3>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/970364a0f2f52b9e/3d87824ffe636644#3d87824ffe636644">Building
Pugs Workaround</a></h4>

<p>Sam Vilain posted a useful workaround to the error <code>error: field
`_crypt_struct' has incomplete type</code>, which occurs on some systems.
Fortunately, <a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/e6246066a58d0751/ffcfa88d592a26c9#ffcfa88d592a26c9">Salvador
Ortiz Garcia found a fix</a>.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/49f0827f81def78d/b88e8886f14b55c7#b88e8886f14b55c7">Pugs,
Pirate. Pirate, Pugs. </a></h4>

<p>Autrijus began plotting with the Pirate folks. Thoughts include unifying PIL
and PAST, or possibly retargeting PIL to PAST. Perhaps the result should be a
more nautical dog. Maybe schipperke.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/cb4496b1e466142b/d6a35534fbc745aa#d6a35534fbc745aa">Implicit
Invocants and Pain</a></h4>

<p>Larry (as the summary will later explain) ruled that <code>./method</code>
was gone. He further ruled that <code> .method </code> would pitch fits at
either compile or run time if <code>$_ =:= $?SELF</code> were false.  Autrijus
found this quite difficult to implement. Talk continues, and my instincts tell
me that this too will pass, although Larry assures us that it is absolutely
permanent for at least a week.</p>

<h3>Parrot</h3>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/8c182587ef8cbc62/4c48cd30a6a3f878#4c48cd30a6a3f878">Key
Question</a></h4>

<p>Klass-Jan Stol found that using a assigning a floating point value to a key
and then using it makes Parrot segfault. Warnock applies.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/01fc3ff8a6203ea6/ae4374d359358914#ae4374d359358914">Parrot
Copyrights</a></h4>

<p>Allison Randal hinted that the Perl Foundation has almost finished hammering
out some legal stuff and there will soon be sweeping changes throughout the
repository addressing copyright issues.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/5e4230c5bcd0fc94/0bdb158c243fa88c#0bdb158c243fa88c">Character
Classes in Globs</a></h4>

<p>Will Coleda noted that Tcl would pass more tests if PGE supported character
classes in globs. Patrick, unable to resist the siren call of passing tests,
implemented it.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/7f12c68f90744406/667e5992eeedcd29#667e5992eeedcd29">Amber
for Parrot</a></h4>

<p>Roger Browne announced that he had succeed in extracting viable DNA from a
Parrot encased in amber since the Jurassic age. Either that or he released
Amber version 0.2.2--I'm not sure which.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/fb1b9a5072fcbc55/bf163135cb4a7a27#bf163135cb4a7a27">Leo's
Branch</a></h4>

<p>Leo has created a branch in SVN (<em>branches/leo-ctx5</em>) of his work implementing
the new calling conventions. This led to some discussion of <a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/621435fc758277c1/fa477ead1d6957e1#fa477ead1d6957e1">how
to deal with optional arguments</a>.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/520665e89857bff8/24115e27fd5aeb37#24115e27fd5aeb37">Leo's
Branch Meets <code>mod_parrot</code></a></h4>

<p>Jeff Horwitz posted some observations and troubles he was having with Leo's
branch of new calling conventions. Leo warned that the branch was still young,
but would gladly take test cases.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/3de317517c40bfa3/157132eab2cbe703#157132eab2cbe703">Leo's
Branch Meets PGE</a></h4>

<p>After the initial discussion of optional parameters, Patrick updated the
<em>leo_ctx5</em> branch of PGE to the new calling conventions. All tests pass.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/4fe4d8d6b23aec8e/41f4834e16082655#41f4834e16082655">Get
Onto the Bus</a></h4>

<p>Matt Diephouse found a Bus Error when running
<em>languages/tcl/examples/bench.tcl</em>. Warnock applies.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/51ac75d80345b160/99254fc869fb1f97#99254fc869fb1f97">MinGW
Patch Resurrection</a></h4>

<p>Fran&ccedil;ois Perrad resurrected a patch from mid-June with a set of action
items. Warnock applies.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/e7f319f6edcee5fe/88e0bd3eb7606a57#88e0bd3eb7606a57">Scared
Parrots Like Scheme</a></h4>

<p>Joh Lenz posted an announcement that he had an alpha version of Chicken (a
Scheme to C compiler) backending to Parrot. Leo provided answers to some of his
questions.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/64ebf15daf416f4a/224e3552a6a356a0#224e3552a6a356a0">Bytecode
Vs. PMCs</a></h4>

<p>Matt Diephouse posted a list of questions about the place of PMCs. Some of
the core tradeoffs include maintainability, portability, optimization, duplicate
implementations, and security.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/8bd8095c14224951/4b2a7f23442595b5#4b2a7f23442595b5"><code>make
svnclean</code></a></h4>

<p>Leo pointed out that someone removed <code>make svnclean</code>, but that he
found it useful. Chip suggested renaming it <code>make svnclobber</code>, as it
does more than just clean.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/303a65c78710702d/d277f7d8ed2d9c1f#d277f7d8ed2d9c1f"><em>pmc2c.pl</em>
Bug</a></h4>

<p>Nicholas Clark found a bug in the shortcut to avoid writing a PMC dump file.
Warnock applies.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/a6ccdcd2d2f1979d/2628963df14329d6#2628963df14329d6">Define
<code>cache</code></a></h4>

<p>Nicholas Clark suggested that it was probably not wise to
<code>#define</code> <code>cache</code>. They removed it.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/36e9e7223850dcbe/c6e71a192649f4e8#c6e71a192649f4e8">Parrots
Getting Smarter</a></h4>

<p>Leo pointed out that at least one parrot understood the concept of zero,
putting it some distance ahead of Romans when it comes to math. Once the
Parrots start to grow opposable thumbs, I will welcome our new Parrot
overlords.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/4762ca5b69bec1cd/e69e85ac96c3ed6f#e69e85ac96c3ed6f">Leo's
Branch Meets Exceptions</a></h4>

<p>Leo posted two suggestions for how the new calling conventions could
interact with exceptions. Autrijus liked the idea of unifying exception
handlers with the rest of calls and returns.</p>













<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/7cdffa86f6f4ebb6/8ec31c6030b0950e#8ec31c6030b0950e">Control
Flow Graph Bugs</a></h4>

<p>Curtis Rawls noted what he thought might be a bug in the
<code>compute_dominators</code> function. Leo confirmed that it was likely a
bug. Later he posted a note saying he was working on a new implementation for
some of the CFG algorithms. He asked for a hand, but Warnock applied. Actually,
I think I have looked at that code before. I would help be happy to take a
look, Curtis.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/f5db2c4bec9b285f/4c502fffd9480eab#4c502fffd9480eab">TODO:
Steal Good Ideas from Dan</a></h4>


<p>Will Coleda opened a ticket suggesting that we open tickets based on some of
Dan's latest posts to Squaks of the Parrot. Remember: "talent imitates, but
genius steals."</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/fa0b911b26481df3/d3aa6dfdb0522d30#d3aa6dfdb0522d30">Punie</a></h4>

<p>Allison Randal wants to add Punie (a Perl 1 compiler) to SVN. Response was
positive.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/e09da82d02a0486a/7f74455bca561f06#7f74455bca561f06">Mobilizing
PM groups</a></h4>

<p>Will Coleda wondered if there had been any work mobilizing Perl Monger
groups for the good of Parrot. Maybe I should finally look up the Cambridge or
Boston PM group.</p>

<h3><em>Perl 6 Language</em></h3>

<p>As usual in <em>p6l</em> land, there are a couple of really long threads. As usual in
<em>p6summarizer</em> land, they will get short summaries. Odd how that happens.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/35bee7deb1a4defc/f959d1b2d0c37f34#f959d1b2d0c37f34">Conflicting
Autogenerated Accessors</a></h4>

<p>Last week, Stevan Little wondered what would happen with conflicting
autogenerated accessor names. Larry said they would carp as soon as they
were discovered.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/d6ccf668de28e368/5556b425d916aada#5556b425d916aada">DBI
v2</a></h4>

<p>The first really long thread has to do with the next version of DBI. I am
not really a database person, but apparently those who are have <a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/b8d9be2e31c02600/c43179f8586e8b72#c43179f8586e8b72">strong
opinions</a>.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/c19bea30514933f4/3b16c5e62f1cffbe#3b16c5e62f1cffbe">Time::Local</a></h4>

<p>The next really long thread has to do with the next version of Time::Local.
I am not really a Time person, but apparently those who are have strong
opinions.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/7a159cc98802b975/7eb8b200aa302aac#7eb8b200aa302aac">Submethods</a></h4>

<p>Stevan Little and Larry Wall talked about submethods, their purpose, and
their interaction with the metamodel. I must say that I have only partially
wrapped my head around metamodels at all.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/f81ec2a928ff59b7/c89f2f00d5c263de#c89f2f00d5c263de">SMD
Considered Harmful?</a></h4>

<p>Last week, Yuval Kogman conjectured that MMD should be the one true MD, as
it allowed nifty extensibility. This week, Stuart Cook offered a sort of
compromise. I rather like Stuart's compromise.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/322560d7d27fb63c/7332b80612ba1300#7332b80612ba1300">Dependency
Injection</a></h4>

<p>Piers wants to be able to have classes that inject themselves in correctly
at use time, based on what is actually used. Larry commented, but one quote
really caught my attention: "Globals are bad only if you use them to hold
non-global values." &lt;off-topic&gt;There is an important lesson imbedded in
that quote. We really should learn rules not to follow them blindly, but so
that we understand the spirit behind them and respect that instead. Not that I
have had screaming matches with any programmers who blindly eschew globals and
<code>goto</code>s without understanding why. &lt;/off-topic&gt;  That was
more of a rant then just off-topic. Oh well.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/ab5aff3faacb3d55/0fabc28358cb62be#0fabc28358cb62be"><code>File.seek</code>
Interface</a></h4>

<p>Wolverian wondered what the <code>seek</code> interface would look like for
handles.  Larry likes the idea of it working entirely through opaque position
objects using <code>`</code> to specify units.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/efafd6d6e69625ad/4006f811870dbf22#4006f811870dbf22">Perl
6/Perl 5 ~ 82%</a></h4>

<p>Michael Hendricks noticed that (according to <a
href="http://search.cpan.org/perldoc?Text::TypingEffort">Text::TypingEffort</a>).
Perl 6 requires 18 percent less effort than Perl 5. He suggests that this is a bad
thing for the community's waistline. I conjecture that Perl developers will use
the extra time they save for activities such as running and canoeing, and as a
result will paradoxically lose weight from expending less effort at work.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/afe5ce7665d8c7cb/4d5909caa7ae0e1f#4d5909caa7ae0e1f">Creating
Value Types</a></h4>

<p>Ingo Blechschmidt wondered how to create a value type. Luke Palmer suggested
using an <code>is value</code> trait. He then went on to speculate about
mutating value traits and COW semantics. Larry though that perhaps an <code>is
copy</code> trait was called for. Oooh, a preposition at the end of a sentence;
makes me want to occasionally split infinitives.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/543393430f6292d0/525e5dfe05a1bd18#525e5dfe05a1bd18">OO
<code>.isa</code></a></h4>

<p>Ingo Blechschmidt viciously lied when claiming to post a "quick"
<code>isa</code> question. This quickly went the way of the meta object. I
think I mentioned my take on those earlier (powerful, but ow).</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/93f95d3dd9c36110/cd3de4e88dc2868d#cd3de4e88dc2868d">Method
Call on Invocant</a></h4>

<p>The last really long thread has to do with the next chapter in the "method
call on self" saga. I am a bit of a "method call on self" person, and apparently
those who are have strong opinions. It's worth noting this time that Larry
updated the current state of the world. Now <code>./method</code> is gone and
<code>.method</code> only works when <code>$_ =:= $?SELF</code>.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/8c1270622f08e693/aad674b8d5e852ee#aad674b8d5e852ee"><code>use</code>
and <code>require</code> Question</a></h4>

<p>Ingo Blechschmidt wondered what <code>use</code> and <code>require</code>
actually do. Gall Yahas suggested they return the last thing in the
used/required file. Larry agreed and held that they would also return the same
thing. He also warned that <code>%INC</code> would probably work differently in
Perl 6.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/c4349076f6416aca/5a12927bc3af87d9#5a12927bc3af87d9">User-Defined <code>infix</code></a></h4>

<p>Autrijus wondered if an method <code>infix:&lt;===&gt;</code> would need
marking as export for a script that <code>use</code>s it to get the method.
Larry explained that the method <code> infix:&lt;===&gt;</code> would be
available by name, but would have to be marked as export for the syntactic
sugar of <code>A === B</code> to work.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/c189bc6a1ff45b63/6930a91ec364db48#6930a91ec364db48">Hackathon
Notes</a></h4>

<p>Autrijus posted a link to his Hackathon notes. This spawned several threads.
David Storrs tried to convince people to change subject lines, with limited
success. Much of the discussion focused on MMD and how confusing it was. Damian
Conway posted his set of three rules that would prevent AIs from harming humans
and his set of eight rules that would prevent MMDs from harming programmers,
proving that MMDs are almost three times more dangerous than AIs.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/34204e4b08d29684/adb4216e9160ce7d#adb4216e9160ce7d">Raw
Binary Data</a></h4>

<p>David Formosa wanted to play with raw binary data in Perl 6. I try and avoid
raw things except sushi. Larry suggested that this would just be a string with
its maximum abstraction level set to bytes.</p>

<h3>The Usual Footer</h3>

<p>To post to any of these mailing lists please subscribe by sending email to
<code>perl6-internals-subscribe@perl.org</code>,
<code>perl6-language-subscribe@perl.org</code>, or
<code>perl6-compiler-subscribe@perl.org</code>. If you find these summaries
useful or enjoyable, please consider contributing to the Perl Foundation to
help support the development of Perl. You might also like to send feedback to
<csperl file="mailmunge" arg_email="ubermatt@gmail.com" arg_display="ubermatt@gmail.com" arg_ending="." /></p>
<ul>

<li><a href="http://donate.perl-foundation.org/">The Perl Foundation</a></li>
<li><a href="http://dev.perl.org/perl6/">Perl 6 development site</a></li>
<li><a href="http://planet.parrotcode.org/">Parrot blog aggregator</a></li>

</ul>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1714" template="b/article_sidebar2.view">
<!-- sidebar ends -->

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-798" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/07/14/bestpractices.html" rel="bookmark">Ten Essential Development Practices</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Damian Conway</span> on <abbr class="published" title="2005-07-14T00:00:00-08:00">July 14, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>The following ten tips come from <em><a
href="http://www.oreilly.com/catalog/perlbp/">Perl Best Practices</a></em>, a
new book of Perl coding and development guidelines by Damian Conway.</p>

<h3>1. Design the Module's Interface First</h3>

<p>The most important aspect of any module is not how it implements the
facilities it provides, but the way in which it provides those facilities in
the first place. If the module's API is too awkward, or too complex, or too
extensive, or too fragmented, or even just poorly named, developers will avoid
using it. They'll write their own code instead. In that way, a poorly designed
module can actually reduce the overall maintainability of a system.</p>

<p>Designing module interfaces requires both experience and creativity. Perhaps
the easiest way to work out how an interface should work is to "play test" it:
to write examples of code that will use the module before implementing the
module itself. These examples will not be wasted when the design is complete.
You can usually recycle them into demos, documentation examples, or the core of
a test suite.</p>

<a href="http://conferences.oreillynet.com/os2005/"><img src="http://conferences.oreillynet.com/images/os2005/banners/120x240.gif" width="120" height="240" hspace="10" vspace="10" border="0" alt="O'Reilly Open Source Convention 2005." align="right" /></a>

<p>The key, however, is to write that code as if the module were already
available, and write it the way you'd most like the module to work.</p>

<p>Once you have some idea of the interface you want to create, convert your
"play tests" into actual tests (see Tip #2). Then it's just a Simple Matter Of
Programming to make the module work the way that the code examples and the
tests want it to.</p>

<p>Of course, it may not be possible for the module to work the way you'd most
like, in which case attempting to implement it that way will help you determine
what aspects of your API are not practical, and allow you to work out what
might be an acceptable alternative.</p>

<h3>2. Write the Test Cases Before the Code</h3>

<p>Probably the single best practice in all of software development is writing
your test suite first.</p>

<p>A test suite is an executable, self-verifying specification of the behavior
of a piece of software. If you have a test suite, you can--at any point in the
development process--verify that the code works as expected. If you have a test
suite, you can--after any changes during the maintenance cycle--verify that the
code still works as expected.</p>

<p>Write the tests first. Write them as soon as you know what your interface
will be (see #1). Write them before you start coding your application or
module.  Unless you have tests, you have no unequivocal specification of what
the software should do, and no way of knowing whether it does it.</p>

<p>Writing tests always seems like a chore, and an unproductive chore at that:
you don't have anything to test yet, so why write tests? Yet most developers
will--almost automatically--write driver software to test their new module in
an ad hoc way:<a id="OLE_LINK428"></a></p>

<pre><code>&gt; cat try_inflections.pl

# Test my shiny new English inflections module...

use Lingua::EN::Inflect qw( inflect );

# Try some plurals (both standard and unusual inflections)...

my %plural_of = (
   'house'         =&gt; 'houses',
   'mouse'         =&gt; 'mice',
   'box'           =&gt; 'boxes',
   'ox'            =&gt; 'oxen',
   'goose'         =&gt; 'geese',
   'mongoose'      =&gt; 'mongooses', 
   'law'           =&gt; 'laws',
   'mother-in-law' =&gt; 'mothers-in-law',
);
 
# For each of them, print both the expected result and the actual inflection...

for my $word ( keys %plural_of ) {
   my $expected = $plural_of{$word};
   my $computed = inflect( "PL_N($word)" );
 
   print "For $word:\n", 
         "\tExpected: $expected\n",
         "\tComputed: $computed\n";
}</code></pre>

<p>A driver like that is actually harder to write than a test suite, because
you have to worry about formatting the output in a way that is easy to read.
It's also much harder to use the driver than it would be to use a test suite,
because every time you run it you have to wade though that formatted output
and verify "by eye" that everything is as it should be. That's also
error-prone; eyes are not optimized for picking out small differences in the
middle of large amounts of nearly identical text.</p>

<p>Instead of hacking together a driver program, it's easier to write a test
program using the standard <a
href="http://search.cpan.org/perldoc?Test::Simple">Test::Simple</a> module.
Instead of <code>print</code> statements showing what's being tested, you just
write calls to the <code>ok()</code> subroutine, specifying as its first
argument the condition under which things are okay, and as its second argument
a description of what you're actually testing:<a id="OLE_LINK429"></a></p>

<pre><code>&gt; cat inflections.t

use Lingua::EN::Inflect qw( inflect);

use Test::Simple qw( no_plan);

my %plural_of = (
   'mouse'         =&gt; 'mice',
   'house'         =&gt; 'houses',
   'ox'            =&gt; 'oxen',
   'box'           =&gt; 'boxes',
   'goose'         =&gt; 'geese',
   'mongoose'      =&gt; 'mongooses', 
   'law'           =&gt; 'laws',
   'mother-in-law' =&gt; 'mothers-in-law',
);

for my $word ( keys %plural_of ) {
   my $expected = $plural_of{$word};
   my $computed = inflect( "PL_N($word)" );

   ok( $computed eq $expected, "$word -&gt; $expected" );
}</code></pre> 













<p>Note that this code loads <code>Test::Simple</code> with the argument
<code>qw( no_plan )</code>. Normally that argument would be <code>tests =&gt;
count</code>, indicating how many tests to expect, but here the tests are
generated from the <code>%plural_of</code> table at run time, so the final
count will depend on how many entries are in that table. Specifying a fixed
number of tests when loading the module is useful if you happen know that
number at compile time, because then the module can also "meta-test:" verify
that you carried out all the tests you expected to.</p>

<p>The <code>Test::Simple</code> program is slightly more concise and readable
than the original driver code, and the output is much more compact and
informative:</p>

<pre><code>&gt; perl inflections.t

ok 1 - house -&gt; houses
ok 2 - law -&gt; laws
not ok 3 - mongoose -&gt; mongooses
#     Failed test (inflections.t at line 21)
ok 4 - goose -&gt; geese
ok 5 - ox -&gt; oxen
not ok 6 - mother-in-law -&gt; mothers-in-law
#     Failed test (inflections.t at line 21)
ok 7 - mouse -&gt; mice
ok 8 - box -&gt; boxes
1..8
# Looks like you failed 2 tests of 8. </code></pre>

<p>More importantly, this version requires far less effort to verify the
correctness of each test. You just scan down the left margin looking for a
<code>not</code> and a comment line.</p>

<p>You might prefer to use the <a
href="http://search.cpan.org/perldoc?Test::More">Test::More</a> module instead
of <code>Test::Simple</code>. Then you can specify the actual and expected
values separately, by using the <code>is()</code> subroutine, rather than
<code>ok()</code>:</p>

<pre><code>use Lingua::EN::Inflect qw( inflect );
use Test::More qw( no_plan ); # Now using more advanced testing tools

my %plural_of = (
   'mouse'         =&gt; 'mice',
   'house'         =&gt; 'houses',
   'ox'            =&gt; 'oxen',
   'box'           =&gt; 'boxes',
   'goose'         =&gt; 'geese',
   'mongoose'      =&gt; 'mongooses', 
   'law'           =&gt; 'laws',
   'mother-in-law' =&gt; 'mothers-in-law',
);

for my $word ( keys %plural_of ) {
   my $expected = $plural_of{$word};
   my $computed = inflect( "PL_N($word)" );

   # Test expected and computed inflections for string equality...
   is( $computed, $expected, "$word -&gt; $expected" );
}</code></pre> 

<p>Apart from no longer having to type the <code>eq</code> yourself, this
version also produces more detailed error messages:</p>

<pre><code>&gt; perl inflections.t

ok 1 - house -&gt; houses
ok 2 - law -&gt; laws
not ok 3 - mongoose -&gt; mongooses
#     Failed test (inflections.t at line 20)
#          got: 'mongeese'
#     expected: 'mongooses'
ok 4 - goose -&gt; geese
ok 5 - ox -&gt; oxen
not ok 6 - mother-in-law -&gt; mothers-in-law
#     Failed test (inflections.t at line 20)
#          got: 'mothers-in-laws'
#     expected: 'mothers-in-law'
ok 7 - mouse -&gt; mice
ok 8 - box -&gt; boxes
1..8
# Looks like you failed 2 tests of 8.</code></pre>

<p>The <a
href="http://search.cpan.org/perldoc?Test::Tutorial">Test::Tutorial</a>
documentation that comes with Perl 5.8 provides a gentle introduction to both
<code>Test::Simple</code> and <code>Test::More</code>.</p>

<h3>3. Create Standard POD Templates for Modules and Applications</h3>

<p>One of the main reasons documentation can often seem so unpleasant is the
"blank page effect." Many programmers simply don't know how to get started or
what to say.</p>

<p>Perhaps the easiest way to make writing documentation less forbidding (and
hence, more likely to actually occur) is to circumvent that initial empty screen
by providing a template that developers can cut and paste into their code.</p>

<p>For a module, that documentation template might look something like
this:</p>

<pre><code>=head1 NAME

&lt;Module::Name&gt; - &lt;One-line description of module's purpose&gt;

=head1 VERSION

The initial template usually just has:

This documentation refers to &lt;Module::Name&gt; version 0.0.1.

=head1 SYNOPSIS

   use &lt;Module::Name&gt;;

   # Brief but working code example(s) here showing the most common usage(s)
   # This section will be as far as many users bother reading, so make it as
   # educational and exemplary as possible.

=head1 DESCRIPTION

A full description of the module and its features.

May include numerous subsections (i.e., =head2, =head3, etc.).

=head1 SUBROUTINES/METHODS

A separate section listing the public components of the module's interface.

These normally consist of either subroutines that may be exported, or methods
that may be called on objects belonging to the classes that the module
provides.

Name the section accordingly.

In an object-oriented module, this section should begin with a sentence (of the
form "An object of this class represents ...") to give the reader a high-level
context to help them understand the methods that are subsequently described.

=head1 DIAGNOSTICS

A list of every error and warning message that the module can generate (even
the ones that will "never happen"), with a full explanation of each problem,
one or more likely causes, and any suggested remedies.

=head1 CONFIGURATION AND ENVIRONMENT

A full explanation of any configuration system(s) used by the module, including
the names and locations of any configuration files, and the meaning of any
environment variables or properties that can be set. These descriptions must
also include details of any configuration language used.

=head1 DEPENDENCIES

A list of all of the other modules that this module relies upon, including any
restrictions on versions, and an indication of whether these required modules
are part of the standard Perl distribution, part of the module's distribution,
or must be installed separately.

=head1 INCOMPATIBILITIES

A list of any modules that this module cannot be used in conjunction with.
This may be due to name conflicts in the interface, or competition for system
or program resources, or due to internal limitations of Perl (for example, many
modules that use source code filters are mutually incompatible).

=head1 BUGS AND LIMITATIONS

A list of known problems with the module, together with some indication of
whether they are likely to be fixed in an upcoming release.

Also, a list of restrictions on the features the module does provide: data types
that cannot be handled, performance issues and the circumstances in which they
may arise, practical limitations on the size of data sets, special cases that
are not (yet) handled, etc.

The initial template usually just has:

There are no known bugs in this module.

Please report problems to &lt;Maintainer name(s)&gt; (&lt;contact address&gt;)

Patches are welcome.

=head1 AUTHOR

&lt;Author name(s)&gt;  (&lt;contact address&gt;)

=head1 LICENSE AND COPYRIGHT

Copyright (c) &lt;year&gt; &lt;copyright holder&gt; (&lt;contact address&gt;).
All rights reserved.

followed by whatever license you wish to release it under.

For Perl code that is often just:

This module is free software; you can redistribute it and/or modify it under
the same terms as Perl itself. See L&lt;perlartistic&gt;.  This program is
distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.</code></pre>













<p>Of course, the specific details that your templates provide may vary from
those shown here, according to your other coding practices. The most likely
variation will be in the license and copyright, but you may also have specific
in-house conventions regarding version numbering, the grammar of diagnostic
messages, or the attribution of authorship.</p>

<h3>4. Use a Revision Control System</h3>

<p>Maintaining control over the creation and modification of your source code
is utterly essential for robust team-based development.  And not just over
source code: you should be revision controlling your documentation, and data
files, and document templates, and makefiles, and style sheets, and change
logs, and any other resources your system requires.</p>

<p>Just as you wouldn't use an editor without an Undo command or a word
processor that can't merge documents, so too you shouldn't use a file system
you can't rewind, or a development environment that can't integrate the work
of many contributors.</p>

<p>Programmers make mistakes, and occasionally those mistakes will be
catastrophic. They will reformat the disk containing the most recent version of the
code. Or they'll mistype an editor macro and write zeros all through the source
of a critical core module. Or two developers will unwittingly edit the same
file at the same time and half their changes will be lost. Revision control
systems can prevent those kinds of problems.</p>

<p>Moreover, occasionally the very best debugging technique is to just give up,
stop trying to get yesterday's modifications to work correctly, roll the code
back to a known stable state, and start over again. Less drastically, comparing
the current condition of your code with the most recent stable version from
your repository (even just a line-by-line <code>diff</code>) can often help you isolate your
recent "improvements" and work out which of them is the problem.</p>

<p>Revision control systems such as RCS, CVS, Subversion, Monotone, <code>darcs</code>,
Perforce, GNU arch, or BitKeeper can protect against calamities, and ensure
that you always have a working fallback position if maintenance goes horribly
wrong. The various systems have different strengths and limitations, many of
which stem from fundamentally different views on what exactly revision control
is. It's a good idea to audition the various revision control systems, and find
the one that works best for you.  <em>Pragmatic Version Control Using
Subversion</em>, by Mike Mason (Pragmatic Bookshelf, 2005) and <a href="http://www.oreilly.com/catalog/cvs/"><em>Essential
CVS</em></a>, by Jennifer Vesperman (O'Reilly, 2003) are useful starting
points.</p>

<h3>5. Create Consistent Command-Line Interfaces</h3>

<p>Command-line interfaces have a strong tendency to grow over time, accreting
new options as you add features to the application. Unfortunately, the
evolution of such interfaces is rarely designed, managed, or controlled, so the
set of flags, options, and arguments that a given application accepts are
likely to be ad hoc and unique.</p>

<p>This also means they're likely to be inconsistent with the unique ad hoc
sets of flags, options, and arguments that other related applications provide.
The result is inevitably a suite of programs, each of which is driven in a
distinct and idiosyncratic way. For example:</p>

<pre><code>&gt; orchestrate source.txt -to interim.orc

&gt; remonstrate +interim.rem -interim.orc 

&gt; fenestrate  --src=interim.rem --dest=final.wdw
Invalid input format

&gt; fenestrate --help
Unknown option: --help.
Type 'fenestrate -hmo' for help</code></pre>

<p>Here, the <code>orchestrate</code> utility expects its input file as its
first argument, while the <code>-to</code> flag specifies its output file. The
related <code>remonstrate</code> tool uses <code>-infile</code> and
<code>+outfile</code> options instead, with the output file coming first. The
<code>fenestrate</code> program seems to require GNU-style "long options:"
<code>--src=infile</code> and <code>--dest=outfile</code>, except, apparently,
for its oddly named help flag. All in all, it's a mess.</p>

<p>When you're providing a suite of programs, all of them should appear to
work the same way, using the same flags and options for the same features
across all applications. This enables your users to take advantage of existing
knowledge--instead of continually asking you.</p>

<p>Those three programs should work like this:</p>

<pre><code>&gt; orchestrate -i source.txt -o dest.orc

&gt; remonstrate -i source.orc -o dest.rem

&gt; fenestrate  -i source.rem -o dest.wdw
Input file ('source.rem') not a valid Remora file
(type "fenestrate --help" for help)

&gt; fenestrate --help
fenestrate - convert Remora .rem files to Windows .wdw format
Usage: fenestrate [-i &lt;infile&gt;] [-o &lt;outfile&gt;] [-cstq] [-h|-v]
Options:
   -i &lt;infile&gt; Specify input source [default: STDIN]
   -o &lt;outfile&gt; Specify output destination [default: STDOUT]
   -c Attempt to produce a more compact representation
   -h Use horizontal (landscape) layout
   -v Use vertical (portrait) layout
   -s Be strict regarding input
   -t Be extra tolerant regarding input
   -q Run silent
   --version Print version information
   --usage Print the usage line of this summary
   --help Print this summary
   --man Print the complete manpage</code></pre>

<p>Here, every application that takes input and output files uses the same two
flags to do so. A user who wants to use the <code>substrate</code> utility (to convert that
final .wdw file to a subroutine) is likely to be able to guess
correctly the required syntax:</p>

<pre><code>&gt; substrate  -i dest.wdw -o dest.sub</code></pre>

<p>Anyone who can't guess that probably can guess that:</p>

<pre><code>&gt; substrate --help</code></pre>

<p>is likely to render aid and comfort.</p>













<p>A large part of making interfaces consistent is being consistent in
specifying the individual components of those interfaces. Some conventions that
may help to design consistent and predictable interfaces include:</p>

<ul>

<li><p>Require a flag preceding every piece of command-line data, except
filenames.</p>

<p>Users don't want to have to remember that your application requires "input
file, output file, block size, operation, fallback strategy," and requires
them in that precise order:</p>

<pre><code>&gt; lustrate sample_data proc_data 1000 normalize log</code></pre>

<p>They want to be able to say explicitly what they mean, in any order that
suits them:</p>

<pre><code>&gt; lustrate sample_data proc_data -op=normalize -b1000 --fallback=log</code></pre></li>

<li><p>Provide a flag for each filename, too, especially when a program can be
given files for different purposes.</p>

<p>Users might also not want to remember the order of the two positional
filenames, so let them label those arguments as well, and specify them in
whatever order they prefer:</p>

<pre><code>&gt; lustrate -i sample_data -op normalize -b1000 --fallback log -o proc_data</code></pre></li>

<li><p>Use a single <code>-</code> prefix for short-form flags, up to three
letters (<code>-v</code>, <code>-i</code>, <code>-rw</code>, <code>-in</code>,
<code>-out</code>).</p>

<p>Experienced users appreciate short-form flags as a way of reducing typing
and limiting command-line clutter. Don't make them type two dashes in these
shortcuts.</p></li>

<li><p>Use a double <code>--</code> prefix for longer flags
(<code>--verbose</code>, <code>--interactive</code>, <code>--readwrite</code>,
<code>--input</code>, <code>--output</code>).</p>

<p>Flags that are complete words improve the readability of a command line (in
a shell script, for example). The double dash also helps to distinguish between
the longer flag name and any nearby file names.</p></li>

<li><p>If a flag expects an associated value, allow an optional <code>=</code> between the
flag and the value.</p>

<p>Some people prefer to visually associate a value with its preceding
flag:</p>

<pre><code>&gt; lustrate -i=sample_data -op=normalize -b=1000 --fallback=log -o=proc_data</code></pre>

<p>Others don't:</p>

<pre><code>&gt; lustrate -i sample_data -op normalize -b1000 --fallback log -o proc_data</code></pre>

<p>Still others want a bit each way:</p>

<pre><code>&gt; lustrate -i sample_data -o proc_data -op=normalize -b=1000 --fallback=log</code></pre>

<p>Let the user choose.</p></li>

<li><p>Allow single-letter options to be "bundled" after a single dash.</p>

<p>It's irritating to have to type repeated dashes for a series of flags:</p>

<pre><code>&gt; lustrate -i sample_data -v -l -x</code></pre>

<p>Allow experienced users to also write:</p>

<pre><code>&gt; lustrate -i sample_data -vlx</code></pre></li>

<li><p>Provide a multi-letter version of every single-letter flag.</p>

<p>Short-form flags may be nice for experienced users, but they can be
troublesome for new users: hard to remember and even harder to recognize. Don't
force people to do either. Give them a verbose alternative to every concise
flag; full words that are easier to remember, and also more self-documenting in
shell scripts.</p></li>

<li><p>Always allow <code>-</code> as a special filename.</p>

<p>A widely used convention is that a dash (<code>-</code>) where an input file
is expected means "read from standard input," and a dash where an output file
is expected means "write to standard output."</p></li>

<li><p>Always allow <code>--</code> as a file list marker.</p>

<p>Another widely used convention is that the appearance of a double dash
(<code>--</code>) on the command line marks the end of any flagged options, and
indicates that the remaining arguments are a list of filenames, even if some of
them look like flags.</p></li>

</ul>

<h3>6. Agree Upon a Coherent Layout Style and Automate It with <code>perltidy</code></h3>

<p>Formatting. Indentation. Style. Code layout. Whatever you choose to call it,
it's one of the most contentious aspects of programming discipline. More and
bloodier wars have been fought over code layout than over just about any other
aspect of coding.</p>

<p>What is the best practice here? Should you use classic Kernighan and
Ritchie style? Or go with BSD code formatting? Or adopt the layout scheme
specified by the GNU project? Or conform to the Slashcode coding
guidelines?</p>

<p>Of course not! Everyone knows that <em>&lt;insert your personal coding style here&gt;</em>
is the One True Layout Style, the only sane choice, as ordained by <em>&lt;insert your
favorite Programming Deity here&gt;</em> since Time Immemorial! Any other choice is
manifestly absurd, willfully heretical, and self-evidently a Work of
Darkness!</p>

<p>That's precisely the problem. When deciding on a layout style, it's hard to
decide where rational choices end and rationalized habits begin.</p>

<p>Adopting a coherently designed approach to code layout, and then applying
that approach consistently across all your coding, is fundamental to best-practice programming. Good layout can improve the readability of a program,
help detect errors within it, and make the structure of your code much easier
to comprehend. Layout matters.</p>

<p>However, most coding styles--including the four mentioned earlier--confer
those benefits almost equally well. While it's true that having a consistent
code layout scheme matters very much indeed, the particular code layout scheme
you ultimately decide upon does not matter at all!  All that matters is that
you adopt a single, coherent style; one that works for your entire programming
team, and, having agreed upon that style, that you then apply it consistently
across all your development.</p>













<p>In the long term, it's best to train yourself and your team to code in a
consistent, rational, and readable style. However, the time and commitment
necessary to accomplish that isn't always available. In such cases, a
reasonable compromise is to prescribe a standard code-formatting tool that must
be applied to all code before it's committed, reviewed, or otherwise displayed
in public.</p>

<p>There is now an excellent code formatter available for Perl: <a
href="http://perltidy.sourceforge.net/"><code>perltidy</code></a>. It provides an extensive
range of user-configurable options for indenting, block delimiter positioning,
column-like alignment, and comment positioning.</p>

<p>Using <code>perltidy</code>, you can convert code like this:</p>

<pre><code>if($sigil eq '$'){
   if($subsigil eq '?'){ 
       $sym_table{substr($var_name,2)}=delete $sym_table{locate_orig_var($var)};
       $internal_count++;$has_internal{$var_name}++
   } else {
       ${$var_ref} =
           q{$sym_table{$var_name}}; $external_count++; $has_external{$var_name}++;
}} elsif ($sigil eq '@'&amp;&amp;$subsigil eq '?') {
   @{$sym_table{$var_name}} = grep
       {defined $_} @{$sym_table{$var_name}};
} elsif ($sigil eq '%' &amp;&amp; $subsigil eq '?') {
delete $sym_table{$var_name}{$EMPTY_STR}; } else
{
${$var_ref}
=
q{$sym_table{$var_name}}
}</code></pre>

<p>into something readable:</p>

<pre><code>if ( $sigil eq '$' ) {
   if ( $subsigil eq '?' ) {
       $sym_table{ substr( $var_name, 2 ) }
           = delete $sym_table{ locate_orig_var($var) };
       $internal_count++;
       $has_internal{$var_name}++;
   }
   else {
       ${$var_ref} = q{$sym_table{$var_name}};
       $external_count++;
       $has_external{$var_name}++;
   }
}
elsif ( $sigil eq '@' &amp;&amp; $subsigil eq '?' ) {
   @{ $sym_table{$var_name} }
       = grep {defined $_} @{ $sym_table{$var_name} };
}
elsif ( $sigil eq '%' &amp;&amp; $subsigil eq '?' ) {
   delete $sym_table{$var_name}{$EMPTY_STR};
}
else {
   ${$var_ref} = q{$sym_table{$var_name}};
}</code></pre>

<p>Mandating that everyone use a common tool to format their code can also be a
simple way of sidestepping the endless objections, acrimony, and dogma that
always surround any discussion on code layout. If <code>perltidy</code> does all the work
for them, then it will cost developers almost no effort to adopt the new
guidelines. They can simply set up an editor macro that will "straighten" their
code whenever they need to.</p>

<h3>7. Code in Commented Paragraphs</h3>

<p>A paragraph is a collection of statements that accomplish a single task: in
literature, it's a series of sentences conveying a single idea; in programming,
a series of instructions implementing a single step of an algorithm.</p>

<p>Break each piece of code into sequences that achieve a single task, placing
a single empty line between each sequence. To further improve the
maintainability of the code, place a one-line comment at the start of each such
paragraph, describing what the sequence of statements does. Like so:</p>

<pre><code># Process an array that has been recognized...
sub addarray_internal {
   my ($var_name, $needs_quotemeta) = @_;

   # Cache the original...
   $raw .= $var_name;

   # Build meta-quoting code, if requested...
   my $quotemeta = $needs_quotemeta ?  q{map {quotemeta $_} } : $EMPTY_STR;

   # Expand elements of variable, conjoin with ORs...
   my $perl5pat = qq{(??{join q{|}, $quotemeta \@{$var_name}})};

   # Insert debugging code if requested...
   my $type = $quotemeta ? 'literal' : 'pattern';
   debug_now("Adding $var_name (as $type)");
   add_debug_mesg("Trying $var_name (as $type)");

   return $perl5pat;
}</code></pre>

<p>Paragraphs are useful because humans can focus on only a few pieces of
information at once. Paragraphs are one way of aggregating small amounts of
related information, so that the resulting "chunk" can fit into a single slot
of the reader's limited short-term memory. Paragraphs enable the physical
structure of a piece of writing to reflect and emphasize its logical
structure.</p>

<p>Adding comments at the start of each paragraph further enhances the chunking
by explicitly summarizing the purpose of each chunk (note: the purpose, not the
behavior). Paragraph comments need to explain why the code is there and what it
achieves, not merely paraphrase the precise computational steps it's
performing.</p>













<p>Note, however, that the contents of paragraphs are only of secondary
importance here. It is the vertical gaps separating each paragraph that are
critical. Without them, the readability of the code declines dramatically, even
if the comments are retained:</p>

<pre><code>sub addarray_internal {
   my ($var_name, $needs_quotemeta) = @_;
   # Cache the original...
   $raw .= $var_name;
   # Build meta-quoting code, if required...
   my $quotemeta = $needs_quotemeta ?  q{map {quotemeta $_} } : $EMPTY_STR;
   # Expand elements of variable, conjoin with ORs...
   my $perl5pat = qq{(??{join q{|}, $quotemeta \@{$var_name}})};
   # Insert debugging code if requested...
   my $type = $quotemeta ? 'literal' : 'pattern';
   debug_now("Adding $var_name (as $type)");
   add_debug_mesg("Trying $var_name (as $type)");
   return $perl5pat;
}</code></pre>

<h3>8. Throw Exceptions Instead of Returning Special Values or Setting
Flags</h3>

<p>Returning a special error value on failure, or setting a special error flag,
is a very common error-handling technique.  Collectively, they're the basis for
virtually all error notification from Perl's own built-in functions. For
example, the built-ins <code>eval</code>, <code>exec</code>, <code>flock</code>,
<code>open</code>, <code>print</code>, <code>stat</code>, and
<code>system</code> all return special values on error. Unfortunately, they
don't all use the same special value. Some of them also set a flag on failure.
Sadly, it's not always the same flag. See the <a
href="http://perldoc.perl.org/perlfunc.html"><code>perlfunc</code></a> manpage for the gory
details.</p>

<p>Apart from the obvious consistency problems, error notification via flags
and return values has another serious flaw: developers can silently ignore
flags and return values, and ignoring them requires absolutely no effort on the
part of the programmer. In fact, in a void context, ignoring return values is
Perl's default behavior. Ignoring an error flag that has suddenly appeared in
a special variable is just as easy: you simply don't bother to check the
variable.</p>

<p>Moreover, because ignoring a return value is the void-context default,
there's no syntactic marker for it. There's no way to look at a program and
immediately see where a return value is deliberately being ignored, which means
there's also no way to be sure that it's not being ignored accidentally.</p>

<p>The bottom line: regardless of the programmer's (lack of) intention, an
error indicator is being ignored. That's not good programming.</p>

<p>Ignoring error indicators frequently causes programs to propagate errors in
entirely the wrong direction. For example:</p>

<pre><code># Find and open a file by name, returning the filehandle
# or undef on failure...
sub locate_and_open {
   my ($filename) = @_;

   # Check acceptable directories in order...
   for my $dir (@DATA_DIRS) {
       my $path = "$dir/$filename";

       # If file exists in an acceptable directory, open and return it...
       if (-r $path) {
           open my $fh, '&lt;', $path;
           return $fh;
       }
   }

   # Fail if all possible locations tried without success...
   return;
}

# Load file contents up to the first &lt;DATA/&gt; marker...
sub load_header_from {
   my ($fh) = @_;

   # Use DATA tag as end-of-"line"...
   local $/ = '&lt;DATA/&gt;';

   # Read to end-of-"line"...
   return &lt;$fh&gt;;
}

# and later...
for my $filename (@source_files) {
   my $fh = locate_and_open($filename);
   my $head = load_header_from($fh);
   print $head;
}</code></pre>

<p>The <code>locate_and_open()</code> subroutine simply assumes that the call
to <code>open</code> works, immediately returning the filehandle
(<code>$fh</code>), whatever the actual outcome of the <code>open</code>. Presumably, the
expectation is that whoever calls <code>locate_and_open()</code> will check
whether the return value is a valid filehandle.</p>

<p>Except, of course, "whoever" doesn't check. Instead of testing for failure,
the main <code>for</code> loop takes the failure value and immediately
propagates it "across" the block, to the rest of the statements in the loop.
That causes the call to <code>loader_header_from()</code> to propagate the
error value "downwards." It's in that subroutine that the attempt to treat the
failure value as a filehandle eventually kills the program:</p>

<pre><code>readline() on unopened filehandle at demo.pl line 28.</code></pre>

<p>Code like that--where an error is reported in an entirely different part of
the program from where it actually occurred--is particularly onerous to
debug.</p>

<p>Of course, you could argue that the fault lies squarely with whoever wrote
the loop, for using <code>locate_and_open()</code> without checking its return
value.  In the narrowest sense, that's entirely correct--but the deeper fault
lies with whoever actually wrote <code>locate_and_open()</code> in the first
place, or at least, whoever assumed that the caller would always check its
return value.</p>













<p>Humans simply aren't like that. Rocks almost never fall out of the sky, so
humans soon conclude that they never do, and stop looking up for them.  Fires
rarely break out in their homes, so humans soon forget that they might, and
stop testing their smoke detectors every month. In the same way, programmers
inevitably abbreviate "almost never fails" to "never fails," and then simply
stop checking.</p>

<p>That's why so very few people bother to verify their <code>print</code>
statements:</p>

<pre><code>if (!print 'Enter your name: ') {
   print {*STDLOG} warning =&gt; 'Terminal went missing!'
}</code></pre>

<p>It's human nature to "trust but not verify."</p>

<p>Human nature is why returning an error indicator is not best practice.
Errors are (supposed to be) unusual occurrences, so error markers will almost
never be returned. Those tedious and ungainly checks for them will almost never
do anything useful, so eventually they'll be quietly omitted. After all,
leaving the tests off almost always works just fine. It's so much easier not to
bother. Especially when not bothering is the default!</p>

<p>Don't return special error values when something goes wrong; throw an
exception instead. The great advantage of exceptions is that they reverse the
usual default behaviors, bringing untrapped errors to immediate and urgent
attention. On the other hand, ignoring an exception requires a deliberate and
conspicuous effort: you have to provide an explicit <code>eval</code> block to
neutralize it.</p>

<p>The <code>locate_and_open()</code> subroutine would be much cleaner and more
robust if the errors within it threw exceptions:</p>

<pre><code># Find and open a file by name, returning the filehandle
# or throwing an exception on failure...
sub locate_and_open {
   my ($filename) = @_;

   # Check acceptable directories in order...
   for my $dir (@DATA_DIRS) {
       my $path = "$dir/$filename";

       # If file exists in acceptable directory, open and return it...
       if (-r $path) {
           open my $fh, '&lt;', $path
               or croak( "Located $filename at $path, but could not open");
           return $fh;
       }
   }

   # Fail if all possible locations tried without success...
   croak( "Could not locate $filename" );
}

# and later...
for my $filename (@source_files) {
   my $fh = locate_and_open($filename);
   my $head = load_header_from($fh);
   print $head;
}</code></pre>

<p>Notice that the main <code>for</code> loop didn't change at all. The
developer using <code>locate_and_open()</code> still assumes that nothing can
go wrong. Now there's some justification for that expectation, because if
anything does go wrong, the thrown exception will automatically terminate the
loop.</p>

<p>Exceptions are a better choice even if you are the careful type who
religiously checks every return value for failure:</p>

<pre><code>SOURCE_FILE:
for my $filename (@source_files) {
   my $fh = locate_and_open($filename);
   next SOURCE_FILE if !defined $fh;
   my $head = load_header_from($fh);
   next SOURCE_FILE if !defined $head;
   print $head;
}</code></pre>

<p>Constantly checking return values for failure clutters your code with
validation statements, often greatly decreasing its readability. In contrast,
exceptions allow an algorithm to be implemented without having to intersperse
any error-handling infrastructure at all. You can factor the error-handling out
of the code and either relegate it to after the surrounding <code>eval</code>,
or else dispense with it entirely:</p>

<pre><code>for my $filename (@directory_path) {

   # Just ignore any source files that don't load...
   eval {
       my $fh = locate_and_open($filename);
       my $head = load_header_from($fh);
       print $head;
   }
}</code></pre>

<h3>9. Add New Test Cases Before you Start Debugging</h3>

<p>The first step in any debugging process is to isolate the incorrect
behavior of the system, by producing the shortest demonstration of it that you
reasonably can. If you're lucky, this may even have been done for you:</p>

<pre><code>To: DCONWAY@cpan.org
From: sascha@perlmonks.org
Subject: Bug in inflect module

Zdravstvuite,

I have been using your Lingua::EN::Inflect module to normalize terms in a
data-mining application I am developing, but there seems to be a bug in it,
as the following example demonstrates:

   use Lingua::EN::Inflect qw( PL_N );
   print PL_N('man'), "\n";       # Prints "men", as expected
   print PL_N('woman'), "\n";     # Incorrectly prints "womans"</code></pre>

<p>Once you have distilled a short working example of the bug, convert it to a
series of tests, such as:</p>

<pre><code>use Lingua::EN::Inflect qw( PL_N );
use Test::More qw( no_plan );
is(PL_N('man') ,  'men', 'man -&gt; men'     );
is(PL_N('woman'), 'women', 'woman -&gt; women' );</code></pre>













<p>Don't try to fix the problem straight away, though. Instead, immediately add
those tests to your test suite. If that testing has been well set up, that can
often be as simple as adding a couple of entries to a table:</p>

<pre><code>my %plural_of = (
   'mouse'         =&gt; 'mice',
   'house'         =&gt; 'houses',
   'ox'            =&gt; 'oxen',
   'box'           =&gt; 'boxes',
   'goose'         =&gt; 'geese',
   'mongoose'      =&gt; 'mongooses', 
   'law'           =&gt; 'laws',
   'mother-in-law' =&gt; 'mothers-in-law', 

   # Sascha's bug, reported 27 August 2004...
   'man'           =&gt; 'men',
   'woman'         =&gt; 'women',
);</code></pre>

<p>The point is: if the original test suite didn't report this bug, then that
test suite was broken. It simply didn't do its job (finding bugs) adequately.
Fix the test suite first by adding tests that cause it to fail:</p>

<pre><code>&gt; perl inflections.t
ok 1 - house -&gt; houses
ok 2 - law -&gt; laws
ok 3 - man -&gt; men
ok 4 - mongoose -&gt; mongooses
ok 5 - goose -&gt; geese
ok 6 - ox -&gt; oxen
not ok 7 - woman -&gt; women
#     Failed test (inflections.t at line 20)
#          got: 'womans'
#     expected: 'women'
ok 8 - mother-in-law -&gt; mothers-in-law
ok 9 - mouse -&gt; mice
ok 10 - box -&gt; boxes
1..10
# Looks like you failed 1 tests of 10.</code></pre>

<p>Once the test suite is detecting the problem correctly, then you'll be able
to tell when you've correctly fixed the actual bug, because the tests will once
again fall silent.</p>

<p>This approach to debugging is most effective when the test suite covers the
full range of manifestations of the problem. When adding test cases for a bug,
don't just add a single test for the simplest case. Make sure you include the
obvious variations as well:</p>

<pre><code>my %plural_of = (
   'mouse'         =&gt; 'mice',
   'house'         =&gt; 'houses',
   'ox'            =&gt; 'oxen',
   'box'           =&gt; 'boxes',
   'goose'         =&gt; 'geese',
   'mongoose'      =&gt; 'mongooses', 
   'law'           =&gt; 'laws',
   'mother-in-law' =&gt; 'mothers-in-law', 

   # Sascha's bug, reported 27 August 2004...
   'man'           =&gt; 'men',
   'woman'         =&gt; 'women',
   'human'         =&gt; 'humans',
   'man-at-arms'   =&gt; 'men-at-arms', 
   'lan'           =&gt; 'lans',
   'mane'          =&gt; 'manes',
   'moan'          =&gt; 'moans',
);</code></pre>

<p>The more thoroughly you test the bug, the more completely you will fix
it.</p>

<h3>10. Don't Optimize Code--Benchmark It</h3>

<p>If you need a function to remove duplicate elements of an array, it's
natural to think that a "one-liner" like this:</p>

<pre><code>sub uniq { return keys %{ { map {$_=&gt;1} @_ } } }</code></pre>

<p>will be more efficient than two statements:</p>

<pre><code>sub uniq {
   my %seen;
   return grep {!$seen{$_}++} @_;
}</code></pre>

<p>Unless you are deeply familiar with the internals of the Perl interpreter
(in which case you already have far more serious personal issues to deal with),
intuitions about the relative performance of two constructs are exactly that:
unconscious guesses.</p>

<p>The only way to know for sure which of two--or more--alternatives will perform
better is to actually time each of them. The standard <a
href="http://search.cpan.org/perldoc?Benchmark">Benchmark</a> module makes that
easy:</p>

<pre><code># A short list of not-quite-unique values...
our @data = qw( do re me fa so la ti do );

# Various candidates...
sub unique_via_anon {
   return keys %{ { map {$_=&gt;1} @_ } };
}

sub unique_via_grep {
   my %seen;
   return grep { !$seen{$_}++ } @_;
}

sub unique_via_slice {
   my %uniq;
   @uniq{@_} = ();
   return keys %uniq;
}

# Compare the current set of data in @data
sub compare {
   my ($title) = @_;
   print "\n[$title]\n";

   # Create a comparison table of the various timings, making sure that
   # each test runs at least 10 CPU seconds...
   use Benchmark qw( cmpthese );
   cmpthese -10, {
       anon  =&gt; 'my @uniq = unique_via_anon(@data)',
       grep  =&gt; 'my @uniq = unique_via_grep(@data)',
       slice =&gt; 'my @uniq = unique_via_slice(@data)',
   };

   return;
}

compare('8 items, 10% repetition');

# Two copies of the original data...
@data = (@data) x 2;
compare('16 items, 56% repetition');

# One hundred copies of the original data...
@data = (@data) x 50;
compare('800 items, 99% repetition');</code></pre>

<p>The <code>cmpthese()</code> subroutine takes a number, followed by a
reference to a hash of tests. The number specifies either the exact number of
times to run each test (if the number is positive), or the absolute number of
CPU seconds to run the test for (if the number is negative). Typical values are
around 10,000 repetitions or ten CPU seconds, but the module will warn you if
the test is too short to produce an accurate benchmark.</p>

<p>The keys of the test hash are the names of your tests, and the corresponding
values specify the code to be tested. Those values can be either strings (which
are <code>eval</code>'d to produce executable code) or subroutine references
(which are called directly).</p>

<p>The benchmarking code shown above would print out something like the
following:</p>

<pre><code>[8 items, 10% repetitions]
        Rate anon  grep slice
anon  28234/s --  -24%  -47%
grep  37294/s   32% --  -30%
slice 53013/s   88% 42%    --

[16 items, 50% repetitions]
        Rate anon  grep slice
anon  21283/s --  -28%  -51%
grep  29500/s   39% --  -32%
slice 43535/s  105% 48%    --

[800 items, 99% repetitions]
       Rate  anon grep slice
anon   536/s --  -65%  -89%
grep  1516/s  183% --  -69%
slice 4855/s  806%  220% --</code></pre>

<p>Each of the tables printed has a separate row for each named test. The
first column lists the absolute speed of each candidate in repetitions per
second, while the remaining columns allow you to compare the relative
performance of any two tests. For example, in the final test tracing across
the <code>grep</code> row to the <code>anon</code> column reveals that the
<code>grep</code>ped solution was 1.83 times (183 percent) faster than using an anonymous hash.
Tracing further across the same row also indicates that <code>grep</code>ping was 69 percent
slower (-69 percent faster) than slicing.</p>

<p>Overall, the indication from the three tests is that the slicing-based
solution is consistently the fastest for this particular set of data on this
particular machine. It also appears that as the data set increases in size,
slicing also scales much better than either of the other two approaches.</p>

<p>However, those two conclusions are effectively drawn from only three data
points (namely, the three benchmarking runs). To get a more definitive
comparison of the three methods, you'd also need to test other possibilities,
such as a long list of non-repeating items, or a short list with nothing but
repetitions.</p>

<p>Better still, test on the real data that you'll actually be
"unique-ing."</p>

<p>For example, if that data is a sorted list of a quarter of a million words, with
only minimal repetitions, and which has to remain sorted, then test exactly
that:</p>

<pre><code>our @data = slurp '/usr/share/biglongwordlist.txt';

use Benchmark qw( cmpthese );

cmpthese 10, {
    # Note: the non-grepped solutions need a post-uniqification re-sort
    anon  =&gt; 'my @uniq = sort(unique_via_anon(@data))',
    grep  =&gt; 'my @uniq = unique_via_grep(@data)',
    slice =&gt; 'my @uniq = sort(unique_via_slice(@data))',
};</code></pre>

<p>Not surprisingly, this benchmark indicates that the <code>grep</code>ped solution is
markedly superior on a large sorted data set:</p>

<pre><code>s/iter anon slice  grep
anon    4.28 --   -3%  -46%
slice   4.15 3%    --  -44%
grep    2.30 86%   80%    --</code></pre>

<p>Perhaps more interestingly, the <code>grep</code>ped solution still benchmarks as being
marginally faster when the two hash-based approaches aren't re-sorted. This
suggests that the better scalability of the sliced solution as seen in the
earlier benchmark is a localized phenomenon, and is eventually undermined by
the growing costs of allocation, hashing, and bucket-overflows as the sliced
hash grows very large.</p>

<p>Above all, that last example demonstrates that benchmarks only benchmark the
cases you actually benchmark, and that you can only draw useful conclusions
about performance from benchmarking real data.</p>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-804" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/07/p6pdigest/20050707.html" rel="bookmark">This Week in Perl 6, June 29-July 5, 2005</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2005-07-07T00:00:00-08:00">July  7, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>My, doesn't time fly? Another fortnight gone and another summary to write.  It's a hard life, I tell you!</p>

<h3>This Week in <i>perl6-compiler</i></h3>

<h4>Where's Everyone Gone?</h4>

<p>It seems that most of the Perl 6 compiler development discussions occur at
Hackathons and on IRC, with summaries appearing in developers' weblogs. What's
a summarizer to do? For now, I'll point you at <a
href="http://planetsix.perl-foundation.org/">Planet Perl 6</a>, which
aggregates a bunch of relevant blogs.</p>

<h4><a
href="http://groups.google.com/groups?threadm=b7a12d0375515a6b4381efe3d71ef61e@perl.org">PGE
Now Supports Grammars, Built-In Rules</a></h4>

<p>Allison Randal raved about the &quot;totally awesome&quot; PGE grammar support. I
doubt she's alone in her enthusiasm.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050702165140.GH5089@pmichaud.com">Multiple
Implementations Are Good, M'kay? </a></h4>

<p>Patrick discussed the idea of a &quot;final&quot; Perl 6 compiler, pointing out that
it isn't clear that there needs to be a &quot;final&quot; compiler. As long as multiple
implementations are compatible.</p>

<h3>Meanwhile, in <i>perl6-internals</i></h3>

<h4><a
href="http://groups.google.com/groups?threadm=42C16B5A.7040101@home.nl">New
Calling Conventions</a></h4>

<p>Klaas-Jan Stol asked a bunch of questions about the new calling conventions
and Leo answered them.</p>

<h4><a
href="http://groups.google.com/groups?threadm=200506291354.19610.parrot@jensbeimsurfen.de">Parrot
Segfaults</a></h4>

<p>What's a tester to do? You find a bug that makes Parrot dump core, so you
write a test to document the bug and make sure it gets fixed. But the test
leaves core files lying about. It goes without saying that Parrot should never
dump core without the active assistance of an NCI call or some other unsafe
call blowing up in its face.</p>

<p>This makes it a little embarrassing that PIR code generated by Pugs can
cause a Parrot segfault, though the cause appears be mixed up calling
convention style in the generated call.</p>

<p><a href="http://groups.google.com/groups?threadm=1120142239.14968.20.camel@wombat
.dlib.indiana.edu">Brian Wheeler's segfaulting Pugs script</a></p>

<h4><a
href="http://groups.google.com/groups?threadm=42C395FE.7010701@toetsch.at">Python
PMCs</a></h4>

<p>Leo pointed out that the various <em>dynclasses/py*.pmc</em> Parrot support
PMCs don't yet support all the semantics that Python needs. He outlined some
outstanding issues and announced that, as calling conventions and context handling
were changing, he'd be turning off compiling <em>py*.pmc</em> for the time
being.</p>

<h4><a
href="http://groups.google.com/groups?threadm=42C40534.1000102@toetsch.at">PGE
Bug</a></h4>

<p>It appears that the upcoming changes in Parrot's context handling tweak a
bug in PGE. The discussion moved onto a discussion of PGE's implementation
strategy; Nicholas Clark was keen to make sure it didn't repeat some of the
Perl 5's regex engine's infelicities. While this discussion continued, Leo
spent half a day with <code>gdb</code> and tracked down the problem, which turned out to be
that a register wasn't getting initialized in the right place.</p>

<h4><a
href="http://groups.google.com/groups?threadm=rt-3.0.11-36437-116436.17.8864180085717@perl.org">Left-Recursive
Grammars Are Bad, M'kay? </a></h4>

<p>While experimenting with PGE grammars, Will Coleda managed to write a
left-recursive grammar that blew Parrot's call stack with impressive ease.
Luke apologized for things blowing up so spectacularly, but pointed out that
PGE didn't support left-recursive grammars and showed a rewritten grammar that
didn't have the same problem (but which doesn't appear to match the same
expressions).</p>

<h4><a
href="http://groups.google.com/groups?threadm=ebb4ed649916ee6a195be937c1921d48@toetsch.at">Coroutines</a></h4>

<p>Leo pointed to <a
href="ftp://ftp.inf.puc-rio.br/pub/docs/techreports/04_15_moura.pdf">a summary
of coroutines</a> (PDF), and noted that we still hadn't defined the syntax of Parrot
coroutines, especially with respect to argument passing. He discussed it with
Matt Fowles and solicited a set of tests that expressed the semantics they came
up with.</p>

<h4><a
href="http://groups.google.com/groups?threadm=D1E396F5-6AE6-43D3-B0A0-08CC710DBA6C@coleda.com">ParTcl,
Perl 6 Grammars</a></h4>

<p>Will Coleda announced that, thanks to Matt Diephouse's work, ParTcl (Tcl on
Parrot) is now able to run part of Tcl's cvs-latest test suite. The tests
aren't fully native yet, being currently driven through a Perl test harness and
only passing ten percent of the tests, but hopefully the situation will improve and
ParTcl will end up able to run the tests completely natively (while passing far
more of them). Congratulations on the work so far, though.</p>

<h4><a
href="http://groups.google.com/groups?threadm=42C51CCB.7010008@tewk.com">Python
and Parrot</a></h4>

<p>Kevin Tew popped up to say that he too is working on a Python compiler
targeting Parrot and wondered how to handle things like Python's
<code>self</code> parameter. Michal Wallace and Leo chipped in with
suggestions.</p>

<h4><a
href="http://groups.google.com/groups?threadm=42C7C447.8000302@toetsch.at">Another
Month, Another Release</a></h4>

<p>Has it really been a month? Seems so. Parrot walked through the traditional
feature freeze and code freeze before being released on Sunday.  The latest
release is <a href="http://geeksunite.org/">Geeksunite</a>, referencing the
website that discusses Chip's problems with his former employer. You should
definitely visit the Geeksunite site--Chip needs our help.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050702012449.GA25256@pmichaud.com"><code>lower</code>
in Default <code>find_name</code> Scope</a></h4>

<p>Patrick posted a code fragment whose output surprised him--it turned out
that looking up <code>lower</code> as a name in the default scope returns an NCI object.
Leo explained why this was so, prompting Patrick to suggest that it would be
useful if, somewhere in the Parrot documentation, there were some descriptions
of Parrot's built-in namespace. Leo encourage others to comment on namespace
issues, and hoped for some decisions as well.</p>

<h4><a
href="http://groups.google.com/groups?threadm=FECF197F-DEF8-4E4F-8FE9-EE0B2036516E@coleda.com">Copyrights</a></h4>

<p>If you're like me, discussion of copyrights and licenses is the sort of
thing that either really winds you up or induces serious drowsiness, depending
on your mood as you read the thread. It's one of those &quot;too important not to
think about, but too tedious to think about any more than is absolutely
necessary&quot; topics. That said, Will Coleda said that he had thought that all of
Parrot's code should to have its copyright assigned to the Perl Foundation.
However, on inspection, he noticed a multiplicity of copyright notices in the
actual code, including one file in the repository with a Microsoft
copyright.</p>

<h4><a
href="http://groups.google.com/groups?threadm=198c873805070414191b878a4d@mail.gmail.com">PGE:
Code Blocks</a></h4>

<p>Matt Diephouse wondered about the plan for integrating code blocks into PGE.
He thought it'd be nice to be able to specify a compiler to use along with the
code block (or, for the time being, just to be able to use PIR code). Patrick
said that there is a plan (or several) for handling this, but getting blocks to
work well needs coordination between PGE and the compiler language. In essence,
when PGE encounters a code block, it needs to hand off to the target language's
compiler to parse to the end of the code block, and get back from the compiler
the length of the block thus parsed.</p>

<h4><a
href="http://groups.google.com/groups?threadm=45ec99fc05070423504732f4fd@mail.gmail.com">Possible
Bug Calculating Denominators</a></h4>

<p>Curtis Rawls posted a fragment of code that seems to break Inc's
<code>computed_denominators</code> algorithm. Leo wasn't surprised that there
were probably bugs in that part of IMCC, which was contributed by Angel Faus,
who no longer seems to be participating in Parrot development.  Which means
it's not been maintained for a while for lack of tuits. Anyone with an
appropriate supply of tuits is welcome (nay, encouraged) to take it on.</p>

<h3>Meanwhile, in <i>perl6-language</i></h3>

<h4><a href="http://www.nntp.perl.org/group/perl.perl6.language/22041">Type
Variables Vs. Type Literals</a></h4>

<p>Autrijus had a question about the difference between</p>

<pre><code>sub (::T $x, ::T $y) {...}</code></pre>

<p>and</p>

<pre><code>sub (T $x, T $y) {...}</code></pre>

<p>Larry answered about four times, mulling over various options. It's times
like that remind me why it's worth following the list in detail rather than
reading the summaries--it's good to see Larry thinking aloud, considering all
sorts of (seemingly) wacky options and getting feedback.</p>

<h4><a href="http://www.nntp.perl.org/group/perl.perl6.language/22042">Mr. Clean
Vs. Perl 6</a></h4>

<p>Yuval Kogman had some comments about fascism, strong (but I think he meant
static) typing, cleaning products, Perl 6, and type inferencing.  Stephane
Payrard hoped that &quot;Perl6 could become the playground of type theory
searchers.&quot; (To which I can only respond with a highly personal &quot;Ick!&quot;)</p>

<h4><a
href="http://www.nntp.perl.org/group/perl.perl6.language/22044">Documentation
Trait/Docstring Equivalent</a></h4>

<p>The Platypus (AKA David Formosa) wondered if documentation traits on subs
would be useful. The first to hope that it would be was Chromatic, commenting
that it's a shame for Perl 6 to throw away potentially useful data recklessly.
Larry commented that he always cringes when he hears &quot;the documentation&quot; as if
it's the only thing. Again, Larry's thinking aloud on this subject is well
worth your time.</p>

<h4><a href="http://www.nntp.perl.org/group/perl.perl6.language/22045">SMD Is
for Weenies</a></h4>

<p>So says Yuval Kogman, and who are we to doubt him? Yuval wanted to make
multimethods the default type. Sam Vilain disagreed, pointing up the usefulness
of warnings like &quot;method foo redefined at ....&quot;</p>

<h4><a href="http://www.nntp.perl.org/group/perl.perl6.language/22054">DBI v2: The Plan and How You Can Help</a></h4>

<p>Tim Bunce outlined his current thinking on how DBI v2 will work (DBI v2's
going to be Perl-6-only) and a local roadmap for the first things that need
doing. He then opened the floor for detailed proposals for what a Perl 6 DBI
API should look like. (I wonder if DBI v2's going to be an important enough
tool that it'll want an RFC type process.)</p>

<p>I'm glossing over <a
href="http://www.nntp.perl.org/group/perl.perl6.language/22058">the ensuing
discussion</a>--it's at the stage where, if you're interested, you're better
off joining in directly.</p>

<h4><a href="http://www.nntp.perl.org/group/perl.perl6.language/22060">Should
<code>.assuming</code> Always Be Non-Mutating? </a></h4>

<p>Ingo Blechschmidt had some suggestions about the behavior of the currying
method <code>.assuming</code>, arguing that it should always return a new thing
and not alter the state of the underlying object. Larry agreed.</p>

<h4><a
href="http://www.nntp.perl.org/group/perl.perl6.language/22061"><code>return()</code>
in Pointy Blocks</a></h4>

<p>Coo. The pointy block thread returns. The question is, where to?</p>

<h4><a
href="http://www.nntp.perl.org/group/perl.perl6.language/22076">Time::Local</a></h4>

<p>Gaal Yahas announced that he'd added <code>localtime</code> to Pugs in order
to address Dave Rolsky's needs when porting the very lovely and worthwhile
DateTime family of modules. He noted that Perl 6's final time-related
interfaces were rather underspecified and had a bunch of questions. The one
thing that's absolutely certain is that the default Perl time API will use
subsecond resolution by default.</p>

<p>I've noticed that, every time you start to discuss how computers handle
&quot;human&quot; things such as time, dates, or writing systems, people often seem to
have very strong and deeply held ideas of the Right Way of doing things, and
those Right Ways are almost all different. Larry's job is probably going to be
to work out the Least Wrong Way. (If you've not heard <a
href="http://perlcast.com/audio/Perlcast_015.mp3">Dave Rolsky's talks about the
underlying reasons for writing DateTime</a> (MP3) and the headaches it gave him, then
I suggest you seek it out.)</p>

<h4><a
href="http://www.nntp.perl.org/group/perl.perl6.language/22097">Autogenerated
Attribute Accessor Names</a></h4>

<p>MetaModel maker Stevan Little wondered what to do when attribute names
clashed, as in:</p>

<pre><code>class Foo { has @.bar; has $.bar; }</code></pre>

<p>No answers yet.</p>

<h3>Acknowledgements, Adverts, Apologies, and Alliteration</h3>

<p>Summarizing a week is definitely way easier than summarizing a
fortnight.</p>

<p>I'm apologizing in advance for the fact that, for those of you who read this
via the mailing list, some of the links probably don't work yet. The thing is,
the thread links are generated directly from the <code>message-id</code>s because that's
the information I have access to and, so far as I know, Google Groups is the
only archive that has a RESTful search interface that lets me use <code>message-id</code>s
as my key. If you know of an archive site that does this, but is more timely in
its archiving of <i>perl6-language</i> in particular, then please let me know and I'll
start using that instead. Ideally, it should allow me to directly address a
message complete with its thread context.</p>

<p>If you haven't already done so, you really should pay a visit to <a
href="http://geeksunite.org/">Geeksunite</a>. For the life of me, I can't see
what I would have done differently in Chip's situation, and I'm staggered by
what's happened to him.</p>

<p>Right, back to our standard coda:</p>

<p>If you find these summaries useful or enjoyable, please consider
contributing to the Perl Foundation to help support the development of
Perl.</p>

<ul>

<li><a href="http://donate.perl-foundation.org/">The Perl Foundation</a></li>
<li><a href="http://dev.perl.org/perl6/">Perl 6 development site</a></li>

</ul>

<!--p>Or, you can check out <a href="http://www.bofh.org.uk/">my website</a>.
Maybe now I'm back writing stuff I'll start updating it.  There are also <a
href="http://www.flickr.com/photos/pdcawley">vaguely pretty photos by
me</a>.</p-->

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1714" template="b/article_sidebar2.view">
<!-- sidebar ends -->




        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-796" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/07/07/navwidgets.html" rel="bookmark">Building Navigation Menus</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Shlomi Fish</span> on <abbr class="published" title="2005-07-07T00:00:00-08:00">July  7, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>Navigation menus are a group of links given at one side of the page that
allows users to navigate to different places of a website.  Navigation menus
allow site visitors to explore other pages of the site and to find what
they want more easily.  For example, <a href="http://www.paulgraham.com/">Paul
Graham's home page</a> contains a simple navigation menu made out of images.  It
doesn't change as the site visitor move to different pages of the site.  The <a
href="http://www.kde.org/">KDE desktop environment</a> home page contains a more
sophisticated menu.  Click on <a href="http://www.kde.org/screenshots/">the
link to the screenshots</a> to see a submenu for links to screenshots from
multiple versions of KDE.  Other menu items have similar expansions.</p>

<h3>Common Patterns in Navigation Menus and Site Flow</h3>

<p>There are several patterns in maintaining navigation menus and general site
flow.</p>

<h4>A Tree of Items</h4>

<p>Usually, the items in the navigation menus are a tree structure (as is the
case for the KDE site) or a flat list. Sometimes, branches of the tree can
<em>expand</em> or collapse depending on the current page. This prevents
having to display the entire tree at once.</p>

<h4>Next/Previous/Up Links to Traverse a Site</h4>

<p>Many sites provide links to traverse the pages of the site in order: a
<em>Next</em> link to go to the next page, a <em>Previous</em> link to go to
the previous page, an <em>Up</em> link to go to the section containing the
current page, a <em>Contents</em> link to go to the main page, and so on.</p>

<p>HTML can represent these links by using <code>&lt;head&gt;</code> tag and
<code>&lt;link rel=&quot;next&quot; href=&quot;&quot; /&gt;</code>. directives. Mozilla, 
Firefox, and Opera all support these tags. They can be also visible in the HTML
as normal links, as is the case with <a
href="http://www.gnu.org/software/make/manual/html_node/make_toc.html">GNU
Documentation</a>.</p>

<h4>Site Maps and Breadcrumb Trails</h4>

<p>Other navigation aids provided by sites include a <i>site map</i> (like <a
href="http://www.catb.org/~esr/sitemap.html">the one on Eric S. Raymond's
home page</a>) and a <i>breadcrumb trail</i>. A breadcrumb trail is a path of the
components of the navigation menu that leads to the current page. The <a
href="http://search.cpan.org/dist/Module-Build/lib/Module/Build/Cookbook.pm">documentation
for Module::Build::Cookbook</a> on <a
href="http://search.cpan.org/">search.cpan.org</a> provides an example (&quot;Ken
Williams &gt; Module-Build &gt; Module::Build::Cookbook,&quot; in this case).</p>

<h4>Hidden Pages and Skipped Pages</h4>

<p>Hidden pages are part of the site flow (the next/previous scheme) but don't
appear in the navigation menu. Skipped pages are the opposite: they appear in
the navigation menu, but are not part of the site flow.</p>

<h3>Introducing HTML::Widgets::NavMenu</h3>

<p>How do you create menus?  <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/">HTML::Widgets::NavMenu</a>
is a <a href="http://www.cpan.org/">CPAN</a> module for maintaining navigation
menus and site flow in general. It supports all of the above-mentioned patterns and
some others, has a comprehensive test suite, and is under active maintenance. I
have successfully used this module to maintain the site flow logic for such
sites as <a href="http://www.shlomifish.org/">my personal home page</a> and <a
href="http://perl-begin.berlios.de/">the Perl Beginners' Site</a>.  Other
people use it for their own sites.</p>

<p>This makes it easy to generate and maintain such navigation menus in Perl.
It is generic enough so that it can generate static HTML or dynamic HTML on the
fly for use within server-side scripts (CGI, <i>mod_perl</i>, etc.).</p>

<p>To install it, use a CPAN front end by issuing a command such as <code>perl
-MCPANPLUS -e &quot;install HTML::Widgets::NavMenu&quot;</code> or <code>perl -MCPAN -e
&quot;install HTML::Widgets::NavMenu&quot;</code>.</p>

<h3>A Simple Example</h3>

<p>Here's a simple example: a navigation tree that contains a home page and two
other pages.</p>

<p>You can see <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/simple/H-W-NM-simple.pl">the
complete code for this example</a>:</p>

<pre><code>#!/usr/bin/perl

use strict;
use warnings;

use HTML::Widgets::NavMenu;
use File::Path;</code></pre>

<p>This is the standard way to begin a Perl script. It imports the module and
the <code>File::Path</code> module, both of which it uses later.</p>

<pre><code>my $css_style = &lt;&lt;&quot;EOF&quot;;
a:hover { background-color : palegreen; }
.body {
.
.
.
EOF</code></pre>

<p>This code defines a CSS stylesheet to make things nicer visually.</p>

<pre><code>my $nav_menu_tree =
{
    'host'  =&gt; &quot;default&quot;,
    'text'  =&gt; &quot;Top 1&quot;,
    'title' =&gt; &quot;T1 Title&quot;,
    'subs'  =&gt;
    [
        {
            'text' =&gt; &quot;Home&quot;,
            'url'  =&gt; &quot;&quot;,
        },
        {
            'text'  =&gt; &quot;About Me&quot;,
            'title' =&gt; &quot;About Myself&quot;,
            'url'   =&gt; &quot;me/&quot;,
        },
        {
            'text'  =&gt; &quot;Links&quot;,
            'title' =&gt; &quot;Hyperlinks to other Pages&quot;,
            'url'   =&gt; &quot;links/&quot;,
        },
    ],
};</code></pre>

<p>Now this is important. This is the tree that describes the navigation menu.
It is a standard nested Perl 5 data structure, with well-specified keys.  These
keys are:</p>

<ul>

<li><code>host</code>: A specification of the host on which the sub-tree
starting from that node resides.  HTML::Widgets::NavMenu menus can span several
hosts on several domains. In this case, the menu uses just one host, so
<code>default</code> here is fine.</li>

<li><code>text</code>: What to place inside of the <code>&lt;a&gt;...&lt;/a&gt;</code> tag (or
alternatively, the <code>&lt;b&gt;</code> tag, if it's the current page).</li>

<li><code>title</code>: Text to place as a <code>title</code> attribute to a
hyperlink (usually displayed as a tooltip). It can display more detailed
information, helping to keep the link text itself short.</li>

<li><code>url</code>: The path within the host where this item resides. Note
that all URLs are relative to the top of the host, not the URL of their
supernode. If the supernode has a path of <i>software/</i> and you wish
the subnode to have a path of <i>software/gimp/</i>, specify <code>url
=&gt; 'software/gimp/'</code>.</li>

<li><code>subs</code>: An array reference that contains the node's sub-items.
Normally, this will render them in a submenu.</li>

</ul>

<p>One final note: HTML::Widgets::NavMenu does not render the top item. The
rendering starts from its sub-items.</p>

<pre><code>my %hosts =
(
    'hosts' =&gt;
    {
        'default' =&gt;
        {
            'base_url' =&gt; (&quot;http://web-cpan.berlios.de/modules/&quot; .
                &quot;HTML-Widgets-NavMenu/article/examples/simple/dest/&quot;),
        },
    },
);</code></pre>

<p>This is the hosts map, which holds the hosts for the site.  Here there is
only one host, called <code>default</code>.</p>

<pre><code>my @pages =
(
    {
        'path'    =&gt; &quot;&quot;,
        'title'   =&gt; &quot;John Doe's Homepage&quot;,
        'content' =&gt; &lt;&lt;'EOF',
&lt;p&gt;
Hi! This is the homepage of John Doe. I hope you enjoy your stay here.
&lt;/p&gt;
EOF
    },
    .
    .
    .
);</code></pre>

<p>The purpose of this array is to enumerate the pages, giving each one the
<code>&lt;title&gt;</code> tag, the <code>&lt;h1&gt;</code> title, and the content that it contains. It's
not part of HTML::Widgets::NavMenu, but rather something that this script uses to
render meaningful pages.</p>

<pre><code>foreach my $page (@pages)
{
    my $path     = $page-&gt;{'path'};
    my $title    = $page-&gt;{'title'};
    my $content  = $page-&gt;{'content'};
    my $nav_menu =

        HTML::Widgets::NavMenu-&gt;new(
            path_info     =&gt; &quot;/$path&quot;,
            current_host  =&gt; &quot;default&quot;,
            hosts         =&gt; \%hosts,
            tree_contents =&gt; $nav_menu_tree,
        );

    my $nav_menu_results = $nav_menu-&gt;render();
    my $nav_menu_text    = join(&quot;\n&quot;, @{$nav_menu_results-&gt;{'html'}});
    
    my $file_path = $path;
    if (($file_path =~ m{/$}) || ($file_path eq &quot;&quot;))
    {
        $file_path .= &quot;index.html&quot;;
    }
    my $full_path = &quot;dest/$file_path&quot;;
    $full_path =~ m{^(.*)/[^/]+$};

	# mkpath() throws an exception if it isn't successful, which will cause
	# this program to terminate.  This is what we want.
    mkpath($1, 0, 0755);
    open my $out, &quot;&gt;&quot;, $full_path or
        die &quot;Could not open \&quot;$full_path\&quot; for writing: $!\n&quot;;
    
    print {$out} &lt;&lt;&quot;EOF&quot;;
&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;
&lt;!DOCTYPE html
     PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;
     &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;$title&lt;/title&gt;
&lt;style type=&quot;text/css&quot;&gt;
$css_style
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;navbar&quot;&gt;
$nav_menu_text
&lt;/div&gt;
&lt;div class=&quot;body&quot;&gt;
&lt;h1&gt;$title&lt;/h1&gt;
$content
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
EOF

    close($out);
}</code></pre>

<p>This loop iterates over all the pages and renders each one in turn. If the
directory up to the file does not exist, the program creates it by using the
<code>mkpath()</code> function. The most important lines are:</p>

<pre><code>    my $nav_menu =
        HTML::Widgets::NavMenu-&gt;new(
            path_info     =&gt; &quot;/$path&quot;,
            current_host  =&gt; &quot;default&quot;,
            hosts         =&gt; \%hosts,
            tree_contents =&gt; $nav_menu_tree,
        );

    my $nav_menu_results = $nav_menu-&gt;render();
    my $nav_menu_text    = join(&quot;\n&quot;, @{$nav_menu_results-&gt;{'html'}});</code></pre>

<p>This code initializes a new navigation menu, giving it four named
parameters. <code>path_info</code> is the path within the host. Note that, as
opposed to the paths in the navigation menu, it starts with a slash. This is to
allow some CGI-related redirections. <code>current_host</code> is the current
host (again, it's <code>default</code>). Finally, <code>hosts</code> and
<code>tree_contents</code> point to hosts and the tree of contents, respectively.</p>

<p>The object <code>render()</code> method returns the results in a hash
reference, with the navigation menu results as an array of tags pointed by the
<code>html</code> key. The code finally <code>join</code>s and returns
them.</p>

<p>The program produces <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/simple/dest/">this
result</a>, with three entries, placed in a <code>&lt;ul&gt;</code>.  When a
user visits a page, the corresponding menu entry displays in bold and has its
link removed.</p>

<h3>A More Complex Example</h3>

<p>Now consider <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/complex/H-W-NM-complex.pl">a
more complex example</a>. This time, the tree is considerably larger and
contains nested items. There are now <code>subs</code> of other pages.</p>

<p>The <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/complex/dest/">final
site</a> has a menu. When accessing a page (for example, <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/complex/dest/me/">the
"About Myself" page</a>) its expands so visitors can see its sub-items.</p>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/771" template="b/article_sidebar.view">
<!-- sidebar ends -->

<h3>Adding More Navigation Aids</h3>

<p>The next step is to add a breadcrumb trail, navigation links, and a site
map to the site. You can inspect <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/with-embellishments/H-W-NM-embellish.pl">the
new code</a> to see if you understand it and <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/with-embellishments/dest/">view
the final site</a>.</p>

<p>The breadcrumb trail appears right at the top of the site. Below it is a
toolbar with navigation links like &quot;next,&quot; &quot;previous,&quot; and &quot;up.&quot; Finally,
there's <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/with-embellishments/dest/site-map/">a
site map</a>.  Here are the salient points of the <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/complex-2-embellish-delta.diff"
title="the difference from the previous version in patch format">code's
modifications</a>:</p>

<ol>

<li>The code loads the <a href="http://www.template-toolkit.org/">Template
Toolkit</a> to render the page, then fills in the variables of the template to
define the template itself and to process it into the output file.</li>

<li>The CSS stylesheet has several new styles, to make the modified page look
nicer.</li>

<li>A template portion to transform a breadcrumb-trail object as returned by
HTML::Widgets::NavMenu into HTML. It should be easy to understand.</li>

<li>The bottom of the navigation menu tree now has an entry with a link to the
site map page.</li>

<li>The site map is now part of the <code>@pages</code> array.  It initializes
an <code>HTML::Widgets::NavMenu</code> with the appropriate URL, and then uses
its <code>gen_site_map()</code> function.</li>

<li>There is new code used to generate the navigation links. These links are a
hash reference with the keys being the relevance of the link and the value
being an object supplying information about the link (such as
<code>direct_url()</code> or <code>title()</code>).  There are two loops 
that renders each link into both the HTML <code>&lt;head&gt;</code> tag
<code>&lt;link&gt;</code> elements, or the toolbar to present on the page.</li>

<li>The text of the breadcrumb trail is a <code>join</code> of their HTML
representations.</li>

<li>The generated HTML template includes the new page elements.</li>

</ol>

<h3>Fine-Grained Site Flow</h3>

<p>The <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-site-flow/H-W-NM-fine-grained-site-flow.pl">final
example</a> modifies the site to have a more sophisticated site flow. <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/embellish-2-fine-grained-delta.diff">Looking
at the changes</a> shows several more additions.  Their implications are:</p>

<ol>

<li>Both English resum&eacute;s have a <code>'skip' =&gt; 1,</code> pair. This
caused these pages to <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-site-flow/dest/me/resumes/">appear
in the navigation menu</a>, but not to be part of the traversal flow.  Clicking
&quot;next&quot; at that page will skip them both.  Pressing &quot;prev&quot; at <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-site-flow/dest/humour/">the
page that follows them</a> leads to the page that precedes them.</li>

<li>The Humour section has its <code>'show_always'</code> attribute set,
causing it to expand on all pages of the site.</li>

<li><code>'expand'</code> is a regular expression for the Software section. As
a result, accessing <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-site-flow/dest/perl/japhs/">a
page not specified in the navigation menu</a> but that matches that regular
expression causes the Software section to expand there.</li>

<li><a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-site-flow/dest/software-tools">
The software tools page</a> entry has the attribute <code>'hide' =&gt;
1</code>.  This removes it from the navigation menu but allows it to appear in
the site flow.  Clicking on &quot;next&quot; on <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-site-flow/dest/open-source/bits.html">the
preceding page</a> will reach it.</li>

</ol>

<h3>A CGI Script</h3>

<p>Until now, the examples have demonstrated generating a set of static HTML
pages. The code can also run dynamically on a server. One approach is to use
the ubiquitous <a href="http://search.cpan.org/dist/CGI.pm/">CGI.pm</a>, which
comes bundled with Perl.</p>

<p>Converting to <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/cgi-script/H-W-NM-serve.pl.html">the
CGI script</a> required <a
href="http://web-cpan.berlios.de/modules/HTML-Widgets-NavMenu/article/examples/fine-grained-2-cgi.diff.html"
rel="patch">few changes</a>. Inside of the page loop, the code checks if the page
matches the CGI path info (the path appended after the CGI script name). If
so, the code calls the <code>render_page()</code> function.</p>

<p><code>render_page()</code> is similar to the rest of the loop except that it
prints the output to <code>STDOUT</code> <em>after</em> the CGI header. Finally, after the
loop ends, the code checks that it has found a page.  If not, it displays an
error page.</p>

<p>Note that the way this script looks for a suitable page is suboptimal. A
better-engineered script might keep the page paths in a persistent hash or
other data structure from which to look up the path info.</p>

<h3>Conclusion</h3>

<p>This article demonstrated how to use HTML::Widgets::NavMenu to maintain
navigation menus and organize site flow. Reading its documentation may reveal
other useful features. Now you no longer have an excuse for lacking the
niceties demonstrated here on your site. Happy hacking!</p>

<h3>Acknowledgments</h3>

<p>Thanks to Diego Iastrubni, Aankehn, and chromatic (my editor) for giving some useful commentary on early drafts of this document.</p>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2005/06/">&laquo; June 2005</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2005/08/">August 2005 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
