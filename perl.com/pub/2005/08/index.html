<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: August 2005 Archives</title>


    <link rel="prev" href="/pub/2005/07/" title="July 2005" />
    <link rel="next" href="/pub/2005/09/" title="September 2005" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">August 2005 Archives</h1>





                            
                            <div id="entry-828" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/08/p6pdigest/20050825.html" rel="bookmark">This Week in Perl 6, August 17-23, 2005</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Matt Fowles</span> on <abbr class="published" title="2005-08-25T00:00:00-08:00">August 25, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>All--</p>

<p>Welcome to another Monday summary, which hopefully provides some evidence
that Mondays can get better. It always feels like writing summaries is an
uphill battle, so perhaps I should switch to writing about <i>Perl 6 Language</i>
first and <i>Perl 6 Compilers</i> last. Then it will be downhill--maybe next
time.</p>

<h3><i>Perl 6 Compilers</i></h3>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/5df6d5df1f7334c9/b37e4512b56d673a#b37e4512b56d673a">More
Random Pictures</a></h4>

<p>Autrijus posted links to two more images he had created. This time the
images were not about Pugs, but were just kind of cute. He also provided an
explanation of one when prompted.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/991210418285b790/764485d7f50ba0d6#764485d7f50ba0d6">Methods
as Functions</a></h4>

<p>Yiyi Hu noticed that it was impossible to use a method of one argument as a
function. Autrijus offered Yiyi a commit bit, but also kindly posted the
resolution to <i>Perl 6 Language</i>. Thanks, Autrijus!</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/27b84b1000158dea/c8c3fa783e9e12ff#c8c3fa783e9e12ff">Methods
on Code Blocks</a></h4>

<p>Yiyi Hu discovered that <code>{ a b c }.pairs</code> would cause Pugs to
spin out of control. Luke Palmer fixed it. Hopefully one of the two of them
added a test.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/02299ab5870973c4/8e32342c5609a396#8e32342c5609a396">Autrijus'
Secret Sauce</a></h4>

<p>Kris Bosland asked a few question I have been wondering about Autrijus' new
graphics. Autrijus kindly provided the answers.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/8bd2f4f42b70f313/61b3de1e503a2079#61b3de1e503a2079">Documentation
Attack</a></h4>

<p>Kevin Tew has decided the best way for him to delurk is to update
documentation for Pugs. Dudley Flanders and chromatic both provided support,
information, and suggestions for him.</p>
<csperl file="grab" domain="on" record="b/1714" template="b/article_sidebar.view">
<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/e2bdf956e1e221a1/72f5247ee7649c7f#72f5247ee7649c7f">Neko
VM</a></h4>

<p>Nicolas Cannasse announced his release of a high-level, multi-language VM and
wondered what others thought of creating a Perl 6-to-Neko compiler.
Autrijus and Leo provided a few corrections and comments.</p>

<h3>Parrot</h3>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/2cbcd0b56016f39e/f603de821bd82788#f603de821bd82788">The
FAQ, She is <i>Gone</i>! </a></h4>

<p>Amias Channer noticed that the FAQ on <i>parrotcode.org</i> was gone. While no one
responded, the FAQ appears to be back.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/a1a2585585948a0e/1e57f5a3d76d39be#1e57f5a3d76d39be">Platform-Specific C Files</a></h4>

<p>Stephen Hill wanted to know where to put a platform-specific C file to
provide missing functionality. Leo provided a few friendly pointers.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/ef0a4c8f958ef68a/1b62eeff558fafbf#1b62eeff558fafbf"><code>TclArray.get</code></a></h4>

<p>Amos Robinson provided an implementation of <code>get</code> for
<code>TclArray</code>. Will gratefully applied the patch.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/d4d70231f322b5a7/09a158e118872b35#09a158e118872b35">ICU
Being Passed Up</a></h4>

<p>Adrian Lambeck wondered if <em>Configure.pl</em> was passing up ICU.
Warnock applied, so Adrian took matter into his own hands by providing a
possible solution. Jerry Gay offered to take ownership of the problem if no
ICU-enabled soul picked it up. There have been no progress reports since then,
though.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/fb87be7c89a064fd/695419f2c8dff8ff?utoken=6-o-ZDcAAADWXQ4sS--whFjzzhFxvEM0yxapKbptX7zZ7xn9_uPzOhCI8nEEOQevUhyvpyHCHJ_Rs3VGheUC2BMy_BEOeGIM">Java
on Parrot</a></h4>

<p>Tim Bunce asked some preliminary questions about running Java with Parrot. I
provide preliminary answers, and Nattfodd and Autrijus posted links to related
work. The important question of what to call it remained unraised. I vote for
"Jot."</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/cfa8a4023a1c428b/04198072ba7640e3#04198072ba7640e3"><em>gdbmhash.t</em>
Failures</a></h4>

<p>Tim Bunce noticed that <em>gdbmhash.t</em> was failing with an unhelpful
error message. Andy Dougherty provided a patch that made the error message
slightly more helpful. Jerry Gay applied it.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/e368bdce610d3a36/6d17bfa68979833b#6d17bfa68979833b"><code>BEGIN</code>
Blocks</a></h4>

<p>Leo posted some <a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/bca89d6f066ff4d5/ff59334843ed8a09#ff59334843ed8a09">thoughts
and information about <code>BEGIN</code> blocks in Perl 6 and the
<code>@IMMEDIATE</code> pragma in PIR</a>. It involved creating constant PMCs
and freezing them into the bytecode. Then he made it work.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/838867df299aa9d5/50d2592e48e9fca6#50d2592e48e9fca6">Amber
for Parrot</a></h4>

<p>Citing chatter overheard on its intelligence networks, Parrot raised the
terror alert to Amber, or maybe Roger Browne released version 0.2.3 of his
"Eiffel-like" scripting language, Amber. I can never keep track of these
things.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/50d7bf4bc9de1965/98355c62212be267#98355c62212be267">Tcl
<code>parray</code></a></h4>

<p>Amos Robinson offered to provide an implementation of Tcl's <code>parray</code>, including
tests. Will wanted to apply it, but the attachment did not come through.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/33b939f5da9cd02c/6c3a82da7890e791#6c3a82da7890e791">Parrot
Vs. Neko</a></h4>

<p>Nicolas Cannasse wondered why Parrot performed so poorly on the fib
benchmark. Leo explained that this benchmark stressed a currently unoptimized
portion of Parrot (function calls). He also provided a few pointers on which
benchmarks Parrot does well.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/e21e0822d799bc59/c6056fdb34ba43ee#c6056fdb34ba43ee">Using
PMCs from C</a></h4>

<p>Klaas-Jan Stol's Lua compiler uses only PMCs. Thus, he wanted to know how to
access these PMCs from NCI functions. Leo provided an answer, but also suggested
he look at the new calling conventions, which perform auto-conversion in both
directions.</p>














<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/7a27e6d3f08791e3/11797f657fac9f96#11797f657fac9f96">PMC
for Reference Counting</a></h4>

<p>Nicholas Clark posted a relatively full analysis of how to generalize the
DOD's registration system for further reuse. He also asked for ideas about
names. I think the whole thing looks good and that "AddrRegistry" is a good name.
Perhaps that has too many vowels--"AddrRgstry" and sometimes "AddrRgstr" might
work.</p>

<h3><i>Perl 6 Language</i></h3>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/5ea04271d14d1735/c3fb0f3d9389ac94#c3fb0f3d9389ac94">Type
Inferencing in Perl 5</a></h4>

<p>Autrijus (while discussing type inference in Perl 6) recalled that there was
a Google Summer of Code project on <a
href="http://search.cpan.org/perldoc/Devel::TypeCheck">type inferencing in Perl
5</a>. Gary Jackson, the summer coder, provide a more detailed description of
his work.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/89fc3e95a0ecb80d/9a8a8d8ae66896a5#9a8a8d8ae66896a5"><code>+"hello"</code></a></h4>

<p>Daniel Brockman wondered if <code>+"hello"</code> still evaluated to a NaN.
Larry reasoned that it might, and then went on to speculate about the what the
extra exception information would do when a <code>Num</code> gets jammed into a <code>num</code>.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/f5d1415442ec3a4c/b2923a4a9bc6a21f#b2923a4a9bc6a21f">Generic
Classes</a></h4>

<p>Autrijus found the frequent use of generic classes confusing, as he thought
that only roles were type parameterizable. Larry explained that roles could be
promoted to classes pretty easily, but that the distinction between them was
still useful and meaningful.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/d6bc9237b9210a4b/002483f30c6191a0#002483f30c6191a0">GC
API</a></h4>

<p>David Formosa posted a revised GC API after the previous discussion.  More
discussion ensued.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/577cce02541d3c9d/e07672b3e69f9a23#e07672b3e69f9a23">Name
Conflicts</a></h4>

<p>Yiyi Hu wondered what would happen if he declared two lexicals with
different declarators. Larry answered that it would be a compile-time
error.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/61f4044520874f29/bce78cf3287e4b20#bce78cf3287e4b20">Parsing
Numbers</a></h4>

<p>Ingo Blechschmidt posted a list of different possible ways to write numbers,
asking which were valid and which not. Many weighed in, including Larry.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/53232788dc4c7341/ae4d28708146c1f7#ae4d28708146c1f7">Bindings
and Routine Signatures</a></h4>

<p>Luke Palmer noticed that implementing binding as anonymous subroutines
 and then binding existing variables created delimited continuations, and binding
globals, full continuations. While interesting, Warnock applies.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/6dadcb39e23cc5a3/814d5f890cb8a43c#814d5f890cb8a43c">Visibilty
of <code>$?SELF</code> and <code>$?CLASS</code></a></h4>

<p>Stevan Little wondered what scopes will have <code>$?SELF</code> and
<code>$?CLASS</code> available to them. Larry provided answers.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/c19bea30514933f4/a10c571d683f9567#a10c571d683f9567">"Time
to Take Her Home Her Dizzy Head is Conscience-Laden"</a></h4>

<p>Amusingly enough, the thread about time has a big gap between July 5 and
August 15. The thread also reminded me why I have an analog watch.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/c1aa2d1bea721f06/f627657ac28724cb#f627657ac28724cb">Is
Params::Validate Necessary? </a></h4>

<p>Dave Rolsky hoped that Params::Validate would no longer be necessary in Perl
6. This led to much discussion of the parameter declaration syntax in Perl 6
and a few suggested changes.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/2e66199c576a8436/66d074fed528ff06#66d074fed528ff06">Constants
are Dead; Long Live Read-Only! </a></h4>

<p>Apparently <code>is constant</code> is gone and <code>is readonly</code> is
here. The discussion contains mores than that, but that is my take-away
point.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/7233bd8e8a597da9/ca18a76f98fb7633#ca18a76f98fb7633">Multidimensional
Hyper Ops</a></h4>

<p>Luke Palmer wondered how hyper ops would work on multi-dimensional inputs.
The short answer is "recurse when possible, apply when not."</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/9d416d7fa643e7b3/86deff4c1b749572#86deff4c1b749572">Serializing
Code</a></h4>

<p>Yuval Kogman posted an analysis of a new HTML::Prototype module that hinges
on serializing code between the various layers of implementation.  Many folks
thought this was cool and discussion ensued.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/f6ed7b076781243d/67cb807fbf3e4432#67cb807fbf3e4432">Slurpy
Hash</a></h4>

<p>Luke Palmer wondered if one could bind a slurpy hash by name. The answer is
no.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/14ab4e67088e4bf1/e9b1e791ac08d43b#e9b1e791ac08d43b">Making
Pairs Less Magical</a></h4>

<p>Luke Palmer wants pairs to be less magical, as their special treatment has
caused much confusion of late. Much discussion continues.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/8953c45b2d6e7d33/5675c9fddfb1612a#5675c9fddfb1612a">Lazy
Scalars? </a></h4>

<p>Yiyi Hu wants lazily evaluated scalars. Ingo Blechschmidt, Luke Palmer, and
Larry all provided ways to achieve that end. The simplest solution is to
create an anonymous closure, it seems.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/3439e609dc66e2a4/8e313d44d1218bf5#8e313d44d1218bf5">Using
Foreign Languages</a></h4>

<p>Ingo Blechschmidt wondered how to use identifiers from other languages that
do not have compatible identifiers. Yuval reasoned that it would be dangerous
to try to accommodate them too closely. Perhaps something like the Sinhala
"karenawa," which marks the preceding word as being foreign (English
specifically), will work?</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/665698a47599cf92/fa397dbfbefc62c2#fa397dbfbefc62c2">Symbolic
References</a></h4>

<p>Ingo Blechschmidt wondered to use symbolic references of magic variables
such as <code>$?SELF</code>. Larry provided a few answers.</p>

<h3>The Usual Footer</h3>

<p>To post to any of these mailing lists please subscribe by sending email to
<code>perl6-internals-subscribe@perl.org</code>,
<code>perl6-language-subscribe@perl.org</code>, or
<code>perl6-compiler-subscribe@perl.org</code>. If you find these summaries
useful or enjoyable, please consider contributing to the Perl Foundation to
help support the development of Perl. You might also like to send feedback to
<csperl file="mailmunge" arg_email="ubermatt@gmail.com" arg_ending="." /></p>

<ul>

<li><a href="http://donate.perl-foundation.org/">The Perl Foundation</a></li>
<li><a href="http://dev.perl.org/perl6/">Perl 6 development site</a></li>
<li><a href="http://planet.parrotcode.org/">Parrot Blog aggregator</a></li>

</ul>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-820" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/08/25/tools.html" rel="bookmark">Perl Needs Better Tools</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Matisse Enzer</span> on <abbr class="published" title="2005-08-25T00:00:00-08:00">August 25, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>Perl is in danger of becoming a fading language--new programmers are
learning Java and Python in college, and companies like Google hardly use Perl
at all.  If you are afraid that Perl may be in danger of becoming irrelevant
for medium-to-large projects, then read on.</p>

<h3>The Scary Part</h3>

<p>I have discussed the future of Perl with managers from companies that
currently use it and find that they worry about the future of Perl. One company
I spoke with here in San Francisco is rewriting their core application in Java.
Another company worries they will not be able to find new Perl programmers down
the road.  Yet another uses Perl for major projects, but suffers from
difficulty in refactoring their extensive code base.</p>

<p>There are many reasons why companies care about the future of Perl. I offer
a part of a solution: better tools for Perl can be a major part of keeping Perl
relevant and effective as the primary language for medium and large
projects.</p>
<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1795" template="b/article_sidebar.view">
<!-- sidebar ends -->
<p>When measuring the effectiveness of a development environment (people,
language, tools, processes, etc.), a key measure is how expensive and painful it
is to make changes to existing code. Once a project or system has grown to
thousands of lines of code in dozens (or hundreds) of modules, the cost of
making changes can escalate to the point where the team is afraid to make any
significant change. Excellent tools are one of the ways to avoid this unhappy
situation, or at least reduce its impact.  Other factors are excellent
processes and, of course, excellent people.</p>

<h3>21st-Century Integrated Development Environments for Perl</h3>

<p>I propose that more, high-quality development tools will help keep Perl
relevant and alive in medium and large project environments.  My focus in this
article is on IDEs, or Integrated Development Environments, and primarily those
with a graphical interface.</p>

<p>An IDE is an integrated set of tools for programming, combining a source
code editor with a variety of other tools into a single package. Common
features of modern IDEs include refactoring support, version control,
real-time syntax checking, and auto-completion of code while typing.</p>

<p>I want to make it clear right at the outset that a team of highly skilled
Perl programmers, using only tools that have been around for years (such as
<code>emacs</code>, <code>vi</code>, <code>cvs</code>, and <code>make</code>)
can and do build large, sophisticated, and successful projects.  I am not
worried about those programmers. I am worried about the larger population of
programmers with one to five years of experience, and those who have not yet begun to
program: the next generation of Perl programmers.</p>

<p>Great tools will not make a bad programmer into a good programmer, but they
will certainly make a good programmer better.  Unfortunately, the tools for
Perl are years behind what is available for other languages, particularly
Java.</p>

<p>One powerful example is the lack of graphical IDEs for Perl with excellent
support for refactoring.  Several IDEs for Java have extensive refactoring
support.  Only one for Perl, the <a href="http://e-p-i-c.sf.net/">EPIC plugin
for Eclipse</a>, supports even a single refactoring action.</p>

<p>For an example of how good IDEs have inspired at least one Perl developer,
see <a href="/pub/au/Kennedy_Adam">Adam Kennedy</a>'s <a
href="/pub/a/2005/06/09/ppi.html">Perl.com article on his
new PPI module</a> and <a
href="http://search.cpan.org/dist/Devel-Refactor/">Scott Sotka's
Devel::Refactor module</a> (used in EPIC).</p>

<p>I acknowledge that a graphical IDE is not the be-all of good tools.  Just as
some writers reject word processors in favor of typewriters or hand-written
manuscripts, some programmers reject graphical IDEs and would refuse a job that
required them to use one.  Not everyone has (nor should have) the same tool
set, and there are things a pencil can do that <code>vi</code> and
<code>emacs</code> will never do. That said, IDEs have wide use in businesses
doing larger projects, and for many programmers and teams they provide major
increases in productivity.</p>

<p>Another important point is that while this article discusses over a dozen
specific tools or features, having all the tools in a single package produces
the biggest value. An IDE that provides all of these features in a single
package that people can easily install, easily extend, and easily maintain
across an entire development team has far more value than the sum of its
parts.</p>

<p>There is a big win when the features provided by an IDE immediately upon
installation include all or almost all of the tools and features discussed here
and where the features "know" about each other. For example, it is good if you
enter the name of a non-existent subroutine and the real-time syntax checker
catches this. It is much better if the code-assist feature then pops up a
context menu offering to create a stub for the subroutine or to correct the
name to that of an existing similar subroutine or method from another class that is
available to the current file. (This is standard behavior for some Java
IDEs.)</p>

<h3>What Would a 21st-Century Perl Tool Set Contain?</h3>

<p>Perl needs a few great IDEs--not just one, but more than one so that
people have a diverse set to choose from.  Perl deserves and needs a few great
IDEs that lead the pack and set the standard for IDEs in other languages.</p>














<p>I am well aware that the dynamic nature of Perl makes it harder to have a
program that can read and understand a Perl program, especially a large and
complex one, but the difficulty in comprehending a Perl program makes the value
of such a tool all the greater, and I have faith that the Perl community can
overcome some of the built-in challenges of Perl. Indeed, it is among the
greatest strengths of Perl that Perl users can adapt the language to their
needs.</p>

<p>A great Perl IDE will contain at least the following, plus other features I
haven't thought of. (And, of course, there must be many of those!)</p>

<ul>

<li>A <a href="#Syntax-coloring_text_editor">syntax-coloring text
editor.</a></li>

<li><a href="#Syntax-checking">Real-time syntax-checking</a> to catch and
display syntax errors as you type.</li>

<li><a href="#Version_control_integration">Version control integration</a> to
check out and compare code using CVS, Subversion, etc.</li>

<li>A <a href="?page=3#Code-assist">code-assist editor</a>, to provide a list of
methods when you type in an object reference, for example.</li>

<li><a href="?page=3#refactoring_support">Excellent refactoring
support</a>.</li>

<li>A <a href="?page=4#Tree_view_of_source">tree view of source files and
resources</a>.</li>

<li><a href="?page=4#support_for_unit_tests">Support for creating and running unit
tests</a>.</li>

<li><a href="?page=5#Language-specific_help">Language-specific help</a>.</li>

<li><a href="?page=5#Debugger">Real-time display of debugging results</a>.</li>

<li><a href="?page=5#Automatic_reformatting">Automatic code reformatting</a>.</li>

<li>Seamless <a href="?page=5#handling_of_multiple_languages">handling of multiple
languages</a> (such as Perl and C, Perl and Java, Perl and PHP, or Perl and
Python).</li>

<li><a href="?page=5#Automated_build_and_test">Automated build and test
support</a>.</li>

</ul>

<p>Most of the screen shot examples in this article use the EPIC Perl IDE.  At
present, it has the largest amount of the features on my list (although it
certainly doesn't have all of them).</p>

<h4><a id="Syntax-coloring_text_editor" />Syntax-Coloring Text Editor</h4>

<p>Most of you have probably seen this. It is available under <code>vim</code>, <code>emacs</code>,
BBEdit, and TextPad. Just about every decent text editor will colorize source
code so that keywords, operators, variables, etc., each have their own
color, making it easier to spot syntax errors such as forgetting to close a
quote pair.</p>

<h4><a id="Syntax-checking" />Real-Time Syntax Checking</h4>

<p><img src="/pub/2005/08/25/graphics/syntax_check.gif" width="309" height="135" alt="real-time syntax check example"
/><br />
<em>Figure 1. Real-time syntax checking</em></p>

<p>The IDE in Figure 1 shows that line 4 has an error because of the missing
<code>)</code> and that line 5 has an error because there is no declaration of
<code>$naame</code> (and <code>use strict</code> is in effect).</p>

<p>A key point here is that the IDE shows these errors right away, before you
save and compile the code. (In this example, the EPIC IDE lets you specify how
often to run the syntax check, from 0.01 to 10.00 seconds of idle time, or only
on demand.)</p>

<p>As nice as this is, it would be even better if the IDE also offered ways to
fix the problem, for example, offering to change <code>$naame</code> to
<code>$name</code>. Figure 2 shows an IDE that does exactly that; unfortunately,
for Java, not Perl.</p>

<p><img src="/pub/2005/08/25/graphics/syntax_help.gif" width="427" height="150" alt="syntax help from the IDE" /><br
/><em>Figure 2. Syntax help from the IDE</em></p>

<p>It would be great if Perl IDEs offered this kind of help.</p>

<h4><a id="Version_control_integration" />Version Control Integration</h4>

<p>All non-insane large projects use version control software. The most common
version control software systems are probably CVS, Perforce, Subversion, and
Visual SourceSafe.  Figure 3 shows an IDE comparing the local version of a file
to an older version from the CVS repository.</p>

<table width="250" cellspacing="0" cellpadding="0" border="0">
<tr>
<td>
<p class="secondary">
<a href="/2005/08/25/graphics/cvs_compare.gif" onclick="window.open('/2005/08/25/graphics/cvs_compare.gif','fullsize','toolbar=no,width=910,height=593,status=no,location=no,scrollbars=yes,resizable=yes,menubar=yes');return false"><img src="/pub/2005/08/25/graphics/cvs_compare_sm.gif" vspace="4" alt="Figure 3" width="220" height="143" border="0" /></a><br />
Figure 3. Comparing a local file to an older version in
CVS--click image for full-size screen shot</p>
</td>
</tr>
</table>

<p>CVS integration is available in many modern code editors, including <code>emacs</code>,
<code>vim</code>, and BBEdit, as well as graphical IDEs such as Eclipse and Komodo Pro.
Subversion integration is available as a plugin for Eclipse; Komodo Pro
supports Perforce and Subversion.</p>













<h4><a id="Code-assist" />A Code-Assist Editor</h4>

<p>Suppose that you have just typed in an object reference and want to call a
method on the object, but you are not sure what the method name is. Wouldn't it
be nice if the editor popped up a menu listing all of the methods available for
that object? It might look something like Figure 4.</p>

<p><img src="/pub/2005/08/25/graphics/auto_completion.gif" width="399" height="335" alt="automatic code completion" /><br
/><em>Figure 4. Automatic code completion</em></p>

<p>In this example, the IDE is able to figure out which class the object
<code>$q</code> is an instance of and lists the names of the available methods.
If you type a <code>p</code>, then the list shows only the method names
beginning with <code>p</code>. If you type <code>pa</code>, then the list shows
only the <code>param()</code> and <code>parse_params()</code> methods.</p>

<h4><a id="refactoring_support" />Excellent Refactoring Support</h4>

<p>The easier it is to do refactoring, the more often people will do it. The
following list contains the most common refactorings.  Your personal list will
probably be a little different. All of these are things you can do "manually,"
but the idea is to make them into one or two-click operations so that you will
do them much more often. (For a extensive list of refactoring operations, see
<a href="http://www.refactoring.com/catalog/">Martin Fowler's alphabetical list
of refactorings</a>.)</p>

<h5><a id="Extract_SubroutineMethod" />Extract Subroutine/Method</h5>

<p>The IDE should create a new subroutine using the selected code and replace
the selected code with a call to the new subroutine, with the proper
parameters. Here's an example of using the Extract Subroutine refactoring from
Eclipse/EPIC (which uses the <a
href="http://search.cpan.org/dist/Devel-Refactor/">Devel::Refactor</a>
module).</p>

<p>First, you select a chunk of code to turn into a new subroutine, and then
select Extract Subroutine from a context menu. You then get the a dialog box
asking for the name of the new subroutine (shown in Figure 5).</p>

<p><img src="/pub/2005/08/25/graphics/extract_subroutine_before.gif" width="500" height="329" alt="code before Extract
Subroutine refactoring" /><br /><em>Figure 5. Code before Extract Subroutine
refactoring</em></p>

<p>The IDE replaces the selected code with a call to the new subroutine, making
reasonable guesses about the parameters and return values (Figure 6). You may
need to clean up the result manually.</p>

<p><img src="/pub/2005/08/25/graphics/extract_subroutine_after.gif" width="500" height="45" alt="code after Extract
Subroutine refactoring" /><br /><em>Figure 6. Code after Extract
Subroutine</em></p>

<p>Figure 7 shows the new subroutine created by the IDE.  In this case, it needs
no changes, but sometimes you will need to adjust the parameters and/or return
value(s).</p>

<p><img src="/pub/2005/08/25/graphics/extract_subroutine_newsub.gif" width="314" height="241" alt="the new subroutine
created by Extract Subroutine" /><br /><em>Figure 7. The new subroutine created
by Extract Subroutine</em></p>

<p>Ideally, the editor should prompt you to replace similar chunks of code with
calls to the new subroutine.</p>













<h5><a id="Rename_SubroutineMethod" />Rename Subroutine/Method</h5>

<p>The IDE should find all the calls to the subroutine throughout your project
and offer to change them for you. You should be able to see a preview of all of 
the places a change could occur, and to accept or reject each one on a case-by-case
basis. The action should be undoable.</p>

<h5><a id="Rename_Variable" />Rename Variable</h5>

<p>Like Rename Subroutine, this feature should find all occurrences throughout
the project and offer to make the changes for you.</p>

<h5><a id="Change_SubroutineMethod_signature" />Change Subroutine/Method
Signature</h5>

<p>The IDE should be able to make reasonable guesses about whether each
subroutine or method call is supplying the proper parameters. Partly this is to
enable the <a href="?page=2#Syntax-checking">real-time syntax checking mentioned
above</a>,  and partly this is to enable you to select a subroutine declaration
and tell the IDE you want to refactor it by adding or removing a parameter. The
IDE should then prompt you for the change(s) you want to make, do its best
to find all of the existing calls to the subroutine, and offer to correct the
subroutine calls to supply the new parameters.</p>

<p>Obviously, this is an especially tricky thing to do in Perl, where
subroutines fish their parameters out of <code>@_</code>. So the IDE would have
to look carefully at how the code uses <code>shift</code>, <code>@_</code>, and
<code>$_[]</code> in order to have a reasonable guess about the parameters the
subroutine is expecting. In many common cases, though, a Perl IDE could make a
reasonable guess about the parameters, such as in the following two examples,
so that if you added or removed one, it could immediately prompt you about
making corrections throughout the project:</p>

<pre><code>sub doSomething {
    my $gender = shift;
    my $age    = shift;
    # Not too terribly hard to guess that $gender and $age are params
}

sub anotherThing {
    my ($speed,$direction) = @_;
    # No magic needed to guess $speed and $direction are params.
}</code></pre>

<h5><a id="Move_SubroutineMethod_to_different" />Move Subroutine/Method</h5>

<p>This refactoring operation should give you a list or dialog box to choose
the destination file in your project. The IDE should allow you to preview all
of the changes that it would make to accomplish the move, which will include
updating a call to the subroutine/method to use the proper class. At a minimum,
the IDE should show you or list all of the calls to the subroutine so you can make
the appropriate changes yourself. Ideally, the IDE should make a guess about
possible destinations; for example, if <code>$self</code> is a parameter to the
method being moved, then the IDE might try assuming the method is an object
(instance) method and initially only list destination classes that inherit from
the source class, or from which the source class inherits.</p>

<h5><a id="Change_package_name" />Change a Package Name</h5>

<p>As with Rename Subroutine and Rename Variable, when changing a package name,
the IDE should offer to update all existing references throughout your
project.</p>

<h4><a id="Tree_view_of_source" />Tree View and Navigation of Source Files
and Resources</h4>

<p>Another useful feature of good IDEs is being able to view all of the code
for a project, or multiple projects, in a tree format, where you can "fold" and
"unfold" the contents of folders. All of the modern graphical IDEs support this,
even with multiple projects in different languages.</p>

<p>Being able to view your project in this manner gives you both a high-level
overview and the ability to drill down into specific files, and to mix levels
of detail by having some folders show their contents and some not.</p>

<p>For example, Figure 8 shows a partial screen shot from ActiveState's Komodo
IDE.</p>

<p><img src="/pub/2005/08/25/graphics/komodo_code_tree.gif" width="204" height="318" alt="tree view of code in Komodo"
/><br /><em>Figure 8. Tree view of code in Komodo</em></p>

<h4><a id="support_for_unit_tests" />Support for Creating and Running Unit
Tests</h4>

<p>Anyone who has installed Perl modules from CPAN has seen unit tests--these
are the various, often copious, tests that run when you execute the <code>make
test</code> part of the installation process. The vast majority of CPAN modules
include a suite of tests, often using the <a
href="http://search.cpan.org/dist/Test-Harness">Test::Harness</a> and/or <a
href="http://search.cpan.org/dist/Test-Simple">Test::More</a> modules. A good
IDE will make it very easy to both create and run unit tests as you develop
your project.</p>













<p>The most basic form of support for unit tests in an IDE is simply to make it
easy to execute arbitrary scripts from within the IDE.  Create a
<em>test.pl</em> for your project and keep adding tests to it or to a
<em>t/</em> subdirectory as you develop, and keep running the script as you
make changes. All modern IDEs provide at least this minimal capability.</p>

<p>A more sophisticated level of support for unit tests might resemble the Java
IDE feature for tests written in JUnit, where you can select an existing class
file (a <em>.pm</em> file in Perl) and ask the IDE to create a set of stub
tests for every subroutine in the file. (See <a
href="http://www.junit.org/">JUnit</a> and the Perl module <code><a
href="http://search.cpan.org/dist/Test-Unit/">Test::Unit</a></code> for more on
unit tests.) Furthermore, the IDE should support running a set of tests and
giving simple visual feedback on what passed/failed. The standard approach in
the JUnit world is to show either a "green bar" (all passed) or "red bar"
(something failed) and then allow you to see details on failures. Other
nice-to-have features include calculating code-coverage, providing statistical
summaries of tests, etc.</p>

<p>Figure 9 shows a successful run of a Java test suite with Eclipse.</p>

<p><img src="/pub/2005/08/25/graphics/unit_tests_success.gif" width="339" height="199" alt="JUnit test run, success" /><br
/><em>Figure 9. A successful JUnit test run</em></p>

<p>Figure 10 shows the same test run, this time with a failure.</p>

<p><img src="/pub/2005/08/25/graphics/unit_tests_failure.gif" width="339" height="222" alt="JUnit test run, with a failure." /><br />
<em>Figure 10. A JUnit test run with a failure</em></p>

<p>A stack trace of the failure message appears in another part of the window
(cropped out here to save space).  If you double-click on the test that failed
(<code>testInflate</code>), the IDE will open the file
(<code>BalloonTest</code>, in this case) and navigate to the test function.</p>

<p>The central idea is that the IDE should make it as painless as possible to
add and modify and run tests, so you will do more of it during development.</p>

<h4><a id="Language-specific_help" />Language-Specific Help</h4>

<p>This is a fairly straightforward idea--the IDE should be able to find and
display the appropriate documentation for any keyword in your code, so if you
highlight <code>push</code> and ask for help, you should see the
<code>push</code> entry from the Perl documentation. If you highlight a method
or subroutine or other symbol name from an imported module, the IDE should
display the module's documentation for the selected item. Of course, this
requires that the documentation be available in a consistent, machine-readable
form, which is only sometimes true.</p>

<h4><a id="Debugger" />Debugger with Real-Time Display of Results</h4>

<p>All modern IDEs offer support for running your code under a debugger,
usually with visual display of what's going on, including the state of
variables. The <a
href="http://aspn.activestate.com/ASPN/docs/Komodo/3.1/komodo-doc-debugperl.html#debugperl_top">Komodo
IDE supports debugging Perl that is running either locally or remotely</a>.</p>

<p>Typical support for debugging in an IDE includes the ability to set
breakpoints, monitor the state of variables, etc.  Basically, the IDE should
provide support for all of the features of the debugger itself.  Graphical IDEs
should provide a visual display of what is going on.</p>

<h4><a id="Automatic_reformatting" />Automatic Code Reformatting</h4>

<p>This means automatically or on-demand re-indenting and other reformatting of
code. For example, when you cut and paste a chunk of code, the IDE should
support reformatting the chunk to match the indentation of its new location. If you change the number of spaces or tabs for each level of indentation, or
your convention for the placement of curly braces, then the IDE should support
adjusting an entire file or all files in your project.</p>

<h4><a id="handling_of_multiple_languages" />Seamless Handling of Multiple
Languages</h4>

<p>Many large software projects involve multiple languages. This is almost
universally true in the case of web applications, where the user interface
typically uses HTML, CSS, and JavaScript, and the back end uses one or more of
Perl, PHP, Java, Python, Ruby, etc. It is very helpful to have development
tools that seamlessly integrate work done in all of the languages.  This is
becoming quite common. For example, both Komodo and Eclipse support multiple
languages.</p>

<h4><a id="Automated_build_and_test" />Automated Building and Testing</h4>

<p>This feature can be very basic by making it easy to run an arbitrary script
from within the IDE and to see its output. This could be as simple as having
the IDE configured to have a one-click way of running the traditional Perl
module build-and-test commands:</p>

<pre><code>$ perl Makefile.PL
$ make
$ make test</code></pre>

<p>A more advanced version of this feature might involve having the IDE create
stub code to test all of the subroutines in an existing file, or to run all of the
scripts in a specified directory under <code>Test::Harness</code>, or to run a
set of tests using <a
href="http://search.cpan.org/perldoc/Test::Unit::TestRunner">Test::Unit::TestRunner</a>
or <a
href="http://search.cpan.org/perldoc/Test::Unit::TkTestRunner">Test::Unit::TkTestRunner</a>.
(The latter provides a GUI testing framework.)</p>













<h3>Conclusion and Recommendations</h3>

<p>While there are many tools for helping Perl development, the current state
of the Perl toolbox is still years behind those of other languages--perhaps three to five years
behind, when compared to Java tools. While there are several tools for Java that
have all the features described above, virtually none for Perl have all of them.
On the other hand, things are looking up; they are better now than a year ago.
It's possible to close that gap in a year or two.</p>

<p>A couple of obvious areas where improvements could be somewhat easy are
adding more features to EPIC and Komodo.  EPIC is open source, so there is
potentially a wider pool of talent that could contribute. On the other hand,
Komodo has a company with money behind it, so people actually get paid to
improve it. Hopefully both tools will get better with time.</p>

<p>Another interesting possibility is the development of new IDEs or adding to
existing ones by using <a
href="/pub/a/2005/06/09/ppi.html">Adam Kennedy's PPI
module</a>, which provides the ability to parse Perl documents into a
reasonable abstract syntax tree and to manipulate the elements and re-compose
the document. There is a <a
href="http://search.cpan.org/dist/Text-Editor-Vip/">new Perl editor project,
VIP, that is in the design stages</a> and is intended to be "pluggable" and to have
special features to support pair programming.</p>

<p>Finally, I've gathered a couple of lists of links for related material. The
first list below consist of IDEs and graphical editors for Perl, and the second
list consists of various related articles and websites. I hope this is all
inspirational and helpful.</p>

<h3>Current IDEs for Perl</h3>

<p>The listed IDEs support Perl. The list is undoubtedly
incomplete, but should form a good starting point for anyone wishing
to look into this further.</p>

<ul>
<li><p><a href="http://www.latenightsw.com/affrus/">Affrus</a></p>

<p>Perl only, Mac OS X only. Closed source (and hence not extensible by
users). Primarily designed for CGI and standalone scripts. Free demo
available. $99 to purchase.  (See the <a
href="/pub/a/2004/05/14/affrus.html">Perl.com review of
Affrus</a> to learn more.)</p></li>

<li><p><a href="http://e-p-i-c.sf.net/">Eclipse/EPIC</a></p>

<p>EPIC is a plugin for the <a href="http://www.eclipse.org/">Eclipse
platform</a>. Eclipse is open-source and cross platform
(Windows/Mac/Linux/Solaris, etc.). Once you have Eclipse installed, <a
href="http://e-p-i-c.sf.net/updates">install the EPIC plugin from within the
Eclipse application</a> using the <a href="http://e-p-i-c.sf.net/updates/">EPIC
update URL</a>.  Eclipse supports Java, and with plugins, C/C++, COBOL, Perl,
PHP, UML2, Python, Ruby, XML, and more. There is a large and active community
around Eclipse.</p></li>

<li>Emacs is the mother of all
text-editor/development-environment/adventure-game/all-in-one tools. Expert
programmers use it widely and there are numerous enhancements for working with
particular languages, including, of course, Perl. <a
href="http://www.emacswiki.org/cgi-bin/wiki/CPerlMode">Emacs, with
CPerlMode</a>,  is a richly featured IDE for Perl, albeit a non-GUI IDE (which,
for some people, makes it even better). <a
href="http://groups.yahoo.com/group/extremeperl/files/">A set of extensions for
CPerlMode are available</a> but you need to join the Yahoo Extreme Perl group
to get to them.</li>

<li><p><a href="http://www.activestate.com/Products/Komodo/">Komodo</a></p>

<p>This runs on Linux, Solaris, and Windows. Free demo; $29.95 for personal and
student use, $295 for commercial use.  It supports Perl, PHP, Python, Tcl, and
XSLT.</p></li>

<li><p><a href="http://www.elora.hostings.com/SOFTWARE/page/">PAGE</a></p>

<p>PAGE runs only on Windows (9x/ME/NT/2000/XP). It is a Rapid
Application Development tool for Perl and comes in three versions: Free,
Standard ($10), and Enterprise ($50). PAGE provides a several "wizards" for
creating scripts, modules (packages), web forms, and even database
applications.</p></li>

<li><p><a href="http://www.enginsite.com/Perl.htm">Perl Editor</a></p>

<p>This closed source program runs only on Windows (9x/NT/2000/XP). It has a GUI
code profiler, and the Pro version has a regular expression tester and built-in
web server (for CGI testing, etc.). Perl Editor claims to have the best
debugger on the market. It also comes with GUI tools for managing MySQL
databases. $69.95 to purchase.</p></li>

<li><p><a href="http://vim.sourceforge.net/"><code>vim</code></a></p>

<p>The well-known descendent of <code>vi</code> is a powerful and flexible text
editor with many plugins and extensions. Have a look at the
<a href="http://vim.sourceforge.net/"><code>vim</code> scripts </a>; for
example, <a href="http://vim.sourceforge.net/scripts/script.php?script_id=556">vim.sourceforge.net/scripts/script.php?script_id=556</a>
and <a href="http://vim.sourceforge.net/scripts/script.php?script_id=281">vim.sourceforge.net/scripts/script.php?script_id=281</a>.</p></li>

<li><p><a href="http://www.helpconsulting.net/visiperl/">visiPerl</a></p>

<p>This is a closed source application that runs on Win9x/NT/2000.  It handles
Perl and HTML and has code templates, being designed for website building.
visiPerl includes a built-in web server for testing and an FTP client for code
deployment.  There is a free demo, or you can purchase it for $59.</p></li>

</ul>

<h3>Related Topics</h3>

<ul>

<li><a href="http://www.artima.com/intv/testdriven.html">A conversation about
Test-Driven Development</a></li>

<li>"<a href="http://www.petdance.com/perl/automated-testing/">Automated Testing
With Perl</a>," Andy Lester's presentation on doing automated testing in
Perl</li>

<li><a href="http://www.extremeperl.org/bk/home">Extreme Perl book</a></li>

<li><a href="http://groups.yahoo.com/group/extremeperl/">Extreme Perl mailing
list</a></li>

<li><a href="http://www.jera.com/techinfo/xpfaq.html">eXtreme Programming FAQ</a></li>

<li><a href="http://agilemanifesto.org/">Manifesto for Agile Software Development</a></li>

<li>"<a href="/pub/a/2005/06/09/ppi.html">Parse Perl Independently</a>," an article about Adam Kennedy's PPI module</li>

<li><a href="http://www.testdriven.com/">testdriven.com</a></li>

<li><a href="http://www.junit.org/">JUnit</a></li>

<li>Jon Udell's article on "<a
href="http://weblog.infoworld.com/udell/2005/05/23.html#a1236">Tools for
Dynamic Languages</a>"</li>

<li><a href="http://www.refactoring.com/">Refactoring home page</a></li>

<li><a href="http://www.xprogramming.com/">XProgramming.com</a>: Resources for
and about Agile Software Development</li>

</ul>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-826" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/08/p6pdigest/20050818.html" rel="bookmark">This Week in Perl 6, Through August 14, 2005</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2005-08-18T00:00:00-08:00">August 18, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>As you will note from the date in the title, it's been a short week.  We're
switching back to a midnight Sunday/Monday rollover in order to make life
easier for the Perl.com types. So, if I can avoid being distracted too much by
the second Ashes test, I'll try to get the summary finished before Monday is
out, which should please chromatic.</p>

<h3>This Week in <em>perl6-compiler</em></h3>

<p>Another low-volume week in <em>perl6-compiler</em>; probably because, with the
high speed of Pugs development, most of the discussion happens on IRC.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050806162158.GB2263@aut.dyndns.org">Container
Model, Pictures, and Questions</a></h4>

<p>Autrijus fielded some questions about, and updated the pictures of, the
container model.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050808125840.22956.qmail@lists.develooper.com">Why
PXPerl? </a></h4>

<p>Robert (No Surname) asked what were the benefits of PXPerl over the
ActiveState distribution. In short, PXPerl comes with Parrot and Pugs, which
ActiveState doesn't. If you set your path appropriately, you can continue to
use the ActiveState Perl and just rely on PXPerl for Parrot and Pugs.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050809193348.GA27323@wall.org">Hoisting
Lexical Declarations</a></h4>

<p>Larry answered some of Autrijus's questions about Perl 6's lexical scoping
rules. Apparently what Pugs currently does is close enough to sane to be going
on with.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050811040041.GB56898@aut.dyndns.org">Warnock
in Pugsland</a></h4>

<p>Autrijus noted that, in Pugsland, a Warnocked patch usually means that the
person who posted the patch simply received a committer bit and didn't mention
the fact on the list.</p>

<csperl file="grab" domain="on" record="b/1754" template="b/article_sidebar.view">

<h4><a href="http://pugscode.org/images/metamodel.png">Metamodel Notes</a></h4>

<p>Nathan Gray posted some <a
href="http://groups.google.com/groups?threadm=20050811193918.GB12852@vs2.capwiz.com">notes</a>
and <a
href="http://groups.google.com/groups?threadm=20050812170838.GA820@aut.dyndns.org">ASCII
art</a> about the metamodel.  Autrijus added pointers to further pictures.</p>

<h3>Meanwhile, in <em>perl6-internals</em></h3>

<h4><a
href="http://groups.google.com/groups?threadm=01bf01c59ba4$384dc5d0$0200a8c0@SERVER">Updated
<em>intro.pod</em></a></h4>

<p>Jonathan Worthington posted a rewrite of Parrot's <em>intro.pod</em>
document, now with a discussion of PIR. Huzzah!</p>

<h4><a
href="http://groups.google.com/groups?threadm=1123570251.22403.70.camel@localhost">Test::Builder
and Friends on Parrot</a></h4>

<p>Following prompting from Geoff Young and Jeff Horwitz, chromatic has
implemented Test::Builder and Test::Builder::Tester in pure Parrot. For his
next trick, he intends to port Test::More and Parrot::Test.</p>

<p>Tests are good, m'kay?</p>

<h4><a
href="http://groups.google.com/groups?threadm=1123573276.8867.6.camel@lgerd.hrz.uni-siegen.de">How
to Add a New Opcode? </a></h4>

<p>Gerd Pokorra asked how to add an opcode to Parrot. Klaas-Jan Stol and Leo
gave the answers.</p>

<h4><a
href="http://groups.google.com/groups?threadm=42FA0FFB.6090605@toetsch.at">Cleaning
Up the Call Opcodes</a></h4>

<p>Leo reposted about cleaning up the various function-calling opcodes to take
account of the fact that the calling conventions have changed. He asked for
opinions and actually received a couple, which is handy, since he ended up
Warnocked last time.</p>

<h4><a
href="http://groups.google.com/groups?threadm=d113603e0508101127396ed8c7@mail.gmail.com"><code>parrot
-I</code></a></h4>

<p>Amir Karger wondered if there was some way of telling Parrot to add
directories to its load path. Leo seemed to think it was not that good an idea,
and proposed using a relative path in a <code>.include</code> directive.</p>

<h4><a
href="http://groups.google.com/groups?threadm=45ec99fc050810182530001652@mail.gmail.com">Dominance
Frontiers</a></h4>

<p>Curtis Rawls continued his work on dominance frontiers to improve Parrot's
optimizer.</p>

<h4><a
href="http://groups.google.com/groups?threadm=rt-3.0.11-36882-119083.2.43242787217334@perl.org">PGE
Globber, Empty Strings</a></h4>

<p>Will Coleda reported on trying to match empty strings with PGE's
<code>glob</code> implementation. It turned out to be a problem with
<code>Data::Escape</code>. Leo fixed it.</p>

<h4><a
href="http://groups.google.com/groups?threadm=42FDF124.2090502@toetsch.at">Deprecated
Opcodes</a></h4>

<p>Leo posted a list of opcodes that are due for the chop (or alteration) soon.
If you're doing anything with Parrot, it's probably a good idea to take a look
at this list. One of those who did was chromatic, who asked if Leo could give some
examples of translating code so as not to use the old forms.</p>

<h3>Meanwhile, in <em>perl6-language</em></h3>

<p>Hmm. Eight balls to go with one wicket needed. I think I'll pause for a
while.</p>

<p>Damn. Australia have saved the game.</p>

<h4><a
href="http://article.gmane.org/gmane.comp.lang.perl.perl6.language/4554">Translating
(Or at Least Parsing) Java Interface Definitions</a></h4>

<p>Tim Bunce wondered if anyone had done any work on parsing Java interface
declarations and (ideally) translating them to roughly equivalent Perl 6.
Apparently, Gaal Yahas has done something along these lines (with
Parse::RecDescent for Perl 5), but doesn't own the code. He outlined the
approach he took.</p>













<h4><a
href="http://article.gmane.org/gmane.comp.lang.perl.perl6.language/4558">Perl 6
Meta Object Protocols and <code>$object.meta.isa(?)</code></a></h4>

<p>Stevan Little is busy documenting the Perl 6 metamodel that he's
implemented in Perl 5 and that Autrijus is busy porting to Haskell. He posted
an overview to the list and asked for comment. There then followed lots of
discussion. I think I understood some of it.</p>

<h4><a
href="http://article.gmane.org/gmane.comp.lang.perl.perl6.language/4574"><code>$object.meta.isa(?)</code>
Redux</a></h4>

<p>Stevan split the discussion of <code>$object.meta.isa(?)</code> off from the
earlier metamodel thread into a thread of its own and asked for comments once
more. Larry commented that "the Apocalypses are primarily intended to be
entertaining rather than factual." Also in this thread, Luke let slip that
there's now a <code>Set</code> role in Perl 6, which has the enormous advantage
of letting us specify argument types in a sensible way without having to
overload the junctions.</p>

<h4><a
href="http://article.gmane.org/gmane.comp.lang.perl.perl6.language/4576"><code>$obj.meta.add_method('foo'
=&gt; ???)&gt;</code></a></h4>

<p>Stevan continued discussing the metamodel with a thread about the
<code>add_method</code> method. Autrijus was the only person with comments.</p>

<h4><a
href="http://article.gmane.org/gmane.comp.lang.perl.perl6.language/4588">Proposed
New Traits</a></h4>

<p>Autrijus said that he'd started to write the inferencer and had immediately
run into the problem that every type can potentially contain
<code>undef</code>. He proposed adding an <code>is defined</code> trait, which
would cause a variable to immediately throw an exception if anyone attempted to
assign it an undefined value. He also proposed a <code>typed</code> trait, but
I was a little less clear on why this would be a good idea. I have to confess that I
didn't understand what Larry's reply was driving at, but that's okay, because
Autrijus did seem to understand it.</p>

<h4><a
href="http://article.gmane.org/gmane.comp.lang.perl.perl6.language/4600"><code>my
$pi is constant = 3</code></a></h4>

<p>Autrijus wondered if an example of the <code>is constant</code> trait shown
in Synopsis 6 was a special form or a typo. At least, I think that's what he
was asking; I may be wearing my stupid head today, though. Larry thought it was
neither. I think. It seems there's more to constancy than meets the eye. (Just
ask any married couple.)</p>

<h4><a
href="http://article.gmane.org/gmane.comp.lang.perl.perl6.language/4625">Typed
Type Variables (<code>my Foo ::x</code>)</a></h4>

<p>Stuart Cook asked about the meaning of type annotations on type variables.
Autrijus answered and Thomas Sandla&szlig; agreed with him.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language@perl.org/msg21349.html"><code>BEGIN
{...}</code> and IO</a></h4>

<p>Nicholas Clark commented on an earlier discussion of using IO in
<code>BEGIN</code> blocks, pointing out that this was just a specific case of
the more general problem of attempting to serialize things to bytecodes that
were simply unserializable. I reckon the trick of it will be to do such things
in <code>INIT</code> or possibly <code>CHECK</code> blocks (I can never
remember which way round those two go).</p>

<h4><a
href="http://article.gmane.org/gmane.comp.lang.perl.perl6.language/4658">Generic
Classes</a></h4>

<p>Autrijus asked about generic classes, but nobody answered before the end of
the summary week. Expect Matt to address this one in the next summary.</p>

<h3>Acknowledgements, Adverts, Apologies, and Alliteration</h3>

<p>I'm sorry to have to say this, but I don't think I have to apologize for
anything this week. WorldCon was fun.</p>

<h4>Everything Else</h4>

<p><a href="http://www.geeksunite.net/">Help Chip!</a></p>

<p>If you find these summaries useful or enjoyable, please consider
contributing to the Perl Foundation to help support the development of
Perl.</p>

<ul>

<li><a href="http://donate.perl-foundation.org/">The Perl Foundation</a></li>
<li><a href="http://dev.perl.org/perl6/">Perl 6 development site</a></li>

</ul>

<p>Or, you can check out <a href="http://www.bofh.org.uk/">my website</a>.
Maybe now I'm back writing stuff I'll start updating it.  There are also <a
href="http://www.flickr.com/photos/pdcawley">vaguely pretty photos by
me</a>.</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-818" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/08/18/ical_dot.html" rel="bookmark">Parsing iCal Data</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Robert Pratte</span> on <abbr class="published" title="2005-08-18T00:00:00-08:00">August 18, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>One of the attributes of a killer application is that it does something
cool: it allows you to view or organize information in new and interesting
ways, saves you time, or helps you win that auction bid. Yet one of the
fundamental aggravations of applications in general is that they don't always
work well together; typically, you cannot send your data to mixed-and-matched
applications unless they were explicitly designed to allow this. One of the
great strengths of a language such as Perl is its ability to overcome these
differences and act as "glue." As long as you can figure out what the incoming
data looks like, and how the outgoing data should look, it is very simple to share
data between previously incompatible applications. By simply building a parser
between the applications and creating input files for the target application
from the former's data, you extend the usefulness of your tools. In a sense, you
can create killer applications out of various mundane tools on your system.</p>

<p>A somewhat trivial example of this sort of creation is an application that
converts iCalendar data into a directed graph, readable by an application such
as GraphViz. This example seems so trivial that you might ask yourself why you
would wish to do such a thing. The answer is perhaps equally trivial: aside
from the challenge factor, the ability to convert data could provide an
alternative (or complement) to Gantt charts in project documentation, map
relationships between events, etc. Moreover, by providing a simple way to
allow disparate applications to interoperate, you can cumulatively build suites
of applications, hopefully allowing for unforeseen advantages in the future.</p>

<p>Returning to the example, say you would like to take an iCal calendar
(Figure 1) and turn it into an interesting visualization (Figure 2).  How would
you do this? Such an ability to convert formats is one step in constructing
that killer application.</p>

<p><img src="/pub/2005/08/18/graphics/ical_screen.gif" width="500" height="366" alt="an iCal calendar" /><br />
<em>Figure 1. An iCal calendar</em></p>

<p><img src="/pub/2005/08/18/graphics/ical_dot.gif" width="500" height="254" alt="an alternate visualization" /><br />
<em>Figure 2. An alternate visualization of the calendar data</em></p>


<h3>Reading the iCalendar Format</h3>

<p><a href="http://www.ietf.org/rfc/rfc2446.txt">RFC 2446</a> defines the
iCalendar format, which Apple's iCal application uses.  Each iCalendar file
represents an individual calendar and contains at least one block of event data
in key:value tuples, starting with a <code>BEGIN:VEVENT</code> tuple and ending
with <code>END:VEVENT</code>. Here is an example (with indentation added for
readability) of a small iCalendar file containing two events:</p>

<pre><code>BEGIN:VCALENDAR
        CALSCALE:GREGORIAN
        PRODID:-//Apple Computer\, Inc//iCal 2.0//EN
        VERSION:2.0
        BEGIN:VEVENT
                LOCATION:San Francisco
                DTSTAMP:20050618T151130Z
                UID:BDF17182-CA21-4752-8D4F-40A4FE47C90D
                SEQUENCE:8
                URL;VALUE=URI:http://developer.apple.com/wwdc/
                DTSTART;VALUE=DATE:20050606
                SUMMARY:Apple WWDC
                DTEND;VALUE=DATE:20050612
                DESCRIPTION:Lots of sessions.
        END:VEVENT
        BEGIN:VEVENT
                DURATION:PT1H
                LOCATION:Home
                DTSTAMP:20050618T151543Z
                UID:5F88A0EC-AD21-428E-AAAD-005F1B1AB72E
                SEQUENCE:6
                DTSTART;TZID=America/Chicago:20050615T180000
                SUMMARY:Set up File Server
                DESCRIPTION:Music server for the kids.
        END:VEVENT
END:VCALENDAR</code></pre>













<p>There are several possible approaches to parsing the above data in Perl, but
perhaps the easiest one is to create a hash of events, modeled after the
iCalendar structure. With this approach, a single calendar becomes a hash of
hashes with a key:value pair for each event, where the key is the event ID and
the value is a hash containing the event data. While it would be just as easy
to <em>store</em> the data as an array of hashes, the ability to pull an event
by its ID allows greater flexibility and power to <em>manipulate</em> the data.
The data for a single event might look like this:</p>

<pre><code>Calendar-&gt;EventUID = { 'UID'         =&gt; EventUID,
                       'LOCATION'    =&gt; EventLocation,
                       'START'       =&gt; EventStart,
                       'END'         =&gt; EventEnd,
                       'DURATION'    =&gt; EventDuration,
                       'DTSTAMP'     =&gt; EventDatestamp,
                       'SEQUENCE'    =&gt; EventSequence,
                       'SUMMARY'     =&gt; EventSummary,
                       'DESCRIPTION' =&gt; EventDescription,
                       'URL'         =&gt; EventURL };</code></pre>

<p>Note that these keys represent only a subset of all possibilities as defined
in RFC 2246. Each event may not contain all of the above keys. For example, the
first event in my example does not contain <code>DURATION</code>. Further,
certain keys (such as <code>SEQUENCE</code>) may be irrelevant for your
purposes.</p>

<p>With the data structure designed, what's the right way to convert iCalendar
data into such a structure? Realizing the mantra of Perl, that there is more
than one way to do things, perhaps the easiest approach is to match key names,
starting a new event block when the parser sees <code>BEGIN:VEVENT</code> and
ending it when <code>END:VEVENT</code> appears. Given the large number of
possible keys, it may be easiest to use switch-like behavior. Here is an
example of how to do this, splitting a key:value on the colon character (as the
semicolon precedes any modifiers to the data):</p>

<pre><code>SWITCH: {
        if ( $_ =~ /BEGIN:VEVENT/ ) {
                ##-----------------------------------------
                ## We have a new event, so start fresh.
                ##-----------------------------------------
                $eventHash = {};
                last SWITCH; }


        if ( $_ =~ /END:VEVENT/ ) {
                ##-----------------------------------------
                ## We hit the event end, so store it.
                ##-----------------------------------------
                $calHash-&gt;{$eventHash-&gt;{'UID'}} = 
				{
					 'UID'         =&gt; $eventHash-&gt;{'UID'},
                     'LOCATION'    =&gt; $eventHash-&gt;{'LOCATION'},
                      #...The rest of our keys...
                     'URL'         =&gt; $eventHash-&gt;{'URL'} 
				};
                last SWITCH; }


          ## we will split the key:value pair into an array 
		     and grab the value (1st element)
        if ( $_ =~ /^UID/ ) {
                $eventHash-&gt;{'UID'} = ( split ( /:/, $_ ) )[1];
                last SWITCH; }


        if ( $_ =~ /^LOCATION/ ) {
                $eventHash-&gt;{'LOCATION'} = ( split ( /:/, $_ ) )[1];
                last SWITCH; }

...The rest of our key matches...

        if ( $_ =~ /^URL/ ) {
                $eventHash-&gt;{'DESCRIPTION'} = ( split ( /:/, $_ ) )[1];
                last SWITCH; }

} # end switch</code></pre>

<p>While this example does a good job of showing how to fill the data
structure, it does a poor job of leveraging the power of Perl. More extensive
use of regular expressions, the use of one of the Parse modules in CPAN, or
even a bit of recursive programming could make this code more elegant and
perhaps even a bit faster.  However, these tactics may also make the code a bit
harder to read--which is not always bad, unless you are attempting to explain concepts
in an article. For further ideas, Toedor Zlatanov has written an article on <a
href="http://www-106.ibm.com/developerworks/linux/library/l-perl-parsing/">using
Perl parsing modules</a> as well as a real mind-bender on <a
href="http://www-128.ibm.com/developerworks/linux/library/l-road4.html">using a
functional programming approach in Perl</a>.</p>

<h3>The Dot Specification</h3>

<p><a href="http://www.graphviz.org/Documentation/dotguide.pdf">Dot</a> (PDF) is a
diagramming, or directed, graph language created by Emden Gansner, Eleftherios
Koutsofios, and Stephen North at Bell Labs. There are several implementations
of Dot, including <a href="http://www.graphviz.org">GraphViz</a>, <a
href="http://www.graphviz.org/webdot/">WebDot</a>, and <a
href="http://www.research.att.com/~john/Grappa/">Grappa</a>.  Interestingly, <a
href="http://www.omnigroup.com/applications/omnigraffle/">OmniGraffle</a>, a
powerful diagramming tool for Macintosh computers, can read simple Dot
files.</p>

<h3>Creating Dot Files</h3>

<p>The basic syntax of Dot is that there are objects or things that you
describe by adding data within digraph <code>{}</code> braces. You denote
relationships between objects with the <code>-&gt;</code> combination of
characters.  With this code:</p>

<pre><code>digraph my_first_graph {
  object1 -&gt; object2;
}</code></pre>

<p>your Dot-driven application (such as GraphViz) will display an image something like Figure 3.</p>

<p><img src="/pub/2005/08/18/graphics/firstgraph.gif" width="103" height="159" alt="a simple graph" /><br />
<em>Figure 3. A simple graph</em></p>













<p>The specification describes additional complexity in terms of
sub-objects/structures, alternate shapes (the default is an oval), ranking, and
more. One additional item worth noting is that Dot recognizes comments in C-
and Java-style formats (<code>//</code> and <code>/*</code>). To help
troubleshoot problems (and for good coding practice), I suggest that your
parser insert comments into the Dot input file.</p>

<p>Consider how you might create a Dot file from the data parsed earlier. If
you pass to the function that handles the writing of the Dot file the reference
to the filehandle of your Dot input file (the output of your conversion) along
with the reference to your parsed data structure, then you might generate your
Dot file along these lines:</p>

<pre><code>##------------------------------
  ## Name our Dot graph 
  ##------------------------------
  if ( $raw-&gt;{'CALNAME'} ) {
      print { $$file } 'digraph "'. $raw-&gt;{'CALNAME'} ."\" {\n\n";
   } elsif ( $$raw{'CALID'} ) {
      print { $$file } 'digraph "'. $raw-&gt;{'CALID'} ."\" {\n\n";
   } else {
      print { $$file } "digraph unnamed {\n\n";
   }


   ##-----------------------------------------
   ## Some optional rendering info
   ##-----------------------------------------
   print { $$file } '   size     = "10,7";'. "\n".
                    '   compound = true;'  . "\n".
                    '   ratio    = fill;'  . "\n".
                    '   rankdir  = LR;'    . "\n\n";


   ##-----------------------------------------
   ## Generate our Dot data
   ##   we will wrap most data in double-quotes 
   ##   since most Dot interpreters don't like spaces, 
   ##   something allowed in iCal data
   ##-----------------------------------------
   foreach $key ( keys %$raw ) {
      if ( ref( $raw-&gt;{$key} ) eq 'HASH' ) {
         my $block = $raw-&gt;{$key};

           ##------------------------------
           ## graphViz doesn't like - in names
           ##------------------------------
         $block-&gt;{'UID'} =~ s/-/_/g;

           ##------------------------------
           ## produce list of all unique tasks
           ##------------------------------
         push( @{ $tasks-&gt;{$block-&gt;{'SUMMARY'}} }, '"'. $block-&gt;{'UID'} .'"' );

           ##------------------------------
           ## build record
           ##------------------------------
         my $eventBlock = '"'. $block-&gt;{'UID'} .
                          '" [ shape = record, label = "'. $block-&gt;{'SUMMARY'} .
                           ' | &lt;START&gt; Start | &lt;END&gt; End ';

         if ( $block-&gt;{'DESCRIPTION'} ) {
            $eventBlock .= ' | '. $block-&gt;{'DESCRIPTION'};
         }
         $eventBlock .= '"];';

         print { $$file } '   '. $eventBlock ."\n\n";


            ##------------------------------
            ## build relations based upon time
            ##------------------------------
         push( @timeLine,    '"'. $block-&gt;{'START'} .'"' );
         print { $$file } '   "'. $block-&gt;{'UID'} .'":START  
		    -&gt; "'. $block-&gt;{'START'} ."\"\;\n\n";

         if ( $$block{'END'} ) {
            push( @timeLine,    '"'. $block-&gt;{'END'} .'"' );
            print { $$file } '   "'. $block-&gt;{'UID'} .'":END    
			   -&gt; "'. $block-&gt;{'END'} ."\"\;\n\n";
         }

         print { $$file } "\n\n";

}

      ##------------------------------
      ## tie non-unique tasks
      ##------------------------------
    print { $$file } '   // Create tasks relationships'. "\n\n";
    foreach ( keys %$tasks ) {
       if ( @{ $tasks-&gt;{$_} } &gt; 1 ) {
          print { $$file } '   '. join( ' -&gt; ', @{ $tasks-&gt;{$_} } ) ."\;\n\n";
       }
    }
    print { $$file } "\n\n";


      ##------------------------------
      ## Render our timeline
      ##------------------------------
    print { $$file } '   // Create timeline relationships'. "\n\n";
    print { $$file } '   '. join( ' -&gt; ', sort( @timeLine )) ."\;\n\n";


      ##------------------------------
      ## Close off dot file
      ##------------------------------
    print { $$file } "}\n";</code></pre>
	












<p>This code will produce the following Dot file:</p>

<pre><code>digraph unnamed {
   size     = "10,7";
   compound = true;
   ratio    = fill;
   rankdir  = LR;

   "5F88A0EC_AD21_428E_AAAD_005F1B1AB72E" [ shape = record, 
      label = "Set up File Server | &lt;START&gt; Start | 
	  &lt;END&gt; End  | Music server for the kids."];

   "5F88A0EC_AD21_428E_AAAD_005F1B1AB72E":START  -&gt; "20050615T180000";

   "BDF17182_CA21_4752_8D4F_40A4FE47C90D" [ shape = record, label = "WWDC | 
      &lt;START&gt; Start | &lt;END&gt; End  | Lots of sessions."];

   "BDF17182_CA21_4752_8D4F_40A4FE47C90D":START  -&gt; "20050606";

   "BDF17182_CA21_4752_8D4F_40A4FE47C90D":END    -&gt; "20050612";

   // Create tasks relationships

   // Create timeline relationships

   "20050606" -&gt; "20050612" -&gt; "20050615T180000";
}</code></pre>

<p>Note that this code uses the record shape, holding individual segments
within the larger object. This is slightly more complicated than the default
oval that Dot uses.</p>

<h3>Where to Go from Here</h3>

<p>If you are using Apple's iCal application, note that the location and naming
scheme of iCalendar files changed between the 1.x and 2.x releases. Previously,
iCalendar files went in the <em>~/Library/Calendars/</em> directory and had
names of the form <em>&lt;calendar name&gt;.ics</em>.  Thus, a calendar named Work
would have a file <em>Work.ics</em>. However, the 2.x release keeps iCalendar
information in the <em>~/Library/Application Support/iCal/Sources/&lt;calendar name&gt;/</em> directory as <em>sources.ics</em>.</p>

<p>Other applications that implement the iCalendar specification, such as
Mozilla's Calendar extension for Mozilla/Firefox/Thunderbird, may follow a
different convention. On a Mac, Firefox stores .ics files in the
<em>~/Library/Application Support/FireFox/Profiles/&lt;profile&gt;/Calendar/</em>
directory, where <em>&lt;profile&gt;</em> is the profile specified in the Firefox
<em>profile.ini</em> file.  Again, other systems will likely store this
information in different locations.</p>

<p>While on the topic of different implementations, bear in mind that, while
the key:value specifications are consistent (as long as the application
conforms to RFC 2246), the actual .ics file may look slightly different. For
example, Firefox lays out that first event from the previous example as:</p>

<pre><code>BEGIN:VEVENT
UID
 :b9794c88-1dd1-11b2-bb51-8a92011a78e8
SUMMARY
 :Apple WWDC
DESCRIPTION
 :Lots of sessions
LOCATION
 :San Francisco
URL
 :http://developer.apple.com/wwdc
STATUS
 :TENTATIVE
CLASS
 :PRIVATE
DTSTART
 ;VALUE=DATE
 :20050606
DTEND
 ;VALUE=DATE
 :20050612
DTSTAMP
 :20050618T191731Z
END:VEVENT</code></pre>

<p>Here, the key:value tuples (plus any data modifiers such as
<code>VALUE=DATE</code>) almost always split up across lines. In this case, it
would be best to handle this difference when reading in the .ics file, so that
the rest of the script can expect data in a generic format. One way to do this
is to copy the array representing the .ics file using a finite-state machine.
Another method would be to walk the array and join array elements under certain
conditions, such as if the first non-white-space character of the current
element begins with a colon or semicolon character, or is simply
non-alphabetic.</p>

<p>Hopefully, this article will spur you to create a bridge between two of your
favorite applications. Good luck, and please remember to share your
contributions with the community.</p>

<csperl file="grab" domain="on" record="b/1795" template="b/article_sidebar2.view">

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-816" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/08/15/syndication_update.html" rel="bookmark">Important Notice for Perl.com Readers About O'Reilly RSS and Atom Feeds</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">perl.com</span> on <abbr class="published" title="2005-08-15T00:00:00-08:00">August 15, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>O'Reilly Media, Inc. is rolling out a new syndication mechanism that provides greater control over the content we publish online. You'll notice some improvements immediately, such as better standards compliance, graphical tiles accompanying article descriptions, and enclosure support for podcatching applications. We've tested the new feeds using a variety of popular newsreaders and aggregators, but we realize that there may be a few bumps along the way. If you experience problems, please don't hesitate to send mail to <a href="mailto:webmaster@oreilly.com">webmaster@oreilly.com</a>. Please include detail about your operating system and reader applications. We also welcome your suggestions. Thank you for your continued support of Perl.com.</p> 

<p>The following URLs represent Perl.com's article and weblog content in a variety of popular formats:</p>
<dl>
<dt>Atom 1.0</dt>
<dd><a href="http://www.oreillynet.com/pub/feed/16">http://www.oreillynet.com/pub/feed/16</a></dd>
<dt>RSS 1.0</dt>
<dd><a href="http://www.oreillynet.com/pub/feed/16?format=rss1">http://www.oreillynet.com/pub/feed/16?format=rss1</a></dd>
<dt>RSS 2.0</dt>
<dd><a href="http://www.oreillynet.com/pub/feed/16?format=rss2">http://www.oreillynet.com/pub/feed/16?format=rss2</a></dd>
</dl>

<p>We will begin automatically redirecting the existing feeds to the new feeds above, but we recommend that you update your feedreader's subscription settings to ensure continuous and uninterrupted service.</p>

<p>Thanks,<br/>
O'Reilly Media, Inc.'s Online Publishing Group</p>

<hr size="1" noshade="noshade" />

<p>Return to <a href="/">Perl.com</a></p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-824" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/08/p6pdigest/20050811.html" rel="bookmark">This Week in Perl 6, August 2-9, 2005</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Matt Fowles</span> on <abbr class="published" title="2005-08-11T00:00:00-08:00">August 11, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />

<p>All--</p>

<p>Welcome to another summary, brought to you by Chinese food. The attentive
among you will notice that this summary is a day late, because I did not feel
like doing it yesterday. If only I could do that at work.</p>

<h3><i>Perl 6 Compilers</i></h3>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/be055bd40627492d/a60044757ceb3e61#a60044757ceb3e61">Pugs
Argument Processing</a></h4>

<p>Vadim Konovalov submitted a patch to Pugs affecting <code>@*ARGS</code>
processing.  In the world of Pugs, this means that he received a committer bit
and applied it himself.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/114ffdd27a9cb125/e4a4dc51ec90239f#e4a4dc51ec90239f">Type
Inferencing</a></h4>

<p>Autrijus wants to type push Perl 6's type inferencing as far as it can go
(and maybe a little beyond). To this end, he has been soliciting input from all
comers. It looks like he has put a lot of thought and research into it. One day,
I expect to be thanking Autrijus for important (if likely difficult to
understand) compiler errors and warnings.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/c27335567a8fc562/f11a7310269764d7#f11a7310269764d7"><code>WWW::Kontent</code>
Release</a></h4>

<p>Brent &quot;Dax&quot; Royal-Gordon announced the release of <code>WWW::Kontent</code>
0.01: &quot;a flexible web content management system written in Perl 6 and
executable with Pugs.&quot; It looks nifty to me. Maybe we need to fight Ruby on
Rails with Perl 6 on Pylons or something. That doesn't quite have the right
ring to it, but there has to be something catchy there somewhere.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/338b1f8acccceb81/b635247572c975e7?utoken=YHABADYAAAA7xVMbCVGjeIx9IodtUfMwhFkjZG-vgVJcJYMxbUTYyDTxzYJPNMPNXytgmAvkYeEWcO1g0jwXN3xYLXnEJ39L">Array
Interpolation</a></h4>



<p>Phil Crow wondered why Pugs would not interpolate his arrays.  Ingo
Blechschmidt and Patrick explained that <code>@foo</code> does not interpolate,
but <code>@foo[]</code> does. I sense a frequently asked question here.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/3ac98d6a866ae1c4/f9e5fa2b6e17c67b#f9e5fa2b6e17c67b">Pugs
6.2.9 Released</a></h4>

<p>Autrijus announced the release of Pugs 6.2.9. It is full of nifty new
features, including the ability to lay on hands!</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/3ac98d6a866ae1c4/f9e5fa2b6e17c67b#f9e5fa2b6e17c67b">White Space
Before Parens</a></h4>

<p>Andrew Shitov wondered why Perl 6 no longer allowed white space between
function names and parens. Autrijus explained that it allows <code>print
(1+2)*3</code> to print 9 instead of 3. As someone who just last week explained
the peculiarity of Ruby printing 3 in the above situation to a complete novice,
I welcome the change.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/c236932902cb3333/c0a37ac28a00a3d2#c0a37ac28a00a3d2">Container
Model Pictures</a></h4>

<p>Autrijus posted a few pretty pictures explaining the <a
href="http://pugscode.org/images/simple-compilation.png">compiler model</a> and
the <a href="http://pugscode.org/images/container.png">container model</a>.
While the compiler model was readily understandable to me, the container one
wasn't. Fortunately, when prompted, Autrijus provided a great explanation to
accompany the diagram.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/fbdc7bfb5ff3d803/588edb288e8527c7#588edb288e8527c7">PxPerl
5.8.7-4</a></h4>

<p>Upon discovering that Pugs released a new version, Gr&eacute;goire
P&eacute;an released a new version of PxPerl that includes the new Pugs. I (and
many others) thank Gr&eacute;goire for lowering the entry bar for Perl 6
hacking on Windows.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.compiler/browse_frm/thread/05cc1e19db2fcc14/4814ff30475fc03e#4814ff30475fc03e">Hosting
Lexical Declarations</a></h4>

<p>Declaring lexicals mid-block confuses things, especially declaring them
mid-statement, as in <code>$x = $x + my $x if $x;</code>. Autrijus proposed
hoisting declarations of lexicals to the top of the block.  Unfortunately, this
can make <code>CALLER::</code> do funny things. Thus, he suggests outlawing it.
Larry agreed.</p>

<h3>Parrot</h3>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/a929f3cbfe2aa9ec/25db76653bac717d#25db76653bac717d">Export
<code>LD_LIBRARY_PATH</code></a></h4>

<p>Bdonlan noticed that Parrot's test suite was not setting
<code>LD_LIBRARY_PATH</code>, which makes tests fail. Leo pointed out that most
users manually set their <code>LD_LIBRARY_PATH</code>, as Parrot often needs
this, but he agreed that the tests should do it just in case.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/cc9242e455d1a63b/5d25c6b934119abe#5d25c6b934119abe">Improved
Argument Processing for <em>ops2c.pl</em></a></h4>

<p>Tom submitted a patch that improves the command-line argument processing
powers of <em>ops2c.pl</em>. Warnock applies.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/be5dc2f14b0dfd42/896d89835150a493#896d89835150a493">ANSI
Escape Codes in Parrot</a></h4>

<p>Klaas-Jan Stol was having trouble putting special characters like ANSI clear
screen and &quot;&yen;&quot; into strings. Nick pointed out that he need to be careful
with encodings and escapes. In Parrot, <code>\O</code> is an octal escape. In
Lua, it is apparently not.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/b5b68a0cf335822b/4ac938caaa6ff298#4ac938caaa6ff298">Parrot
0.2.3</a></h4>

<p>Leo announced the release of Parrot 0.2.3, &quot;Serenity,&quot; which reminds me,
Firefly is coming back soon! I can't wait! Oddly, Google seems to have
swallowed his release notice, but not his warnings.</p>













<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/d72580222deb1646/2b5afda2517c90bd#2b5afda2517c90bd">Strange
Filename-Based Bug</a></h4>

<p>Michal Wallace found a bug that would disappear if the file was renamed.
Leo, with the help of valgrind, provided Michal with a pointer. Michal used
that to find a likely culprit and provide a patch, which Leo then refined.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/455218c176531ba6/8bb0656904124f4c#8bb0656904124f4c">GDBM
Hash on MinGW</a></h4>

<p>Fran&ccedil;ois Perrad provided a patch fixing <code>gdbmhash</code> on MinGW. Bernhard
Schmalhofer applied it.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/1b63e4b253bb0eab/b10f19b834c85c0d#b10f19b834c85c0d">PyString
Link Problem</a></h4>

<p>Fran&ccedil;ois Perrad also fixed a link problem with <em>pystring.o</em>.
Jonathan Worthington applied that patch.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/239e824edb7ff767/f1899af22d2a289e#f1899af22d2a289e">Filling
a Large Data Structure</a></h4>

<p>Amir Karger wanted to know how to fill a large data structure in PIR, other
than explicitly. Leo suggested reading it in from a config file.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/d0083cd312e17ab1/eb025a6949933347#eb025a6949933347">Helping
Perl 6</a></h4>

<p>Rjtucke asked the ever-dangerous question, &quot;How can I help?&quot;.  Unfortunately,
I think he asked it on Google Groups, and thus no one saw it.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/94887d69a826227d/3f587ac32513e71e#3f587ac32513e71e">PGE
Glob Escapes</a></h4>

<p>"PGE Glob Escapes; millions die before it can be rounded up again."  Actually,
Will Coleda noticed that he could not add a literal <code>*</code> to globs in
PGE. Patrick fixed it so he could.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/3b9d082baa68c620/1f18c584c09e5053#1f18c584c09e5053">Language
Test Requirements</a></h4>

<p>Amir Karger has decided to write a Z-code-to-PIR translator. He wants to
integrate its test suite with Parrot's language tests. Unfortunately, it does
not use <code>Test::Simple</code>, or even Perl. Thus he wanted to know a good
way to integrate it. Will Coleda, Bernhard Schmalhofer, and chromatic all
provided suggestions.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/16ec7ea4d9ba4872/b52140fff1d78310#b52140fff1d78310"><code>mod_parrot</code>
0.3</a></h4>

<p>Adrian Lambeck provided a patch to fix <em>src/call_list.txt</em> for
<code>mod_parrot-0.3</code>. chromatic applied it.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/91cb1b36db9f3f30/e85db560e0496873#e85db560e0496873">Making
Makefile a Little too Clean</a></h4>

<p>Patrick noticed that the Parrot build was breaking. Jonathan Worthington
narrowed it down to an exact revision number. Leo realized his mistake and
fixed it.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/66c1435caa126e36/98038a170b66dea6#98038a170b66dea6">Cygwin
Status</a></h4>

<p>Bernhard Schmalhofer applied some old patches from Joshua Gatcomb, in the
hope of improving Cygwin support. Nick Glencross provided needed <a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/6e3982c2438d4160/635220a375758f6d#635220a375758f6d">Parrot
Cygwin test results</a>.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/6782c143d9e3f9d7/0ab141d87d211369#0ab141d87d211369">Calling
<code>SUPER</code> Methods</a></h4>

<p>Klaas-Jan Stol wondered how to call a specific parent methods (possibly
bypassing child methods). Leo answered.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/065a98fa7217b71a/dedda1b8cd1df427#dedda1b8cd1df427">Compiling
Pugs and Parrot</a></h4>

<p>Adrian Lambeck was having trouble compiling Pugs against Parrot. Leo worked
with him to find a solution, although they haven't resolved it yet.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/8c040e2a5d3303f6/bdec8011da7b4800#bdec8011da7b4800">Pure
Parrot Test::Builder</a></h4>

<p>chromatic has written pure-Parrot versions of Test::Builder and
Test::Builder::Tester. As always, patches are welcome.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/abcba81ef69f865c/b1d018e3114ce1f1#b1d018e3114ce1f1">Adding
a New Opcode</a></h4>

<p>Gerd Pokorra wanted to know how to add a new opcode to parrot. Klaas-Jan
Stol and Leo provided answers.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/5472a5cdd52bd3dc/a48d4d6482a9b13b#a48d4d6482a9b13b">More
Win32 Patches</a></h4>

<p>Fran&ccedil;ois Perrad provided several patches for MinGW and Win32. Warnock
applies.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/e36d2b676a916edf/41d4393ec1a5e334#41d4393ec1a5e334">Updated
<em>intro.pod</em></a></h4>

<p>Jonathan Worthington posted an updated <em>intro.pod</em>. Autrijus provided
a few edits, and Jonathan is planning on committing it.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/f2ea6e2b54a62425/53d23545fd068850#53d23545fd068850">Comment
Fix in <em>pir-mode.el</em></a></h4>

<p>Jim McKim made the mistake of using Emacs. Fortunately, he counterbalanced
that failing with the virtue of submitting a patch to fix an error in
<em>pir-mode.el</em> to make the file work better. chromatic applied the patch.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/0d69e4b22417d1c7/95e0762f7e93b784#95e0762f7e93b784">Commit
Bit</a></h4>

<p>Curtis Rawls seemed to be having trouble using his newly acquired commit
bit. Warnock applies.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/6c9d5b091d9f074a/2518470dafaa44f2#2518470dafaa44f2">Segfault
with <code>-E</code></a></h4>

<p>Tom noticed that <code>parrot -E</code> segfaulted and provided a patch. He
was not very confident about the patch.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/636c7816a8e30105/e03cba61e9968bca#e03cba61e9968bca"><code>make
test</code> in <em>bc</em></a></h4>

<p>Amir Karger noticed that <code>make test</code> in <em>bc</em> dies because
he does not have <code>antlr</code> installed. Bernhard Schmalhofer said that
he would try and fix it up to use the config-test for <code>antlr</code>.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/bed06d6981b46f90/20a4e2bc68c05819#20a4e2bc68c05819"><em>interpreter.c</em>
Breakage</a></h4>

<p>Amir Karger noticed that <em>interpreter.c</em> broke during a recent
compilation. Leo pointed out that he need to <code>make realclean</code>.</p>













<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/73a2bf56f29a06c3/f6ba5da370dc450d#f6ba5da370dc450d">MinGW
Meets m4</a></h4>

<p>Fran&ccedil;ois Perrad provided two patches to make m4 work on MinGW.
Warnock applies.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/383873bdf6b2ae0e/72e13310f799ff92#72e13310f799ff92"><code>substr</code>
Segfault</a></h4>

<p>Will Coleda posted a short PIR test that will segfault in the
<code>substr</code> opcode. This led to some discussion of variable-width
encodings.  Leo explained that <code>substr</code> was a call that would
probably force Parrot to rectify variable-width encodings into fixed-width ones
(which it does lazily). Then he fixed it (presumably as he had suggested).</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/6c34526dde0f3cc4/f0d9ef39989dd4a6#f0d9ef39989dd4a6">Parrot
Cygwin Meets Treefrog</a></h4>

<p>Steve &quot;treefrog&quot; posted a patch he needed to get Cygwin testing. I think he
may have posted it to Google Groups directly, though. Warnock applies.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/c7402b70371fb311/8c637a3801067f3a#8c637a3801067f3a">Call
Opcode Cleanups</a></h4>

<p>Leo attempted to free himself from the horns of Warnock by reposting his
suggested call opcode cleanup. Patrick and I voiced our support. More
accurately, I voiced support and Patrick indifference.</p>

<h3><i>Perl 6 Language</i></h3>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/23345901e82f1cb5/4fb0b85a4f5ffa2c#4fb0b85a4f5ffa2c">Complex
Control Flow</a></h4>

<p>Nigel Hamilton began speculating that Perl 6 might have an extremely
complicated control flow. Then he began to wonder aloud about a form of control
flow I can only describe as brain-melting. Luke Palmer suggested that his
proposal might best start as a module.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/ebc571b19072db20/307e6736ab46b391#307e6736ab46b391">Slurpy
Parameters and Flattening</a></h4>

<p>Ingo Blechschmidt's question of the flattening (or not) of slurpy params
continued producing some suggestions. Piers seemed somewhat unhappy with
earlier answers, but the thread died out.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/0465204f271ce9cd/380c684482e0bb78#380c684482e0bb78">Does
<code>if</code> Topicalize?</a></h4>

<p>Luke Palmer noticed <code>if foo() -&gt; $foo { ... }</code> in an OSCON
talk and wondered if <code>if</code> now topicalized. Stuart Cook offered a
workaround.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/f00f1d5500c678f6/fb0eaa8a7b334f4d#fb0eaa8a7b334f4d">Data
Constructors</a></h4>

<p>Luke Palmer posted his thoughts on unifying units and data constructors (as
in Haskell or ML). Warnock applies.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/615d21124b153ae0/f6cbeb1d58f527a8#f6cbeb1d58f527a8">Calling
Methods on <code>undef</code></a></h4>

<p>Ingo Blechschmidt wondered what would happen if he called
<code>undef.chars</code> or <code>char undef</code>. Brent &quot;Dax&quot; Royal-Gordon
responded that it would return <code>undef</code> in the absence of <code>use fatal</code>.
Larry confirmed this behavior.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/21a135e1140c86cc/6b9a07062460e34c#6b9a07062460e34c">Reassigning
<code>.ref</code> and <code>.meta</code></a></h4>

<p>Ingo Blechschmidt wondered what would happen if he assigned to
<code>.ref</code> or <code>.meta</code>. Luke Palmer figured that it would not
be allowed. I think it should cause a large person to come over to your house
and kick you. This is probably a good reason I don't write error messages.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/17e69f24e28c43b1/abc3309f3107553b#abc3309f3107553b">Questioning
<code>.ref</code> and <code>.meta</code></a></h4>

<p>Ingo Blechschmidt left a bunch of blanks for people to fill in with respect
to <code>.ref</code> and <code>.meta</code>. Luke Palmer apparently segfaulted
in the attempt to fill in the blanks.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/685af26a93bf2de5/5367cfdd8bda29e8#5367cfdd8bda29e8">Subscripting
Pairs</a></h4>

<p>Ingo Blechschmidt wondered if one could subscript pairs. Larry declared
no.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/ec30cf943e4290b4/17263f56385a6b31#17263f56385a6b31">Perl
6 Test in Parrot 0.2.3</a></h4>

<p>Andrew Shitov was having trouble running Perl 6 under the latest Parrot.
Autrijus pointed out that he was trying to run the compiler attempt abandoned
in June of 2004 and then pointed him toward Pugs.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/f20535fdbe875d63/c49c08621487c7f6#c49c08621487c7f6">Java
-&gt; Perl ? </a></h4>

<p>Tim Bunce wondered if any work had started on parsing Java interface
definitions and translating them to Perl 6. Warnock applies (which probably
means no).</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/5ea04271d14d1735/6db35ec67d56d088#6db35ec67d56d088">MetaObject Questions</a></h4>

<p>Stevan Little posted some of his thoughts on the MetaObject internals for
comment. Many questions ensued, my eyes glazed over, the summarizer punted.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/8c5f8ce3d6b4bbbc/4fcbb26681d490eb#4fcbb26681d490eb"><code>defined</code>
and <code>typed</code> Traits</a></h4>

<p>Autrijus mused about how to deal with <code>defined</code> and <code>typed</code> traits in Perl 6.
This led Larry to wonder about <code>undef</code> being a class, or a class being <code>undef</code>, or
something confusing.</p>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.language/browse_frm/thread/2e66199c576a8436/728ad09f9782b179#728ad09f9782b179"><code>is
constant</code> Sugar</a></h4>

<p>Autrijus wondered how <code>is constant</code> would desugar if it were a
special form. Larry came up with suggestions, some of which said it desugared
and some of which said it didn't.</p>

<h3>The Usual Footer</h3>

<p>To post to any of these mailing lists please subscribe by sending email to
<code>perl6-internals-subscribe@perl.org</code>,
<code>perl6-language-subscribe@perl.org</code>, or
<code>perl6-compiler-subscribe@perl.org</code>. If you find these summaries
useful or enjoyable, please consider contributing to the Perl Foundation to
help support the development of Perl. You might also like to send feedback to
<csperl file="mailmunge" arg_email="ubermatt@gmail.com" arg_ending="." /></p>

<ul>

<li><a href="http://donate.perl-foundation.org/">The Perl Foundation</a></li>
<li><a href="http://dev.perl.org/perl6/">Perl 6 development site</a></li>
<li><a href="http://planet.parrotcode.org/">Parrot Blog aggregator</a></li>

</ul>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-814" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/08/11/win32guitest.html" rel="bookmark">Automated GUI Testing</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">George Nistorica</span> on <abbr class="published" title="2005-08-11T00:00:00-08:00">August 11, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />

<p>You use Perl at work.  Sometimes you are unhappy because there is one
application you always have to click on and fill all those input boxes.  It's
very boring.  Why not let Perl do that while you go grab a coffee?  Also, maybe
you sometimes feel frustrated that you need to start that nice app and want
someone else type in for you.  Let Perl do that, too.</p>

<h3>Why Perl?</h3>

<p>Simply put: because you like Perl.</p>

<p>The long story is that there are all sorts of software packages that you may use to
automate graphical applications. Are they really good fits for what you want to
do?</p>

<p>Windows has many libraries that help you automate such things, but
do the applications you use support those automation libraries?  Too many do
not. Moreover, is this enough for you to say you have tested a certain GUI
feature? If not, read on.</p>

<h3>What You Need</h3>

<p>You need a working installation of Perl, with Perl/Tk included.  I recommend
<a href="http://www.activestate.com/">ActiveState</a>'s ActivePerl.  You also
need the <a
href="http://search.cpan.org/dist/Win32-GuiTest/">Win32::GuiTest</a> module.
Install it from the CPAN or, ideally, through PPM.</p>

<h3>Example Code</h3>
<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1796" template="b/article_sidebar.view">
<!-- sidebar ends -->
<p>Download the <a href="/2005/08/11/examples/tester.pl"><i>tester.pl</i></a> and the
<a href="/2005/08/11/examples/tested.pl"><i>tested.pl</i></a> programs. They 
need to both be in the same directory. First run the <i>tested.pl</i>
program in order to see the windows it has and how it looks. The program does
nothing by itself; it just serves as a &quot;run&quot; application.
<i>tester.pl</i> is more interesting.  It spawns <i>tested.pl</i>
and starts sending it input (mouse moves, mouse clicks, and keystrokes).</p>

<p>I tested these two programs on Windows 2000 Professional and Windows XP Home
Edition using ActiveState's distribution of Perl.</p>

<p>The <i>tested.pl</i> program is just a dummy GUI used to demonstrate
the examples.  It uses Tk, so although it is a Win32 GUI, it isn't a native
one. This has the effect that not all of the functions you can use with
Win32::GuiTest will work as you would expect them to work against a native
Win32 GUI.  Fortunately, there are workarounds.</p>

<h3>A Few Words About Windows</h3>

<p>Graphical user interfaces manage windows. Windows are just reusable objects
with which users can interact. Almost all GUIs have more than just one window.
I use &quot;window&quot; just as a generic term for any graphical object that an
application may produce. This means that &quot;window&quot; is an abstract term
after all.</p>

<p>Windows have common elements that you need to consider before writing a
program that interacts with a GUI.</p>

<ul>

<li>Each window belongs to a window class (making it possible to search them by
class).</li>

<li>Windows have an organizational hierarchy; every GUI has at least one root
window, and every window may have child windows. Windows form a tree. This
makes them searchable (by class or not) in depth: start from a root window and
search among its siblings.</li>

<li>Some windows have text attached to them. This is useful to identify
windows.</li>

<li>Windows have an numeric ID that uniquely identifies them.</li>

</ul>

<p>This means that you can identify windows by any of their text, class, and
parent window attributes. You can also pinpoint a window by its ID.</p>

<h3>Finding Windows</h3>

<p>When testing a GUI, first make sure the application you want to test has
started. To do this, use the Win32::GuiTest exported function named
<code>FindWindowLike()</code>.  Remember that hierarchy of Windows?  If you
search for an <em>Edit</em> window, you may find it in the wrong place. That
There can be multiple different GUIs started that <em>have</em> editor windows.
There should be a way to differentiate between these hypothetical editor windows--and the hierarchical organization of windows helps.</p>

<p>First look for the main window of the application, and then 
descend the hierarchy (that you have to know beforehand) until you reach the desired window.</p>

<p>How can you know the windows hierarchy? There are two main ways.  If you
have written the GUI yourself or have access to its sources and have enough
experience, you may find out what the hierarchy of windows is.  Unfortunately,
that's quite tricky and prone to error.</p>

<p>Another much simpler way to do this on Windows platforms is to use the free
<a href="http://www.catch22.net/software/winspy.asp">WinSpy++</a> program.
Basically, it allows you to <a
href="http://www.piotrkaluski.com/files/winguitest/docs/ch02.html">peek at an
application's window structure</a>.</p>

<p>When you use WinSpy++ to look at an application windowing structure, you
will notice that every window has a numeric handle, expressed in hex.  However,
Perl expresses in decimal.  This will come up again in a moment.</p>













<p>The syntax for <code>FindWindowLike</code> is:
<code>FindWindowLike($window,$titleregex,$classregex,$childid,
  $maxlevel)</code>.
It returns a list of found windows. The parameters are:</p>

<ul>

<li><p><code>$window</code></p>

<p>This is the (numeric) handle of the parent window to search under (remember
the hierarchical organization of windows in a GUI).  You may use <em>undef</em>
in order to search for all windows.</p>

<p><em>$window</em> should be a decimal value, so if you know the window's hex
handle (as displayed by WinSpy++) you need to convert it.</p></li>

<li><p><code>$titleregex</code></p>

<p>This is the most often used parameter. It is a regular expression for
<code>FindWindowLike</code> to match against window titles to find the
appropriate window(s).</p></li>

<li><p><code>$classregex</code></p> 

<p>This matches against a window class.  Suppose that you want to find all
buttons in an application. Use the function like this:</p>

<pre><code>my @windows = FindWindowLike(undef,&quot;&quot;,&quot;Button&quot;);</code></pre>

<p><code>Note:</code> if you don't care what the class of the window is, do not
omit the <code>$classregex</code> parameter.  Instead, use an empty string.</p>
Currently the <code>FindWindowLike()</code> function does not check if
<code>$classregex</code> is undefined, so you will end up with a lot of Perl
warnings.</p></li>

<li><p><code>$childid</code></p>

<p>If you pass this argument, then the function will match all windows with
this ID.</p></li>

<li><p><code>$maxlevel</code></p>

<p>Maximum depth level to match windows.</p></li>

</ul>

<p>As you may have noticed, the <code>tested</code> program has a title that
matches the string &quot;Tested&quot;. Thus, the <code>tester</code> starts by searching
windows matching this title:</p>

<pre><code>@windows = FindWindowLike( undef, &quot;Tested&quot;, &quot;&quot; );</code></pre>

<p><em>@windows</em> will contain a list of window IDs that have a title
matching the string. The point here is that you probably don't want the
<code>tested</code> program to start more than once simultaneously.</p>

<pre><code>if ( @windows &gt; 1 ) {
     print &quot;* The \&quot;tested\&quot; program is started more than once!\n&quot;;
     ...
 }</code></pre>

<p>If there is no <code>tested</code> application already running, the program
can start it and repeat the procedure, searching for windows that match our
criteria (they contain the string &quot;Tested&quot; in their titles). If it's running just
once, its ID is <code>$windows[0]</code>. In fact, this is the root window of
the application.</p>

<p>There's no point in going further with the program if the GUI hasn't
started, so the code checks this:</p>

<pre><code>unless ( @windows ) {
     print &quot;* The program hasn't started!\n&quot;;
     exit 1;
 }</code></pre>

<h3>Setting a Specific Window to Foreground</h3>

<p>Finding a window is sometimes not enough. Often, you need to send some input
to the window. Obviously, the window should be in the foreground.  The
appropriate functions are <code>SetActiveWindow()</code> and
<code>SetForegroundWindow()</code>.</p>

<p>Because of the way windows work under Win32, this may be trickier than it
seems.  Basically, if the caller is not in the foreground, it can not give
another window &quot;focus.&quot;  MSDN explains this in the documentation of the <a
href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowfunctions/setforegroundwindow.asp"><code>SetForegroundWindow</code></a>
and <a
href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/setactivewindow.asp"><code>SetActiveWindow</code></a>
functions.</p>

<p>While this behavior is easy to explain if you consider that you usually
don't want applications that run in background to be able to annoy you (at
least) by grabbing focus, there is at least one drawback. If you are
running  a GUI (perhaps remotely) to which you will send sensitive input for
some reason, you may send those secrets to another, possibly malicious,
application if the tested application does not have focus!</p>

<p>Another problem is in running tester programs remotely, or at regular
intervals. Suppose that your tester program spawns the tested program, then
starts sending it events (mouse events and/or keystrokes). If the computer is
in a &quot;locked&quot; state, according to Microsoft documentation, no application can
be in the foreground. You may have unexpected results.</p>

<p>If the GUI you are automating receives sensitive input (such as passwords),
you have to find a means to &quot;isolate&quot; that machine's input/output devices, such
as keyboard/mouse/monitor, so that no one unauthorized can peek at what your
Perl program is typing in.  Good luck.</p>

<p>In my opinion, every time you send input to a GUI, the Win32::GuiTest
program should check if the application is in the foreground. If it isn't, it
should try to bring it to the front. If it can't do that, it should fail and
not continue.</p>













<p>Here's a sample routine that <i>tester.pl</i> uses:</p>

<pre><code> sub bring_window_to_front {
     my $window  = shift;
     my $success = 1;

     if ( SetActiveWindow($window) ) {
         print &quot;* Successfully set the window id: $window active\n&quot;;
     }
     else {
         print &quot;* Could not set the window id: $window active\n&quot;;
         $success = 0;
     }
     if ( SetForegroundWindow($window) ) {
         print &quot;* Window id: $window brought to foreground\n&quot;;
     }
     else {
         print &quot;* Window id: $window could not be brought to foreground\n&quot;;
         $success = 0;
     }

     return $success;
 }</code></pre>

<p>In case you don't want to bring a window to front but expect it to be in
front, use <code>GetForegroundWindow()</code>. That way, you can just check the
return value with a window ID and find out if it is in front.</p>

<h3>Key Pressing</h3>

<p>You have found your window and have made sure that it has focus.  What
next?</p>

<p>It's time to send data to the window.  This is the purpose of the
<code>SendKeys()</code> function.  You can send to an application not only
basic keypresses, but combinations of keys too. Here's an example from the
<i>tester.pl</i> program:</p>

<pre><code>my @keys = ( &quot;%{F}&quot;, &quot;{RIGHT}&quot;, &quot;E&quot;, );
for my $key (@keys) {
    SendKeys( $key, $pause_between_keypress );
}</code></pre>

<p>The code starts with an array containing the keypresses. Note the format of
the first three elements. The keypresses are: <code>Alt</code>+<code>F</code>, right arrow, and <code>E</code>.  With the
application open, this navigates the menu in order to open the editor.</p>

<p>For a full listing of &quot;special&quot; keystrokes or combinations of keys, consult
the function's documentation.</p>

<h3>Finding Text in Your Application</h3>

<p>You may want to learn how you can &quot;read&quot; text written in GUI windows.
Unfortunately, you can't read everything.  You <em>can</em> read the text
written in the title of windows (useful for identifying a window by its
title).  You can also read text in <code>Edit</code> class windows; for example, the part of
Internet Explorer where you type in a URL, or the list items in a <code>ListBox</code>. There
may be other window classes from where you can fetch text; just verify with
WinSpy++ whether you can &quot;read&quot; from a window, before writing your program, in order
to avoid frustration.</p>

<p>Remember that you can't (at least now) read everything written in a
window. Maybe a future version of Win32::GuiTest will provide a means by which
to fetch text from a window, no matter what class that window is.   In my humble
opinion, it would be an awesome feature.</p>

<p>The two functions useful for grabbing text are <code>GetWindowText()</code>
and <code>WMGetText()</code>.  Both take as a parameter the window ID:</p>

<pre><code>$text = GetWindowText($window);
$text = WMGetText($window);</code></pre>

<h3>Pushing Buttons</h3>

<p>Pushing buttons can be tricky. The syntax is
<code>PushButton($button[,$delay])</code>, and the variable
<code>$button</code> can be either the text of the button (its caption) or the
button ID.  As Piotr Kaluski points out in "<a
href="http://www.piotrkaluski.com/files/automation/gui/carfl_pushcb.html">Be
Careful with <code>PushChildButton</code></a>," you sometimes want to specify a button ID,
but instead the function matches a button having text like the one you used in
the regexp.  He posted <a
href="http://groups.yahoo.com/group/perlguitest/message/876?threaded=1">a patch
to the <i>perlguitest</i> mailing list</a>.</p>

<p>Also note that when using Tk, as I do in this example, you can't identify
buttons by their text--you need to use their IDs (if you know them).  With
native Win32 applications, you can identify buttons by their text. To check the
differences, use WinSpy++ to look at a Tk button's caption and a native
Win32 button's caption.</p>

<p>Although <code>PushButton()</code> works fine on native Win32 buttons, I
couldn't make it work on my Tk application, so in <i>tester.pl</i>, I
use a trick in the <code>push_button()</code> subroutine:</p>

<pre><code>sub push_button {
    my $parent_window_title = shift;
    my @button;
    my @window;

    SendKeys(&quot;%{F}&quot;);
    SendKeys(&quot;O&quot;);
    sleep 1;

    @window = FindWindowLike( undef, $parent_window_title, &quot;&quot; );

    if ( !bring_window_to_front( $window[0] ) ) {
        print &quot;* Could not bring to front $window[0]\n&quot;;
    }

    @button = FindWindowLike( $window[0], &quot;&quot;, &quot;Button&quot; );
    sleep 1;

    print &quot;* Trying to push button id: $button[0]\n&quot;;
    PushChildButton( $window[0], $button[0], 0.25 );
    sleep 1;

    click_on_the_middle_of_window( $button[0] );
}</code></pre>

<p>Notice that the function depends on the <i>tested.pl</i> application,
as it has hard-coded the way to spawn the <code>Button</code> window (by
navigating the menu using keystrokes). It is easy to adapt it to be more
flexible and to be less coupled with the rest of the code.</p>













<p>After sending the right combination of keys (<code>Alt</code>+<code>F</code>, <code>O</code>), the code expects
that the window containing the <code>Button</code> will pop up.  Then it uses
<code>FindWindowLike()</code> again, using as a search item the title of the
window containing the button (in this case, <code>here</code>). Remember what I said
about the windows hierarchy?</p>

<p>Next, it ensures that the <code>Button</code> window has the focus, although this is not
entirely necessary at this point.  After bringing the window to the front, the code
searches for a button in the window (I already know that there's only one
button there).</p>

<pre><code>@button = FindWindowLike( $window[0], &quot;&quot;, &quot;Button&quot; );</code></pre>

<p>This narrows down the search: &quot;Search for a window of the class
<code>Button</code> under the window that has the ID <code>$window[0]</code>,&quot;
the window having the ID in <code>$window[0]</code> having been previously found by
its title.</p>

<pre><code>PushChildButton( $window[0], $button[0], 0.25 );</code></pre>

<p>is here just for the power of example, as it doesn't work for the Tk button.
It would work for a native Win32 button.</p>

<p>The trick is that the code can still push it using the mouse! Having the
button ID, as returned by <code>FindWindowLike()</code>, the code calls the
<code>click_on_the_middle_of_window</code> function.</p>

<pre><code>sub click_on_the_middle_of_window {
    my $window = shift;
 
    print &quot;* Moving the mouse over the window id: $window\n&quot;;
 
    my ( $left, $top, $right, $bottom ) = GetWindowRect($window);
 
    MouseMoveAbsPix( ( $right + $left ) / 2, ( $top + $bottom ) / 2 );
 
    sleep(1);
 
    print &quot;* Left Clicking on the window id: $window\n&quot;;
    SendMouse(&quot;{LeftClick}&quot;);
    sleep(1);
}</code></pre>

<p>The function takes a window ID as its parameter, searches its rectangle
using <code>GetWindowRect()</code>, and then moves the mouse pointer right in the
middle of it with <code>MouseMoveAbsPix()</code>.</p>

<p>With the pointer over the button, sending <code>LeftClick</code> presses the
button.</p>

<h3>Moving Around with the Mouse</h3>

<p>As seen earlier, moving the mouse is straightforward: just use
<code>MouseMoveAbsPix()</code>. It takes as parameters the coordinates where
you want the pointer to be (horizontal and vertical positions) in pixels.</p>

<p>It is useful to use other two functions in conjunction:
<code>SendMouse()</code> and <code>GetWindowRect()</code>.</p>

<p><code>SendMouse</code> sends a mouse action to the <code>Desktop</code>. It takes only
one parameter: a mouse action such as <code>{LeftDown}</code>,
<code>{LeftUp}</code>, or <code>{LeftClick}</code>. For more details, see the
function's documentation.</p>

<p>You can also move the mouse wheel using <code>MouseMoveWheel()</code>. It
takes a positive or a negative argument, indicating the direction of the
motion.</p>

<p>To send an action, you need to know where we send it. Usually you will move
the mouse pointer over a window. <code>GetWindowRect()</code> is useful to find the
coordinates of a window.</p>

<p>It can be simpler to create a wrapper around these three functions in order
to move the mouse pointer over a selected window, and then generate a mouse action, as I did
with <code>click_on_the_middle_of_window()</code>.</p>

<h3>Further Reading</h3>

<p>Here are some links you may find useful.</p>

<ul>

<li><a href="http://search.cpan.org/perldoc?Win32::GuiTest">Win32::GuiTest
documentation</a></li>

<li><a
href="http://search.cpan.org/perldoc?Win32::GuiTest::Examples">Win32::GuiTest::Examples</a></li>

<li>The <a href="http://groups.yahoo.com/group/perlguitest/">PerlGuiTest group</a>
on Yahoo; this is quite an active group.</li>

<li><a
href="http://www.piotrkaluski.com/files/winguitest/docs/index.html">Win32::GuiTest
extended tutorial</a></li>

</ul>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-822" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/08/p6pdigest/20050804.html" rel="bookmark">This Week in Perl 6, through August 2, 2005</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2005-08-08T00:00:00-08:00">August  8, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>In case you were wondering, Darwin ports didn't work its magic and I still
don't have a working Haskell compiler. Thank Juerd for feather, even if I did
have to turn my laptop upside down to read the MOTD. Rot-180: oN hes +snf</p>

<h3>This week in <em>perl6-compiler</em></h3>

<p>There were 12 messages in the compiler list this week. Either everyone has
decamped to IRC or OSCON, or the compiler's getting mature enough that most of
the interesting discussion about it happens in <em>perl6-language</em> as Autrijus and
others seek clarification.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050728205921.GA61292@aut.dyndns.org">Some
Thoughts on PIL/Complete Type Inferencing</a></h4>

<p>Autrijus has been doing some thinking on the next version of PIL (The Pugs
Intermediate Language), which will be a little less tightly coupled with
PIR/Parrot. He outlined his thinking (which he seems to have directed towards
being able to do useful things and optimizations with Type information) in this
thread.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050730224910.GB5372@aut.dyndns.org">Definition
of Containers</a></h4>

<p>Autrijus announced that he'd checked in the first part of the new PIL run
core. In case you were wondering, containers are the things that Perl variables
have as values. They're where things like <code>tie</code> magic happens.</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050731180628.GC15882@aut.dyndns.org">Hoisting
Variable Declarations</a></h4>

<p>Hands up! How does the scoping of</p>

<pre><code> 
   $x = $x + my $x if $x;
   #1   #2      #3    #4
}</code></pre>

<p>work in Perl 6?</p>

<p>In Perl 5, all those <code>$x</code>s refer to the same thing. In Perl 6, #1
and #2 refer to <code>$OUTER::x</code>.</p>

<p>This behavior (lexical scopes really are lexical) makes a compiler writer's
head hurt. Autrijus outlined a plan for making it work.</p>

<h3>Meanwhile, in <em>perl6-internals</em></h3>

<h4><a
href="http://groups-beta.google.com/group/perl.perl6.internals/browse_frm/thread/d69e4b22417d1c7/4ed1469ec095319d">Dominance
Frontier</a></h4>

<p>Curtis Rawls had posted a patch adding &quot;dominance frontiers&quot; to IMCC.  (I'm
afraid I don't know what a dominance frontier is, but it sounds like it might
be fun.) This week, he wondered if someone could apply it any time soon, because
he had another patch that depended on it.</p>

<p>It turned out that the patch broke a test or two, and Will Coleda, Andy
Dougherty, Patrick, and Leo set about helping to track it down. It looks like
they have found the issues, and work continues to fix them.</p>

<h4> <code>make languages</code> Should Continue After Building a Language <a
href="http://groups.google.com/groups?threadm=rt-3.0.11-36647-118350.14.1074362091832@perl.org">Failed
</a></h4> 
<p>Have you ever looked through the Parrot Makefiles and wondered
what the deal is with <code>.dummy</code>? If so, this thread explains
everything.</p>

<h4><a
href="http://groups.google.com/groups?threadm=42E7E7EC.1040907@home.nl">PMC
Syntax</a></h4>

<p>Klaas-Jan Stol asked if there's any documentation on the complete syntax
for <em>.pmc</em> files when writing PMCs. Apparently there isn't, apart from
the source of <em>pmc2c.pl</em>, but Will Coleda and Leo helped Klaas-Jan
out.</p>

<h4><a
href="http://groups.google.com/groups?threadm=42E838DC.9080804@web.de">Embedding
ParTcl</a></h4>

<p>Thilo Planz had some problems embedding ParTcl into a PIR application.  It
mostly worked, but he had a few questions. Will Coleda helped out again.</p>

<h4><a
href="http://groups.google.com/groups?threadm=42E8A3A2.5010100@home.nl">Compiling
Dynamic PMCs</a></h4>

<p>Klaas-Jan had more questions about compiling PMCs--dynamic ones, this time.
It appears that the docs he was following didn't quite reflect reality. Leo
solved the problem and Klaas-Jan sent in a doc patch.  Hurrah!</p>

<h4><a
href="http://groups.google.com/groups?threadm=rt-3.0.11-36677-118403.17.3306028943918@perl.org">Parrot
Cannot Start up if <code>STDERR</code> or <code>STDOUT</code> is Closed</a></h4>

<p>Michael Schwern pointed out that Parrot won't start if you close either
<code>STDOUT</code> or <code>STDERR</code>, eschewing the standard joke response (&quot;Doctor, it hurts when
I do this.&quot; &quot;Well don't do that, then.&quot;) Jerry Gay wrote a test and Leo fixed
it.</p>

<h4><a
href="http://groups.google.com/groups?threadm=42E9EAF7.1050509@home.nl">Accessing
Hash with Strings/Keys</a></h4>

<p>Apparently, Klaas-Jan is working on writing a Lua compiler to target Parrot.
He's obviously working on it a good deal at the moment. :)</p>

<p>He wanted to know how he could extend the standard Hash PMC to return
<code>None</code> if there is no key found. As is traditional in these cases,
Leo helped him out. It turns out that part of the problem is that
<em>pmc2c.pl</em> isn't that strict in its syntax checking. If anyone reading
this has the tuits ...</p>

<h4><a
href="http://groups.google.com/groups?threadm=20050729165847.70341.qmail@web51110.mail.yahoo.com">Does
It Cost Anything to Use a Big PMC Everywhere?</a></h4>

<p>In a move guaranteed to gladden at least Dan Sugalski's heart, Amir Karger
popped up to say that he's working getting the Z-machine interpreter working.
He wondered if there was any way of dedicating a register to a particular
constant in order to avoid copying a global every time he called a sub. Leo
helped out.</p>

<h4><a
href="http://groups.google.com/groups?threadm=42ECDE37.2010308@toetsch.at">Super!
</a></h4>

<p>Leo announced that he'd added a new <code>Super</code> PMC which will make
it easier to call superclass methods.</p>

<h4><a
href="http://groups.google.com/groups?threadm=42EF7E8F.9010304@home.nl">Lua
Project</a></h4>

<p>Klaas-Jan unveiled his project to get the <a
href="http://members.home.nl/joeijoei/parrot">Lua compiler targeting
Parrot</a>.  It's apparently &quot;far from complete,&quot; but hey, it's good to welcome
yet another language to the Parrot cage.</p>

<h4><a
href="http://groups.google.com/groups?threadm=Pine.LNX.4.44.0508021908110.3368-100000@booger.sixgeeks.org">Announcing
<code>mod_parrot</code> 0.3</a></h4>

<p>Jeff Horwitz announced the release of <a
href="http://www.smashing.org/mod_parrot"><code>mod_parrot</code> 0.3</a>, complete with
support for all Apache hooks, autogeneration of <code>request_rec</code>
methods, and a <code>mod_pugs</code> proof of concept. Crumbs. And there's more. Check out
the announcement, download the code, and start making Apache do weird things. Go
on, you know you want to.</p>













<h3>Meanwhile, in <em>perl6-language</em></h3>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg20981.html">The
Use and Abuse of Liskov</a></h4>

<p>Damian and Luke's discussion of the right way to do MMD looks to be finally
winding down. It seems Luke's convinced Damian of the righteousness of his
cause. (Or at least, if he's wrong, he's wrong in a subtler way than Damian
realized.) I don't think there's been a final decision as yet, but we're
definitely moving forward.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21085.html">Slurpy
Parameters and Auto-Flattening</a></h4>

<p>Ingo Blechschmidt asked for some clarification of the behavior of slurpy
parameters. It's not often I hope that Luke is wrong, but I really hope the
answer he gave Ingo isn't the true state of things.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21067.html">Exposing
the Garbage Collector</a></h4>

<p>Bah! I propose a simple, slow, yet powerful feature that is useful to
implement a whole bunch of other possible APIs for getting at stuff, and people
go and suggest making any one of various heavier APIs the One True API. It's
enough to make a person despair.</p>

<p>Ah, apologies, I'm letting personal concerns get in the way of the
summary, but what the hell, I'm leaving it.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21092.html">Messing
with the Type Hierarchy</a></h4>

<p>Luke had a few things to say about what happens when you monkey with the
type hierarchy, so he said them. The usual suspects joined in, most of them
addressing the particular instance that Luke had chosen to illustrate his
point, rather than discussing the broader point, but hey, this is
<em>perl6-language</em>.  That's what happens.</p>

<p>Luke's broader question was, &quot;Should it be possible to write a class that
isn't a leaf in the existing hierarchy?&quot; The example that everyone addressed
was the idea of writing a <code>Complex</code> class that wedged in between
<code>Real</code> and <code>Num</code> in the hierarchy (which, as several
people pointed out, isn't necessarily the right way to think about it anyway,
hence the discussion).</p>

<p>My gut feeling was that the answer to the general question should be &quot;Yes,
but be very, very careful, and don't be surprise if it bites you later.&quot;</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21094.html">Elimination
of <code>Item|Pair</code> and <code>Any|Junction</code></a></h4>

<p>The discussion of appropriate default prototypes and the like continued.
Autrijus proposed a way of rejigging the type hierarchy to make default
argument types a little clearer. I found things getting a little weird, to be
honest--there's even talk of eliminating <code>Object</code> as a type name,
which seems a little strange.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21098.html">Execution
Platform Object? Gestalt? </a></h4>

<p>Randal proposed that, as the number of possible platforms that Perl 6 can
run on proliferates, it'd be really handy if there were some useful global that
held knowledge about the platform and its capabilities. He proposed
<code>$*OS</code> as a decent place to put it. Larry thought we probably would
have something like that, but thought that there might end up being two
globals: <code>$*OS</code> and <code>$*VM</code>. The usual &quot;Why don't we call
it&quot; thread sprang up, but it seems that the most important upshot is that
this particular bike shed will definitely be painted.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21114.html">The
Meaning of <code>returns</code></a></h4>

<p>The continuing invasion by the rampaging hordes from <em>p6c</em> continued apace.
This time, Autrijus had a discussion on the implications of <code>returns</code>
and its implications for type inferencing.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21121.html">Lazy
List Syntax</a></h4>

<p>Flavio S. Glock wondered how to go about creating a lazy list from an
object. Apparently the magic he was missing was <code>prefix:=</code>, which is
syntactic sugar for calling the <code>.next</code> method on anything that
supports iteration, which is nice.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21121.html">An
Idea for Doing <code>pack</code></a></h4>

<p>David Formosa had an idea about a possible <code>pack</code> API; he
outlined it on the list. Yuval Kogman seemed to like it, but there's been
nothing from anyone else on the list.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21124.html">Inferring
<code>(Foo of Int).does(Foo of Any)</code></a></h4>

<p>Autrijus again, this time thinking about the kind of type inferences that
Perl aggregate types allow. Once I had my head in the right space, it made a
great deal of sense, even if:</p>

<pre><code>Array of Item).does(Array of Int); # false
Array of Int).does(Array of Item); # also false!</code></pre>

<p>made my head hurt the first time I read it.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21081.html">Garbage
Collector API</a></h4>

<p>Various people proposed additions to the proposed Garbage Collector API.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21140.html"><code>$value.confess()</code></a></h4>

<p>Brent Royal-Gordon had a cunning idea for debugging: having Perl 6 capture
the call stack at its point of creation and stashing that in a property
called <code>confess</code>, which he could examine in a debugging context to
find out where a value came from. As he pointed out, this would be expensive,
but useful. He's currently Warnocked, but I get the feeling it should be
possible to write an extension to do what he wants without adding anything
extra to Perl 6 itself. It might be a little tricky if he wants the call stack
to change on mutation, though.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21148.html">Slurpy
<code>is rw</code> Arrays</a></h4>

<p>Having received clarification of the behavior of normal slurpy arrays, Ingo
Blechschmidt asked for clarification of the behavior of Slurp <code>is
rw</code> arrays. Adriano Ferreira and Thomas Sandla&szlig; seemed to talk
sense in reply.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21154.html">Curious
Use of <code>.assuming</code> in S06</a></h4>

<p>Autrijus wondered if code like:</p>

<pre><code>&amp;textfrom := &amp;substr.assuming(:str($text) :len(Inf))</code></pre>

<p>found in Synopsis 6 was a mistake, or if the syntax should be like that. It
turns out that the syntax is supposed to be like that.  Apparently being able
to do without the commas was one of the reasons for making colon pair syntax
look like that.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21158.html">Laziness
and IO</a></h4>

<p>In a currently Warnocked post, David Formosa outlined a potential problem
with lazy IO.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21159.html"><code>sub
foo ($x) returns ref($x)</code></a></h4>

<p>In his continuing discussion of the Perl 6 type system and the inferences
that you can draw about it, Autrijus posted a discussion of how to declare that
a function that returns a value with the same type as its argument. He
suggested that the best way forward would be to declare something like:</p>

<pre><code>sub identity ($x) returns ref($x) { ... }</code></pre>

<p>and asked for better suggestions. Thomas Sandla&szlig; had suggestions.</p>













<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21160.html"><code>&amp;say</code>'s
Return Value</a></h4>

<p>Gaal Yahas thought that <code>&amp;print</code> and <code>&amp;say</code>
should <code>fail</code> on errors and return the printed string on success
(but true). Larry thought not.  It looks like they'll end up returning a
Boolean or throwing an exception.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21161.html"><code>$arrayref.ref</code></a></h4>

<p>Ingo continues his ongoing task of getting clarification of the semantics of
a whole host of things. This time he wanted to know about the behavior of
references. Larry clarified.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21162.html">Binding
Scalars to Aggregates</a></h4>

<p>Next up in Ingo's clarification project was binding scalars to aggregates.
(Or did he mean binding aggregates to scalars?) Again, Larry came through with
answers. It turns out that there's more to this than meets the eye at first
glance. Autrijus's post on containers over in <em>perl6-compiler</em> addresses some of
these issues, as well.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21163.html">Binding
Hashes to Arrays? </a></h4>

<p>Ingo asks, &quot;Is it legal to bind a hash to an array, or vice versa?&quot;</p>

<p>Larry answers, &quot;Not at the moment.&quot;</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21175.html">Module
Init Hooks and Pragmas</a></h4>

<p>Gaal Yahas wondered what function in a module to call when you
<code>use</code> or <code>no</code> it.</p>

<p>Warnock applies.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21178.html">Eliminating
<code>&amp;{}</code> and <code>*{}</code></a></h4>

<p>Autrijus wondered if we really need the <code>&amp;</code> sigil. Warnock
applies.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21179.html">Stringification
of Pairs</a></h4>

<p>For some reason, Ingo's shortest question (&quot;How do pairs stringify?&quot;)
attracted the largest response. Well, at first blush it looks like it did.
What actually happened was that Warnock claimed it, but the
<code>References:</code> header in Andrew Shitov's posed discussed below was a
little broken.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21182.html"><code>zip</code>
with ()</a></h4>

<p>Some strange behavior of <code>zip</code> caught out Andrew Shitov. Ingo
explained the problem. There was quite a bit of discussion of the various
subtleties exposed.</p>

<p>Sometimes I pity the poor swine who's going to have to write <em>Programming
Perl 6</em>. It's going to make the current camel look like a slim volume, if we're
not careful.</p>

<h4><a
href="http://www.mail-archive.com/perl6-language%40perl.org/msg21185.html">Mutating
<code>map</code> and <code>grep</code></a></h4>

<p>Ingo Blechschmidt wondered if it was true that Perl 6's <code>grep</code>,
<code>map</code>, etc., wouldn't allow mutating values in their source array. He
wondered if it would be possible to use a pragma to get the old, Perl-5-ish,
behavior back. Thomas Sandla&szlig; wondered if simply explicitly declaring
the given block's argument as <code>rw</code> wouldn't do the job. There is no
word from @Larry yet.</p>

<h4>
Acknowledgements, Adverts, Apologies, Alliteration, and Conference
Envy
</h4>

<p>Damn. Couldn't think of a word beginning with &quot;a&quot; that means &quot;conference.&quot;
[<em>Editor's note: attendance?</em>] To all you lucky people in Portland at
OSCON, I wish I was there and am a seething mass of envy. Well, not that
seething: I'm consoling myself by going to the WorldCon in Glasgow, instead.</p>

<h4>
Help Chip
</h4>

<p><a href="http://geeksunite.org/">geeksunite.org</a>: tell all your friends; this cannot stand.</p>

<h3>The Usual Footer</h3>

<p>If you find these summaries useful or enjoyable, please consider
contributing to the Perl Foundation to help support the development of
Perl.</p>

<ul>

<li><a href="http://donate.perl-foundation.org/">The Perl Foundation</a></li>
<li><a href="http://dev.perl.org/perl6/">Perl 6 development site</a></li>

</ul>

<p>Or, you can check out <a href="http://www.bofh.org.uk/">my website</a>, now
running on a new engine.  There are also <a
href="http://www.flickr.com/photos/pdcawley">vaguely pretty photos by
me</a>.</p>

<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/1796" template="b/article_sidebar2.view">
<!-- sidebar ends -->



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-812" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2005/08/04/3d_engine.html" rel="bookmark">Building a 3D Engine in Perl, Part 4</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Geoff Broadwell</span> on <abbr class="published" title="2005-08-04T00:00:00-08:00">August  4, 2005 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->
<br clear="all" />
<p>This article is the fourth in a series aimed at <a
href="/pub/au/Broadwell_Geoff">building a full 3D engine in Perl</a>. The <a
href="/pub/a/2004/12/01/3d_engine.html">first article</a> started with basic
program structure and worked up to displaying a simple depth-buffered scene in
an OpenGL window. The <a href="/pub/a/2004/12/29/3d_engine.html">second
article</a> followed with a discussion of time, view animation, SDL events,
keyboard handling, and a nice chunk of refactoring. The <a
href="/pub/a/2005/02/17/3d_engine.html">third article</a> continued with
screenshots, movement of the viewpoint, simple OpenGL lighting, and subdivided
box faces.</p>

<p>At the end of the last article, the engine was quite slow. This article shows
how to locate the performance problem and what to do about it. Then it
demonstrates how to apply the same new OpenGL technique a different way to
create an on-screen frame rate counter. As usual, you can follow along with the
code by downloading the <a href="/2005/08/04/examples/perl_opengl_examples_4.tar.gz">sample
code</a>.</p>

<h3>SDL_perl Developments</h3>

<p>First, there is some good news--Win32 users are no longer left out in the
cold. Thanks to Wayne Keenan, SDL_perl 1.x now fully supports OpenGL on Win32,
and prebuilt binaries are available. There are more details at the new <a
href="http://www.broadwell.org/graphics/sdl-perl/">SDL_perl 1.x page</a> on my
site; browse the Subversion repository at <a
href="http://svn.openfoundry.org/sdlperl1/">svn.openfoundry.org/sdlperl1</a>.</p>
<!-- sidebar begins -->
 <csperl file="grab" domain="on" record="b/911" template="b/article_sidebar.view">
<!-- sidebar ends -->
<p>If you'd like to help in the efforts to improve SDL_perl 1.x, please come
visit the <a href="http://www.broadwell.org/graphics/sdl-perl/">SDL_perl 1.x
page</a>, check out the <a href="http://svn.openfoundry.org/sdlperl1/">code</a>
and send me comments or patches, or ping me in <code>#sdlperl</code> on
<code>irc.freenode.net</code>.</p>

<h3>Benchmarking the Engine</h3>

<p>As I mentioned in the introduction, when last I left off, the engine pretty
much crawled. It's time to figure out why and figure out what to do about it.
The right tool for the first job is a <em>profiler</em>, which watches a
running program and keeps track of the performance of each part of it. Perl's native
profiler is <code>dprofpp</code>, which tracks time spent and call count for
every subroutine in the program. Examining these numbers will reveal if the
engine spends most of its time in one routine, which will then be the focus for
optimization.</p>

<p>It's best if these numbers are relatively repeatable from run to run, making
it easy to compare profiles before and after a change. For a rendering engine,
the easiest solution is a benchmark mode. In benchmark mode, the engine runs for
a set period of time or number of frames, displaying a predefined scene or
sequence. I chose to enable benchmark mode with a new setting in
<code>init_conf</code>:</p>

<pre><code>benchmark =&gt; 1,</code></pre>

<p>The engine already displays a constant scene as long as the user doesn't
press any keys; the remaining requirement is to quit after a set period.</p>

<p>In previous articles I've simply hardcoded an out-of-time check into the
rendering loop, but this time I opted for a more general approach, using
<em>triggered events</em>.  Engine events so far have always come from SDL in
response to external input, such as key presses and window close events. In
contrast, the engine itself produces triggered events in response to changes in
the state of the simulated world, such as a player attempting to open a door or
attack an enemy.</p>

<p>To gather these events, I added two new lines to the beginning of
<code>do_events</code>; the opening lines are now:</p>

<pre><code>sub do_events
{
    my $self = shift;

    my $queue     = $self-&gt;process_events;
    my $triggered = $self-&gt;triggered_events;
    push @$queue, @$triggered;</code></pre>

<p>After processing the SDL events with <code>process_events</code> and
stuffing the resulting commands into the <code>$queue</code>,
<code>do_events</code> calls <code>triggered_events</code> to gather commands
from any pending internally generated events and adds them to the
<code>$queue</code>.  <code>triggered_events</code> can be pretty simple for
now:</p>

<pre><code>sub triggered_events
{
    my $self = shift;

    my @queue;
    push @queue, 'quit' if $self-&gt;{conf}{benchmark} and
                           $self-&gt;{world}{time} &gt;= 5;
    return \@queue;
}</code></pre>

<p>This is pretty much a direct translation of the old hardcoded timeout code
to the command queue concept. Normally <code>triggered_events</code> simply
returns an empty arrayref, indicating no events were triggered, and therefore
no commands generated. Benchmark mode adds a quit command to the queue as soon
as the world time reaches 5 seconds. Normal command processing in
<code>do_events</code> will take care of the rest.</p>













<h3><code>dprofpp</code> is Your (Obtuse) Friend</h3>

<p>With benchmark mode enabled, the engine runs under <code>dprofpp</code>. The
first step is to collect the profile data:</p>

<pre><code>dprofpp -Q -p step065</code></pre>

<p><code>-p step065</code> tells <code>dprofpp</code> to <em>p</em>rofile the
program named <code>step065</code>, and <code>-Q</code> tells it to
<em>q</em>uit after collecting the data.  <code>dprofpp</code> ran
<code>step065</code>, collected the profile data, and stored it in a
specially formatted text file named
<em>tmon.out</em> in the current directory.</p>

<p>To turn the profile data into human-readable output, I used
<code>dprofpp</code> without any arguments. It crunched the collected data for
a while and finally produced this:</p>

<pre><code>$ dprofpp
Exporter::Heavy::heavy_export_to_level has 4 unstacked calls in outer
Exporter::export_to_level has -4 unstacked calls in outer
Exporter::export has -12 unstacked calls in outer
Exporter::Heavy::heavy_export has 12 unstacked calls in outer
Total Elapsed Time = 4.838377 Seconds
  User+System Time = 1.498377 Seconds
Exclusive Times
%Time ExclSec CumulS #Calls sec/call Csec/c  Name
 88.1   1.320  1.320      1   1.3200 1.3200  SDL::SetVideoMode
 38.1   0.571  0.774    294   0.0019 0.0026  main::draw_quad_face
 16.0   0.240  0.341      8   0.0300 0.0426  SDL::OpenGL::BEGIN
 13.0   0.195  0.195  64722   0.0000 0.0000  SDL::OpenGL::Vertex
 11.3   0.170  0.170      1   0.1700 0.1700  DynaLoader::dl_load_file
 9.34   0.140  0.020     12   0.0116 0.0017  Exporter::export
 6.67   0.100  0.100   1001   0.0001 0.0001  SDL::in
 4.00   0.060  0.060      1   0.0600 0.0600  SDL::Init
 3.34   0.050  0.847      8   0.0062 0.1059  main::BEGIN
 2.00   0.030  0.040      5   0.0060 0.0080  SDL::Event::BEGIN
 1.80   0.027  0.801     49   0.0005 0.0163  main::draw_cube
 1.47   0.022  0.022   2947   0.0000 0.0000  SDL::OpenGL::End
 1.33   0.020  0.020      1   0.0200 0.0200  warnings::BEGIN
 1.33   0.020  0.020     16   0.0012 0.0012  Exporter::as_heavy
 1.33   0.020  0.209      5   0.0040 0.0418  SDL::BEGIN</code></pre>

<p>There are several problems with this output. The numbers are clearly silly
(88 percent of its time spent in <code>SDL::SetVideoMode</code>?), the statistics for
the various <code>BEGIN</code> blocks are inconsequential to the task and in
the way, and the error messages at the top are rather disconcerting. To fix
these issues, <code>dprofpp</code> has the <code>-g</code> option, which tells
<code>dprofpp</code> to only display statistics for a particular routine and
its descendants:</p>

<pre><code>$ dprofpp -g main::main_loop
Total Elapsed Time = 4.952042 Seconds
  User+System Time = 0.812051 Seconds
Exclusive Times
%Time ExclSec CumulS #Calls sec/call Csec/c  Name
 70.3   0.571  0.774    294   0.0019 0.0026  main::draw_quad_face
 24.0   0.195  0.195  64722   0.0000 0.0000  SDL::OpenGL::Vertex
 3.32   0.027  0.801     49   0.0005 0.0163  main::draw_cube
 2.71   0.022  0.022   2947   0.0000 0.0000  SDL::OpenGL::End
 1.23   0.010  0.010     49   0.0002 0.0002  SDL::OpenGL::Rotate
 1.11   0.009  0.009      7   0.0013 0.0013  main::prep_frame
 1.11   0.009  0.009     70   0.0001 0.0001  SDL::OpenGL::Color
 0.25   0.002  0.002   2947   0.0000 0.0000  SDL::OpenGL::Begin
 0.00       - -0.000      1        -      -  main::action_quit
 0.00       - -0.000      2        -      -  SDL::EventType
 0.00       - -0.000      2        -      -  SDL::Event::type
 0.00       - -0.000      7        -      -  SDL::GetTicks
 0.00       - -0.000      7        -      -  SDL::OpenGL::Clear
 0.00       - -0.000      7        -      -  SDL::OpenGL::GL_NORMALIZE
 0.00       - -0.000      7        -      -  SDL::OpenGL::GL_SPOT_EXPONENT</code></pre>

<p>You may have noticed that I specified <code>main::main_loop</code> instead
of just <code>main_loop</code>.  <code>dprofpp</code> always uses
fully qualified names and will give empty results if you use
<code>main_loop</code> without the <code>main::</code> package qualifier.</p>

<p>In this exclusive times view, the percentages in the first column and the
row order depend only on the runtime of each routine, without respect to its
children. Using just this view, I might have tried to optimize
<code>draw_quad_face</code> somehow, as it appears to be the most expensive
routine by a large margin.  That's not the best approach, however, as an
inclusive view (<code>-I</code>) shows:</p>

<pre><code>$ dprofpp -I -g main::main_loop
Total Elapsed Time = 4.952042 Seconds
  User+System Time = 0.812051 Seconds
Inclusive Times
%Time ExclSec CumulS #Calls sec/call Csec/c  Name
 100.       -  0.814      7        - 0.1163  main::do_frame
 99.9       -  0.812      1        - 0.8121  main::main_loop
 99.7       -  0.810      7        - 0.1158  main::draw_view
 99.2       -  0.806      7        - 0.1151  main::draw_frame
 98.6   0.027  0.801     49   0.0005 0.0163  main::draw_cube
 95.3   0.571  0.774    294   0.0019 0.0026  main::draw_quad_face
 24.0   0.195  0.195  64722   0.0000 0.0000  SDL::OpenGL::Vertex
 2.71   0.022  0.022   2947   0.0000 0.0000  SDL::OpenGL::End
 1.23   0.010  0.010     49   0.0002 0.0002  SDL::OpenGL::Rotate
 1.11   0.009  0.009     70   0.0001 0.0001  SDL::OpenGL::Color
 1.11   0.009  0.009      7   0.0013 0.0013  main::prep_frame
 0.25   0.002  0.002   2947   0.0000 0.0000  SDL::OpenGL::Begin
 0.00       - -0.000      1        -      -  main::action_quit
 0.00       - -0.000      2        -      -  SDL::EventType
 0.00       - -0.000      2        -      -  SDL::Event::type</code></pre>

<p>In this view, <code>draw_quad_face</code> looks even worse, because the first
column now includes the time taken by all of the OpenGL calls inside of it,
including tens of thousands of <code>glVertex</code> calls. It seems that I
should do something to speed it up, but at this point it's not entirely clear
how to simplify it or reduce the number of OpenGL calls it makes (other than
reducing the subdivision level of each face, which would reduce rendering
quality).</p>

<p>Actually, there's a better option. The real problem is that
<code>draw_cube</code> dominates the execution time, and
<code>draw_quad_face</code> dominates that. How about not calling
<code>draw_cube</code> (and therefore <code>draw_quad_face</code>) <em>at
all</em> during normal rendering? It seems extremely wasteful to have to tell
OpenGL how to render a cube face dozens of times each frame. If only there were
a way to tell OpenGL to remember the cube definition once, and just refer to
that definition each time the engine needs to draw it.</p>













<h3>Display Lists</h3>

<p>I expect no one will find it surprising that OpenGL provides exactly this
function, with the <em>display lists</em> facility. A display list is a list of
OpenGL commands to execute to perform some function. The OpenGL driver stores
it (sometimes in a mildly optimized format) and further code refers to it by
number. Later, the program can request that OpenGL run the commands in some
particular list as many times as desired. Lists can even call other lists; a
bicycle model might call a wheel display list twice, and the wheel display list
might itself call a spoke display list dozens of times.</p>

<p>I added <code>init_models</code> to create display lists for each shape I
want to model:</p>

<pre><code>sub init_models
{
    my $self = shift;

    my %models = (
        cube =&gt; \&amp;draw_cube,
    );
    my $count  = keys %models;
    my $base   = glGenLists($count);
    my %display_lists;

    foreach my $model (keys %models) {
        glNewList($base, GL_COMPILE);
        $models{$model}-&gt;();
        glEndList;

        $display_lists{$model} = $base++;
    }

    $self-&gt;{models}{dls} = \%display_lists;
}</code></pre>

<p><code>%models</code> associates each model with the code needed to draw it.
Because the engine already knows how to draw a cube, I simply reused
<code>draw_cube</code> here. The next two lines begin the work of building the
display lists. The code first determines how many display lists it needs and
then calls <code>glGenLists</code> to allocate them. OpenGL numbers the
allocated lists in sequence, returning the first number in the sequence (the
<em>list base</em>). For example, if the code had requested four lists, OpenGL
might have numbered them 1051, 1052, 1053, and 1054, and would then return 1051
as the list base.</p>

<p>For each defined model, <code>init_models</code> calls
<code>glNewList</code> to tell OpenGL that it is ready to compile a new display
list at the number <code>$base</code>. OpenGL then prepares to convert any
subsequent OpenGL calls to entries in the list, rather than rendering them
immediately. If I had chosen <code>GL_COMPILE_AND_EXECUTE</code> instead of
<code>GL_COMPILE</code>, OpenGL would perform the rendering and save the calls
in the display list at the same time. <code>GL_COMPILE_AND_EXECUTE</code> is
useful for on-the-fly caching when code needs active rendering anyway. Because
<code>init_models</code> is simply precaching the rendering commands and
nothing should render while this occurs, <code>GL_COMPILE</code> is the better
choice.</p>

<p>The code then calls the drawing routine, which conveniently submits all of
the OpenGL calls needed for the new list. The call to <code>glEndList</code>
then tells OpenGL to stop recording entries in the display list and return to
normal operation. The model loop then records the display list number used by
the current model in the <code>%display_lists</code> hash, and increments
<code>$base</code> for the next iteration. After processing all of the models,
<code>init_models</code> saves <code>%display_lists</code> into a new structure
in the engine object.</p>

<p><code>init</code> calls <code>init_models</code> just before
<code>init_objects</code>:</p>

<pre><code>$self-&gt;init_models;
$self-&gt;init_objects;</code></pre>

<p>With this initialization in place, the next step was to change
<code>draw_view</code> to draw from either a model or a draw routine. To do
this, I replaced the <code>$o-&gt;{draw}-&gt;()</code> call with:</p>

<pre><code>    if ($o-&gt;{model}) {
        my $dl = $self-&gt;{models}{dls}{$o-&gt;{model}};
        glCallList($dl);
    }
    else {
        $o-&gt;{draw}-&gt;();
    }</code></pre>

<p>If the object has an associated model, <code>draw_view</code> looks up the
display list in the hash created by <code>init_models</code>, and then calls
the list using <code>glCallList</code>. Otherwise, <code>draw_view</code> falls
back to calling the object's draw routine as before. A quick run confirmed that
the fallback works and adding <code>init_models</code> didn't break anything,
so it was safe to change <code>init_objects</code> to use models instead of
draw routines for the cubes. This involved replacement of just three lines--I
changed each copy of:</p>

<pre><code>        draw        =&amp; \&amp;draw_cube,</code></pre>

<p>to:</p>

<pre><code>        model       =&amp; 'cube',</code></pre>

<p>Suddenly, the engine was <em>much</em> faster and more responsive. A
<code>dprofpp</code> run confirmed this:</p>

<pre><code>$ dprofpp -Q -p step068

Done.
$ dprofpp -I -g main::main_loop
Total Elapsed Time = 4.053240 Seconds
  User+System Time = 0.973250 Seconds
Inclusive Times
%Time ExclSec CumulS #Calls sec/call Csec/c  Name
 99.9       -  0.973      1        - 0.9733  main::main_loop
 86.5   0.024  0.842    413   0.0001 0.0020  main::do_frame
 58.1   0.203  0.566    413   0.0005 0.0014  main::draw_view
 56.9   0.016  0.554    413   0.0000 0.0013  main::draw_frame
 20.1   0.196  0.196    413   0.0005 0.0005  SDL::GLSwapBuffers
 19.3       -  0.188    413        - 0.0005  SDL::App::sync
 18.4       -  0.180    413        - 0.0004  main::end_frame
 16.7   0.163  0.163   2891   0.0001 0.0001  SDL::OpenGL::CallList
 9.14   0.028  0.089    413   0.0001 0.0002  main::do_events
 8.53   0.035  0.083    413   0.0001 0.0002  main::prep_frame
 6.68   0.008  0.065    413   0.0000 0.0002  main::process_events
 5.03   0.049  0.049   3304   0.0000 0.0000  SDL::OpenGL::GL_LIGHTING
 4.93   0.002  0.048    413   0.0000 0.0001  SDL::Event::pump
 4.73   0.046  0.046    413   0.0001 0.0001  SDL::PumpEvents
 4.11   0.012  0.040    413   0.0000 0.0001  main::update_time</code></pre>

<p>Note that I had to run <code>dprofpp -Q -p</code> again with the new code
before doing the analysis, or <code>dprofpp</code> would have just reused the
old <code>tmon.out</code>.</p>

<p>The first thing to note in this report is that previously the engine only
managed seven frames (calls to <code>do_frame</code>) before timing out, but now
managed 413 in the same time! Secondly, as intended, <code>main_loop</code>
never calls <code>draw_cube</code>, having replaced all such calls with calls
to <code>glCallList</code>. Because of this it is no longer necessary to do
many thousands of low-level OpenGL calls to draw the scene each frame, with the
attendant Perl and XS overhead. Instead, the OpenGL driver handles all of those
calls internally, with minimal overhead.</p>

<p>This has the added advantage that it is now feasible to run the engine on
one computer and display the window on another, as the OpenGL driver on the
displaying computer saves the display lists. Once <code>init_models</code>
compiles the display lists, they are loaded into the display driver, and future
frames require minimal network traffic to handle <code>glCallList</code>.
(Adventurous users running X can do this by logging in locally to the display
computer, <code>ssh</code>ing to the computer that has the engine and SDL_perl
on it, and running the program there. If your <code>ssh</code> has X11
forwarding turned on, your reward should be a local window. And there was much
rejoicing.)</p>













<h3>An FPS Counter</h3>

<p>The measurements that <code>dprofpp</code> performs have enough overhead to
significantly reduce the engine's apparent performance. (Even old hardware can
do better than 80-100 FPS with this simple scene.) The overhead is necessary to
get a detailed analysis, but when it comes time to show off, most users want to
have a nice frame rate display showing the performance of the engine running as
fast as it can.</p>

<p>Making a frame rate display requires the ability to render text in front of
the scene. The necessary pieces of that are:</p>

<ol>

<li>A font containing glyphs for the characters to display (at least 0 through
9).</li>

<li>A font reader to load the font from a file into memory as bitmaps.</li>

<li>A converter from raw bitmaps to a format that OpenGL can
readily display.</li>

<li>A way to render the proper bitmaps for a given string.</li>

<li>A way to calculate the current frame rate.</li>

</ol>

<h4>The Numbers Font</h4>

<p>There are hundreds of freely available fonts, but most of them are available
only in fairly complex font formats such as TrueType and Type 1. Some versions
of SDL_perl support these complex font formats, but this support has
historically been frustratingly buggy or incomplete.</p>

<p>Given the relatively simple requirement (render a single integer), I chose
instead to create a very simple bitmapped font format just for this article.
The font file is <i>numbers-7x11.txt</i> in the examples tarball. It
begins as follows:</p>

<pre><code>7x11

30
..000..
.0...0.
.0...0.
0.....0
0.....0
0.....0
0.....0
0.....0
.0...0.
.0...0.
..000..

31
...0...
..00...
00.0...
...0...
...0...
...0...
...0...
...0...
...0...
...0...
0000000</code></pre>

<p>The first line indicates the size of each character cell in the font; in
this case, seven columns and 11 rows. The remaining chunks each consist of the
character's codepoint in hex followed by a bitmap represented as text--<code>.</code> represents a transparent pixel, and <code>0</code> represents a
rendered pixel. Empty lines separate chunks.</p>

<h4>The Font Reader</h4>

<p>To read the glyph definitions into bitmaps, I first added
<code>read_font_file</code>:</p>

<pre><code>sub read_font_file
{
    my $self = shift;
    my $file = shift;

    open my $defs, '&lt;', $file
        or die &quot;Could not open '$file': $!&quot;;
    local $/ = '';

    my $header  = &lt;$defs&gt;;
    chomp($header);
    my ($w, $h) = split /x/ =&amp; $header;

    my %bitmaps;
    while (my $def = &lt;$defs&gt;) {
        my ($hex, @rows) = grep /\S/ =&amp; split /\n/ =&amp; $def;

        @rows = map {tr/.0/01/; pack 'B*' =&amp; $_} @rows;

        my $bitmap           = join '' =&amp; reverse @rows;
        my $codepoint        = hex $hex;

        $bitmaps{$codepoint} = $bitmap;
    }

    return (\%bitmaps, $w, $h);
}</code></pre>

<p><code>read_font_file</code> begins by opening the font file for reading. It
next requests paragraph slurping mode by setting <code>$/</code> to
<code>''</code>. In this mode, Perl automatically breaks up the font file at
empty lines, with the header first followed by each complete glyph definition
as a single chunk. Next, the routine reads the header, chomps it, and splits the
cell size definition into width and height.</p>

<p>With the preliminaries out of the way, <code>read_font_file</code> creates a
hash to store the finished bitmaps and enters a <code>while</code> loop over
the remaining chunks of the font file. Each glyph definition is split into a
hex number and an array of bitmap rows; using <code>grep /\S/ =&amp;</code>
ignores any trailing blank lines.</p>

<p>The next line converts textual rows to real bitstrings. First, each
transparent pixel (<code>.</code>) becomes <code>0</code>, and each rendered
pixel (<code>0</code>) turns into a <code>1</code>. Feeding the resulting
binary text string to <code>pack 'B*'</code> converts the binary into an actual
bitstring, with the bits packed in starting from the high bit of each byte (as
OpenGL prefers). The resulting bitstrings are stored back in
<code>@rows</code>.</p>

<p>Because OpenGL prefers bitmaps to start at the bottom and go up, the code
reverses <code>@rows</code> before <code>join</code>ing to create the finished
bitmap. The <code>hex</code> operator converts the hex number to decimal to be
the key for the newly created bitmap in the <code>%bitmaps</code> hash.</p>

<p>After parsing the whole font file, the function returns the bitmaps to the
caller, along with the cell size metrics.</p>













<h4>Speaking OpenGL's Language</h4>

<p>The bitmaps produced by <code>read_font_file</code> are simply packed
bitstrings, in this case 11 bytes long (one byte per seven-pixel row). Before using
them to render strings, the engine must first load these bitmaps into OpenGL.
This happens in the main <code>init_fonts</code> routine:</p>

<pre><code>sub init_fonts
{
    my $self  = shift;

    my %fonts = (
        numbers =&amp; 'numbers-7x11.txt',
    );

    glPixelStore(GL_UNPACK_ALIGNMENT, 1);

    foreach my $font (keys %fonts) {
        my ($bitmaps, $w, $h) = 
            $self-&gt;read_font_file($fonts{$font});

        my @cps    = sort {$a &lt;=&amp; $b} keys %$bitmaps;
        my $max_cp = $cps[-1];
        my $base   = glGenLists($max_cp + 1);

        foreach my $codepoint (@cps) {
            glNewList($base + $codepoint, GL_COMPILE);
            glBitmap($w, $h, 0, 0, $w + 2, 0,
                     $bitmaps-&gt;{$codepoint});
            glEndList;
        }

        $self-&gt;{fonts}{$font}{base} = $base;
    }
}</code></pre>

<p><code>init_fonts</code> opens with a hash associating each known font with a
font file; at the moment, only the <code>numbers</code> font is defined. The
real work begins with the <code>glPixelStore</code> call, which tells OpenGL
that the rows for all bitmaps are tightly packed (along one-byte boundaries)
rather than being padded, so that each row begins at even two-, four-, or eight-byte
memory locations.</p>

<p>The main font loop starts by calling <code>read_font_file</code> to load the
bitmaps for the current font into memory. The next line sorts the codepoints
into <code>@cps</code>, and the following line finds the maximum codepoint by
simply taking the last one in <code>@cps</code>.</p>

<p>The <code>glGenLists</code> call allocates display lists for codepoints 0
through <code>$max_cp</code>, which will have numbers from <code>$base</code>
through <code>$base + $max_cp</code>. For each codepoint defined by the font,
the inner loop uses <code>glNewList</code> to start compiling the appropriate
list, <code>glBitmap</code> to load the bitmap into OpenGL, and finally,
<code>glEndList</code> to finish compiling the list.</p>

<p>The <code>glBitmap</code> call has six parameters aside from the bitmap
data itself (<code>$bitmaps-&gt;{$codepoint}</code>).  The first two are the
width and height of the bitmap in pixels, which <code>read_font_file</code>
conveniently provides. The next two define the <em>origin</em> for the bitmap,
counted from the lower-left corner. Bitmap fonts use a non-zero origin for
several purposes, generally when the glyph extends farther left or below the
&quot;normal&quot; lower-left corner. This may be because the glyph has a
<em>descender</em> (a part of the glyph that descends below the general line
of text, as with the lowercase letters &quot;p&quot; and &quot;y&quot;), or perhaps because the font
leans to the left. The simple code in <code>init_fonts</code> assumes none of
these special cases apply and sets the origin to (0,0).</p>

<p>The last two parameters are the X and Y <em>increments</em>, the distances
that OpenGL should move along the X and Y axes before drawing the next
character. Left-to-right languages use fonts with positive X and zero Y
increments; right-to-left languages use negative X and zero Y. Top-to-bottom
languages use zero X and negative Y. The increments must include both the
width/height of the character itself and any additional distance needed to
provide proper spacing. In this case, the rendering will be left to right. I
wanted two extra pixels for spacing, so I set the X increment to width plus
two, and the Y increment to zero.</p>

<p>The last line of the outer loop simply saves the list base for the font to
make it available later during rendering.</p>

<p><code>init</code> calls <code>init_fonts</code> as usual, just after the
call to <code>init_time</code>:</p>

<pre><code>$self-&gt;init_fonts;</code></pre>

<h4>Text Rendering</h4>

<p>The hard part is now done: parsing the font file and loading the bitmaps
into OpenGL. The new <code>draw_fps</code> routine calculates and renders the
frame rate:</p>

<pre><code>sub draw_fps
{
    my $self   = shift;

    my $base   = $self-&gt;{fonts}{numbers}{base};
    my $d_time = $self-&gt;{world}{d_time} || 0.001;
    my $fps    = int(1 / $d_time);

    glColor(1, 1, 1);
    glRasterPos(10, 10, 0);
    glListBase($base);
    glCallListsScalar($fps);
}</code></pre>

<p>The routine starts by retrieving the list base for the <code>numbers</code>
font, retrieving the world time delta for this frame, and calculating the
current frames per second as one frame in <code>$d_time</code> seconds. It takes
a little care to make sure <code>$d_time</code> is non-zero, even if the engine
is running so fast that it renders a frame in less than a millisecond (the
precision of SDL time handling); otherwise, the <code>$fps</code> calculation
would die with a divide-by-zero error.</p>













<p>The OpenGL section begins by setting the current drawing color to white with
a call to <code>glColor</code>. The next line sets the <em>raster
position</em>, the window coordinates at which to place the origin of the next
bitmap. After rendering each bitmap, the raster position is automatically
updated using the bitmap's X and Y increments so that the bitmaps will not
overlap each other. In this case, <code>(10, 10, 0)</code> sets the raster position ten
pixels up and right from the lower-left corner of the window, with <code>Z=0</code>.</p>

<p>The next two lines together actually call the appropriate display list in
our bitmap font for each character in the <code>$fps</code> string.
<code>glCallListsScalar</code> breaks the string into individual characters and
calls the display list with the same number as the codepoint of the character.
For example, for the "5" character (at codepoint 53 decimal),
<code>glCallListsScalar</code> calls display list 53. Unfortunately, there's no
guarantee that display list 53 actually will display a "5," because the font's
list base may not be 0. If the font had a list base of 1500, for example, the
code would need to call display list 1500+53=1553 to display the "5."</p>

<p>Rather than make the programmer do this calculation manually every time,
OpenGL provides the <code>glListBase</code> function, which sets the list base
to use with <code>glCallLists</code>. After the <code>glListBase</code> call
above, OpenGL will automatically offset every display list number specified
with <code>glCallLists</code> by <code>$base</code>.</p>

<p>You may have noticed that in the code I use <code>glCallListsScalar</code>,
but the previous paragraph referred to <code>glCallLists</code> instead.
<code>glCallListsScalar</code> is actually an SDL_perl extension (not part of
core OpenGL) that provides an alternate calling convention for
<code>glCallLists</code> in Perl. Internally, SDL_perl implements both Perl
routines using the same underlying C function in OpenGL
(<code>glCallLists</code>).  SDL_perl provides two different calling
conventions because Perl treats a string and an array of numbers as two
different things, while C treats them as essentially the same.</p>

<p>If you want to render a string, and all of the characters in the string have
codepoints &lt;= 255 decimal (single-byte character sets, and the ASCII subset
of most variable-width character sets), you can use
<code>glCallListsScalar</code>, and it will do the right thing for you:</p>

<pre><code>glCallListsScalar($string);</code></pre>

<p>If you simply want to render several display lists with a single call, and
you're not trying to render a string, use the standard version of
<code>glCallLists</code>:</p>

<pre><code>glCallLists(@lists);</code></pre>

<p>If you need to render a string, but it contains characters above codepoint
255, you have to use a more complex workaround:</p>

<pre><code>glCallLists(map ord($_) =&amp; split // =&amp; $string);</code></pre>

<p>Because the FPS counter merely renders ASCII digits, the first option works
fine.</p>

<p><code>draw_frame</code> now ends with a call to <code>draw_fps</code>, like
so:</p>

<pre><code>sub draw_frame
{
    my $self = shift;

    $self-&gt;set_projection_3d;
    $self-&gt;set_eye_lights;
    $self-&gt;set_view_3d;
    $self-&gt;set_world_lights;
    $self-&gt;draw_view;
    $self-&gt;draw_fps;
}</code></pre>

<p>For now, I decided to turn off benchmark mode by changing the config setting
in <code>init_config</code> to <code>0</code>:</p>

<pre><code>    benchmark =&amp; 0,</code></pre>

<p>With the font handling in place, and <code>draw_fps</code> called each frame
to display the frame rate in white in the lower-left corner, everything should
be grand, as Figure 1 shows.</p>

<p><img src="/pub/2005/08/04/graphics/step070.gif" width="400" height="400" alt="drawing frame rate, take one" /><br
/><em>Figure 1. Drawing the frame rate</em></p>

<p>Oops. There's no frame rate display. Actually, it's there, just
<em>very</em> faint. If you look very carefully (or turn your video card's
gamma up very high), you can just make out the frame rate display near the top
of the window, above the big white box on the right. There are (at least) two
problems--the text is too dark and it's in the wrong place.</p>













<p>The first problem is reminiscent of the dark scene in the <a
href="/pub/a/2005/02/17/3d_engine.html">last article</a>,
after enabling lighting but no lights. Come to think of it, there's not much
reason to have lighting enabled just to display stats, but the last object
rendered by <code>draw_view</code> left it on. To make sure lighting is off, I
added a <code>set_lighting_2d</code> routine, which <code>draw_frame</code> now
calls just before calling <code>draw_fps</code>:</p>

<pre><code>sub set_lighting_2d
{
    glDisable(GL_LIGHTING);
}</code></pre>

<p><img src="/pub/2005/08/04/graphics/step071.gif" width="400" height="400" alt="the unlit frame rate" /><br /><em>Figure 2. The
unlit frame rate</em></p>

<p>Figure 2 is much better! With lighting turned off, the frame rate now
renders in bright white as intended. The next problem is the incorrect
position. Moving and rotating the viewpoint shows that while the digits always
face the screen, their apparent position moves around (Figure 3).</p>

<p><img src="/pub/2005/08/04/graphics/step071a.gif" width="400" height="400" alt="moving frame rate" /><br /><em>Figure 3. A
moving frame rate</em></p>

<p>It turns out that the current modelview and projection matrices transform
the raster position set by <code>glRasterPos</code>, just like the coordinates
from a <code>glVertex</code> call. That means OpenGL reuses whatever state the
modelview and projection matrices are in.</p>

<p>To get unaltered window coordinates, I need to use an orthographic
projection (no foreshortening or other non-linear effects) matching the window
dimensions. I also need to set an identity modelview matrix (so that the
modelview matrix won't transform the coordinates at all). All of this happens in
<code>set_projection_2d</code>, called just before <code>set_lighting_2d</code>
in <code>draw_frame</code>:</p>

<pre><code>sub set_projection_2d
{
    my $self = shift;

    my $w    = $self-&gt;{conf}{width};
    my $h    = $self-&gt;{conf}{height};

    glMatrixMode(GL_PROJECTION);
    glLoadIdentity;
    gluOrtho2D(0, $w, 0, $h);

    glMatrixMode(GL_MODELVIEW);
    glLoadIdentity;
}</code></pre>

<p>This routine first gathers the window width and height from the
configuration hash. It then switches to the projection matrix
(<code>GL_PROJECTION</code>) and restores the identity state before calling
<code>gluOrtho2D</code> to create an orthographic projection matching the
window dimensions. Finally, it switches back to the modelview matrix
(<code>GL_MODELVIEW</code>) and restores its identity state as well. The frame
rate now renders at the intended spot near the lower-left corner (Figure
4).</p>

<p><img src="/pub/2005/08/04/graphics/step072.gif" width="400" height="400" alt="frame rate in the right spot" /><br /><em>Figure
4. The frame rate in the correct position</em></p>

<p>There is another more subtle rendering problem, however, which you can see
by moving the viewpoint forward a bit (Figure 5).</p>

<p><img src="/pub/2005/08/04/graphics/step072a.gif" width="400" height="400" alt="frame rate depth problems" /><br /><em>Figure
5. Frame rate depth problems</em></p>

<p>Notice how the &quot;5&quot; is partially cut off. The problem is that OpenGL compares
the depth of the pixels in the thin yellow box to the depth of the pixels in
the frame rate display, and finds that some of the pixels in the 5 are farther
away than the pixels in the box. In effect, part of the 5 draws <em>inside</em>
the box. In fact, moving the viewpoint slightly to the left from this point
will make the frame rate disappear altogether, hidden by the near face of the
yellow box.</p>

<p>That's not very good behavior from a statistics display that should appear
to hover in front of the scene. The solution is to turn off OpenGL's depth
testing, using a new line at the end of <code>set_projection_2d</code>:</p>

<pre><code>glDisable(GL_DEPTH_TEST);</code></pre>

<p>With this change, you can move the view anywhere without fear that the frame
rate will be cut off or disappear entirely (Figure 6).</p>

<p><img src="/pub/2005/08/04/graphics/step073.gif" width="400" height="400" alt="position-independent frame rate" /><br
/><em>Figure 6. Position-independent frame rate</em></p>













<h3>Too Fast</h3>

<p>There's yet another problem; this time, one that will require a change to the
frame rate calculations. The frame rate shown in the above screenshots is
either 333 or 500, but nothing else. On this system, the frames take between two
and three milliseconds to render, but because SDL can only provide one-millisecond
resolution, the time delta for a single frame will appear to be
<em>exactly</em> either .002 second or .003 second.  1/.002=500, and 1/.003=333, so the display is a blur, flashing back and forth between the two possible
values.</p>

<p>To get a more representative (and easier-to-read) value, the code must
average frame rate over a number of frames.  Doing this will allow the total
measured time to be long enough to drown out the resolution deficiency of SDL's
clock.</p>

<p>The first thing I needed was a routine to initialize the frame rate data to
carry over multiple frames:</p>

<pre><code>sub init_fps
{
    my $self = shift;

    $self-&gt;{stats}{fps}{cur_fps}    = 0;
    $self-&gt;{stats}{fps}{last_frame} = 0;
    $self-&gt;{stats}{fps}{last_time}  = $self-&gt;{world}{time};
}</code></pre>

<p>The new <code>stats</code> structure in the engine object will hold any
statistics that the engine gathers about itself. To calculate FPS, the engine
needs to remember the last frame for which it took a timestamp, as well as the
timestamp for that frame. Because the engine calculates the frame rate only
every few frames, it also saves the last calculated FPS value so that it can
render it as needed. The <code>init_fps</code> call, as usual, goes at the end
of <code>init</code>:</p>

<pre><code>$self-&gt;init_fps;</code></pre>

<p>The new <code>update_fps</code> routine now calculates the frame rate:</p>

<pre><code>sub update_fps
{
    my $self      = shift;

    my $frame     = $self-&gt;{state}{frame};
    my $time      = $self-&gt;{world}{time};

    my $d_frames  = $frame - $self-&gt;{stats}{fps}{last_frame};
    my $d_time    = $time  - $self-&gt;{stats}{fps}{last_time};
    $d_time     ||= 0.001;

    if ($d_time &gt;= .2) {
        $self-&gt;{stats}{fps}{last_frame} = $frame;
        $self-&gt;{stats}{fps}{last_time}  = $time;
        $self-&gt;{stats}{fps}{cur_fps}    = int($d_frames / $d_time);
    }
}</code></pre>

<p><code>update_fps</code> starts by gathering the current frame number and
timestamp, and calculating the deltas from the saved values. Again,
<code>$d_time</code> must default to 0.001 second to avoid possible divide-by-zero errors later on.</p>

<p>The <code>if</code> statement checks to see if enough time has gone by to
result in a reasonably accurate frame rate calculation. If so, it sets the last
frame number and timestamp to the current values and the current frame rate to
<code>$d_frames / $d_time</code>.</p>

<p>The <code>update_fps</code> call must occur early in the
<code>main_loop</code>, but after the engine has determined the new frame
number and timestamp. <code>main_loop</code> now looks like this:</p>

<pre><code>sub main_loop
{
    my $self = shift;

    while (not $self-&gt;{state}{done}) {
        $self-&gt;{state}{frame}++;
        $self-&gt;update_time;
        $self-&gt;update_fps;
        $self-&gt;do_events;
        $self-&gt;update_view;
        $self-&gt;do_frame;
    }
}</code></pre>

<p>The final change needed to enable the new more accurate display is in
<code>draw_fps</code>; the <code>$d_time</code> lookup goes away and the
<code>$fps</code> calculation turns into a simple retrieval of the current
value from the <code>stats</code> structure:</p>

<pre><code>my $fps  = $self-&gt;{stats}{fps}{cur_fps};</code></pre>

<p>The more accurate calculation now makes it easy to see the difference
between the frame rate for a simple view (Figure 7):</p>

<p><img src="/pub/2005/08/04/graphics/step074.gif" width="400" height="400" alt="frame rate for a simple view" /><br /><em>Figure
7. Frame rate for a simple view</em></p>

<p>and the frame rate for a more complex view (Figure 8).</p>

<p><img src="/pub/2005/08/04/graphics/step074a.gif" width="400" height="400" alt="frame rate for a complex view" /><br
/><em>Figure 8. Frame rate for a complex view</em></p>

<h4>Is the New Display a Bottleneck?</h4>

<p>The last thing to do is to check that the shiny new frame rate display is
not itself a major bottleneck. The easiest way to do that is to turn benchmark
mode back on in <code>init_conf</code>:</p>

<pre><code>    benchmark =&amp; 1,</code></pre>

<p>After doing that, I ran the engine under <code>dprofpp</code> again, and
then analyzed the results, just as I had earlier:</p>

<pre><code>$ dprofpp -Q -p step075

Done.
$ dprofpp -I -g main::main_loop
Total Elapsed Time = 3.943764 Seconds
  User+System Time = 1.063773 Seconds
Inclusive Times
%Time ExclSec CumulS #Calls sec/call Csec/c  Name
 100.       -  1.064      1        - 1.0638  main::main_loop
 94.6   0.006  1.007    384   0.0000 0.0026  main::do_frame
 85.2   0.019  0.907    384   0.0000 0.0024  main::draw_frame
 50.7   0.205  0.540    384   0.0005 0.0014  main::draw_view
 16.8   0.073  0.179    384   0.0002 0.0005  main::draw_fps
 15.4   0.095  0.164    384   0.0002 0.0004  main::set_projection_2d
 11.6   0.045  0.124    384   0.0001 0.0003  main::draw_axes
 10.9   0.116  0.116   2688   0.0000 0.0000  SDL::OpenGL::CallList
 8.74   0.013  0.093    384   0.0000 0.0002  main::end_frame
 7.52   0.003  0.080    384   0.0000 0.0002  SDL::App::sync
 7.24   0.077  0.077    384   0.0002 0.0002  SDL::GLSwapBuffers
 4.89   0.052  0.052   3072   0.0000 0.0000  SDL::OpenGL::PopMatrix
 4.70   0.023  0.050    384   0.0001 0.0001  main::update_view
 3.67   0.039  0.039   3456   0.0000 0.0000  SDL::OpenGL::GL_LIGHTING
 3.48   0.037  0.037    384   0.0001 0.0001  SDL::OpenGL::Begin</code></pre>

<p>As it currently stands, <code>draw_view</code> takes half of the run time of
<code>main_loop</code>, and the combination of <code>set_projection_2d</code>
and <code>draw_fps</code> takes about a third of the <code>main_loop</code> time
together. Is that good or bad news?</p>

<p><code>draw_view</code> is so quick now because I've just optimized it. Now
that it's running so fast again, I can afford to add more features and perhaps
make a more complex scene, either of which will make <code>draw_view</code>
take a larger percentage of the time again. Also,
<code>set_projection_2d</code> is necessary for any in-window statistics,
debugging, or HUD (heads up display) anyway, so the time spent there will not
go to waste.</p>

<p>That leaves <code>draw_fps</code>, taking about one sixth of
<code>main_loop</code>'s run time. That's perhaps a bit larger than I'd like,
but not large enough to warrant additional effort yet. I'll save my energy for
the next set of features.</p>

<h3>Conclusion</h3>

<p>During this article, I covered several concepts relating to engine
performance: adding a benchmark mode; profiling with <code>dprofpp</code>;
using display lists to optimize slow, repetitive rendering tasks; and using
display lists, bitmapped fonts, and averaging to produce a smooth frame rate
display. I also added a stub for a triggered events subsystem, which I'll come
back to in a future article.</p>

<p>With these performance improvements, the engine is ready for the next new
feature, textured surfaces, which will be the main topic for the next
article.</p>

<p>Until then, enjoy yourself and have fun hacking!</p>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2005/07/">&laquo; July 2005</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2005/09/">September 2005 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
