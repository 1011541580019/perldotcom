<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/1999/09/refererents.html">
<dc:title>Bless My Referents</dc:title>
<dc:description> Introduction Damian Conway is the author of the newly released Object Oriented Perl, the first of a new series of Perl books from Manning. Object-oriented programming in Perl is easy. Forget the heavy theory and the sesquipedalian jargon: classes...</dc:description>
<dc:creator>Damian Conway</dc:creator>
<dc:date>1999-09-16T00:00:00-08:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    
    <link rel="prev bookmark" href="/pub/1999/08/tripreport.html" title="We Want Your Trip Reports" />
    <link rel="next bookmark" href="/pub/1999/09/whitecamel/" title="White Camel Awards" />
    
    
    <title>Bless My Referents - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1814" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Bless My Referents</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Damian Conway</span> on <abbr class="published" title="1999-09-16T00:00:00-08:00">September 16, 1999 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        <!-- Bless my referents! -->


<br>
<h3>Introduction</h3>
<p>
<i>Damian Conway is the author of the newly released <a href="/pub/p/Object_Oriented_Perl">Object Oriented Perl</a>,
the first of a new series of Perl books from Manning.</i>
</p>

<p>
Object-oriented programming in Perl is easy. Forget the heavy theory and
the sesquipedalian jargon: classes in Perl are just regular packages, objects
are just variables, methods are just subroutines. The syntax and semantics
are a little different from regular Perl, but the basic building blocks
are completely familiar.
</p>

<p>The one problem most newcomers to object-oriented Perl seem to stumble
over is the notion of references and referents, and how the two combine
to create objects in Perl. So let's look at how references and referents
relate to Perl objects, and see who gets to be blessed and who just gets
to point the finger.
</p>

<p>Let's start with a short detour down a dark alley...
</p>

<h3>References and referents</h3>

<p>
Sometimes it's important to be able to access a variable indirectly&#151;
to be able to use it without specifying its name. There are two obvious
motivations: the variable you want may not <i>have</i> a name (it may be
an anonymous array or hash), or you may only know which variable you want
at run-time (so you don't have a name to offer the compiler).
</p>

<p>To handle such cases, Perl provides a special scalar datatype called
a <i>reference</i>. A reference is like the traditional Zen idea of the
"finger pointing at the moon". It's something that identifies a variable,
and allows us to locate it. And that's the stumbling block most people
need to get over: the finger (reference) isn't the moon (variable); it's
merely a means of working out where the moon is.
</p>

<h3>Making a reference</h3>

<p>
When you prefix an existing variable or value with the unary <font face="Courier">\</font>
operator you get a reference to the original variable or value. That original
is then known as the <i>referent</i> to which the reference refers.
</p>

<p>For example, if <font face="Courier">$s</font> is a scalar variable,
then <font face="Courier">\$s</font> is a reference to that scalar variable
(i.e. a finger pointing at it) and <font face="Courier">$s</font> is that
finger's referent. Likewise, if <font face="Courier">@a</font> in an array,
then <font face="Courier">\@a</font> is a reference to it.
</p>

<p>In Perl, a reference to any kind of variable can be stored in another
scalar variable. For example:
<pre>$slr_ref = \$s;&nbsp;&nbsp;&nbsp;&nbsp; <i># scalar $slr_ref stores a reference to scalar $s
</i>$arr_ref = \@a;&nbsp;&nbsp;&nbsp;&nbsp; <i># scalar $arr_ref stores a reference to array @a
</i>$hsh_ref = \%h;&nbsp;&nbsp;&nbsp;&nbsp; <i># scalar $hsh_ref stores a reference to hash %h</i></pre>
Figure 1 shows the relationships produced by those assignments.
</p>

<p>Note that the references are separate entities from the referents at
which they point. The only time that isn't the case is when a variable
happens to contain a reference to itself:
<pre>$self_ref = \$self_ref;<i>&nbsp;&nbsp;&nbsp;&nbsp; # $self_ref stores a reference to itself!</i></pre>
That (highly unusual) situation produces an arrangement shown in Figure
2.
</p>

<p>Once you have a reference, you can get back to the original thing it
refers to&#151;it's referent&#151;simply by prefixing the variable containing
the reference (optionally in curly braces) with the appropriate variable
symbol. Hence to access <font face="Courier">$s</font>, you could write
<font face="Courier">$$slr_ref</font> or <font face="Courier">${$slr_ref}</font>.
At first glance, that might look like one too many dollar signs, but it
isn't. The <font face="Courier New,Courier">$slr_ref</font> tells Perl
which variable has the reference; the extra <font face="Courier New,Courier">$</font>
tells Perl to follow that reference and treat the referent as a scalar.
</p>

<p>Similarly, you could access the array <font face="Courier">@a</font>
as <font face="Courier">@{$arr_ref}</font>, or the hash <font face="Courier">%h</font>
as <font face="Courier">%{$hsh_ref}</font>. In each case, the <font face="Courier">$whatever_ref</font>
is the name of the scalar containing the reference, and the leading <font face="Courier">@</font>
or <font face="Courier">% </font>indicates what type of variable the referent
is. That type is important: if you attempt to prefix a reference with the
wrong symbol (for example, <font face="Courier">@{$slr_ref}</font> or <font face="Courier">${$hsh_ref}</font>),
Perl produces a fatal run-time error.
</p>

<p>
<img src="/pub/1999/09/graphics/refs.gif" height="267" width="450" alt="[A series of scalar variables with arrows pointing to
other variables]">
<br />
<b><font size=-1>Figure 1: References and their referents</font></b>
</p>

<p>
<img src="/pub/1999/09/graphics/selfref.gif" height="147" width="250" alt="[A scalar variable with an arrow pointing back to
itself]">
<br />

<b><font size=-1>Figure 2: A reference that is its own referent</font></b>
</p>

<h3>The "arrow" operator</h3>

<p>
Accessing the elements of an array or a hash through a reference can be
awkward using the syntax shown above. You end up with a confusing tangle
of dollar signs and brackets:
<pre>${$arr_ref}[0] = ${$hsh_ref}{"first"};&nbsp; <i># i.e. $a[0] = $h{"first"}</i></pre>
So Perl provides a little extra syntax to make life just a little less
cluttered:
<pre>$arr_ref->[0] = $hsh_ref->{"first"};&nbsp;&nbsp;&nbsp; <i># i.e. $a[0] = $h{"first"}</i></pre>
The "arrow" operator (<font face="Courier">-></font>) takes a reference
on its left and either an array index (in square brackets) or a hash key
(in curly braces) on its right. It locates the array or hash that the reference
refers to, and then accesses the appropriate element of it.
</p>

<h3>Identifying a referent</h3>

<p>
Because a scalar variable can store a reference to any kind of data, and
because dereferencing a reference with the wrong prefix leads to fatal
errors, it's sometimes important to be able to determine what type of referent
a specific reference refers to. Perl provides a built-in function called
<font face="Courier">ref</font> that takes a scalar and returns a description
of the kind of reference it contains. Table 1 summarizes the string that
is returned for each type of reference.
</p>

<p>
<table border cellspacing=2 cellpadding=5 width="80%" nosave >
<tr nosave>
<td valign=top nosave><b>If <font face="Courier">$slr_ref</font> contains...</b></td>

<td valign=top width="50%"><b>then <font face="Courier">ref($slr_ref)</font>
returns...</b></td>
</tr>

<tr>
<td valign=top width="50%">a scalar value</td>

<td valign=top width="50%"><font face="Courier">undef</font></td>
</tr>

<tr>
<td valign=top width="50%">a reference to a scalar</td>

<td valign=top width="50%"><font face="Courier">"SCALAR"</font></td>
</tr>

<tr>
<td valign=top width="50%">a reference to an array</td>

<td valign=top width="50%"><font face="Courier">"ARRAY"</font></td>
</tr>

<tr>
<td valign=top width="50%">a reference to a hash</td>

<td valign=top width="50%"><font face="Courier">"HASH"</font></td>
</tr>

<tr>
<td valign=top width="50%">a reference to a subroutine</td>

<td valign=top width="50%"><font face="Courier">"CODE"</font></td>
</tr>

<tr>
<td valign=top width="50%">a reference to a filehandle</td>

<td valign=top width="50%"><font face="Courier">"IO"</font> or <font face="Courier">"IO::Handle"</font></td>
</tr>

<tr>
<td valign=top width="50%">a reference to a typeglob</td>

<td valign=top width="50%"><font face="Courier">"GLOB"</font></td>
</tr>

<tr>
<td valign=top width="50%">a reference to a precompiled pattern</td>

<td valign=top width="50%"><font face="Courier">"Regexp"</font></td>
</tr>

<tr>
<td valign=top width="50%">a reference to another reference</td>

<td valign=top width="50%"><font face="Courier">"REF"</font></td>
</tr>
</table>
</p><br />

<b><font size=-1>Table 1: What </font><font face="Courier">ref</font> returns</font></b>
</p>

<p>As Table 1 indicates, you can create references to many kinds of Perl
constructs, apart from variables.
</p>

<p>If a reference is used in a context where a string is expected, then
the <font face="Courier">ref</font> function is called automatically to
produce the expected string, and a unique hexadecimal value (the internal
memory address of the thing being referred to) is appended. That means
that printing out a reference:
<pre>print $hsh_ref, "\n";</pre>
produces something like:
<pre><b><font face="Helvetica">HASH(0x10027588)</font></b></pre>
since each element of <font face="Courier">print</font>'s argument list
is stringified before printing.
</p>

<p>The <font face="Courier">ref</font> function has a vital additional
role in object-oriented Perl, where it can be used to identify the class
to which a particular object belongs. More on that in a moment.
</p>

<h3>References, referents, and objects</h3>

<p>
References and referents matter because they're both required when you
come to build objects in Perl. In fact, Perl objects are just referents
(i.e. variables or values) that have a special relationship with a particular
package. References come into the picture because Perl objects are always
accessed via a reference, using an extension of the "arrow" notation.
</p>

<p>But that doesn't mean that Perl's object-oriented features are difficult
to use (even if you're still unsure of references and referents). To do
real, useful, production-strength, object-oriented programming in Perl
you only need to learn about one extra function, one straightforward piece
of additional syntax, and three very simple rules. Let's start with the
rules...
</p>

<h3>Rule 1: To create a class, build a package</h3>

<p>
Perl packages already have a number of class-like features:
<ul>
<li>
They collect related code together;</li>

<li>
They distinguish that code from unrelated code;</li>

<li>
They provide a separate namespace within the program, which keeps subroutine
names from clashing with those in other packages;</li>

<li>
They have a name, which can be used to identify data and subroutines defined
in the package.</li>
</ul>
In Perl, those features are sufficient to allow a package to act like a
class.
</p>

<p>Suppose you wanted to build an application to track faults in a system.
Here's how to declare a class named "Bug" in Perl:
<pre>package Bug;</pre>
That's it! In Perl, classes are packages. No magic, no extra syntax, just
plain, ordinary packages. Of course, a class like the one declared above
isn't very interesting or useful, since its objects will have no attributes
or behaviour.
</p>

<p>That brings us to the second rule...
</p>

<h3>Rule 2: To create a method, write a subroutine</h3>

<p>
In object-oriented theory, methods are just subroutines that are associated
with a particular class and exist specifically to operate on objects that
are instances of that class. In Perl, a subroutine that is declared in
a particular package <i>is already</i> associated with that package. So
to write a Perl method, you just write a subroutine within the package
that is acting as your class.
</p>

<p>For example, here's how to provide an object method to print Bug objects:
<pre>package Bug;</pre>

<pre><b>sub print_me
{
<i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # The code needed to print the Bug goes here
</i>}</b></pre>
Again, that's it. The subroutine <font face="Courier">print_me</font> is
now associated with the package Bug, so whenever Bug is used as a class,
Perl automatically treats <font face="Courier">Bug::print_me</font> as
a method.
</p>

<p>Invoking the <font face="Courier">Bug::print_me</font> method involves
that one extra piece of syntax mentioned above&#151;an extension to the existing
Perl "arrow" notation. If you have a reference to an object of class Bug,
you can access any method of that object by using a <font face="Courier">-></font>
symbol, followed by the name of the method.
</p>

<p>For example, if the variable <font face="Courier">$nextbug</font> holds
a reference to a Bug object, you could call <font face="Courier">Bug::print_me</font>
on that object by writing:
<pre>$nextbug->print_me();</pre>
Calling a method through an arrow should be very familiar to any C++ programmers;
for the rest of us, it's at least consistent with other Perl usages:
<pre>$hsh_ref->{"key"};&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i># Access the hash referred to by $hashref
</i>$arr_ref->[$index];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i># Access the array referred to by $arrayref
</i>$sub_ref->(@args);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i># Access the sub referred to by $subref
</i><b>$obj_ref->method(@args);&nbsp;&nbsp;&nbsp;&nbsp; <i># Access the object referred to by $objref</i></b></pre>
The only difference with the last case is that the referent (i.e. the object)
pointed to by <font face="Courier">$objref</font> has many ways of being
accessed (namely, its various methods). So, when you want to access that
object, you have to specify which particular way&#151;which method&#151;should
be used. Hence, the method name after the arrow.
</p>

<p>When a method like <font face="Courier">Bug::print_me</font> is called,
the argument list that it receives begins with the reference through which
it was called, followed by any arguments that were explicitly given to
the method. That means that calling <font face="Courier">Bug::print_me("logfile")</font>
is <i>not</i> the same as calling <font face="Courier">$nextbug->print_me("logfile")</font>.
In the first case, <font face="Courier">print_me</font> is treated as a
regular subroutine so the argument list passed to <font face="Courier">Bug::print_me</font>
is equivalent to:
<pre>( "logfile" )</pre>
In the second case, <font face="Courier">print_me</font> is treated as
a method so the argument list is equivalent to:
<pre>( $objref, "logfile" )</pre>
Having a reference to the object passed as the first parameter is vital,
because it means that the method then has access to the object on which
it's supposed to operate. Hence you'll find that most methods in Perl start
with something equivalent to this:
<pre>package Bug;</pre>

<pre>sub print_me
{
<b>&nbsp;&nbsp;&nbsp; my ($self) = shift;
</b><i>&nbsp;&nbsp;&nbsp; # The @_ array now stores the arguments passed to &amp;Bug::print_me
&nbsp;&nbsp;&nbsp; # The rest of &amp;print_me uses the data referred to by $self&nbsp;
&nbsp;&nbsp;&nbsp; # and the explicit arguments (still in @_)
</i>}</pre>
or, better still:
<pre>package Bug;</pre>

<pre>sub print_me
{
<b>&nbsp;&nbsp;&nbsp; my ($self, @args) = @_;
</b><i>&nbsp;&nbsp;&nbsp; # The @args array now stores the arguments passed to &amp;Bug::print_me
&nbsp;&nbsp;&nbsp; # The rest of &amp;print_me uses the data referred to by $self
&nbsp;&nbsp;&nbsp; # and the explicit arguments (now in @args)
</i>}</pre>
This second version is better because it provides a lexically scoped copy
of the argument list (<font face="Courier">@args</font>). Remember that
the <font face="Courier">@_</font> array is "magical"&#151;changing any element
of it actually changes the <i>caller's</i> version of the corresponding
argument. Copying argument values to a lexical array like <font face="Courier">@args</font>
prevents nasty surprises of this kind, as well as improving the internal
documentation of the subroutine (especially if a more meaningful name than
<font face="Courier">@args</font> is chosen).
</p>

<p>The only remaining question is: <i>how do you create the invoking object
in the first place?</i>
</p>

<h3>Rule 3: To create an object, bless a referent</h3>

<p>
Unlike other object-oriented languages, Perl doesn't require that an object
be a special kind of record-like data structure. In fact, you can use <i>any</i>
existing type of Perl variable&#151;a scalar, an array, a hash, etc.&#151;as
an object in Perl.
</p>

<p>Hence, the issue isn't how to <i>create</i> the object, because you
create them exactly like any other Perl variable: declare them with a <font face="Courier">my</font>,
or generate them anonymously with a <font face="Courier">[</font>...<font face="Courier">]</font>
or <font face="Courier">{</font>...<font face="Courier">}</font>. The real
problem is how to tell Perl that such an object <i>belongs</i> to a particular
class. That brings us to the one extra built-in Perl function you need
to know about. It's called <font face="Courier">bless</font>, and its only
job is to mark a variable as belonging to a particular class.
</p>

<p>The <font face="Courier">bless</font> function takes two arguments:
a reference to the variable to be marked, and a string containing the name
of the class. It then sets an internal flag on the variable, indicating
that it now belongs to the class.
</p>

<p>For example, suppose that <font face="Courier">$nextbug</font> actually
stores a reference to an anonymous hash:
<pre>$nextbug = {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id&nbsp;&nbsp;&nbsp; => "00001",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type&nbsp; => "fatal",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; descr => "application does not compile",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };</pre>
To turn that anonymous hash into an object of class Bug you write:
<pre>bless $nextbug, "Bug";</pre>
And, once again, that's it! The anonymous array referred to by <font face="Courier">$nextbug</font>
is now marked as being an object of class Bug. Note that the variable <font face="Courier">$nextbug</font>
itself hasn't been altered in any way; only the nameless hash it refers
to has been marked. In other words, <font face="Courier">bless</font> sanctified
the referent, <i>not</i> the reference. Figure 3 illustrates where the
new class membership flag is set.
</p>

<p>You can check that the blessing succeeded by applying the built-in <font face="Courier">ref
</font>function to <font face="Courier">$nextbug</font>. As explained above,
when <font face="Courier">ref</font> is applied to a reference, it normally
returns the type of that reference. Hence, before <font face="Courier">$nextbug</font>
was blessed, <font face="Courier">ref($nextbug)</font> would have returned
the string <font face="Courier">'HASH'</font>.
</p>

<p>Once an object is blessed, <font face="Courier">ref</font> returns the
name of its class instead. So after the blessing, <font face="Courier">ref($nextbug)</font>
will return <font face="Courier">'Bug'</font>. Of course the object itself
still <i>is</i> a hash, but now it's a hash that <i>belongs</i> to the
Bug class. The various entries of the hash become the attributes of the
newly created Bug object.
</p>
<p>
<img src="/pub/1999/09/graphics/blessing.gif" alt="[A picture of an anonymous hash having a flag set within it]" height="412" width="450">
<br />
<b><font size=-1>Figure 3: What changes when an object is blessed</font></b>
</p>

<h3>Creating a constructor</h3>

<p>
Given that you're likely to want to create many such Bug objects, it would
be convenient to have a subroutine that took care of all the messy, blessy
details. You could pass it the necessary information, and it would then
wrap it in an anonymous hash, bless the hash, and give you back a reference
to the resulting object.
</p>

<p>And, of course, you might as well put such a subroutine in the Bug package
itself, and call it something that indicates its role. Such a subroutine
is known as a <i>constructor,</i> and it generally looks like this:
<pre>package Bug;
sub new
{
&nbsp;&nbsp;&nbsp; my $class = $_[0];
<b>&nbsp;&nbsp;&nbsp; my $objref = {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id&nbsp;&nbsp;&nbsp; => $_[1],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type&nbsp; => $_[2],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; descr => $_[3],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };
&nbsp;&nbsp;&nbsp; bless $objref, $class;
</b>&nbsp;&nbsp;&nbsp; return $objref;
}</pre>
Note that the middle bits of the subroutine (in bold) look just like the
raw blessing that was handed out to <font face="Courier">$nextbug</font>
in the previous example.
</p>

<p>The <font face="Courier">bless</font> function is set up to make writing
constructors like this a little easier. Specifically, it returns the reference
that's passed as its first argument (i.e. the reference to whatever referent
it just blessed into object-hood). And since Perl subroutines automatically
return the value of their last evaluated statement, that means that you
could condense the definition of <font face="Courier">Bug::new</font> to
this:
<pre>sub Bug::new
{
<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bless { id => $_[1], type => $_[2], descr => $_[3] }, $_[0];
</b>}</pre>
This version has exactly the same effects: slot the data into an anonymous
hash, bless the hash into the class specified first argument, and return
a reference to the hash.
</p>

<p>Regardless of which version you use, now whenever you want to create
a new Bug object, you can just call:
<pre>$nextbug = Bug::new("Bug", $id, $type, $description);</pre>
That's a little redundant, since you have to type "Bug" twice. Fortunately,
there's another feature of the "arrow" method-call syntax that solves this
problem. If the operand to the left of the arrow is the name of a class
&#151;rather than an object reference&#151;then the appropriate method of that
class is called. More importantly, if the arrow notation is used, the first
argument passed to the method is a string containing the class name. That
means that you could rewrite the previous call to <font face="Courier">Bug::new</font>
like this:
<pre>$nextbug = Bug->new($id, $type, $description);</pre>
There are other benefits to this notation when your class uses inheritance,
so you should always call constructors and other class methods this way.
</p>

<h3>Method enacting</h3>

<p>
Apart from encapsulating the gory details of object creation within the
class itself, using a class method like this to create objects has another
big advantage. If you abide by the convention of only ever creating new
Bug objects by calling <font face="Courier">Bug::new</font>, you're guaranteed
that all such objects will always be hashes. Of course, there's nothing
to prevent us from "manually" blessing arrays, or scalars as Bug objects,
but it turns out to make life <i>much</i> easier if you stick to blessing
one type of object into each class.
</p>

<p>For example, if you can be confident that any Bug object is going to
be a blessed hash, you can (finally!) fill in the missing code in the <font face="Courier">Bug::</font>print_me
method:
<pre>package Bug;
sub print_me
{
&nbsp;&nbsp;&nbsp; my ($self) = @_;
<b>&nbsp;&nbsp;&nbsp; print "ID: $self->{id}\n";
&nbsp;&nbsp;&nbsp; print "$self->{descr}\n";
&nbsp;&nbsp;&nbsp; print "(Note: problem is fatal)\n" if $self->{type} eq "fatal";
</b>}</pre>
Now, whenever the <font face="Courier">print_me</font> method is called
via a reference to any hash that's been blessed into the Bug class, the
<font face="Courier">$self</font> variable extracts the reference that
was passed as the first argument and then the <font face="Courier">print</font>
statements access the various entries of the blessed hash.
</p>

<h3>Till death us do part...</h3>

<p>
Objects sometimes require special attention at the other end of their lifespan
too. Most object-oriented languages provide the ability to specify a subroutine
that is called automatically when an object ceases to exist. Such subroutines
are usually called <i>destructors</i>, and are used to undo any side-effects
caused by the previous existence of an object. That may include:
<blockquote>
<ul>
<li>
deallocating related memory (although in Perl that's almost never necessary
since reference counting usually takes care of it for you);</li>

<li>
closing file or directory handles stored in the object;</li>

<li>
closing pipes to other processes;</li>

<li>
closing databases used by the object;</li>

<li>
updating class-wide information;</li>

<li>
anything else that the object should do before it ceases to exist (such
as logging the fact of its own demise, or storing its data away to provide
persistence, etc.)</li>
</ul>
</blockquote>
In Perl, you can set up a destructor for a class by defining a subroutine
named <font face="Courier">DESTROY</font> in the class's package. Any such
subroutine is automatically called on an object of that class, just before
that object's memory is reclaimed. Typically, this happens when the last
variable holding a reference to the object goes out of scope, or has another
value assigned to it.
</p>

<p>For example, you could provide a destructor for the Bug class like this:
<pre>package Bug;</pre>

<pre><i># other stuff as before</i></pre>

<pre><b>sub DESTROY
{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; my ($self) = @_;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print "&lt;&lt; Squashed the bug: $self->{id} >>\n\n";
}</b></pre>
Now, every time an object of class Bug is about to cease to exist, that
object will automatically have its <font face="Courier">DESTROY</font>
method called, which will print an epitaph for the object. For example,
the following code:
<pre>package main;
use Bug;

open BUGDATA, "Bug.dat" or die "Couldn't find Bug data";

while (&lt;BUGDATA>)
{
&nbsp;&nbsp;&nbsp; my @data = split ',', $_;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i># extract comma-separated Bug data
</i>&nbsp;&nbsp;&nbsp; my $bug = Bug->new(@data);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i># create a new Bug object
</i>&nbsp;&nbsp;&nbsp; $bug->print_me();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i># print it out
</i>}&nbsp;

print "(end of list)\n";</pre>
prints out something like this:
<pre><font face="Helvetica">ID: HW000761
"Cup holder" broken
Note: problem is fatal
&lt;&lt; Squashed the bug HW000761 >>

ID: SW000214
Word processor trashing disk after 20 saves.
&lt;&lt; Squashed the bug SW000214 >>&nbsp;

ID: OS000633
Can't change background colour (blue) on blue screen of death.
&lt;&lt; Squashed the bug OS000633 >>&nbsp;

(end of list)</font></pre>
That's because, at the end of each iteration of the <font face="Courier">while</font>
loop, the lexical variable <font face="Courier">$bug</font> goes out of
scope, taking with it the only reference to the Bug object created earlier
in the same loop. That object's reference count immediately becomes zero
and, because it was blessed, the corresponding <font face="Courier">DESTROY</font>
method (i.e. <font face="Courier">Bug::DESTROY</font>) is automatically
called on the object.
</p>

<h3>Where to from here?</h3>

<p>
Of course, these fundamental techniques only scratch the surface of object-oriented
programming in Perl. Simple hash-based classes with methods, constructors,
and destructors may be enough to let you solve real problems in Perl, but
there's a vast array of powerful and labor-saving techniques you can add
to those basic components: autoloaded methods, class methods and class
attributes, inheritance and multiple inheritance, polymorphism, multiple
dispatch, enforced encapsulation, operator overloading, tied objects, genericity,
and persistence.
</p>

<p>Perl's standard documentation includes plenty of good material&#151;<i>perlref</i>,
<i>perlreftut</i>, <i>perlobj</i>, <i>perltoot</i>, <i>perltootc</i>, and
<i>perlbot</i> to get you started. But if you're looking for a comprehensive
tutorial on everything you need to know, you may also like to consider
my new book, <i><a href="http://www.manning.com/conway/">Object Oriented
Perl</a></i>, from which this article has been adapted.
</p>



                                    </div>


                                </div>
                                <div class="asset-footer">


                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
