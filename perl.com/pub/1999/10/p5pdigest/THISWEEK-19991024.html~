<h2>This Week on perl5-porters<br>(18--24 October 1999)</h2>
<!::field::id-author::before=by+::>
<br />
<!::field::date::>
<br />


<!-- INDEX BEGIN -->

<UL>

	<LI><A HREF="#C_O_"><CODE>$^O</CODE></A>
	<LI><A HREF="#C_STOP_blocks_and_the_broken_co"><CODE>STOP</CODE> blocks and the broken compiler</A>
	<LI><A HREF="#Blank_lines_in_POD">Blank lines in POD</A>
	<LI><A HREF="#C_PERL_HEADER_environment_varia"><CODE>PERL_HEADER</CODE> environment variable</A>
	<LI><A HREF="#Out_of_date_modules_in_Perl_dist">Out of date modules in Perl distribution</A>
	<LI><A HREF="#Enhanced_C_UNIVERSAL_isa_">Enhanced <CODE>UNIVERSAL::isa</CODE></A>
	<LI><A HREF="#C_sort_improvements"><CODE>sort</CODE> improvements</A>
	<LI><A HREF="#C_glob_case_sensitivity"><CODE>glob</CODE> case-sensitivity</A>
	<LI><A HREF="#C_reftype_function"><CODE>reftype</CODE> function</A>
	<LI><A HREF="#New_C_perlthread_man_page">New <CODE>perlthread</CODE> man page</A>
	<LI><A HREF="#Win32_and_C_fork_">Win32 and <CODE>fork()</CODE></A>
	<LI><A HREF="#Module_Bundling_and_the_proposed">Module Bundling and the proposed <CODE>import</CODE> pragma</A>
	<LI><A HREF="#C_cron_daemon_runs_processes_wi"><CODE>cron</CODE> daemon runs processes with <CODE>$SIG{CHLD}</CODE> set to <CODE>IGNORE</CODE></A>
	<LI><A HREF="#Day_range_checking_in_C_Time_Lo">Day range checking in <CODE>Time::Local::timelocal</CODE></A>
	<LI><A HREF="#New_quotation_characters">New quotation characters</A>
	<LI><A HREF="#Lexical_or_dynamic_scope_for_C_u">Lexical or dynamic scope for <CODE>use utf8</CODE>?</A>
	<LI><A HREF="#Full_path_of_cwd_in_C_INC_">Full path of cwd in <CODE>@INC</CODE></A>
	<LI><A HREF="#A_Strategic_Decision_to_use_the_">A Strategic Decision to use the Perl Compiler</A>
	<LI><A HREF="#Happy_Birthday_Perl_5">Happy Birthday Perl 5</A>
	<LI><A HREF="#Unicode_Character_Classes_Revisi">Unicode Character Classes Revisited</A>
	<LI><A HREF="#Sarathy_says_Yikes_again">Sarathy says `Yikes' again</A>
	<LI><A HREF="#Various">Various</A>
</UL>
<!-- INDEX END -->

<H3>Note</H3>

<p>It is hard to keep track of everything that happens.  As before,
please let me know if you have any corrections or additions.  Send
them to <tt>mjd-perl-thisweek-YYYYMM@plover.com</tt> where
<tt>YYYYMM</tt> is the current year and month.</p>

<P>
<H3><A NAME="C_O_"><CODE>$^O</CODE></A></H3>
<P>
There was a gigantic discussion of <CODE>$^O</CODE> and related
matters. This was brought on by Tom, who wants to write a program that
cross-checks the <CODE>SEE ALSO</CODE> sections of the man pages. The
problem: Every version of Linux has a <CODE>man</CODE> command that is
slightly incompatible with every other. In particular, each system has
a different idea of where the pages are and how they are organized.
Tom wants his program to find out what sort of Linux it is on, `Red
Hat' or `Debian' or whatever, but <CODE>$^O</CODE> (and also the
<CODE>uname</CODE> command) only says <CODE>linux</CODE>, which is not
enough.

<P>
Various discussion ensued. Suggestion 1: Make <CODE>$^O</CODE> look like
<CODE>linux-redhat</CODE> or something. Objections: Changing <CODE>$^O</CODE> will break stupid programs that have <CODE>$^O eq 'linux'</CODE> instead of <CODE>$^O =~
/linux/</CODE>. Putting <CODE>redhat</CODE> into <CODE>$^O</CODE> will not actually solve Tom's problem, at least not in general, since the
semantics of <CODE>redhat</CODE>
changes from release to release.

<P>
Suggestion 2: Add a <CODE>Config.pm</CODE> field for the distribution vendor. Objections: <CODE>Config.pm</CODE> only reflects the state of the system at the time Perl was built, not at
the time your program runs. Possible solution to this: Have <CODE>Config</CODE> determine the OS at run time at the moment the information is requested.
Second objection: If <CODE>Config</CODE>
can do this, why can't Tom's program do it the same way, but without
<CODE>Config</CODE>? Well, OK, the nastiness could be encapsulated in a module. But Sarathy
didn't like the idea of putting this dynamic information into <CODE>Config</CODE>. He suggested:

<P>
Suggestion 3: A new module, <CODE>OS</CODE>, to provide functions for
looking up this sort of thing dynamically. There were other similar
suggestions. Dan Sugalski suggested adding a new magical
<CODE>%^O</CODE> variable that would behave similarly. Nick
Ing-Simmons suggested an <CODE>OS_Info</CODE> module. This
multiplicity suggests that I was the only one following the whole
tedious discussion. (And, if so, that everyone else had good sense.)

<P>
Gosh. When I took this job, I knew there would be occasional weeks where
there was some gigantic but trivial discussion. But I wasn't expecting one
so soon.  

<P>
If there was a conclusion to this discussion, I was not able to find
it.  Maybe there will be an update next week, or maybe everyone will
just get tired of the whole thing and forget about it.  Tom eventually
punted on the problem, and his program now assumes that it is running
under Red Hat.

<P>
In this midst of this, there were some sidetracks I found interesting.
There was discussion of Sarathy's hack to create <CODE>fork()</CODE>
on forkless Microsoft OSes (more about this below.) Tom Horsley had <A
HREF="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg00902.html">a
really delightful rant about <code>Configure</code></A>, which unfortunately is too long to
reproduce here:

<P>
<blockquote>
[<CODE>Configure</CODE>] acts, in fact, as though it were a compressed archive chock full of
config.h files for all kinds of different systems, and pressing the button
merely unpacks one of the files.

<P>
The problem comes when you attempt to extract a file that was never put
into the archive in the first place. ...
</blockquote>


<P>
The replies to this are worth reading too. 

<P>

<H3><A NAME="C_STOP_blocks_and_the_broken_co"><CODE>STOP</CODE> blocks and the broken compiler</A></H3>
<P>
One of the changes in perl 5.005_62 was that <CODE>END</CODE> blocks would no longer be run under <CODE>-c</CODE> mode. Nick Ing-Simmons wanted to know how the compiler would work; it had
formerly worked by enabling <CODE>-c</CODE>
mode, and walking the op tree and dumping out the compiled code in an
<CODE>END</CODE> block, which was executed after the program file was parsed and compiled.
(This may be an incorrect description; I would be grateful for corrections
here.) Disabling <CODE>END</CODE> blocks under <CODE>-c</CODE> mode, while correct, would break the compiler.

<P>
When he made the change, Sarathy planned a workaround, which you can
find in <CODE>perldelta</CODE> if you are interested. But the
workaround is annoying for the compiler, and Sarathy suggested that
the best solution would be <CODE>STOP</CODE> blocks. These would be
run after the compilation phase, but before the run phase; they are in
contrast to <CODE>INIT</CODE> blocks, which are run at the start of
the run phase. Normally, these two things happen at almost the same
time, with <CODE>STOP</CODE> blocks immediately before
<CODE>INIT</CODE> blocks. But if you  think of a compiler
module, which pauses after the compilation phase, writes out the
compiled code and exits, the usefulness of <CODE>STOP</CODE> becomes clear.

<P>
Vishal Bhatia pointed out that this would solve an existing  compiler bug:
<CODE>END</CODE> blocks are presently not executed at all by compiled scripts. If the <CODE>B::</CODE> modules did their work in <CODE>STOP</CODE> blocks instead of
<CODE>END</CODE> blocks, they would not have to usurp the <CODE>END</CODE> blocks.

<P>

<H3><A NAME="Blank_lines_in_POD">Blank lines in POD</A></H3>
<P>
Larry Virden submitted a minor doc patch: There was a line which looked
empty, but which contained white space. This prevented the POD parser from
recognizing a <CODE>=head</CODE> directive on the following line, because directives are only recognized
when they begin `paragraphs', and a line is not deemed to end a paragraph
unless it is entirely empty.  

<P>
It appears that this annoying behavior is finally going to be fixed. I
am delighted, because <a
href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/9512/msg01372.html">I
had complained about this back in 1995</a>.

<P>

<H3><A NAME="C_PERL_HEADER_environment_varia"><CODE>PERL_HEADER</CODE> environment variable</A></H3>
<P>
Ed Peschko wanted a new <CODE>PERL_HEADER</CODE> environment variable, somewhat analogous to <CODE>PERLLIB</CODE> or <CODE>PERL5OPT</CODE>, which would contain code that would be prepended to the source file
before it was executed. He wanted this so that he could make an environment
setting to tell Perl to always load up some standard, locally defined
modules before compiling the rest of any program.

<P>
Many people found persuasive reasons why this would be a bad thing to do,
and many other people suggested ways that it could be accomplished. For
example, you could set <CODE>PERL5OPT</CODE> to 
<CODE>-MFoo -MBar</CODE>.

<P>

<H3><A NAME="Out_of_date_modules_in_Perl_dist">Out of date modules in Perl distribution</A></H3>
<P>
Michael Schwern pointed out that there are several modules being
distributed with Perl for which more recent versions exist on CPAN.

<P>
It turns out that many of these cases are for good reasons. For example,
Ilya keeps the version number of the Devel::Peek on CPAN higher than the
version in Perl so that if you ask <CODE>CPAN.pm</CODE> to
<CODE>install Devel::Peek</CODE>, it does not go and try to install the latest version of Perl for you.
(Why does it do that, anyway?)

<P>
However, some modules really are out of date in the distribution. Sarathy
asked that authors of modules in the Perl distribution send him a note when
they update their modules. 

<P>

<H3><A NAME="Enhanced_C_UNIVERSAL_isa_">Enhanced <CODE>UNIVERSAL::isa</CODE></A></H3>
<P>
Mark Mielke suggested enhancing <CODE>isa</CODE> so that you could
give it and object and several class names and it would return true if
the object belonged to any of the classes. At present, only one class
is allowed.  No conclusion was reached. My guess is that this is not
going in because it is easy to write such a function if you want it.

<P>

<H3><A NAME="C_sort_improvements"><CODE>sort</CODE> improvements</A></H3>
<P>
I don't fully understand this yet, but it looks interesting. It
appears that Peter Haworth wants to have Perl notice when a sort
comparator function is prototyped with <CODE>($$)</CODE>, and to
optimize the argument passing to such a function to get the speed of
the <CODE>$a</CODE>-<CODE>$b</CODE> hack, but without actually using
<CODE>$a</CODE> and <CODE>$b</CODE>. Then you could use any
two-argument function as a sort comparator but it would be as fast as
if it were using the special <CODE>$a</CODE>-<CODE>$b</CODE> method. I
have asked Peter to confirm this, and I will report back next week.</p>

<p>Note added 26 October:  Peter cofirms that I have it mostly right, but adds:</p>

<blockquote><p>
The gains aren't so much for
performance, as getting rid of package annoyances. If I manage to get this
patch working properly, you can use a comparator function from a different
package, and it can just get its arguments from <CODE>@_</CODE>, rather than
<CODE>${caller.'::a'}</CODE> and <CODE>${caller.'::b'}</CODE>. Also, Ilya says this will allow XSUBs to
be used as comparators, but I don't know the history of this well enough to
know why they can't be used now.
</p></blockquote>

<P>

<H3><A NAME="C_glob_case_sensitivity"><CODE>glob</CODE> case-sensitivity</A></H3>
<P>
Perl 5.005_62 optionally has a new built-in implementation of the <CODE>glob</CODE> function; it does not need to call the shell to do a glob. Paul Moore
pointed out that the new internal globber is case-sensitive, even on his
Win32 system with the case-insensitive filesystem; formerly, <CODE>glob</CODE> had been case-insensitive.

<P>
Some discussion ensued about what to do. Sarathy seemed inclined to let the
new globber continue to be insensitive on case-insensitive filesystems, and
vice versa; on Windows systems there is an API for finding this out. He
asked Paul for a patch for this. He said that people could use the <CODE>File::Glob</CODE> or <CODE>File::DosGlob</CODE> modules if they needed a specific semantics.

<P>
Incidentally, <A
HREF="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01183.html">Larry
suggested that the new <CODE>glob</CODE> be made the default for the
beta test versions of Perl</A>, so that it would be tested adequately.

<P>



<P>

<H3><A NAME="C_reftype_function"><CODE>reftype</CODE> function</A></H3>
<P>
Jeff Pinyan posted a complaint about the behavior of a function prototyped
with <CODE>(;$)</CODE>.  He wants <CODE>print f arg1,
arg2</CODE> to be parsed as if he had written
<CODE>print f(arg1),
arg2</CODE>.  At present, Perl aborts, complaining that <CODE>f</CODE>
got two arguments and expected at most one.  Jeff encountered this
behavior while he was writing a function to determine what kind
of reference (array, hash, whatever) its argument is. 
</P>

<P>
(This is more difficult than it seems. You cannot use only <CODE>ref</CODE>, because if you have an object blessed into a class named
<CODE>ARRAY</CODE>, <CODE>ref</CODE> will return <CODE>ARRAY</CODE> even if the object is a hash, and you run into similar problems with
classes named <CODE>0</CODE> and so forth.)  

<P>
Nobody addressed the <CODE>(;$)</CODE> issue, but there was discussion of how to
build such a function. Spider Boardman revealed that he had such a function
named <CODE>attributes::reftype</CODE> already in the standard Perl
distribution.  It is written in C as an XS, which is clearly the Right Way to Do It. Sarathy
said he thought that <CODE>attribute.pm</CODE> was a good place for
the function to be.</P>

<P>

<H3><A NAME="New_C_perlthread_man_page">New <CODE>perlthread</CODE> man page</A></H3>
<P>
Dan Sugalski presented for comments <A
HREF="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01081.html">a
draft of a <CODE>perlthread</CODE> man page</A>, discussing Perl's
thread interface and thread semantics. </P>


<P>



<P>

<H3><A NAME="Win32_and_C_fork_">Win32 and <CODE>fork()</CODE></A></H3>
<P>
Sarathy has been working for some time on making <CODE>fork</CODE> work on forkless Win32 systems. The idea: <CODE>fork</CODE> will create a new thread, running a separate copy of the Perl interpreter,
which will run the fictional child process. The child process will somehow
have its own current working directory, environment, open file table,
and so forth.  <CODE>exec</CODE> in the `child' thread will terminate the thread and its associated
interpreter, rather than the entire process.

<P>
<blockquote> <p><b>Dan Sugalski:</b> I see there's
going to be something interesting to implement for VMS before 5.6 gets
released. Cool. :) </blockquote>

<P>

<H3><A NAME="Module_Bundling_and_the_proposed">Module Bundling and the proposed <CODE>import</CODE> pragma</A></H3>
<P>
This continued from last week. Michael King split up his module
functionality into <CODE>Import::ShortName</CODE> for module aliasing, and
<CODE>Import::JavaPkg</CODE>, to load a whole bunch of modules in a single namespace all at once, with
aliasing.

<P>
At the tail end of this discussion, several people complained that although
they thought that they'd followed the documented procedure for reserving
namespaces in the CPAN module list, nothing ever seemed to come of it, and
their names never appeared in the list. Andreas K&ouml;nig took
responsibility for this problem. He is rewriting the PAUSE software to
handle the bookkeeping, because the module list owners are too overworked
to do it all manually.

<P>
<A
HREF="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg00903.html">Andreas asked people whose requests had been forgotten to send a reminder
to the module list</a> by the end of October, and promised to get these
requests listed within 24 hours.

<P>



<P>

<H3><A NAME="C_cron_daemon_runs_processes_wi"><CODE>cron</CODE> daemon runs processes with <CODE>$SIG{CHLD}</CODE> set to <CODE>IGNORE</CODE></A></H3>
<P>
On some systems, the <CODE>cron</CODE> daemon has this bug. (It is a bug in <CODE>cron</CODE>, because <CODE>cron</CODE> should know to restore the signal handling to the default case when running
a job; otherwise the job will inherit this unusual signal environment and
might get unexpected results.)

<P>
Tom Phoenix added a patch to the linux hints file to try to detect this,
and print out a warning at Perl build time if so. Sarathy said it was bad
to put this in the hints, because it does not actually
<EM>affect</EM> the build process, and that it should be documented more prominently.  

<P>
Mike Guy asked: ``Wouldn't it be better for Perl just to set
<CODE>$SIG{CHLD} = 'DEFAULT'</CODE> automatically at startup in this case? Would it do any harm to do it in <EM>all</EM> cases?'' <A
HREF="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01201.html">Sarathy agreed</A>, and put in a patch to do that, and also to issue a
warning if so.

<P>



<P>

<H3><A NAME="Day_range_checking_in_C_Time_Lo">Day range checking in <CODE>Time::Local::timelocal</CODE></A></H3>
<P>
If you ask <CODE>timelocal</CODE> to convert a date where the day of the month is larger than 31, it aborts
with a warning like

<P>
<PRE>        Day '32' out of range 1..31
</PRE>
<P>
John L. Allen complained that this was stupid for two reasons: First, it
doesn't abort when you ask for February 30, and second, it prevents you
from asking for January 280 to find out the date of the 280th day of the
year. He submitted a patch that eliminated the check.

<P>
A patch like that had been in before, but Sarathy took it out because it
caused a test failure in <CODE>libwww</CODE>; Sarathy wants it to be
conditionalized on a <CODE>nocroak</CODE> variable or something, for
backward compatibility. In the ensuing discussion, Jonathan Scott Duff made
a list of new features he'd like to see in <CODE>Time::Local</CODE>---features like `fast' and `correct'.  

<P>
<A
HREF="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01181.html">Mike Guy said that he had worked on such a thing</A>, but run into some
annoying backward compatibility issues. For example, the current
<CODE>timelocal</CODE> returns -1 on an error. But because -1 also
indicates
a valid time before 1970, <CODE>timelocal</CODE>
cannot work for dates before 1970 and be
backward-compatible with the current version at the same time. Also, the
existing <CODE>timelocal</CODE> has a very nasty interpretation of the
year: <CODE>2070</CODE>, <CODE>170</CODE>, and <CODE>70</CODE> all
mean the year 2070, contrary to good sense and the documentation.

<P>



<P>
Sarathy said he would accept the <CODE>timelocal</CODE> replacement if there were a command to enable the improved behaviors that
were not backward compatible with the old behavior.

<P>

<H3><A NAME="New_quotation_characters">New quotation characters</A></H3>
<P>
Kragen Sitaker asked, on <CODE>comp.lang.perl.misc</CODE>, whether it wouldn't be nice for Perl to recognize additional kinds of
parentheses once Unicode support is really in. For example, U+3010 

<IMG SRC="http://charts.unicode.org/Unicode.charts/Small.Glyphs/30/U3010.gif">
 and U+3011 <IMG SRC="http://charts.unicode.org/Unicode.charts/Small.Glyphs/30/U3011.gif">
are left and right `black lenticular brackets'. The <CODE>q</CODE> operator understands <CODE>q{...}</CODE> and <CODE>q(....)</CODE>  <CODE>q[...]</CODE> and the like; why not the black lenticular brackets also?

<P>
Kragen also suggested that, the Japanese `corner quote' characters U+300C <IMG SRC="http://charts.unicode.org/Unicode.charts/Small.Glyphs/30/U300C.gif">
and U+300D <IMG SRC="http://charts.unicode.org/Unicode.charts/Small.Glyphs/30/U300D.gif">
(for example) could be used to imply the <CODE>qr</CODE> operator, in the same way that ordinary double quotes presently imply the <CODE>qq</CODE> operator and ordinary backquotes imply the <CODE>qx</CODE> operator.

<P>
Ilya thought it was worth forwarding to <CODE>p5p</CODE>: <A
HREF="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg00623.html">``Once Unicode goes in, one would not be able to change matching rules.
So it should be at least <em>discussed</em> early.''</A> But nobody had anything to
say about it.

<P>



<P>

<H3><A NAME="Lexical_or_dynamic_scope_for_C_u">Lexical or dynamic scope for <CODE>use utf8</CODE>?</A></H3>
<P>
It is presently lexically scoped. There was discussion some weeks ago about
whether to make it dynamically scoped; then the caller of a function could
set the <CODE>utf8</CODE> behavior of the library functions it called. I did not
understand the issues at the time, so I cannot rehash them here.  

<P>
<A
HREF="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg00739.html">Sarathy asked for informed persons to contribute their thoughts</a>, but there
were none. 

<P>



<P>

<H3><A NAME="Full_path_of_cwd_in_C_INC_">Full path of cwd in <CODE>@INC</CODE></A></H3>
<P>
Ed Peschko asked if it would be possible to include the full path of the
current directory in <CODE>@INC</CODE>, rather than just a dot. The usual objections: 1. There is already an easy
way to put the full path in, if that is what you want:  you use
the <CODE>FindBin</CODE> module. 2. It would be expensive for the large population that did not need
it.

<P>

<H3><A NAME="A_Strategic_Decision_to_use_the_">A Strategic Decision to use the Perl Compiler</A></H3>
<P>
Sounds like a bad move to me, but David Falk had this to say for himself:

<P>
<blockquote><A
HREF="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01158.html"> I am CEO of Dionaea Corporation, a software company that
designs performance monitoring tools for UNIX, and we have made the
strategic decision to use the <CODE>perlcc</CODE> compiler as the hub
of our code 
development. Overall this has been a good decision for us, but we have run
into several snags with the compiler.</A></blockquote>

<P>
He then reported the bugs.  They looked pretty simple, but nobody replied.
Scary to think that someone's family might starve in the streets because of
problems in the Perl compiler.

<P>


<P>

<H3><A NAME="Happy_Birthday_Perl_5">Happy Birthday Perl 5</A></H3>
<P>
Actually the real birthday was on 17 October, 1994, but there is an error
in <CODE>perlhist</CODE> so the birthday wishes arrived on the 18th.
(Nobody has supplied a patch yet.)

<P>
<A
HREF="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg00726.html">Chris Nandor submitted a birthday patch.</A>

<P>



<P>

<H3><A NAME="Unicode_Character_Classes_Revisi">Unicode Character Classes Revisited</A></H3>
<P>
<a href="./THISWEEK-19991017.html#charclasses">Last week there was discussion
of use of Unicode properties to define regex character classes</a>.
People interested should also consider reading the <a
href="http://www.unicode.org/unicode/reports/tr18/">Unicode Regular
Expression Guidelines</a>.

<P>

<H3><A NAME="Sarathy_says_Yikes_again">Sarathy says `Yikes' again</A></H3>
<P>
<BLOCKQUOTE>

<A
HREF="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg00598.html">``Yikes, this is one is the size of China.''</A>

</BLOCKQUOTE>

<P>


<P>

<H3><A NAME="Various">Various</A></H3>
<P>
A large collection of bug reports, bug fixes, non-bug reports, questions,
answers, and a small amount of flamage and spam.

<P>
Also, Tuomas Lukka continues to send email with an incorrect
<CODE>Date:</CODE> header.

<P>
Until next week I remain, your humble and obedient servant,

<hr>

<a href="mailto:mjd-perl-thisweek-199910+@plover.com">Mark-Jason Dominus</a>
