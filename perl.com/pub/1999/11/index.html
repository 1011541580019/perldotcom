<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: November 1999 Archives</title>


    <link rel="prev" href="/pub/1999/10/" title="October 1999" />
    <link rel="next" href="/pub/1999/12/" title="December 1999" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">November 1999 Archives</h1>





                            
                            <div id="entry-1838" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/1999/11/sins.html" rel="bookmark">Sins of Perl Revisited</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="1999-11-30T00:00:00-08:00">November 30, 1999 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- <a name="Sins_of_Perl_Revisited">Sins of Perl Revisited</a> -->

<br>
<p><ul>

 <li><a href="#Sins_of_Perl_Revisited">Sins of Perl Revisited</a>
 <ul>
  <li><a href="#1">Implicit Behaviors and Hidden Context Dependencies</a>
  <li><a href="#2">To Paren <code>||</code> <code>!</code> To Paren?</a>
  <li><a href="#3">Global Variables</a>
  <li><a href="#4">References vs. Non-references </a>
  <li><a href="#5">No Prototypes</a>
  <li><a href="#6">No Compiler Support for I/O or Regex Objects</a>
  <li><a href="#7">Haphazard Exception Model</a>
 </ul>
 <li><a href="#New_Problems">New Problems</a>
 <ul>
  <li><a href="#8">The Documentation is Too Big</a>
  <li><a href="#9">The API is Too Complicated</a>
 </ul>

</ul>
<hr size="1" noshade>
<p>
Long ago, back in the Perl 4 days, Tom Christiansen wrote an article called
<cite><a href="/pub/language/versus/perl.html">The Seven Deadly Sins of Perl</a></cite>, describing the biggest problems in the
Perl language at the time. A few years later, he went over the list again
to see how well the problems had been addressed by Perl 5. That was in
1996; I think it's time for another update. Where are we now?

<p>
Tom's original Seven Sins:

<p>
<h3><a name="1">1. Implicit Behaviors and Hidden Context Dependencies</a></h3>

<p>
Every week or so someone shows up in <code>comp.lang.perl.misc</code> asking why this didn't work:

<p>
<pre>
        while (&lt;FILE&gt;) {
          my $line = &lt;FILE&gt;
          # ...
        }
</pre>
<p>
``It seems to be skipping every second line,'' they say. Hmmm. Of course, it
is skipping every second line, because when a <code>&lt;...&gt;</code>
operator is the condition of a <code>while</code> loop, it magically turns into
<code>defined($_ = &lt;...&gt;)</code>. But then a lot of people get confused in the other direction:

<p>
<pre>
        if (something) {
          &lt;FILE&gt;
          print &quot;The next line is ``$_''.\n&quot;;
        }
</pre>
<p>
<code>&lt;...&gt;</code>  <em>only</em>  changes <code>$_</code>  when it is the condition of the
<code>while</code> loop. I wonder if it would have been better to have
<code>&lt;...&gt;</code>  <em>always</em> read into <code>$_</code>
unless assigned somewhere?  Oh well, it's much too late anyway.

<p>
I do see a trend away from these. Here is an example, which is somewhat
obscure, because of the trend. In a regex, <code>^</code> and <code>$</code>
normally match at the beginning and end of the string, respectively. The
regex <code>/^Hello/</code> looks for <code>Hello</code> at the beginning of the string. If your string contains many lines,
separated by <code>\n</code>
characters, you might like to have a regex that looks for <code>Hello</code> at the beginning of any line. The way you did this in Perl 4 (and also Perl
3, 2, and 1) was to set the variable <code>$*</code> to a true value. This changed the meaning of <code>^</code> and <code>$</code> for every regex in the entire program. If you set it and forgot to set it
back, you could get a nasty surprise when other regexes matched when they
shouldn't have. If you were writing a library to be used by other programs,
you'd have to put

<p>
<pre>
        { local $* = 0;
          $target =~ /^regex/;
        }
</pre>
<p>
around every one of your regexes that used <code>^</code> or <code>$</code>; otherwise you could get taken by surprise by an unexpected setting of <code>$*</code>. Of course, most libraries didn't do this. Here's another example: Array
indices normally begin at 0 because the value of <code>$[</code> is normally 0; if you set <code>$[</code> to 1, then arrays start at 1, which makes Fortran programmers happy, and so
we see examples like this in the <code>perl3</code>
man page:

<p>
<pre>
        foreach $num ($[ .. $#entry) {
          print &quot;  $num\t'&quot;,$entry[$num],&quot;'\n&quot;;
        }
</pre>
<p>
And of course you could set <code>$[</code> to 17 to have arrays start at 17 instead of at 0 or 1. This was a great way
to sabotage module authors.

<p>
Fortunately, sanity prevailed.  These features are now recognized to
have been mistakes.  The perl5-porters mailing list now has a
catchphrase for such features: they're called `action at a
distance'. The principle is that a declaration in one part of the
program shouldn't drastically and invisibly alter the behavior of some
other part of the program. Some of the old action-at-a-distance
features have been reworked into safer versions. For example, In Perl
5, you are not supposed to use <code>$*</code>. Instead, you put
<code>/m</code> on the end of the match operator to say that the
meanings of <code>^</code> and <code>$</code> should be changed just
for that one regex. The expected flood of ex-Fortran programmers never
materialized, so <code>$[</code> is highly deprecated, and only
affects code in the current file; it can't be used to sabotage
modules.

<p>
Unfortunately, not enough sanity prevailed, since the ubiquitous <code>$/</code>
variable (input record separator string) is still with us and can cause
plenty of sabotage all by itself.

<p>
This may change soon. A hot topic on the perl5-porters mailing list is
`line disciplines', which means that each filehandle would have its own
private notion of the line terminator, as well as its own notion of other
properties of the input such as the character representation. This would
allow it to translate EBCDIC data into ASCII transparently, or (more to the
point) Latin-1 to Unicode. Still the problem is not likely to go away for
good; variables like <code>$/</code>, <code>$\</code>, <code>$&quot;</code>, and
<code>$,</code> will be with us for a long time.

<p>
Prognosis: Action at a distance is now recognized as a bad thing, and the
old action at a distance features are being converted to safer versions.
But the problem will probably continue for a long time, and very few
modules presently take precautions against seeing a weird
<code>$&quot;</code> or whatever.

<p>
<h3><a name="2">2. To Paren <code>||</code>  <code>!</code>To Paren?</a></h3>

<p>
By this Tom meant weird context traps having to do with the way parentheses
(or lack of parentheses) can drastically alter the meaning of an
expression. Hardly any beginning programmers understand context. Here's a
nice example: This works:

<p>
<pre>
        $n = sprintf(&quot;%d %d&quot;, 32, 49);
</pre>
        
So does this:
<p>
<pre>
        @n = (32, 49);
        $n = sprintf(&quot;%d %d&quot;, @n);
</pre>
<p>
But if you try this you get a surprise:

<p>
<pre>
        @args = (&quot;%d %d&quot;, 32, 49);
        $n = sprintf(@args);
</pre>
<p>
(If you replace <code>sprintf</code> with <code>printf</code>, the surprise goes away. Ugh.)

<p>
People have problems with <code>my $x = ...</code> when they should have written
<code>my($x) = ...</code>. They have the opposite problem, where they write
<code>my ($line) = &lt;FILE&gt;</code> when they should have written <code>my
$line = &lt;FILE&gt;</code>. And of course, they wonder how to find the number of elements in an
array.

<p>
People also want to think that <code>(...)</code> in an expression constructs a list, and they go putting parentheses around
things to make them into lists, which never works, because it's what's on
the left side of the equals sign that determines whether the right side is
a list or not. That's a pretty good rule of thumb, in fact, as long as
you're willing to overlook the <code>x</code> operator: <code>'foo' x 3</code> constructs the string
<code>'foofoofoo'</code>, but <code>('foo') x 3</code> constructs the list <code>('foo',
'foo', 'foo')</code>, equls signs or no equals signs.

<p>
Prognosis: You don't have to love it, but you have to learn to live with
it.

<p>
<h3><a name="3">3. Global Variables</a></h3>

<p>
The prototypical example of this problem is this code:

<p>
<pre>
        while (&lt;FILE&gt;) {
          print if some_function();
        }
</pre>
<p>
That looks harmless, doesn't it? But it's deceptive, because
<code>some_function()</code> calls <code>other_function()</code>, and <code>other_function()</code>
calls <code>joes_function()</code> in the module <code>Joe::Database</code>, and
<code>joes_function()</code> calls <code>load_database()</code>, and <code>load_database()</code>
is 484 lines long and in the middle it says

<p>
<pre>
        while (&lt;DATABASE&gt;) {
          push @records, &lt;DATABASE&gt; if /pattern/;
        }
</pre>
<p>
That <code>while</code> clobbers the value of <code>$_</code>, which
would be OK, except that it clobbers the value of <code>$_</code> way
up in the main program, which was going to print out the value of
<code>$_</code> when <code>some_function</code> finally
returned. Instead, it prints out the empty string. The program fails
and the power plant explodes, poisoning the earth and the sea. 
Famine and disease
sweep the world. All die. Oh, the embarrassment.

<p>
Today <!-- November 26, 1999 --> 
perl5-porters got mail asking why this code destroys the array:

<p>
<pre>
        my @array=(1,2,3);
        foreach (@array) {
          open FILE, &quot;&lt;test&quot;;
          while (&lt;FILE&gt;) {
            ...
          }
          close FILE;
        }
</pre>
<p>
That is a good question. Another good question would be why this code does
<em>not</em> output a bunch of <code>3</code>s:

<p>
<pre>
        my @array=(1,2,3);
        open FILE, &quot;&lt;test&quot;;
        while (&lt;FILE&gt;) {
          foreach (@array) {
          ...
          }
          print;
        }
        close FILE;
</pre>
<p>
Answer: Because <code>foreach</code> automatically saves the old value of its index variable and then restores
the original value when the loop is over.

<p>
This problem has gotten somewhat better in recent years. Auto-localization
in <code>foreach</code> loops was the first step. Encouraging people
to use the new <code>for my $x (...)</code> and <code>while (my $x = ...)</code>
syntax will help with this problem also; anything that gets people to stop
using <code>$_</code> is a step in the right direction.

<p>
Prognosis: Things have gotten better, but have also probably reached the
limit of improvement.  
Module authors must be educated to localize
<code>$_</code> before changing it, and any advance that depends on the education of module
authors is probably doomed. 

<p>
<h3><a name="4">4. References vs. Non-references</a></h3>

<p>
Tom's complaint seems to be that reference syntax is too complicated. I
don't think anyone can argue with that.  Reference syntax is awful.  

It isn't going to get any better,
either.

<p>
Prognosis: Doom and gloom.

<p>
<h3><a name="5">5. No Prototypes</a></h3>

<p>
A common complaint with Perl 4 was that you couldn't write a function like <code>push</code>:

<p>
<pre>
        my_push(@array, 1, 2, 3);
</pre>
<p>
<code>@array</code> would be expanded into a list of elements, and <code>my_push</code>
would never have a chance to operate on the original array. This was fixed
with the <cite>prototype</cite> feature; now you can write <code>my_push</code> like this:

<p>
<pre>
        sub my_push(\@@) {
          my $aref = shift;
          push @$aref, @_;
        }
</pre>
<p>
Prototypes still have some minor but annoying holes. You can't write a
function that behaves like <code>printf</code> with its optional filehandle argument, or like <code>sort</code> with its optional code block argument, or like <code>tied</code> with its any-kind-of-variable argument. You can write a function like <code>lc</code> that takes a single optional argument, but it won't be parsed the same way
that <code>lc</code> is:

<p>
<pre>
        $fred = 'Flooney';
        sub my_lc (;$) {
          if (@_) { lc $_[0] } else { lc $_ }
        }

        print lc $fred, &quot;\n&quot;;
        print my_lc $fred, &quot;\n&quot;;
        
Too many arguments for main::my_lc at /tmp/lc line 7, near &quot;&quot;\n&quot;;&quot;
Execution of /tmp/lc aborted due to compilation errors.
</pre>
<p>
Probably the worst thing about prototypes is the name. When ANSI
standardized the C language in 1989, the big change was to add `prototypes'
to enable compile-time type checking of function arguments. C programmers
learned that you should prototype all your functions to enable these checks
so that you didn't end up passing a pointer to a function that wanted an
integer, or whatever. People have the idea that Perl prototypes are for the
same thing, and in fact they're not.   They do something totally different,
and they don't protect you against this:

<p>
<pre>
        sub foo ($);

        foo(@x);   # whoops, should have been foo($x) instead.
</pre>
<p>
The C programmers would like to think that this will deliver a compile-time
error that says `Hey, dummy! You used an array when you meant to use a
scalar!' which would make it easier to debug. No, Perl  takes the prototype as an indication that you would like the
array automatically converted to a scalar, and passes the number of
elements in the array to <code>foo()</code>. This will make it harder to debug, not easier.

<p>
Prognosis: The remaining technical problems with prototypes are pretty
small and may get smoothed out eventually. Better type checking of function
arguments may arrive eventually also; there's been talk for a long time
about function declarations of the form 

<p>
<pre>
        sub foo (Dog, Cat) { ... }
</pre>
<p>
which would make sure you were passing objects of the appropriate classes,
and support for this has been going in a bit at a time. See
<code>perldoc fields</code> for example.  This, however, will compound
the problems of people trying to get C programmers to stop using
prototypes for compile-time type checking.  Expect more confusion
here, not less.  <!-- All hail Discordia. -->

<p>
<h3><a name="6">6. No Compiler Support for I/O or Regex objects</a></h3>

<p>
This got a lot better between Tom's first and second reports, so much
so that he regarded it as fixed.  I think the credit for this on the
regex side mostly goes to Ilya Zakharevich; I don't know who gets the
credit on the I/O side; probably Larry Wall and Graham Barr.

Since Tom's last report, it's been fixed even better: You can say

<p>
<pre>
        open my $fh, $filename;
</pre>
<p>
and <code>$fh</code> will be autovivified to be a filehandle open to the specified file; when
<code>$fh</code> goes out of scope, the file will be closed automatically.
This means that you don't have to worry about using global filehandle names
any more.  Another useful use of C&lt;local> down the drain, and good riddance.

<p>
Prognosis: Essentially fixed, despite a few lingering problems.

<p>
<h3><a name="7">7. Haphazard Exception Model</a></h3>

<p>
Tom says: ``There's no standard model or guidelines for exception handling
in libraries, modules, or classes, which means you don't know what to trap
and what not to trap. Does a library throw an exception or does it just
return false?''

<p>
This problem persists. Every module does something different. C programmers
used to complain that having to explicitly check every system call for an
error return made their code four times as big; in Perl the problem is
worse because every check looks a little different.  

<p>
Modules persist in issuing warning messages with no way to get them to
shut up. Modules call <code>die</code> and take you by surprise when
you thought you were going to get a simple error return. The standard
modules have been substantially cleaned up in this regard since 1996,
thank goodness.

<p>
Here's another problem: Exceptions and <code>die</code> are the same thing in Perl, which sometimes surprises people. Someone wrote
into perl5-porters recently about a library function that was going to run
a subprocess. The <code>fork()</code> succeeded but the <code>exec()</code> failed, so the child process called <code>die</code>. That was usually the right thing to do. In this case, however, the
library function had been called inside of an <code>eval</code> block, which trapped the child's <code>die</code>. The original process was still waiting for the child to complete, but the
child was going ahead, thinking it was the parent!  

<p>
Groundwork for rationalization has been laid here; recent versions of Perl
let you throw any sort of object with <code>die</code>, not just a string. Using these objects you could propagate complex kinds
of exceptions in your programs. But as far as I know these features are
little-used. There are several modules that provide <code>try</code>-<code>catch</code>-<code>cleanup</code>
syntax, but as far as I know they're also little-used. And there are no
widely accepted guidelines for the behavior of modules.

<p>
Prognosis: This is a social problem, not a technical one. The only
answer is education, possibly headed by a crusader, or many crusaders.

<p>
<hr size="1" noshade>
<!-- <a name="New_Problems">New Problems</a> -->
<p>
To replace the two problems that have been solved (lack of prototypes and
compiler support for IO and Regex objects) I'd like to add two new problems
to this list:

<p>
<h3><a name="8">8. The Documentation is Too Big</a></h3>

<p>
The Perl 1 documentation was 2,000 lines long, which is already pretty big.
The documentation for the current development release is 72,000 lines long,
not counting developer-only documentation like the
<code>Changes</code> files. It is difficult for beginners to know where to start, and it's
difficult for anyone to know where to find any particular piece of
information. The existing documentation includes a bunch 
of <!--useless crap like--> stuff like <code>perlhist</code> and <code>perlapio</code>
that should have been buried in a subdirectory somewhere instead of
alongside <code>perlfunc</code>.

<p>
The manual keeps getting bigger and bigger, because while it's easy to
see and appreciate the value of any particular addition, it's much
harder to appreciate the negative value of having an 0.01% larger
documentation set. So you have a situation where someone will come
along and say that they were confused by X, and that the manual should
have a more detailed explanation of X, and it will only take a few
lines. Nobody is willing to argue against the addition of just a few
lines, because there's no obvious harm, but then after you've done
that 14,000 times, the manual's usefulness is severly impaired.

<p>
Similarly, it's hard to seriously suggest that the manual be made shorter.
Making manuals shorter is at least as hard as making programs shorter. You
can't just cut stuff out; you have to reorganize and rewrite.

<p>
Short of throwing the whole thing away and starting over, some things that
might help: The trend over the past few years seems to be toward a
separation of reference material from tutorial material. It might be good
for this to continue. The existing documentation needs reorganization; it's
not clear what is `Syntax' rather than `Operators' or `Functions'. (If I
knew how to do this, I would say so.) Right now the overall structure is
flat; I think it might be a step forward if the documentation were simply
divided into a few subdirectories called `Tutorials', `Internals',
`Reference', `Social', and so on. Perl needs to come with better
documentation browsing tools, and maybe more important, there needs to be a
better search interface on the web. Better indexing of the exiting
documentation would help to enable this.

<p>
Prognosis: Poor. Very little work is being done on the documentation except
more of the same. Everyone wants to write; nobody wants to index.

<p>
<h3><a name="9">9. The API is Too Complicated.</a></h3>

<p>
Writing Perl extensions is too hard. You have to understand XS. Existing
documentation of XS is very sketchy.  

<p>
If what you want to do is just to glue existing C functions into Perl,
packages like SWIG and <code>h2xs</code> are a big help here. If you
want to do anything the slightest bit offbeat, you're on your own.

<p>
What would help here? Better documentation. The example discussed in the
existing <code>perlxs</code> manual is an interface to the <code>rpcb_gettime</code>
function, whatever the heck that is. If you don't have it on your system,
and you probably don't, you can't try out the example. There's too much
dependency between the <code>XS</code> man pages and the
<code>perlguts</code> man page; someone needs to go over these and reorganize them into a series
of documents that can be read in order.  

<p>
I once asked Larry why XS is so complicated, and he said that it was like
that to make it efficient. It would be nice if there were a kind of
extension glue that was simpler to write even if it were less efficient.

<p>
Prognosis: Mixed. Glue makers like SWIG and Ken Fox's C++ kit seem to
be maturing nicely. But the documentation problem is not being
addressed, and the real underlying problem, which is that Perl's
internals are too complicated and irrational, is probably
insoluble. The Topaz (Perl 6) project might fix this.


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1846" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/1999/11/p5pdigest/THISWEEK-19991128.html" rel="bookmark">This Week on p5p 1999/11/28</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="1999-11-28T00:00:00-08:00">November 28, 1999 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- This week on perl5-porters (22-28 November 1999) -->

<br />
<br />      </P>


<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#New_Meta_Information_">New Meta-Information </a>
  <li><a href="#Thread_Model_Discussion">Thread Model Discussion</a>
  <li><a href="#Discussion_of_Line_Disciplines_Continues">Discussion of Line Disciplines Continues</a>
  <li><a href="#Shadow_Passwords">Shadow Passwords</a>
  <li><a href="#Bugs_in_NT_Perl_Sockets?">Bugs in NT Perl Sockets?</a>
  <li><a href="#Run_Out_of_File_Descriptors">Run Out of File Descriptors</a>
  <li><a href="#Lexical_Variable_Leak">Lexical Variable Leak</a>
  <li><a href="#Control_Backslash">Control-Backslash</a>
  <li><a href="#Bitwise_Operators">Bitwise Operators</a>
  <li><a href="#Taint_Bug?">Taint Bug?</a>
  <li><a href="#next_Outside_a_Block"><tt>next</tt> Outside a Block</a>
  <li><a href="#Quiet_List">Quiet List</a>
  <li><a href="#Various">Various</a>
</ul>

<P>

<H3><a name="Notes">Notes</a></H3>

</P>

<P>
This report is very late, because I was in London from 26--29
November, and then when I got back I had to finish preparing class
materials for a class I was teaching in Chicago from 6--8 December,
and when I got back from 
<i>that</i>  I had to prepare class materials for
a class I was teaching in New York from 14--16 December.  Then I had
to recover.  Now I'm going to try to catch up on reports.  My
apologies for the delay.
<H4><a name="New_Meta_Information_">New Meta-Information </a></H4>

</P>

<P>

The most recent report will always be available at 
<a href="/p5pdigest.cgi">http://www.perl.com/p5pdigest.cgi </a>.
</P>

<P>
You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>mjd-perl-thisweek-YYYYMM@plover.com</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
<H3><a name="Thread_Model_Discussion">Thread Model Discussion</a></H3>

</P>

<P>

In the last report, I posted an explanation by Dan Sugalski of the
current threading model and the new one that would be used in 5.005_53.
<a href="/pub/1999/11/p5pdigest/THISWEEK-19991121.html#Shared_Interpreter_threads_the_current_model">(Here it is.)</a></P>

<P>

This reopened debates about the feasibility of the new model, and Dan,
Sarathy, and Ilya had a medium-long discussion about it.  The debate
centered around how much stuff gets cloned when you fork a new
thread/process.  Here's my probably-too-brief summary: Under the new
model, when you start a new thread, the Perl stack is cloned and each
thread gets a separate clone.  But you can also request 
<CODE>fork()</CODE>-like semantics, in which case all global variables also get
cloned.  This will allow forkless Windows platforms to emulate 
<CODE>fork()</CODE> with threads.  In either case, the op tree (which is
read-only) is shared between threads.
</P>

<P>
The debate centered around the largeness of the amount of data that
would need to be cloned.   
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00925.html">Sarathy claims that even in the <CODE>fork</CODE> case the op tree outeighs the global data by a factor of 8.</a>
</P>

<P>
The whole discussion was very interesting and is recommended reading.  
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00912.html">The top of the discussion is here.</a></P>

<P>
This and the ensuing discussion is worth reading if you are interested
in the changes in Perl's threading model.
</P>

<P>

<H3><a name="Discussion_of_Line_Disciplines_Continues">Discussion of Line Disciplines Continues</a></H3>

</P>

<P>
Much interesting discussion about line disciplines continues, this
time in the context of having 
<CODE><></CODE> and 
<CODE>chomp()</CODE> behave properly,
even when you have a remote-mounted NT fileststem where the files have 
<CODE>\r\n</CODE>-terminated lines.  Goal:  Perl should do the `right thing'
regardless of where the file is located.  The subtext here is that
Perl should also do the `right thing' when reading from an ISO-Latin-1
file, an EUC-KR encoded file in Korean, or a SHIFT-JIS encoded file in
Japanese.  
<blockquote><b>Larry:</b> I expect people to expect Perl to do the right thing.</blockquote></P>


<P>

<a href="/pub/1999/11/p5pdigest/THISWEEK-19991121.html#Chomp">Earlier Discussion</a></P>

<P>

<a href="/pub/1999/11/p5pdigest/THISWEEK-19991114.html#More_About_Line_Disciplines">Still Earlier Discussion</a></P>

<P>

<a href="/pub/1999/11/p5pdigest/THISWEEK-19991107.html#Record_Separators_that_Contain_NUL">Guess What</a><H3><a name="Shadow_Passwords">Shadow Passwords</a></H3>

</P>

<P>

Jochen Wiedmann compained abuot the support for shadow password
files.  If your vendor supprots them transparently via the usual 
<CODE>getpw*</CODE> calls, Perl supports them too; otherwise you're out of luck.  In fact
this is a frequently asked question:  How to get the shadow password?
</P>

<P>
There are at least two schools of thought on this.  School of thought #1 is that when you make a  
<CODE>getpw*</CODE> call, you should get back the usual seven items, except that if
you're on a system with shadow passwords and you're not rnuning as
root, you get back 
<CODE>x</CODE> or 
<CODE>*</CODE> or some such instead of the real password; thus no new interface is required.
 The author of the man page (see 
<CODE>perlfunc/getpwent</CODE>) apparently subscribes to this school of thought.
</P>

<P>
School of thought #2 is that 
<CODE>getpw*</CODE> should always return a password of 
<CODE>x</CODE>, and instead there should be special calls, probably named 
<CODE>getsp*</CODE> or something similar, for reading the shadow password file.
</P>

<P>
Advantages of school #1: No program needs to be rewritten or even
modified when you switch from traditional password style to shadow
passwords.  Advantages of school #2: No program will get the passwords
written into its memory unless it specifically asks for them,
regardless of whether or not it happens to be run by root; having
programs suddenly become riskier just because they are running as root
is a Bad Thing.
</P>

<P>
Anyway, Sarathy reports that as of 5.005_57, Perl has gone entirely
over to school #1 and will emulate that behavior even if you are on a
system that belongs to school #2.  If you call any of Perl's 
<CODE>getpw*</CODE> functions, and your program is running as root, then Perl will make a 
<CODE>getsp*</CODE> call to fill in the password as if it had been returned by the 
<CODE>getpw*</CODE> call in the first place.
</P>

<P>
I seem to remember that debate on whether or not this was advisable
continued the following week, so I'll follow up in the next report.
<H3><a name="Bugs_in_NT_Perl_Sockets?">Bugs in NT Perl Sockets?</a></H3>

</P>

<P>

Phil Pfeiffer posted an interesting analysis of peculiarities of
Perl network sockets under NT.  I found these interesting, but there
was no discussion. Of course, it is probably NT's fault, but it would
be nice to see these fixed anyway.  As Larry has said ``The Golden
Gate wasn't our fault either, but we still put a bridge across it.''
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00898.html">Read it.</a></P>

<P>

<H3><a name="Run_Out_of_File_Descriptors">Run Out of File Descriptors</a></H3>

</P>

<P>
Yossi Klein was puzzled because Perl limited him to 256 open files,
even when he used 
<CODE>sysopen</CODE> to try to open the files without using the Standard I/O library.  Of
 course, even if you use 
<CODE>sysopen</CODE>, it then takes the file descriptor that it gets from the system and
attaches it to a filehandle, and that means it uses 
<CODE>fdopen</CODE> to create the stdio stream structure, and there's Standard I/O again.
<H3><a name="Lexical_Variable_Leak">Lexical Variable Leak</a></H3>

</P>

<P>

Barrie Slaymaker reported a bug in 5.005_61 in which a lexical
variable in one file leaked into a different file that was being
processed by 
<CODE>do</CODE>.
<H3><a name="Control_Backslash">Control-Backslash</a></H3>

</P>

<P>

The discussion about semantics of control-backslash in a double-quoted
string continued much longer than it should have, with the original
correspondent proposing every possible alternative set of rules, and
Ilya Zakharevich pointing out what was wrong with all of them.  The
original querent finally gave in.
<H3><a name="Bitwise_Operators">Bitwise Operators</a></H3>

</P>

<P>

Someone was caught by the changed behavior of the 
<CODE>&</CODE> operator
between Perl 4 and Perl 5.  Tom Christiansen posted
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00950.html">a clear explanation.</a>  For some reason this topic was omitted from 
<CODE>perltrap</CODE>.
</P>

<P>
The discussion then turned towards how you can tell whether or not a
string has ever been used in a numeric context.  Larry suggested:
</P>

</P><PRE>
	length($x & "")
</PRE>

<P>
Tom Phoenix posted a patch to add an explanation to 
<CODE>perltrap</CODE>.
<H3><a name="Taint_Bug?">Taint Bug?</a></H3>

</P>

<P>

David Muir Sharnoff appears to have found a case where doing a match
and copying data into 
<CODE>$1</CODE> yields a tainted value instead of
an untainted one.  There was no discussion and I did not see a
patch.  (I should mention that starting this week I began to
watch the patch FTP directory, but because of my travel schedule I did
not have time to understand the patches.)
<H3><a name="next_Outside_a_Block"><tt>next</tt> Outside a Block</a></H3>

</P>

<P>

Someone complained that 
</P>

</P><PRE>
	map { next if ... } ... ;
</PRE>

<P>
yields the error message `Can't &quot;next&quot; outside a block'.
He claimed that the message was bad because clearly the 
<CODE>next</CODE> is in
a block.  Larry agreed that it should say `loop' instead of `block'.
I didn't see a patch, however.
</P>

<P>

<H3><a name="Quiet_List">Quiet List</a></H3>

</P>

<P>
Traffic was low for a while, so Nat Torkington sent out a ping
message:
<blockquote><b>Nat:</b> Just testing whether all of p5p has fallen quiet, or whether the mailing list manager is constipated.<br><b>Kurt Starsinic:</b> The perl5-porters are on vacation, and will be until noon on November 25.  If your need is urgent, please contact <tt>python-help@python.org</tt>. <br>Thank you. </blockquote></P>

<P>

</P>

<P>

<H3><a name="Various">Various</a></H3>

</P>

<P>
A large collection of bug reports, bug fixes, non-bug reports,
questions, answers, spam, and a small amount of flamage.
</P>

<P>
Until next time (probably Tuesday or Wednesday) I remain, your humble
and obedient servant,
</P>

<hr>

<a href="mailto:mjd-perl-thisweek-199911+@plover.com">Mark-Jason Dominus</a>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1844" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/1999/11/p5pdigest/THISWEEK-19991121.html" rel="bookmark">This Week on p5p 1999/11/21</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="1999-11-21T00:00:00-08:00">November 21, 1999 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <h2>This week on perl5-porters
<br /> (15-21 November 1999)</h2>

<br />
<br /><ul>
  <li><a href="#Notes">Notes</a> </li>
  <li><a href="#XSLoaderpm"><code>XSLoader.pm</code></a> </li>
  <li><a href="#Threads">Threads</a> </li>
  <li><a href="#Shared_Interpreter_threads_the_current_model">Shared Interpreter 
    threads (the current model)</a> </li>
  <li><a href="#Cloned_interpreter_threads_upcoming_in_5005_63">Cloned interpreter 
    threads (upcoming in 5.005_63)</a> </li>
  <li><a href="#chomp"><code>chomp()</code></a> </li>
  <li><a href="#Threading_and_Regexes">Threading and Regexes</a> </li>
  <li><a href="#Safe::Hole"><code>Safe::Hole</code></a> </li>
  <li><a href="#PREPARE"><code>PREPARE</code></a> </li>
  <li><a href="#Marshalling_Modules">Marshalling Modules</a> </li>
  <li><a href="#Local_Address_in_LWP">Local Address in <code>LWP</code></a> </li>
  <li><a href="#localizing_select_and_chdir"><code>local()</code>izing <code>select()</code> 
    and <code>chdir()</code></a> </li>
  <li><a href="#Wandering_Environment">Wandering Environment</a> </li>
  <li><a href="#Localized_Assignment">Localized Assignment</a> </li>
  <li><a href="#goto_out_of_scope_of_local"><code>goto</code> out of scope of 
    <code>local</code></a> </li>
  <li><a href="#use_foo_if_bar;"><code>use <var>foo</var> if <var>bar</var></code>;</a> 
  </li>
  <li><a href="#croak_confounds_eval"><code>croak</code> confounds <code>eval</code></a> 
  </li>
  <li><a href="#Control_backslash">Control-backslash</a> </li>
  <li><a href="#Empty_Conditional_in_while">Empty Conditional in <code>while()</code></a> 
  </li>
  <li><a href="#Undefined_Function_Warning">Undefined Function Warning</a> </li>
  <li><a href="#Static_Extensions">Static Extensions</a> </li>
  <li><a href="#POD_Hack">POD Hack</a> </li>
  <li><a href="#Perl_Art">Perl Art</a> </li>
  <li><a href="#localtime_Contest_Continues"><code>localtime()</code> Contest 
    Continues</a> </li>
  <li><a href="#Various">Various</a> </li>
</ul>

<h3><a name="Notes" id="Notes">Notes</a></h3>

<p>
I thought it was going to be a quiet week, but then bang, 140 messages
arrived on Friday.  Fortunately for you, most of them are ignorable.
Did I mention that these reports are made possible through the
generosity of O'Reilly and Associates, who pay me a salary?
</p>

<p>
Next week's report will be late, because on Sunday I will be in
London with the Perl Mongers.  Expect the next report sometime in
early December.
</p>

<p>
You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></p>

<p> Please send corrections and additions to <code>mjd-perl-thisweek-YYYYMM@plover.com</code> 
  where <code>YYYYMM</code> is the current year and month. </p>
<h3><a name="XSLoaderpm" id="XSLoaderpm"><code>XSLoader.pm</code></a></h3>

<p>

Ilya contributed a new module, 
<code>XSLoader</code>, which is a cut-down version of 
<code>Dynaloader</code>.  It uses less memory and has a simpler interface.  He patched the
standard dynamically-loaded modules to use 
<code>XSLoader</code> instead of 
<code>DynaLoader</code>.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00585.html">Read about it.</a></p>

<h3><a name="Threads" id="Threads">Threads</a></h3>

<p> Dan Sugalski submitted a patch that makes a new locking macro available to 
  XS code, but Sarathy said: </p>
<blockquote>Every time I see people patching <code>USE_THREADS</code> code I wonder if it's all going to be for nothing.  I don't see much hopefor salvaging the existing model of <code>USE_THREADS</code> where prolific locking is needed.</blockquote></P>

<p> In case you missed the point of this: 5.005_63 is going to have a drastically 
  different threading model than previous versions of Perl. I asked Dan to explain 
  the two models to me, and he very kindly contributed the following: </p>
<hr />

<h4><a name="Shared_Interpreter_threads_the_current_model" id="Shared_Interpreter_threads_the_current_model">Shared Interpreter threads (the current model)</a></h4>

<p>
This threading model corresponds pretty closely to what most folks
think of when they think of threads. There is a single, shared
executable (or optree, in perl's case), and a single pool of
variables. Any thread can see, and affect, anything that's in its
lexical scope. Data sharing between threads is cheap, but the onus is
on the programmer to maintain consistency.
</p>

<p> As an analogy, consider a thread a hamster, and your program as a giant habitrail. 
  Starting another thread means releasing another hamster into the environment. 
  Threads don't really collide (You ever see two hamsters get stuck in a habitrail 
  tube?) but the only thing that keeps two or more hamsters from running on an 
  exercise wheel at once is careful design of the set. </p>
<h4><a name="Cloned_interpreter_threads_upcoming_in_5005_63" id="Cloned_interpreter_threads_upcoming_in_5005_63">Cloned interpreter threads (upcoming in 5.005_63)</a></h4>
<p>

This threading model corresponds more to the traditional unix fork model.
There is one copy of the optree per thread. One thread can't see or affect
anything in another thread unless that thing is explicitly shared. Data
sharing and coordination between threads is mildly expensive and a bit
cumbersome, but the onus is on the perl interpreter to keep one thread from
messing with another thread's toys.
</p>

<p>
Continuing the hamster analogy, creating a new thread in this model gets
you a whole new, separate habitrail for your new hamster. The two
habitrails may share exercise wheels, but only at very specific, explicit
spots, and there are little exclusion gates built in so only one hamster
can be on a wheel at once.
</p>

<p>

My personal preference is a bit mixed--I want shared threads because they
let me build all sorts of cheap, nifty tools (Threaded objects, and a
subclassable 
<code>Thread::Object</code>, are I&lt;trivial>. I know, I wrote a package to do
it. One thread per object. Wheee!), but I think most folks (including me,
when writing 'normal' code) are better off with the protection cloned
threads get you. 
</p>

<p>
The trickier bit is under the hood. Getting perl thread-safe (which is to
say, it won't core or segfault if the programmer doesn't sync access) is a
PITA. I've already run through a couple of different plans--the first was
paranoid and I, the second bloated 
<code>libperl.so</code> with a lot of shadow
routines for XS, and the third I'm not gonna bother with if threads are
dead anyway.
</p>

<p>
It does chew up more memory, too. To do it right means each and every
variable needs a mutex as well, otherwise you run into deadlock issues and
uneccesary lock contention. 'Course, it makes 
<code>$foo[time]</code> cost even more
than it does now. The alternative is &quote;just don't do that&quote;, but that's not
really an option I like. 
</p>

<p> Most of the p5p folks with an opinion prefers the forkish version. I think 
  they're all wrong, of course, but that's just me. :-) </p>
<hr />

<p>
Thank you very much, Dan.
</p>

<p>
Dan requested that Sarathy commit one way or the other on the existing
threading model.  Sarathy said that he wasn't sure yet, because he needs
to see how the new way works out, but he guesses that Perl will go
with the new way.
</p>

<h3><a name="chomp" id="chomp"><code>chomp()</code></a></h3>

<p>
Ben Tilly askied if perhaps 
<code>chomp()</code> could be made to chomp any of 
<code>"\n"</code>, 
<code>"\r"</code>, or 
<code>"\r\n"</code>.  Of course, this is out of the question.
</p>

<p>
Mike Guy pointed out, and others concurred, that the correct solution
here is for the I/O subsystem to figure out what kind of file it is
reading and translate the line endings to 
<code>\n</code> regardless of what they might have been originally.  This then falls
 under the general heading of `line disciplines'.
</p>

<p>

<a href="/pub/1999/11/p5pdigest/THISWEEK-19991114.html#More_About_Line_Disciplines">Earlier discussion.</a></p>

<p> <a href="/pub/1999/11/p5pdigest/THISWEEK-19991107.html#Record_Separators_that_Contain_NUL">Still 
  earlier discussion.</a></p>
<blockquote><b>Larry Wall:</b> Seriously, we are entering an era when dwimmerly action on input will be a necessary evil.  I could wish it were otherwise, but my supply of divine fiats is low. </blockquote></P>

<h3><a name="Threading_and_Regexes" id="Threading_and_Regexes">Threading and Regexes</a></h3>

<p>
A few weeks ago Rob Cunningham reported that he and Brian Mancuso at
MIT were working on fixing regexes under threaded Perl.  On Friday,
Brian wrote in with his patch.  Ilya did not like it because it
indirects the match variables through a global variable rather than
through the pads (which is the right approach), and because he thinks
the MIT solution will be slow.  Rob replied that they need it to work
now, and it is more important for it to work than for it to work
speedily.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00853.html">Sarathy's reply to the patch </a></p>

<p>
 is probably the most illuminating.  Rob said that they probably
 don't have time to do it the right way.
</p>

<h3><a name="Safe::Hole" id="Safe::Hole"><code>Safe::Hole</code></a></h3>

<p>
Yasushi Nakajima announced a new module, 
<code>Safe::Hole</code>, which allows you to install a subroutine  into a 
<code>Safe</code> compartment so that it can be called by code in the compartment but
still run in the original compartment; similarly you can install an
object
into a compartment so that method calls on the object proceed outside
the compartment.  Yasushi's example is:
</p>

<p> Suppose you have a CGI program that wants to evaluate some user code in a 
  safe compartment and to give it access to the <code>CGI</code> object. Just 
  installing the <code>CGI</code> object into the compartment is not enough because 
  then the object's methods are inaccessible. Instead, wrap up the <code>CGI</code> 
  object in a <code>Safe::Hole</code> object and install the <code>Safe::Hole</code> 
  object into the compartment. Now you can make method calls on the <code>Safe::Hole</code> 
  object inside the compartment and they will be forwarded to the appropriate 
  subroutines outside. </p>
<h3><a name="PREPARE" id="PREPARE"><code>PREPARE</code></a></h3>

<p>

(
<a href="/pub/1999/10/p5pdigest/THISWEEK-19991017.html#prepare">Earlier summary</a>)
</p>

<p>
Following 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg00356.html">Sarathy's earlier request</a>, Ilya reworked his earlier
<code>PREPARE</code> patch  so that invocation of 
<code>PREPARE</code> methods is enabled by a compile-time pragma.
</p>

<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00882.html">The patch.</a></p>

<h3><a name="Marshalling_Modules" id="Marshalling_Modules">Marshalling Modules</a></h3>

<p>

David Muir Sharnoff has some module which, like 
<code>MLDBM</code>, needs to talk to an unknown marshalling module such as 
<code>Storable</code> or 
<code>Freezethaw</code>.  
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00567.html">Last week</a>, he noted that 
<code>MLDBM</code> contained a lot of code that informed it about how to talk to these
various serializers.    David suggested that authors of marshalling
modules try to adhere to a common intereface.
</p>

<p>
Raphael Manfredi, one of the authors of 
<code>MLDBM</code>, said that this would be unlikely, since the various marshalling
modules have different interfaces for a good reason, namely that they
do not all do the same thing.  For example, 
<code>Storable</code> has an 
<code>nstore</code> method that guarantees network byte order.  But byte order is
totally
 irrelevant to the representation used by 
<code>Data::Dumper</code>.
</p>

<p> David then suggested that someone extract the serializer-interface code from 
  <code>MLDBM</code> so that it could be borrowed by other modules that need serializers. 
  If anyone was looking for a useful project to do, this might be a good opportunity. 
</p>
<h3><a name="Local_Address_in_LWP" id="Local_Address_in_LWP">Local Address in <code>LWP</code></a></h3>

<p> <a href="../10/THISWEEK-19991031">A few weeks ago</a> Gisle Aas suggested 
  having <code>IO::Socket</code> pay attention to the <code>LocalAddr</code> environment 
  variable. This week, <a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00577.html">Graham 
  explained why this would be a bad idea</a>. </p>
<h3><a name="localizing_select_and_chdir" id="localizing_select_and_chdir"><code>local()</code>izing <code>select()</code> and <code>chdir()</code></a></h3>

<p> Jeff Pinyan suggested that <code>local()</code> be extended to apply to these, 
  although he did not provide a patch. I pointed out that such semantics are already 
  implemented by modules like <code>SelectSaver</code>, and that the <code>Alias</code> 
  module shows how an XS module can export arbitrary semantics into a block that 
  will be undone automatically when the block is exited. I also pointed out (apparently 
  unintelligibly, since Sarathy repeated it in the next message) that it owuld 
  be easy to write an XS module which specifies that an arbitrary user-supplied 
  anonymous function be invoked at block exit time; then it would be easy to write 
  a <code>temp_chdir()</code> function whose effect was automatically undone at 
  the end of the block. Someone should write this. </p>
<h3><a name="Wandering_Environment" id="Wandering_Environment">Wandering Environment</a></h3>

<p>

Joerg Schumacher found a core-dmuping bug.  Here is the explanation:
He uses the 
<code>Term::Readline::Gnu</code> module.  When this is laoded, it checks for 
<code>LINES</code> and 
<code>COLUMNS</code> environment variables and installs them if they are not present.  It
uses the 
<code>putenv</code> function for this, and in this case 
<code>putenv</code> relocates the entire environment.  Later, he uses the 
<code>%ENV</code> hash to set an environment variable.  Normally, the first time you
set an environment variable, perl relocates the environment elsewhere
so that it can do memory management on it in a more convenient way,
including freeing individual environment variable strings.  How does
Perl know whether it is the first time or not?  It compares the current
location of the environment (
<code>environ</code>) with the location that the environment was
in at the time perl started (
<code>PL_origenviron</code>); if they are the same, it relocates the environment.   
</p>

<p>
However, in Joerg's case, the environment had already been relocated
by 
<code>putenv()</code>.  The `first-time' test failed when it should have succeeded, and
Perl supposed that it had already 
relocated the environment itself.  Then it tried to do memory
management on the environment which it thought it had but allocated
but had not, and the
result was a core dump.  Joerg supplied a patch that has perl keep an
explicit boolean variable that records whether or not it has moved the
environment, instead of depending on the hack of testing to see
whather or not it is in the same place it was when Perl started.
</p>

<p>
Ilya appeared not to understand the problem description, and argued
with Joerg a lot, but if there was anything in his 
argument I was not able to discern it.  Joerg was remarkably patient
through all of this.
</p>

<p>
Then Tom and Ilya had a big worthless argument which should have been
carried on in private email.  
<!-- No duh, it is my opinion.  Whose opinion were you expecting? --></p>

<p> There were fifty-four messages in this thread. I will generously award it 
  a S/N ratio of 1.21e-01. </p>
<h3><a name="Localized_Assignment" id="Localized_Assignment">Localized Assignment</a></h3>


<p>
Andre Pimlott reported that 
</p>

<pre>
 { local ($/ = undef); ... }
</pre>

<p> not only doesn't do what was wanted, but doesn't appear to do anything sensible 
  at all. (For example, someone suggested that it does the assignment to <code>$/</code> 
  first, and then localizes, but this appears not to be so.) It appears to be 
  a real bug. </p>
<h3><a name="goto_out_of_scope_of_local" id="goto_out_of_scope_of_local"><code>goto</code> out of scope of <code>local</code></a></h3>


<p>
Ilya complained that using magical 
<code>goto</code> to exit the scope of a 
<code>local</code> undoes the localization:
</p>

<pre>
 $a = 5;
 sub a { print $a }
 sub b {local $a = 9; goto &a}
 b();
</pre>

<p>
This prints 5, and he wants it to print 9.
(Note that Ilya's original report contains an error; he has 
<code>local $b</code> instead of 
<code>local $a</code>.)  The reason he wants this is so that he can do:
</p>

<pre>
 local @ISA = (@ISA, 'DynaLoader');
 goto \&DynaLoader::bootstrap;
</pre>

<p>
Nick Ing-Simmons suggested that he do this instead:
</p>

<pre>
 {
   local @ISA = (@ISA, 'DynaLoader');
   &DynaLoader::bootstrap;
 }
</pre>

<p>
Of course, that leaves the original call on the call stack so that
(for example) messages from 
<code>Carp</code> might be confused about where to report an error from.  In the case
of 
<code>Carp</code> there actually is no problem.  Discussion ended abruptly.
</p>

<h3><a name="use_foo_if_bar;" id="use_foo_if_bar;"><code>use <var>foo</var> if <var>bar</var></code>;</a></h3>

<p>
Ilya contributed a patch to enable this syntax, and similarly 
<code>unless</code>.  It does this by faking up a 
<code>BEGIN</code> block, but without the scoping effects of a real block.  (The scoping
 effects are the reason why the programmer cannot simply use 
<code>BEGIN</code> here in the first place.)  
</p>

<p>
Steve Fink contributed an amendment to Ilya's patch.  Tom Christiansen
sent a giant message complaining that the feature was yet another
weird special case.  Some discussion of alternatives ensued, with no
conclusion that I could see.
</p>

<p>
Tom Christiansen suggested a 
<code>no scope</code> pragma, which would `erase' one set of braces.  Then you
could say something like
</p>

<pre>
 BEGIN {
   no scope;
   if (SOMETHING) {
     no scope;
     use integer;
   }
 }
</pre>

<p>
And the 
<code>no scope</code> declarations would upscope the effectof the 
<code>use integer</code> pragma so that its effect continued to the end of the file.
</p>

<p>
Larry had
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00866.html">many interesting things to say about this</a>; the most straightforward was that something like
<code>use comppad</code> should just upstack declarations all the way to the top of whatever
code was currently being compiled.
</p>

<p>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00873.html">Ilya said</a> that that behavior was already available to any module that uses the
 hints variables 
<code>$^H</code> or 
<code>%^H</code>.
</p>

<h3><a name="croak_confounds_eval" id="croak_confounds_eval"><code>croak</code> confounds <code>eval</code></a></h3>

<p>
David Blumenthal reported a problem in 
<code>IPC::Open3</code>:  It forks a child, which tries to exec your command, and if it
can't, the child croaks.  If the  
<code>open3</code> call was inside an 
<code>eval</code> block, that means that the child returns from the 
<code>eval</code> block without exiting and your program gets a big surprise.  David
suggests that it should use  
<code>carp</code> instead and then call 
<code>exit</code>.
</p>

<p> I mention this because probably a lot of other modules have similar problems. 
  Modules should never call <code>croak</code> or <code>die</code>. </p>
<h3><a name="Control_backslash" id="Control_backslash">Control-backslash</a></h3>

<p>

Philip Newton pointed out that there was no way to generate a
control-backslash using the 
<code>\c</code> notation.  Neither 
<code>"\c\"</code> nor 
<code>"\c\\"</code> works.  The first complains about an unmatched quotation mark, 
and the second generates a control-backslash followed by a regular
backslash.  (
<code>\x1c</code> and the like do work.)
</p>

<p> The reason for this is explained in detail in <code>perlop</code>, in the 
  section titled `Gory details of parsing quoted constructs'. </p>
<h3><a name="Empty_Conditional_in_while" id="Empty_Conditional_in_while">Empty Conditional in <code>while()</code></a></h3>

<p>
Greg Bacon reported that 
</p>

<pre>
 while () { CODE }
</pre>

<p>
is legal, and is an infinite loop.  This turns out not to be a bug; it
is because you are supposed to get an empty loop if you leave out the
condition in a 
<code>for (;;)</code> block, and 
<code>for(;;)</code> and 
<code>while()</code> are the same thing.  Larry even said he allowed the empty condition
 in 
<code>while()</code> on purpose back in Perl 1.  Ilya asked why not get rid of it, similar
 to the way that 
<code>if BLOCK BLOCK</code> was gotten rid of.  Larry pointed out that the two cases are not
 really analogous:  
<code>if BLOCK BLOCK</code> was removed (or broken) entirely by accident and that the only reason
 this was never fixed was that nobody at all complained about it.
</p>

<h3><a name="Undefined_Function_Warning" id="Undefined_Function_Warning">Undefined Function Warning</a></h3>

<p>
Mike Taylor wrote in to ask for a warning that would announce (at
compile time) the presence of calls to undefined functions.  Dan
Sugalski enumerated some of the reasons why there isn't already such a
warning:  
<code>AUTOLOAD</code>ed functions; calls to platform-specific functions guarded by 
<code>if ($^O eq 'Eniac')</code>; functions loaded by 
<code>require</code>; people getting funky with the symbol table.
</p>

<p> Tom Christiansen pointed out that <code>perl -MO=Lint,-context,-undefined-subs 
  program</code> does something like this already. That seemed to satisfy Mike. 
</p>
<h3><a name="Static_Extensions" id="Static_Extensions">Static Extensions</a></h3>

<p> Margie Levine asked about compiling perl with statically-linked extensions. 
  Andy Dougherty replied that all the documentation may have gotten lost, the 
  best way it to just dro pthem in the <code>ext/</code> directory before you 
  run <code>Configure</code>, which is supposed to notice the extensions and built 
  them as if they were part of the standard set. </p>
<h3><a name="POD_Hack" id="POD_Hack">POD Hack</a></h3>

<p>

Ilya points out that a construction like this:
</p>

<pre>
 C&lt;S&lt;
  code with I&lt;..&gt; or L&lt;...&gt; escapes or whatever
 &gt;&gt;
</pre>

<p> Will generate an indented code paragraph that can still contain pod escapes 
  for hyperlinks or whatever. </p>
<h3><a name="Perl_Art" id="Perl_Art">Perl Art</a></h3>


<p>

Greg Bacon reported 
<a href="http://www4.telge.kth.se/~d99_kme/">an entertainment</a>.  (The background is Perl code.)  There was some discussion about
generating pictures of llamas and 
the like in a similar medium.
</p>

<h3><a name="localtime_Contest_Continues" id="localtime_Contest_Continues"><code>localtime()</code> Contest Continues</a></h3>

<p>
Try to guess how many bogus bug reports about the 
<code>localtime()</code> function will be submitted next year.  Visit
<a href="http://www.plover.com/~mjd/perl/y2k/y2k.cgi">http://www.plover.com/~mjd/perl/y2k/y2k.cgi.</a></p>

<h3><a name="Various" id="Various">Various</a></h3>

<p>
A large collection of bug reports, bug fixes, non-bug reports,
questions, answers, and a small amaount of flamage.  (No spam this
week.)
</p>

<p>
Until next week I remain, your humble and obedient servant,
</p>


<hr />
<a href="mailto:mjd-perl-thisweek-199911+@plover.com">Mark-Jason Dominus</a> 

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1842" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/1999/11/p5pdigest/THISWEEK-19991114.html" rel="bookmark">This Week on p5p 1999/11/14</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="1999-11-14T00:00:00-08:00">November 14, 1999 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- This week on perl5-porters (8-14 November 1999) -->

<br />
<br />      </P>



<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#Lexical_variables_and_eval">Lexical variables and <tt>eval</tt></a>
  <li><a href="#More_About_Line_Disciplines">More About Line Disciplines</a>
  <li><a href="#link_on_WinNT"><code>link</code> on WinNT</a>
  <li><a href="#Ilya_Regex_Optimization">Regex Optimization</a>
  <li><a href="#Threads_on_Solaris">Threads on Solaris</a>
  <li><a href="#Regex_Engine_Reentrancy">Regex Engine Reentrancy</a>
  <li><a href="#Big_Files_Continue">Big Files Continue</a>
  <li><a href="#Regexp_Objects_again"><CODE>Regexp</code> Objects again</a>
  <li><a href="#Unicode_Support_on_EBCDIC_Machines">Unicode Support on EBCDIC Machines</a>
  <li><a href="#Marshalling_Modules">Marshalling Modules</a>
  <li><a href="#Got_Perl?">Got Perl?</a>
  <li><a href="#localtime_has_Another_Bug"><code>localtime()</code> has Another Bug!</a>
  <li><a href="#Various">Various</a>
</ul>

<!-- <a name="Notes">Notes</a> -->

<P>Traffic was about normal this week, but there didn't seem to be as
much content as usual.  That is, there were the usual number of
messages, but they didn't really seem to say much.  This might just be
my mistake, so if you think I missed something important, please send me a note about it.
</P>

<P>
You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>mjd-perl-thisweek-YYYYMM@plover.com</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
<!-- <a name="Lexical_variables_and_eval">Lexical variables and <tt>eval</tt></a> -->

</P>

<P>

Ilya forwarded an article that had been posted to 
<CODE>comp.lang.perl.misc</CODE> by Kragen Sitaker. The article pointed out that the following code was surprising:
</P>

</P><PRE>
 $foo = 1;  $^W = 1;
 sub test1 {my $foo = 2;  return sub { eval shift } }
 print test1()->('$foo');
</PRE>

<P>
The subroutine captures a lexical scope in which 
<CODE>$foo=2</CODE>; on the other hand, the argument is evaluated in a lexical scope in
which 
<CODE>$foo=1</CODE>.  Which value of 
<CODE>$foo</CODE> is printed?  Answer: Neither.  
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00280.html">Ilya
wrote to p5p suggesting that this discrepancy generate a warning.</a>  But there was no discussion.
</P>

<P>
I tried to do a little research to find out how other languages handle this problem.  (An ounce of prior art is worth a pound of cure.)  I
looked around in Lisp world.  Most Lisp doesn't have lexically scoped
variables.  The major exception is the Scheme family.  Until Revision
5, Scheme did not have 
<CODE>eval</CODE>.  Revision 5 does have 
<CODE>eval</CODE>, but you have to explicitly specify the environment in which you want
the code evaluated.  Conclusion:  We may be on untrodden ground here.
<H2><a name="More_About_Line_Disciplines">More About Line Disciplines</a></H2>

</P>

<P>

Last week Larry said there should be some way of registering an I/O
discipline on an I/O stream so that (for example) the I/O operators
could convert automatically from a national character set to UTF-8, and
vice versa.  Sam Tregar appeared to volunteer for the job, but it is
a big project and  no word has come
back yet.  Ilya cautioned everyone to look at
<a href="http://www.oche.de/~akupries/soft/giot/HOWTO.html">notes about the Tcl version of that feature</a> to find out what not to do.  (An ounce of prior art is worth a pound
of cure.)   Discussion petered out.  This is probably something that
needs more people working on it.
<H2><a name="link_on_WinNT"><code>link</code> on WinNT</a></H2>

</P>

<P>

Jan Dubois submitted a patch to enable the Perl 
<CODE>link()</CODE> function to work under WinNT.  It is implemented in terms of some
equivalent underlying WinNT feature.

<H2><a name="Ilya_Regex_Optimization">Regex Optimization</a></H2>


<P>Ilya posted a really big patch to the regex engine that contains <a
href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00286.html">a
pretty major optimization</a>.</p>


<p> Ilya's example was <code>/\bt.{0,10}br/</code>.  Normally, Perl
can look for a longish fixed string inside the regex, in this case the
<code>br</code>.  It then looks for <code>br</code> in the target
string, because there can't be a match without a <code>br</code>.  It
knows that if it finds a match, the <code>br</code> will occur at
some position 1 .. 11 of the matching string; the <code>t</code> must
occur at position 0.  Perl hunts through the target string looking for
the <code>br</code>, and when it finds it, it backs up to look for the
<code>t</code>.  If there is no <code>t</code>, it starts over and looks for another
<code>br</code>.  Since this process involves simply scanning the target for fixed
substrings, it is very fast.</p>

<p>Suppose Perl finds the <code>t</code>.  Prior to the optimization, it
would then enter the regex engine and start matching normally, looking
for the word boundary.  With the new optimization, it can notice when
there is no word boundary and abandon the match immediately, without
starting the main part of the regex engine.</p>

<p><a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00566.html">Here's the example</a>.</p>

<H2><a name="Threads_on_Solaris">Threads on Solaris</a></H2>


<P>
Marek Rouchal reported that threaded programs do not always work
properly under Solaris.  It is not clear what the problem is or
whether it is the fault of Marek, Perl, the Solaris thread library,
or some combination of those.  The problem appeared to be unresolved
as of this report.
</P>

<H2><a name="Regex_Engine_Reentrancy">Regex Engine Reentrancy</a></H2>


<P>

St&eacute;phane Payrard reported that Perl dumps core if you try to do a regex match inside
 of a 
<CODE>(?{...})</CODE> expression.  This did not come as a big surprise seeing as the regex engine is
 not reentrant.  (It uses several global variables.)
<blockquote><b>Hugo van der Sanden:</b> Making the regexp engine reentrant should fix the problem.<br><b>Jarkko Hietaniemi:</b> This is a bit like saying, "Stopping the wars should bring the world peace."</blockquote></P>
</P>

<P>

St&eacute;phane suggested making it a fatal error in the meantime, but
no patch was offered.  
</P>

<P>
Somewhere in the discussion, Jesus Quiroga mentioned that he was
working on a replacement for 
<CODE>perlre.pod</CODE>, including a tutorial and some examples.  It's about time!
</P>
<H2><a name="Big_Files_Continue">Big Files Continue</a></H2>


<P>

Last week 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00142.html">Jarkko remarked that 5.6 would have better support for large files.</a> (There are 32-bit integer overflow problems
associated with those larger than 2GB.)  A very long discussion, which appeared
to have  very little
actual content, ensued. If I'm mistaken about this, maybe someone would like
to mail me with a summary of the important points?
</P>

<P>
Here are some typical problems:  You have a file larger than 2GB and
you try to get the file pointer position with 
<CODE>seek()</CODE>.  The result might be too big to fit in a 32-bit integer.  Your
system's 
<CODE>off_t</CODE> type is probably big enough to hold the offset value; but when this
value is stored into Perl's SV structure, it is coerced into 32 bits and
information is lost.  So, to handle this properly, SVs need to use
64-bit integers.  But if you change the size of the integers in the
SV, then Perl is no longer binary-compatible with compiled XS modules
that have a different-size SV.  When arithmetic on an integer value
overflows the integer, it is converted to a floating-point number;
but what happens in a system where an integer is <em>more</em>
accurate than a float?
</P>

<P>
Jarkko said that in 5.005_63 he would try turning on support for large
files without enabling 64-bit integers generally, and see what
happened.  One difficulty:  It is hard to test this support.
</P>

<P>
Sarathy suggested storing the file offsets into a floating-point
variable.  Floating point numbers are inexact, but only once you
overflow the mantissa, and the mantissa of the typical (64-bit) 
<CODE>double</CODE> variable is a 53-bit integer.
</P>


<H2><a name="Regexp_Objects_again"><CODE>Regexp</code> Objects again</a></H2>


<P>
More discussion about how to make 
<CODE>Regexp</CODE> objects more like real objects, but without making them slow.  Still
no conclusion, but the discussion wandered onto the topic of
overloading the assignment operator.   
<H2><a name="Unicode_Support_on_EBCDIC_Machines">Unicode Support on EBCDIC Machines</a></H2>

</P>

<P>

Folks on EBCDIC machines will have an unusual problem with Unicode,
because Unicode is designed for compatibility with ASCII; the first
128 Unicode characters are identical with their ASCII counterparts.
For example, in a double-quoted string, 
<CODE>\N{EXCLAMATION MARK}</CODE> is supposed to generate an exclamation point.  Actually, it generates
Unicode character U+0021, and in UTF-8 encoding this is represented
by the single character 0x21, which happens to be an ASCII
exclamation mark.  Under EBCDIC, however, 0x21 is a capital letter
O.  (I think.)  
</P>

<P>
All sorts of UTF-8 tests fail on EBCDIC systems because of similar
problems.  I think Jarkko's suggestion was to fix the 
<CODE>charnames</CODE> pragma to notice when it is on an EBCDIC system, but the issue may
not be closed yet. 
</P>
<H2><a name="Marshalling_Modules">Marshalling Modules</a></H2>


<P>

David Muir Sharnoff sent an interesting message, copied to the Modules
list.  Among other things, it calls for a standard interface to
marshalling modules.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00567.html">Read about it.</a></P>



<H2><a name="Got_Perl?">Got Perl?</a></H2>

Banana Republic has a new advertisement that features a llama wearing
a scarf.  <a
href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00339.html">Here
we see the llama wearing Larry's mustache as well.</a></P>

<P>

<H2><a name="localtime_has_Another_Bug"><code>localtime()</code> has Another Bug!</a></H2>

</P>

<P>

The Y2K bug in 
<CODE>localtime()</CODE> was reported.  Again.
</P>

<P>
I invite everyone to guess how many spurious 
<CODE>localtime()</CODE> bugs will be reported during the year 2000.  
<a href="http://www.plover.com/~mjd/perl/y2k/y2k.cgi">Register your guess,</a> and I will announce the winner in January 2001.
</P>

<P>

<H2><a name="Various">Various</a></H2>

</P>

<P>
A large collection of bug reports, bug fixes, non-bug reports,
questions, answers, and a small amount of flamage.  (No spam this
week.)
</P>

<P>
Until next week, I remain your humble and obedient servant,
</P>

<hr>

<a href="mailto:mjd-perl-thisweek-199911+@plover.com">Mark-Jason
Dominus</a>
<p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1840" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/1999/11/p5pdigest/THISWEEK-19991107.html" rel="bookmark">This Week on p5p 1999/11/07</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="1999-11-07T00:00:00-08:00">November  7, 1999 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- This week on perl5-porters (1-7 November 1999) -->

<br />
<br />      </P>
<P>



<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#glob_case_sensitivity"><code>glob</code> case-sensitivity</a>
  <li><a href="#Doh::Year_and_Y2K_warnings"><code>D'oh::Year</code> and Y2K warnings</a>
  <li><a href="#Threading_and_Regexes">Threading and Regexes</a>
  <li><a href="#Change_to_xsubpp">Change to <CODE>xsubpp</code></a>
  <li><a href="#utf8_Needs_a_New_Pumpking"><code>utf8</code> Needs a New Pumpking</a>
  <li><a href="#STOP_blocks"><CODE>STOP</CODE> blocks</a>
  <li><a href="#map_and_grep_in_void_context"><CODE>map</CODE> and <CODE>grep</CODE> in void context</a>
  <li><a href="#Data::Dumper_and_Regexp_objects"><CODE>Data::Dumper</code> and <code>Regexp</code> objects</a>
  <li><a href="#sort_improvements"><CODE>sort</CODE> improvements</a>
  <li><a href="#IPv6_and_Socketpm">IPv6 and <CODE>Socket.pm</CODE></a>
  <li><a href="#New_quotation_characters">New quotation characters</a>
  <li><a href="#system_1_foo"><code>system 1, foo</code></a>
  <li><a href="#MacPerl_Error_Messages">MacPerl Error Messages</a>
  <li><a href="#pack_t_Template"><CODE>pack t</CODE> Template</a>
  <li><a href="#New_perlthread_man_page">New <CODE>perlthread</code> man page</a>
  <li><a href="#Big_Files">Big Files</a>
  <li><a href="#localtime_is_Broken"><CODE>localtime</code> is Broken</a>
  <li><a href="#Record_Separators_that_Contain_NUL">Record Separators that Contain NUL</a>
  <li><a href="#Perl_56_New__Feature_List">Perl 5.6 New  Feature List</a>
  <li><a href="#Various">Various</a>
</ul>

<!-- <a name="Notes">Notes</a> -->

</P>

<P>
This week's report is a little early because I had to go away to the LISA
conference.
</P>

<P>
You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>mjd-perl-thisweek-YYYYMM@plover.com</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
<!-- <a name="glob_case_sensitivity"><code>glob</code> case-sensitivity</a> -->

</P>

<P>

Discussion continued on what meanings to assign to certain patterns on
DOSISH systems.  For example, with the regular 
<CODE>glob()</CODE>, a backslash is an escape character.  But you know that folks on
DOSISH systems are going to want to write 
<CODE>glob('foo\\bar')</CODE> to have it look in directory 
<CODE>foo</CODE> for file
<CODE>bar</CODE>.  Paul's conclusion: 
<CODE>\</CODE> in a glob pattern on a DOSISH system only behaves like a metacharacter when it precedes
 another metacharacter; otherwise it's a directory separator.
</P>

<P>

<H2><a name="Doh::Year_and_Y2K_warnings"><code>D'oh::Year</code> and Y2K warnings</a></H2>

</P>

<P>
Michael Schwern felt that the Y2K warnings in Perl are too little too
late.  (Too little: 5.005_62 warns if you try to concatenate a number with the
string 
<CODE>"19"</CODE>.  Too late: Look!  It is November of 1999.)  He submitted a module,
tentatively named 
<CODE>D'oh::Year</CODE>, which follows this strategy:
It overrides the 
<CODE>localtime</CODE> and 
<CODE>gmtime</CODE> functions so that they return a year value that looks like a number
but is actually an overloaded object.  When this object is
concatenated with any of the strings
<CODE>"19"</CODE>, 
<CODE>"20"</CODE>, or 
<CODE>"200"</CODE> or has any of several other suspicious operations performed on it, it
issues a warning.  It does this without any core patches.  It is
available from  
<a href="http://www.pobox.com/~schwern/src/">Michael's web site</a> and probably also from CPAN.  (This idea was originally suggested by Andrew Langmead.)
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01532.html">Read about it.</a></P>

<P>

Sarathy said that he would not include it in the standard distribution,
except perhaps as part of 
<CODE>B::Lint</CODE>.
<H2><a name="Threading_and_Regexes">Threading and Regexes</a></H2>

</P>

<P>

Last week I reported on a problem with Perl regexes under threading
but I got the technical details wrong.  Please ignore it, because it
has no relation to reality.
</P>

<P>
Actually I understood the problem better than I thought, because it is
a very long-standing problem with regexes that shows up in many
places, not just under threading.
</P>

<P>
Basically, the problem is that certain properties of regexes are
attached to the 
<CODE>match</CODE> node in the op tree, which effectively means that they are associated
 with the lexical appearance of the match operation in the source
 code.  What does that mean?  Here is a simple example:
</P>

</P><PRE>
 sub tryme {
   my $string = shift;
   return unless $string =~ /(.)/;
   print "$1";
   tryme(substr($s, 1));
   print "$1";
 }
</PRE>

</P><PRE>
 tryme('abc');
</PRE>

<P>

<CODE>tryme</CODE> is invoked three times, and you would expect each invocation to have
 a separate pattern match with separate backreference variables.
There is no reason to expect the value of 
<CODE>$1</CODE> to be changed by the function call, so you would expect the two 
<CODE>print</CODE> statements in the function to print the same thing each time the
 function was invoked, so
 that you would get 
<CODE>abccba</CODE>.  But instead, the backreference variables are attached to the regex
match operator, and that operator is shared among all calls to the subroutine.
This means that a later call to 
<CODE>tryme</CODE> overwrites the 
<CODE>$1</CODE> of the earlier call, and the output is
<CODE>abcccc</CODE>.  Ugh.   The threading problem is similar: Two threads can trample on
one anothers backreference variables for the same match operator.  
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1998-01/msg02163.html">I had complained about a related problem </a> almost two years ago, and it was well-known then.
</P>

<P>
Sarathy expressed sadness that this problem has gone unfixed for so
long.  The correct fix is for the op node to store an offset into the
pad, which is private to each instance of a function invocation and is
not shared between calls to the same function or between threads.
Then the pad will have the pointer to the backreference variables or
whatever.  
</P>

<P>
I wrote to the MIT folks to ask what exactly they were doing, but they
did not reply.
</P>

<P>

<H2><a name="Change_to_xsubpp">Change to <CODE>xsubpp</code></a></H2>

</P>

<P>
Ilya submitted a 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00088.html">patch to <code>xsubpp</code></a> which will change the value return semantics of XSUBs to be more
 efficient.  It needs wide testing because almost all XSUBs will
 be affected.
<H2><a name="utf8_Needs_a_New_Pumpking"><code>utf8</code> Needs a New Pumpking</a></H2>

</P>

<P>

Nick Ing-Simmons no longer has time to be responsible for 
<CODE>utf8</CODE>.  If you want to be the new 
<CODE>utf8</CODE> king, send mail to Sarathy.
<H2><a name="STOP_blocks"><CODE>STOP</CODE> blocks</a></H2>

</P>

<P>

Sarathy put them in.  Details were in an 
<a href="/pub/1999/10/p5pdigest/THISWEEK-19991024.html#C_STOP_blocks_and_the_broken_co">earlier report.</a></P>

<P>

<H2><a name="map_and_grep_in_void_context"><CODE>map</CODE> and <CODE>grep</CODE> in void context</a></H2>

</P>

<P>

Simon Cozens submitted a patch that would issue a warning on 
<CODE>grep</CODE> and 
<CODE>map</CODE> in void context.  Larry said he didn't want to do that; he thought
that it would be better to propagate the void context into the code
block so that the usual 
<CODE>useless use of ... in void context</CODE> messages would appear.
</P>

<P>

<BLOCKQUOTE><B>Larry:</B> The argument against using an operator for other than its primary purpose strikes me the same as the old argument that you shouldn't have sex for other than procreational purposes.  Sometimes side effects are more enjoyable than the originally intended effect.</BLOCKQUOTE><H2><a name="Data::Dumper_and_Regexp_objects"><CODE>Data::Dumper</code> and <code>Regexp</code> objects</a></H2>

</P>

<P>

Michael Fowler submitted a 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00030.html">patch </a> to make 
<CODE>Data::Dumper</CODE> work on 
<CODE>Regexp</CODE> objects.  (Those are the ones generated by the 
<CODE>qr//</CODE> operator.)  There was some discussion of problems with these kinds of
objects:  They're hard to recognize; they stringize in a strange way
so that, unlike other sorts of references, you can't be sure you can
tell them apart by looking at the strinigzed versions; and so on.
Sarathy said he was  uncomfortable with the implementation of the 
<CODE>Regexp</CODE> objects, and that they should be more like regular objects so that
 they would be easier to understand and so that they coul be dealt
with just like other objects.  Larry agreed, and added that exceptions
and filehandles should work that way too.  However, there was no
specific proposal about what should be done.
</P>

<P>

<H2><a name="sort_improvements"><CODE>sort</CODE> improvements</a></H2>

</P>

<P>

Peter Haworth improved his patch to allow XSUBs to be used as sort
comparator functions. If the comparator is prototyped as 
<CODE>($$)</CODE>, then the list elements are passed normally, in 
<CODE>@_</CODE>, instead of as 
<CODE>$a</CODE> and 
<CODE>$b</CODE>.  
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00049.html">Read about it.</a></P>

<P>

<H2><a name="IPv6_and_Socketpm">IPv6 and <CODE>Socket.pm</CODE></a></H2>

</P>

<P>
Warren Matthews has a version of <code>Socket.xs</code> that contains functions
for interconverting integers and IPv6 addresses (which are normally
represented in the form 
<CODE>xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx</CODE>).  He asked if there would be interest in adding these to the standard
distribution, but nobody replied, so I guess there wasn't any.
<H2><a name="New_quotation_characters">New quotation characters</a></H2>

</P>

<P>

Larry suggested that when Perl is unicode-enabled, it could deduce from
the Unicode character database which characters are parentheses, and
then from the character names what the corresponding closing
parenthesis is for any given open parenthesis.
Having done that, it could then understand any sort of parentheses at
all 
as delimiters in the 
<CODE>q</CODE> and 
<CODE>qq</CODE> operators.  For example, 
<img src="http://charts.unicode.org/Unicode.charts/Small.Glyphs/0F/U0F3C.gif"> and
<img src="http://charts.unicode.org/Unicode.charts/Small.Glyphs/0F/U0F3D.gif"> are the TIBETAN LEFT BRACE and TIBETAN RIGHT BRACE characters.
Larry said that brackets should do what
 people expect, and that people expect them to match.
</P>

<P>
Alternatively, people could declare their parenthesis characters, and
then use U+261E
<img src="http://charts.unicode.org/Unicode.charts/Small.Glyphs/26/U261E.gif"> and U+261C
<img src="http://charts.unicode.org/Unicode.charts/Small.Glyphs/26/U261C.gif"> as parantheses.  
<BLOCKQUOTE><B>Larry:</B> Down that path lies jollity.</BLOCKQUOTE></P>

<P>

</P>

<P>

<H2><a name="system_1_foo"><code>system 1, foo</code></a></H2>

</P>

<P>

Apparently on most non-unix Perl systems, if you invoke 
<CODE>system 1, foo</CODE>, it runs 
<CODE>foo</CODE> in the background, and returns the process ID number instead of the
 exit status of 
<CODE>foo</CODE>.  Ilya suggested implementing this on Unix also.
</P>

<P>
Sarathy said it would be better to have a modular interface to that
functionality, and he did not want to propagate this hack to any more
systems.  ``The concept is portable, but the incantation is not.  What it
needs is some Perl code to smooth it over.''
</P>

<P>
Jenda Krynicky pointed out the enhancement he proposed to 
<CODE>Shell.pm</CODE> last week would be easy to extend to support this cleanly.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01339.html">In case you forgot.</a></P>

<P>

<H2><a name="MacPerl_Error_Messages">MacPerl Error Messages</a></H2>

</P>

<P>

MacPerl had been formatting error messages like this:
</P>

</P><PRE>
 # Syntax Error
 File "script.plx"; Line 46
</PRE>

<P>
instead of like this:
</P>

</P><PRE>
 Syntax error in script.plx, line 46
</PRE>

<P>
because some Mac programming tool can parse the other form and open
the file automatically with the appropriate line highlighted.
Matthias Neeracher agreed to withdraw this change; I am not exactly
clear on why, and I could not find the original patch.
</P>

<P>

<H2><a name="pack_t_Template"><CODE>pack t</CODE> Template</a></H2>

</P>

<P>

More discussion of Ilya's proposed 
<CODE>t</CODE> template for the 
<CODE>pack</CODE> and 
<CODE>unpack</CODE> functions.
</P>

<P>
Last week Joshua Pritikin asked why not just use 
<CODE>Storable</CODE>; Ilya pointed out that different kinds of marshalling code is useful
under different circumstances, and 
<CODE>Storable</CODE> is not useful, for example, if you are trying to marshal data to be passed as an
argument to a command.  However, you could use his new 
<CODE>pack</CODE> template to marshal data into a string, pass it as a command
 argument, and have the command unpack it with 
<CODE>unpack 't'</CODE> on the other end.
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00077.html">Ilya's explanation of the usefulness of <code>pack 't'</code>.</a></P>

<P>

<H2><a name="New_perlthread_man_page">New <CODE>perlthread</code> man page</a></H2>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01511.html">Dan Sugalski updated his proposed <CODE>perlthread</CODE> man page.</a></P>

<P>

<H2><a name="Big_Files">Big Files</a></H2>

</P>

<P>

Christopher Masto reported that the 
<CODE>stat</CODE> function does not work properly on files larger than 2GB, because the
 size is stored in the usual signed 32-bit integer.  Jarkko said that
5.6 (and current development versions) will have better support for this, but that you will have to
enable the support at compile time.
<H2><a name="localtime_is_Broken"><CODE>localtime</code> is Broken</a></H2>

</P>

<P>

Someone submitted another bug report because 
<CODE>localtime</CODE> returns the wrong month.  
<H2><a name="Record_Separators_that_Contain_NUL">Record Separators that Contain NUL</a></H2>

</P>

<P>

Sarathy put in a patch so that 
<CODE>$/</CODE> could contain the NUL character, 
<CODE>"\0"</CODE>.  This would probably have passed without comment, except that Jeff
Pinyan followed up with a question about setting 
<CODE>$/</CODE> to 
<CODE>\0</CODE> (that is, a reference to the constant integer zero) and said it was
 on the same topic, even though it was not.  Enough people were confused by
 this that the discussion went on twice as long as it should have,
 with some people talking about 
<CODE>"\0"</CODE> and others discussing 
<CODE>\0</CODE>.  Anyway, the answer is that Perl only goes into fixed-length record
mode if 
<CODE>$/</CODE>is a reference to a <em>positive</em> number.</P>

<P>

<BLOCKQUOTE><p><B>Tom:</B> [Fixed-length record mode is] yet another special-case exception requiring an "oh by the way" in the documentation.</p><p><b>Dan Sugalski:</B> Yeah, but if we took 'em all out we'd be left with 37 pages of documentation and C with morphing scalars.</p></BLOCKQUOTE></P>

<P>
Then there was a digression:  Nat Torknigton suggested that if 
<CODE>$/</CODE> was set to a code ref, Perl could run the code whever you did a 
<CODE><...></CODE> read, and yield the return value from the code, instead of doing what
it would normally do.  Nat's example was:
</P>

</P><PRE>
 # all filehandles now autochomp
 $/ = sub { my $x = CORE::readline(shift); chomp $x; return $x };
</PRE>

<P>
(He said 
<CODE>$\</CODE> instead of 
<CODE>$/</CODE>, but that was a mistake.)
</P>

<P>
Several people got very excited about this, but Sarathy pointed out
that it would be more straightforward to just override 
<CODE>CORE::GLOBAL::readline()</CODE>, and that he did not want to provide more than one way to do
something that hardly anyone ever wants to do anyway.
</P>

<P>
But Larry expanded on the general idea, saying that there should be a
general, lightweight way to insert various kinds of read and write
disciplines into an I/O stream.  The most important uses for this
would involve having the I/O operators convert from UTF-8 to national
character sets transparently, and vice versa.  
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-11/msg00254.html"><b>Larry:</b> ``This is something we have to make easy in Perl.  Not just possible.''</a></P>

<P>

<H2><a name="Perl_56_New__Feature_List">Perl 5.6 New  Feature List</a></H2>

</P>

<P>
Jeff Okamoto asked if there was one.  Nobody said `yes', so the answer
is probably `no'.
</P>

<P>
Hmm, it just occurred to me that I'm now the logical person to write
up such a list for 5.7 and beyond  But I didn't start doing this job
soon enough to be able to do it for 5.6.  If people will send me their
feature lists, I will collate them and go over 
<CODE>perldelta</CODE> and try to come up with the canonical list.
</P>

<P>

<H2><a name="Various">Various</a></H2>

</P>

<P>
A large collection of bug reports, bug fixes, non-bug reports,
questions, answers, and a small amount of flamage.  (No spam this
week.)
</P>

<P>
Until next week I remain, your humble and obedient servant,
</P>
<hr>

<a href="mailto:mjd-perl-thisweek-199911+@plover.com">Mark-Jason
Dominus</a>
<p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1830" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/1999/10/p5pdigest/THISWEEK-19991031.html" rel="bookmark">This Week on p5p 1999/10/31</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark-Jason Dominus</span> on <abbr class="published" title="1999-11-03T00:00:00-08:00">November  3, 1999 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- This week on perl5-porters (25-31 October 1999) -->

<br />
<br />      </P>
<P>



<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#glob_case_sensitivity"><code>glob</code> case-sensitivity</a>
  <li><a href="#Perl_under_UNICOS">Perl under UNICOS</a>
  <li><a href="#New_perlthread_man_page">New <CODE>perlthread</code> man page</a>
  <li><a href="#Threading_and_explicit_unlocking">Threading and explicit un<code>lock</code>ing</a>
  <li><a href="#Threading_and_Regexes">Threading and Regexes</a>
  <li><a href="#pack_t_Template"><CODE>pack t</CODE> Template</a>
  <li><a href="#Happy_Birthday_CPAN">Happy Birthday CPAN!</a>
  <li><a href="#Local_Address_in_LWP">Local Address in <CODE>LWP</CODE></a>
  <li><a href="#Return_of_ref_prototype">Return of <CODE>ref</CODE> prototype</a>
  <li><a href="#^O"><CODE>$^O</CODE></a>
  <li><a href="#sort_improvements"><CODE>sort</CODE> improvements</a>
  <li><a href="#Shellpm_enhancements"><CODE>Shell.pm</CODE> enhancements.</a>
  <li><a href="#Time_Zone_Output">Time Zone Output</a>
  <li><a href="#Python_Consortium_Forms">Python Consortium Forms</a>
  <li><a href="#Yikes">Yikes</a>
  <li><a href="#Various">Various</a>

</ul>

</P>

<P>
I'm sorry that this report is late, but I had some serious hardware
trouble at home and couldn't work on the report until I fixed my
computer.  Fortunately traffic was light this week.
</P>

<H3><a name="Notes">Notes</a></H3>


<P>

It is hard to keep track of everything that happens.  As before,
please let me know if you have any corrections or additions.  Send
them to 
<CODE>mjd-perl-thisweek-YYYYMM@plover.com</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
</P>

<P>
You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>

<H3><a name="glob_case_sensitivity"><code>glob</code> case-sensitivity</a></H3>

</P>

<P>
This discussion continued from last week.  Paul Moore said that he
would try to resolve some of the issues with the new built-in globber
under Windows.  (
<CODE>\</CODE> vs. 
<CODE>/</CODE>, what to do when the underlying filesystem is case-insensitive, etc.)
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg00902.html">Read about it.</a></P>

<P>

The issues seemed to get thornier and thornier.  For example, what do
you do with
<CODE>glob("C:*")</CODE>?  On Unix systems, you would like it to look in the current directory
for files beginning with 
<CODE>C:</CODE>.  But on Win32 systems you would like it to look on the disk labeled 
<CODE>C</CODE>.
Nevertheless Paul 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg00902.html">submitted a partial patch</a>.
</P>

<P>
I looked for a remark from Sarathy, but I did not see one.
<H3><a name="Perl_under_UNICOS">Perl under UNICOS</a></H3>

</P>

<P>

Jarkko has been making sure that Perl works on UNICOS, which I gather
is a version of Unix that runs on Crays.  But his Cray is going away,
and he needs someone else to take over, or to give him access to a
UNICOS machine.  If you can do this, please contact him.  If you don't
know how to contact him, contact me.
<H3><a name="New_perlthread_man_page">New <CODE>perlthread</code> man page</a></H3>

</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01511.html">Dan Sugalski updated his proposed <CODE>perlthread</CODE> man page.</a><H3><a name="Threading_and_explicit_unlocking">Threading and explicit un<code>lock</code>ing</a></H3>

</P>

<P>

Last week's discussion of the proposed 
<CODE>perlthread</CODE> man page split into two interesting digressions.  This is the first
one:  At present, a lock is released  when control leaves the dynamic
scope in which it was first obtained. 
</P>

<P>
Usually this is what you want and takes care of releasing locks at the
right times.  
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01274.html">Tuomas Lukka suggested that there also be an explicit <CODE>unlock</CODE> function</a> for releasing a lock prematurely.
</P>

<P>
Sarathy said he'd prefer an interface that lets you store a lock into
a variable as if it were an object; then its release semantics
would be the same as for any other value.  It would be released when
the variable was destroyed, whether that was at the end of the block
or by an explicit 
<CODE>undef</CODE>.  
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01316.html">Read about it.</a></P>

<P>

<H3><a name="Threading_and_Regexes">Threading and Regexes</a></H3>

</P>

<P>
Rob Cunningham reports that he and Brian Mancuso at MIT are working on
fixing regexes, which do not always work properly in threaded Perl.
This is obviously very important.
One  issue is the global variables like
<CODE>$1</CODE>.  If two threads try to write into 
<CODE>$1</CODE> simultaneously, the result is backreference goulash.  But there are a
huge bunch of other global variables used internally by the regex
engine for storing the current state and for getting the 
<CODE>/egismosx</CODE> flags from Perl and so on.  All of these present thread hazards.
</P>

<P>

<BLOCKQUOTE><B>Rob:</B> Brian reports that perl REGEXP code is nasty stuff, or we'd be done by now.</BLOCKQUOTE></P>

<P>
Ilya said that he was also planning on removing most of the internal
global variables when he gets some time.  
<H3><a name="pack_t_Template"><CODE>pack t</CODE> Template</a></H3>

</P>

<P>

First a preamble: There is already  new pack template syntax already in the development
version of Perl.  Normally, if you want to pack three characters of
string data, you write something like 
<CODE>pack "A3", $data</CODE>.  But what if you don't know in advance how much data there will be?
The new feature is that you can write
<CODE>pack "N/A*", $data</CODE> and 
<CODE>pack</CODE> will back an 
<CODE>N</CODE>-sized byte count of the data in 
<CODE>$data</CODE>, followed by the actual data.    Then you use 
<CODE>unpack</CODE> with a similar template to tell it to unpack the byte count and then
to extract the appropriate amount of data from the string.
</P>

<P>
Ilya had idea for extending this so that the 
<CODE>unpack</CODE> function can actually figure out what the template is.  
He says he is just throwing it out for discussion, and not trying to
get his patch included in the core.
Ilya's idea is to
add a new unpack specifier 
<CODE>t</CODE>, which says to extract a certain number of characters from the input
string, and then use those characters as a template for unpacking the
rest of the string.  If you write 
<CODE>t12</CODE>, then the next 12 characters of the string are the template for the
rest.  If you write 
<CODE>N/t</CODE> then 
<CODE>unpack</CODE> will unpack an
<CODE>N</CODE> to yield a number 
<var>n</var> and then pretend that you wrote
<CODE>T<var>n</var></CODE> as is usual with 
<CODE>/</CODE>.  Ilya adds one last trick: 
<CODE>/</CODE> by itself is a synonym for 
<CODE>t/t</CODE>.
</P>

<P>
Now what is the point of all this?  The string can carry instructions
for unpacking itself.  For example, suppose you want to deliver the
four strings 
<CODE>"a", "bc", "def", "ghij"</CODE>.  You would like to send these along with the template 
<CODE>A1 A2 A3 A4</CODE>.  If you sent the single string
<CODE>"A1 A2 A3 A4abcdefghij"</CODE> then the receiver could unpack this with a template of 
<CODE>t11</CODE>.  Unfortunately, they still need to know that the template itself
will be 11 characters long, but you can fix that.  Add 
<CODE>A211</CODE> at the begginng of the string, and have the receiver use a
template of 
<CODE>t2/t</CODE>.  The 
<CODE>t2</CODE> says to get a 2-byte template, that's the 
<CODE>A2</CODE>, and then to unpack the following data according to that template, so
it gets the 11.  Then it uses the 11 as a byte count for the following 
<CODE>t</CODE>.  Unfortunately, the receiver still has to know that the initial
template is 
<CODE>t2/t</CODE>.  But after some further transformations it turns out that if you use
the template 
<CODE>t</CODE> with the string
<CODE>"/A4t2/tA211A1 A2 A3 A4abcdefghij"</CODE> then the receiver needs to know nothing about the data format, and
can retrieve all the data.  There are some other parts of the
proposal for embedding references into teplates.  
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01380.html">The entire proposal is here if you want to see it.</a><BLOCKQUOTE><b>Greg McCarroll:</b> i look forward to the first CGI questions on <tt>comp.lang.pack.misc</tt>.</BLOCKQUOTE></P>

<P>

Several people said that the thought it was too complicated, or that
they did not see the point, or that they would like to see a
real-world example.  (Ilya has not provided one.)  Joshua Pritikin
made what I thought was the most cogent comment:  Why not just include 
<CODE>Storable</CODE> in the core distribution?
</P>

<P>

<H3><a name="Happy_Birthday_CPAN">Happy Birthday CPAN!</a></H3>

</P>

<P>

CPAN first went online at 14:28:58 26 Oct 1995.  Thanks you, Jarkko!
<blockquote><b>Elaine Ashton:</b> Only 4 years! One wonders what the next 4 years will bring. </blockquote></P>

<P>

<H3><a name="Local_Address_in_LWP">Local Address in <CODE>LWP</CODE></a></H3>

</P>

<P>
People have been asking Gisle for a way to default the 
<CODE>LocalAddr</CODE> parameter for 
<CODE>LWP</CODE>.  That is, they want to be able to specify a default for the local address to which
an outgoing 
<CODE>LWP</CODE> socket is bound.  Gisle could have added this as a new feature of 
<CODE>LWP</CODE>, but he thought it would be more generally useful to put it directly
into 
<CODE>IO::Socket::INET</CODE>. He submitted a patch to that module that defaults the 
<CODE>LocalAddr</CODE> parameter from an environment variable if it is not explicitly set.
</P>

<P>
There was some discussion here, but it seemed to me that it missed the
point of what Gisle was trying to do.
<H3><a name="Return_of_ref_prototype">Return of <CODE>ref</CODE> prototype</a></H3>

</P>

<P>

Last week  Jeff Pinyan posted a complaint about the behavior of a function prototyped
with 
<CODE>(;$)</CODE>.  He wants
<CODE>print f arg1, arg2</CODE> to be parsed as if he had written
<CODE>print f(arg1), arg2</CODE>.  At present, Perl aborts, complaining that 
<CODE>f</CODE> got two arguments and expected at most one.  Discussion of this got
sidetracked last week.
</P>

<P>
Mike Guy pointed out that this problem also occurs when you are trying to
write a function that behaves like 
<CODE>rand</CODE>: The prototype of 
<CODE>rand</CODE> is supposedly 
<CODE>($)</CODE>, but if you create a function 
<CODE>myrand</CODE> with that prototype, then 
<CODE>print myrand, myrand;</CODE> aborts with a syntax error although 
<CODE>print rand, rand;</CODE> works.
</P>

<P>
Prototypes were added to Perl so that user functions could get the
syntax benefits that the built-in functions enjoyed.  But some
functions still can't be imitated with prototypes.  In addition to 
<CODE>ref</CODE> and 
<CODE>rand</CODE>, neither of 
<CODE>printf</CODE> or 
<CODE>tie</CODE> can be so imitated.
<H3><a name="^O"><CODE>$^O</CODE></a></H3>

</P>

<P>

Andy Dougherty is patching 
<CODE>Configure</CODE> to have it find out what sort of Linux it is running on, if it is is
running on Linux.   This might solve Tom's problem from last week.
<H3><a name="sort_improvements"><CODE>sort</CODE> improvements</a></H3>

</P>

<P>

Peter Haworth submitted an improved version of his patch for
<CODE>sort</CODE>.  He says he has benchmarked the new 
<CODE>sort</CODE> with several trivial comparator functions and performance is not bad
at all.  (If it were slower, you would expect to see the greatest
difference with a trivial comparator.)  You still cannot use an XSUB
as a sort comparator function, but Peter is working on that.
<a href="./THISWEEK-19991024.html#C_sort_improvement">Reread what I said last week.</a></P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01354.html">The patch.</a><H3><a name="Shellpm_enhancements"><CODE>Shell.pm</CODE> enhancements.</a></H3>

</P>

<P>

<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01339.html">Jenda Krynicky wants to enhance <CODE>Shell.pm</CODE>.  </a></P>

<P>
[Shell.pm]
 presently lets you write a function call 
<CODE>echo("hello", "world!")</CODE> and if there is no 
<CODE>echo</CODE> function already defined, it will invoke the shell's 
<CODE>echo</CODE> command.  It also has a 
<CODE>new</CODE> constructor that returns a reference to a fnuction that invokes a
shell command.  Jenda wants to be able to give the constructor some
extra parameters to tell it to throw away the 
<CODE>STDERR</CODE> and to be able to pre-supply arguments to the function.
</P>

<P>
Jenda wanted to get some comments about this proposal before getting
started on it, but nobody seemed to have anything to say about it.
<H3><a name="Time_Zone_Output">Time Zone Output</a></H3>

</P>

<P>

Todd Olson complained that there was no easy way to obtain the current
time zone in numeric format.  (For example, 
<CODE>-0400</CODE> instead of 
<CODE>EDT</CODE> or 
<CODE>-0700</CODE> instead of
<CODE>PST</CODE>.  He points out that it would be wasteful to write a function to
compute this value:  The value must be inside there somewhere already,
because it is used to compute 
<CODE>localtime()</CODE>.  Todd wants someone to add another 
<CODE>%</CODE>-escape to the 
<CODE>POSIX</CODE> module's 
<CODE>strftime</CODE> function that will format and display the time zone in numeric
format.  However, he did not provide a patch.
<H3><a name="Python_Consortium_Forms">Python Consortium Forms</a></H3>

</P>

<P>

Randal Schwartz reposted an announcement about a new 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/1999-10/msg01371.html">Python Consortium.</a></P>

<P>

<H3><a name="Yikes">Yikes</a></H3>

</P>

<P>
Sarathy did not say `yikes' this week.
</P>
<H3><A NAME="Various">Various</A></H3>
<P>
A large collection of bug reports, bug fixes, non-bug reports, questions,
answers, and a small amount of flamage and spam.

<P>
Until next week I remain, your humble and obedient servant,

<hr>

<a href="mailto:mjd-perl-thisweek-199910+@plover.com">Mark-Jason Dominus</a>
<p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/1999/10/">&laquo; October 1999</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/1999/12/">December 1999 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
