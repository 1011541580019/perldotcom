<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/2004/04/15/maypole.html">
<dc:title>Rapid Web Application Deployment with Maypole</dc:title>
<dc:description> You have a database. You have a web server. You have a deadline. Whether it&#39;s bringing up an e-commerce storefront for a new venture, implementing a new front-end to HR&apos;s employee database, or even providing a neat way to...</dc:description>
<dc:creator>Simon Cozens</dc:creator>
<dc:date>2004-04-22T00:00:00-08:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    
    <link rel="prev bookmark" href="/pub/2004/04/16/a12.html" title="Apocalypse 12" />
    <link rel="next bookmark" href="/pub/2004/04/p6pdigest/20040418.html" title="This Fortnight on Perl 6, Weeks Ending 2004-04-18" />
    
    
    <title>Rapid Web Application Deployment with Maypole - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-912" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Rapid Web Application Deployment with Maypole</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2004-04-22T00:00:00-08:00">April 22, 2004 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>You have a database.
You have a web server.
You have a deadline.</p>

<p>Whether it&#39;s bringing up an e-commerce storefront for a new venture, implementing a new front-end to HR's employee database,
or even providing a neat way to track citations for U.S. English slang terms, it's always the same story -- and the deadline is always yesterday.</p>

<p>For this month of April,
I'm working on a Perl Foundation sponsorship to develop a project of mine called Maypole,
which enables Perl programmers to get web front-ends to databases,
as well as complex web-based applications, up and running quickly.</p>

<p>Extremely quickly,
and with very little Perl coding required.
I&#39;ve used Maypole to set up an Intranet portal,
a database and display system for choosing menus and recipes,
song lyric and chord sheet projection software,
an open-source social network site,
and a web database of beer-tasting notes; and that just was in the past two weeks.</p>

<p>Maypole&#39;s flexibility stems from three fundamentals:</p>

<ul>
  <li><a href="#Separation_of_concerns">Clear separation of concerns</a></li>
  <p class="pad"></p>
  <li><a href="maypole.html?page=2#Sensible_defaults">Intelligent defaults</a></li>
  <p class="pad"></p>
  <li><a href="maypole.html?page=2#Ease_of_Extensibility">Ease of extensibility</a></li>
  <p class="pad"></p>
</ul>

<p>To demonstrate these three principles,
we&#39;re going to look at a bread-and-butter web application -- an online shop&#39;s product catalogue -- and see how quickly we can put it together with Maypole.</p>

<h2><a name="Separation_of_concerns">Separation of Concerns</a></h2>

<p>Maypole was originally called <code lang='und' xml:lang='und'>Apache::MVC</code>,
reflecting its basis in the Model-View-Controller design pattern.
(I had to change it firstly because Maypole isn&#39;t tied to Apache,
and secondly because <code lang='und' xml:lang='und'>Apache::MVC</code> is a really dull name.) It&#39;s the same design pattern that forms the foundation of similar projects in other languages,
such as Java&#39;s Struts framework.</p>

<p>This design pattern is found primarily in graphical applications; the idea is that you have a Model class that represents and manipulates your data,
a View class that is responsible for displaying that data to the user,
and a Controller class that controls the other classes in response to events triggered by the user.
This analogy doesn&#39;t correspond precisely to a web-based application,
but we can take an important principle from it.
As Andy Wardley explains:</p>

<blockquote>What the MVC-for-the-web crowd is really trying to achieve is a clear
    separation of concerns.  Put your database code in one place, your 
    application code in another, your presentation code in a third place.  
    That way, you can chop and change different elements at will,
    hopefully without affecting the other parts (depending on how well your
    concerns are separated, of course).  This is common sense and good practice.
    MVC achieves this separation of concerns as a byproduct of clearly 
    separating inputs (controls) and outputs (views). </blockquote>

<p>This is what Maypole does. It has a number of database drivers, a number of front-end drivers, and a number of templating presentation drivers. In common cases, Maypole provides precisely what you need for all of these areas, and you get to concentrate on writing just the business logic of your application. This is one of the reasons why Maypole lets you develop so rapidly -- because most of the time, you don&#39;t need to do any development at all.</p>

<p>Let&#39;s begin, then, by choosing what elements are going to make up our product database. We will actually be using what is by far the most common configuration of model, view, and controller classes: Maypole provides a model class based on <code lang='und' xml:lang='und'>Class::DBI</code>, a view class based on <code lang='und' xml:lang='und'>Template::Toolkit</code>, and a controller class based on Apache <code lang='und' xml:lang='und'>mod_perl</code>. We&#39;ll come to what all of this means in a second, but because this configuration is so common, it is the default; no code is required to set that up.</p>

<p>We will, however, need a database. Our client is going to be <code lang='und' xml:lang='und'>iSellIt</code>, a fictitious supplier of computer components and software. We will have database tables for products, manufacturers, and categories of stuff, and subcategories of categories. Here&#39;s what that database might look like.</p>

<pre lang='und' xml:lang='und'>    CREATE TABLE product (
        id int NOT NULL auto_increment primary key,
        category int,
        subcategory int,
        manufacturer int,
        part_number varchar(50),
        name varchar(50),
        cost decimal(6,2),
        description text
    );

    CREATE TABLE manufacturer (
        id int NOT NULL auto_increment primary key,
        name varchar(50),
        url varchar(255),
        notes text
    );

    CREATE TABLE category (
        id int NOT NULL auto_increment primary key,
        name varchar(50)
    );

    CREATE TABLE subcategory (
        id int NOT NULL auto_increment primary key,
        name varchar(50),
        category integer
    );</pre>

<p>We&#39;re going to assume that we&#39;ve loaded some data into this database already, but we&#39;re going to want the sales people to update it themselves over a web interface.</p>

<csperl file="grab" domain="on" record="sc/1252" field="html">

<p>In order to use Maypole, we need what&#39;s called a driver module. This is a very short Perl module that defines the application we're working with. I say it&#39;s a Perl module, and that may make you think this is about writing code, but to be honest, most of it is actually configuration in disguise. Here&#39;s the driver module for our ISellIt application. (The client may be called <code lang='und' xml:lang='und'>iSellIt</code>, but many years exposure to Perl module names makes me allergic to starting one with a lowercase letter.)</p>

<pre lang='und' xml:lang='und'>    package ISellIt;
    use base &#39;Apache::MVC&#39;;
    use Class::DBI::Loader::Relationship;

    ISellIt-&#62;setup(&#34;dbi:mysql:isellit&#34;);
    ISellIt-&#62;config-&#62;{uri_base} = &#34;http://localhost/isellit&#34;;
    ISellIt-&#62;config-&#62;{rows_per_page} = 10;
    ISellIt-&#62;config-&#62;{loader}-&#62;relationship($_) for 
        (&#34;a manufacturer has products&#34;, &#34;a category has products&#34;,
         &#34;a subcategory has products&#34;, &#34;a category has subcategories&#34;);

    1;</pre>

<p>Ten lines of code; that&#39;s the sort of size you should expect a Maypole application to be. Let&#39;s take it apart, a line at a time:</p>

<pre lang='und' xml:lang='und'>    package ISellIt;</pre>

<p>This is the name of our application, and it&#39;s what we&#39;re going to tell Apache to use as the Perl handler for our web site.</p>

<pre lang='und' xml:lang='und'>    use base &#39;Apache::MVC&#39;;</pre>

<p>This says that we&#39;re using the Apache front-end to Maypole, and so we&#39;re writing a <code lang='und' xml:lang='und'>mod_perl</code> application.</p>

<pre lang='und' xml:lang='und'>    use Class::DBI::Loader::Relationship;</pre>

<p>Now we use a Perl module that I wrote to help put together Maypole driver classes. It allows us to declare the relationships between our database tables in a straightforward way.</p>

<pre lang='und' xml:lang='und'>    ISellIt-&#62;setup(&#34;dbi:mysql:isellit&#34;);</pre>

<p>We tell <code lang='und' xml:lang='und'>ISellIt</code> to go connect to the database and work out the tables and columns in our application. In addition, because we haven&#39;t changed any class defaults, it&#39;s assumed that we&#39;re going to use <code lang='und' xml:lang='und'>Class::DBI</code> and Template Toolkit. We could have said that we want to use <code lang='und' xml:lang='und'>Apache::MVC</code> with <code lang='und' xml:lang='und'>DBIx::SearchBuilder</code> and <code lang='und' xml:lang='und'>HTML::Mason</code>, but we don&#39;t.</p>

<p>Maypole&#39;s <code lang='und'
    xml:lang='und'>Class::DBI</code>-based class uses <a
    href="http://search.cpan.org/perldoc?Class::DBI::Loader"><code>Class::DBI::Loader</code></a>
to investigate the structure of the database, and then map the <code
    lang='und' xml:lang='und'>product</code> table onto a <code
    lang='und' xml:lang='und'>ISellIt::Product</code> class, and so on.
You can read more about how <code lang='und'
    xml:lang='und'>Class::DBI</code>&#39;s table-class mapping works
in <a href='http://www.perl.com/pub/a/2002/11/27/classdbi.html'>Tony's
    article about it</a>.</p>

<pre lang='und' xml:lang='und'>    ISellIt-&#62;config-&#62;{uri_base} = &#34;http://localhost/isellit&#34;;</pre>

<p><code lang='und' xml:lang='und'>ISellIt</code> sometimes needs to know where it lives, so that it can properly produce links to other pages inside the application.</p>

<pre lang='und' xml:lang='und'>    ISellIt-&#62;config-&#62;{rows_per_page} = 10;</pre>

<p>This says that we don&#39;t want to display the whole product list on one page; there&#39;ll be a maximum of 10 items on a page, before we get a page-view of the list.</p>

<pre lang='und' xml:lang='und'>    ISellIt-&#62;config-&#62;{loader}-&#62;relationship($_) for 
        (&#34;a manufacturer has products&#34;, &#34;a category has products&#34;,
         &#34;a subcategory has products&#34;, &#34;a category has subcategories&#34;);</pre>

<p>Now we define our relationship constraints, in reasonably natural syntax: a manufacturer has a number of products, and a category will delimit a collection of products, and so on.</p>

<p>Ten lines of code. What has it got us?</p>



















<h2><a name="Sensible_defaults">Sensible Defaults</a></h2>

<p>The second foundation of Maypole is its use of sensible defaults. It has a system of generic templates that &#34;do the right thing&#34; for viewing and editing data in a database. In many cases, web application programmers won&#39;t need to change the default behavior at all; in the majority of cases, they only need to change a few of the templates, and in the best cases, they can declare that the templating is the web design group&#39;s problem and not need to do any work at all.</p>

<p>So, if we install the application and the default templates, and go to our site, <code lang='und' xml:lang='und'>http://localhost/isellit</code>; we should see this:</p>

<img src="/pub/2004/04/21/graphics/maypole1.png"/>

<p>Which is only fair for 10 lines of code. But it gets better, because if we click on, say, the product listing, we get a screen like so:</p>

<img src="/pub/2004/04/21/graphics/maypole2.png"/>

<p>Now that&#39;s something we could probably give to the sales team with no further alterations needed, and they could happily add, edit, and delete products.</p>

<p>Similarly, if we then click on a manufacturer in that products table, we see a handy page about the manufacturer, their products, and so on:</p>

<img src="/pub/2004/04/21/graphics/maypole3.png"/>

<p>Now I think we are getting some worth from our 10 lines. Next, we give the templates to the web designers. Maypole searches for templates in three different places: first, it looks for a template specific to a class; then it looks for a custom template for the whole application; finally, it looks in the <em lang='und' xml:lang='und'>factory</em> directory to use the totally generic, do-the-right-thing template.</p>

<p>So, to make a better manufacturer view, we tell them to copy the <em lang='und' xml:lang='und'>factory/view</em> template into <em lang='und' xml:lang='und'>manufacturer/view</em> and customize it. We copy <em lang='und' xml:lang='und'>factory/list</em> into <em lang='und' xml:lang='und'>product/list</em> and customize it as a listing of products; we copy <em lang='und' xml:lang='und'>factory/header</em> and <em lang='und' xml:lang='und'>factory/footer</em> into the <em lang='und' xml:lang='und'>custom/</em> directory, and turn them into the boilerplate HTML surrounding every page, and so on.</p>

<p>Now, I am not very good at HTML design, which is why I like Maypole -- it makes it someone else&#39;s problem -- but this means I&#39;m not very good at showing you what sort of thing you can do with the templates. But here&#39;s a mock-up; I created <code lang='und' xml:lang='und'>product/view</code> with the following template:</p>

<pre lang='und' xml:lang='und'>    [% INCLUDE header %]
    [% PROCESS macros %]

    &#60;DIV class=&#34;nav&#34;&#62; You are in: [% maybe_link_view(product.category) %] &#62; 
    [% maybe_link_view(product.subcategory) %] &#60;/DIV&#62;

    &#60;h2&#62; [% product.name %]&#60;/h2&#62;
    &#60;DIV class=&#34;manufacturer&#34;&#62; By [% maybe_link_view(product.manufacturer) %] 
    &#60;/DIV&#62;
    &#60;DIV class=&#34;description&#34;&#62; [% product.description %] &#60;/DIV&#62;

    &#60;TABLE class=&#34;view&#34;&#62;
    &#60;TR&#62;
        &#60;TD class=&#34;field&#34;&#62; Price (ex. VAT) &#60;/TD&#62; 
        &#60;TD&#62; &#38;pound; [% product.cost %] &#60;/TD&#62;
    &#60;/TR&#62;
    &#60;TR&#62;
        &#60;TD class=&#34;field&#34;&#62; Part number  &#60;/TD&#62; 
        &#60;TD&#62; [% product.part_number %] &#60;/TD&#62;
    &#60;/TR&#62;
    &#60;/TABLE&#62;

    [% button(product, &#34;order&#34;) %]</pre>

<p>Producing the following screenshot. It may not look better, but at least it proves things can be made to look different.</p>

<img src="/pub/2004/04/21/graphics/maypole4.png"/>

<p>We&#39;ve written a Template Toolkit template; the parts surrounded
in <code lang='und' xml:lang='und'>[% ... %]</code> are templating
directives. If you&#39;re not too familiar with the Template Toolkit,
the Maypole manual&#39;s <a href='http://maypole.simon-cozens.org/doc/View.html'>
view documentation</a> has a good introduction to TT in the Maypole context.</p>

<p>Maypole provides a number of default Template macros, such as <code lang='und' xml:lang='und'>maybe_link_view</code>, which links an object to a page viewing that object, although all of these can be overridden. It also passes in the object <code lang='und' xml:lang='und'>product</code>, which it knows to be the one we&#39;re talking about.</p>

<p>In fact, that&#39;s what Maypole is really about: we&#39;ve described it in terms of putting a web front-end onto a database, but fundamentally, it&#39;s responsible for using the URL <code lang='und' xml:lang='und'>/product/view/210</code> to load up the <code lang='und' xml:lang='und'>product</code> object with ID <code lang='und' xml:lang='und'>210</code>, call the <code lang='und' xml:lang='und'>view</code> method on its class, and pass it to the <code lang='und' xml:lang='und'>view</code> template. Similarly, <code lang='und' xml:lang='und'>/product/list</code> calls the <code lang='und' xml:lang='und'>list</code> method on the product class, which populates the template with a page full of products.</p>

<p>The interesting thing about this template is that very last line:</p>

<pre lang='und' xml:lang='und'>    [% button(product, &#34;order&#34;) %]</pre>

<p>This produces a button which will produce a POST to the URL <code lang='und' xml:lang='und'>/product/order/210</code>, which does the same as <code lang='und' xml:lang='und'>view</code> except this time calls the <code lang='und' xml:lang='und'>order</code> method. But Maypole doesn&#39;t yet know how to <code lang='und' xml:lang='und'>order</code> a product. This is OK, because we can tell it.</p>

<h2><a name="Ease_of_Extensibility">Ease of Extensibility</a></h2>

<p>Maypole&#39;s third principle is ease of extensibility. That is to say, Maypole makes it very easy to go from a simple database front-end to a full-fledged web application. Which is just as well; as has been simulated above, once the templates come back from the web designers, you find that what you thought was just going to be a product database has become an online shop. And you&#39;ve still got a deadline.</p>

<p>But before we start extending our catalogue application to take on the new specifications (which we&#39;ll do in the second article about this), let&#39;s take a look at what we&#39;ve achieved so far and what we need immediately.</p>

<p>We&#39;ve got a way to list all the products, manufacturers, categories, and subcategories in our database; we have a way to add, edit and delete all of these things; we can search for products by manufacturer, price, and so on. What&#39;s to stop us deploying this as a customer-facing web site, as well as for Intranet updates to the product catalogue?</p>

<p>The immediate problem is security. We can add, edit, and delete products -- but so can anyone else. We want to allow those coming from the outside world only to view, list and search; for everything else, we require the user to be coming from an IP address in our internal range. (For now; we&#39;ll add the concept of a user when we&#39;re adding the shopping cart, and the idea of privileged user won&#39;t be far off that.)</p>

<p>Unfortunately, now we want some user-defined behavior, we have to start writing code. Thankfully, we don&#39;t have to write much of it. We add a few lines to our driver class, first to define our private IP address space as a <code lang='und' xml:lang='und'>NetAddr::IP</code> object, since that provides a handy way of determining if an address is in a network:</p>

<pre lang='und' xml:lang='und'>    use constant INTERNAL_RANGE =&#62; &#34;10.0.0.0/8&#34;;
    use NetAddr::IP;
    my $range = NetAddr::IP-&#62;new(INTERNAL_RANGE);</pre>

<p>Now we write our authentication method; Maypole&#39;s default <code lang='und' xml:lang='und'>authenticate</code> allows everyone access to everything, so we need to override this.</p>

<pre lang='und' xml:lang='und'>    use Maypole::Constants;
    sub authenticate {
        my ($self, $r) = @_;

        # Everyone can view, search, list
        return OK if $r-&#62;action =~ /^(view|search|list)$/;

        # Else they have to be in the internal network
        my $ip = NetAddr-&#62;IP-&#62;new($r-&#62;{ar}-&#62;connection-&#62;remote_ip);
        return OK if $ip-&#62;within($range);
        return DECLINED;
    }</pre>

<p>The <code lang='und' xml:lang='und'>authenticate</code> class method gets passed a Maypole request object; this is like an Apache request object, but at a much, much higher level -- it contains information about the web request, the class that&#39;s going to be used to fulfill the request, the method we need to call on the class, the template that&#39;s going to be processed, any objects, form parameters, and query parameters, and so on.</p>

<p>At this point, Maypole has already parsed the URI into its component database table, action, and additional arguments, so we first check to see if the action is one of the universally permitted ones.</p>

<p>If not, we extract the <code lang='und' xml:lang='und'>Apache::Request</code> object stashed inside the Maypole object, and ask it for the remote IP address. If it&#39;s in the private range, we can do everything. If not, we can do nothing. Simple enough.</p>

<p>It&#39;s almost ready to go live, when the design guys tell you that they&#39;d really love to put a picture alongside the description of a product. No problem.</p>

<p>There&#39;s two ways to do this; the way that seems really easy uses the file system to store the pictures, and has you put something like this in the template:</p>

<pre lang='und' xml:lang='und'>    &#60;IMG SRC=&#34;/static/product_pictures/[% product.id %].png&#34;&#62;</pre>

<p>But while that&#39;s very simple for viewing pictures, and makes a great mockup, it&#39;s not that easy to upload pictures. So you decide to put the pictures in the database. You add a &#34;picture&#34; binary column to the product table, and then you consult the Maypole manual.</p>

<p>One of the great things about this Perl Foundation sponsorship is
that it&#39;s allowing me to put together a really great manual, which
contains all sorts of tricks for dealing with Maypole; the <a
    href="http://maypole.simon-cozens.org/doc/Request.html">Request</a> chapter contains a couple of recipes for uploading and displaying photos.</p>

<p>What we need to do is create some new actions -- one to upload a picture, and one to display it again. We&#39;ll only show the one to display a picture, since you can get them both from the manual, and because looking at this turns out to be a handy way to understand how to extend Maypole more generally.</p>

<p>It&#39;s useful to visualize what we&#39;re going to end up with, and work backwards. We&#39;ll have a URL like <code lang='und' xml:lang='und'>/product/view_picture/210</code> producing an <code lang='und' xml:lang='und'>image/png</code> or similar page with the product&#39;s image. This allows us to put in our templates:</p>

<pre lang='und' xml:lang='und'>    &#60;IMG SRC=&#34;/product/view_picture/[% product.id %]/&#34;&#62;</pre>

<p>And have the image displayed on our product view page. In fact, we&#39;re more likely to want to say:</p>

<pre lang='und' xml:lang='und'>    [% IF product.picture %]
    &#60;IMG SRC=&#34;/product/view_picture/[% product.id %]/&#34;&#62;
    [% ELSE %]
    &#60;IMG SRC=&#34;/static/no_picture.png&#34;&#62;
    [% END %]</pre>

<p>Now, we&#39;ve explained that Maypole turns URLs into method calls, so we&#39;re going to be putting a <code lang='und' xml:lang='und'>view_picture</code> method in the product&#39;s class; this class is <code lang='und' xml:lang='und'>ISellIt::Product</code>, so we begin like this:</p>

<pre lang='und' xml:lang='und'>    package ISellIt::Product;
    sub view_picture {
        my ($self, $r) = @_;
        # ...
    }</pre>

<p>This has a big problem. We don&#39;t actually want people to be able to call any method on our class over the web; that would be unwise. Maypole will refuse to do this. So in order to tell Maypole that we&#39;re allowed to call this method remotely, we decorate it with an attribute:</p>

<pre lang='und' xml:lang='und'>    sub view_picture :Exported {
        my ($self, $r) = @_;
    }</pre>

<p>At this point, we can call <code lang='und' xml:lang='und'>view_picture</code> over the Web; we now need to make it populate the Maypole request with the appropriate data:</p>

<pre lang='und' xml:lang='und'>    sub view_picture :Exported {
        my ($self, $r, $product) = @_;
        if ($product) {
            $r-&#62;{content_type} = &#34;image/png&#34;;
            $r-&#62;{content} = $product-&#62;picture;
        }
    }</pre>

<p>This is a slightly unusual Maypole method, because we&#39;re bypassing the whole view class processing and templating stages, and generating content manually, but it serves to illustrate one thing: Maypole arranges for the appropriate object to be passed into the method; we&#39;ve gone from URL to object without requiring any code of our own.</p>

<p>When we come to implementing ordering, in our next article, we&#39;ll be adding more actions like this to place the product in a user&#39;s shopping cart, check out, validate his credit card and so on. But this should be good enough for now: a templated, web-editable product database, with pictures, without stress, without too much code, and within the deadline. Well, almost.</p>

<h2><a name="Summary">Summary</a></h2>

<p>Maypole is evolving rapidly, thanks primarily to the Perl Foundation who have enabled me to work on it for this month; it&#39;s allowed me to write many thousands of words of articles, sample applications, and Maypole-related code, and this has helped Maypole to become an extremely useful framework for developing web applications.</p>




                                    </div>


                                </div>
                                <div class="asset-footer">


                                    <div class="entry-tags">
                                        <h4>Tags<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=maypole&amp;limit=20';return false;" rel="tag">maypole</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?IncludeBlogs=2&amp;tag=mvc&amp;limit=20';return false;" rel="tag">mvc</a></li>
                                        </ul>
                                    </div>

                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
