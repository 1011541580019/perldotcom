<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.02" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
    
    <link rel="prev bookmark" href="/pub/2004/03/20040328.html" title="This week on Perl 6, week ending 2004-03-28" />
    <link rel="next bookmark" href="/pub/2004/04/20040404.html" title="This week on Perl 6, week ending 2004-04-04" />
    
    
    <title>Photo Galleries with Mason and Imager - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <div id="top_advert"> 
<!-- Put any landscape advert in here -->
<a href="http://www.perlfoundation.org/" target="_new">
<img src="/i/tpf_banner.png" width="468" height="60" /></a>
        </div> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description"></div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-906" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Photo Galleries with Mason and Imager</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Casey West</span> on <abbr class="published" title="2004-04-01T00:00:00-08:00">April  1, 2004 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Creating a photo gallery is usually considered a daunting task.
Lots of people have tried it,
not many have succeeded.
One of the reasons for so many similar projects is that they don&#39;t often integrate well into an existing web site.
In this article we&#39;re going to build a photo gallery using two important components,
Mason and Imager.
Writing our gallery in Mason will make it much easier to integrate into an existing web site.</p>

<p>Mason,
also known as <a href="http://search.cpan.org/perldoc?HTML::Mason"><code>HTML::Mason</code></a>,
is a web application framework written in Perl.
Mason can run in any environment,
but is tuned to work best with mod_perl.
We will be using a number of Mason features in this article.
If you&#39;re not familiar with Mason I suggest you 
<a href='http://www.oreilly.com/catalog/perlhtmlmason/'>
get the book</a>
or 
<a href='http://masonbook.com'>
browse</a>
before you buy.
This article is not meant to be an introduction to Mason,
so some experience will definitely help when reading this.
Mason idioms will be briefly reviewed when they come up.</p>

<csperl file="grab" domain="on" record="b/795" template="b/article_sidebar.view">

<p><a href="http://search.cpan.org/perldoc?Imager"><code>Imager</code></a> is a Perl module for dealing with images.
It has mechanisms to manipulate an image,
and read and write various formats.
It&#39;s rather lightweight and has a clean interface in comparison to the alternative,
<a href="http://search.cpan.org/perldoc?Image::Magick"><code>Image::Magick</code></a>.</p>

<p>Combining these two Perl modules,
and adding a few others,
allows us to write a feature&#45;full photo gallery in just 200 lines.
Let's get started.</p>

<h3><a name="Apache_Configuration">Apache Configuration</a></h3>

<p>We&#39;re going to use Mason from mod_perl for our gallery.
This requires an Apache built with mod_perl,
and bit of web server configuration.</p>

<p>First,
Mason&#39;s Apache handler must be pre&#45;loaded.</p>

<pre><code>  PerlModule HTML::Mason::ApacheHandler</code></pre>

<p>Next, we need to tell Apache to let Mason handle any requests that it gets for resources within our gallery.</p>

<pre><code>  &#60;Location /gallery&#62;
    SetHandler perl&#45;script
    PerlHandler HTML::Mason::ApacheHandler
  &#60;/Location&#62;</code></pre>

<p>We want to keep special Mason files secret from the general public. If they&#39;re requested, Apache should always return a <code>404</code> HTTP status code, for <i>Not Found</i>.</p>

<pre><code>  &#60;LocationMatch &#34;(dhandler|autohandler)$&quot;&gt;
    SetHandler perl&#45;script
    PerlInitHandler Apache::Constants::NOT_FOUND
  &#60;/LocationMatch&#62;</code></pre>

<p>At this point, every file inside the gallery will be considered a Mason component. If you enjoy paying for lots of bandwidth and you want the full&#45;size images to be viewable by the public, one last configuration step must occur. The raw images are not Mason components so Apache should handle those in the default way.</p>

<pre><code>  &#60;Location /gallery/images&#62;
    SetHandler default
  &#60;/Location&#62;</code></pre>

<h3><a name="Directory_Structure">Directory Structure</a></h3>

<p>For this article we&#39;ll use the following directory structure, in a directory called <em>gallery</em>, inside our site <code>DocumentRoot</code>.</p>

<pre><code>  .
  |&#45;&#45; autohandler
  |&#45;&#45; dhandler
  |&#45;&#45; images
  |   `&#45;&#45; dhandler
  |&#45;&#45; index.html
  `&#45;&#45; pictures
      `&#45;&#45; [lots of images and sub-directories]</code></pre>

<p>As you can see, all the actual photos will be uploaded to the <em>gallery/pictures</em> directory. Our code will recognize sub-galleries and allow for infinite nesting. We can keep our photos very neatly organized this way.</p>

<p>As for the rest, it&#39;s all code. <em>autohandler</em> and <em>dhandler</em> are special Mason files, and <em>index.html</em> is just a wrapper around the top level <em>dhandler</em>.</p>

<h3><a name="The_autohandler">The <em>autohandler</em></a></h3>

<p>For this example, our <em>autohandler</em> is extremely simple. I&#39;m going to assume that you already have a Mason site running with your own <em>autohandler</em> wrappers in place. If you don&#39;t, you can use this one.</p>

<pre><code>  &#60;%method .title&#62;My Website&#60;/%method&#62;

  &#60;html&#62;
    &#60;head&#62;
      &#60;title&#62;&#60;&#38; SELF:.title &#38;&#62;&#60;/title&#62;
    &#60;/head&#62;
    &#60;body&#62;
      &#60;% $m&#45;&#62;call_next %&#62;
    &#60;/body&#62;
  &#60;/html&#62;</code></pre>

<p>The first thing our <em>autohandler</em> does is define a subcomponent called <code>.title</code>. Mason subcomponents are wrapped in <code>&#60;%method&#62;</code> blocks. They are templates just like files; the only difference is they live inside the files. This is analogous to Perl files and subroutines.</p>

<p>Next we define the skeleton of the web page. The <code>&#60;title&#62;</code> tag&#39;s content is dynamically generated by the output of the <code>SELF:.title</code> subcomponent. Any time you want to call a subcomponent, the call is wrapped in <code>&#60;&#38; &#38;&#62;</code> delimiters.</p>

<p>The body, or content, of our web page will be provided by whatever component is next in the call stack. Using the global variable to access Mason object, <code>$m</code>, the <code>call_next()</code> method is executed to do just that.</p>

<p>In our gallery the next component in the call stack will be one of two files. If we&#39;re at the topmost level, <code>http://example.com/gallery/</code>, for example, <em>index.html</em> will be called. Everywhere else <em>dhandler</em> will be called. This is because no files exist for Mason to map to, and when that happens, Mason looks for a <em>dhandler</em> to execute.</p>

<h3><a name="The_Invisible_Index">The Invisible Index</a></h3>

<p><code>dhandlers</code> are default handlers for files inside a directory, and not that directory itself. Because of this we are required to provide an <em>index.html</em> file or Apache will attempt to display a directory listing, or possibly return a <i>forbidden</i> status code, if directory listings are not allowed. In reality, our <em>index.html</em> doesn&#39;t do anything at all.</p>

<p>In its entirety, <em>index.html</em> simply states that it inherits from <em>dhandler</em>. Now <em>dhandler</em> will be executed for all non&#45;image access to our photo gallery.</p>

<pre><code>  &#60;%flags&#62;
    inherit =&#62; &#39;dhandler&#39;
  &#60;/%flags&#62;</code></pre>

<p>This uncovers a portion of Mason&#39;s object&#45;like component inheritance. By default, all components inherit from <em>autohandler</em>. For <em>index.html</em> we&#39;ve changed that. <em>dhandler</em> still inherits from <em>autohandler</em>, so anytime a request is sent to <em>index.html</em>, <em>dhandler</em> is first called, which calls <em>autohandler</em> first. Then <em>autohandler</em> does its thing and moves down the call stack to <em>dhandler</em>. <em>dhandler</em>, as we&#39;ll see, is not configured to call down the stack to <em>index.html</em>, because it doesn&#39;t need to. Thus ends the very high&#45;level overview of Mason inheritance.</p>













<h3><a name="Displaying_Gallery_Pages">Displaying Gallery Pages</a></h3>

<p>Moving on to the meat of our application, the top&#45;level <em>dhandler</em>. This file has the bulk of our code, roughly 150 lines. The code is neatly organized into subcomponents, so we&#39;ll start by discussing the high&#45;level code. And from that we&#39;ll work in order of execution.</p>

<p>Each page in our photo gallery has just one optional argument, a page number. By default we always start on page one (<code>1</code>).</p>

<pre><code>  &#60;%args&#62;
    $page =&#62; 1
  &#60;/%args&#62;</code></pre>

<p>Next, the <code>&#60;%shared&#62;</code> block is executed. It does a lot, so we&#39;ll look at it in great detail. We&#39;re using a <code>&#60;%shared&#62;</code> block instead of an <code>&#60;%init&#62;</code> block because some of the variables defined here need to be used within multiple subcomponents. As the name suggests, <code>&#60;%shared&#62;</code> blocks allow just that.</p>

<pre><code>  &#60;%shared&#62;
    use List::Group qw[group];
    use HTML::Table;
    use File::Spec::Functions qw[:ALL];</code></pre>

<p>The first step is to load the Perl modules this component will be using. <a href="http://search.cpan.org/perldoc?List::Group"><code>List::Group</code></a> turns a flat list into a List&#45;of&#45;Lists (LoL) based on specific grouping options, <a href="http://search.cpan.org/perldoc?HTML::Table"><code>HTML::Table</code></a> turns such an LoL into an HTML table structure, and <a href="http://search.cpan.org/perldoc?File::Spec::Functions"><code>File::Spec::Functions</code></a> provides a number of portable file and directory operations.</p>

<pre><code>    my $GALLERY_ROOT = $r&#45;&#62;document_root . &#34;/gallery/pictures&#34;;</code></pre>

<p>Next, we define the first shared variable. <code>$GALLERY_ROOT</code> is the absolute path to the location of the gallery pictures on the file system.</p>

<pre><code>    (my $path_from_uri = $m&#45;&#62;dhandler_arg) =~ s!(?:(?:/index)?\.html|/)$!!;</code></pre>

<p>It&#39;s time to determine the relative path to the resource being requested. Because we&#39;re inside a <em>dhandler</em>, Mason provides the <code>dhandler_arg()</code> method, which is similar in purpose to Apache&#39;s <code>uri()</code> method. It returns the portion of a URI that is relative to the directory containing the <em>dhandler</em>. If we request <code>/gallery/Family/IMG_0001.JPG.html</code>, <code>$m&#45;&#62;dhandler_arg()</code> will return <code>/Family/IMG_0001.JPG.html</code>.</p>

<p>Because we&#39;re looking for the path to an actual photo or gallery directory, there is some information to be removed from the end of our relative path. So our regex removes useless information such as index files, HTML extensions, and extra backslashes.</p>

<pre><code>    my $file = catdir $GALLERY_ROOT, $path_from_uri;
    $m&#45;&#62;clear_buffer and $m&#45;&#62;abort(404) unless &#45;e $file;</code></pre>

<p>From these two variables we can construct the absolute path to the file we&#39;re interested in using <code>catdir()</code>, from <code>File::Spec::Functions</code>. If this file doesn&#39;t exist, we don&#39;t want to go any further, so Mason&#39;s output buffer is cleared and the request is aborted immediately with a <code>404</code> HTTP status code, meaning <i>Not Found</i>.</p>

<p>If a gallery is being requested, not a specific photo, we must get the contents of that gallery. If a photo is being requested, we must get the contents of the gallery that photo belongs to.</p>

<pre><code>    my $dir = &#45;d $file ? $file : (splitpath $file)[1];
    opendir DIR, $dir or die $!;
    my $dir_list = [ map &#34;$dir/$_&#34;, grep { ! /^\./ } readdir DIR ];
    closedir DIR;</code></pre>

<p>Using a file test operator, we can determine if the current request is for a file or a directory. If a directory we simply assign <code>$file</code> to <code>$dir</code>. If a file, we use <code>splitpath()</code> from <code>File::Spec::Functions</code>. <code>splitpath()</code> returns three elements, the volume, directory tree, and filename. We&#39;re after the directory tree, or second element.</p>

<p>The <code>$dir_list</code> array reference is populated with a list of absolute paths to each file in <code>$dir</code>, excluding files that begin with a dot (<code>.</code>).</p>

<p>Now it&#39;s time to move on to building the breadcrumbs for navigation. This method of navigating &#34;up&#34; the photo gallery is important because we can have infinite levels of sub-galleries.</p>

<pre><code>    my @bread_crumb = (&#39;Gallery&#39;, splitdir $path_from_uri);</code></pre>

<p>First we define our plain&#45;text list of crumbs in <code>@bread_crumb</code>. The first element is the name of our photo gallery, which I imaginatively named <i>Gallery</i>. The rest of our breadcrumbs come from <code>$path_from_uri</code> by calling <code>splitpath()</code> to get the list of elements.</p>

<p>Our <code>@bread_crumb</code> list is great for the title of the page, but it doesn&#39;t contain any links for use inside the page for navigation. A new list of breadcrumbs will be created with correct linking.</p>

<pre><code>    my @bread_crumb_href;
    push @bread_crumb_href, sprintf &#39;&#60;a href=&#34;/gallery/%s&quot;&gt;%s&#60;/a&#62;&#39;,
      join(&#39;/&#39;,@bread_crumb[1..$_]), $bread_crumb[$_]
        for 0 .. $#bread_crumb &#45; 1;
    push @bread_crumb_href, $bread_crumb[&#45;1];</code></pre>

<p>For each breadcrumb except the very last, we create an HTML link. The reference location for each link, from left to right, needs to cumulatively add directories from the links before it. That&#39;s what <code>join(&#39;/&#39;,@bread_crumb[1..$_])</code> does. Finally we tack on the last element of the breadcrumb, unlinked, because it is the currently requested resource.</p>

<p>To illustrate, if a request is made to <code>/gallery/Backgrounds/Nature%20Backgrounds/ICmiddleFalls1280x1024.jpg.html</code>, the following list is in <code>@bread_crumb_href</code>.</p>

<pre><code>  (
   &#39;&#60;a href=&#34;/gallery/&quot;&gt;Gallery&#60;/a&#62;&#39;,
   &#39;&#60;a href=&#34;/gallery/Backgrounds&quot;&gt;Backgrounds&#60;/a&#62;&#39;,
   &#39;&#60;a href=&#34;/gallery/Backgrounds/Nature Backgrounds&quot;&gt;Nature Backgrounds&#60;/a&#62;&#39;,
   &#39;ICmiddleFalls1280x1024.jpg&#39;
  )</code></pre>

<p>Finally, we construct two scalars to hold the contents of our breadcrumbs.</p>

<pre><code>    my $bread_crumb      = join &#39; &#38;middot; &#39;, @bread_crumb;
    my $bread_crumb_href = join &#39; &#38;middot; &#39;, @bread_crumb_href;
  &#60;/%shared&#62;</code></pre>

<p>At this point we can define the <code>.title</code> subcomponent, using the <code>$bread_crumb</code> shared variable.</p>

<pre><code>  &#60;%method .title&#62;&#60;&#38; PARENT:.title &#38;&#62; &#38;middot; &#60;% $bread_crumb %&#62;&#60;/%method&#62;</code></pre>

<p>Notice that there is a subcomponent call to <code>PARENT:.title</code>. This is another illustration of Mason&#39;s inheritance model. Because <em>dhandler</em> <b>inherits</b> from <em>autohandler</em>, the <code>.title</code> subcomponent in <em>dhandler</em> is overriding the <code>.title</code> method in <em>autohandler</em>. That is to say, <em>dhandler</em> is <b>subclassing</b> <em>autohandler</em>. For this reason, if we don&#39;t want to clobber the <code>.title</code> subcomponent declared in <em>autohandler</em> we must be sure to call our parent. This is very similar to invoking a <code>SUPER::</code> method in Perl.</p>

<p>Now we can move on to the actual gallery display.</p>

<pre><code>  &#60;h1&#62;Photo Gallery&#60;/h1&#62;
  &#60;h2&#62;&#60;% $bread_crumb_href %&#62;&#60;/h2&#62;</code></pre>

<p>Using another shared variable, <code>$bread_crumb_href</code>, we construct our backward navigation.</p>

<pre><code>  &#60;table&#62;
    &#60;tr&#62;
      &#60;td valign=&#34;top&#34; width=&#34;15%&quot;&gt;
        &#60;&#38; SELF:.sub_gal_list, dir_list =&#62; $dir_list &#38;&#62;
      &#60;/td&#62;
      &#60;td valign=&#34;top&#34; width=&#34;35%&quot;&gt;
        &#60;&#38; SELF:.photo_list, dir_list =&#62; $dir_list, page =&#62; $page &#38;&#62;
      &#60;/td&#62;
      &#60;td valign=&#34;top&#34; width=&#34;50%&quot;&gt;
  % if ( &#45;f $file ) {
        &#60;&#38; SELF:.photo_view, file =&#62; $file &#38;&#62;
  % }
      &#60;/td&#62;
    &#60;/tr&#62;
  &#60;/table&#62;</code></pre>

<p>We have three columns of information to display at any one time -- an HTML table is a good way to do that. (Some standards purists and XHTML masochists will disagree with me on this point. I&#39;m interested in keeping the examples simple, not pure.) Each of the table cells calls a subcomponent with the appropriate arguments. Those subcomponents are discussed in detail later in this article. Notice that before we call <code>SELF:.photo_view</code> we check to see if the request is currently for a file. This can save us from calling that subcomponent if we currently don&#39;t want to look at a photo.</p>

<p>The first subcomponent called is <code>SELF:.sub_gal_list</code>. As the name suggests, it will list sub-galleries.</p>

<pre><code>  &#60;%method .sub_gal_list&#62;
    &#60;%args&#62;
      @dir_list
      $wrap =&#62; 1
    &#60;/%args&#62;

    &#60;h3&#62;Sub &#60;% @dir_list == 1 ? &#34;Gallery&#34; : &#34;Galleries&#34; %&#62;&#60;/h3&#62;
    &#60;% $table %&#62;
  
    &#60;%init&#62;
      @dir_list = grep { &#45;d $_ } @dir_list;
      return unless @dir_list;
      $_ = $m&#45;&#62;scomp(&#39;SELF:.sub_gal_view&#39;,dir =&#62; $_) for @dir_list;
      my $table = HTML::Table&#45;&#62;new(&#45;data =&#62; [ group \@dir_list, cols =&#62; $wrap ]);
    &#60;/%init&#62;
  &#60;/%method&#62;</code></pre>

<p><code>.sub_gal_list</code> accepts a directory listing argument. It also optionally accepts an argument detailing after how many entries in the list should be in each row.</p>













<p>Jumping to the <code>&#60;%init&#62;</code> block (remember the order of execution?), we filter the directory listing to exclude any entries that are not directories themselves. If that produces an empty list, there&#39;s no need to continue processing this subcomponent, so just <code>return</code>. Next, each of the entries are reformatted by passing them to the <code>SELF:.sub_gal_view</code> method. This is where it gets fun.</p>

<p>When a subcomponent is called, it&#39;s really just syntactic sugar to call <code>$m&#45;&#62;comp()</code>.</p>

<pre><code>  &#60;&#38; SELF:.sub_gal_view, dir =&#62; $_ &#38;&#62;</code></pre>

<p>The previous statement is exactly equivalent to the following:</p>

<pre><code>  % $m&#45;&#62;comp( &#39;SELF:.sub_gal_view&#39;, dir =&#62; $_ );</code></pre>

<p>Mason also defines the <code>scomp()</code> method, which compiles a subcomponent but returns its output as a string, just like Perl&#39;s <code>sprintf</code>.</p>

<p>After reformatting the entries, we group the flat list into a List&#45;of&#45;Lists containing just one column. That list is used as the value of the <code>-data</code> parameter to <code>HTML::Table&#45;</code>new()&#62;, which returns a table object.</p>

<p>Now it&#39;s time to process the template portion. First a heading is created. It&#39;s only plural if we have more than one sub-gallery. After the heading the sub-gallery table is displayed. Because an <code>HTML::Table</code> object overloads stringify, there&#39;s no need to call a method on it to get the HTML output.</p>

<p>Let's quickly look at the <code>.sub_gal_view</code> subcomponent used to reformat each directory listing.</p>

<pre><code>  &#60;%method .sub_gal_view&#62;
    &#60;%args&#62;
      $dir
    &#60;/%args&#62;
    &#60;a href=&#34;/gallery/&#60;% $rel_dir %&#62;&quot;&gt;&#60;% $label %&#62;&#60;/a&#62;
    &#60;%init&#62;
      my $rel_dir = abs2rel $dir, $GALLERY_ROOT;
      my $label   = (splitpath $rel_dir)[&#45;1];
    &#60;/%init&#62;
  &#60;/%method&#62;</code></pre>

<p>This subcomponent is extremely straightforward. It accepts a directory. Inside <code>&#60;%init&#62;</code>, <code>$rel_dir</code> is set to the relative directory path in relation to the <code>$GALLERY_ROOT</code>, which will give us a proper URL for the link. Finding the label for the link is simple, it is the real directory name, which is the last element of the list returned by <code>splitpath()</code>, from <code>File::Spec::Functions</code>.</p>

<p>This subcomponent finally generates the proper link for navigating to sub-galleries.</p>

<p>The next subcomponent called by our top&#45;level component is <code>.photo_list</code>, which generates the thumbnail view of our images.</p>

<pre><code>  &#60;%method .photo_list&#62;
    &#60;%args&#62;
      @dir_list
      $wrap =&#62; 5
      $rows =&#62; 7
      $page =&#62; 1
    &#60;/%args&#62;

    &#60;h3&#62;&#60;% @dir_list == 1 ? &#34;Photo&#34; : &#34;Photos&#34; %&#62;
        &#60;&#38; SELF:.photo_pager, page =&#62; $page, pages =&#62; $pages &#38;&#62;&#60;/h3&#62;
    &#60;% $table %&#62;

    &#60;%init&#62;
      @dir_list = grep { &#45;f $_ } @dir_list;
      return unless @dir_list;
      $_ = $m&#45;&#62;scomp(&#39;SELF:.thumb_view&#39;,file =&#62; $_, page =&#62; $page)
        for @dir_list;
      my @files = group \@dir_list, cols =&#62; $wrap;
      
      my $pages  = int( @files / $rows );
         $pages += 1 if $pages &#60; ( @files / $rows );
      @files = splice @files, $rows * ($page &#45; 1), $rows;
      
      my $table = HTML::Table&#45;&#62;new(&#45;data =&#62; \@files);
    &#60;/%init&#62;
  &#60;/%method&#62;</code></pre>

<p>Just like <code>.sub_gal_list</code>, the only required argument to this component is the directory listing. The other optional arguments correspond to how many images should be in each row (<code>$wrap</code>), how many rows to show on a page (<code>$rows</code>), and what page we&#39;re currently on (<code>$page</code>).</p>

<p>Once again we jump to the <code>&#60;%init&#62;</code> block where the directory listing is filtered to only include files. If there are no files, there&#39;s no reason to go any further, so just <code>return</code> from this subcomponent. Just as we did with sub-gallery listings, we reformat the remaining list of files by calling a subcomponent and storing its output. Next, we group the list of files into a List&#45;of&#45;Lists (LoL), each row containing <code>$wrap</code> entries.</p>

<p>Photo galleries may contain any number of photos, so it&#39;s essential to support paging for thumbnails. First we need to determine how many pages this gallery will have in total. To do that we divide the total number of rows by the number of rows we want on each page. That could return a fractional number that will be cut off to the nearest decimal by <code>int</code>. If that&#39;s the case then we want to increment the number of pages by one (<code>1</code>). Next we can extract the rows for our current page from all the rows currently in <code>@files</code> using a <code>splice</code>.</p>

<p>Finally, a new <code>HTML::Table</code> object is created, and populated with <code>@files</code>.</p>

<p>In the template portion a header is output, again only using the plural if we have more than one photo. Our header also contains paging information, provided by the <code>.photo_pager</code> subcomponent. Lastly, the HTML table full of thumbnails is displayed.</p>

<p>Speaking of thumbnails, it&#39;s time to look at the code in the <code>.thumb_view</code> subcomponent.</p>

<pre><code>  &#60;%method .thumb_view&#62;
    &#60;%args&#62;
      $file
      $page
    &#60;/%args&#62;
      &#60;a href=&#34;/gallery/&#60;% $rel_img %&#62;.html?page=&#60;% $page %&#62;&quot;&gt;
        &#60;img src=&#34;/gallery/images/&#60;% $rel_img %&#62;?xsize=50;ysize=40&#34; border=&#34;0&#34; /&#62;
      &#60;/a&#62;
    &#60;%init&#62;
      my $rel_img = abs2rel $file, $GALLERY_ROOT;
    &#60;/%init&#62;
  &#60;/%method&#62;</code></pre>

<p>This component takes two arguments. <code>$file</code> is the image to be turned into a thumbnail, and <code>$page</code> is the current page of this gallery. The <code>&#60;%init&#62;</code> block just finds the relative path of this image from the <code>$GALLERY_ROOT</code>. In the template the thumbnail is linked to the HTML file that this image would be displayed on, and includes the current page information as a means of saving that state.</p>

<p>The source of the image points to a file under <em>/gallery/images</em>, and includes query parameters for maximum width (<code>xsize</code>) and height (<code>ysize</code>). This is interesting because the pictures don&#39;t live there at all. If you recall, the only thing inside the <em>images</em> directory was a <em>dhandler</em>. More on that later.</p>

<p>The other subcomponent that <code>.photo_list</code> called was <code>.photo_pager</code>.</p>

<pre><code>  &#60;%method .photo_pager&#62;
    &#60;%args&#62;
      $page
      $pages
    &#60;/%args&#62;
    (
  % for ( 1 .. $pages ) {
  %   if ( $_ == $page ) {
        &#60;strong&#62;&#60;% $page %&#62;&#60;/strong&#62;
  %   } else {
        &#60;a href=&#34;?page=&#60;% $_ %&#62;&quot;&gt;&#60;% $_ %&#62;&#60;/a&#62;
  %   }
      &#60;% $_ != $pages ? &#34;&#38;middot;&#34; : &#34;&#34; %&#62;
  % }
    )
    &#60;%init&#62;
      return if $pages == 1;
    &#60;/%init&#62;
  &#60;/%method&#62;</code></pre>

<p>This subcomponent takes two arguments, the current page and the total number of pages. Before anything is output, the <code>&#60;%init&#62;</code> block checks to make sure we have more than one page. If not, no sense in going on. Looping through all the page numbers, we link all the numbers except our current page. After every number except the last one, we output a stylish separator. This subcomponent is very simple, but big enough that it&#39;s worth abstracting from the <code>.photo_list</code> subcomponent.</p>

<p>The final subcomponent in the top&#45;level <em>dhandler</em> is <code>.photo_view</code>.</p>

<pre><code>  &#60;%method .photo_view&#62;
    &#60;%args&#62;
      $file
    &#60;/%args&#62;
    &#60;h3&#62;Photo&#60;/h3&#62;
    &#60;img src=&#34;/gallery/images/&#60;% $rel_image %&#62;?xsize=400x;ysize=300&#34; /&#62;
    &#60;%init&#62;
      my $rel_image = abs2rel $file, $GALLERY_ROOT;
    &#60;/%init&#62;
  &#60;/%method&#62;</code></pre>

<p>This component does things that we&#39;ve already seen done in <code>.thumb_view</code>, so there&#39;s no need to expound upon it here.</p>














<h3><a name="The_Images_dhandler">The Images <em>dhandler</em></a></h3>

<p>You&#39;ve probably guessed by now that we intend to use Mason to process images. Mason is well suited to outputting many forms of data, not just text, and we&#39;ll be exploiting that fact for our image gallery.</p>

<pre><code>  &#60;%args&#62;
    $xsize =&#62; undef
    $ysize =&#62; undef
  &#60;/%args&#62;</code></pre>

<p>This component accepts two parameters that we&#39;ve already described. <code>$xsize</code> is the maximum width an image can be, and <code>$ysize</code> is the maximum height an image can be.</p>

<pre><code>  &#60;%flags&#62;
    inherit =&#62; undef
  &#60;/%flags&#62;</code></pre>

<p>This is the important part. Because components have inheritance, the <em>dhandler</em> would normally inherit from the <em>autohandler</em>. That&#39;s bad news when the <em>autohandler</em> is tuned to sending out HTML and our <em>dhandler</em> is trying to send binary image data. Setting the <code>inherit</code> flag to <code>undef</code> tells Mason that the <em>dhandler</em> doesn&#39;t inherit anything, that it&#39;s responsible for its own output.</p>

<p>The only code remaining in this template resides in the <code>&#60;%init&#62;</code> block, so let's step through that now.</p>

<pre><code>  &#60;%init&#62;
    $m&#45;&#62;clear_buffer;</code></pre>

<p>The very first thing we do is clear Mason&#39;s output buffer. This clears any headers that have already been built up in the buffer.</p>

<pre><code>    use Imager;
    use File::Type;</code></pre>

<p>Next we use the modules that will help scale the images, <code>Imager</code> and <code>File::Type</code>. <code>Imager</code> has already been discussed. <code>File::Type</code> uses magic to discover the type of files, and does so in a very memory&#45;sensitive way.</p>

<pre><code>    my $send_img = sub {
      $r&#45;&#62;content_type( &#34;image/$_[0]&#34; );
      $r&#45;&#62;send_http_header;
      $m&#45;&#62;print($_[1]);
      $m&#45;&#62;abort(200);
    };</code></pre>

<p>This anonymous subroutine just encapsulates code being executed twice, as a means to remove duplication. It sets the HTTP <code>Content&#45;Type</code> header to the image type passed as the first argument. Next it sends the HTTP header out. Then it sends the image data out, which is the second argument passed to this subroutine. Finally, it aborts execution with an HTTP <code>200</code> status code, everything is <i>OK</i>.</p>

<pre><code>    ( my $file = $r&#45;&#62;document_root . $r&#45;&#62;uri ) =~ s/images/pictures/;</code></pre>

<p>Discovering the proper file name for the image takes just a little work. After concatenating the <code>document_root()</code> with the <code>uri()</code>, we replace the <em>images</em> portion of the file path with <em>pictures</em>. Remember, none of the images are actually in the <em>images</em> directory.</p>

<pre><code>    my ($image, $type) = split /\//, File::Type&#45;&#62;checktype_filename($file);
    $type = &#39;png&#39; if $type eq &#39;x&#45;png&#39;;</code></pre>

<p>With the knowledge of the proper file name, <code>File::Type</code> can figure out what type of file we have. This is more foolproof than attempting a guess based on filename extensions. As a minor oddity, <code>File::Type</code> returns a non&#45;HTTP friendly <code>$type</code> for PNG images, so we need to fix that problem if it exists.</p>

<pre><code>    my $key = &#34;$file|$xsize|$ysize&#34;;
    if ( my $data = $m&#45;&#62;cache&#45;&#62;get( $key ) ) {
      $send_img&#45;&#62;($type, $data);
    }</code></pre>

<p>Generating scaled images from huge photos is a time-consuming function. It also has the potential to eat memory like a sieve. As a result, it&#39;s imperative that we take advantage of Mason&#39;s built&#45;in caching functionality. The key for each entry in our cache must be unique for each file, and the dimensions we&#39;re trying to scale it to. Those three pieces of data will make up our <code>$key</code>. If data is returned from the cache using the <code>$key</code>, then the image data is sent and the request is immediately aborted. This is a quick short-circuit that allows us to grab an image from the cache and return it at the earliest possible moment. Later in the article you&#39;ll see how to set the data into the cache.</p>

<pre><code>    $m&#45;&#62;abort(500) if $image ne &#39;image&#39; || ! exists $Imager::formats{$type};</code></pre>

<p>It&#39;s possible that the file being requested isn&#39;t an image. It&#39;s also possible that our installation of <code>Imager</code> doesn&#39;t support this type of image. If either of these conditions are true, we should abort immediately with a <code>500</code> HTTP status code, <i>Internal Server Error</i>.</p>

<pre><code>    my $img  = Imager&#45;&#62;new;
    if ( $img&#45;&#62;open(file =&#62; $file, type =&#62; $type) ) {
        if ( $xsize ) {
          $img = $img&#45;&#62;scale( xpixels =&#62; $xsize )
            unless $img&#45;&#62;getwidth &#60; $xsize;
        }
        if ( $ysize ) {
          $img = $img&#45;&#62;scale( ypixels =&#62; $ysize )
            unless $img&#45;&#62;getheight &#60; $ysize;
        }

        my $img_data;
        $img&#45;&#62;write(data =&#62; \$img_data, type =&#62; $type);
        $m&#45;&#62;cache&#45;&#62;set( $key =&#62; $img_data );
        $send_img&#45;&#62;($type, $img_data);
    }</code></pre>

<p>Now the heart and soul of image manipulation. The first step is to create a new <code>Imager</code> object. Next we try to open the image <code>$file</code>. If that succeeds, we can proceed to scaling the image.</p>

<p>When scaling, it&#39;s more important (to me) that the height of the image is exactly how I want it, so width is scaled first. Before the image is scaled its size is tested against the size of the image to be created. No scaling should occur if the image is smaller than the preferred size.</p>

<p>Once scaling has finished the image data can be extracted from the <code>Imager</code> object. When calling <code>write()</code> on the object we can pass a <code>data</code> option to let <code>Imager</code> write to a scalar reference. After the image data has been retrieved it is placed in the cache using the same <code>$key</code> that we first used when attempting to get information out of the cache. Finally, the image is sent out and the request is aborted.</p>

<pre><code>    warn &#34;[$file] [$image/$type] &#34; . $img&#45;&#62;errstr;
    $m&#45;&#62;abort(500);
  &#60;/%init&#62;</code></pre>

<p>In the event that <code>Imager</code> wasn&#39;t able to open the <code>$file</code>, the request should be aborted with a <code>500</code> HTTP status code, <i>Internal Server Error</i>. Before abortion, however, it would be useful to get some information in the <em>error_log</em>. The requested <code>$file</code>, its type information, and the error produced by <code>Imager</code> are all printed to <code>STDOUT</code> via <code>warn</code>.</p>

<h3><a name="What_It_Looks_Like">What It Looks Like</a></h3>

<p>For the less adventurous, yet overly curious members of the audience, a screenshot of our photo gallery follows.</p>


<p><img src="/pub/2004/04/01/graphics/figure_0.jpg" width="450" height="285" alt="Photo Gallery Screenshot" border="0" /></p>


<p>As an aside, that image was originally much larger, but I really wanted it to be just <code>450</code> pixels wide. I don&#39;t have any image manipulation tools to do that job, but I do have <code>Imager</code>. Thanks to <code>Imager</code>, it took me 30 seconds to whip up the following command line snippet.</p>

<pre><code>  perl &#45;MImager &#45;le&#39;Imager&#45;&#62;new&#45;&#62;open(file=&#62;shift,type=&#62;&#34;jpeg&#34;)
    &#45;&#62;scale(xpixels=&#62;450)
    &#45;&#62;write(file=&#62;shift,type=&#62;&#34;jpeg&#34;)&#39; figure_0.jpg figure_0_0.jpg</code></pre>

<h3><a name="Conclusion">Conclusion</a></h3>

<p>We&#39;ve just created a photo gallery that takes all the hard work out of maintaining photo galleries. There&#39;s no need to pre&#45;generate HTML or thumbnails. There&#39;s no web application interface so you don&#39;t have to change ownership of your gallery directory to the same user that Apache runs as. Using Mason&#39;s built-in caching, photo galleries are nearly as fast as accessing the data directly from the file system. Well, at least on the second request. Our galleries have paging and infinite sub-galleries. Most importantly, using Mason to its full potential has given us a fully customizable, very tiny web application that can be dropped into any existing web site or framework.</p>

<p>In fact, this code is the majority of the <i>faceplant</i> project. The source code can be downloaded from <a href='http://search.cpan.org/dist/faceplant'>http://search.cpan.org/dist/faceplant</a>. <i>faceplant</i> implements a few more features and is a bit more customizable. As such, its code is an excellent follow&#45;up to this article. Go forth, now, and plant thy face on the Internet!</p>

                                    </div>


                                </div>
                                <div class="asset-footer">

    
                                    <div class="entry-categories">
                                        <h4>Categories<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="/pub/graphics/" rel="tag">Graphics</a><span class="delimiter">,</span></li> <li class="entry-category"><a href="/pub/web-development/" rel="tag">Web Development</a></li>
                                        </ul>
                                    </div>
    


                                    <div class="entry-tags">
                                        <h4>Tags<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?blog_id=2&amp;tag=galleries&amp;limit=20';return false;" rel="tag">galleries</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?blog_id=2&amp;tag=imager&amp;limit=20';return false;" rel="tag">imager</a><span class="delimiter">,</span></li> <li><a href="javascript:void(0)" onclick="location.href='http://www.perl.com/mt-search.cgi?blog_id=2&amp;tag=mason&amp;limit=20';return false;" rel="tag">mason</a></li>
                                        </ul>
                                    </div>

                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2010/07/">July 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.02" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
