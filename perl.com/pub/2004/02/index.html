<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: February 2004 Archives</title>


    <link rel="prev" href="/pub/2004/01/" title="January 2004" />
    <link rel="next" href="/pub/2004/03/" title="March 2004" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">February 2004 Archives</h1>





                            
                            <div id="entry-888" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/02/p6pdigest/20040229.html" rel="bookmark">This week on Perl 6, week ending 2004-02-29</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-02-29T00:00:00-08:00">February 29, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Welcome to the leapday summary.
We&#39;ll crack straight on with perl6&#45;internals</p>

<h4><a name="Running_up_to_release_time">Running up to release time</a></h4>

<p>As Leapday had been chosen as the release date for Parrot 0.1.0,
the week was mostly spent getting things ready for release.
A case in point was the <em lang='und' xml:lang='und'>PLATFORMS</em> file which lists those platforms on which Parrot is known to compile and run,
which (at the beginning of the week) was short several platforms and generally out of date.
So everyone manned the pumps and sent in reports of success and failure.
BTW,
if you manage to get Parrot up and running (or even partially up and limping) on a platform that&#39;s not listed in <em lang='und' xml:lang='und'>PLATFORMS</em> then perl6&#45;internals@perl.org would be very pleased to hear from you.</p>

<p><a href='http://groups.google.com/groups?selm=4039C81F.1090108@toetsch.at'>http://groups.google.com</a></p>

<h4><a name="Objects_and_time">Objects and time</a></h4>

<p>Dan announced that he&#39;d trodden on one of the nasty bits of objects; the proper ordering of classes for initialization and destruction in the face of multiple inheritance.
He announced that he was in the process of actively ignoring it for the time being and canvassed opinions about whether to delay the Leapday release in favour of fully specced/implemented objects or whether to make the 29th without objects,
or some other choice.
In the end we decided to still aim for the 29th,
with objects in a 90% there state,
but with big &#39;HERE BE DRAGONS&#39; warnings plastered on the tricky edge cases.
A little later Dan announced what would be there for the release (Multiple inheritance,
attributes,
object instantiation and method calls) and what wouldn&#39;t (monkeying with some things after subclassing/instantiation,
method redispatch and fancy namespace lookups).</p>
<csperl file="grab" domain="on" record="b/940" template="b/article_sidebar.view">
<p>As the week progressed,
objects inched closer and closer to readiness,
though at least one summarizer&#39;s heart was in his mouth as the week ebbed away.
Would Dan get everything he&#39;d promised working before the deadline?
Tune in later on to find out.</p>

<p><a href='http://groups.google.com/groups?selm=a06010202bc5fcbfaeb19@[172.24.18.98]'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=a06010205bc5fd8fef7f7@[172.24.18.98]'>http://groups.google.com</a></p>

<h4><a name="Feature_Freeze">Feature Freeze</a></h4>

<p>On Wednesday,
Leo T&#246;tsch announced a feature slush (patches to add OO features were still being accepted) in anticipation of a release.
The patch rate increased as people got on with fixing up failing tests on various platforms,
improving documentation,
and improving OO functionality.
Not all the object patches were from Dan; chromatic got in on the act with a couple of tweaks to <em lang='und' xml:lang='und'>parrotobject.pmc</em>...</p>

<p><a href='http://groups.google.com/groups?selm=403C647E.5070407@toetsch.at'>http://groups.google.com</a></p>

<h4><a name="Native_PBC_issues">Native PBC issues</a></h4>

<p>It turns out that,
just at the moment,
Parrot bytecode isn&#39;t actually platform independent.
This will,
of course,
get fixed,
but it&#39;s not Leo&#39;s top priority at present.
He asked people who are running Parrot on 64 bit and Big endian architectures to submit <em lang='und' xml:lang='und'>native_pbc</em> test files (if you&#39;re on such an architecture,
take a look at <em lang='und' xml:lang='und'>t/native_pbc/*.t</em> for instructions,
and the Parrot community will thank you for it).</p>

<p><a href='http://groups.google.com/groups?selm=403C82A7.5050806@toetsch.at'>http://groups.google.com</a></p>

<h4><a name="Object_Questions">Object Questions</a></h4>

<p>Simon Glover did some sterling work exercising the Object documentation and implementation,
posting several bug reports and questions.</p>

<p><a href='http://groups.google.com/groups?selm=Pine.GSO.4.43.0402251338310.19034&#45;100000@egg.amnh.org'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=Pine.GSO.4.43.0402251651500.27206&#45;100000@egg.amnh.org'>http://groups.google.com</a></p>

<h4><a name="Ladies_and_Gentleman:_Objects!">Ladies and Gentleman: Objects!</a></h4>

<p>On Wednesday,
several full days before the release date,
Dan announced that objects were done (well,
everything that he promised would work did) and asked for people to start &#39;abusing it heavily&#39;.
Which they promptly did.
There was applause too.</p>

<p><a href='http://groups.google.com/groups?selm=a0601020cbc62e5fe9c0a@[10.0.1.2]'>http://groups.google.com</a></p>

<h4><a name="Next_on_the_hit_list">Next on the hit list</a></h4>

<p>Having got objects up,
Dan immediately posted a list of desiderata for the next release but one.
Is there no stopping him?</p>

<p><a href='http://groups.google.com/groups?selm=a06010206bc63b462c8e4@[10.0.1.2]'>http://groups.google.com</a></p>

<h4><a name="Today_we_have_naming_of_parts">Today we have naming of parts</a></h4>

<p>Will the madness never stop?</p>

<p>Mitchell Charity spoke for everyone when he posted an extract from PDD15:</p>

<pre><code>    What .NET calls an attribute parrot calls a property
    What .NET calls a property parrot calls an attribute</code></pre>

<p>Everyone shared the pain, though Paolo Molaro pointed out that it&#39;s not exactly accurate and the .NET name for a parrot attribute is &#39;field&#39; (which is yet another term with wide variety of meanings when you think about it). Not being the biggest OO fan in the world, Dan swears he&#39;s just going to rename them Fred and Barney but not tell anyone which is which.</p>

<p><a href='http://groups.google.com/groups?selm=200402262229.i1QMTrk13310@vendian.org'>http://groups.google.com</a></p>

<h4><a name="LANGUAGES.STATUS_updates">LANGUAGES.STATUS updates</a></h4>

<p>Mitchell also pointed out that <em lang='und' xml:lang='und'>LANGUAGES.STATUS</em> was out of date and several languages which were supposed to be okay failed to work on his system. He asked for feedback to get it updated correctly.</p>

<p><a href='http://groups.google.com/groups?selm=200402280612.i1S6CSF32360@vendian.org'>http://groups.google.com</a></p>

<h4><a name="Inconsistent_Parrot/IMCC_behaviour">Inconsistent Parrot/IMCC behaviour</a></h4>

<p>Gregor Purdy found that Parrot was doing different things with the .pasm file generated from an .imc file by IMCC than it was when it ran the .imc file directly. Melvin Smith and Leo both agreed that it was a bug, but it&#39;s very hard to fix with the current incarnation of IMCC. IMCC2 should (will) fix the issue. Leo provided a workaround to fix the generated .pasm though.</p>

<p><a href='http://groups.google.com/groups?selm=1077956570.15543.4.camel@borg.focusresearch.com'>http://groups.google.com</a></p>

<h4><a name="The_Kakapo_leaps">The Kakapo leaps</a></h4>

<p>Yay! Parrot 0.1.0 &#34;Leaping Kakapo&#34; got released at 2004022913:45:49 GMT. This is a big release, with Objects and multi&#45;threading as well as a major documentation overhaul and a bunch of other good stuff. Anyone who suggests that I&#39;m only really excited by this particular release because I came up with the code name.</p>

<p>Pointing out that the Kakapo is a flightless, nearly extinct species of parrot is considered unsporting.</p>

<p><a href='http://groups.google.com/groups?selm=4041FB1D.4030304@toetsch.at'>http://groups.google.com</a></p>

<h3><a name="Meanwhile,_in_perl6&#45;language">Meanwhile, in perl6&#45;language</a></h3>

<h4><a name="Perl_6?_When?">Perl 6? When?</a></h4>

<p>Aaron Sherman noted that Apocalypse 1 was published in 2001, and it made mention of Apocalypse 26. And we&#39;ve seen all of six apocalypses. He wondered if there was anything that could be done to increase the apocalypse rate. As chromatic pointed out, no plan survives first contact with the enemy; it turns out that a lot of the theoretical apocalypses (one apocalypse per chapter of Programming Perl), aren&#39;t actually necessary for specifying the language to the point where we can start implementing.</p>

<p>Larry also answered Aaron&#39;s concerns and noted that last year he had to take half a year off &#39;to participate in various non&#45;optional gastric revisions&#39;. He quickly discussed the outstanding chapters and RFCs and pointed out that a large amount of the work had already been done. Which is nice.</p>

<p>Larry also showed us his outline of Apocalypse 12 which is apparently about a week away from the first alpha for the sixcabal. It looks rather promising (and it&#39;s rather easy to see why it&#39;s taken so long).</p>

<p><a href='http://groups.google.com/groups?selm=1077816664.1292.130.camel@pps'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=20040226192647.GA11151@wall.org'>http://groups.google.com</a> 
    &#45;&#45; Larry&#39;s big plan</p>

<p><a href='http://groups.google.com/groups?selm=20040226194426.GB11151@wall.org'>http://groups.google.com</a> 
    &#45;&#45; Apocalypse 12 outline</p>

<h4><a name="Thinking_about_accessors">Thinking about accessors</a></h4>

<p>John Williams wondered about how accessors will work with Perl 6 objects. In particular he wondered about cases like:</p>

<pre><code>    $foo.bar_attr += $z;
    $foo.bar_attr++;</code></pre>

<p>Things got a little complicated, indeed Larry muttered that there would be a delay to A12 because John had asked him to explain something that he hadn&#39;t figured out yet.</p>

<p><a href='http://groups.google.com/groups?selm=Pine.LNX.4.33.0402271931010.24668&#45;100000@sharkey.morinda.com'>http://groups.google.com</a></p>

<h4><a name="An_interesting_matching_problem">An interesting matching problem</a></h4>

<p>Austin Hastings came up with a neat little problem for matching. Consider an instrumented string class which carries information like &#39;bold&#39; and &#39;italic&#39; or even the language of a substring. How would you write a search to match all the letters &#39;l&#39; in french text. (Not a very realistic problem I know, but you&#39;ll have to bear with me).</p>

<p>Larry responded with a neat idea involving <code lang='und' xml:lang='und'>&#38;</code>, so you would write:</p>

<pre><code>   /[l &#38; &#60;french&#62;]/ </code></pre>

<p>where french is presumably a block rule that makes a method call on the appropriate character.</p>

<p><a href='http://groups.google.com/groups?selm=OIEJIIJJCGOEMIJDBHAOAEIJCAAA.Austin_Hastings@Yahoo.com'>http://groups.google.com</a></p>

<h4><a name="Exegesis_7">Exegesis 7</a></h4>

<p>Damian&#39;s Exegesis 7, dealing with the replacement for Perl 5&#39;s format, was published on Thursday. It&#39;s jolly good. Really. And you can use it now if you grab Perl6::Form from CPAN. This threw up a pile of questions about ambiguities, edge cases and all the other stuff that p6l does so well. The version of the exegesis at perl.com has already been updated to take some of these issues into account.</p>

<p><a href='http://www.perl.com/pub/a/2004/02/27/exegesis7.html'>http://www.perl.com/pub/a/2004/02/27/exegesis7.html</a></p>

<h3><a name="Announcements,_Apologies,_Acknowledgements">Announcements, Apologies, Acknowledgements</a></h3>

<p>Whee! The Summary goes to the mailing lists before midnight on Monday. &#34;Will I be able to 
keep up this dizzy pace?&#34; I ask myself.</p>

<p>If you find these summaries useful or enjoyable, please consider contributing to the Perl 
Foundation to help support the development of Perl. You might also like to send me feedback 
at <csperl arg_email="p6summarizer@bofh.org.uk" arg_after=","> or drop by my website.</p>

<p><a href='http://donate.perl&#45;foundation.org/'>http://donate.perl&#45;foundation.org/</a> &#45;&#45; The Perl Foundation</p>

<p>x<a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> &#45;&#45; Perl 6 Development site</p>

<p><a href='http://www.bofh.org.uk/'>http://www.bofh.org.uk/</a> &#45;&#45; My website, &#34;Just a Summary&#34;</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-878" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/02/27/exegesis7.html" rel="bookmark">Exegesis 7</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Damian Conway</span> on <abbr class="published" title="2004-02-27T00:00:00-08:00">February 27, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S07.html">Synopsis 7</a> for the current design information.</p>

<p><em>What a piece of work is Perl 6!<br/>
How noble in reason!<br/>
How infinite in faculty!<br/>
In <code>form</code> how express and admirable!</em></p>
<blockquote>
<strong><a name="item__w%2e_shakespeare%2c_%22hamlet%22_%28perl_6_revisi">&ndash; W. Shakespeare, &quot;Hamlet&quot; (Perl 6 revision)</a></strong><br />

</blockquote>
<p>Formats are Perl 5's mechanism for creating text templates with
fixed-width fields. Those fields are then filled in using values from
prespecified package variables. They're a useful tool for
generating many types of plaintext reports &ndash; the <em>r</em> in <em>Perl</em>,
if you will.</p>
<p>Unlike Perl 5, Perl 6 doesn't have a <code>format</code> keyword. Or the
associated built-in formatting mechanism. Instead it has a Form.pm
module. And a <code>form</code> function.</p>
<p>Like a Perl 5 <code>format</code> statement, the <code>form</code> function takes a series
of format (or &quot;picture&quot;) strings, each of which is immediately
followed by a suitable set of replacement values. It interpolates
those values into the placeholders specified within each picture string,
and returns the result.</p>
<p>The general idea is the same as for Perl's two other built-in string
formatting functions: <code>sprintf</code> and <code>pack</code>. The first argument
represents a template with <em>N</em> placeholders to be filled in, and the
next <em>N</em> arguments are the data that is to be formatted and
interpolated into those placeholders:</p>
<pre><code>
    $text = sprintf $format_s, $datum1, $datum2, $datum3;
    $text =    pack $format_p, $datum1, $datum2, $datum3;
    $text =    form $format_f, $datum1, $datum2, $datum3;</code></pre>
<p>Of course, these three functions use quite different mini-languages to specify
the templates they fill in, and all three fill in those templates in quite
distinct ways.</p>
<p>Apart from those differences in semantics, <code>form</code> has a syntactic
difference too. With <code>form</code>, after the first <em>N</em> data arguments we're
allowed to put a second format string and its corresponding data, then a
third format and data, and so on:</p>
<pre><code>
    $text = form $format_f1, $datum1, $datum2, $format_f2, $datum4, $format_f3, $datum5;</code></pre>
<p>And if we prettify that function call a little, it becomes obvious that it has
the same basic structure as a Perl 5 <code>format</code>:</p>
<pre><code>
    form
         $format_f1,
             $datum1, $datum2, $datum3,
         $format_f2,
             $datum4,
         $format_f3,
             $datum5;</code></pre>
<p>But the Perl 6 version is implemented as a vanilla Perl 6 subroutine,
rather than hard-coded into the language with a special keyword and
declaration syntax. In this respect it's rather like Perl 5's
little-known <code>formline</code> function &ndash; only much, much better.</p>
<p>So, whereas in Perl 5 we might write:</p>
<pre><code>
    # Perl 5 code...</code></pre>
<pre><code>
    our ($name, $age, $ID, $comments);</code></pre>
<pre><code>
    format STDOUT
     =================================== 
    | NAME     |    AGE     | ID NUMBER |
    |----------+------------+-----------|
    | @&lt;&lt;&lt;&lt;&lt;&lt;&lt; | @||||||||| | @&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; |
      $name,     $age,        $ID,
    |===================================|
    | COMMENTS                          |
    |-----------------------------------|
    | ^&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; |~~
      $comments,
     ===================================
    .</code></pre>
<pre><code>
    write STDOUT;</code></pre>
<p>in Perl 6 we could write:</p>
<pre><code>
    print form
        &quot; =================================== &quot;,
        &quot;| NAME     |    AGE     | ID NUMBER |&quot;,
        &quot;|----------+------------+-----------|&quot;,
        &quot;| {&lt;&lt;&lt;&lt;&lt;&lt;} | {||||||||} | {&gt;&gt;&gt;&gt;&gt;&gt;&gt;} |&quot;,
           $name,     $age,        $ID,
        &quot;|===================================|&quot;,
        &quot;| COMMENTS                          |&quot;,
        &quot;|-----------------------------------|&quot;,
        &quot;| {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[} |&quot;,
           $comments,
        &quot; =================================== &quot;;</code></pre>
<p>And both of them would print something like:</p>
<pre><code>
     ===================================
    | NAME     |    AGE     | ID NUMBER |
    |----------+------------+-----------|
    | Richard  |     33     |    000003 |
    |===================================|
    | COMMENTS                          |
    |-----------------------------------|
    | Talks to self. Seems to be        |
    | overcompensating for inferiority  |
    | complex rooted in post-natal      |
    | materal rejection due to physical |
    | handicap (congenital or perhaps   |
    | the result of premature birth).   |
    | Shows numerous indications of     |
    | psychotic (esp. nepocidal)        |
    | tendencies. Naturally, subject    |
    | gravitated to career in politics. |
     ===================================</code></pre>
<p>At first glance the Perl 6 version may seem like something of a
backwards step &ndash; all those extra quotation marks and commas that
the Perl 5 format didn't require. But the new formatting interface
does have several distinct advantages:</p>
<ul>
<li>
it uses the standard Perl 6 subroutine call syntax, so we can use the
full power of Perl data structures and control flow when setting up 
formats;
</li>
<li>
it delimits every field specification by braces, which allows for a much
wider range of field types;
</li>
<li>
it removes the special meanings of <code>'@'</code>, <code>'^'</code>, <code>'~'</code>, and <code>'.'</code> in
formats, leaving only <code>'{'</code> as special;
</li>
<li>
it provides <a href="/pub/a/2004/02/27/exegesis7.html?page=13#define,_define,_welleducated_infant.">an extension mechanism</a>
for creating new field types;
</li>
<li>
it greatly simplifies the common task of formatting data into a string
(rather than requiring the format data to be written to an output stream);
</li>
<li>
it doesn't destroy the contents of data variables when
formatting them across multiple lines;
</li>
<li>
it's easy to create new formats on-the-fly, rather than being
forced to statically declare them at compile-time (or in a run-time
string <code>eval</code>);
</li>
<li>
it allows calls to <code>form</code> to be nested;
</li>
<li>
it supports dynamically computed page headers and footers, which
may themselves make use of nested calls to <code>form</code>;
</li>
<li>
it doesn't rely on package variables, typeglobs, or a global accumulator;
</li>
<li>
it doesn't require a (frequently cryptic)  call to the
mysterious <code>write</code> function &ndash; and hence frees up <code>write</code> to be
used as the true opposite of <code>read</code>, should Larry so desire.
</li></ul>
<p>Of course, this is Perl, not Puritanism. So those folks who happen to
<em>like</em> package variables, global accumulators, and mysterious writes,
can still have them. And, if they're particularly nostalgic, they can
also get rid of all the quotation marks and commas, and even retain the
dot as a format terminator. For example:</p>
<pre><code>
    sub myster_rite {                           
        our ($name, $age, $ID, $comments);     
        print form :interleave, &lt;&lt;'.'               
             =================================== 
            | NAME     |    AGE     | ID NUMBER |
            |----------+------------+-----------|
            | {&lt;&lt;&lt;&lt;&lt;&lt;} | {||||||||} | {&gt;&gt;&gt;&gt;&gt;&gt;&gt;} |
            |===================================|
            | COMMENTS                          |
            |-----------------------------------|
            | {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[} |
             =================================== 
            .
              $name,     $age,        $ID,
              $comments;
    }</code></pre>
<pre><code>
    # and elsewhere in the same package...</code></pre>
<pre><code>
    ($name, $age, $ID, $comments) = get_data();
    myster_rite();</code></pre>
<pre><code>
    ($name, $age, $ID, $comments) = get_more_data();
    myster_rite();</code></pre>
<p>Let's take a look...</p>

<hr />
<h3><a name="what's_in_a_name">What's in a name?</a></h3>
<p>But before we do, here's a quick run-down of some of the highly arcane
technical jargon we'll be using as we talk about formatting:</p>
<dl>
<dt><strong><a name="item_format">Format</a></strong><br />
</dt>
<dd>
A string that is used as a template for the creation of <em>text</em>. It will
contain zero or more <em>fields</em>, usually with some literal characters and
whitespace between them.
</dd>

<dt><strong><a name="item_text">Text</a></strong><br />
</dt>
<dd>
A string that is created by replacing the fields of a format with specific
<em>data</em> values.  For example, the string that a call to <code>form</code> returns.
</dd>

<dt><strong><a name="item_field">Field</a></strong><br />
</dt>
<dd>
A fixed-width slot within a format string, into which <em>data</em> will be formatted.
</dd>

<dt><strong><a name="item_data">Data</a></strong><br />
</dt>
<dd>
A string or numeric value (or an array of such values) that is
interpolated into a format, in order to fill in a particular field.
</dd>

<dt><strong><a name="item_single%2dline_field">Single-line field</a></strong><br />
</dt>
<dd>
A field that interpolates only as much of its corresponding data value as
will fit inside it within a single line of text.
</dd>

<dt><strong><a name="item_block_field">Block field</a></strong><br />
</dt>
<dd>
A field that interpolates all of its corresponding data value, over a
series of text lines &ndash; as many as necessary &ndash; producing a
<em>text block</em>.
</dd>

<dt><strong><a name="item_text_block">Text block</a></strong><br />
</dt>
<dd>
The column of newline-separated text lines. A text block is produced
when data is formatted into a block field that is too small to contain
the data in a single line
</dd>

<dt><strong><a name="item_column">Column</a></strong><br />
</dt>
<dd>
The amount of space on an output device required to display one single-width
character. One character will occupy one column in most cases, the most
obvious exceptions being CJK double-width characters.
</dd>
</dl>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S07.html">Synopsis 7</a> for the current design information.</p>

<h3><a name="why,_how_now,_ho!_from_whence_ariseth_this">Why, how now, ho! From whence ariseth this?</a></h3>
<p>Unlike <code>sprintf</code> and <code>pack</code>, the <code>form</code> subroutine isn't built into Perl 6.
It's just a regular subroutine, defined in the Form.pm module:</p>
<pre><code>
    module Form
    {
        type FormArgs ::= Str|Array|Pair;</code></pre>
<pre><code>
        sub form (FormArgs *@args is context(Scalar)) returns Str
            is exported
        {
            ...
        }</code></pre>
<pre><code>
        ...
    }</code></pre>
<p>That means that if we want to use <code>form</code> we need to be sure we:</p>
<pre><code>
    use Form;</code></pre>
<p>first.</p>
<p>Note that the above definition of <code>form</code> specifies that the subroutine takes
a list of arguments (<code>*@args</code>), each of which must be a string, array
or pair (<code>type FormArgs ::= Str|Num|Array|Pair</code>). And the
<code>is <code>context</code></code> trait specifies that each of those arguments will be
evaluated in a scalar context.</p>
<p>That last bit is important, because normally a &quot;slurpy&quot; array parameter like
<code>*@args</code> would impose a list context on the corresponding arguments. We don't
want that here, mainly because we're going to want to be able to <a href="/pub/a/2004/02/27/exegesis7.html?page=3#therefore,_put_you_in_your_best_array...">pass arrays to <code>form</code></a> without
having them flattened.</p>

<hr />
<h3><a name="how_called_you...">How called you...?</a></h3>
<p>Like all Perl subroutines, <code>form</code> can be called in a variety of contexts.</p>
<p>When called in a scalar or list context, <code>form</code> returns a string
containing the complete formatted text:</p>
<pre><code>
    my $formatted_text = form $format, *@data;</code></pre>
<pre><code>
    @texts = ( form($format, *@data1), form($format, *@data2) );  # 2 elems</code></pre>
<p>When called in a void context, <code>form</code> waxes lyrical about human
frailty, betrayal of trust, and the pointlessness of calling out
when nobody's there to heed the reply, before dying in a highly
theatrical manner.</p>

<hr />
<h3><a name="he_doth_fill_fields...">He doth fill fields...</a></h3>
<p>The format strings passed to <code>form</code> determine what the resulting
formatted text looks like. Each format consists of a series
of field specifiers, which are usually separated by literal characters.</p>
<p><code>form</code> understands a far larger number of field specifiers than <code>format</code> did,
but they're easy to remember because they obey a small number of conventions:</p>
<ul>
<li>
Each field is enclosed in a pair of braces.
</li>
<li>
Within the braces, left or right angle brackets (<code>&lt;</code> or <code>&gt;</code>), bars
(<code>|</code>), and single-quotes (<code>'</code>) indicate various types of single-line fields.
</li>
<li>
Left or right square brackets (<code>[</code> or <code>]</code>), I's (<code>I</code>), and double-
quotes (<code>&quot;</code>) indicate block fields of various types.
</li>
<li>
The direction of the brackets within a field indicates the direction
towards which text will be justified in that field. For example:
<pre><code>
    {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}   Justify the text to the left
    {&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;}                  Justify the text to the right
    {&gt;&gt;&gt;&gt;&gt;&gt;&lt;&lt;&lt;&lt;&lt;}                 Centre the text
    {&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;}   Fully  justify  the  text  to  both  margins</code></pre>
<p>This is even true for numeric fields, which look like:
<code>{&gt;&gt;&gt;&gt;&gt;.&lt;&lt;}</code>. The whole digits are right-justified before
the dot and the decimals are left-justified after it.</p>
</li>
<li>
An <code>=</code> at either end of a field (or both ends) indicates the data
interpolated into the field is to be vertically &quot;middled&quot; within the
resulting block. That is, the text is to be centred vertically on the
middle of all the lines produced by the complete format.
</li>
<li>
An <code>_</code> at the start and/or end of a field indicates the interpolated data 
is to be vertically &quot;bottomed&quot; within the resulting block. That is, the
text is to be pushed to the bottom of the lines produced by the format.</li>
</ul>

<hr />
<h3><a name="the_fields_are_fragrant...">The fields are fragrant...</a></h3>
<p>That may still seem like quite a lot to remember, but the rules have
been chosen so that the resulting fields are visually mnemonic. In other
words, they're supposed to look like what they do. The intention is that
we simply draw a (stylized) picture of how we want the finished text to
look, using fields that look something like the finished product
&ndash; left or right brackets brackets showing horizontal alignments,
a middlish <code>=</code> or bottomed-out <code>_</code> indicate middled or bottom vertical
alignment, etc., etc. Then <code>form</code> fits our data into the fields so it
looks right.</p>
<p>The typical field specifications used in a <code>form</code> format look like this:</p>
<pre><code>
                                      Field specifier
    Field type                 One-line             Block
    ==========                ==========          ==========</code></pre>
<pre><code>
    left justified            {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}          {[[[[[[[[}
    right justified           {&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;}          {]]]]]]]]}
    centred                   {&gt;&gt;&gt;&gt;&lt;&lt;&lt;&lt;}          {]]]][[[[}
    centred (alternative)     {||||||||}          {IIIIIIII}
    fully justified           {&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;}          {[[[[]]]]}
    verbatim                  {''''''''}          {&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;}</code></pre>
<pre><code>
    numeric                   {&gt;&gt;&gt;&gt;&gt;.&lt;&lt;}          {]]]]].[[}
    euronumeric               {&gt;&gt;&gt;&gt;&gt;,&lt;&lt;}          {]]]]],[[}
    comma'd                   {&gt;,&gt;&gt;&gt;,&gt;&gt;&gt;.&lt;&lt;}      {],]]],]]].[[}
    space'd                   {&gt; &gt;&gt;&gt; &gt;&gt;&gt;.&lt;&lt;}      {] ]]] ]]].[[}
    eurocomma'd               {&gt;.&gt;&gt;&gt;.&gt;&gt;&gt;,&lt;&lt;}      {].]]].]]],[[}
    Swiss Army comma'd        {&gt;'&gt;&gt;&gt;'&gt;&gt;&gt;,&lt;&lt;}      {]']]]']]],[[}
    subcontinental            {&gt;&gt;,&gt;&gt;,&gt;&gt;&gt;.&lt;&lt;}      {]],]],]]].[[}</code></pre>
<pre><code>
    signed numeric            {-&gt;&gt;&gt;.&lt;&lt;&lt;}          {-]]].[[[}
    post-signed numeric       {&gt;&gt;&gt;&gt;.&lt;&lt;-}          {]]]].[[-}
    paren-signed numeric      {(&gt;&gt;&gt;.&lt;&lt;)}          {(]]].[[)}</code></pre>
<pre><code>
    prefix currency           {$&gt;&gt;&gt;.&lt;&lt;&lt;}          {$]]].[[[}
    postfix currency          {&gt;&gt;&gt;.&lt;&lt;&lt;DM}         {]]].[[[DM}
    infix currency            {&gt;&gt;&gt;$&lt;&lt; Esc}        {]]]$[[ Esc}</code></pre>
<pre><code>
    left/middled              {=&lt;&lt;&lt;&lt;&lt;&lt;=}          {=[[[[[[=}
    right/middled             {=&gt;&gt;&gt;&gt;&gt;&gt;=}          {=]]]]]]=}
    infix currency/middled    {=&gt;&gt;$&lt;&lt; Esc}        {=]]$[[ Esc}
    eurocomma'd/middled       {&gt;.&gt;&gt;&gt;.&gt;&gt;&gt;,&lt;&lt;=}     {].]]].]]],[[=}
    etc.</code></pre>
<pre><code>
    left/bottomed             {_&lt;&lt;&lt;&lt;&lt;&lt;_}          {_[[[[[[_}
    right/bottomed            {_&gt;&gt;&gt;&gt;&gt;&gt;_}          {_]]]]]]_}
    etc.</code></pre>

<hr />
<h3><a name="what_a_block_art_thou...">What a block art thou...</a></h3>
<p>When data is interpolated into a line field, the field grabs as much of the
data as will fit on a single line, formats that data appropriately, and
interpolates it into the format.</p>
<p>That means that if we use a one-line field, it only shows as much of the data
as will fit on one line. For example:</p>
<pre><code>
    my $data1 = 'By the pricking of my thumbs, something wicked this way comes';
    my $data2 = 'A horse! A horse! My kingdom for a horse!';</code></pre>
<pre><code>
    print form
        &quot;...{&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}...{&gt;&gt;&gt;&gt;&gt;&gt;&gt;}...&quot;,
            $data1,               $data2;</code></pre>
<p>prints:</p>
<pre><code>
    ...By the pricking of ... A horse!...</code></pre>
<p>On the other hand, if our format string used block fields instead, the
fields would extract one line of data at a time, repeating that process as
many times as necessary to display all the available data. So:</p>
<pre><code>
    print form
        &quot;...{[[[[[[[[[[[[[[[[[}...{]]]]]]]}...&quot;,
            $data1,               $data2;</code></pre>
<p>would produce:</p>
<pre><code>
    ...By the pricking of ... A horse!...
    ...my thumbs,         ... A horse!...
    ...something wicked   ...       My...
    ...this way comes     ...  kingdom...
    ...                   ...    for a...
    ...                   ...   horse!...</code></pre>
<p>We can mix line fields and block fields in the same format and <code>form</code> will
extract and interpolate only as much data as each field requires. For example:</p>
<pre><code>
    print form
        &quot;...{&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}...{]]]]]]]}...&quot;,
            $data1,               $data2;</code></pre>
<p>which produces:</p>
<pre><code>
    ...By the pricking of ... A horse!...
    ...                   ... A horse!...
    ...                   ...       My...
    ...                   ...  kingdom...
    ...                   ...    for a...
    ...                   ...   horse!...</code></pre>
<p>Notice that, after the first line, the single-line
<code>{&lt;&lt;&lt;&lt;&lt;&lt;}</code> field is simply replaced by
the appropriate number of space
characters, to keep the columns correctly aligned.</p>
<p>The usual reason for mixing line and block fields in this way is to
allow numbered or bulleted points:</p>
<pre><code>
    print &quot;I couldn't do my English Lit homework because...\n\n&quot;;</code></pre>
<pre><code>
    for @reasons.kv -&gt; $index, $reason {
        my $n = @reasons - $index ~ '.';
        print form &quot;   {&gt;}  {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}&quot;,
                       $n,  $reason,
                   &quot;&quot;;
    }</code></pre>
<p>which might produce:</p>
<pre><code>
    I couldn't do my English Lit homework because...</code></pre>
<pre><code>
         10. Three witches told me I was going to be    
             king.</code></pre>
<pre><code>
          9. I was busy explaining wherefore am I Romeo.</code></pre>
<pre><code>
          8. I was busy scrubbing the blood off my      
             hands.</code></pre>
<pre><code>
          7. Some dear friends had to charge once more  
             unto the breach.</code></pre>
<pre><code>
          6. My so-called best friend tricked me into   
             killing my wife.</code></pre>
<pre><code>
          5. My so-called best friend tricked me into   
             killing Caesar.</code></pre>
<pre><code>
          4. My so-called best friend tricked me into   
             taming a shrew.</code></pre>
<pre><code>
          3. My uncle killed my father and married my   
             mother.</code></pre>
<pre><code>
          2. I fell in love with my manservant, who was
             actually the disguised twin sister of the
             man that my former love secretly married,
             having mistaken him for my manservant who
             was wooing her on my behalf whilst secretly
             in love with me.</code></pre>
<pre><code>
          1. I was abducted by fairies.</code></pre>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S07.html">Synopsis 7</a> for the current design information.</p>

<h3><a name="and_mark_what_way_i_make...">And mark what way I make...</a></h3>
<p>Obviously, as a call to <code>form</code> builds up each line of its output
&ndash; extracting data from one or more data arguments and
formatting it into the corresponding fields &ndash; it needs to keep
track of where it's up to in each datum. It does this by progressively
updating the <code>.pos</code> of each datum, in exactly the same way as a
pattern match does.</p>
<p>And as with a pattern match, by default that updated <code>.pos</code> is only
used internally and <strong>not</strong> preserved after the call to <code>form</code> is
finished. So passing a string to <code>form</code> doesn't interfere with any
other pattern matching or text formatting that we might 
subsequently do with that data.</p>
<p>However, sometimes we <em>do</em> want to know how much of our data a call to <code>form</code>
managed to extract and format. Or we may want to split a formatting task
into several stages, with separate calls to <code>form</code> for each stage.
So we need a way of telling <code>form</code> to preserve the <code>.pos</code> information
in our data.</p>
<p>But, if we want to apply a series of <code>form</code> calls to the same data we also
need to be able to tell <code>form</code> to <em>respect</em> the <code>.pos</code> information
of that data &ndash; to start extracting from the previously preserved
<code>.pos</code> position, rather than from the start of the string.</p>
<p>To achieve both those goals, we use a <em>follow-on field</em>. That is we use
an ordinary field but mark it as <code>.pos</code>-sensitive with a special
notation: Unicode ellipses or ASCII colons at either end. So instead of
<code>{&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;}</code>, we'd write
<code>{&hellip;&lt;&lt;&lt;&gt;&gt;&gt;&hellip;}</code>
or <code>{:&lt;&lt;&lt;&gt;&gt;&gt;:}</code>.</p>
<p>Note that each ellipsis is a single, one-column wide Unicode HORIZONTAL
ELLIPSIS character (<code>\c[2026]</code>), <em>not</em> three separate dots. The
connotation of the ellipses is <em>&quot;...then keep on formatting from where
you previously left off, remembering there's probably still more to
come...&quot;</em>. And the colons are the ASCII symbol most like a single
character ellipsis (try tilting your head and squinting).</p>
<p>Follow-on fields are most useful when we want to split a formatting task
into distinct stages &ndash; or iterations &ndash; but still allow the
contents of the follow-on field to flow uninterrupted from line to line.
For example:</p>
<pre><code>
    print &quot;The best Shakespearean roles are:\n\n&quot;;</code></pre>
<pre><code>
    for @roles -&gt; $role {
        print form &quot;   * {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}   *{&hellip;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&hellip;}*&quot;,
                         $role,                            $disclaimer;
    }</code></pre>
<p>which produces:</p>
<pre><code>
    The best Shakespearean roles are:</code></pre>
<pre><code>
       * Macbeth                          *WARNING:          *
       * King Lear                        *This list of roles*
       * Juliet                           *constitutes      a*
       * Othello                          *personal   opinion*
       * Hippolyta                        *only and is in  no*
       * Don John                         *way  endorsed   by*
       * Katerina                         *Shakespeare'R'Us. *
       * Richard                          *It   may   contain*
       * Malvolio                         *nuts.             *
       * Bottom                           *                  *</code></pre>
<p>The multiple calls to <code>form</code> manage to produce a coherent disclaimer
because the ellipses in the second field tell each call to start
extracting data from <code>$disclaimer</code> at the offset indicated by
<code>$disclaimer.pos</code>, and then to update <code>$disclaimer.pos</code> with
the final position at which the field extracted data. So the next time
<code>form</code> is called, the follow-on field starts extracting from
where it left off in the previous call.</p>
<p>Follow-on fields are similar to <code>^&lt;&lt;&lt;&lt;&lt;</code> fields in a Perl 5 format,
except they don't destroy the contents of a data source; they merely change that
data source's <code>.pos</code> marker.</p>

<hr />
<h3><a name="therefore,_put_you_in_your_best_array...">Therefore, put you in your best array...</a></h3>
<p>Data, especially numeric data, is often stored in arrays.
So <code>form</code> also accepts arrays as data arguments. It can
do so because its parameter list is defined as:</p>
<pre><code>
        sub form (Str|Array|Pair *@args is context(Scalar)) {...}</code></pre>
<p>which means that although its arguments may include one or more arrays,
each such array argument is nevertheless evaluated in a scalar
context. Which, in Perl 6, produces an array reference.</p>
<p>In other words, array arguments don't get flattened automatically, so
<code>form</code> doesn't losing track of where in
the argument list one array finishes and the next begins.</p>
<p>Once inside <code>form</code>, each array that was specified as the data source
for a field is internally converted to a single string by joining it
together with a newline between each element.</p>
<p>The upshot is that, instead of:</p>
<pre><code>
    print &quot;The best Shakespearean roles are:\n\n&quot;;</code></pre>
<pre><code>
    for @roles -&gt; $role {
        print form &quot;   * {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}   *{&hellip;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&hellip;}*&quot;,
                         $role,                            $disclaimer;
    }</code></pre>
<p>we could just write:</p>
<pre><code>
    print &quot;The best Shakespearean roles are:\n\n&quot;;</code></pre>
<pre><code>
    print form &quot;   * {[[[[[[[[[[[[[[[[[[[[[[[[[[[[}   *{[[[[[[[[]]]]]]]]}*&quot;,
                     @roles,                           $disclaimer;</code></pre>
<p>And the array of roles would be internally converted to a single string, with
one role per line. Note that we also changed the disclaimer field to a regular
block field, so that the entire disclaimer would be formatted. And there was
no longer any need for the disclaimer field to be a follow-on field, since the
block field would extract and format the entire disclaimer anyway.</p>
<p>Note, however, that this block-based approach wouldn't work so well if
one of the elements of <code>@roles</code> was too big to fit on a single line. In
that case we might end up with something like the following:</p>
<pre><code>
   The best Shakespearean roles are:</code></pre>
<pre><code>
      * Either of the 'two foolish             *WARNING:          *
      * officers': Dogberry and Verges         *This list of roles*
      * That dour Scot, the Laird              *constitutes      a*
      * Macbeth                                *personal   opinion*
      * The tragic Moor of Venice,             *only and is in  no*
      * Othello                                *way  endorsed   by*
      * Rosencrantz's good buddy               *Shakespeare'R'Us. *
      * Guildenstern                           *It   may   contain*
      * The hideous and malevolent             *nuts.             *
      * Richard III                            *                  *</code></pre>
<p>rather than:</p>
<pre><code>
   The best Shakespearean roles are:</code></pre>
<pre><code>
      * Either of the 'two foolish             *WARNING:          *
        officers': Dogberry and Verges         *This list of roles*
      * That dour Scot, the Laird              *constitutes      a*
        Macbeth                                *personal   opinion*
      * The tragic Moor of Venice,             *only and is in  no*
        Othello                                *way  endorsed   by*
      * Rosencrantz's good buddy               *Shakespeare'R'Us. *
        Guildenstern                           *It   may   contain*
      * The hideous and malevolent             *nuts.             *
        Richard III                            *                  *</code></pre>
<p>That's because the <code>&quot;*&quot;</code> that's being used as a bullet for the first
column is a literal (i.e. mere decoration),
and so it will be repeated on <em>every</em> line that
is formatted, regardless of whether that line is the start of a new
element of <code>@roles</code> or merely the broken-and-wrapped remains of the
previous element. Happily, as we shall see later, this particular
problem has <a href="/pub/a/2004/02/27/exegesis7.html?page=13#these_paper_bullets_of_the_brain...">a simple solution</a>.</p>
<p>Despite these minor complications, array data sources are particularly
useful when formatting, especially if the data is known to fit within
the specified width. For example:</p>
<pre><code>
    print form
        '-------------------------------------------',   
        'Name             Score   Time  | Normalized',   
        '-------------------------------------------',   
        '{[[[[[[[[[[[[}   {III}   {II}  |  {]]].[[} ',
         @name,           @score, @time,   [@score &raquo;/&laquo; @time];</code></pre>
<p>is a very easy way to produce the table:</p>
<pre><code>
    -------------------------------------------
    Name             Score   Time  | Normalized
    -------------------------------------------
    Thomas Mowbray    88      15   |     5.867
    Richard Scroop    54      13   |     4.154
    Harry Percy       99      18   |     5.5</code></pre>
<p>Note the use of the Perl6-ish listwise division (<code>&raquo;/&laquo;</code>)
to produce the array of data for the &quot;Normalized&quot; column.</p>

<hr />
<h3><a name="more_particulars_must_justify_my_knowledge...">More particulars must justify my knowledge...</a></h3>
<p>The most commonly used fields are those that justify their contents: to
the left, to the right, to the left <em>and</em> right, or towards the centre.</p>
<p>Left-justified and right-justified fields extract from their data source
the largest substring that will fit inside them, push that string to the
left or right as appropriate, and then pad the string out to the
required field width with spaces (or the <a href="/pub/a/2004/02/27/exegesis7.html?page=10#he_doth_fill_fields_with_harness...">nominated fill character</a>).</p>
<p>Centred fields (<code>{&gt;&gt;&gt;&gt;&lt;&lt;&lt;&lt;}</code> and <code>{]]]][[[[}</code>) likewise
extract as much data as possible, and then pad both sides of it with
(near) equal numbers of spaces. If the amount of padding required is not
evenly divisible by 2, the one extra space is added <em>after</em> the data.</p>
<p>There is a second syntax for centred fields &ndash; a tip-o'-the-hat to
Perl 5 formats: <code>{|||||||||}</code> and <code>{IIIIIIII}</code>. This variant also
makes it easier to specify centering fields that are only three columns
wide: <code>{|}</code> and <code>{I}</code>.</p>
<p>Note, however, that the behaviour of centering fields specified this
way is exactly the same in every respect as the bracket-based versions, so
we're free to use whichever we prefer.</p>
<p>Fully justified fields (<code>{&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;}</code> and <code>{[[[[]]]]}</code>)
extract a maximal substring and then distribute any padding as evenly as
possible into the existing whitespace gaps in that data. For example:</p>
<pre><code>
    print form '({&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;})',
               &quot;A fellow of infinite jest, of most excellent fancy&quot;;</code></pre>
<p>would print:</p>
<pre><code>
    (A fellow  of  infinite)</code></pre>
<p>A fully-justified block field (<code>{[[[[]]]]}</code>) does the same across
multiple lines, except that the very last line is always left-justified.
Hence, this:</p>
<pre><code>
    print form '({[[[[[[[[]]]]]]]})',
               &quot;All the world's a stage, And all the men and women merely players.&quot;</code></pre>
<p>would print:</p>
<pre><code>
    (All the world's a)
    (stage,  And   all)
    (the men and women)
    (merely players.  )</code></pre>
<p>By the way, with both centred fields (<code>{&gt;&gt;&gt;&gt;&lt;&lt;&lt;}</code>) and fully
justified fields (<code>{&lt;&lt;&lt;&gt;&gt;&gt;&gt;}</code>), the actual number of
left vs right arrows is irrelevant, so long as there is at least
one of each.</p>

<hr />
<h3><a name="what,_is't_too_short">What, is't too short?</a></h3>
<p>One special case we need to consider is an empty set of field delimiters:</p>
<pre><code>
    form 'ID number: {}'</code></pre>
<p>This specification is treated as a two-column-wide, left-justified
block field (since that seems to be the type of two-column-wide
field most often required).</p>
<p>Other kinds of two-column (and single-column) fields can also
be created using <a href="/pub/a/2004/02/27/exegesis7.html?page=9#what_you_will_command_me_will_i_do...">imperative field widths</a> and
and <a href="/pub/a/2004/02/27/exegesis7.html?page=13#define,_define,_welleducated_infant.">user-defined fields</a>.</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S07.html">Synopsis 7</a> for the current design information.</p>

<h3><a name="command_our_present_numbers_be_muster'd...">Command our present numbers be muster'd...</a></h3>
<p>A field specifier of the form <code>{&gt;&gt;&gt;&gt;.&lt;&lt;}</code> or <code>{]]]].[[}</code>
represents a decimal-aligned numeric field. The decimal marker always
appears in exactly the position indicated and the rest of the number is
aligned around it. The decimal places are rounded to the specific number
of places indicated, but only &quot;significant&quot; digits are shown. For example:</p>
<pre><code>
    @nums = (1, 1.2, 1.23, 11.234, 111.235, 1.0001);</code></pre>
<pre><code>
    print form &quot;Thy score be: {]]]].[[}&quot;,
                              @nums;</code></pre>
<p>prints:</p>
<pre><code>
    Thy score be:     1.0
    Thy score be:     1.2
    Thy score be:     1.23
    Thy score be:    11.234
    Thy score be:   111.235
    Thy score be:     1.000</code></pre>
<p>The points are all aligned, the minimal number of decimal places are
shown, and the decimals are rounded (using the same rounding protocol that
<code>printf</code> employs). Note in particular that, even though both <code>1</code> and
<code>1.0001</code> would normally convert to the same 3-decimal-place value
(<code>1.000</code>), a <code>form</code> call only shows all three zeros in the second case
since only in the second case are they &quot;significant&quot;.</p>
<p>In other words, unless we <a href="/pub/a/2004/02/27/exegesis7.html?page=10#but_say_thou_nought...">tell it otherwise</a>,
<code>form</code> tries to avoid displaying a
number with more accuracy than it actually possesses (within the 
constraint that it must always show at least one decimal place).</p>

<h4><a name="here_are_only_numbers_ratified.">Here are only numbers ratified.</a></h4>
<p>You're probably wondering what happens if we try to format a number that's too
large for the available places (as <code>123456.78</code> would be in the above format).
Whereas <code>sprintf</code> would extend a numeric field to accommodate the number,
<code>form</code> insists on preserving the specified layout; in particular, the
position of the decimal point. But it obviously can't just cut off the
extra high-order digits; that would change the value:</p>
<pre><code>
    Thy score be: 23456.78</code></pre>
<p>So, instead, it indicates that the number doesn't fit by filling the
field with octothorpes (the way many spreadsheets do):</p>
<pre><code>
    Thy score be: #####.###</code></pre>
<p>Note, however, that it <em>is</em> possible to 
<a href="/pub/a/2004/02/27/exegesis7.html?page=9#that_we_our_largest_bounty_may_extend...">change this behaviour</a>
should we need to.</p>
<p>It's also possible that someone (not you, of course!) might attempt to
pass a numeric field some data that isn't numeric at all:</p>
<pre><code>
    my @mixed_data = (1, 2, &quot;three&quot;, {4=&gt;5}, &quot;6&quot;, &quot;7-Up&quot;);</code></pre>
<pre><code>
    print form 'Thy score be: {]]]].[[}', 
                              @mixed_data;</code></pre>
<p>Unlike Perl itself, <code>form</code> doesn't autoconvert non-numeric values.
Instead it marks them with another special string, by filling the field with
question-marks:</p>
<pre><code>
    Thy score be:     1.0  
    Thy score be:     2.0  
    Thy score be: ?????.???
    Thy score be: ?????.???
    Thy score be:     6.0  
    Thy score be: ?????.???</code></pre>
<p>Note that strings per se aren't a problem &ndash; <code>form</code> will happily
convert strings that contain valid numbers, such as <code>&quot;6&quot;</code> in the above
example. But it does reject strings that contain anything else besides
a number (even when Perl itself would successfully convert the number
&ndash; as it would for <code>&quot;7-Up&quot;</code> above).</p>
<p>Those who'd prefer Perl's usual, more laissez-faire attitude to
numerical conversion can just pre-numerify the values
themselves using the unary numerification operator (shown here in its
list form &ndash; <code>+&laquo;</code> &ndash; since we have an array of
values to be numerified):</p>
<pre><code>
    print form 'Thy score be: {]]]].[[}',
                              +&laquo; @mixed_data;</code></pre>
<p>This version would print:</p>
<pre><code>
    Thy score be:     1.0  
    Thy score be:     2.0  
    Thy score be:     0.0  
    Thy score be:     1.0  
    Thy score be:     6.0  
    Thy score be:     7.0</code></pre>
<p>(The <code>1.0</code> on the fourth line appears because Perl 6 hashes numerify to the
number of entries they contain).</p>

<h4><a name="see_how_the_giddy_multitude_do_point...">See how the giddy multitude do point...</a></h4>
<p>Of course, not everyone uses a dot for their decimal point. The other main
contender is the comma, and naturally <code>form</code> supports that as well. If
we specify a numeric field with a comma between the brackets:</p>
<pre><code>
    @les_nums = (1, 1.2, 1.23, 11.234, 111.235, 1.0001);</code></pre>
<pre><code>
    print form 'Votre score est: {]]]],[[}',
                                 @les_nums;</code></pre>
<p>the call prints:</p>
<pre><code>
    Votre score est:     1,0
    Votre score est:     1,2
    Votre score est:     1,23
    Votre score est:    11,234
    Votre score est:   111,235
    Votre score est:     1,000</code></pre>
<p>In fact, <code>form</code> is extremely flexible about the characters
we're allowed to use as
a decimal marker: anything except an angle- or square bracket or
<a href="/pub/a/2004/02/27/exegesis7.html?page=9#that_we_our_largest_bounty_may_extend...">a plus sign</a> is acceptable.</p>
<p>As a bonus, <code>form</code> allows us to use the specified decimal marker in
the <em>data</em> as well as in the format. So this works too:</p>
<pre><code>
    @les_nums = (&quot;1&quot;, &quot;1,2&quot;, &quot;1,23&quot;, &quot;11,234&quot;, &quot;111,235&quot;, &quot;1,0001&quot;);</code></pre>
<pre><code>
    print form 'Vos score est: {]]]],[[}',
                               @les_nums;</code></pre>

<h4><a name="or_else_be_impudently_negative...">Or else be impudently negative...</a></h4>
<p>Negative numbers work as expected, with the minus sign taking
up one column of the field's allotted span:</p>
<pre><code>
    @nums = ( 1, -1.2,  1.23, -11.234,  111.235, -12345.67);</code></pre>
<pre><code>
    print form 'Thy score be: {]]]].[[}',
                              @nums;</code></pre>
<p>This would print:</p>
<pre><code>
    Thy score be:     1.0  
    Thy score be:    -1.2  
    Thy score be:     1.23 
    Thy score be:   -11.234
    Thy score be:   111.235
    Thy score be: #####.###</code></pre>
<p>However, <code>form</code> can also format numbers so that the minus sign <em>trails</em> the
number. To do that we simple put an explicit minus sign inside the field
specification, at the end:</p>
<pre><code>
    print form 'Thy score be: {]]]].[[-}',
                              @nums;</code></pre>
<p>which would then print:</p>
<pre><code>
    Thy score be:     1.0   
    Thy score be:     1.2-  
    Thy score be:     1.23  
    Thy score be:    11.234-
    Thy score be:   111.235 
    Thy score be: 12345.67-</code></pre>
<p><code>form</code> also understands the common financial usage where negative
numbers are represented as positive numbers in parentheses. Once again,
we draw an abstract picture of what we want (by putting parens at either
end of the field specification):</p>
<pre><code>
    print form 'Thy dividend be: {(]]]].[[)}',
                                 @nums;</code></pre>
<p>and <code>form</code> obliges:</p>
<pre><code>
    Thy dividend be:      1.0   
    Thy dividend be:     (1.2)  
    Thy dividend be:      1.23  
    Thy dividend be:    (11.234)
    Thy dividend be:    111.235 
    Thy dividend be: (12345.67)</code></pre>
<p>Note that the parens have to go <em>inside</em> the field's braces. Otherwise,
they're just literal parts of the format string:</p>
<pre><code>
    print form 'Thy dividend be: ({]]]].[[})',
                                  @nums;</code></pre>
<p>and we'd get:</p>
<pre><code>
    Thy dividend be: (    1.0  ) 
    Thy dividend be: (   -1.2  )  
    Thy dividend be: (    1.23 )
    Thy dividend be: (  -11.234)
    Thy dividend be: (  111.235)
    Thy dividend be: (#####.###)</code></pre>

<h4><a name="and_stand_a_comma_'tween_their_amities...">And stand a comma 'tween their amities...</a></h4>
<p>If we add so-called &quot;thousands separators&quot; inside a numeric field at the
usual places, <code>form</code> includes them appropriately in its output. It can
handle the five major formatting conventions:</p>
<pre><code>
    my @nums = (0, 1, 1.1, 1.23, 4567.89, 34567.89, 234567.89, 1234567.89);</code></pre>
<pre><code>
    print form
        &quot;Brittannic      Continental     Subcontinental   Tyrolean        Asiatic&quot;,
        &quot;_____________   _____________   ______________   _____________   _____________&quot;,
        &quot;{],]]],]]].[}   {].]]].]]],[}    {]],]],]]].[}   {]']]]']]],[}   {]]]],]]]].[}&quot;,
         @nums,          @nums,          @nums,           @nums,          @nums;</code></pre>
<p>to produce:</p>
<pre><code>
    Brittannic      Continental     Subcontinental   Tyrolean        Asiatic
    _____________   _____________   ______________   _____________   _____________
             0.0             0,0              0.0             0,0             0.0 
             1.0             1,0              1.0             1,0             1.0 
             1.1             1,1              1.1             1,1             1.1 
             1.23            1,23             1.23            1,23            1.23
         4,567.89        4.567,89         4,567.89        4'567,89         4567.89
        34,567.89       34.567,89        34,567.89       34'567,89       3,4567.89
       234,567.89      234.567,89      2,34,567.89      234'567,89      23,4567.89
     1,234,567.89    1.234.567,89     12,34,567.89    1'234'567,89     123,4567.89</code></pre>
<p>It also accepts a space character as a &quot;thousands separator&quot; (with, of
course, any decimal marker we might like):</p>
<pre><code>
    print form
        &quot;Hyperspatial&quot;,
        &quot;_____________&quot;,
        &quot;{] ]]] ]]]:[}&quot;,
         @nums;</code></pre>
<p>to produce:</p>
<pre><code>
    Hyperspatial
    _____________
             0:0 
             1:0 
             1:1 
             1:23
         4 567:89
        34 567:89
       234 567:89
     1 234 567:89</code></pre>

<hr />
<h3><a name="and_gives_to_airy_nothing_a_local_habitation_and_a_name">And gives to airy nothing a local habitation and a name</a></h3>
<p>Of course, sometimes we don't know ahead of time just where in the world our
formatted numbers will be displayed. Locales were invented to address that
very problem, and <code>form</code> supports them.</p>
<p>If we use the <code>:locale</code> option, <code>form</code> detects the current locale and
converts any numerical formats it finds to the appropriate layout. For
example, if we wrote:</p>
<pre><code>
    @nums = ( 1, -1.2,  1.23, -11.234,  111.235, -12345.67);</code></pre>
<pre><code>
    print form 
            &quot;{],]]],]]].[[}&quot;,
            @nums;</code></pre>
<p>then we'd get:</p>
<pre><code>
          1.0
         -1.2
          1.23
        -11.234
        111.235
    -12,345.67</code></pre>
<p>wherever the program was run. But if we had written:</p>
<pre><code>
    print form
            :locale,
            &quot;{],]]],]]].[[}&quot;,
            @nums;</code></pre>
<p>then we'd get:</p>
<pre><code>
          1.0
         -1.2
          1.23
        -11.234
        111.235
    -12,345.67</code></pre>
<p>or:</p>
<pre><code>
          1,0
          1,2-
          1,23
         11,23-
        111,235
     12.345,67-
  
or:</code></pre>
<pre><code>
          1,0
         (1,2)
          1,23
        (11,23)
        111,235
    (12'345,67)</code></pre>
<p>or whatever else the current locale indicated was the correct local layout
for numbers.</p>
<p>That is, when the <code>:locale</code> option is specified, <code>form</code> ignores the actual
decimal point, thousands separator, and negation sign we specified in the call,
and instead uses the values for these markers that are returned by the
POSIX <code>localeconv</code> function. That means that we can specify our numerical
formatting in a style that seems natural to us, and at the same time
allow the numbers to be formatted in a style that seems natural to the user.</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S07.html">Synopsis 7</a> for the current design information.</p>

<h3><a name="thou_shalt_have_my_best_gown_to_make_thee_a_pair...">Thou shalt have my best gown to make thee a pair...</a></h3>
<p>Wait a minute...</p>
<p>Where exactly did we conjure that <code>:locale</code> syntax from?
And what, exactly, did it create? What <em>is</em> an &quot;option&quot;?</p>
<p>Well, we're passing <code>:locale</code> as an argument to <code>form</code>, and <code>form</code>'s
<a href="/pub/a/2004/02/27/exegesis7.html?page=2#why,_how_now,_ho!_from_whence_ariseth_this">signature</a> guarantees us
that it can only accept a <code>Str</code>, or an <code>Array</code>, or a <code>Pair</code> as an
argument. So an &quot;option&quot; must be one of those three types, and that
funky <code>:identifier</code> syntax must be a constructor for the equivalent data
structure.</p>
<p>And indeed, that's the case. An &quot;option&quot; is just a pair, and the 
funky <code>:identifier</code> syntax is just another way of writing a pair
constructor.</p>
<p>The standard &quot;option&quot; syntax is:</p>
<pre><code>
    :key( &quot;value&quot; )</code></pre>
<p>which is identical in effect to:</p>
<pre><code>
    key =&gt; &quot;value&quot;</code></pre>
<p>Both specify an autoquoted key; both associate that key with a value; both
evaluate to a pair object that contains the key and value.
So why have a second syntax for pairs?</p>
<p>Because it allows us to optimize the pair constructor syntax in two 
different ways. The now-familiar &quot;fat arrow&quot; pair constructor takes a
key and a value, each of which can be of any type. In contrast, the
key of an &quot;option&quot; pair constructor can only be an identifier, which 
is always autoquoted...at compile-time. So, if we use the &quot;option&quot; syntax
we're guaranteed that the key of the resulting pair is a string,
that the string that contains a valid identifier, and that the compiler
can check that validity before the program starts.</p>
<p>Moreover, whereas the &quot;fat arrow&quot; has only one syntax, &quot;options&quot; have several
highly useful syntactic variations. For example, &quot;fat arrow&quot; pairs can be
especially annoying when we want to use them to pass named boolean arguments
to a subroutine. For example:</p>
<pre><code>
    duel( $person1, $person2, to_death=&gt;1, no_quarter=&gt;1, left_handed=&gt;1, bonetti=&gt;1, capoferro=&gt;1 );</code></pre>
<p>In contrast, &quot;options&quot; have a special default behaviour. If we leave off their
parenthesized value entirely, the implied value is <code>1</code>. So we could rewrite
the preceding function call as:</p>
<pre><code>
    duel( $person1, $person2, :to_death, :no_quarter, :left_handed, :bonetti, :capoferro );</code></pre>
<p>Better still, when we have a series of options, we don't have to put commas
between them:</p>
<pre><code>
    duel( $person1, $person2, :to_death :no_quarter :left_handed :bonetti :capoferro );</code></pre>
<p>That makes them even more concise and uncluttered, especially in
<code>use</code> statements:</p>
<pre><code>
    use POSIX :errno_h :fcntl_h :time_h;</code></pre>
<p>There are other handy &quot;option&quot; variants as well, all of which simply substitute
the parentheses following their key for some other kind of bracket (and hence
some other kind of value). The full list of &quot;option&quot;...err...options is:</p>
<pre><code>
      Option syntax              Is equivalent to
    ==================     =============================</code></pre>
<pre><code>
    :key(&quot;some value&quot;)     key =&gt; &quot;some value&quot;</code></pre>
<pre><code>
    :key                   key =&gt; 1</code></pre>
<pre><code>
    :key{ a=&gt;1, b=&gt;2 }     key =&gt; { a=&gt;1, b=&gt;2 }</code></pre>
<pre><code>
    :key{ $^arg * 2; }     key =&gt; { $^arg * 2; }</code></pre>
<pre><code>
    :key[ 1, 2, 3, 4 ]     key =&gt; [ 1, 2, 3, 4 ]</code></pre>
<pre><code>
    :key&laquo;eat at Joe's&raquo;     key =&gt; [&quot;eat&quot;, &quot;at&quot;, &quot;Joe's&quot;]</code></pre>
<p>Despite the deliberate differences in conciseness and flexibility, we can use
&quot;options&quot; and &quot;fat arrows&quot; interchangeably in almost every situation
where we need to construct a pair (except, of course, where the key needs to be
something other than an identifier string, in which case the &quot;fat arrow&quot; is
the only alternative). To illustrate that interchangeability, we'll use
the &quot;option&quot; syntax throughout most of the rest of this discussion,
except where using a &quot;fat arrow&quot; is clearly preferable for code readability.</p>
<p>Meanwhile, back in the fields...</p>

<hr />
<h3><a name="some_tender_money_to_me...">Some tender money to me...</a></h3>
<p>Formatting numbers gets even trickier when those numbers represent money.
But <code>form</code> simply lets us specify how the local currency looks &ndash;
including leading, trailing, or infix currency markers; leading, trailing, or
circumfix negation markers; thousands separators; etc. &ndash; and then it
formats it that way. For example:</p>
<pre><code>
    my @amounts = (0, 1, 1.2345, 1234.56, -1234.56, 1234567.89);</code></pre>
<pre><code>
    my %format = (
        &quot;Canadian (English)&quot;    =&gt; q/   {-$],]]],]]].[}/,
        &quot;Canadian (French)&quot;     =&gt; q/    {-] ]]] ]]],[ $}/,
        &quot;Dutch&quot;                 =&gt; q/     {],]]],]]].[-EUR}/,
        &quot;German (pre-euro)&quot;     =&gt; q/    {-].]]].]]],[DM}/,
        &quot;Indian&quot;                =&gt; q/    {-]],]],]]].[ Rs}/,
        &quot;Norwegian&quot;             =&gt; q/ {kr -].]]].]]],[}/,
        &quot;Portuguese (pre-euro)&quot; =&gt; q/    {-].]]].]]]$[ Esc}/,
        &quot;Swiss&quot;                 =&gt; q/{Sfr -]']]]']]].[}/,
    );</code></pre>
<pre><code>
    for %format.kv -&gt; $nationality, $layout {
        print form &quot;$nationality:&quot;,
                   &quot;    $layout&quot;,
                        @amounts,
                   &quot;\n&quot;;
    }</code></pre>
<p>produces:</p>
<pre><code>
    Swiss:
                  Sfr 0.0 
                  Sfr 1.0 
                  Sfr 1.23
              Sfr 1'234.56
             Sfr -1'234.56
          Sfr 1'234'567.89</code></pre>
<pre><code>
    Canadian (French):
                      0,0 $ 
                      1,0 $ 
                      1,23 $
                  1 234,56 $
                 -1 234,56 $
              1 234 567,89 $</code></pre>
<pre><code>
    Dutch:
                      0.0EUR  
                      1.0EUR  
                      1.23EUR 
                  1,234.56EUR 
                  1,234.56-EUR
              1,234,567.89EUR</code></pre>
<pre><code>
    Norwegian:
                   kr 0,0 
                   kr 1,0 
                   kr 1,23
               kr 1.234,56
              kr -1.234,56
           kr 1.234.567,89</code></pre>
<pre><code>
    German (pre-euro):
                      0,0DM 
                      1,0DM 
                      1,23DM
                  1.234,56DM
                 -1.234,56DM
              1.234.567,89DM</code></pre>
<pre><code>
    Indian:
                      0.0 Rs 
                      1.0 Rs 
                      1.23 Rs
                  1,234.56 Rs
                 -1,234.56 Rs
              12,34,567.89 Rs</code></pre>
<pre><code>
    Portuguese (pre-euro):
                      0$0 Esc 
                      1$0 Esc 
                      1$23 Esc
                  1.234$56 Esc
                 -1.234$56 Esc
              1.234.567$89 Esc</code></pre>
<pre><code>
    Canadian (English):
                     $0.0 
                     $1.0 
                     $1.23
                 $1,234.56
                -$1,234.56
             $1,234,567.89</code></pre>
<p>Nice, eh?</p>

<hr />
<h3><a name="able_verbatim_to_rehearse...">Able verbatim to rehearse...</a></h3>
<p>But sometimes <em>too</em> nice. Sometimes all we want is an existing block
of data laid out into columns &ndash; without any fancy reformatting
or rejustification. For example, suppose we have an interesting string
like this:</p>
<pre><code>
    $diagram = &lt;&lt;EODNA;
       G==C
         A==T
           T=A
           A=T
         T==A
       G===C
      T==A
     C=G
    TA
    AT
     A=T
      T==A
        G===C
          T==A
    EODNA</code></pre>
<p>and we'd like to put beside some other text. Because it's already carefully
formatted, we really don't want to interpolate it into a left-justified field:</p>
<pre><code>
    print form
        '{[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]}       {[[[[[[[[[[[[[[[}',
         $diatribe,                                        $diagram;</code></pre>
<p>Because that would squash our lovely helix:</p>
<pre><code>
    Men at  some  time  are  masters  of  their       G==C             
    fates: / the fault, dear Brutus, is not  in       A==T             
    our genes, / but in ourselves, that we  are       T=A              
    underlings.  /  Brutus  and  Caesar:   what       A=T              
    should be in that 'Caesar'?  /  Why  should       T==A             
    that DNA be sequenced more  than  yours?  /       G===C            
    Extract them together, yours is as  fair  a       T==A             
    genome; / transcribe them, it  doth  become       C=G              
    mRNA as well; / recombine them,  it  is  as       TA               
    long; clone with 'em, / Brutus will start a       AT               
    twin as soon as Caesar. / Now, in the names       A=T              
    of all  the  gods  at  once,  /  upon  what       T==A             
    proteins doth our Caesar feed, / that he is       G===C            
    grown so great?                                   T==A</code></pre>
<p>Nor would right-, full-, centre- or numeric- justification help in this
instance. What we really need is &quot;leave-it-the-hell-alone&quot;
justification &ndash; a field specifier that lays out the data exactly as it
is, leading whitespace included.</p>
<p>And that's the purpose of a <em>verbatim field</em>. A verbatim single-line field
(<code>{'''''''''}</code>) grabs the next line of data it's offered and inserts as
much of it as will fit in the field's width, preserving whitespace &quot;as
is&quot;. Likewise a verbatim block field (<code>{&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;}</code>) grabs every line
of the data it's offered and interpolates it into the text without any
reformatting or justification.</p>
<p>And that's precisely what we needed for our diagram:</p>
<pre><code>
    print form
        '{[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]}       {&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;}',
         $diatribe,                                        $diagram;</code></pre>
<p>to produce:</p>
<pre><code>
    Men at  some  time  are  masters  of  their          G==C          
    fates: / the fault, dear Brutus, is not  in            A==T        
    our genes, / but in ourselves, that we  are              T=A       
    underlings.  /  Brutus  and  Caesar:   what              A=T       
    should be in that 'Caesar'?  /  Why  should            T==A        
    that DNA be sequenced more  than  yours?  /          G===C         
    Extract them together, yours is as  fair  a         T==A           
    genome; / transcribe them, it  doth  become        C=G             
    mRNA as well; / recombine them,  it  is  as       TA               
    long; clone with 'em, / Brutus will start a       AT               
    twin as soon as Caesar. / Now, in the names        A=T             
    of all  the  gods  at  once,  /  upon  what         T==A           
    proteins doth our Caesar feed, / that he is           G===C        
    grown so great?                                         T==A</code></pre>
<p>Note that, unlike other types of fields, verbatim fields don't
<a href="/pub/a/2004/02/27/exegesis7.html?page=7#a_man_may_break_a_word_with_you,_sir...">break and wrap their data</a>
if that data doesn't fit on a single line. Instead, they truncate each line to
the appropriate field width. So a too-short verbatim field:</p>
<pre><code>
    print form
        '{[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]}       {&quot;&quot;&quot;&quot;&quot;&quot;}',
         $diatribe,                                        $diagram;</code></pre>
<p>results in gene slicing:</p>
<pre><code>
    Men at  some  time  are  masters  of  their          G==C 
    fates: / the fault, dear Brutus, is not  in            A==
    our genes, / but in ourselves, that we  are              T
    underlings.  /  Brutus  and  Caesar:   what              A
    should be in that 'Caesar'?  /  Why  should            T==
    that DNA be sequenced more  than  yours?  /          G===C
    Extract them together, yours is as  fair  a         T==A  
    genome; / transcribe them, it  doth  become        C=G    
    mRNA as well; / recombine them,  it  is  as       TA      
    long; clone with 'em, / Brutus will start a       AT      
    twin as soon as Caesar. / Now, in the names        A=T    
    of all  the  gods  at  once,  /  upon  what         T==A  
    proteins doth our Caesar feed, / that he is           G===
    grown so great?                                         T=</code></pre>
<p>rather than teratogenesis:</p>
<pre><code>
    Men at  some  time  are  masters  of  their          G==C 
    fates: / the fault, dear Brutus, is not  in            A=-
    our genes, / but in ourselves, that we  are       =T      
    underlings.  /  Brutus  and  Caesar:   what              -
    should be in that 'Caesar'?  /  Why  should       T=A     
    that DNA be sequenced more  than  yours?  /              -
    Extract them together, yours is as  fair  a       A=T     
    genome; / transcribe them, it  doth  become            T=-
    mRNA as well; / recombine them,  it  is  as       =A      
    long; clone with 'em, / Brutus will start a          G===C
    twin as soon as Caesar. / Now, in the names         T==A  
    of all  the  gods  at  once,  /  upon  what        C=G    
    proteins doth our Caesar feed, / that he is       TA      
    grown so great?                                  AT      
                                                   A=T    
                                                    T==A  
                                                      G==-
                                                  =C      
                                                        T-
                                                  ==A</code></pre>














<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S07.html">Synopsis 7</a> for the current design information.</p>

<h3><a name="and_now_at_length_they_overflow_their_banks.">And now at length they overflow their banks.</a></h3>
<p>It's not uncommon for a report to need a series of data fields in one
column and then a second column with only single field, perhaps
containing a summary or discussion of the other data. For example,
we might want to produce recipes of the form:</p>
<pre><code>
    =================[  Hecate's Broth of Ambition  ]=================
                                                                      
      Preparation time:             Method:                           
         66.6 minutes                  Remove the legs from the       
                                       lizard, the wings from the     
      Serves:                          owlet, and the tongue of the   
         2 doomed souls                adder. Set them aside.         
                                       Refrigerate the remains (they  
      Ingredients:                     can be used to make a lovely   
         2 snakes (1 fenny, 1          white-meat stock). Drain the   
         adder)                        newts' eyes if using pickled.  
         2 lizards (1 legless,         Wrap the toad toes in the      
         1 regular)                    bat's wool and immerse in half 
         3 eyes of newt (fresh         a pint of vegan stock in       
         or pickled)                   bottom of a preheated          
         2 toad toes (canned           cauldron. (If you can't get a  
         are fine)                     fresh vegan for the stock, a   
         2 cups of bat's wool          cup of boiling water poured    
         1 dog tongue                  over a vegetarian holding a    
         1 common or spotted           sprouted onion will do). Toss  
         owlet                         in the fenny snake, then the   
                                       legless lizard. Puree the      
                                       tongues together and fold      
                                       gradually into the mixture,    
                                       stirring widdershins at all   
                                       times.  Allow to bubble for 45 
                                       minutes then decant into two   
                                       tarnished copper chalices.         
                                       Garnish each with an owlet     
                                       wing, and serve immediately.</code></pre>
<p>There are several ways to achieve that effect. The most obvious is to
format each column separately and then lay them out side-by-side
with a pair of verbatim fields:</p>
<pre><code>
    my $prep = form 'Preparation time:        ',
                    '   {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}', $prep_time,
                    '                         ',
                    'Serves:                  ',
                    '   {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}', $serves,
                    '                         ',
                    'Ingredients:             ',
                    '   {[[[[[[[[[[[[[[[[[[[[}', $ingredients;</code></pre>
<pre><code>
    my $make = form 'Method:                          ',
                    '   {[[[[[[[[[[[[[[[[[[[[[[[[[[[[}',
                        $method;</code></pre>
<pre><code>
    print form 
        '=================[ {||||||||||||||||||||||||||} ]=================',
                                      $recipe,
        '                                                                  ',
        '  {&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;}     {&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;} ',
           $prep,                        $make;</code></pre>
<p>We could even chain the calls to <code>form</code> to eliminate the interim variables:</p>
<pre><code>
    print form 
        '=================[ {||||||||||||||||||||||||||} ]=================',
                                      $recipe,
        '                                                                  ',
        '  {&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;}     {&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;} ',
           form('Preparation time:        ',
                '   {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}', $prep_time,
                '                         ',
                'Serves:                  ',
                '   {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}', $serves
                '                         ',
                'Ingredients:             ',
                '   {[[[[[[[[[[[[[[[[[[[[}', $ingredients,
               ),
           form('Method:                          ',
                '   {[[[[[[[[[[[[[[[[[[[[[[[[[[[[}',
                    $method,
               );</code></pre>
<p>While it's impressive to be able to do that kind of nested formatting
(and highly useful in extreme formatting scenarios), it's also far too
ungainly for regular use. A cleaner, more maintainable solution is
use a single format and just build the method column up
piecemeal, like so:</p>
<pre><code>
    print form 
        '=================[ {||||||||||||||||||||||||||} ]=================',
                                      $recipe,
        '                                                                  ',
        'Preparation time:               Method:                           ',
        '   {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}          {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&hellip;} ',
            $prep_time,                     $method,
        '                                   {&hellip;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&hellip;} ',
                                            $method,
        'Serves:                            {&hellip;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&hellip;} ',
                                            $method,
        '   {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}          {&hellip;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&hellip;} ',
            $serves,                        $method,
        '                                   {&hellip;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&hellip;} ',
                                            $method,
        'Ingredients:                       {&hellip;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&hellip;} ',
                                            $method,
        '   {[[[[[[[[[[[[[[[[[[[[}          {&hellip;[[[[[[[[[[[[[[[[[[[[[[[[[[[} ',
            $ingredients,                   $method;</code></pre>
<p>That produces exactly the same result as the previous versions, because
each follow-on <code>{&hellip;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&hellip;}</code> field in the
&quot;Method&quot; column grabs one extra line from <code>$method</code>, and then the final
follow-on <code>{&hellip;[[[[[[&hellip;}</code> field grabs as many more as are required
to lay out the rest of the contents of the variable. The only down-side is
that the resulting code is still downright ugly. With all those tedious
repetitions of the same variable, there's far too much <code>$method</code>
in our madness.</p>
<p>Having a series of follow-on fields like this &ndash; vertically
continuing a single column across subsequent format lines &ndash; is so
common that <code>form</code> provides a special shortcut: the <code>{VVVVVVVVV}</code>
<em>overflow field</em>.</p>
<p>An overflow field automagically duplicates the field specification
immediately above it. The important point being that, because that
duplication includes copying the preceding field's data source, overflow
fields don't require a separate data source of their own.</p>
<p>Using overflow fields, we could rewrite our quotation generator
like this:</p>
<pre><code>
    print form 
        '=================[ {||||||||||||||||||||||||||} ]=================',
                                      $recipe,
        '                                                                  ',
        'Preparation time:               Method:                           ',
        '   {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}          {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;} ',
            $prep_time,                     $method,
        '                                   {VVVVVVVVVVVVVVVVVVVVVVVVVVVV} ',
        'Serves:                            {VVVVVVVVVVVVVVVVVVVVVVVVVVVV} ',
        '   {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}          {VVVVVVVVVVVVVVVVVVVVVVVVVVVV} ',
            $serves,                        
        '                                   {VVVVVVVVVVVVVVVVVVVVVVVVVVVV} ',
        'Ingredients:                       {VVVVVVVVVVVVVVVVVVVVVVVVVVVV} ',
        '   {[[[[[[[[[[[[[[[[[[[[}          {VVVVVVVVVVVVVVVVVVVVVVVVVVVV} ',
            $ingredients,
        '                                   {VVVVVVVVVVVVVVVVVVVVVVVVVVVV} ';</code></pre>
<p>Which would once again produce the recipe shown earlier.</p>
<p>Note that the overflow fields interact equally well in formats with
single-line and block fields. That's because block overflow fields have
one other special feature: they're non-greedy. Unless we <a href="/pub/a/2004/02/27/exegesis7.html?page=10#i_have_got_strength_of_limit">specify otherwise</a>, all types of block
fields will consume their entire data source. For example, if we wrote:</p>
<pre><code>
    print form :layout&laquo;across&raquo;,
         '{&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&hellip;}',
                                  $speech,
         '{&hellip;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&hellip;}',
                                  $speech,
         '{&hellip;[[[[[]]]]]&hellip;}   {=&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;=}   {&hellip;[[[[[]]]]]]&hellip;}',
             $speech,             $advert,              $speech,
         '{&hellip;[[[[[[[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]}',
                                  $speech;</code></pre>
<p>we'd get:</p>
<pre><code>
    Now is the winter of our discontent / Made glorious summer
    by this sun of York; / And all the clouds that lour'd upon
    our house / In                             the deep  bosom
    of  the  ocean                             buried.  /  Now
    are our  brows                             bound      with
    victorious                                 wreaths; /  Our
    bruised   arms                             hung   up   for
    monuments;   /                             Our       stern
    alarums          +---------------------+   changed      to
    merry            |                     |   meetings, / Our
    dreadful         | Eat at Mrs Miggins! |   marches      to
    delightful       |                     |   measures. Grim-
    visaged    war   +---------------------+   hath   smooth'd
    his   wrinkled                             front;  /   And
    now,   instead                             of     mounting
    barded  steeds                             / To fright the
    souls       of                             fearful        
    adversaries, /                             He       capers
    nimbly  in   a                             lady's chamber.</code></pre>
<p>That's because the two <code>{&hellip;[[[[[]]]]]&hellip;}</code> block fields
on either side of the verbatim advertisement field will eat all the
data in <code>$speech</code>, leaving nothing for the final format. Then
the advertisement will be centred on the two resulting columns of text.</p>
<p>But, block overflow fields are different.
They only take as many lines as are required to 
fill the lines generated by the non-overflow fields in their format.
So, if we changed our code to use overflows:</p>
<pre><code>
    print form :layout&laquo;across&raquo;
         '{&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;}', $speech,
         '{VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}',
         '{VVVVVVVVVVVV}   {=&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;=}   {VVVVVVVVVVVVV}', $advert,
         '{VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}';</code></pre>
<p>we get both a cleaner specification and a more elegant result:</p>
<pre><code>
    Now is the winter of our discontent / Made glorious summer
    by this sun of York; / And all the clouds that lour'd upon
    our house / In                             the deep  bosom
    of  the  ocean   +---------------------+   buried.  /  Now
    are our  brows   |                     |   bound      with
    victorious       | Eat at Mrs Miggins! |   wreaths; /  Our
    bruised   arms   |                     |   hung   up   for
    monuments;   /   +---------------------+   Our       stern
    alarums                                    changed      to
    merry meetings,  /  Our  dreadful  marches  to  delightful
    measures. Grim-visaged  war  hath  smooth'd  his  wrinkled
    front; / And now, instead of mounting barded steeds  /  To
    fright the souls  of  fearful  adversaries,  /  He  capers
    nimbly in a lady's chamber.</code></pre>
<p>Notice that, in the third format line of the previous example, the two
overflow fields on either side of the advertisement are each overflowing
from the single field that's above both of them. This kind of multiple
overflow is fine, but it does require that we specify <em>how</em> the various
fields overflow (i.e. as two separate columns of text, or &ndash; as in
this case &ndash; as a single, broken column across the page). That's
the purpose of the <code>:layout&laquo;across&raquo;</code> option on the
first line. This option is explained in detail <a href="/pub/a/2004/02/27/exegesis7.html?page=8#lay_out._lay_out.">below</a>.</p>
<p>The <code>{VVVVVVVV}</code> fields only consumed as much data from <code>$speech</code> as
was required to sandwich the output lines created by the verbatim
advertisement. This feature is important, because it means we can lay
out a series of block fields in one column and a single overflowed field
in another column without introducing ugly gaps. For example, because
the <code>{VVVVVVVVV}</code> fields in:</p>
<pre><code>
    print form
        &quot;Name:                                                  &quot;,
        &quot;  {[[[[[[[[[[[[}                                       &quot;, $name,
        &quot;                  Biography:                           &quot;,
        &quot;Status:             {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}&quot;, $bio,
        &quot;  {[[[[[[[[[[[[}    {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;, $status,
        &quot;                    {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;, 
        &quot;Comments:           {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;,
        &quot;  {[[[[[[[[[[[}     {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;, $comments;</code></pre>
<p>only consume as much of the overflowing <code>$bio</code> field as necessary,
the result is something like:</p>
<pre><code>
    Name:                                                  
      William                                             
      Shakespeare                                         
                      Biography:                          
    Status:             William Shakespeare was born on    
      Deceased (1564    April 23, 1564 in Strathford-upon- 
      -1616)            Avon, England; he was third of     
                        eight children from Father John    
    Comments:           Shakespeare and Mother Mary Arden. 
      Theories          Shakespeare began his education at 
      abound as to      the age of seven when he probably  
      the true          attended the Strathford grammar    
      author of his     school. The school provided        
      plays. The        Shakespeare with his formal        
      prime             education. The students chiefly    
      alternative       studied Latin rhetoric, logic, and 
      candidates        literature. His knowledge and      
      being Sir         imagination may have come from his 
      Francis           reading of ancient authors and     
      Bacon,            poetry. In November 1582,          
      Christopher       Shakespeare received a license to  
      Marlowe, or       marry Anne Hathaway. At the time of
      Edward de         their marriage, Shakespeare was 18 
      Vere              years old and Anne was 26. They had
                        three children, the oldest Susanna,
                        and twins- a boy, Hamneth, and a   
                        girl, Judith. Before his death on    
                        April 23 1616, William Shakespeare 
                        had written thirty-seven plays. He 
                        is generally considered the        
                        greatest playwright the world has  
                        ever known and has always been the 
                        world's most popular author.</code></pre>
<p>If <code>{VVVVVVVVVVV}</code> fields ate their entire data &ndash; the way
<code>{[[[[[[[[[}</code> or <code>{IIIIIIIIII}</code> fields do &ndash; then the output would be
much less satisfactory. The first block overflow field for <code>$bio</code> would
have to consume the entire biography, before the comments field was even
reached. So our output would be something like:</p>
<pre><code>
    Name:                                                                
      William                                                
      Shakespeare                                            
                      Biography:                          
    Status:             William Shakespeare was born on    
      Deceased (1564    April 23, 1564 in Strathford-upon- 
      -1616)            Avon, England; he was third of     
                        eight children from Father John    
                        Shakespeare and Mother Mary Arden. 
                        Shakespeare began his education at 
                        the age of seven when he probably  
                        attended the Strathford grammar    
                        school. The school provided        
                        Shakespeare with his formal        
                        education. The students chiefly    
                        studied Latin rhetoric, logic, and 
                        literature. His knowledge and      
                        imagination may have come from his 
                        reading of ancient authors and     
                        poetry. In November 1582,          
                        Shakespeare received a license to  
                        marry Anne Hathaway. At the time of
                        their marriage, Shakespeare was 18 
                        years old and Anne was 26. They had
                        three children, the oldest Susanna,
                        and twins- a boy, Hamneth, and a   
                        girl, Judith. Before his death on  
                        April 23 1616, William Shakespeare 
                        had written thirty-seven plays. He 
                        is generally considered the        
                        greatest playwright the world has  
                        ever known and has always been the 
                        world's most popular author.       
                                                   
    Comments:                                               
      Theories                                               
      abound as to                                           
      the true                                               
      author of his                                          
      plays. The                                             
      prime                                                  
      alternative                                            
      candidates                                             
      being Sir                                              
      Francis                                                
      Bacon,                                                 
      Christopher                                            
      Marlowe, or                                            
      Edward de                                              
      Vere</code></pre>
<p>Which is precisely why <code>{VVVVVVVVVVV}</code> fields don't work that way.</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S07.html">Synopsis 7</a> for the current design information.</p>

<h3><a name="great_floods_have_flown_from_simple_sources...">Great floods have flown from simple sources...</a></h3>
<p>When it comes to specifying the data source for each field in a format,
<code>form</code> offers several alternatives as to where that data placed,
several alternatives as to the order in which that data is extracted, and 
an option that lets us control how the data is fitted into each field.</p>

<h4><a name="a_man_may_break_a_word_with_you,_sir...">A man may break a word with you, sir...</a></h4>
<p>Whenever a field is passed more data than it can
accommodate in a single line, <code>form</code> is forced to &quot;break&quot; that data somewhere.</p>
<p>If the field in question is <em>W</em>
columns wide, <code>form</code> first squeezes any whitespace (as specified by
the <a href="/pub/a/2004/02/27/exegesis7.html?page=10#within_that_space_you_may_have_drawn_together...">user's <code>:ws</code> option</a>) and then looks at the next <em>W</em> columns of the string.
(Of course, that might actually correspond to less than <em>W</em> <em>characters</em>
if the string contains wide characters. However, for the sake of exposition
we'll pretend that all characters are one column wide here.)</p>
<p><code>form</code>'s breaking algorithm then searches for a newline, a carriage
return, any other whitespace character, or a hyphen. If it
finds a newline or carriage return within the first <em>W</em> columns, it
immediately breaks the data string at that point. Otherwise it locates
the <em>last</em> whitespace or hyphen in the first <em>W</em> columns and breaks
the string immediately after that space or hyphen. If it can't find
anywhere suitable to break the string, it breaks it at the (<em>W</em>-1)th
column and appends a hyphen.</p>
<p>So, for example:</p>
<pre><code>
    $data = &quot;You can play no part but Pyramus;\nfor Pyramus is a sweet-faced man&quot;;</code></pre>
<pre><code>
    print form &quot;|{[[[[[}|&quot;,
                 $data;</code></pre>
<p>prints:</p>
<pre><code>
    |You can|
    |play no|
    |part   |
    |but    |
    |Pyramu-|
    |s;     |
    |for    |
    |Pyramus|
    |is a   |
    |sweet- |
    |faced  |
    |man    |</code></pre>
<p>Note the line-breaks after <em>can</em> (at a whitespace), <em>part</em> (after a
whitespace), <em>sweet-</em> (after a hyphen), and <em>s;</em> (at a newline). Note
too that <em>Pyramus;</em> doesn't fit in the field, so it has to be chopped in two
and a hyphen inserted.</p>
<p>Of course, this particular style of line-breaking may not be suitable to all
applications, and we might prefer that <code>form</code> use some other algorithm. For
example, if <code>form</code> used the TeX breaking algorithm it would have broken
<em>Pyramus;</em> less clumsily, yielding:</p>
<pre><code>
    |You can|
    |play no|
    |part   |
    |but    |
    |Pyra-  |
    |mus;   |
    |for    |
    |Pyramus|
    |is a   |
    |sweet- |
    |faced  |
    |man    |</code></pre>
<p>To support different line-breaking strategies <code>form</code> provides
the <code>:break</code> option.  The <code>:break</code> option's value must be
a closure/subroutine, which will then be called whenever a data string
needs to be broken to fit a particular field width.</p>
<p>That subroutine is passed three arguments: the data
string itself, an integer specifying how wide the field is, and a regex
indicating which (if any) characters are to be <a href="/pub/a/2004/02/27/exegesis7.html?page=10#within_that_space_you_may_have_drawn_together...">squeezed</a>.
It is expected to return a list of two values: a string which is taken
as the &quot;broken&quot; text for the field, and a boolean value indicating
whether or not any data remains after the break (so <code>form</code> knows when
to stop breaking the data string). The subroutine is also expected to
update the <code>.pos</code> of the data string to point immediately after the
break it has imposed.</p>
<p>For example, if we always wanted to break at the exact width of the field
(with no hyphens), we could do that with:</p>
<pre><code>
    sub break_width ($data is rw, $width, $ws) {
        given $data {
            # Treat any squeezed or vertical whitespace as a single character
            # (since they'll subsequently be squeezed to a single space)
            my rule single_char { &lt;$ws&gt; | \v+ | . }</code></pre>
<pre><code>
            # Give up if there are no more characters to grab...
            return (&quot;&quot;, 0) unless m:cont/ (&lt;single_char&gt;&lt;1,$width&gt;) /;</code></pre>
<pre><code>
            # Squeeze the resultant substring...
            (my $result = $1) ~~ s:each/ &lt;$ws&gt; | \v+ /\c[SPACE]/;</code></pre>
<pre><code>
            # Check for any more data still to come...
            my bool $more = m:cont/ &lt;before: .* \S&gt; /;</code></pre>
<pre><code>
            # Return the squeezed substring and the &quot;more&quot; indicator...
            return ($result, $more);
        }
    }
    
    print form
        :break(&amp;break_width),
        &quot;|{[[[[[}|&quot;,
          $data;</code></pre>
<p>producing:</p>
<pre><code>
    |You can|
    |play no|
    |part bu|
    |t Pyram|
    |us; for|
    |Pyramus|
    |is a sw|
    |eet-fac|
    |ed man |</code></pre>
<p>Or we might prefer to break on every single whitespace-separated word:</p>
<pre><code>
    sub break_word ($data is rw, $width, $ws) {
        given $data {
            # Locate the next word (no longer than $width cols)
            my $found = m:cont/ \s* $?word:=(\S&lt;1,$width&gt;) /;</code></pre>
<pre><code>
            # Fail if no more words...
            return (&quot;&quot;, 0) unless $found{word};</code></pre>
<pre><code>
            # Check for any more data still to come...
            my bool $more = m:cont/ &lt;before: .* \S&gt; /;</code></pre>
<pre><code>
            # Otherwise, return broken text and &quot;more&quot; flag... 
            return ($found{word}, $more);
        }
    }
    
    print form
        :break(&amp;break_word),
        &quot;|{[[[[[}|&quot;,
          $data;</code></pre>
<p>producing:</p>
<pre><code>
    |You    |
    |can    |
    |play   |
    |no     |
    |part   |
    |but    |
    |Pyramus|
    |;      |
    |for    |
    |Pyramus|
    |is     |
    |a      |
    |sweet-f|
    |aced   |
    |man    |</code></pre>
<p>We'll see yet another application of user-defined breaking when
we discuss <a href="/pub/a/2004/02/27/exegesis7.html?page=13#define,_define,_welleducated_infant.">user-defined fields</a>.</p>

<h4><a name="he,_being_in_the_vaward,_placed_behind...">He, being in the vaward, placed behind...</a></h4>
<p>There are (at least) three schools of thought when it comes to setting
out a call to <code>form</code> that uses more than one format. The
&quot;traditional&quot; way (i.e. the way Perl 5 formats do it) is to interleave
each format string with a line containing the data it is to
interpolate, with each datum aligned directly under the field into
which it is to be fitted. Like so:</p>
<pre><code>
    print form
        &quot;Name:                                                  &quot;,
        &quot;  {[[[[[[[[[[[[}                                       &quot;,
           $name,
        &quot;                  Biography:                           &quot;,
        &quot;Status:             {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}&quot;,
                             $bio,
        &quot;  {[[[[[[[[[[[[}    {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;,
           $status,
        &quot;                    {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;, 
        &quot;Comments:           {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;,
        &quot;  {[[[[[[[[[[[}     {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;,
           $comments;</code></pre>
<p>This approach has the advantage that it self-documents: to know what
a particular field is supposed to contain, we merely need to look
down one line.</p>
<p>It does, however, break up the &quot;abstract picture&quot; that the formats
portray, which can make it more difficult to envisage what the final
formatted text will look like. So some people prefer to put all the data
to the right of the formats:</p>
<pre><code>
    print form
        &quot;Name:                                                  &quot;,
        &quot;  {[[[[[[[[[[[[}                                       &quot;, $name,
        &quot;                  Biography:                           &quot;,
        &quot;Status:             {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}&quot;, $bio,
        &quot;  {[[[[[[[[[[[[}    {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;, $status,
        &quot;                    {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;, 
        &quot;Comments:           {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;,
        &quot;  {[[[[[[[[[[[}     {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;, $comments;</code></pre>
<p>And that's perfectly acceptable too.</p>
<p>Sometimes, however, the data to be interpolated doesn't come neatly
pre-packaged in separate variables that are easy to intersperse between the
formats. For example, the data might be a list returned by a
subroutine call (<code><code>get_info</code></code>) or might be stored in a hash
(&nbsp;<code>%person{&laquo;&nbsp;name&nbsp;biog&nbsp;stat&nbsp;comm&nbsp;&raquo;}</code>&nbsp;). In such
cases it's a nuisance to have to tease that data out into separate
variables (or hash accesses) and then sprinkle them through the formats:</p>
<pre><code>
    print form
        &quot;Name:                                                  &quot;,
        &quot;  {[[[[[[[[[[[[}                                       &quot;,%person{name},
        &quot;                  Biography:                           &quot;,
        &quot;Status:             {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}&quot;,%person{biog},
        &quot;  {[[[[[[[[[[[[}    {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;,%person{stat},
        &quot;                    {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;, 
        &quot;Comments:           {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;,
        &quot;  {[[[[[[[[[[[}     {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}&quot;,%person{comm};</code></pre>
<p>So <code>form</code> has an option that lets us put a single, multi-line format
at the start of the argument list, place all the data together
after it, and have that data automatically interleaved as necessary.
Not surprisingly, that option is: <code>:interleave</code>. It's normally used in
conjunction with a heredoc, since that's the easiest way to specify a
multi-line string in Perl:</p>
<pre><code>
    print form :interleave, &lt;&lt;'EOFORMAT',
           Name:                                                 
             {[[[[[[[[[[[[}                                      
                             Biography:                          
           Status:             {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}
             {[[[[[[[[[[[[}    {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
                               {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
           Comments:           {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
             {[[[[[[[[[[[}     {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
           EOFORMAT
         %person{&laquo; name biog stat comm &raquo;}</code></pre>
<p>When <code>:interleave</code> is in effect, <code>form</code> grabs the first string
argument it's passed and breaks that argument up into individual lines.
It treats those individual lines as a series of distinct formats
and grabs as many of the remaining arguments as are required to
provide data for each format.</p>
<p>Of course, in this example we're also taking advantage of the new indenting
behaviour of heredocs. The &quot;Name:&quot;, &quot;Status:&quot;, and &quot;Comments:&quot;
titles are actually at the very beginning of their respective lines,
because the start of a Perl 6 heredoc terminator marks the left margin
of the entire heredoc string.</p>

<h4><a name="would_they_were_multitudes...">Would they were multitudes...</a></h4>
<p>It's important to point out that, even when we're using <code>form</code>'s
default <strong>non</strong>-interleaving behaviour, it's still okay to use a format
that spans multiple lines. There <em>is</em> however a significant (and useful)
difference in behaviour between the two alternatives.</p>
<p>The normal behaviour of <code>form</code> is to take each format string,
fill in each field in the format with a substring from the
corresponding data source, and then repeat that process until all the
data sources have been exhausted. Which means that a multi-line format
like this:</p>
<pre><code>
    print form
         &lt;&lt;'EOFORMAT',
            Name:    {[[[[[[[[[[[[[[[}   Role: {[[[[[[[[[[}
            Address: {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}
            _______________________________________________
            EOFORMAT
         @names, @roles, @addresses;</code></pre>
<p>would normally produce this:</p>
<pre><code>
    Name:    King Lear           Role: Protagonist 
    Address: The Cliffs, Dover                     
    _______________________________________________
    Name:    The Three Witches   Role: Plot devices
    Address: Dismal Forest, Scotland               
    _______________________________________________
    Name:    Iago                Role: Villain     
    Address: Casa d'Otello, Venezia               
    _______________________________________________</code></pre>
<p>because the entire three-line format is repeatedly filled in
as a single unit, line-by-line and datum-by-datum.</p>
<p>On the other hand, if we tell <code>form</code> that it's supposed to automatically
interleave the data coming after the format, like so:</p>
<pre><code>
    print form :interleave,
         &lt;&lt;'EOFORMAT',
            Name:    {[[[[[[[[[[[[[[[}   Role: {[[[[[[[[[[}
            Address: {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}
            _______________________________________________
            EOFORMAT
         @names, @roles, @addresses;</code></pre>
<p>then the call produces:</p>
<pre><code>
    Name:    King Lear           Role: Protagonist 
    Name:    The Three Witches   Role: Plot devices
    Name:    Iago                Role: Villain     
    Address: The Cliffs, Dover                     
    Address: Dismal Forest, Scotland               
    Address: Casa d'Otello, Venezia               
    _______________________________________________</code></pre>
<p>because that second version is really equivalent to:</p>
<pre><code>
    print form
         &quot;Name:    {[[[[[[[[[[[[[[[}   Role: {[[[[[[[[[[}&quot;,
                   @names,                   @roles,
         &quot;Address: {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}&quot;,
                   @addresses,
         &quot;_______________________________________________&quot;;</code></pre>
<p>That's not much use in this particular example, but it was exactly what
was needed for the biography example earlier. It's just a matter of
choosing the right type of data placement to achieve the particular
effect we want.</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S07.html">Synopsis 7</a> for the current design information.</p>

<h4><a name="lay_out._lay_out.">Lay out. Lay out.</a></h4>
<p>As we saw earlier, with <a href="/pub/a/2004/02/27/exegesis7.html?page=3#and_mark_what_way_i_make...">follow-on fields</a> and
<a href="/pub/a/2004/02/27/exegesis7.html?page=6#and_now_at_length_they_overflow_their_banks.">overflow fields</a>, <code>form</code>
is perfectly happy to have several fields in a single format that 
are all fed by the same data source. For example:</p>
<pre><code>
    print form
        &quot;{[[[[[[[[]]]]]]]]]]&hellip;}   {&hellip;[[[[[[[]]]]]]]]]]&hellip;}   {&hellip;[[[[[[[[]]]]]]]]]]}&quot;,
             $soliloquy,             $soliloquy,              $soliloquy;</code></pre>
<p>In fact, that kind of format is particularly useful for creating
multi-column outputs (like newspaper columns, for example).</p>
<p>But a small quandry arises. In what order should <code>form</code> fill in these
fields? Should the data be formatted down the page, filling each column
completely before starting the next (and therefore potentially leaving
the last column &quot;short&quot;):</p>
<pre><code>
    Now is the winter  of   torious  wreaths;   /   front; / And now, in-
    our discontent / Made   Our bruised arms hung   stead of mounting ba-
    glorious  summer   by   up for  monuments;  /   rded steeds / To fri-
    this sun of  York;  /   Our stern alarums ch-   ght the souls of fea-
    And  all  the  clouds   anged to merry meeti-   rful  adversaries,  /
    that lour'd upon  our   ngs, /  Our  dreadful   He capers nimbly in a
    house / In  the  deep   marches to delightful   lady's chamber.
    bosom  of  the  ocean   measures.   /   Grim-   
    buried. / Now are our   visaged war hath smo-   
    brows bound with vic-   oth'd  his   wrinkled</code></pre>
<p>Or should the data be run line-by-line across all three columns (the
way a Perl 5 <code>format</code> does it), filling one line completely before
starting the next:</p>
<pre><code>
    Now is the winter  of   our discontent / Made   glorious  summer   by
    this sun of  York;  /   And  all  the  clouds   that lour'd upon  our
    house / In  the  deep   bosom  of  the  ocean   buried. / Now are our
    brows bound with vic-   torious  wreaths;   /   Our bruised arms hung
    up for  monuments;  /   Our stern alarums ch-   anged to merry meeti-
    ngs, /  Our  dreadful   marches to delightful   measures.   /   Grim-
    visaged war hath smo-   oth'd  his   wrinkled   front; / And now, in-
    stead of mounting ba-   rded steeds / To fri-   ght the souls of fea-
    rful  adversaries,  /   He capers nimbly in a   lady's chamber.</code></pre>
<p>Or should the text run down the columns, but in such a way as to leave
those columns as evenly balanced in length as possible:</p>
<pre><code>
    Now is the winter  of   brows bound with vic-   visaged war hath smo-
    our discontent / Made   torious  wreaths;   /   oth'd  his   wrinkled
    glorious  summer   by   Our bruised arms hung   front; / And now, in-
    this sun of  York;  /   up for  monuments;  /   stead of mounting ba-
    And  all  the  clouds   Our stern alarums ch-   rded steeds / To fri-
    that lour'd upon  our   anged to merry meeti-   ght the souls of fea-
    house / In  the  deep   ngs, /  Our  dreadful   rful  adversaries,  /
    bosom  of  the  ocean   marches to delightful   He capers nimbly in a
    buried. / Now are our   measures.   /   Grim-   lady's chamber.</code></pre>
<p>Well, of course, there's no &quot;right&quot; answer to that; it depends entirely
on what kind of effect we're trying to achieve.</p>
<p>The first approach (i.e. lay out the text down each column first) works
well if we're formatting a news-column, or a report, or a description of
some kind. The second (i.e. lay out the text across each line first), is
excellent for putting diagrams or call-outs in the middle of a piece of
text (as we did for <a href="/pub/a/2004/02/27/exegesis7.html?page=6#and_now_at_length_they_overflow_their_banks.">Mrs Miggins</a>). The third approach (i.e. lay out the data downwards but
balance the columns) is best for presenting a single list of data in
multiple columns &ndash; like <code>ls</code> does.</p>
<p>So we need an option with which to tell <code>form</code> which of these useful
alternatives we want for a particular format. That option is named
<code>:layout</code> and can take one of three string values: <code>&quot;down&quot;</code>, <code>&quot;across&quot;</code>,
or <code>&quot;balanced&quot;</code>. So, for example, to produce three versions of Richard III's
famous monologue in the order shown above, we'd use:</p>
<pre><code>
    print form :layout&laquo;down&raquo;,
        &quot;{[[[[[[[[]]]]]]]]]]&hellip;}   {&hellip;[[[[[[[]]]]]]]]]]&hellip;}   {&hellip;[[[[[[[[]]]]]]]]]]}&quot;,
             $soliloquy,             $soliloquy,              $soliloquy;</code></pre>
<p>then:</p>
<pre><code>
    print form :layout&laquo;across&raquo;,
        &quot;{[[[[[[[[]]]]]]]]]]&hellip;}   {&hellip;[[[[[[[]]]]]]]]]]&hellip;}   {&hellip;[[[[[[[[]]]]]]]]]]}&quot;,
             $soliloquy,             $soliloquy,              $soliloquy;</code></pre>
<p>then:</p>
<pre><code>
    print form :layout&laquo;balanced&raquo;,
        &quot;{[[[[[[[[]]]]]]]]]]&hellip;}   {&hellip;[[[[[[[]]]]]]]]]]&hellip;}   {&hellip;[[[[[[[[]]]]]]]]]]}&quot;,
             $soliloquy,             $soliloquy,              $soliloquy;</code></pre>
<p>By the way, the default value for the <code>:layout</code> option is <code>&quot;balanced&quot;</code>
since formatting regular columns of data is more common than formatting
news or advertising inserts.</p>

<h4><a name="for_the_table,_sir,_it_shall_be_served...">For the table, sir, it shall be served...</a></h4>
<p>The <code>:layout</code> option controls one other form of inter-column formatting:
tabular layout.</p>
<p>So far, all the examples of tables we've created (for example, our 
<a href="/pub/a/2004/02/27/exegesis7.html?page=3#therefore,_put_you_in_your_best_array...">normalized scores</a>)
lined up nicely. But that was only because each item in each row
happened to take the same number of lines (typically just one).
So, a table generator like this:</p>
<pre><code>
    my @play = map {&quot;$_\r&quot;}  ( &quot;Othello&quot;, &quot;Richard III&quot;, &quot;Hamlet&quot;   );
    my @name = map {&quot;$_\r&quot;}  ( &quot;Iago&quot;,    &quot;Henry&quot;,       &quot;Claudius&quot; );</code></pre>
<pre><code>
    print form 
         &quot;Character       Appears in  &quot;,
         &quot;____________    ____________&quot;,
         &quot;{[[[[[[[[[[}    {[[[[[[[[[[}&quot;,
          @name,          @play;</code></pre>
<p>correctly produces:</p>
<pre><code>
    Character       Appears in
    ____________    ____________
    Iago            Othello     
                              
    Henry           Richard III</code></pre>
<pre><code>
    Claudius        Hamlet</code></pre>
<p>Note that we appended <code>&quot;\r&quot;</code> to each element to add an extra
newline after each entry in the table. We can't use <code>&quot;\n&quot;</code> to specify a
line-break within an array element, because <code>form</code> uses <code>&quot;\n&quot;</code> as an
<a href="/pub/a/2004/02/27/exegesis7.html?page=3#therefore,_put_you_in_your_best_array...">&quot;end-of-element&quot; marker</a>.
So, to allow line breaks within a single element of an array datum,
<code>form</code> treats <code>&quot;\r&quot;</code> as &quot;end-of-line-but-not-end-of-element&quot;
(somewhat like Perl 5's <code>format</code> does).</p>
<p>However, if we were to use the full titles for each character and each play:</p>
<pre><code>
    my @play = map {&quot;$_\r&quot;}  ( &quot;Othello, The Moor of Venice&quot;,
                               &quot;The Life and Death of King Richard III&quot;,
                               &quot;Hamlet, Prince of Denmark&quot;,
                             );</code></pre>
<pre><code>
    my @name = map {&quot;$_\r&quot;}  ( &quot;Iago&quot;,
                               &quot;Henry,\rEarl of Richmond&quot;,
                               &quot;Claudius,\rKing of Denmark&quot;,
                             );</code></pre>
<p>the same formatter would produce:</p>
<pre><code>
    Character       Appears in
    ____________    ____________
    Iago            Othello, The
                    Moor of     
    Henry,          Venice      
    Earl of
    Richmond        The Life and         
                    Death of    
    Claudius,       King Richard
    King of         III         
    Denmark         
                    Hamlet,     
                    Prince of   
                    Denmark</code></pre>
<p>The problem is that the two block fields we're using just grab all
the data from each array and format it independently into each column.
Usually that's fine because the columns <em>are</em> independent (as we've
<a href="/pub/a/2004/02/27/exegesis7.html?page=5#able_verbatim_to_rehearse...">previously seen</a>).</p>
<p>But in a table, the data in each column specifically relates to data
in other columns, so corresponding elements from the column's data
arrays ought to remain vertically aligned. To achieve this, we simply
tell <code>form</code> that the data in the various columns should be laid out
like a table:</p>
<pre><code>
    print form :layout&laquo;tabular&raquo;,
         &quot;Character       Appears in  &quot;,
         &quot;____________    ____________&quot;,
         &quot;{[[[[[[[[[[}    {[[[[[[[[[[}&quot;,
          @name,          @play;</code></pre>
<p>which then produces the desired result:</p>
<pre><code>
    Character       Appears in
    ____________    ____________
    Iago            Othello, The
                    Moor of     
                    Venice      
                                
    Henry,          The Life and
    Earl of         Death of    
    Richmond        King Richard
                    III         
                                
    Claudius,       Hamlet,     
    King of         Prince of   
    Denmark         Denmark</code></pre>

<hr />
<h3><a name="give_him_line_and_scope...">Give him line and scope...</a></h3>
<p>Sometimes we want to use a particular option or combination of options
in every call we make to <code>form</code>. Or, more likely, in every call we make
within a specific scope.  For example, we might wish to default to
a different
<a href="/pub/a/2004/02/27/exegesis7.html?page=7#a_man_may_break_a_word_with_you,_sir...">line-breaking algorithm</a>
everywhere, or we might want to make repeated use of
<a href="/pub/a/2004/02/27/exegesis7.html?page=13#define,_define,_welleducated_infant.">a new type of field specifier</a>,
or we might want to <a href="/pub/a/2004/02/27/exegesis7.html?page=12#measure_his_woe_the_length_and_breadth_of_mine...">reset the standard page length</a> from a
printable 60 to a screenable 24.</p>
<p>Normally in Perl 6, if we wanted to preset a particular optional
argument we'd simply make an assumption:</p>
<pre><code>
    my &amp;down_form := &amp;form.assuming(:layout&laquo;down&raquo;);</code></pre>
<p>But, of course, <code>form</code> collects all of its arguments in <a href="/pub/a/2004/02/27/exegesis7.html?page=2#why,_how_now,_ho!_from_whence_ariseth_this">a single slurpy array</a>, so it
doesn't actually <em>have</em> a <code>$layout</code> parameter that we can prebind.</p>
<p>Fortunately, the <code>.assuming</code> method is smart enough to recognize when it
being applied to a subroutine whose arguments are slurped. In such cases,
it just prepends any prebound arguments to the resulting subroutine's argument
list. That is, the binding of <code>down_form</code> shown above is equivalent to:</p>
<pre><code>
    my &amp;down_form :=
        sub (FormArgs *@args is context(Scalar)) returns Str {
            return form( :layout&laquo;down&raquo;, *@args );
        };</code></pre>

<h4><a name="this_was_your_default...">This was your default...</a></h4>
<p><code>form</code> provides one other mechanism by which options can be prebound.
To use it, we (re-)load the Form module with an explicit argument list:</p>
<pre><code>
    use Form :layout&laquo;down&raquo;, :locale, :interleave;</code></pre>
<p>This causes the module to export a modified version of <code>form</code> in which the
specified options are prebound.  That modified version of <code>form</code> is exported
lexically, and so <code>form</code> only has the specified defaults preset for the
scope in which the <code>use Form</code> statement appears.</p>
<p>These default options are handy if we have a series of calls
to <code>form</code> that all need some consistent non-standard behaviour.
For example:</p>
<pre><code>
    use Form :layout&laquo;across&raquo;,
             :interleave,
             :page{ :header(&quot;Draft $(localtime)\n\n&quot;) };</code></pre>
<pre><code>
    print form $introduction_format, *@introduction_data;</code></pre>
<pre><code>
    for @sections -&gt; $format, @data {
        print form $format, *@data;
    }</code></pre>
<pre><code>
    print form $conclusion_format, *@conclusion_data;</code></pre>
<p>Another use is to set up a fixed formatting string into which different data
is to be interpolated (much in the way Perl 5 formats are typically used).
For example, we might want a standard format for errors in a <code>CATCH</code> block:</p>
<pre><code>
    CATCH {
        use Form :interleave, &lt;&lt;EOFORMAT;
                     Error {&lt;&lt;&lt;&lt;&lt;&lt;&lt;}: {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}
                     ___________________________________________________
                     EOFORMAT</code></pre>
<pre><code>
        when /Missing datum/ { warn form &quot;EMISSDAT&quot;, $_.msg }
        when /too large/     { warn form &quot;ETOOBIG&quot;,  $_.msg }
        when .core           { warn form &quot;EINTERN&quot;,  &quot;Internal error&quot; }
        default              { warn form &quot;EUNKNOWN&quot;, &quot;Seek help&quot; }
    }</code></pre>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S07.html">Synopsis 7</a> for the current design information.</p>

<h3><a name="and_welcome_to_the_wide_fields...">And welcome to the wide fields...</a></h3>
<p>All the fields we've seen so far have been exactly as wide as their
specifications. That's the whole point of having fields &ndash; 
they allow us to lay out formats &quot;by eye&quot;.</p>
<p>But <code>form</code> also allows us to specify field widths in other ways. And better
yet, to avoid specifying them at all and let <code>form</code> work out how big
they should be.</p>

<h4><a name="the_measure_then_of_one_is_easily_told.">The measure then of one is easily told.</a></h4>
<p>When specific field widths are required (perhaps by some design document
or data formatting protocol) laying out wide fields can be error-prone.
For example, most people can't visually distinguish between a
52-column field and a 53-column field and are therefore forced to manually
verify the width of the corresponding field specifier in some way.</p>
<p>When such fields are part of a larger format, errors like that can
easily result in a call to <code>form</code> producing, say, 81-column lines. That
would merely be messy if the extra characters wrapped, but could
be disasterous if they happened to be chopped instead. Suppose,
for example, that the last 4 columns of output contain nuclear reactor
core temperatures and then consider the difference between an
apparently normal reading of 567 Celsius and what might actually be
happening if the reading were in fact a truncated 5678 Celsius.</p>
<p>To catch mistakes of this kind, fields can be specified with an
embedded integer in parentheses (with optional whitespace inside the
parens). For example:</p>
<pre><code>
    print form '{[[[( 15 )[[[[} {&lt;&lt;&lt;&lt;&lt;(17)&lt;&lt;&lt;&lt;&lt;&lt;}  {]]](14)]]].[[}',
               *@data;</code></pre>
<p>The integer in the parentheses acts like a checksum. Its value
must be identical to the actual width of the field (including the
delimiting braces and the embedded integer itself). Otherwise an
exception is thrown. For instance, running the above example produces
the error message:</p>
<pre><code>
    Inconsistent width for field 3.
    Specified as '{]]](14)]]].[[}' but actual width is 15
    in call to &amp;form at demo.pl line 1</code></pre>
<p>Numeric fields can be given a decimal checksum, which then also
specifies their number of decimal places.</p>
<pre><code>
    print form
        '{[[[( 15 )[[[[} {&lt;&lt;&lt;&lt;&lt;(17)&lt;&lt;&lt;&lt;&lt;&lt;}  {]](14.2)]].[}',
         *@data;</code></pre>
<p>Note that the digits before the decimal still indicate
the total width of the field. So the <code>{]](14.2)]].[}</code> field
in the above example means <em>must be 14 columns wide, including
2 decimal places</em>, in exactly the same way as a <code>&quot;%14.2f&quot;</code>
specifier would in a <code>sprintf</code>.</p>

<h4><a name="what_you_will_command_me_will_i_do...">What you will command me will I do...</a></h4>
<p>Of course, in some instances it would be much more convenient if we
could simply <em>tell</em> <code>form</code> that we want a particular field to be
a particular width, instead of having to explicitly <em>show</em> it.</p>
<p>So there's another type of integer field annotation that, instead of
acting like a checksum, acts like an...err...&quot;tellsum&quot;. That is, we
can tell <code>form</code> to ignore a field's physical width and instead
insist that it be magically expanded (or shrunk) to a nominated width. Such
a field is said to have an <em>imperative width</em>. The integer specifying
the imperative width is placed in curly braces instead of parens.</p>
<p>For example, the format in the previous example could be specified
imperatively as:</p>
<pre><code>
    print form
        '{[{15}[} {&lt;{17}&lt;&lt;}  {]]]]{14.2}]]]].[[}',
         *@data;</code></pre>
<p>Note that the actual width of any field becomes irrelevant if it
contains an imperative width. The field will be condensed or expanded to
the specified width, with subsequent fields pushed left or right
accordingly.</p>
<p>Imperative fields disrupt the WYSIWYG layout of a format, so they're generally
only used when the format itself is being generated programmatically. For
example, when we were counting down the <a href="/pub/a/2004/02/27/exegesis7.html?page=2#what_a_block_art_thou...">top ten reasons not to do one's English Lit homework</a>, we used a fixed-width
<code>{&gt;}</code> field to format each number:</p>
<pre><code>
    for @reasons.kv -&gt; $n, $reason {
        my $n = @reasons - $index ~ '.';
        print form &quot;   {&gt;}  {[[[[[[[[[[[[[[[[[[[[[[[[[[[[}&quot;,
                       $n,  $reason,
                   &quot;&quot;;
    }</code></pre>
<p>But, of course, there's not reason (theoretically, at least) why we couldn't
find more than 99 reasons not to do our homework, in which case we'd
overflow the <code>{&gt;}</code> field.</p>
<p>So instead of limiting ourselves that way, we could just tell <code>form</code> to make
the first field wide enough to enumerate however many reasons we come up with,
like so:</p>
<pre><code>
    my $width = length(+@reasons)+1;</code></pre>
<pre><code>
    for @reasons.kv -&gt; $n, $reason {
        my $n = @reasons - $index ~ '.';
        print form &quot;   {&gt;&gt;{$width}&gt;&gt;}  {[[[[[[[[[[[[[[[[[[[[[[[[[[[[}&quot;,
                       $n,             $reason,
                   &quot;&quot;;
    }</code></pre>
<p>By evaluating <code>@reasons</code> in a numeric context (<code>+@reasons</code>) we determine the
number of reasons we have, and hence the largest number that need ever fit
into the first field. Taking the length of that number (<code><code>length</code></code>)
gives us the number of digits in that largest number and hence the width of a
field that can format that number. We add one extra column (for the dot
we're appending to each number) and that's our required width. Then we just
tell <code>form</code> to make the first field that wide (<code>{&gt;&gt;{$width}&gt;&gt;}</code>).</p>

<h4><a name="and_every_one_shall_share...">And every one shall share...</a></h4>
<p>A special form of imperative width field is the <em>starred field</em>.
A starred field is one that contains an imperative width
specification in which the number is replaced by a single asterisk.</p>
<p>The width of a starred field is not fixed, but rather is <em>computed</em>
during formatting. That width is whatever is required to cause the
entire format to fill the current page width of the format (by default,
78 columns). Consider, for example:</p>
<pre><code>
    print form
        '{]]]]]]]]]]]]]]} {]]].[[}  {[[{*}[[}  ',
         @names,          @scores,  @comments;</code></pre>
<p>The width of the starred comment field in this case is 49 columns &ndash;
the default page width of 78 columns minus the 29 columns
consumed by the fixed-width portions of the format (including the other two
fields).</p>
<p>If a format contains two or more starred fields, the available space
is shared equally between them. So, for example, to create two equal columns
(say, to compare the contents of two files), we might use:</p>
<pre><code>
    print form 
         &quot;{[[[[{*}[[[[}   {[[[[{*}[[[[}&quot;,
          slurp($file1),  slurp($file2);</code></pre>
<p>And, yes, Perl 6 does have a built-in <code>slurp</code> function that takes a filename,
opens the file, reads in the entire contents, and returns them as a single
string. For more details see the Perl6::Slurp module (now on the CPAN).</p>
<p>There is one special case for starred fields: a starred verbatim field:</p>
<pre><code>
    {&quot;&quot;&quot;&quot;{*}&quot;&quot;&quot;&quot;}</code></pre>
<p>It acts like any other starred field, growing according to the available
space, except that it will never grow any wider than the widest line
of the data it is formatting. For example, whereas a regular starred 
field:
</p>
<pre><code>

    print form 
         '| {[[{*}[[} |',
            $monologue;</code></pre>
<p>expands to the full page width:</p>
<pre><code>
    | Now is the winter of our discontent                           |
    | Made glorious summer by this sun of York;                     |
    | And all the clouds that lour'd upon our house                 |
    | In the deep bosom of the ocean buried.                        |
    | Now are our brows bound with victorious wreaths               |  
    | Our bruised arms hung up for monuments;                       |
    | Our stern alarums changed to merry meetings,                  |
    | Our dreadful marches to delightful measures.                  |
    | Grim-visaged war hath smooth'd his wrinkled front;            |
    | And now, instead of mounting barded steeds                    |  
    | To fright the souls of fearful adversaries,                   |  
    | He capers nimbly in a lady's chamber.                         |</code></pre>
<p>a starred verbatim field:</p>
<pre><code>
    print form 
         '| {&quot;&quot;{*}&quot;&quot;} |',
            $monologue;</code></pre>
<p>only expands as much as is strictly necessary to accommodate the data:</p>
<pre><code>
    | Now is the winter of our discontent                |
    | Made glorious summer by this sun of York;          |
    | And all the clouds that lour'd upon our house      |
    | In the deep bosom of the ocean buried.             |
    | Now are our brows bound with victorious wreaths;   |  
    | Our bruised arms hung up for monuments;            |
    | Our stern alarums changed to merry meetings,       |
    | Our dreadful marches to delightful measures.       |
    | Grim-visaged war hath smooth'd his wrinkled front; |
    | And now, instead of mounting barded steeds         |  
    | To fright the souls of fearful adversaries,        |  
    | He capers nimbly in a lady's chamber.              |</code></pre>

<h4><a name="that_we_our_largest_bounty_may_extend...">That we our largest bounty may extend...</a></h4>
<p>By now you've probably noticed that there is quite a large overlap between the
functionality of <code>form</code> and that of <code>(s)printf</code>. For example, the call:</p>
<pre><code>
    for @procs {
        print form
            &quot;{&gt;&gt;&gt;}  {&lt;&lt;&lt;&lt;&lt;&lt;&lt;(20)&lt;&lt;&lt;&lt;&lt;&lt;&lt;}  {&gt;&gt;&gt;&gt;&gt;&gt;}  {&gt;&gt;.}%&quot;,
            .{pid}, .{cmd},               .{time},  .{cpu};
    }</code></pre>
<p>has approximately the same effect as the call:</p>
<pre><code>
    for @procs {
        printf &quot;%5d  %-20s  %8s  %5.1f%%\n&quot;,
               .{pid}, .{cmd}, .{time}, .{cpu};
    }</code></pre>
<p>One is more WYSIWYG, the other more concise, but (placed in a suitable loop),
they would both print out lines like these:</p>
<pre><code>
     2461  vi -ii henry           0:55.83   11.6%
     2395  ex cathedra            0:06.59    3.5%
     2439  head anne.boleyn       0:00.18    0.1%
     2581  dig -short grave       0:01.04    0.0%</code></pre>
<p>There is, however, a crucial difference between these two formatting
facilities; one that only shows up when one of our processes runs over 99
hours. For example, suppose our browser has been running continuously
for a few months (or, more precisely, for 1214:23.75 hours). Then the
calls to <code>printf</code> would print:</p>
<pre><code>
     2461  vi -ii henry           0:55.83   11.6%
     2395  ex cathedra            0:06.59    3.5%
    27384  lynx www.divorce.com  1214:23.75    0.8%
     2439  head anne.boleyn       0:00.18    0.1%
     2581  dig -short grave       0:01.04    0.0%</code></pre>
<p>whilst the calls to <code>form</code> would print:</p>
<pre><code>
     2461  vi -ii henry           0:55.83   11.6%
     2395  ex cathedra            0:06.59    3.5%
    27384  lynx www.divorce.com  1214:23-    0.8%
     2439  head anne.boleyn       0:00.18    0.1%
     2581  dig -short grave       0:01.04    0.0%</code></pre>
<p>In other words, field widths in a <code>printf</code> represent <em>minimal</em> spacing
(even if that throws off the overall layout), whereas field widths in a
<code>form</code> represent <em>guaranteed</em> spacing (even if that truncates some of
the data).</p>
<p>Of course, in a situation like this &ndash; where we knew that the data might
not fit and we didn't want it truncated &ndash; we could use a block field
instead:</p>
<pre><code>
    for @procs {
        print form
            &quot;{&gt;&gt;&gt;}  {&lt;&lt;&lt;&lt;&lt;&lt;&lt;(19)&lt;&lt;&lt;&lt;&lt;&lt;}  {]]]]]]}  {&gt;&gt;.%}&quot;,
            .{pid}, .{cmd},              .{time},  .{cpu};
    }</code></pre>
<p>in which case we'd get:</p>
<pre><code>
     2461  vi -ii henry           0:55.83   11.6%
     2395  ex cathedra            0:06.59    3.5%
    27384  lynx www.divorce.com  1214:23-    0.8%
                                      .75
     2439  head anne.boleyn       0:00.18    0.1%
     2581  dig -short grave       0:01.04    0.0%</code></pre>
<p>That preserves the data, but the results are still ugly, and it also
requires some fancy footwork &ndash; making the percentage sign part of
the field specification, as if it were <a href="/pub/a/2004/02/27/exegesis7.html?page=5#some_tender_money_to_me...">a currency marker</a> &ndash; to make the last field
work correctly. In other words: it's a kludge. The sad truth is that
sometimes variable-width fields are a better solution.</p>
<p>So <code>form</code> provides them too. Any field specification may include a
plus sign (<code>+</code>) anywhere between its braces, in which case it
specifies an <em>extensible field</em>: a field whose width is minimal,
rather than absolute. So, in the above example, our call to <code>form</code>
should actually look like this:</p>
<pre><code>
    for @procs {
        print form
            &quot;{&gt;&gt;&gt;}  {&lt;&lt;&lt;&lt;&lt;&lt;&lt;(20)&lt;&lt;&lt;&lt;&lt;&lt;&lt;}  {&gt;&gt;&gt;&gt;&gt;+}  {&gt;&gt;.}%&quot;,
            .{pid}, .{cmd},               .{time},  .{cpu};
    }</code></pre>
<p>and would produce this:</p>
<pre><code>
     2461  vi -ii henry           0:55.83   11.6%
     2395  ex cathedra            0:06.59    3.5%
    27384  lynx www.divorce.com  1214:23.75    0.8%
     2439  head anne.boleyn       0:00.18    0.1%
     2581  dig -short grave       0:01.04    0.0%</code></pre>
<p>just like <code>printf</code> does.</p>
<p>Likewise, if we thought the command names might exceed 20 columns we
could let that field stretch too:</p>
<pre><code>
    for @procs {
        print form
            &quot;{&gt;&gt;&gt;}  {&lt;&lt;&lt;&lt;&lt;&lt;&lt;(20+)&lt;&lt;&lt;&lt;&lt;&lt;}  {&gt;&gt;&gt;&gt;&gt;+}  {&gt;&gt;.}%&quot;,
            .{pid}, .{cmd},               .{time},  .{cpu};
    }</code></pre>
<p>Note that the field width specifier would still warn us if the field's
&quot;picture&quot; was not exactly 20 columns wide, but the resulting field
would nevertheless stretch as necessary to accommodate longer data.</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S07.html">Synopsis 7</a> for the current design information.</p>

<h4><a name="within_that_space_you_may_have_drawn_together...">Within that space you may have drawn together...</a></h4>
<p>When a field is being filled in, whitespace is normally left as-is
(except for justification, and wrapping of lines in block fields).
However, this behaviour can be altered by specifying a <em>whitespace
squeezing</em> strategy. Squeezing replaces those substrings of the data
that match a specified pattern (for example: <code>/\s+/</code>), substituting
a single space character.</p>
<p>If we don't want the default (non-)squeezing strategy we can use
the <code>:ws</code> option specify the particular pattern that is to be
used for squeezing:</p>
<pre><code>
    print form
        :ws(/\h+/),            # squeeze any horizontal whitespace
        $format1, *@data1,
        :ws(/&lt;comment&gt;|\s+/),  # now squeeze comments or whitespace
        $format2, *@data2;</code></pre>
<p>For example, suppose we have a eulogy generator:</p>
<pre><code>
    sub eulogize ($who, $to, $blaming) {...}</code></pre>
<p>that (rather poorly) drops the appropriate names into a pre-formatted template,
to produce strings like:</p>
<pre><code>
    Friends,   Romans  , countrymen, lend me your ears;
    I come to bury    Caesar   , not to praise him.
    The evil that men do lives after them;
    The good is oft interred with their bones;
    So let it be with    Caesar    . The noble    Brutus
    Hath told you     Caesar     was ambitious:
    If it were so, it was a grievous fault,
    And grievously hath    Caesar    answer'd it.</code></pre>
<p>If we interpolate that string, with its extra spaces and its embedded
newlines, into a <code>form</code> field:</p>
<pre><code>
    print form
         &quot;| {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[} |&quot;,
            eulogize('Caesar', to=&gt;'Romans', blaming=&gt;'Brutus');</code></pre>
<p>we'd get:</p>
<pre><code>
    | Friends,   Romans  , countrymen, lend me   |
    | your ears;                                 |
    | I come to bury    Caesar   , not to praise |
    | him.                                       |
    | The evil that men do lives after them;     |
    | The good is oft interred with their bones; |
    | So let it be with    Caesar    . The noble |
    | Brutus                                     |
    | Hath told you     Caesar     was           |
    | ambitious:                                 |
    | If it were so, it was a grievous fault,    |
    | And grievously hath    Caesar    answer'd  |
    | it.                                        |</code></pre>
<p>Note that the extra spaces and the embedded newlines
are preserved in the resulting text.</p>
<p>But, if we told <code>form</code> to squeeze all whitespaces:</p>
<pre><code>
    print form :ws(/\s+/),
         &quot;| {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[} |&quot;,
            eulogize('Caesar', to=&gt;'Romans', blaming=&gt;'Brutus');</code></pre>
<p>we'd get:</p>
<pre><code>
    | Friends, Romans , countrymen, lend me your |
    | ears; I come to bury Caesar , not to       |
    | praise him. The evil that men do lives     |
    | after them; The good is oft interred with  |
    | their bones; So let it be with Caesar .    |
    | The noble Brutus Hath told you Caesar was  |
    | ambitious: If it were so, it was a         |
    | grievous fault, And grievously hath Caesar |
    | answer'd it.                               |</code></pre>
<p>with each sequence of characters that match <code>/\s+/</code> being reduced
to a single space.</p>
<p>On the other hand, if we wanted to preserve the newlines and squeeze
only horizontal whitespace, that would be:</p>
<pre><code>
    print form :ws(/\h+/),
         &quot;| {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[} |&quot;,
            eulogize('Caesar', to=&gt;'Romans', blaming=&gt;'Brutus');</code></pre>
<p>which produces:</p>
<pre><code>
    | Friends, Romans , countrymen, lend me your |
    | ears;                                      |
    | I come to bury Caesar , not to praise him. |
    | The evil that men do lives after them;     |
    | The good is oft interred with their bones; |
    | So let it be with Caesar . The noble       |
    | Brutus                                     |
    | Hath told you Caesar was ambitious:        |
    | If it were so, it was a grievous fault,    |
    | And grievously hath Caesar answer'd it.    |</code></pre>
<p>Of course, for this particular text, none of these solutions is entirely
satisfactory since squeezing the whitespaces to a single space still leaves a
single space in places like <code>&quot;Caesar .&quot;</code> and <code>&quot;Romans ,&quot;</code>.</p>
<p>To remove those blemishes we need to take advantage of a more
sophisticated aspect of <code>form</code>'s whitespace squeezing behaviour. Namely
that, when squeezing whitespace using a particular pattern, <code>form</code>
detects if that pattern captures anything and <em>doesn't</em> squeeze the 
captured items.</p>
<p>More precisely, if the squeeze pattern matches but doesn't capture,
<code>form</code> simply replaces the entire match with a single space character.
But if the squeeze pattern <em>does</em> capture, <code>form</code> doesn't insert a
space character, but instead replaces the entire match with the
concatenation of the captured substrings.</p>
<p>That means we can completely eliminate any whitespace before a punctuation
character with:</p>
<pre><code>
    print form :ws(/\h+ (&lt;punct&gt;)?/),
         &quot;| {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[} |&quot;,
            eulogize('Caesar', to=&gt;'Romans', blaming=&gt;'Brutus');</code></pre>
<p>which produces the desired:</p>
<pre><code>
    | Friends, Romans, countrymen, lend me your  |
    | ears;                                      |
    | I come to bury Caesar, not to praise him.  |
    | The evil that men do lives after them;     |
    | The good is oft interred with their bones; |
    | So let it be with Caesar. The noble Brutus |
    | Hath told you Caesar was ambitious:        |
    | If it were so, it was a grievous fault,    |
    | And grievously hath Caesar answer'd it.    |</code></pre>
<p>This works because, in those instances where the pattern
<code>/\h+ (&lt;punct&gt;)?/</code> matches some whitespace followed by
a punctuation character, the punctuation character is captured,
and the captured character is then used to replace the entire
whitespace-plus-punctuator. On the other hand, if the
pattern matches whitespace but no punctuator (and it's allowed to do that
because the punctuator is optional), then nothing is captured, so
<code>form</code> falls back to replacing the whitespace with a single space.</p>

<h4><a name="he_doth_fill_fields_with_harness...">He doth fill fields with harness...</a></h4>
<p>Fields are (almost) always of a fixed width. So, if there isn't
enough data to fill a particular field, the unused portions of that
field are filled in with spaces to preserve the vertical alignment of
other columns of formatted data. However, spaces are only the
default. The <code>:hfill</code> (horizontal fill) option can be used to change
fillers. For example:</p>
<pre><code>
    print form
        :hfill(&quot;=-&quot;),                   # Fill next fields with &quot;=-&quot;
        &quot;{|{*}|}\n&quot;,                    # Full width field for title
        &quot;[ Table of Contents ]&quot;,        # Title
        :hfill(&quot; .&quot;),                   # Fill next fields with spaced dots
        '   {[[[[[{*}[[[[[}{]]]}   ',   # Two indented block fields
            @contents,     @page;       # Data for those blocks</code></pre>
<p>This fills the empty space either side of the centred title with a repeated
<code>=-=-=-</code> sequence. It then fills the gaps to the right of the left-justified
the contents field, and to left of the right-justified pages field,
with spaced dots. Which, rather prettily, produces something like:</p>
<pre><code>
    =-=-=-=-=-=-=-[ Table of Contents ]-=-=-=-=-=-=-=</code></pre>
<pre><code>
       Foreword. . . . . . . . . . . . . . . . . .i   
       Preface . . . . . . . . . . . . . . . . .iii   
       Glossary. . . . . . . . . . . . . . . . . vi   
       Introduction. . . . . . . . . . . . . . . .1   
       The Tempest . . . . . . . . . . . . . . . .7   
       Two Gentlemen of Verona . . . . . . . . . 17   
       The Merry Wives of Winsor . . . . . . . . 27   
       Twelfh Night. . . . . . . . . . . . . . . 39   
       Measure for Measure . . . . . . . . . . . 50   
       Much Ado About Nothing. . . . . . . . . . 62   
       A Midsummer Night's Dream . . . . . . . . 73   
       Love's Labour's Lost. . . . . . . . . . . 82   
       The Merchant of Venice. . . . . . . . . . 94   
       As You Like It. . . . . . . . . . . . . .105</code></pre>
<p>Note that the fill sequence doesn't have to be a single character and
that the fill pattern is consistent across multiple fields and between
adjacent lines. That is, it's as if every field is first filled with the
same fill pattern, then the actual data written over the top.
That's particularly handy in the above example, because it ensures that
the fill pattern seamlessly bridges the boundary between the adjacent
contents and pages fields.</p>
<p>It's also possible to specify separate fill sequences for the left-
and right-hand gaps in a particular field, using the <code>:lfill</code> and <code>:rfill</code>
options. This is particularly common for numerical fields. For example,
this call to <code>form</code>:</p>
<pre><code>
    print form 
      'Name              Bribe (per dastardry)',
      '=============     =====================',
      '{[[[[[[[[[[[}         {]],]]].[[[}     ',
      @names,                @bribes;</code></pre>
<p>would print something like:</p>
<pre><code>
    Name              Bribe (per dastardry)
    =============     =====================
    Crookback                  12.676
    Iago                        1.62
    Borachio               45,615.0
    Shylock                    19.0003</code></pre>
<p>with the numeric field padded with whitespace and 
only showing as many decimal places as there are in
the data.</p>
<p>However, in order to prevent subsequent..err...creative calligraphy
(they <em>are</em>, after all, villains and would presumably not hesitate
to add a few digits to the front of each number), we might prefer to
put stars before the numbers and show all decimal places.
We could do that like so:</p>
<pre><code>
    print form 
      'Name              Bribe (per dastardry)',
      '=============     =====================',
      '{[[[[[[[[[[[}         {]],]]].[[[}     ',
      @names,                :lfill('*'), :rfill('0'),
                             @bribes;</code></pre>
<p>which would then print:</p>
<pre><code>
    Name              Bribe (per dastardry)
    =============     =====================
    Crookback             *****12.6760
    Iago                  ******1.6200
    Borachio              *45,615.0000
    Shylock               *****19.0003</code></pre>
<p>Note that the <code>:lfill</code> and <code>:rfill</code> options are specified <em>after</em> the
format string and, more particularly, before the data for the second
field. This means that those options only take effect for that
particular field and the previous fill behaviour is then reasserted
for subsequent fields. Many other <code>form</code> options &ndash; for example <code>:ws</code>,
<code>:height</code>, or <code>:break</code> &ndash; can be specified in this way, so as to
apply them only to a particular field.</p>
<p>There is also a general <code>:fill</code> option that sets the default
sequence for any filling that isn't otherwise specified.</p>

<h4><a name="but_say_thou_nought...">But say thou nought...</a></h4>
<p>Filling numeric fields with zeros is so common that <code>form</code> offers a
shorthand notation for it. If the first character inside a numeric field specification is a zero, then the left-fill string for that field is set to <code>&quot;0&quot;</code>.
Likewise if the last character in the field is a zero, it is right-filled
with zeros. For example:</p>
<pre><code>
    my @nums = (0, 1, -1.2345, 1234.56, -1234.56, 1234567.89);</code></pre>
<pre><code>
    print form
        &quot;{]]]].[[}     {]]]].[0}     {0]]].[[}     {0]]].[0}&quot;,
         @nums,        @nums,        @nums,        @nums;</code></pre>
<p>prints:</p>
<pre><code>
        0.0           0.000     00000.0       00000.000
        1.0           1.000     00001.0       00001.000
       -1.234        -1.234     -0001.234     -0001.234
     1234.56       1234.560     01234.56      01234.560
    -1234.56      -1234.560     -1234.56      -1234.560
    #####.###     #####.###     #####.###     #####.###</code></pre>

<h4><a name="up_and_down,_up_and_down,_i_will_lead_them_up_and_down...">Up and down, up and down, I will lead them up and down...</a></h4>
<p>Formatted text blocks are also filled vertically. Empty lines at the end
of the block are normally filled with spaces (so as to preserve the
alignment of any other fields on the same line). However, this too can
be controlled, with the <code>:vfill</code> option. Alternatively &ndash; as with
horizontal filling &ndash; separate fill sequences can be specified for
above and below the text using the <code>:tfill</code> and <code>:bfill</code> (&quot;top&quot; and
&quot;bottom&quot; fill) options.</p>
<p>For example, if we had six elements in <code>@task</code>, but only four processors:</p>
<pre><code>
    print form
        :bfill('[unallocated]'),
        'Task                      Processor',
        '====                      =========',
        '{[[[[[[[[[[[[[[[[[[[[}  {]]]]]][[[[[}',
         @task,                      [1..4];</code></pre>
<p>we'd get:</p>
<pre><code>
    Task                      Processor
    ====                      =========
    Borrow story                  1      
    Rename characters             2      
    Subdivide into scenes         3      
    Write dialogue                4      
    Check rhythm and meter  [unallocated]
    Insert puns and japes   [unallocated]</code></pre>

<h4><a name="i_have_got_strength_of_limit...">I have got strength of limit...</a></h4>
<p>It is possible to constrain the minimum and maximum number of lines
that a particular format or block field must cover, regardless of how much
data it contains. We do that using the <code>:height</code> option. For example:</p>
<pre><code>
    print form
        :height(3),
        '{[[[[}{IIII}{]]]]}',
         $l,   $c,   $r;</code></pre>
<p>This will cause the call to <code>form</code> to generate exactly three output lines,
even if the contents of the data variables would normally fit in fewer lines
or would actually require more.</p>
<p>To specify a range of heights we can use the <code>:min</code> and <code>:max</code> suboptions:</p>
<pre><code>
    print form
        :height{ :min(3), :max(20) },
        '{[[[[}{IIII}{]]]]}',
         $l,   $c,   $r;</code></pre>
<p>This specifies that, no matter how much data is available, the output will be
no less than three lines and no more than 20.</p>
<p>Note, however, that the <code>height</code> option refers to the height of individual
fields, not of entire output pages. we'll see how to control the
latter <a href="/pub/a/2004/02/27/exegesis7.html?page=12#measure_his_woe_the_length_and_breadth_of_mine...">anon</a>.</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S07.html">Synopsis 7</a> for the current design information.</p>

<h4><a name="forbear,_and_eat_no_more.">Forbear, and eat no more.</a></h4>
<p>As we saw <a href="/pub/a/2004/02/27/exegesis7.html?page=6#and_now_at_length_they_overflow_their_banks.">earlier</a>,
a block overflow field (<code>{VVVVVVVVV}</code>)
has the special property that it only overflows as much as necessary to
fill the output lines generated by other block fields. That enabled us
to create an overflowing column of text like so:</p>
<pre><code>
    print form
        :interleave, &lt;&lt;EOFORMAT,
            Name:
              {[[[[[[[[[[[[}
                              Biography:
            Status:             {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}
              {[[[[[[[[[[[[}    {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
                                {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
            Comments:           {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
              {[[[[[[[[[[[}     {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
            EOFORMAT
        $name,
        $biography,
        $status,
        $comments;</code></pre>
<p>without the first <code>{VVVVVVVVV}</code> field eating all the data out of <code>$bio</code> and
leaving a large gap between the Status and the Comments.</p>
<p>That's a very handy feature, but restricting the &quot;minimal height&quot; feature
to overflow fields turns out to be not good enough in the general case.
For instance, suppose we had wanted the biography field to start at the
first line of the output text:</p>
<pre><code>
    Name:             Biography:                            
      William           William Shakespeare was born on    
      Shakespeare       April 23, 1564 in Strathford-upon- 
                        Avon, England; he was third of     
    Status:             eight children from Father John    
      Deceased (1564    Shakespeare and Mother Mary Arden. 
      -1616)            Shakespeare began his education at 
                        the age of seven when he probably  
    Comments:           attended the Strathford grammar    
      Theories          school. The school provided        
      abound as to      Shakespeare with his formal        
      the true          education. The students chiefly    
      author of his     studied Latin rhetoric, logic, and 
      plays. The        literature. His knowledge and      
      prime             imagination may have come from his 
      alternative       reading of ancient authors and     
      candidates        poetry. In November 1582,          
      being Sir         Shakespeare received a license to  
      Francis           marry Anne Hathaway. At the time of
      Bacon,            their marriage, Shakespeare was 18 
      Christopher       years old and Anne was 26. They had
      Marlowe, or       three children, the oldest Susanna,
      Edward de         and twins- a boy, Hamneth, and a   
      Vere              girl, Judith. Before his death on
                        April 23 1616, William Shakespeare
                        had written thirty-seven plays. He
                        is generally considered the greatest
                        playwright the world has ever known
                        and has always been the world's most
                        popular author.</code></pre>
<p>To do that, we would have required a call to <code>form</code> like this:</p>
<pre><code>
    print form
        :interleave, &lt;&lt;EOFORMAT,
            Name:             Biography:
              {[[[[[[[[[[[[}    {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}
                                {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
            Status:             {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
              {[[[[[[[[[[[[}    {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
                                {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
            Comments:           {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
              {[[[[[[[[[[[}     {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
            EOFORMAT
        $name,
        $biography,
        $status,
        $comments;</code></pre>
<p>Note that the first line of the Biography field now has to be a block field,
not a single-line field (as in previous versions). It can't be a single-line,
because the Name field is a block field and that would leave a gap in the 
Biography column:</p>
<pre><code>
    Name:             Biography:                            
      William           William Shakespeare was born on    
      Shakespeare       
                        April 23, 1564 in Strathford-upon- 
    Status:             Avon, England; he was third of     
                        etc.</code></pre>
<p>So it has to be a block field, to &quot;keep up&quot; with however much output the
multi-line Name field produces. Unfortunately, starting the Biography column
with a normal block field doesn't solve the problem either. In fact we get:</p>
<pre><code>
    Name:             Biography:                            
      William           William Shakespeare was born on    
      Shakespeare       April 23, 1564 in Strathford-upon- 
                        Avon, England; he was third of     
                        eight children from Father John    
                        Shakespeare and Mother Mary Arden. 
                        Shakespeare began his education at 
                        the age of seven when he probably  
                        attended the Strathford grammar    
                        school. The school provided        
                        Shakespeare with his formal        
                        education. The students chiefly    
                        studied Latin rhetoric, logic, and 
                        literature. His knowledge and      
                        imagination may have come from his 
                        reading of ancient authors and     
                        poetry. In November 1582,          
                        Shakespeare received a license to  
                        marry Anne Hathaway. At the time of
                        their marriage, Shakespeare was 18 
                        years old and Anne was 26. They had
                        three children, the oldest Susanna,
                        and twins- a boy, Hamneth, and a   
                        girl, Judith. Before his death on  
                        April 23 1616, William Shakespeare 
                        had written thirty-seven plays. He 
                        is generally considered the        
                        greatest playwright the world has  
                        ever known and has always been the 
                        world's most popular author.       
                                                           
    Status:                                                
      Deceased (1564                                       
      -1616)                                               
                                                           
    Comments:                                              
      Theories                                             
      abound as to                                         
      the true                                             
      author of his                                        
      plays. The                                           
      prime                                                
      alternative                                          
      candidates                                           
      being Sir                                            
      Francis                                              
      Bacon,                                               
      Christopher                                          
      Marlowe, or                                          
      Edward de                                            
      Vere</code></pre>
<p>Normal block fields are remorseless in consuming all of their data.
So the first Biography field absolutely will not stop formatting, ever,
until your entire <code>$biography</code> string is gone.</p>
<p>What we really need here, is a kinder, gentler block field; a 
block field that formats minimally, like an overflow field.
And we get that with yet another <code>:height</code> option:
<code>:height&laquo;minimal&raquo;</code>. Like so:</p>
<pre><code>
    print form
        :interleave, &lt;&lt;EOFORMAT,
            Name:             Biography:
              {[[[[[[[[[[[[}    {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}
                                {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
            Status:             {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
              {[[[[[[[[[[[[}    {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
                                {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
            Comments:           {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
              {[[[[[[[[[[[}     {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}
            EOFORMAT
         $name,
         :height&laquo;minimal&raquo;, $biography,
         $status,
         $comments;</code></pre>
<p>When this option is applied to a particular field (by placing it
immediately before the field's data), that field only consumes
as much of its data is is required to fill the output lines created by
the other (non-minimal) fields in the same format. In this case, that means
that the first Biography field only extracts as much data from <code>$biography</code>
as is needed to fill the text lines created by the Name field.</p>
<p>Note that any kind of block field can be modified in this way:
justified, numeric, currency, or verbatim.</p>

<h4><a name="now_is_the_jerkin_under_the_line...">Now is the jerkin under the line...</a></h4>
<p>As some of the examples we've seen so far illustrate, formats frequently
consist of a set of column titles, followed by the corresponding columns
of data. And, typically, those column titles are underlined to make them
stand out:</p>
<pre><code>
    print form 
      'Name              Bribe (per dastardry)',
      '=============     =====================',
      '{[[[[[[[[[[[}         {]],]]].[[[}     ',
      @names,                @bribes;</code></pre>
<p>So <code>form</code> has an option that automates that process. For
example, the payments example above could also have been written:</p>
<pre><code>
    print form 
      'Name              Bribe (per dastardry)',
      :under(&quot;=&quot;),
      '{[[[[[[[[[[[}         {]],]]].[[[}     ',
      @names,                @bribes;</code></pre>
<p>The <code>:under</code> option takes a string and uses it to underline the most
recently formatted line. It does this by examining the formats
immediately before and after the <code>:under</code>. It then generates a
series of underlines by repeating the specified underlining string
as many times as required. The underlines are generated such that
every field and every other non-whitespace literal in the preceding
format has a underline under it and every field/non-whitespace in
the next format has an &quot;overline&quot; above it.</p>
<p>For example, this call to <code>form</code>:</p>
<pre><code>
    print form
        '      Rank Name         Serial Number',
        :under(&quot;_&quot;),
        '{]]]]]]]]} {[[[[[[[[[}     {IIIII}',
             @ranks,@names,          @nums;</code></pre>
<p>prints:</p>
<pre><code>
          Rank Name         Serial Number
    __________ ___________  _____________
      Corporal Nym              CMXVII
    Lieutenant Bardolph          CCIV
       Captain Spurio           MMMCDX
       General Pompey             XI</code></pre>
<p>The usual effect is that the auto-generated underlines always
extend to the edges of both the preceding title and the following
field, whichever is wider.</p>
<p>Many people, of course, prefer to draw the underlines themselves, as
the results are then much easier to visualize when looking at the code.
The <code>:under</code> option is most useful when we're constructing tables 
programmatically, with columns and column titles that are only known
at run-time.</p>

<h4><a name="they_come_like_sacrifices_in_their_trim...">They come like sacrifices in their trim...</a></h4>
<p>The default <a href="/pub/a/2004/02/27/exegesis7.html?page=10#he_doth_fill_fields_with_harness...">fill-with-spaces behaviour</a>
of fields is useful to preserve
the vertical alignment of columns within a formatted text, but it could
also potentially increase the size of <code>form</code>'s output unnecessarily.
For example, the following:</p>
<pre><code>
    print form 
        'To Do:',
        '   {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}',
            @todo;</code></pre>
<p>might produce something like:</p>
<pre><code>
    To Do:
       Dissemble                                         
       Deceive                                           
       Dispute                                           
       Defy                                              
       Duel                                              
       Defeat                                            
       Dispatch                                         &nbsp;</code></pre>
<p>That looks fine but, because each line is produced by the large
left-justified field that is automatically filled with whitespace, the
output contains several hundred more space characters than are strictly
necessary (you probably didn't notice them, but they're all there
&ndash; hanging off the right sides of the individual To-Do items).</p>
<p>Fortunately, however, <code>form</code> is smarter than that. Extraneous trailing
whitespace on the right-hand side of any output line is automatically
trimmed. So the above example actually produces:</p>
<pre><code>
    To Do:
       Dissemble
       Deceive
       Dispute
       Defy
       Duel
       Defeat
       Dispatch</code></pre>
<p>Of course, if you really do need those &quot;invisible&quot; trailing whitespaces
for some reason, <code>form</code> provides a way to keep them &ndash; the
<code>:untrimmed</code> option:</p>
<pre><code>
    print form :untrimmed,
        'To Do:',
        '   {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}',
            @todo;</code></pre>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S07.html">Synopsis 7</a> for the current design information.</p>

<h3><a name="master_page,_i_am_glad_to_see_you...">Master Page, I am glad to see you...</a></h3>
<p>Normally, <code>form</code> assumes that whatever data it is formatting is supposed
to produce a single, arbitrarily long, unbroken piece of text. But <code>form</code>
can also format data into multiple pages of fixed length and width,
inserting customized, page-specific headers, footers, and pagefeeds
for each page.</p>
<p>All these features are controlled by the the <code>page</code> option (or more
precisely, by its various suboptions):</p>
<pre><code>
    print form
        :page{ :length( $page_len ),       # Default: 60 lines
               :width( $page_width ),      # Default: 78 columns
               :number( $first_page_num ), # Default: 1
               :header( &amp;make_header ),    # Default: no header
               :footer( &amp;make_footer ),    # Default: no footer
               :feed( &amp;make_pagefeed ),    # Default: no pagefeed
               :body( &amp;adjust_body ),      # Default: no chiropracty
             },
        $format,
        *@args;</code></pre>

<h4><a name="measure_his_woe_the_length_and_breadth_of_mine...">Measure his woe the length and breadth of mine...</a></h4>
<p>The <code>:page{ :length(...) }</code> suboption determines the number of output
lines per page (including headers and footers). Normally,
this suboption is set to infinity, which produces that single, arbitrarily
long, unbroken page of text. But the suboption can be set to any
positive integer value, to cause <code>form</code> to generate distinct
pages of that many lines each.</p>
<p>The value of the <code>:page{ :width(...) }</code> suboption is
used to determine the width of <a href="/pub/a/2004/02/27/exegesis7.html?page=9#and_every_one_shall_share...">distributive fields</a> and
in some <a href="/pub/a/2004/02/27/exegesis7.html?page=12#do_to_this_body_what_extremes_you_can...">page body postprocessors</a>.
By default, this suboption is set to 78 (columns), but it may
be set to any positive integer value.</p>
<p>The <code>:page{ :number(...) }</code> suboption specifies the current page number.
By default it starts at 1, but may be set to any numeric value.
This suboption is generally only of use in headers and footers (see below).</p>

<h4><a name="from_the_crown_of_his_head_to_the_sole_of_his_foot...">From the crown of his head to the sole of his foot...</a></h4>
<p>The <code>:page{ :header(...) }</code> suboption specifies a hash containing 
a set of strings or subroutines that are to be used to create page headers.
Each key of the hash indicates a particular kind of page that the
corresponding value will provide the header for. For example:</p>
<pre><code>
    :header{ first =&gt; &quot;           'The Tempest' by W. Shakespeare          &quot;,
             last  =&gt; &quot;                   -- The End --                    &quot;,
             odd   =&gt; &quot;Act $act, Scene $scene                              &quot;,
             even  =&gt; &quot;                                                    &quot;,
             other =&gt; &quot;          [Thys hedder intenshunally blanke]        &quot;,
           }</code></pre>
<p>Given the above specification, <code>form</code> will:</p>
<ul>
<li>
use the full title and author as the header of the first page,
</li>
<li>
write <code>&quot;-- The End --&quot;</code> across the top of the last page,
</li>
<li>
prepend the act and scene information to the start of any odd page
(except, of course, the first or the last), and
</li>
<li>
provide an empty line as the header of any even page (except the last,
if it happens to be even).</li>
</ul>
<p>Note that, in this case, since we've provided specific headers for every
odd and even page, the <code>&quot;other&quot;</code> header will never be used. On the other
hand, if we'd specified:</p>
<pre><code>
    :header{ first =&gt; &quot;           'The Tempest' by W. Shakespeare          &quot;,
             other =&gt; &quot;                                       'The Tempest'&quot;,
           }</code></pre>
<p>then every page except the first would have just a right-justified title at
the top.</p>
<p>Of course, if we want every page to have the same header, we can just write:</p>
<pre><code>
    :header{ other =&gt; &quot;                                       'The Tempest'&quot;}</code></pre>
<p>But that's a little klunky, so <code>form</code> also accepts a single string instead of
a hash, to specify a header to be used for every page:</p>
<pre><code>
    :header(&quot;                                       'The Tempest'&quot;)</code></pre>
<p>Headers don't all have to be the same size either. For example, we might
prefer a more imposing first header:</p>
<pre><code>
    :header{ first =&gt; &quot;                  'The Tempest'                   \n&quot;
                    ~ &quot;                        by                        \n&quot;
                    ~ &quot;                  W. Shakespeare                  \n&quot;
                    ~ &quot;____________________________________________________&quot;,</code></pre>
<pre><code>
             other =&gt; &quot;                                       'The Tempest'&quot;,
           }</code></pre>
<p><code>form</code> simply notes the number of lines each header requires and then
reduces the available number of lines within the page accordingly,
so as to preserve the exact overall page length.</p>
<p>Often we'll need headers that aren't fixed strings. For example, we might
want each page to include the appropriate page number. So instead of a string,
we're allowed to specify a particular header as a subroutine. That subroutine
is then called each time that particular header is required, and its return
value is used as the required header.</p>
<p>When the subroutine is called, the current set of active formatting
options are passed to it as a list of pairs. Typically, then, the
subroutine will specify one or more named-only parameters corresponding
to the options it cares about, followed by a starred hash parameter to
collect the rest. For example if every page should have its
(left-justified) page number for a header:</p>
<pre><code>
    :header( sub (+$page, *%_) { return $page{number}; } )</code></pre>
<p>Of course, this is also an excellent candidate for the cleaner (but
equivalent) syntax of placeholder variables in raw blocks:</p>
<pre><code>
    :header{ $^page{number}; }</code></pre>
<p>And, naturally, we can mix-and-match static and dynamic headers:</p>
<pre><code>
    :header{ odd  =&gt; &quot;                                        'The Tempest'&quot;,
             even =&gt; { $^page{number}; },
           }</code></pre>
<p>Footers work in exactly the same way in almost all respects; the obvious
exception being that they're placed at the end of a page, rather than the
start.</p>
<p>Pagefeeds work the same way too. A pagefeed is a string that is placed
between the footer of one page and the header of the next. They're like
formfeeds, except they can be any string we choose (not just <code>\c[FF]</code>).
They're called &quot;pagefeeds&quot; instead of &quot;formfeeds&quot; because they're
placed between pages, not between calls to <code>form</code>.</p>
<p>Here's a complete example to illustrate the full set of features:</p>
<pre><code>
    my @tobe = slurp 'Soliloquy.txt'  err die;</code></pre>
<pre><code>
    my %page = (
        :length(15),
        :header{ first =&gt; &quot;Hamlet's soliloquy begins...\n\n&quot;,
                 odd   =&gt; &quot;Hamlet's soliloquy continues...\n\n&quot;,
                 even  =&gt; { form '{&gt;&gt;{*}&gt;&gt;}', &quot;Hamlet's soliloquy continues...\n\n&quot;; },
                 last  =&gt; &quot;Hamlet's soliloquy concludes...\n\n&quot;,
               },
        :footer{
                 last  =&gt; { form &quot;\n{||{*}||}&quot;, &quot;END OF TEXT&quot;; }
                 other =&gt; { form &quot;\n{&gt;&gt;{*}&gt;&gt;}&quot;, &quot;../&quot;~($^page{number}+1); },
               },
        :feed(&quot;\f&quot;),
    );</code></pre>
<pre><code>
    print form
        :page(%page),
        '{]]]]]}  {&quot;{*}&quot;}  {[[[[[}',
        [1..@tobe], @tobe,  [1..@tobe];</code></pre>
<p>which prints:</p>
<pre><code>
    Hamlet's soliloquy begins...</code></pre>
<pre><code>
          1  To be, or not to be -- that is the question:          1
          2  Whether 'tis nobler in the mind to suffer             2
          3  The slings and arrows of outrageous fortune           3
          4  Or to take arms against a sea of troubles             4
          5  And by opposing end them. To die, to sleep --         5
          6  No more -- and by a sleep to say we end               6
          7  The heartache, and the thousand natural shocks        7
          8  That flesh is heir to. 'Tis a consummation            8
          9  Devoutly to be wished. To die, to sleep --            9
         10  To sleep -- perchance to dream: ay, there's the rub,  10
         11  For in that sleep of death what dreams may come       11</code></pre>
<pre><code>
                                                                      ../2
    ^L
                                           Hamlet's soliloquy continues...</code></pre>
<pre><code>
         12  When we have shuffled off this mortal coil,           12
         13  Must give us pause. There's the respect               13
         14  That makes calamity of so long life.                  14
         15  For who would bear the whips and scorns of time,      15
         16  Th' oppressor's wrong, the proud man's contumely      16
         17  The pangs of despised love, the law's delay,          17
         18  The insolence of office, and the spurns               18
         19  That patient merit of th' unworthy takes,             19
         20  When he himself might his quietus make                20
         21  With a bare bodkin? Who would fardels bear,           21
         22  To grunt and sweat under a weary life,                22</code></pre>
<pre><code>
                                                                      ../3
    ^L
    Hamlet's soliloquy continues...</code></pre>
<pre><code>
         23  But that the dread of something after death,          23
         24  The undiscovered country, from whose bourn            24
         25  No traveller returns, puzzles the will,               25
         26  And makes us rather bear those ills we have           26
         27  Than fly to others that we know not of?               27
         28  Thus conscience does make cowards of us all,          28
         29  And thus the native hue of resolution                 29
         30  Is sicklied o'er with the pale cast of thought,       30
         31  And enterprise of great pitch and moment              31
         32  With this regard their currents turn awry             32
         33  And lose the name of action. -- Soft you now,         33</code></pre>
<pre><code>
                                                                      ../4
    ^L
    Hamlet's soliloquy concludes...</code></pre>
<pre><code>
         34  The fair Ophelia! -- Nymph, in thy orisons            34
         35  Be all my sins remembered.                            35
              
              
              
              
              
              
              
              
              
              
                                 END OF TEXT
    ^L</code></pre>
<p>Note, in particular, the nested calls to <code>form</code> within some of the
subroutines &ndash; to center or right-justify a particular header or footer.
Permitting just this kind of &quot;recursive&quot; formatting is one of the main
reasons Perl 5's built-in <code>format</code> has become the (reentrant) <code>form</code>
subroutine in Perl 6.</p>

<h4><a name="do_to_this_body_what_extremes_you_can...">Do to this body what extremes you can...</a></h4>
<p>Sometimes it's useful to be able to grab the entire body of a page
(i.e. the contents of the page between the header and footer)
<em>after</em> it's been formatted together. For example, we might wish to
centre those contents, or to crop them at a particular column.</p>
<p>To this end, the <code>:page{ :body(...) }</code> suboption allows us to specify
a page body post-processor. That is, a subroutine or format that
lays out the page's formatted text between the page's header and footer.
Like the <code>:header</code>, <code>:footer</code>, and <code>:feed</code> suboptions, the
<code>:body</code> suboption can take either a closure, a hash, or a string.</p>
<p>If the value of the <code>:body</code> suboption is a string or a hash of
pairs, the text of the body is (recursively) <code>form</code>'ed using that
string (or those string values) as its format. A very common usage is to
arrange for the formatted text to be horizonally and vertically
centred on each page:</p>
<pre><code>
    :body('{=I{*}I=}')</code></pre>
<p>A more sophisticated variation on this is to use a hash to insert a
left or right &quot;gutter&quot; for each page:</p>
<pre><code>
    $gutter = &quot; &quot; x $gutter_width;</code></pre>
<pre><code>
    :body{ odd   =&gt;  $gutter ~ '{&quot;&quot;&quot;{*}&quot;&quot;&quot;}',
           even  =&gt;  '{&quot;&quot;&quot;{*}&quot;&quot;&quot;}' ~ $gutter,
         }</code></pre>
<p>On the other hand, if the value of the <code>:body</code> suboption is closure,
the body text is passed to that closure as an array of lines. A
second array is also passed in, containing as many newlines as would
be needed to pad out the body text to the correct number of lines
for the page. Finally, the current formatting options are passed as
a list of pairs. As with the <code>:header</code> etc. suboption, the closure
is expected to return a single string (representing the final
formatting of the page body).</p>
<p>For example, to add line numbers to the text each page (but <em>not</em>
to the headers or footers or filler lines):</p>
<pre><code>
    sub numerate (@lines, @fill, +$page, *%_) {</code></pre>
<pre><code>
        # Remember line numbers from call to call...
        state $linenum = 1;
    
        # Compute range of line numbers
        my @linenums = ($linenum .. $linenum+@lines-1);</code></pre>
<pre><code>
        # Reformat body lines verbatim,
        # with a left-justified line number before each...
        my $body = form '{[[[[} {&quot;&quot;&quot;{*}&quot;&quot;&quot;}',
                         @linenums, @lines,
                        *@fill;</code></pre>
<pre><code>
        # Update the final line number and return the new body text...
        $linenum += @lines;
        return $body;
    }</code></pre>
<pre><code>
    print form
        :page{ :body(&amp;numerate),
               :header(&quot;\n==========\n\n&quot;),
               :length(12),
             },
        # Left-justify the Briton...
        &quot;{[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}&quot;,
        %soliloquy{RichardIII},
                         # Right-justify the Dane...
        &quot;                 {]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]}&quot;,
                          %soliloquy{Hamlet};</code></pre>
<p>which produces:</p>
<pre><code>
    ==========
                
    1      Now is the winter of our discontent /  
    2      Made glorious summer by this sun of    
    3      York; / And all the clouds that lour'd 
    4      upon our house / In the deep bosom of  
    5      the ocean buried. / Now are our brows  
    6      bound with victorious wreaths; / Our   
    7      bruised arms hung up for monuments; /  
    8      Our stern alarums changed to merry     
    9      meetings, / Our dreadful marches to    
                
    ==========
                
    10     delightful measures. Grim-visaged war  
    11     hath smooth'd his wrinkled front; / And
    12     now, instead of mounting barded steeds 
    13     / To fright the souls of fearful       
    14     adversaries, / He capers nimbly in a   
    15     lady's chamber.                        
                
                
                
                
    ==========
                
    16                      To be, or not to be -- that is the question: /
    17                         Whether 'tis nobler in the mind to suffer /
    18                       The slings and arrows of outrageous fortune /
    19                         Or to take arms against a sea of troubles /
    20                       And by opposing end them. To die, to sleep --
    21                         / No more -- and by a sleep to say we end /
    22                      The heartache, and the thousand natural shocks
    23                      / That flesh is heir to. 'Tis a consummation /
    24                        Devoutly to be wished. To die, to sleep -- /
                
    ==========
                
    25                         To sleep -- perchance to dream: ay, there's
    26                          the rub, / For in that sleep of death what
    27                         dreams may come / When we have shuffled off
    28                             this mortal coil, / Must give us pause.
    29                        There's the respect / That makes calamity of
    30                                                       so long life.
                   
                   
                   
                   
                   
                   
                   &nbsp;</code></pre>














<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S07.html">Synopsis 7</a> for the current design information.</p>

<h3><a name="define,_define,_welleducated_infant.">Define, define, well-educated infant.</a></h3>
<p>Laziness is, of course, a major virtue. And one of the Laziest
approaches to programming is never to repeat oneself. Which is why Perl
6 has subroutines and macros and classes and constants and dozens of
other ways for us to factor out commonalities.</p>
<p>Occasionally, the same need for factoring arises in formatting. For
example, suppose we want a field that masks its data in some way.
Perhaps a field that blanks out certain words by replacing them with the
corresponding number of X's.</p>
<p>We could always do that by writing a subroutine that generates the
appropriate filter:</p>
<pre><code>
    sub expurgate (Str *@hidewords) {
        return sub (Str $data is rw) {
            $data ~~ s:ei/(@hidewords)/$( 'X' x length $1 )/;
            return $data;
        }
    }</code></pre>
<p>We could then apply that subroutine to the data of any field that needed
bowdlerization:</p>
<pre><code>
    my &amp;censor := expurgate &laquo;villain plot libel treacherous murderer false deadly 'G'&raquo;;</code></pre>
<pre><code>
    print form
        &quot;[Ye following tranfcript hath been cenfored by Order of ye King]\n\n&quot;,
        &quot;         {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}&quot;,
                  censor($speech);</code></pre>
<p>to produce:</p>
<pre><code>
    [Ye following tranfcript hath been cenfored by Order of ye King]</code></pre>
<pre><code>
             And therefore, since I cannot prove a lover,  
             To entertain these fair well-spoken days,     
             I am determined to prove a XXXXXXX            
             And hate the idle pleasures of these days.    
             XXXXs have I laid, inductions dangerous,      
             By drunken prophecies, XXXXXs and dreams,     
             To set my brother Clarence and the king       
             In XXXXXX hate the one against the other:     
             And if King Edward be as true and just        
             As I am subtle, XXXXX and XXXXXXXXXXX,        
             This day should Clarence closely be mew'd up, 
             About a prophecy, which says that XXX         
             Of Edward's heirs the XXXXXXXX shall be.</code></pre>
<p>Of course, if this were Puritanism and not Perl, we might have a long
list of proscribed words that we needed to excise from <em>every</em> formatted text.
In that case, rather that explicitly running every data
source through the same censorious subroutine, it would be handy if <code>form</code>
had a built-in field that did that for us automatically.</p>
<p>Naturally, <code>form</code> doesn't have such a field built-in...but we
can certainly give it one.</p>
<p>User-defined field specifiers can be declared using the <code>:field</code> option,
which takes as its value an array of pairs. The key of each pair
is a string or a rule (i.e. regex) that specifies the syntax of the
user-defined field. The value of each pair is a closure/subroutine that
constructs a standard field specifier to replace the user-defined
specifier. Alternatively, the value of a pair may be a string, which is
taken as the (static) field specifier to be used instead of the
user-defined field.</p>
<p>In other words, each pair is a macro that maps a user-defined field
(specified by the pair's key) onto a standard <code>form</code> field (specified by
the pair's value). For example:</p>
<pre><code>
    :field[ /\{ X+ \}/ =&gt; &amp;censor_field ]</code></pre>
<p>This tells <code>form</code> that whenever it finds a brace-delimited field consisting
of one or more X's, it should call a subroutine named <code>censor_field</code> and
use the return value of that call instead of the all-X field.</p>
<p>When the key of a <code>:field</code> pair matches some part of a format,
its corresponding subroutine is called. That subroutine is passed
the result (i.e. <code>$0</code>) of the rule
match, as well as the hash of active options for that field. Changes
to the options hash will affect the subsequent formatting behaviour of
that field.</p>
<p>So <code>censor_field</code> could be implemented like so:</p>
<pre><code>
        # Constructor subroutine for user-defined censor fields...
        sub censor_field ($field_spec, %opts) {</code></pre>
<pre><code>
            # Set up the field's 'break' option with a censorious break...
            %opts{break} = break_and_censor(%opts{break});</code></pre>
<pre><code>
            # Construct a left-justified field with the appropriate width
            # specified imperatively...
            return '{[[{' ~ length($field_spec) ~ '}[[}';
        }</code></pre>
<p>The <code>censor_field</code> subroutine has to change the field's <code>:break</code>
option, creating a new line breaker that also expurgates unsuitable
words. To do this it calls <code>break_and_censor</code>, which returns a new line
breaker subroutine:</p>
<pre><code>
        # Create a new 'break' sub...
        sub break_and_censor (&amp;original_breaker) {
            return sub (*@args) {</code></pre>
<pre><code>
                # Call the field's original 'break' sub...
                my ($nextline, $more) = original_breaker(*@args);</code></pre>
<pre><code>
                # X out any doubleplus ungood words
                $nextline ~~ s:ei/(@proscribed)/$( 'X' x length $1 )/;</code></pre>
<pre><code>
                # Return the &quot;corrected&quot; version...
                return ($nextline, $more);
            }
        }</code></pre>
<p>Having created a subroutine to translate censor fields and another to
break-and-expurgate the data placed in them, we are now in a position
to create a module that encapsulates the new formatting functionality:</p>
<pre><code>
    module Ministry::Of::Truth {</code></pre>
<pre><code>
        # Internal mechanism (as above)...
        my @proscribed = &laquo;villain plot libel treacherous murderer false deadly 'G'&raquo;;
        sub break_and_censor (&amp;original_breaker) {...}
        sub censor_field ($field_spec, %opts) {...}</code></pre>
<pre><code>
        # Make the new field type standard by default in this scope...
        use Form :field[ /\{ X+ \}/ =&gt; &amp;censor_field ];</code></pre>
<pre><code>
        # Re-export the specialized &amp;form that was imported above...  
        sub form is exported {...}</code></pre>
<pre><code>
    }</code></pre>
<p>Okay, admittedly that's quite a lot of work. But the pay-off is huge: we can now
trample on free speech <em>much</em> more easily:</p>
<pre><code>
    use Ministry::Of::Truth;</code></pre>
<pre><code>
    print form 
        &quot;[Ye following tranfcript hath been cenfored by Order of ye King]\n\n&quot;,
        &quot;        {XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX}&quot;,
                  $speech;</code></pre>
<p>And we'd get the same carefully XXXX'ed output as before.</p>

<h4><a name="put_thyself_into_the_trick_of_singularity...">Put thyself into the trick of singularity...</a></h4>
<p>User-defined fields are also a handy way to create single-character
markers for single-column fields (in order to preserve the
one-to-one spacing of a format). For example:</p>
<pre><code>
    print form
        :field{ '^' =&gt; '{&lt;III{1}III}',   # 1-char-wide, top-justified block
                '=' =&gt; '{&lt;=II{1}II=}',   # 1-char-wide, middle-justified block
                '_' =&gt; '{&lt;_II{1}II_}',   # 1-char-wide, bottom-justified block
              },
        '~~~~~~~~~',
        '^ _ = _ ^',   *&laquo;like round and orient perls&raquo;,
        '~~~~~~~~~';</code></pre>
<p>prints:</p>
<pre><code>
    ~~~~~~~~~
    l     o p
    i r a r e
    k o n i r
    e u d e l
      n   n s
      d   t  
    ~~~~~~~~~</code></pre>
<p>Note that we needed to use a unary <code>*</code> to flatten the <code>&laquo;like&nbsp;round&nbsp;and&nbsp;orient&nbsp;perls&raquo;</code>
data list. That's because every argument of <code>form</code> is evaluated in scalar
context, and an unflattened <code>&laquo;...&raquo;</code> list in scalar context
becomes an array reference, rather than the five separate strings we needed
to fill our five single-character fields.</p>
<p>Single fields are particularly useful for labelling the vertical axes of a
graph:</p>
<pre><code>
    use Form :field[ '=' =&gt; '{&lt;=II{1}II=}' ];</code></pre>
<pre><code>
    @vert_label = &laquo;Villain's fortunes&raquo;
    $hor_label  = &quot;Time&quot;;</code></pre>
<pre><code>
    print form 
       '     ^                                        ',
       ' = = | {&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;} ', *@vert_label, @data,
       '     +---------------------------------------&gt;',
       '      {|||||||||||||||||||||||||||||||||||||} ', $hor_label;</code></pre>
<p>which produces:</p>
<pre><code>
         ^                                        
         |                                        
     V   |       *                                
     i f |     *   *                              
     l o |    *     *                             
     l r |                                        
     a t |   *       *                            
     i u |                                        
     n n |  *         *                           
     ' e |                                        
     s s |                                        
         |                                        
         | *           *                          
         +---------------------------------------&gt;
                           Time</code></pre>
<p>Specifying these kinds of single-character block markers is perhaps the
commonest use of user-defined fields. But the:</p>
<pre><code>
    :field[ '=' =&gt; '{&lt;=II{1}II=}' ]</code></pre>
<p>syntax is uncomfortably verbose for that purpose. So calls to
<code>form</code> can also accept a short-hand notation to define a
single-character field:</p>
<pre><code>
    :single('=')</code></pre>
<p>or to define several at once:</p>
<pre><code>
    :single['#', '*', '+']</code></pre>
<p>The <code>:single</code> option does exactly the same thing as the <code>:field</code> options
shown above. It takes a single-character string, or a reference
to an array of such strings, as its value. It then turns each of those
strings into a single-column field marker. If the character is <code>'='</code>
then the field is vertically &quot;middled&quot; within its block. If the
character is <code>'_'</code> then the field is &quot;bottomed&quot; within its block. If
the single character is anything else, the resulting block is top-justified.
So our previous example could also have been written:</p>
<pre><code>
    print form
        :single(&quot;=&quot;),
        '     ^                                        ',
        ' = = | {&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;} ', *@vert_label, @data,
        '     +---------------------------------------&gt;',
        '      {|||||||||||||||||||||||||||||||||||||} ', $hor_label;</code></pre>



<h3><a name="these_paper_bullets_of_the_brain...">These paper bullets of the brain...</a></h3>
<p>Bulleted lists of items are a very common feature of reports, but as we saw
<a href="/pub/a/2004/02/27/exegesis7.html?page=3#therefore,_put_you_in_your_best_array...">earlier</a> they're surprisingly
hard to get right.</p>
<p>Suppose, for example, we want a list of items bulleted by &quot;diamonds&quot;:</p>
<pre><code>
    &lt;&gt; A rubber sword (laminated with mylar to
       look suitably shiny).                   
    &lt;&gt; Cotton tights (summer performances).   
    &lt;&gt; Woolen tights (winter performances or  
       those actors who are willing to admit
       to being over 65 years of age).                 
    &lt;&gt; Talcum powder.                         
    &lt;&gt; Codpieces (assorted sizes).            
    &lt;&gt; Singlet.                               
    &lt;&gt; Double.                                
    &lt;&gt; Triplet (Kings and Emperors only).     
    &lt;&gt; Supercilious attitude (optional).</code></pre>
<p>Something like this works well enough:</p>
<pre><code>
    for @items -&gt; $item {
        print form
            '&lt;&gt; {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}', $item;
            '   {VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV}';
    }</code></pre>
<p>The first format produces the bullet plus the first line of text for the item,
then the second format handles any overflow of the item data.</p>
<p>Alternatively, we could achieve the same result with a single format string
by interpolating the bullet as well:</p>
<pre><code>
    my $bullet = &quot;&lt;&gt;&quot;;</code></pre>
<pre><code>
    for @items -&gt; $item {
        print form
            &quot;{''{*}''} {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}&quot;,
             $bullet,  $item;
    }</code></pre>
<p>Here we use a single-line starred verbatim field (<code>{''{*}''}</code>),
so that the bullet is interpolated &quot;as-is&quot; and the field
is only as wide as the bullet itself.
Then for the item itself we use a block field, which will format the item
data over as many lines as necessary. Meanwhile, because the bullet's
field is single-line, after the first line the bullet field will be
filled with spaces (instead of a &quot;diamond&quot;), leaving a bullet only on
the first line.</p>
<p>This second approach also has the advantage that we could change the bullet
string at run-time and the format would adapt automatically.</p>
<p>However, it's still a little irritating that we have to set up a loop and
call <code>form</code> separately for each element of <code>@items</code>. After all, if we
didn't need to bullet our list we could just write:</p>
<pre><code>
    print form
        &quot;{[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}&quot;,
        @items;</code></pre>
<p>and <code>form</code> would take care of iterating over the <code>@items</code> for us. It
seems that things ought to be that easy for bulleted lists as well.</p>
<p>And, of course, things <em>are</em> that easy.</p>
<p>All we need to do is tell <code>form</code> that whenever the string <code>&quot;&lt;&gt;&quot;</code>
appears in a format, it should be treated as a bullet. That is, it should
appear only beside the <em>first</em> line of text produced when formatting each
element of the adjacent field's data.</p>
<p>To tell <code>form</code> all that we use the <code>:bullet</code> option:</p>
<pre><code>
    print form
        :bullet(&quot;&lt;&gt;&quot;),
        &quot;&lt;&gt; {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}&quot;,
            @items;</code></pre>
<p>or, more permanently:</p>
<pre><code>
    use Form :bullet(&quot;&lt;&gt;&quot;);</code></pre>
<pre><code>
    # and later...</code></pre>
<pre><code>
    print form
        &quot;&lt;&gt; {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}&quot;,
            @items;</code></pre>
<p>The presence of this <code>:bullet</code> option causes <code>form</code> to treat the sequence
<code>&quot;&lt;&gt;&quot;</code> as a special field. That special field interpolates the 
string <code>&quot;&lt;&gt;&quot;</code> when the field immediately to its right begins to
format a new data element, but thereafter interpolates only spaces until
the adjacent field finishes formatting that data element.</p>
<p>Or, more simply, if we tell <code>form</code> that  <code>&quot;&lt;&gt;&quot;</code> is a bullet,
<code>form</code> treats it like a bullet that's attached to the very next field.</p>
<p>So we could finally fix our <a href="/pub/a/2004/02/27/exegesis7.html?page=3#therefore,_put_you_in_your_best_array...">Shakespearean roles example</a>, like so:</p>
<pre><code>
    print &quot;The best Shakespearean roles are:\n\n&quot;;</code></pre>
<pre><code>
    print form
        :bullet(&quot;* &quot;),
        &quot;   * {[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[}   *{[[[[[[[[]]]]]]]]}*&quot;,
              @roles,                                 $disclaimer;</code></pre>
<p>This would then produce:</p>
<pre><code>
   The best Shakespearean roles are:</code></pre>
<pre><code>
      * Either of the 'two foolish             *WARNING:          *
        officers': Dogberry and Verges         *This list of roles*
      * That dour Scot, the Laird              *constitutes      a*
        Macbeth                                *personal   opinion*
      * The tragic Moor of Venice,             *only and is in  no*
        Othello                                *way  endorsed   by*
      * Rosencrantz's good buddy               *Shakespeare'R'Us. *
        Guildenstern                           *It   may   contain*
      * The hideous and malevolent             *nuts.             *
        Richard III                            *                  *</code></pre>
<p>Notice too that the asterisks on either side of the disclaimer <em>aren't</em>
treated as bullets. That's because we defined a bullet to be <code>&quot;* &quot;</code>, and
neither of the disclaimer asterisks has a space after it.</p>
<p>Bullets can be any string we like, and there can be more than one of them
in a single format. For example:</p>
<pre><code>
    print form
        :bullet('+'),
        &quot;+ {[[[[[[[[[[[[[[[[[[[&hellip;}       + {&hellip;[[[[[[[[[[[[[[[[[[[}&quot;,
            @items,                         @items;</code></pre>
<p>would print:</p>
<pre><code>
    + A rubber sword,                65 years of age).     
      laminated with mylar         + Talcum powder.        
      to look suitably             + Codpieces (assorted   
      shiny.                         sizes).               
    + Cotton tights (summer        + Singlet.              
      performances).               + Double.               
    + Woolen tights (winter        + Triplet (Kings and    
      performances or those          Emperors only).       
      actors who are willing       + Supercilious attitude 
      to admit to being over         (optional).</code></pre>
<p>We can even change bullets in mid-<code>form</code>, which is useful for 
multi-level bulleting. Of course, in that case we're going
to need a loop again, since <code>form</code> itself has only
one level of intrinsic looping:</p>
<pre><code>
    %categories = (
       Animal    =&gt; [&quot;The mighty destrider, ship of the knight&quot;,
                     &quot;The patient cat, warden of the granary&quot;,
                     &quot;Our beloved king, whom we shall soon have to kill&quot;],
       Vegetable =&gt; [&quot;The lovely peony, garland of Eddore&quot;,
                     &quot;The mighty oak, from which tiny acorns grow&quot;,
                     &quot;The humble cabbage, both food and metaphor for the fool&quot;],
       Mineral   =&gt; [&quot;Gold, for which men thirst&quot;,
                     &quot;Salt, by which men thirst&quot;,
                     &quot;Sand, on which men thirst&quot;],
    );</code></pre>
<pre><code>
    for %categories.kv -&gt; $category, @examples {
        print form
            :bullet('*'),  &quot;* {&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;}&quot;,  $category,
            :bullet('-'),  &quot;    - {[[[[[[[[[[[[[[[[[[[[[[[[}&quot;,  @examples;
    }</code></pre>
<p>This would produce:</p>
<pre><code>
    * Mineral                       
        - Gold, for which men thirst
        - Salt, by which men thirst 
        - Sand, on which men thirst 
    * Animal                        
        - The mighty destrider, ship
          of the knight             
        - The patient cat, warden of
          the granary               
        - Our beloved king, whom we 
          shall soon have to kill   
    * Vegetable                     
        - The lovely peony, garland 
          of Eddore                 
        - The mighty oak, from which
          tiny acorns grow          
        - The humble cabbage, both  
          food and metaphor for the 
          fool</code></pre>

<hr />
<h3><a name="all's_well_that_ends...">All's well that ends...</a></h3>
<p>Report generation was one of Perl's original <em>raisons d'etre</em>. Over the
years we've found out what <code>format</code> does well, and where its
limitations lurk. The new Perl 6 <code>form</code> function aims to preserve
<code>format</code>'s simple approach to report generation and build on its strengths
by adding:</p>
<ul>
<li>
independence from the I/O system;
</li>
<li>
run-time specifiable format strings;
</li>
<li>
a wider range of useful field types, including fully justified, verbatim,
and overflow fields;
</li>
<li>
the ability to define new field types;
</li>
<li>
sophisticated formatting of numeric/currency data;
</li>
<li>
declarative, imperative, distributive, and extensible field widths;
</li>
<li>
more flexible control of headers, footers, and page layout;
</li>
<li>
control over line-breaking, whitespace squeezing, and
filling of empty fields; and
</li>
<li>
support for creating plaintext lists, tables, and graphs.
</li></ul>
<p>And because it's now part of a module, rather than a core component,
<code>form</code> will be able to evolve more easily to meet the needs of its
community. For example, we are currently investigating how we might
add facilities for specifying numerical bullets, for formatting
text using variable-width fonts, and for outputting HTML instead
of plaintext.</p>
<p>If you're a regular user of Perl 5's <code>format</code> you might like to try the
<code>form</code> function instead. It's available right now in the Perl6::Form
module, which waits upon thy pleasure at the CPAN.
</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-886" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/02/p6pdigest/20040222.html" rel="bookmark">This week on Perl 6, week ending 2004-02-22</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-02-22T00:00:00-08:00">February 22, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p></p>
<h4><a name="Loading_bytecode_at_runtime">Loading bytecode

 at runtime</a></h4>

<p>Last week Dan had specced out the rules for runtime loading of bytecode.
This week,
Leo T&#246;tsch started implementing it.
There was a certain amount of quibbling about syntax,
but that was quickly sorted out.</p>

<p><a href='http://groups.google.com/groups?selm=200402200842.i1K8g4F15344@thu8.leo.home'>http://groups.google.com/</a></p>

<h4><a name="Objects">Objects</a></h4>

<p>Dan continued his work on objects and on sorting out method resolution niggles.
Getting ahead of myself slightly,
he finished it this week.</p>

<p><a href='http://groups.google.com/groups?selm=a06010208bc581095417f@[172.24.18.98]'>http://groups.google.com/</a></p>

<h4><a name="Obfuscated_Parrot">Obfuscated Parrot</a></h4>

<p>I reproduce this product of Leo T&#246;tsch&#39;s warped brane without comment:</p>

<pre><code>     bounds 1
     trace 0
     split P0, &#39;&#39;, &#34;\nrekcaH torraP rehtona tsuJ&#34;
     add I1, 3
     add I2, 4
     branch I2
     pack S23, 793, I1, I0
     branch I2
     add I2, 382, I1
     branch I2
     new S23, 911, I0, I0
     branch I1
     transcode S23, S0, &#45;19
     end</code></pre>

<p>And, to compound things:</p>

<pre><code>    bounds 1
    trace 0
    newclass P0, &#34;Just another Parrot Hacker\n&#34;
    shift S0, P5
    does I0, P0, S0
    add I0, 4
    bsr I0
    pack S0, 381, I0, I0
    invoke
    ret</code></pre>

<p>Look, OO badness</p>

<p><a href='http://groups.google.com/groups?selm=40309141.1030003@toetsch.at'>http://groups.google.com/</a></p>

<p><a href='http://groups.google.com/groups?selm=200402161324.i1GDOgu07546@thu8.leo.home'>http://groups.google.com/</a></p>

<h4><a name="IO_fixes_for_Win32">IO fixes for Win32</a></h4>

<p>I must confess I didn&#39;t understand the details of the discussion, but Goplat, Vladimir Lipsky and Melvin Smith spent some time working on IO issues under Win32.</p>

<p><a href='http://groups.google.com/groups?selm=20040216191018.52351.qmail@web20809.mail.yahoo.com'>http://groups.google.com/</a></p>

<h4><a name="Parrot_Dumper_updated">Parrot Dumper updated</a></h4>

<p>Jens Rieks continued his sterling work on a Parrot Data::Dumper equivalent, posting a new version that does bounds checking and PMC property dumping. A later refinement added support for self referential data structures and other edge cases.</p>

<p><a href='http://groups.google.com/groups?selm=200402161908.40001.parrot@jensbeimsurfen.de'>http://groups.google.com/</a></p>

<h4><a name="ConfigScript3">ConfigScript3</a></h4>

<p>TOGoS announced a new language targetting Parrot.</p>

<p><a href='http://groups.google.com/groups?selm=20040217011132.40119.qmail@web41411.mail.yahoo.com'>http://groups.google.com/</a></p>

<p><a href='http://togos.dhs.org/projects/configscript3/'>http://togos.dhs.org/projects/configscript3/</a></p>

<h4><a name="Symbol_naming_and_IMCC2">Symbol naming and IMCC2</a></h4>
<csperl file="grab" domain="on" record="b/940" template="b/article_sidebar.view">
<p>Dan ruled on the symbol naming issue discussion. Essentially, if your symbol includes a sigil, you&#39;re not going to be able to use it directly. Learn to love symbol tables and <code lang='und' xml:lang='und'>.alias</code>.</p>

<p><a href='http://groups.google.com/groups?selm=a06010209bc58266e6075@[172.24.18.98]'>http://groups.google.com/</a></p>

<h4><a name="TODO:_parrotbug">TODO: <code lang='und' xml:lang='und'>parrotbug</code></a></h4>

<p>Dan asked for someone to implement a <code lang='und' xml:lang='und'>parrotbug</code> script to handle building and possibly sending the bug reports into RT. The script should work in a similar way to perlbug, appending configuration information etc to any bug report.</p>

<p><a href='http://groups.google.com/groups?selm=a0601020cbc5838c4acab@[172.24.18.98]'>http://groups.google.com/</a></p>

<h4><a name="TODO:_Forth_as_a_compiler">TODO: Forth as a compiler</a></h4>

<p>Dan asked for a volunteer to fix <em lang='und' xml:lang='und'>forth.pasm</em> so that it can be loaded in as a compiler module, allowing one to do:</p>

<pre><code>    compile P5, ForthCompiler, &#34;1 2 + .&#34;</code></pre>

<p>and have it print out 3.</p>

<p><a href='http://groups.google.com/groups?selm=a06010201bc5a61a7ddc0@[10.0.1.2]'>http://groups.google.com/</a></p>

<h4><a name="Documentation_tasks">Documentation tasks</a></h4>

<p>Taking time out to heap praise on the deserving Michael Scott, Dan outlined a few documentation jobs that need to be done (hopefully) before the next Parrot release.</p>

<p><a href='http://groups.google.com/groups?selm=a06010207bc5a93a41f3d@[10.0.1.2]'>http://groups.google.com/</a></p>

<h4><a name="SDL_goodness">SDL goodness</a></h4>

<p>The work on SDL support continued apace, with chromatic checking in several SDL related fixes and enhancements.</p>

<p><a href='http://groups.google.com/groups?selm=1077165919.24319.72.camel@localhost'>http://groups.google.com/</a></p>

<p><a href='http://groups.google.com/groups?selm=1077166499.24310.78.camel@localhost'>http://groups.google.com/</a></p>

<h4><a name="Parrot_Day_at_the_Austrian_Perl_Workshop">Parrot Day at the Austrian Perl Workshop</a></h4>

<p>Thomas Klausner announced that this year&#39;s Austrian Perl Workshop would have a Parrot Day, with a tutorial from Leo T&#246;tsch and hopefully some other good stuff from Parrot luminaries. Thomas also asked for people to submit talk ideas.</p>

<p><a href='http://groups.google.com/groups?selm=20040220015102.GL2974@zsi.at'>http://groups.google.com/</a></p>

<p><a href='http://vienna.pm.org/en_workshop.html'>http://vienna.pm.org/en_workshop.html</a></p>

<h4><a name="SDL_+_Parrot_=_Tetris">SDL + Parrot = Tetris</a></h4>

<p>Jens Rieks announced the alpha of an implementation of tetris in Parrot using SDL for the display. Yay Jens! Mmm... a time sink... just what the Parrot developers need.</p>

<p><a href='http://groups.google.com/groups?selm=200402200407.43622.parrot@jensbeimsurfen.de'>http://groups.google.com/</a></p>

<h4><a name="The_First_International_Workshop_on_Interpreted_Languages">The First International Workshop on Interpreted Languages</a></h4>

<p>Dan pointed us all at the First International Workshop on Interpreted Languages&#39; Call for Papers.</p>

<p><a href='http://groups.google.com/groups?selm=a06010207bc5c09cf7874@[10.0.1.2]'>http://groups.google.com/</a></p>

<p><a href='http://www.sebastian&#45;bergmann.de/InterpretedLanguages2004/'>http://www.sebastian&#45;bergmann.de/InterpretedLanguages2004/</a></p>

<h3><a name="Meanwhile,_in_perl6&#45;languages">Meanwhile, in perl6&#45;languages</a></h3>

<h4><a name="Traits/Roles">Traits/Roles</a></h4>

<p>I know I&#39;ve had this feeling of d&#233;j&#224; vu before, but I&#39;ve spelt it right this time. Discussion of Roles continued this week. If I never read another discussion of the difference between <code lang='und' xml:lang='und'>Dog::bark</code> and <code lang='und' xml:lang='und'>Tree::bark</code> again, it&#39;ll be too soon.</p>

<h4><a name="The_Sort_Problem">The Sort Problem</a></h4>

<p>The other topic of discussion this week covered sorting. It looks as though Perl 6&#39;s <code lang='und' xml:lang='und'>sort</code> function is going to be rather more powerful than the Perl 5 equivalent; hopefully this means Perl 6 will finally see the back of code like:</p>

<pre><code>    map  { $_&#45;&#62;[0] }
    sort { $a&#45;&#62;[1] &#60;=&#62; $a&#45;&#62;[1] }
    map  { [$_, extract_key_from($_) } @array</code></pre>

<p>Damian&#39;s post on the subject, referenced below, looks like the front runner. It&#39;s worth reading if you&#39;re interested in sort itself or if you&#39;re interested in how Perl 6&#39;s multi dispatch will work.</p>

<p><a href='http://groups.google.com/groups?selm=402FF9E1.90403@conway.org'>http://groups.google.com/</a></p>

<h4><a name="Allison_Randal_is_the_new_Project_Manager">Allison Randal is the new Project Manager</a></h4>

<p>Nat Torkington announced that he&#39;s managed to pass the Perl 6 Project Manager hat on to Allison Randal&#39;s increasingly be&#45;hatted head. Congratulations and commiserations to Nat and Allison. I&#39;ll leave it up to you to decide who gets which.</p>

<p><a href='http://groups.google.com/groups?selm=94D27CCA&#45;6319&#45;11D8&#45;811E&#45;0003938ADEFE@oreilly.com'>http://groups.google.com/</a></p>

<h3><a name="Announcements,_Apologies,_Acknowledgements">Announcements, Apologies, Acknowledgements</a></h3>

<p>Um... I&#39;m late. Sorry.</p>

<p>If you find these summaries useful or enjoyable, please consider contributing to the Perl Foundation to help support the development of Perl. You might also like to send me feedback at <a href='mailto:p6summarizer@bofh.org.uk'>mailto:p6summarizer@bofh.org.uk</a>, or drop by my website.</p>

<p><a href='http://donate.perl&#45;foundation.org/'>http://donate.perl&#45;foundation.org/</a> &#45;&#45; The Perl Foundation</p>

<p><a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> &#45;&#45; Perl 6 Development site</p>

<p><a href='http://www.bofh.org.uk/'>http://www.bofh.org.uk/</a> &#45;&#45; My website, &#34;Just a Summary&#34;</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-876" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/02/19/plucene.html" rel="bookmark">Find What You Want with Plucene</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2004-02-19T00:00:00-08:00">February 19, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>
For the past few months, my <a href="http://www.kasei.com">former
employers</a> and I have been working on a port of the Java <a href="http://jakarta.apache.org/lucene/">Lucene</a> search engine
toolkit.
</p>



<p>
On the February 3rd, <a href="http://search.cpan.org/perldoc?Plucene">Plucene</a> was released
to the world, implementing almost all of the functionality of the Java
equivalent. Satisfied with a job done, I parted company with Kasei to
pursue some projects of my own -- about which I'm sure you'll be hearing
more later.
</p>


<p>Very soon after, the phone rang,
and it turned out that someone actually wanted to use this Plucene thing; they needed to add a search engine to a web-based book that they had produced,
and had some pretty complex requirements that meant that the usual tools -- HTDig,
Glimpse and friends -- couldn&#39;t quite do the job.
Could I come around and write a Plucene-based search engine for them?</p>

<p>Well, this turned out to have its challenges,
and these turned out to make an interesting introduction to using Plucene,
so I decided to share them with you.
I won&#39;t tell you how to do all of the complicated things we had to do for this custom engine,
but I should give you enough to get your own Plucene indexes up and running.</p>

<h3><a name="Making_it_easy_&#45;_Plucene::Simple" id="Making_it_easy_-_Plucene::Simple">Making It Easy: Plucene::Simple</a></h3>

<p>The easiest way to use Plucene is through the <code>Plucene::Simple</code> module.
To write our index, we say:</p>

<pre><code>    use Plucene::Simple;

    my $index = Plucene::Simple&#45;&#62;open( &#34;/var/plucene/site&#34; );
    for my $id (keys %documents) {
        $index&#45;&#62;add($id =&#62; $documents{$id});
    }
    $index&#45;&#62;optimize;</code></pre>

<p>But what goes in our <code>%documents</code> hash?</p>

<p>One difference between Plucene and other search systems like HTDig is that Plucene only provides a toolkit; it doesn&#39;t provide a complete indexer to suck up a directory of files, for instance. You have to make your own representation of the content of a document, and then add that to the index. For instance, we want to end up with a hash like this:</p>

<pre><code> %documents = (
    &#34;chapter5.html&#34; =&#62; { chapter =&#62; 5,
                         title =&#62; &#34;In which Piglet meets a Heffalump&#34;,
                         content =&#62; &#34;One day, when Christopher Robin...&#34;,
                       }
 );</code></pre>

<p>This means that we can&#39;t simply index the book by providing a list of files to a command-line program. We have to actually write some code.</p>

<p>Some people may think this is a problem, but I see it as an opportunity. For instance, most web pages these days (this one included) are surrounded in a template with banners, titles, and navigation bars down the side. These things are static and appear on every page, so can only harm search engine results; we don&#39;t want to index them. Our indexing code can look at the structure of the document, extract some metadata from it, and construct a hash reference that represents just the important bits of content.</p>

<p>The HTML files I had to deal with looked a bit like this:</p>

<pre><code>    &#60;head&#62;
        &#60;meta name=&#34;chapter&#34; value=&#34;...&#34;&#62;
        &#60;!&#45;&#45; other useful metadata here &#45;&#45;&#62;
        &#60;title&#62; ... &#60;/title&#62;
    &#60;/head&#62;
    &#60;div id=&#34;navigation&#34;&#62;...&#60;/div&#62;
    &#60;div id=&#34;content&#34;&#62;...&#60;/div&#62;</code></pre>

<p>I wanted to extract what was in the <code>meta</code> tags, the <code>title</code>, and everything in the <code>content</code> div. One of the nicest ways to do this in Perl is with the <a href="http://search.cpan.org/perldoc?HTML::TreeBuilder"><code>HTML::TreeBuilder</code></a>, which allows us to &#34;dig down&#34; for the elements that we want to find:</p>

<pre><code>    use HTML::TreeBuilder;
    my $tree = HTML::TreeBuilder&#45;&#62;new&#45;&#62;parse_file(&#34;chapter1.html&#34;);
    my $document = { chapter =&#62; 1 };

    my $title_tag = $tree&#45;&#62;look_down( _tag =&#62; &#34;title&#34; );
    $document&#45;&#62;{<!-- -->title} = $title_tag&#45;&#62;as_text;

    my $content_tag = $tree&#45;&#62;look_down( _tag =&#62; &#34;div&#34;, id =&#62; &#34;content&#34; );
    $document&#45;&#62;{content} = $content_tag&#45;&#62;as_text;</code></pre>

<p>It also allows us to extract attributes from tags:</p>

<pre><code>    for my $tag ($tree&#45;&#62;look_down( _tag =&#62; &#34;meta&#34;)) {
        $document{$tag&#45;&#62;attr(&#34;name&#34;)} = $tag&#45;&#62;attr(&#34;content&#34;);
    }</code></pre>

<p>Now we have the salient parts of the chapter extracted as a hash reference, and we can add this to our index, keyed by the filename:</p>

<pre><code>    $index&#45;&#62;add( &#34;chapter1.html&#34; =&#62; $document );</code></pre>

<p>To do this for a whole directory tree of files, we can use the wonderful <a href="http://search.cpan.org/perldoc?File::Find::Rule"><code>File::Find::Rule</code></a> module:</p>

<pre><code>    for my $filename (File::Find::Rule&#45;&#62;file
                      &#45;&#62;name( qr/^(?!index).*\.html/ )&#45;&#62;in(&#34;.&#34;)) {
        print &#34;Processing $filename...\n&#34;;
        $writer&#45;&#62;writer( $filename =&#62; file2hash($filename) );
    }
    $index&#45;&#62;optimize;</code></pre>

<p>This finds all files underneath the current directory called <code>*.html</code> that don&#39;t start with the characters <code>index</code>. (We needed some special treatment on the index of the book itself, since providing search results to pages in the index would not be helpful.)</p>

<h3><a name="Running_the_Search" id="Running_the_Search">Running the Search</a></h3>

<p>The search part of the operation is now pretty easy. We have a CGI script or equivalent that gets the search query string, and then we say:</p>

<pre><code>    use Plucene::Simple;

    my (@ids, $error);
    if (!$query) {
        $error = &#34;Your search term was empty&#34;;
    } else {
        $index = Plucene::Simple&#45;&#62;open( &#34;/var/plucene/site&#34; );
        @ids = $index&#45;&#62;search($query);
    }</code></pre>

<p>and this returns the list of filenames that matched the query. Because I tend to use Template Toolkit for pretty much everything these days, it became:</p>

<pre><code>    my $t = Template&#45;&#62;new();
    $t&#45;&#62;process(&#34;searchResult.html&#34;, {
        query   =&#62; $query,
        results =&#62; \@ids,
        error   =&#62; $error,
    });</code></pre>

<p>And the relevant part of the template is:</p>

<pre><code>    [% IF error %]
       &#60;H2&#62; Search had errors &#60;/H2&#62;
       &#60;FONT COLOR=&#34;#ff0000&#34;&#62; [% error %] &#60;/FONT&#62;
    [% ELSE %]
       &#60;H2&#62; Search results for [% query %] &#60;/H2&#62;
        [% IF results.size &#62; 0 %]
            &#60;OL&#62;
              [% FOR result = results %]
              &#60;LI&#62;
                  &#60;A HREF=&#34;/[% filename %]&#34;&#62; [% filename %] &#60;/A&#62;
              &#60;/LI&#62;
              [% END %]
            &#60;/OL&#62;
        [% ELSE %]
            &#60;P&#62;No results found&#60;/P&#62;
        [% END %]
    [% END %]</code></pre>

<p>However, this isn&#39;t very pretty, for a couple of reasons. The first reason is that we&#39;re linking the result to a filename, rather than displaying something friendly like the name of the chapter. The second is that when you get results from a web search engine, you generally also expect to see some context for the terms that you&#39;ve just searched for, so you know how the terms appear on the page.</p>

<p>We can&#39;t easily solve the first problem with <code>Plucene::Simple</code>, so we&#39;ll come back to it. But contextualizing search results is something we can do.</p>

<h3><a name="Contextualising_results" id="Contextualising_results">Contextualizing Results</a></h3>

<p>The <a href="http://search.cpan.org/perldoc?Text::Context"><code>Text::Context</code></a> module was written to solve a similar contextualizing problem; it takes a bunch of keywords and a source document, and produces a paragraph&#45;sized chunk of text highlighting where the keywords occur.</p>

<p>Since it works by trying to subdivide the text into paragraphs, it&#39;s helpful to have a text&#45;only version of the document available. If we don&#39;t, we can use <code>HTML::TreeBuilder</code> again to produce them:</p>

<pre><code>    sub snippet {
        my $filename = shift;
        use HTML::Tree;
        my $tree = HTML::TreeBuilder&#45;&#62;new();
        $tree&#45;&#62;parse_file(DOCUMENT_ROOT . &#34;/&#34; . $filename)
            or die &#34;Couldn&#39;t parse file&#34;;
        my $content;
        my($div) = $tree&#45;&#62;look_down(&#34;_tag&#34;,&#34;div&#34;, &#34;id&#34;, &#34;content&#34;);
        for my $p ($div&#45;&#62;look_down(sub { shift&#45;&#62;tag() =~ /^(h\d+|p)/i })) {
            $content . = $p&#45;&#62;as_text.&#34;\n\n&#34;;
        }</code></pre>

<p>This looks for headings and paragraphs and extracts the text from them. Now we can split the search query into individual terms, and then call our <code>Text::Context</code> module to get a snippet to pass to the templater:</p>

<pre><code>        my @terms = split /\s+/, $query;
        my $snippet = Text::Context&#45;&#62;new($stuff, @terms)&#45;&#62;as_html();
        return $snippet;
    }</code></pre>

<p>So far, so good! Then, of course, the specifications changed ...</p>

<h3><a name="Plucene_Components" id="Plucene_Components">Plucene Components</a></h3>

<p>One of the things that makes a good search engine into a great search engine is the ability to automatically search for variations and inflections of the terms. For instance, if you search for &#34;looking good,&#34; you should also find documents that contain &#34;looked good,&#34; &#34;looks good,&#34; and so on.</p>

<p>There are two ways to deal with this; the way HTDig chooses is to replace the &#34;looking&#34; with &#34;(look OR looked OR looks OR looking),&#34; but this isn&#39;t particularly efficient or comprehensive.</p>

<p>A second way is to index the words a little differently; filtering them through a stemmer which takes off the suffixes, so that all of the above collapse to &#34;look.&#34; <a href="http://search.cpan.org/perldoc?Lingua::Stem::En::stem"><code>Lingua::Stem::En::stem</code></a> does this, but we can&#39;t plug it into <code>Plucene::Simple</code> directly. To do this, we need to slip under the covers of <code>Plucene::Simple</code> and meddle with the Plucene API itself.</p>

<p>Before we see how to do this, let&#39;s look at the various components of Plucene.</p>

<p>The indexing part of the process is handled by <code>Plucene::Index::Writer</code>; this takes in <code>Plucene::Document</code> objects, and uses a <code>Plucene::Analysis::Analyzer</code> subclass to break up the text of the document into tokens. The default analyzer as used by <code>Plucene::Simple</code> is <code>Plucene::Analysis::SimpleAnalyzer</code>, which breaks up words on non&#45;letter boundaries and then forces them to lowercase them. The broken&#45;up tokens are put into <code>Plucene::Index::Term</code> to have a field associated with them; for instance, in our example:</p>

<pre><code>    &#60;TITLE&#62;In which Pooh goes visiting and gets into a tight place&#60;/HEAD&#62;</code></pre>

<p>will be turned by our <code>HTML::TreeBuilder</code> munging into</p>

<pre><code>    {
    title =&#62; &#34;In which Pooh goes visiting and gets into a tight place&#34;
    }</code></pre>

<p>and <code>Plucene::Simple</code> turns this into a <code>Plucene::Document::Field</code>:</p>

<pre><code>    bless {name =&#62; &#34;title&#34;,
    string =&#62; &#34;In which Pooh goes visiting and gets into a tight place&#34;},
    &#34;Plucene::Document::Field&#34;</code></pre>

<p>and then into a set of <code>Plucene::Index::Term</code> objects like so:</p>

<pre><code>    bless { field =&#62; &#34;title&#34;, text =&#62; &#34;in&#34; }, &#34;Plucene::Document::Term&#34;
    bless { field =&#62; &#34;title&#34;, text =&#62; &#34;which&#34; }, &#34;Plucene::Document::Term&#34;
    bless { field =&#62; &#34;title&#34;, text =&#62; &#34;pooh&#34; }, &#34;Plucene::Document::Term&#34;
    bless { field =&#62; &#34;title&#34;, text =&#62; &#34;goes&#34; }, &#34;Plucene::Document::Term&#34;
    bless { field =&#62; &#34;title&#34;, text =&#62; &#34;visiting&#34; }, &#34;Plucene::Document::Term&#34;
    ...</code></pre>

<p>Then various classes write out the terms and their frequencies into the index.</p>

<p>When we come to searching, the <code>Plucene::Search::IndexSearcher</code> acts as the top-level classes. It calls a <code>Plucene::QueryParser</code> to turn the query into a set of <code>Plucene::Search::Query</code> objects: this allows Plucene to differentiate between phrase queries such as <code>&#34;looks good&#34;</code>, negated queries (<code>looks &#45;good</code>), queries in different fields (<code>looks title:good</code>), and so on.</p>

<p>This <code>QueryParser</code>, in turn, uses the same analyzer as the indexer to break up the search terms into tokens. This is because if our indexer has seen <code>BORN2run</code> and turned it into two tokens, <code>born</code> and <code>run</code>, and then we do a search on <code>BORN2run</code>, we aren&#39;t going to find it unless we transform the search terms to <code>born</code> and <code>run</code> in the same way.</p>

<h3><a name="Using_the_Porter_Analyzer" id="Using_the_Porter_Analyzer">Using the Porter Analyzer</a></h3>

<p>We need to replace the <code>SimpleAnalyzer</code> with an analyzer that filters through <code>Lingua::Stem::En</code>. Thankfully, here&#39;s one I prepared earlier: <code>Plucene::Plugin::Analyzer::Porter</code>. However, since <code>Plucene::Simple</code> doesn&#39;t allow us to change analyzers, we have to do everything manually.</p>

<p>First, we produce a <code>Plucene::Index::Writer</code>, with the appropriate analyzer:</p>

<pre><code>    my $writer = Plucene::Index::Writer&#45;&#62;new(
        &#34;/var/plucene/site&#34;,
        Plucene::Plugin::Analyzer::PorterAnalyzer&#45;&#62;new(),
        1 # Create the index from scratch
    );</code></pre>

<p>Next we have to build up the <code>Plucene::Document</code> ourselves, instead of just feeding a hash of attributes to <code>Plucene::Simple&#45;&#62;add</code>.</p>

<pre><code>  my $doc = Plucene::Document&#45;&#62;new();
  $doc&#45;&#62;add(Plucene::Document::Field&#45;&#62;Keyword(filename =&#62; $filename));

  my $title_tag = $tree&#45;&#62;look_down( _tag =&#62; &#34;title&#34; );
  $doc&#45;&#62;add(Plucene::Document::Field&#45;&#62;Text( title =&#62; $title_tag&#45;&#62;as_text ));

  for my $tag ($tree&#45;&#62;look_down( _tag =&#62; &#34;meta&#34;)) {
      $document{$tag&#45;&#62;attr(&#34;name&#34;)} = $tag&#45;&#62;attr(&#34;content&#34;);
  }

  my $content_tag = $tree&#45;&#62;look_down( _tag =&#62; &#34;div&#34;, id =&#62; &#34;content&#34; );
  $doc&#45;&#62;add(Plucene::Document::Field&#45;&#62;UnStored( title =&#62; $content_tag&#45;&#62;as_text ));</code></pre>

<p>You&#39;ll notice that there are three different constructors for <code>Plucene::Document::Field</code> objects -- the <code>Keyword</code> is stored and can be retrieved, but isn&#39;t broken up into tokens; this is used for things like filenames, where you want to get them back from the index verbatim. Fields constructed using <code>Text</code> can be retrieved, but are also broken up into tokens for searching in the index. <code>UnStored</code> text can&#39;t be retrieved, but is indexed, so we use this for the content, the main bulk of the book.</p>

<p>This will also solve our problem with the English description of the link, since it will allow us to retrieve the title field for a search hit.</p>

<p>Once we have our document object, we can add it into the index:</p>

<pre><code>    $writer&#45;&#62;add($doc);</code></pre>

<p>Now that we have the text filtered through the Porter stemmer, the tokens indexed will look like &#34;<code>in which pooh goe visit</code>.&#34; Now we need to make sure that the same filter is used in searching, which means we also have to rewrite the search code to use this analyzer. First, we open the index for searching:</p>

<pre><code>    my $searcher = Plucene::Search::IndexSearcher&#45;&#62;new( &#34;/var/plucene/site&#34; );</code></pre>

<p>Now we parse the query, specifying that any unqualified terms should be sought in the <code>content</code> field:</p>

<pre><code>    my $parser = Plucene::QueryParser&#45;&#62;new({
            analyzer =&#62; Plucene::Plugin::PorterAnalyzer&#45;&#62;new(),
            default  =&#62; &#34;content&#34;
        });
    my $parsed = $parser&#45;&#62;parse($query);</code></pre>

<p>Finally, we declare a <code>Plucene::Search::HitCollector</code>; this is a callback which is called every time a search hit is found. We use it to populate an array of information about hits:</p>

<pre><code>    my @docs;
    my $hc       = Plucene::Search::HitCollector&#45;&#62;new(
        collect =&#62; sub {
            my ($self, $doc, $score) = @_;
            my $res = eval { $searcher&#45;&#62;doc($doc) };
            push @docs, $res if $res;
        });</code></pre>

<p>And we do the search:</p>

<pre><code>    $searcher&#45;&#62;search_hc($parsed, $hc);</code></pre>

<p>This fills <code>@docs</code> with <code>Plucene::Document</code> objects; from these, we want to extract the filename and the title fields, to pass to the templates:</p>

<pre><code>    @results = map {{ 
        filename =&#62; $_&#45;&#62;get(&#34;filename&#34;)&#45;&#62;string,
        title =&#62; $_&#45;&#62;get(&#34;title&#34;)&#45;&#62;string,
    }} @docs;

    for (@results) {
        $_&#45;&#62;{snippet} = snippet($_&#45;&#62;{filename})
    }</code></pre>

<p>Now we can put together a more impressive display for each result:</p>

<pre><code>    &#60;LI&#62;
    &#60;BLOCKQUOTE&#62;
    [% result.snippet %]
    &#60;/BLOCKQUOTE&#62;
    &#60;P&#62;In &#60;A HREF=&#34;/[% result.filename %]&#34;&#62; [% result.title %]&#60;/A&#62;&#60;/P&#62;</code></pre>

<p>This ends up looking like the following:</p>


<h3> Search results for &quot;bears build&quot; </h3>
<blockquote>
It's a very funny thought that, if <b>Bears</b> were Bees,
they'd <b>build</b> their nests are the bottom of trees.
</blockquote>
<p>In <i>We are introduced</i></p>


<p>Which looks quite nice and professional. Except for one slight matter.</p>

<p>Suppose we had looked for <code>bear builds</code>. We&#39;d still match the same bit of text, thanks to stemming. However, the exact words that we&#39;re looking for aren&#39;t in that bit of text, so the contextualizer won&#39;t do the right thing. What we need, then, is a version of <code>Text::Context</code> that knows about Porter stemming. Thankfully, <a href="http://search.cpan.org/perldoc?Text::Context::Stemmer"><code>Text::Context::Stemmer</code></a> steps into the breach.</p>

<p>We have a web search engine that understands Porter stemming. The first part of my job is done.</p>

<h3><a name="And_everything_else" id="And_everything_else">And Everything Else</a></h3>

<p>There are plenty of other things we can do with Plucene: use the metadata to restrict the search to particular chapters, for instance; filter out stop words with the <code>Plucene::Analysis::StopFilter</code>; restrict the search to a series of dates, using the <code>Plucene::Document::DateSerializer</code> module, and so on.</p>

<p>Plucene is a general-purpose search engine; while the <code>Plucene::Simple</code> interface to it allows you to get a good search tool up and running very quickly, that&#39;s very much only the tip of the iceberg. By getting into the Plucene API itself, we can build a complex, customized search engine for any application.</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-884" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/02/p6pdigest/20040215.html" rel="bookmark">This week on Perl 6, week ending 2004-02-15</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-02-15T00:00:00-08:00">February 15, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>In his talk on Parrot at OSCON last year,
Dan said that Parrot would have objects &#39;by the end of the week&#39;.
It&#39;s been a very long week,
and it&#39;s not finished yet.</p>

<p>Right,
venting over,
time for the summary.
I&#39;ll start with perl6&#45;internals,
as always.
Actually,
we&#39;re starting slightly before the usual start of the week because about half an hour after I sent last week&#39;s summary off I realised I&#39;d completely missed a couple of threads.</p>

<h4><a name="Some_minor_decisions_and_timetables">Some minor decisions and timetables</a></h4>

<p>Dan made a few design decisions and outlined a release timetable for the next release of Parrot (which was initially set to be Valentine&#39;s Day,
but the appeal of February 29th for a Leap Parrot release proved to be greater).</p>

<p><a href='http://groups.google.com/groups?selm=a06010205bc459600096b@[172.24.18.98]'>http://groups.google.com/groups</a></p>

<h4><a name="Why_didn&#39;t_I_mention_this_last_week?">Why didn&#39;t I mention this last week?</a></h4>

<p>Jens Rieks earns a &#34;Wow,
cool!&#34; from me with his parrot version of Data::Dumper.
Way to go Jens.
People were impressed.</p>
<csperl file="grab" domain="on" record="b/940" template="b/article_sidebar.view">
<p><a href='http://groups.google.com/groups?selm=200402051301.35111.parrot@jensbeimsurfen.de'>http://groups.google.com/groups</a></p>

<h4><a name="Supporting_simple_PMCs_as_keys">Supporting simple PMCs as keys</a></h4>

<p>St&#233;phane Payrard posted a patch to support using simple PMCs instead of full on key PMCs for simple lookups.
He and Leo discussed it,
but the patch hasn&#39;t been accepted yet.</p>

<p><a href='http://groups.google.com/groups?selm=20040209192126.GB17703@stefp.dyndns.org'>http://groups.google.com/groups</a></p>

<h4><a name="Keyed_access_to_UnManagedStruct">Keyed access to UnManagedStruct</a></h4>

<p>Everyone&#39;s favourite differently capitalized O&#39;Reilly employee,
chromatic (Maybe the new running joke should be my struggles to avoid using his name at the start of a sentence so we don&#39;t have a falling out cases),
continued his discussion with Leo about keyed access to Unmanaged (and presumably managed) C structs.</p>

<p><a href='http://groups.google.com/groups?selm=1076360871.2575.2.camel@localhost'>http://groups.google.com/groups</a></p>

<p><a href='http://groups.google.com/groups?selm=1076389270.15055.2.camel@localhost'>http://groups.google.com/groups</a>&#45;&#45; 
    An example of chromatic&#39;s problem</p>

<h4><a name="Backward_branch,_fixed">Backward branch,
fixed</a></h4>

<p>Remember the problem with a backward branch that I said was Warnocked last week.
It turned out that it was fixed before I posted the summary.
They don&#39;t call Leo T&#246;tsch the Patchmonster for nothing.</p>

<p><a href='http://groups.google.com/groups?selm=200402101351.i1ADpGQ20266@thu8.leo.home'>http://groups.google.com/groups</a></p>

<h4><a name="Parrot_system">Parrot <code>system</code></a></h4>

<p>Dan apologized for his recent silence on list,
but thought he&#39;d be more active from now on.
He also announced that he was in the process of adding in perl 5 style <code>system</code> support</p>

<p><a href='http://groups.google.com/groups?selm=a06010202bc4ef0a3aa78@[10.0.1.2]'>http://groups.google.com/groups</a></p>

<h4><a name="Parrot_sort">Parrot sort</a></h4>

<p>Jens Rieks garnered more kudos with his implementation of a simple _sort function in IMC.
Leo checked it in,
and you&#39;ll find it in <em lang='und' xml:lang='und'>library/sort.imc</em> in an up to date CVS distribution.
Then,
seemingly in his spare time,
he fixed up some SDL related stuff for chromatic.</p>

<p><a href='http://groups.google.com/groups?selm=200402111311.04736.parrot@jensbeimsurfen.de'>http://groups.google.com/groups</a></p>

<h4><a name="RFD:_Symbol_naming_and_IMCC2">RFD: Symbol naming and IMCC2</a></h4>

<p>Melvin Smith posted a Request For Discussion about how IMCC2 will handle symbols and sigils.
The issue seems to be that,
for humans writing code,
quoting symbols is a pain.
Various options were suggested,
but nothing appears to have been decided yet.
(I quite like Leo&#39;s suggestion involving declaring lexicals with a mangled name for use in parrot,
but marking it as being associated with an <code>$unmangled_original_name</code>.)</p>

<p><a href='http://groups.google.com/groups?selm=5.1.1.6.2.20040211121042.09c2e500@pop.mindspring.com'>http://groups.google.com/groups</a></p>

<h4><a name="JIT_and_branches_under_the_Sun">JIT and branches under the Sun</a></h4>

<p>Stephane Peiry found with the JIT on Suns; it seems that a loop that should terminate carries on forever instead.
He and Leo worked on tracking it down,
but the bug was still there by the end of the week.</p>

<p><a href='http://groups.google.com/groups?selm=20040212210728.GA1436@pittypanda'>http://groups.google.com/groups</a></p>

<h4><a name="Rules_for_method_resolution?">Rules for method resolution?</a></h4>

<p>Okay,
so I may have kvetched about the continuing lack of Parrot objects earlier,
but Dan&#39;s definitely working on it.
This time he&#39;s thinking about method resolution.
In particular he wondered when</p>

<pre><code>   findmethod P4, Pobject, &#34;methodname&#34;</code></pre>

<p>should do the name resolution. In other words, should P4 contain the method that was current at the time of the <code>findmethod</code> call, or a proxy PMC that waits until the method is invoked to find the appropriate method. The discussion seemed to come down in favour of doing both.</p>

<p><a href='http://groups.google.com/groups?selm=a06010204bc52aa01e263@[172.24.18.98]'>http://groups.google.com/groups</a></p>

<h4><a name="Object_spec">Object spec</a></h4>

<p>Dan noted that he&#39;d checked in some major revisions to PDD15 (objects!) and suggested that people take a look. Simon Glover, Leo T&#246;tsch and LF had questions.</p>

<p><a href='http://groups.google.com/groups?selm=a0601020bbc52f88649a7@[172.24.18.98]'>http://groups.google.com/groups</a></p>

<h3><a name="Meanwhile_in_perl6&#45;language">Meanwhile in perl6&#45;language</a></h3>

<h4><a name="The_thread_that_ate_the_mailing_list">The thread that ate the mailing list</a></h4>

<p>Luke Palmer doesn&#39;t like the repetition inherent in</p>

<pre><code>   @sorted = sort { $^a.foo(&#39;bar&#39;).compute &#60;=&#62; $^b.foo(&#39;bar&#39;).compute }
               @unsorted;</code></pre>

<p>He wondered if there might be some way of rejigging <code>sort</code> to eliminate the duplication and proposed a couple of spectacularly ugly possibilities. And then the world exploded. It seems that nobody (on perl6&#45;language) actually likes the current signature of <code>sort</code>, but nobody can quite agree on what it <i>should</i> look like. You know things are getting hand when Dan proposes just using SQL&#39;s <code>ORDER BY</code> syntax (even though he was joking). Simon &#34;Rubyometer&#34; Cozens proposed:</p>

<pre><code>   @sorted = @unsorted.sort(op =&#62; &#38;infix:&#60;=&#62;, 
                            key =&#62; { $^a.foo(&#39;bar&#39;).compute });</code></pre>

<p>Which, I have to confess, I rather like. Rod Adams demonstrated a truly painful looking sort function which this summary is too succinct to contain, see the link for details.</p>

<p>Personally, I&#39;m amazed that a single library function could generate so much discussion. And there&#39;s more to come next week.</p>

<p><a href='http://groups.google.com/groups?selm=20040212031134.GA16797@babylonia.flatirons.org'>http://groups.google.com/groups</a></p>

<p><a href='http://groups.google.com/groups?selm=20040213041440.28310.qmail@web40802.mail.yahoo.com'>http://groups.google.com/groups</a></p>

<p><a href='http://groups.google.com/groups?selm=402EA18A.40604@rodadams.net'>http://groups.google.com/groups</a>&#45;&#45; 
    Feel Rod&#39;s pain.</p>

<h4><a name="Haven&#39;t_I_had_this_feeling_of_d&#233;ja_v&#249;_before?">Haven&#39;t I had this feeling of d&#233;ja v&#249; before?</a></h4>

<p>Dmitry Dorofeev pointed everyone at Scharli et al&#39;s paper on Smalltalk Traits and proposed that Perl 6 use something similar. Which is what Larry proposed a few weeks back, except he called Traits Roles and propose that they also have (or mandate) state (the original Smalltalk Traits are stateless). Aaron Sherman wondered if the Emperor was actually wearing clothes by saying that Roles didn&#39;t seem to be substantially different from Java interfaces. I particularly liked chromatic&#39;s answer that &#34;interfaces completely suck while [Roles] don&#39;t.&#34; My other favourite quote of the thread was from (who else) Larry: &#34;The Traits paper didn&#39;t go into traits with state, though it did mention it as a future research topic. We&#39;re just doing that future research for them.&#34;</p>

<p><a href='http://groups.google.com/groups?selm=20040212131111.95331.qmail@onion.perl.org'>http://groups.google.com/groups</a></p>

<h3><a name="Announcements,_Acknowledgements,_Apologies">Announcements, Acknowledgements, Apologies</a></h3>

<p>Well, I&#39;ve thought about it some more, and I&#39;d like you all to welcome chromatic as the Perl 6 Summary&#39;s official running joke. I don&#39;t guarantee to mention him every week, but I do guarantee that I&#39;ll always jump through hoops to avoid starting a sentence with his name when I do mention him.</p>

<p>If you find these summaries useful or enjoyable, please consider contributing to the Perl Foundation to help support the development of Perl. You might also like to send me feedback at <a href='mailto:p6summarizer@bofh.org.uk'>mailto:p6summarizer@bofh.org.uk</a>, or drop by my website.</p>

<p><a href='http://donate.perl&#45;foundation.org/'>http://donate.perl&#45;foundation.org/</a> &#45;&#45; The Perl Foundation</p>

<p><a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> &#45;&#45; Perl 6 Development site</p>

<p><a href='http://www.bofh.org.uk/'>http://www.bofh.org.uk/</a> &#45;&#45; My website, &#34;Just a Summary&#34;</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-874" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/02/13/mbox2wap.html" rel="bookmark">Mail to WAP Gateways</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Pete Sergeant</span> on <abbr class="published" title="2004-02-13T00:00:00-08:00">February 13, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>It's coming up to Valentine&#39;s day again,
and invariably my thoughts turn back to last year&#39;s rather memorable weekend-break to Stockholm,
in which I learned two things:</p>

<ol>
<li>Stockholm makes a great Valentine&#39;s destination.</li>

<li>My girlfriend of the time was not happy with me cracking out my iBook and checking my email halfway into the break.</li>
</ol>

<p>The relationship, predictably,
didn&#39;t last much longer, but it did occur to me that a quick and easy way to check my email when away from my computer would be very useful. One of the items that travels everywhere with me,
and has some limited Internet access is my phone -- although admittedly this has only WAP access. WAP access, it seemed, would have to do...</p>

<p>The tool I ended up building fills <b>my</b> needs very well,
but possibly won&#39;t be such a great match for others. This article looks at considerations when rendering email for display online,
especially when space is very limited.</p>

<h3><a name="Overview_of_messages">Overview of Messages</a></h3>

<p>The first challenge is reading the contents of our target mailbox.
For this,
we turn to the Perl Email Project&#39;s <a href="http://search.cpan.org/perldoc?Email::Folder"><code>Email::Folder</code></a>:</p>

<pre><code> use Email::Folder;
 
 my $folder = Email::Folder&#45;&#62;new( &#39;/home/sheriff/mbox&#39; );
 
 for my $message ( $folder&#45;&#62;messages ) {
 
        ...</code></pre>

<p><a href="http://search.cpan.org/perldoc?Email::Folder"><code>Email::Folder</code></a>&#39;s messages() function returns <a href="http://search.cpan.org/perldoc?Email::Simple"><code>Email::Simple</code></a> objects. For my folder&#45;view, I chose to group messages by date, and use the sender&#39;s "real name" as the subject. Something like:</p>

<pre><code> 30 Jan 2004
    Michael Roberts
  * Paul Makepeace
    Uri Guttman
 29 Jan 2004
    Kate Pugh</code></pre>

<p>Extracting header fields from <a href="http://search.cpan.org/perldoc?Email::Simple"><code>Email::Simple</code></a> objects couldn&#39;t be simpler:</p>

<pre><code> my $from = $message&#45;&#62;header(&#39;from&#39;)</code></pre>

<p>But people familiar with the various email RFCs will know that since email headers have to use only printable US&#45;ASCII, they&#39;re very often encoded: your header field might well look like:</p>

<pre><code>  =?iso&#45;8859&#45;1?q?Pete=20Sergeant?= &#60;pete@clueball.com&#62;</code></pre>

<p>This will not look pretty if you use it literally. Thankfully, <a href="http://search.cpan.org/perldoc?MIME::WordDecoder"><code>MIME::WordDecoder</code></a> exports the function <code lang='und' xml:lang='und'>unmime</code> -- rendering the above as "Pete Sergeant &#60;pete@clueball.com&#62;."</p>

<p>Getting the date from an email is also somewhat nontrivial -- an example "Date" header looks like:</p>

<pre><code> Fri, 30 Jan 2004 14:09:51 &#45;0000</code></pre>

<p>And that&#39;s if you&#39;re lucky, and it&#39;s well-formed, without starting to think about time zones. If we want to do anything useful with dates, we&#39;re going to want the date as an epoch time. Luckily, <a href="http://search.cpan.org/perldoc?DateTime::Format::Mail"><code>DateTime::Format::Mail</code></a> steps in, and not only parses our date, but returns a highly useful <a href="http://search.cpan.org/perldoc?DateTime"><code>DateTime</code></a> object, allowing us to do all kinds of fun date stuff. To simply reformat the date as Day/Month/Year:</p>

<pre><code> my $datetime = DateTime::Format::Mail&#45;&#62;new( loose =&#62; 1 );
 my $time = $datetime&#45;&#62;parse_datetime( $message&#45;&#62;header(&#39;date&#39;) );
 my $day_month_year = $time&#45;&#62;dmy;</code></pre>

<p>Finally, we&#39;re going to want to know if an email is new or not. Luckily, most MUAs will set/edit an email&#39;s status header. Rather than checking if an email is new, we check if it&#39;s been read -- denoted by a <code lang='und' xml:lang='und'>R</code> in the status header:</p>

<pre><code> $new_flag++ if $message&#45;&#62;header(&#39;Status&#39;) !~ m/R/;</code></pre>

<p>Now let&#39;s put this all together to produce a listing of a folder. We&#39;ll use the well-known Schwartzian transform to make the sorting efficient, but unlike the usual practice, we keep the array reference around, as we&#39;ll be using the date as well.</p>

<pre><code> use Email::Folder;
 use MIME::WordDecoder qw( unmime );
 use DateTime::Format::Mail;

 my $folder = Email::Folder&#45;&#62;new( &#39;/home/sheriff/mbox&#39; );
 my @to_sort;
 my $prev_date = &#34;&#34;;
 for (sort { $a&#45;&#62;[1] cmp $b&#45;&#62;[1]    }
      map  { [$_, message2dmy($_) ] } 
      $folder&#45;&#62;messages) {
     my ($message, $date) = @$_;
     if ($date ne $prev_date) { print $date, &#34;\n&#34;; $prev_date = $date; }
     print $message&#45;&#62;header(&#39;Status&#39;) =~ m/R/ ? &#34;   &#34; : &#34; * &#34;;
     print unmime($message&#45;&#62;header(&#39;from&#39;)), &#34;\n&#34;;
 }

 sub message2dmy {
     my $message = shift;
     my $datetime = DateTime::Format::Mail&#45;&#62;new( loose =&#62; 1 );
     my $time = $datetime&#45;&#62;parse_datetime( $message&#45;&#62;header(&#39;date&#39;) );
     my $day_month_year = $time&#45;&#62;dmy;
 }</code></pre>

<h3><a name="Displaying_individual_messages">Displaying Individual Messages</a></h3>

<p>Those are the main challenges of a folder&#45;view. Viewing an individual message presents a different set of challenges.</p>

<p>First and foremost is the appalling habit people have of sending each other HTML-"enriched" emails, with all sorts of attachments. If you&#39;re trying to read the email on a cell phone over a slow connection, you don&#39;t want to be battling with this -- you want a nice plain-text representation of the email. So, <a href="http://search.cpan.org/perldoc?Email::StripMIME"><code>Email::StripMIME</code></a> is your friend. Assuming we have an <a href="http://search.cpan.org/perldoc?Email::Simple"><code>Email::Simple</code></a> object, we can simply:</p>

<pre><code> my $string = $email_simple_object&#45;&#62;as_string();
 $string = Email::StripMIME::strip_mime( $string );
 $email_simple_object = Email::Simple&#45;&#62;new( $string );</code></pre>

<p>Of course, if we really wanted to cut down on the amount of content we&#39;re receiving, and we&#39;re only using this tool to get an overview of our messages, we can cut out quoted text, remnants of the email that the sender was replying to, and so on. <a href="http://search.cpan.org/perldoc?Text::Original"><code>Text::Original</code></a> does just this for us, as well as stripping out attribution lines:</p>

<pre><code> my $body = $email_simple_object&#45;&#62;body();
 $body = first_lines( $body, 20);
 $email_simple_object&#45;&#62;body( $body );</code></pre>

<p>The final problem is in creating actual real WML. Sadly, this is nontrivial, and in the past, I've tended to resort to outputting it by hand. But it doesn&#39;t have to be that way --; <a href="http://search.cpan.org/perldoc?CGI::WML"><code>CGI::WML</code></a> just about handles the task for us. <a href="http://search.cpan.org/perldoc?CGI::WML"><code>CGI::WML</code></a> is a subclass of <a href="http://search.cpan.org/perldoc?CGI"><code>CGI</code></a>, with methods specific to WAP.</p>

<h3><a name="Conclusion">Conclusion</a></h3>

<p>There is no fully working demo at the end of this article. My personal tool works in a way that&#39;s probably a little too specific for most people&#39;s needs. Hopefully however, it's introduced you to one or more modules you didn&#39;t know existed, and given you some inspiration to tinker around with Perl and email-handling.</p>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-882" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/02/p6pdigest/20040208.html" rel="bookmark">This week on Perl 6, week ending 2004-02-08</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-02-08T00:00:00-08:00">February  8, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>Another Monday evening.
Another day of displacement activity out of the way.
There&#39;s a huge lump of belly pork braising slowly in a mixture of stock,
rice wine &#38; soy sauce,
and nothing on the telly.
It must be time to write the Perl 6 summary.
As usual,
I&#39;m going to deal with perl6&#45;internals first.</p>

<h4><a name="RT_Cleanup">RT Cleanup</a></h4>

<p>The cleanup of the RT bugs database continued apace.
Stephane Peiry posted a list of old RT entries and their authors and asked them to supply updates ore they&#39;d be flagged as obsolete in the queue.
In the ensuing discussion,
Steve Fink pointed out something that I&#39;d missed: as of this week,
all the perl6 tests (including the regular expression tests) are passing.
He pointed out that the suite is <i>far</i> from comprehensive,
but I still think this is pretty spiffy.</p>

<p><a href='http://groups.google.com/groups?selm=1075590954.6331.17.camel@pittypanda'>http://groups.google.com/groups</a></p>

<h4><a name="DOD,_mutation,_and_generational_collectors">DOD,
mutation,
and generational collectors</a></h4>

<p>Dan had posted some thoughts on the way that many of the things that cause problems for threads also cause problems for generational garbage collectors and gave a list of &#39;mutating activities&#39; that might need to be trapped by both threads and GC.
Gorgon Henriksen asked Dan for more elaboration on what he meant by generational GC because,
as Gordon understood it,
it came with a whole load of baggage that was inappropriate for Parrot.
This week,
Dan gave his answer and pointed out that various other improved GC schemes (incremental,
concurrent) required the same level of support as a generational scheme so it made sense to provide such support now.
Leo T&#246;tsch had a few comments to make about the different possible schemes and discussion moved on to the nastiness of doing GC in a multithreaded environment.</p>

<p><a href='http://groups.google.com/groups?selm=a06010200bc3eb3ef7c96@[192.168.1.28]'>http://groups.google.com/groups</a> 
    &#45;&#45; Thread root</p>

<csperl file="grab" domain="on" record="b/940" template="b/article_sidebar.view">

<h4><a name="SDL_Bindings">SDL Bindings</a></h4>

<p>The SDL bindings that chromatic&#39;s been working on continue to develop.
(Bah!
People who insist on weird capitalization of their names and thus force me into the passive voice are jolly annoying,
even if personally very pleasant).</p>

<p><a href='http://groups.google.com/groups?selm=200402021557.i12FvQl03090@thu8.leo.home'>http://groups.google.com/groups</a></p>

<h4><a name="Python_PMCs?">Python PMCs?</a></h4>

<p>Michal Wallace wondered what Dan&#39;s plan was for getting python objects working for the pie&#45;thon.
Michal has made a small start on wrapping PythonObjects as PMCs which seemed to work and was apparently easier than trying to recode them as PMCs.
He pointed everyone at his current implementation.
So far his post has been Warnocked.</p>

<p><a href='http://groups.google.com/groups?selm=Pine.LNX.4.58.0402021830390.12849@hydrogen.sabren.com'>http://groups.google.com/groups</a></p>

<p><a href='http://pirate.versionhost.com/pirate/python/pmc/piobject.pmc'>http://pirate.versionhost.com/pirate/python/pmc/piobject.pmc</a> &#45;&#45; The wrapper implementation</p>

<h4><a name="Docs_and_releases">Docs and releases</a></h4>

<p>Tim Bunce wondered whether Parrot&#39;s documentation was in sync with current implementation reality,
and when we&#39;d see a clean way to make method calls.
In a post dated the 3rd of February,
Leo confessed that there is still a lot of outdated or unimplemented stuff in the assembly related docs and noted that Dan had said that the low&#45;level object design would be done by the 30th of January.</p>

<p><a href='http://groups.google.com/groups?selm=20040202215426.GW6628@dansat.data&#45;plan.com'>http://groups.google.com/groups</a></p>

<h4><a name="Backward_branch,_Warnocked">Backward branch,
Warnocked</a></h4>

<p>Pete Lomax drew everyone&#39;s attention to a problem he&#39;d found back at the beginning of December which Leo had said was a problem with a backward branch.
He wondered when/if the problem might be fixed.</p>

<p>Sadly the answer was &#34;We&#39;re not sure when it&#39;ll be fixed,
it&#39;s really hard to fix the current version of IMCC,
but it should be easier to sort out in IMCCv2.
For now,
don&#39;t do that.&#34; Meanwhile,
Harry Jackson tried to track the bug down to the appropriate bit of IMCC; his experiments with code variants seem to imply that the problem is with IMCC not recognizing that <code lang='und' xml:lang='und'>ret</code> is a branch.</p>

<p><a href='http://groups.google.com/groups?selm=69rt105khibjtb5iitapsjiev46ottrljp@4ax.com'>http://groups.google.com/groups</a></p>

<h4><a name="Alignment_issues_with_*ManagedStruct">Alignment issues with *ManagedStruct</a></h4>

<p>The redoubtable chromatic came across some issues with the alignment of members within a struct and wondered if there might be a better way of sorting out alignment issues than his current trick of explicitly padding things out (which he feels probably isn&#39;t portable).
Leo pointed out that there was already support for offsetting struct members when setting up a *Struct PMC by using the third initializer parameter.</p>

<p>As discussion of the best way forward continued,
it emerged that Jens Rieks is in the process of writing a simple C&#45;parser in IMC which should be able to parse header files and create ManagedStructs automagically.
Go Jens.
Tim Bunce suggested that Jens take a look at ExtUtils::XSBuilder for hints.
Meanwhile Uri was looking at Convert::Binary::C which is apparently far more robust.</p>

<p>Leo ended up listing a set of requirements for a script to parse C headers and generate the appropriate PIR code to set up various *Struct PMCs.</p>

<p><a href='http://groups.google.com/groups?selm=1075792412.21791.36.camel@localhost'>http://groups.google.com/groups</a></p>

<p><a href='http://groups.google.com/groups?selm=200402051104.40882.parrot@jensbeimsurfen.de'>http://groups.google.com/groups</a> 
    &#45;&#45; Jens talks about his C parser</p>

<p><a href='http://groups.google.com/groups?selm=200402061458.i16EwXI03277@thu8.leo.home'>http://groups.google.com/groups</a> 
    &#45;&#45; Leo&#39;s requirements</p>

<h4><a name="Baby,_baby,_where_did_my_patch_go?">Baby,
baby,
where did my patch go?</a></h4>

<p>Gordon Henriksen wondered what had happened to a patch that he&#39;d submitted to bugs&#45;parrot.
Robert Spier wasn&#39;t sure,
but noted that the MyDoom virus was busy causing the perl.org servers a hard time (more than a gigabyte in 19 hours; Robert sounded a little fraught).
As it happened,
the patch had actually bounced from the list because it was huge.
Everything got sorted out in the end though.</p>

<p><a href='http://groups.google.com/groups?selm=013601c3ec04$a719dc20$d454e8c7@domain.ma.iclub.com'>http://groups.google.com/groups</a></p>

<h4><a name="Documentation_tools">Documentation tools</a></h4>

<p>Michael Scott continued his sterling work on Parrot&#39;s documentation by adding the Perl tools he used to generated the HTML docs to the tree at <em lang='und' xml:lang='und'>tools/docs/write_docs.pl</em>,
he also announced that he&#39;d finished the examples and the various <em lang='und' xml:lang='und'>*.c</em> file directories and will be looking at classes next.
I wonder how long it&#39;ll be before someone reimplements them in in PIR...</p>

<p><a href='http://groups.google.com/groups?selm=DF04B5B2&#45;577A&#45;11D8&#45;858E&#45;000A95C50226@mac.com'>http://groups.google.com/groups</a></p>

<h4><a name="Approaching_PDD16_callbacks">Approaching PDD16 callbacks</a></h4>

<p>Leo announced that he&#39;s implemented a first hacky way to run PASM callbacks from C NCI functions; it&#39;s not a full implementation,
but it&#39;s a start.
As usual,
he solicited comments.
And so far he&#39;s not had any.</p>

<p><a href='http://groups.google.com/groups?selm=4024E112.5030809@toetsch.at'>http://groups.google.com/groups</a></p>

<h3><a name="Meanwhile,_in_perl6&#45;language">Meanwhile,
in perl6&#45;language</a></h3>

<h4><a name="The_Unicode_argument_again">The Unicode argument again</a></h4>

<p>Andy Wardley strongly advocated not making Unicode operators <code lang='und' xml:lang='und'>&#171;</code>,
<code lang='und' xml:lang='und'>&#187;</code> etc part of the core language.
Larry disagreed,
but proposed that any Unicode declarations should also have an <code lang='und' xml:lang='und'>is ASCII(&#39;!@#$&#39;)</code> trait to specify the ASCII equivalent.</p>

<p><a href='http://groups.google.com/groups?selm=20040202083526.GF31998@cat.ourshack.com'>http://groups.google.com/groups</a></p>

<h4><a name="Compiler_writing_tools">Compiler writing tools</a></h4>

<p>Luke Palmer has been writing &#39;a lot of compiler&#39; recently and posted some of his positive and negative experiences with YACC as possible pointers to the sort of things Perl 6&#39;s grammars might need.
In his response,
Larry once again demonstrated the truth of the proposition that &#34;Everyone writes a templating module at least once in their life&#34; when he confessed that &#34;the first production language I ever wrote was an inside&#45;out language where control commands were embedded in text that was to be output by default.&#34;</p>

<p><a href='http://groups.google.com/groups?selm=20040202090933.GA22343@babylonia.flatirons.org'>http://groups.google.com/groups</a></p>

<h3><a name="Acknowledgements,_Apologies,_Announcements">Acknowledgements,
Apologies,
Announcements</a></h3>

<p>Oops,
reading back over last week&#39;s summary I realise that,
when I meant to talk of going to see Eliza Carthy performing live,
I actually wrote that we&#39;d gone to see her perform life.
Sorry about that.</p>

<p>If you find these summaries useful or enjoyable,
please consider contributing to the Perl Foundation to help support the development of Perl.
You might also like to send me feedback at <a href='mailto:p6summarizer@bofh.org.uk'>mailto:p6summarizer@bofh.org.uk</a>,
or drop by my website.</p>

<p><a href='http://donate.perl&#45;foundation.org/'>http://donate.perl&#45;foundation.org/</a> &#45;&#45; The Perl Foundation</p>

<p><a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> &#45;&#45; Perl 6 Development site</p>

<p><a href='http://www.bofh.org.uk/'>http://www.bofh.org.uk/</a> &#45;&#45; My website,
&#34;Just a Summary&#34;</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-872" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/02/05/siesta.html" rel="bookmark">Siesta Mailing List Manager</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Wistow</span> on <abbr class="published" title="2004-02-05T00:00:00-08:00">February  5, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->


<p>Sometime around July 2002 there was another of the seemingly inevitable and interminable threads about mailing list managers that pop up with regrettable frequency on the London Perl Mongers mailing list.</p>

<p>It almost certainly contained references to Reply To munging,
missing features, and why we,
a Perl mailing list,
were running off Python software,
namely Mailman.</p>

<p>It was pointed out that even though Mailman has its limitations,
it's still arguably the best MLM out there.
Of course, rational argument is never something that gets in the way of a good thread and the debate continued until Richard Clamp brought his own unique brand of pragmatism to bear ...</p>

<pre><code> From: Richard Clamp &#60;richardc@unixbeard.net&#62;
 To: london.pm
 Subject: Re: for those who were looking for reason to better mailman in perl
 Date: Tue Jul 30 00:53:03 2002

 On Mon, Jul 29, 2002 at 03:06:44PM +0100, Nicholas Clark wrote:
 &#62; Note that I have no intention of actually finding the time to 
 &#62; actively help anyone re-write mailman (or majordomo) or anything 
 &#62; else,

 I must say that I'm actively bored of this subject now.  I do, however,
 have a short proposal, which will hopefully lead to this recurring
 thread going the fsck away.

 To: Those that care
 From: Someone who doesn&#39;t
 
       Go form a sourceforge/savannah project, which will give you
       suboptimal mailing lists and a CVS repository.
 
       Let the world know you have done this so they can find you. 
 
       Write code and argue it out amongst yourselves.
 
       Let the world know when you get as far as being self-hosting.
 
 I&#39;m sorry it&#39;s not a catchy 3-step plan, but try it out anyway.
 
 -- 
 Richard Clamp &#60;richardc@unixbeard.net&#62;</code></pre>

<p>In response to which, precisely nothing happened. So it goes.</p>

<p>Until mid-August.</p>

<p>By some quirk of fate Greg McCarroll, Richard, and I were all simultaneously &#39;resting&#39; between jobs. Being fun-loving, crazy people we decided that the most constructive use of time was to congregate at Greg&#39;s, drink his booze, and watch Kevin Smith films.</p>

<p>Instead, we wrote a mailing list manager. Well, I say &#34;instead&#34;, but we managed to do the other stuff too, which explains the Jay-and-Bob-themed test suite.</p>

<p>By the end of the day we had a whiteboard full of diagrams, a load of code in a CVS repository, a self-hosting mailing list (with hard-coded subscribers list, natch) and a sense of impending hangovers. Then disaster struck. We all got jobs. And Siesta, as we&#39;d decided to call our nascent MLM, lay dormant.</p>

<p>For about 6 months she lay sleeping.</p>

<p>Then, for whatever reason, in about March the dev team, bolstered by a couple of new member-cum-agitprops, began to churn out the patches again. The project was re-housed from SourceForge to siesta.unixbeard.net -- entailing a move to Subversion along the way.</p>

<p>The code was cleaned up, ported to <code>Class::DBI</code> and the <code>Email::*</code> hierarchy of modules and various <a href='http://www.ai.mit.edu/lab/gsb/gsb-archive/gsb2000%2D02%2D11.html'>yaks were shaved</a> along the way, features were added, and a new <code>Template::Toolkit</code>-based mail archiver (named Mariachi) was written.</p>

<p>The first release of Siesta went onto CPAN on July 24, just in time for Richard to give his talk at YAPC Europe in Paris -- an event that involved, somewhat inexplicably, several members of the audience drinking a shot of tequila whenever the word &#39;Siesta&#39; was mentioned and then giving 50 Euros to YAS. Needless to say, much fun was had by all.</p>

<h3><a name="So_why_should_I_use_Siesta?">So Why Should I Use Siesta?</a></h3>

<p>Good question. Mailman, Majordomo, or a host of other MLMs usually suffice.</p>

<p>On the other hand, competition is always good and Siesta was designed from the ground up to be easily understandable and easily extensible.</p>

<p>In short, Siesta will almost certainly be able to do anything you want, although you may have to write the plug-in in to do it.</p>

<p>Writing something to check whether an incoming email address is valid is a matter of about 10 lines, most of which are boilerplate. A SpamAssassin plug-in would be of similar length. Writing something that required all mails to the list to be PGP-signed and encrypted with the list&#39;s public key, and then which signed and encrypted all outgoing mail, would be relatively trivial.</p>

<p>And with the concept of user preferences you never have to put up with incessant whining about Reply-To munging since the list members can configure it (or any other plug-in you deem fit) however they want.</p>

<p>Bliss.</p>

<p>As an example of how customizable Siesta is, Richard Clamp runs a mailing list called Hates-Software for people who, err, hate software.</p>

<p>Running on subclassed versions of Mariachi (the mailing list
archiver) Hates-Software has archives for the whole list and also
for every single member so my rants are archived at <a href="http://muttley.hates-software.com">http://muttley.hates-software.com/</a>,
but are also part of the seething maelstrom of hate that is <a href="http://we.hates-software.com/">http://we.hates-software.com/</a>.</p>

<h3><a name="Running_a_list">Running a List</a></h3>

<p>There are currently two ways of administering your Siesta installation (not including fiddling around with the DB manually, of course), and these are with the web interface and with the command line tool <i>nacho</i>.</p>

<p>Now, to be frank, the web interface sucks at the moment and needs an overhaul, some prettification, and a whole lot of usability work. But it&#39;s all open source and written in Template Toolkit, so you can fix it up, skin it however you want, and then send us the patches. Ah, the magic of the free software movement.</p>

<p>Instead, we&#39;ll concentrate on <i>nacho</i>; it&#39;s surprisingly powerful and just a shell prompt away.</p>

<p><i>nacho</i> has full documentation embedded as POD, but the version checked into the repository will also, handily, provide a list of commands by doing:</p>

<pre><code>  % nacho help</code></pre>

<p>Or the syntax of a specific command by doing:</p>

<pre><code>  % nacho help &#60;command&#62;</code></pre>

<p>Like this:</p>

<pre><code>  % nacho help set-plugins

  set-plugins list_id queue [ plugin [ plugin... ] ]
  -
  Set the list plugins to be the ones specified.</code></pre>

<p>Anyway ... first things first.</p>

<h4><a name="Setting_up_the_database">Setting up the Database</a></h4>

<p>The first thing you need to do is create a database.</p>

<p>Fortunately this is easy. Running:</p>

<pre><code>    % nacho create-database</code></pre>

<p>should do everything for you (providing the config in your siesta.conf is OK).</p>

<h4><a name="Migrating_a_list_from_Mailman">Migrating a List from Mailman</a></h4>

<p>Use the <i>bandito</i> tool shipped with Siesta to steal the config of your existing Mailman configuration -- given the path to a mailman list config database, it should automatically create a new Siesta list, subscribe any necessary users, set up configs, and generally "just work."</p>

<p>It will even migrate your archives across for you.</p>

<p>How handy.</p>

<h4><a name="Creating_a_list_by_hand">Creating a List by Hand</a></h4>

<p>Run this command:</p>

<pre><code>  % nacho create-list myfirstlist admin@thegestalt.org \
                     myfirstlist@thegestalt.org \ 
             myfirstlist-bounce@thegestalt.org</code></pre>

<p>Which will print out:</p>

<pre><code>  Created the new list &#39;myfirstlist&#39; &#60;myfirstlist@thegestalt.org&#62; </code></pre>

<p>Paste this into your alias file to activate the list:</p>

  <pre><code>  ## myfirstlist mailing list
  ## created: 06-Sep-2002 nacho (the siesta config tool)
  myfirstlist:       &#34;/usr/bin/tequila myfirstlist&#34;
  myfirstlist-sub:   &#34;/usr/bin/tequila myfirstlist sub&#34;
  myfirstlist-unsub: &#34;/usr/bin/tequila myfirstlist unsub&#34;
  myfirstlist-admin:  admin@thegestalt.org 
  myfirstlist-bounce: admin@thegestalt.org</code></pre>

<p>This prints out the appropriate aliases to put in your <code>/etc/alias</code> (or equivalent) file. This can be printed out again at anytime by doing:</p>

<pre><code>  % nacho show-alias myfirstlist

  ## myfirstlist mailing list
  ## created: 06-Sep-2002 nacho (the siesta config tool)
  myfirstlist:       &#34;/usr/bin/tequila myfirstlist&#34;
  myfirstlist-sub:   &#34;/usr/bin/tequila myfirstlist sub&#34;
  myfirstlist-unsub: &#34;/usr/bin/tequila myfirstlist unsub&#34;
  myfirstlist-admin:  admin@thegestalt.orb
  myfirstlist-bounce: admin@thegestalt.orb</code></pre>

<p>At which point you probably want to add some plug-ins.</p>

<pre><code>  % nacho set-plugins myfirstlist post Debounce ListHeaders Send     
  % nacho set-plugins myfirstlist sub Subscribe
  % nacho set-plugins myfirstlist unsub UnSubscribe</code></pre>

<p>This means that for the <code>myfirstlist</code> list, when it sees a post, it should first remove bounces, then add list headers, then call the <code>Send</code> plug-in to send it out. Similarly, subscribes and unsubscribes go through the normal <code>Subscribe</code> and <code>UnSubscribe</code> plug-ins.</p>

<p>If you want to find all the lists on the system you just do:</p>

<pre><code>  % nacho show-lists
  myfirstlist</code></pre>

<p>And then to look at the information for a list, do this:</p>

<pre><code>  % nacho describe-list myfirstlist
  owner = 1
  return_path = myfirstlist-bounce@thegestalt.orb
  post_address = myfirstlist@thegestalt.orb
  name = myfirstlist
  id = 2
  post plugins : MembersOnly ListHeaders Send 
  sub plugins: Subscribe
  unsub plugins: UnSubscribe</code></pre>

<p>Or to modify that information:</p>

<pre><code>  % nacho modify-list myfirstlist name somenewname
  Property &#39;name&#39; set to &#39;somenewname&#39; for list myfirstlist</code></pre>

<p>TIP: If you modify the id then what will actually happen is that a new list will be created with that id, but with information exactly the same as the details for the previous list.</p>

<h4><a name="Creating_Members">Creating Members</a></h4>

<p>You can either subscribe members manually by creating them and inserting them using nacho:</p>

<pre><code>  % nacho create-member simon@thegestalt.orb
  Member simon@thegestalt.orb added    

  % nacho add-member myfirstlist simon@thegestalt.orb
  Member &#39;simon@thegestalt.orb&#39; added to list &#39;myfirstlist&#39;</code></pre>

<p>Or, nacho will automatically create members if they don&#39;t exist.</p>

<pre><code>  % nacho add-member myfirstlist newmember@notexists.orb</code></pre>

<p>You can add multiple people at the same time. Que Conveniente!</p>

<pre><code>  % nacho add-member myfirstlist richardc@unibeard.not greg@mccarroll.demon.com
  Member &#39;richardc@unixbeard.not&#39; added to list &#39;myfirstlist&#39;
  Member &#39;greg@mccarroll.demon.com&#39; added to list &#39;myfirstlist&#39;</code></pre>

<p>Finally a person can subscribe by mailing to the:</p>

<pre><code>    myfirstlist-sub@yourdomainhere.orb </code></pre>

<p>address, or by going through the web interface.</p>

<h4><a name="Managing_members">Managing Members</a></h4>

<p>You can get a list of every member that&#39;s on the system:</p>

<pre><code>  % nacho show-members
  greg@mccarroll.demon.com
  richardc@unixbeard.not
  simon@thegestalt.orb</code></pre>

<p>Or just the members subbed to a particular list:</p>

<pre><code>  % nacho show-members myfirstlist</code></pre>

<p>To find out all about a member, use the describe command:</p>

<pre><code>  % nacho describe-member simon@thegestalt.orb

    email = simon@thegestalt.orb
    lastbounce =
    bouncing =
    password = bar
    nomail =
    id = 36
    Subscribed to : myfirstlist, somerandomlist</code></pre>

<p>To modify information about that information:</p>

<pre><code>  % nacho modify-member simon@thegestalt.orb password foo
  Property &#39;password&#39; set to &#39;foo&#39; for member simon@thegestalt.org</code></pre>

<p>Again, just changing the id will copy the member:</p>

<h4><a name="Managing_Plugins">Managing Plug-ins</a></h4>

<p>You can list all the plug-ins installed on the system:</p>

<pre><code>  % nacho show-plugins
  Archive
   -
   save messages to maildirs
  ...
  UnSubscribe
   -
   A system plugin used for unsubscribing a member to the list.</code></pre>

<p>Since plug-ins are "just" normal Perl modules, you can write your own or download plug-ins other people have written and install them like any other module. Siesta will automatically detect them.</p>

<p>To set the plug-in order explicity, do this:</p>

<pre><code>  % nacho set-plugins myfirstlist post Debounce SimpleSig SubjectTag Send</code></pre>

<p>The "post" part is the queue you want these attached to. By default here are three: "post," "sub," and "unsub," but there can be as many as you want. They serve to differentiate the different modes the list might run in. So, for example, you could have a "help" queue that responds to help requests, or a "FAQ" queue that tries to answer questions.</p>

<p>To delete all the plug-ins, just pass an empty list</p>

<pre><code>  % nacho set-plugins myfirstlist post
  Deleted plugins from siesta-dev</code></pre>

<p>It should be noted that you probably always want to have the Send plug-in (or a replacement plug-in) as the last plug-in.</p>

<p>To get more information about a plug-in, you can either:</p>

<pre><code>  % perldoc Siesta::Plugin::ReplyTo</code></pre>

<p>Or ...</p>

<pre><code>  % nacho describe-plugin ReplyTo
  The plugin ReplyTo has the following options :
  - munge : should we munge the reply-to address of the 
    message to be the list post address</code></pre>

<p>To find out what the current config for a list is, just add the list name.</p>

<pre><code>  % nacho describe-plugin ReplyTo myfirstlist
  Preferences for list myfirstlist
  - munge : 0</code></pre>

<p>And to find out a member's config options, add his or her email address:</p>

<pre><code>  % nacho describe-plugin ReplyTo myfirstlist simon@thegestalt.orb
  Personal preferences for member simon@thegestalt.orb on list myfirstlist
  - munge : 1</code></pre>

<p>To modify configuration for any of these:</p>

<pre><code>  % $ nacho modify-plugin ReplyTo box munge 0                     
  Preferences for list box
  - munge : 0</code></pre>

<p>However, you can also set a preference on a per-member basis:</p>

<pre><code>  % nacho modify-plugin ReplyTo box munge 1 simon@thegestalt.org
  Personal preferences for member simon@thegestalt.org on list box
  - munge : 1</code></pre>

<h4><a name="Removing_Members">Removing Members</a></h4>

<p> Occasionally a member will want to leave (or will need to be pushed) and you&#39;ll need to do this by hand. To remove a member from a list just do this:</p>

<pre><code>  % nacho remove-member myfirstlist greg@mccarroll.demon.com
  Member &#39;greg@mccarroll.demon.com&#39; removed from list &#39;myfirstlist&#39;</code></pre>

<h4><a name="Deleting_Members">Deleting Members</a></h4>

<p>Deleting members from the system will remove them from all the lists they&#39;re subscribed to, and then delete them from the system.</p>

<pre><code>  % nacho delete-member richardc@unixbeard.net 
  Member &#39;richardc@unixbeard.not&#39; deleted.</code></pre>

<h4><a name="Handling_deferred_messages">Handling Deferred Messages</a></h4>

<p>Deferred messages are ones being held for approval, or that contain administrative tasks.</p>

<p>You can see how many deferred messages there are by doing this:</p>

<pre><code>    % nacho show-deferred

    Deferred-Id: 1
    Reason: the hell of it
    Owner: test@foo

     From: simon@thegestalt.org
     To: people@somewhere.org
     Subject: some subject lin
     Date: Wed, 13 Aug 2003 15:49:30 +0100  </code></pre>

<p>Or you can view an individual message by supplying the id:</p>

<pre><code>    % nacho show-deferred 1
    From: simon@thegestalt.org
    To: people@somewhere.org
    Subject: some subject line
    Date: Wed, 13 Aug 2003 15:49:30 +0100  

    Hello people

    Simon</code></pre>

<p>To resume a message simply do this:</p>

<pre><code>    % nacho resume-deferred 1
    Successfully resumed message 1</code></pre>

<p>Alternatively, to delete a deferred message do this:</p>

<pre><code>    % nacho delete-deferred 1
    Message deleted from deferral queue</code></pre>

<h4><a name="Deleting_Lists">Deleting Lists</a></h4>

<p>Similarly deleting a list will unsub all members from that list and then remove it from the system.</p>

<pre><code>  % nacho delete-list myfirstlist
  List &#39;myfirstlist&#39; deleted</code></pre>

<h4><a name="Making_backups">Making Backups </a></h4>

<p>Running the command:</p>

<pre><code>    % nacho create-backup </code></pre>

<p>will print a shell script to STDOUT.</p>

<p>This shell script consists of nacho commands to restore your system to its glorious past should anything go wrong.</p>

<pre><code>    % nacho create-backup myfirstlist</code></pre>

<p>will do the same, but for only one list.</p>

<h4><a name="Upgrading">Upgrading</a></h4>

<p>Upgrading is easy -- simply make a backup as described above, install the latest version from CPAN, and then run the nacho-generated script to restore your system. Most of the time, however, unless the database has changed format, even that won&#39;t be necessary, and simply installing from CPAN should just be OK.</p>

<h3><a name="Writing_a_plugin">Writing a Plug-in</a></h3>

<p>Writing a plug-in for Siesta is easy. Say, for example, we wanted to take any supercited mails to the list and reform them into a less GNUSish format. First off, we start with the standard boilerplate:</p>

<pre><code>    package Siesta::Plugin::DeSupercite;
    use strict;
    use Siesta::Plugin;
    use base &#39;Siesta::Plugin&#39;;
    use Siesta;

    sub description {
        &#39;&#39;;
    } 


    sub process {
        my $self = shift;
        my $mail = shift;
        my $list = $self-&#62;list;

        return 0;
    };


    sub options {
        +{
         }
    };</code></pre>

<p>Add in the existing DeSuperciting module:</p>

<pre><code>    use Text::DeSupercite qw/desupercite/;</code></pre>

<p>Fill in the description:</p>

<pre><code>    sub description {
        &#39;Strip superciting from emails&#39;;
    } </code></pre>

<p>And the options:</p>

<pre><code>    sub options {
        +{
            harsh =&#62;
            {
               description =&#62;
               &#39;should we be draconian about desuperciting?&#39;,
               type    =&#62; &#39;boolean&#39;,
               default =&#62; 0,
            },
        };
    }</code></pre>

<p>And finally, fill in the body of the process method:</p>

<pre><code>    sub process {
        my $self = shift;
        my $mail = shift;
        my $list = $self-&#62;list;

        # automatically works out if this is user 
        # setable or not 
        my $harsh = $self-&#62;pref( &#39;harsh&#39; );

        # get the body text
        my $text = desupercite($mail-&#62;body(), $harsh);

        # set it back again
        $mail-&#62;body_set($text);

        # indicate success
        return 0;
    };</code></pre>

<p><i>Et voila</i>, one plug-in, ready to go. Now all you need to do is package it up and install it in your @INC and it&#39;ll get picked up automagically and will be ready to be added to any list on the system.</p>

<h3><a name="Mariachi">Mariachi</a></h3>

<p>Whilst completely independent of Siesta, our mailing list archiver Mariachi is still entwined with the whole project, if only because it gives us something to noodle around as a distraction from the mailing list manager. As such it deserves at least a quick mention here.</p>

<p>Apart from being easily subclassable, Mariachi has another couple of nice features. For a start, all the output templates are done in Template Toolkit, making it easy to customize to fit in with the look and feel of your site without having to delve around in the code.</p>

<p>It also allows you to display mail in a couple of nifty ways. The first is the classic Jwz-style message threading as used in Netscape and Mutt, complete with indentation, which makes following threads much easier. The second is the so-called Lurker view, named after the <a href="http://lurker.sourceforge.net/">Lurker application</a>, which appears to be the first application to use this chronological view of mail.</p>

<p>These both include the option to extract either the first original sentence or paragraph from a mail, meaning that many threads can be easily skimmed without having to open up individual messages.</p>

<p>In addition, Richard has already written a module that will generate
an SVG of a mail thread in the Arc form described <a href="http://www.research.ibm.com/remail/">here</a>.</p>

<p>Perhaps Mariachi&#39;s only problem is that because it does not split mail up over arbitrary boundaries (although there&#39;s nothing to stop the users from doing this themselves), generating archives from a massive mail box (such as every London.pm mail from the last 5 years) can be slow, even if it is done incrementally.</p>

<p>However, work is being done to overcome this.</p>

<h3><a name="Conclusion">Conclusion</a></h3>

<p>Although unfinished, we believe that Siesta is already a hugely powerful mailing list manager with almost unrivalled extensibility.</p>

<p>Breathless superlatives aside, and irrespective of whether it ever gets widely used, it will forever shut up those who whine on mailing lists that there&#39;s no good Perl MLM or that they wish there was an MLM that had plug-ins. Perhaps most importantly, you have somewhere to point anybody whoever complains about Reply-To munging, since with Siesta, each user can choose whether or not they want Reply-To munging applied.</p>

<p>In a more practical sense, while working on Siesta the team has written or patched nearly 20 modules outside the ones distributed with Mariachi and Siesta. So something for everybody.</p>

<p>If you're interested in getting involved with the project, just install the programs (they should work from your favorite CPAN shell), make notes on anything you find irritating, join the mailing list, and tell us about it. Then start patching, writing plug-ins or, and if you're the kind of person who likes doing web page stuff, fix the web interface. We&#39;ll love you forever. And you&#39;ll get to drink tequila at Perl conferences like all the cool kids.</p>

<h3><a name="References">References</a></h3>

<ul>
<li>
<a href="http://siesta.unixbeard.net">The Siesta home page</a></li>

<li> <a href="http://hates-software.com">Hates-Software</a></li>


<li> <a href="http://london.pm.org/pipermail/london.pm/Week-of-Mon-20020701/011937.html">*That* thread</a></li>

<li>
<a href="http://london.pm.org/pipermail/london.pm/Week-of-Mon-20020729/012366.html">And *again*</a></li>


<li>
<a href="http://simon-cozens.org/draft-articles/email.html">The philosophy of the Email::* project</a></li>
</ul>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-880" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/02/p6pdigest/20040201.html" rel="bookmark">This week on Perl 6, week ending 2004-02-01</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-02-01T00:00:00-08:00">February  1, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>Welcome once again to Gateshead,
where the skies are grey,
the view is uninspiring,
and the workmen across the road seem determined to fall off the ladder before they get the double glazing fitted.</p>

<p>But enough of the gay Gateshead life,
let&#39;s hurry on to the doings of the denizens of the perl6&#45;internals mailing list.
Who knows,
we might even visit the inmates of perl6&#45;language later.</p>

<h4><a name="Threading">Threading</a></h4>

<p>To nobody&#39;s great surprise,
we talked about threading.
In particular,
Gordon Henriksen&#39;s concerns about the all around scariness of <code lang='und' xml:lang='und'>morph</code> (and not just in a threading context).
I&#39;m not sure I quite understand what&#39;s being done,
but progress is definitely being made.</p>

<p>Late in the week Dan announced that there were obviously still issues to be worked out before we started in on implementation (modulo some &#39;obvious&#39; stuff).
He also asked for &#39;real worldish&#39; tests for threading in order to get some real numbers for different possible approaches and to see if the problem is as bad as it was first thought.</p>

<p><a href='http://groups.google.com/groups?selm=a06010205bc3e9930bcac@[192.168.1.28]'>http://groups.google.com/groups</a></p>

<p><a href='http://groups.google.com/groups?selm=5.1.1.6.2.20040128122120.09f96948@pop.mindspring.com'>http://groups.google.com/groups</a></p>

<h4><a name="Embedding_vs._extending_interface_types">Embedding vs.
extending interface types</a></h4>

<p>Remember last week&#39;s kerfuffle about <code lang='und' xml:lang='und'>Parrot_Interp</code> vs <code lang='und' xml:lang='und'>Parrot_INTERP</code>?
Dan&#39;s resolved it be deciding that we&#39;ll just call it <code lang='und' xml:lang='und'>Parrot_Interp</code> everywhere.
Gordon Henriksen sent in the patch.</p>

<p><a href='http://groups.google.com/groups?selm=a06010208bc3e9e36ea11@[192.168.1.28]'>http://groups.google.com/groups</a></p>

<h4><a name="Leo_explains">Leo explains</a></h4>

<csperl file="grab" domain="on" record="b/940" template="b/article_sidebar.view">

<p>Will Coleda (and others) have been having problems with data that should be inviolate getting clobbered in strange ways.
After some effort,
Will got his offending code down to 22 lines.
This let Leo T&#246;tsch work out what was going on,
and in the referenced post he explained all.
Essentially,
the Copy on Write logic for handling register (and other) stacks is broken.
The workaround is not to use Continuations and Exception Handlers.
Fixes are welcome.
Please.</p>

<p><a href='http://groups.google.com/groups?selm=40177A46.6060308@toetsch.at'>http://groups.google.com/groups</a></p>

<h4><a name="Testing_Signal_Handlers">Testing Signal Handlers</a></h4>

<p>Leo asked for help with sorting out the testing code for some signal handling tests that seemed to be confusing the harness quite badly.
Uri Guttman came up with some suggested workarounds,
as did Mike Schwern.
Leo found a third way.
(If you&#39;ve ever tried to write test with <code lang='und' xml:lang='und'>fork</code> in it,
it&#39;s worth taking a look at both Uri and Schwern&#39;s answers.</p>

<p><a href='http://groups.google.com/groups?selm=401639A9.8030107@toetsch.at'>http://groups.google.com/groups</a></p>

<h4><a name="The_costs_of_sharing_revisited">The costs of sharing revisited</a></h4>

<p>Last week,
Leo posted some scary numbers implying that using a shared PMC led to terrible slowdowns.
This week he posted the latest numbers,
and things are looking up.</p>

<pre lang='und' xml:lang='und'>   $ time perl&#45;58&#45;th shared_ref.pl

   real 0m8.694s

   $ time parrot shared_ref.pasm

   real 0m0.375</pre>

<p>(and that&#39;s an unoptimized Parrot). Elizabeth Mattijsen was moved to ask for a ponie.</p>

<p><a href='http://groups.google.com/groups?selm=40178375.8080103@toetsch.at'>http://groups.google.com/groups</a></p>

<h4><a name="Cunning_stunts_with_with_UnManagedStruct">Cunning stunts with with UnManagedStruct</a></h4>

<p>Donning his devious head, Leo demonstrated the use of UnManagedStruct to allow for unlimited self&#45;inspection and self&#45;modification of Parrot state. Which isn&#39;t really something we want to be possible. In the opinion of Luke Palmer and Jeff Clites, the costs of removing this capability aren&#39;t worth paying. As Jeff Clites pointed out, you only use UnManagedStructs when you&#39;re calling out to a native library, and once you introduce a native library all bets are already off.</p>

<p><a href='http://groups.google.com/groups?selm=401683E8.8000505@toetsch.at'>http://groups.google.com/groups</a></p>

<h4><a name="Michael_Scott:_hero_of_the_week">Michael Scott: hero of the week</a></h4>

<p>Over the past few weeks Michael Scott has gradually been making the parrot distribution a kinder, gentler place with his sterling efforts to tidy up and generally improve the existing documentation. This week he rationalized/added documentation for everything in <em lang='und' xml:lang='und'>src/</em> (with the exception of <em lang='und' xml:lang='und'>malloc.c</em> and <em lang='und' xml:lang='und'>malloc&#45;trace.c</em>). He&#39;s working on documenting <em lang='und' xml:lang='und'>examples/</em> now.</p>

<p>The response to his announcement was overwhelmingly and understandably positive (The consensus is that Mike rocks). Now if we can just <i>keep</i> everything in such good condition...</p>

<p><a href='http://groups.google.com/groups?selm=DDED1473&#45;5287&#45;11D8&#45;8781&#45;000A95C50226@mac.com'>http://groups.google.com/groups</a></p>

<h4><a name="Parrot_DBDI_announced">Parrot DBDI announced</a></h4>

<p>Tim &#34;Perl DBI&#34; Bunce announced the Parrot DBDI Project: A Database Driver Interface for Parrot. The goal is to have a common Parrot level interface to database drivers which can then be reused by different language specific database interfaces. For further details read the post; it&#39;s jolly good. And bravo Tim.</p>

<p><a href='http://groups.google.com/groups?selm=20040127225639.GF38394@dansat.data&#45;plan.com'>http://groups.google.com/groups</a></p>

<h4><a name="Internal_exception_handlers">Internal exception handlers</a></h4>

<p>Leo posted a set of macros for doing exception handling in the parrot core using <code lang='und' xml:lang='und'>TRY/CATCH/THROW</code> etc. and asked for comments. So far he&#39;s been Warnocked.</p>

<p><a href='http://groups.google.com/groups?selm=4018D0CD.4080106@toetsch.at'>http://groups.google.com/groups</a></p>

<h4><a name="SDL_bindings">SDL bindings</a></h4>

<p>After Leo fixed the struct PMCs for him, chromatic has proceeded apace to implement SDL wrappers in Parrot. He&#39;s reached the point where he has code that can create an SDL window and blit a blue rectangle onto it. Leo applied his patches. Check out <em lang='und' xml:lang='und'>examples/pni/sdl_blue_rectangle.imc</em> if you&#39;re interested.</p>

<p><a href='http://groups.google.com/groups?selm=1075537672.12245.178.camel@localhost'>http://groups.google.com/groups</a></p>

<h3><a name="Meanwhile,_in_perl6&#45;language">Meanwhile, in perl6&#45;language</a></h3>

<p>Discussions continued to test the encode setups of the participants&#39; mail readers...</p>

<h4><a name="Semantics_of_vector_operations">Semantics of vector operations</a></h4>

<p>A sub&#45;thread of the discussion of the semantics of vector operations turned into a discussion of the meaning of &#39;vector&#39; which has different meanings depending on whether you&#39;re a mathematician or Seymour Cray.</p>

<p>Another sub&#45;thread discussed the possible ASCII alternatives for <code lang='und' xml:lang='und'>&#171;</code> and <code lang='und' xml:lang='und'>&#187;</code>. I&#39;m afraid I&#39;m going to bottle out of attempting to summarize the various alternatives suggested, if only because I used up all my POD escape&#45;fu last week. It looks like the <code lang='und' xml:lang='und'>&#60;&#60;</code> and <code lang='und' xml:lang='und'>&#62;&#62;</code> alternatives might be about to bite the dust in favour of an as yet undecided, less ambiguous, new scheme. Larry hasn&#39;t ruled on it yet though.</p>

<p><a href='http://groups.google.com/groups?selm=401720E1.2030009@conway.org'>http://groups.google.com/groups</a></p>

<h3><a name="Acknowledgements,_Apologies,_Announcements">Acknowledgements, Apologies, Announcements</a></h3>

<p>I&#39;d just like to announce that, if you haven&#39;t seen Eliza Carthy perform life, you owe it to yourself to rectify that. We went to see her last night and it&#39;s bucked me up enormously.</p>

<p>If you find these summaries useful or enjoyable, please consider contributing to the Perl Foundation to help support the development of Perl. You might also like to send me feedback at <a href='TODO'>p6summarizer@bofh.org.uk</a>, or drop by my website.</p>

<p><a href='http://donate.perl&#45;foundation.org/'>http://donate.perl&#45;foundation.org/</a> &#45;&#45; The Perl Foundation</p>

<p><a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> &#45;&#45; Perl 6 Development site</p>

<p><a href='http://www.bofh.org.uk/'>http://www.bofh.org.uk/</a> &#45;&#45; My website, &#34;Just a Summary&#34;</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2004/01/">&laquo; January 2004</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2004/03/">March 2004 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
