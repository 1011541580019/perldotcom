<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: June 2004 Archives</title>


    <link rel="prev" href="/pub/2004/05/" title="May 2004" />
    <link rel="next" href="/pub/2004/07/" title="July 2004" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">June 2004 Archives</h1>





                            
                            <div id="entry-950" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/06/p6pdigest/20040621.html" rel="bookmark">This Week on Perl 6, Fortnight Ending 2004-06-21</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-06-24T00:00:00-08:00">June 24, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>Good evening.
You find me typing away in a motel room on the edge of the Lake District on the shortest night of the year.
I suppose,
by rites,
I should be spending the night by some stone circle drinking,
dancing, and generally making merry,
but as I'm a teetotalling,
unfit,
atheistical nerd with a mission to summarize, I'll skip that and plough straight into the activities of another arcane sect.
Yes,
it's perl6-internals again ...</p>

<h4><a name="Toward_an_accurate_README">Toward an Accurate README</a></h4>

<p>Andy Dougherty sent in a patch adjusting the Parrot README so that it accurately reflected the toolset needed to build parrot.
For some reason,
as well as the requirement for a C++ compiler if you want to build the ICU library,
we've moved to needing Perl 5.6.0 rather than 5.005.
Nicholas Clark suggested that,
rather than bumping the Perl version requirement,
we bundle appropriate versions of modules Parrot required,
but chromatic thought it better to check the for the correct versions of said modules at Configure time and bail out if they weren't there.</p>

<csperl file="grab" domain="on" record="b/1424" template="b/article_sidebar2.view">

<p>There was further discussion about whether going to Perl 5.6.0 as a requirement was the right thing to do -- the issue is that some OSes (FreeBSD and Solaris 8 were cited) still only ship with 5.005 family Perls.
My feeling (which I didn't mention in the thread,
more fool me) is that,
as eventually the goal is to eliminate the need for Perl at all in the build process,
requiring 5.6.0 rather than 5.005 isn't exactly the end of the world.</p>



<p><a href='http://groups.google.com/groups?selm=rt-3.0.9-30095-89885.16.61061401395@perl.org'>http://groups.google.com/groups?selm=rt-3.0.9-30095-89885.16.61061401395@perl.org</a></p>

<p><a href='http://groups.google.com/groups?selm=Pine.SOL.4.58.0406091317550.12666@maxwell.phys.lafayette.edu'>http://groups.google.com/groups?selm=Pine.SOL.4.58.0406091317550.12666@maxwell.phys.lafayette.edu</a></p>

<h4><a name="OS_X_Builds_again">OS X Builds Again</a></h4>

<p>Someone finally summoned up the tuits to fix the OS X build.
Step forward Nicholas Clark and accept your plaudits.</p>

<p><a href='http://groups.google.com/groups?selm=a06110404bcee2724f70a@[10.0.1.3]'>http://groups.google.com/groups?selm=a06110404bcee2724f70a@[10.0.1.3]</a></p>

<h4><a name="Basics_of_the_PMC_class_set">Basics of the PMC Class Set</a></h4>

<p>Dan announced that he was about to make some changes to the repository,
including establishing a basic set of PMC classes.
Matt Fowles wondered about Array PMCs,
which seemed to be missing from Dan's list.
Dan agreed that they should be rationalized as well.</p>

<p>Bernhard Schmalhofer suggested adding a complex number class to Dan's basic menagerie,
but Dan was unconvinced.</p>

<p><a href='http://groups.google.com/groups?selm=a06110402bcee766bc83c@[172.24.18.98]'>http://groups.google.com/groups?selm=a06110402bcee766bc83c@[172.24.18.98]</a></p>

<h4><a name="Correct_use_of_#define">Correct Use of #define</a></h4>

<p>Nicholas Clark was moved to growl by a section of <em>include/parrot/string.h</em> that used a #define to define a type.
Actually,
he was moved to 'swearing and cursing and time wasted grepping to find out what a STRING is'.
Dan agreed that this was bad and decreed: 'Typedefs for types,
#defines for constants and bizarre (<i>temporary!</i>) debugging things.'</p>

<p><a href='http://groups.google.com/groups?selm=20040611095043.GB81272@plum.flirble.org'>http://groups.google.com/groups?selm=20040611095043.GB81272@plum.flirble.org</a></p>

<h4><a name="The_next_release">The Next Release</a></h4>

<p>During a lull while Leo T&ouml;tsch was away at a conference,
Dan mused on the next release of parrot.
His goal for that is a rejig of <em>classes/</em>,
aiming to make sure that all the PMCs we want are in and working,
and that the ones we don't care about are neatly deprecated.</p>

<p>Warnock applies.</p>

<p><a href='http://groups.google.com/groups?selm=a06110409bcefa5f8c6ff@[10.0.1.3]'>http://groups.google.com/groups?selm=a06110409bcefa5f8c6ff@[10.0.1.3]</a></p>

<h4><a name="A_small_task_for_the_interested">A Small Task for the Interested</a></h4>

<p>Stretching the definition of 'small' somewhat,
Dan asked for volunteers to implement the missing PMCs detailed in PDD 17.
He reckoned it should be 'fairly straightforward'.
A new entrant in these summaries,
Ion Alexandru Morega took a crack at the String PMC and posted a patch to the list which was promptly ignored.
Which seems a little unfair really.</p>

<p><a href='http://groups.google.com/groups?selm=a0611040abcefb912413e@[10.0.1.3]'>http://groups.google.com/groups?selm=a0611040abcefb912413e@[10.0.1.3]</a></p>

<h4><a name="Bignums!">Bignums!</a></h4>

<p>Dan asked for a volunteer to get Bignums working.
Alin Iacob stepped up to the plate.
Leo suggested that,
rather than starting from <em>types/bignum.c</em>,
it might be better to use an existing,
maintained,
maths (Look,
I'll spell 'summarise' with a 'z' -- the OED does -- but it will be a cold,
cold day in hell when I start abbreviating 'mathematics' as 'math'.
Ahem.) package.
Dan worried about license compatibility; the proposed GMP package is licensed under the LGPL which may (or may not) be compatible with Parrots Artistic/GPL dual licence.
After a closer reading he reckoned that GMP's license is definitely incompatible with Parrot.</p>

<p><a href='http://groups.google.com/groups?selm=a0611040bbcefb9fb77e6@[10.0.1.3]'>http://groups.google.com/groups?selm=a0611040bbcefb9fb77e6@[10.0.1.3]</a></p>

<h4><a name="Adding_Fixed*Array_classes">Adding Fixed*Array Classes</a></h4>

<p>Matt Fowles posted a patch implementing Fixed Array classes.
Dan applied it.
Leo wondered about the patch's use of malloc(3) instead of Parrot's memory management.
Dan wasn't worried in the case of fixed size arrays.</p>

<p><a href='http://groups.google.com/groups?selm=rt-3.0.9-30230-90377.3.32088317231715@perl.org'>http://groups.google.com/groups?selm=rt-3.0.9-30230-90377.3.32088317231715@perl.org</a></p>

<h4><a name="Resizeable*Array_classes">Resizeable*Array Classes</a></h4>

<p>Fresh from his Fixed Array triumph,
Matt Fowles posted a patch implementing naive Resizeable Arrays.
Leo thought it a little too naive,
and worried about duplication of existing functionality.
Dan wasn't worried about the naivete,
or the duplication of functionality.
He pointed out that it was more important to get <i>something</i> which could be improved and that the duplication was okay given that the idea was to get a standard framework in place and then eliminate the duplication.
(I admit that I'm a little surprised to hear Dan,
who's normally a strong advocate of up front design,
preaching the refactorers creed...)</p>

<p><a href='http://groups.google.com/groups?selm=rt-3.0.9-30245-90438.1.98115444593533@perl.org'>http://groups.google.com/groups?selm=rt-3.0.9-30245-90438.1.98115444593533@perl.org</a></p>

<h4><a name="Making_PMCs">Making PMCs</a></h4>

<p>Nicholas Clark wondered how to go about making a PMC,
pointing out that the documentation is rather sparse.
He had a bunch of questions for the Men Who Know.
Matt Fowles and Dan Sugalski came up with answers.
Leo wrote a document and checked it in as <em>docs/pmc.pod</em>.
If you're interested in implementing a PMC,
you'd do well to read it.</p>

<p><a href='http://groups.google.com/groups?selm=20040613100125.GG81272@plum.flirble.org'>http://groups.google.com/groups?selm=20040613100125.GG81272@plum.flirble.org</a></p>

<h4><a name="Slices_and_iterators">Slices and Iterators</a></h4>

<p>Continuing his campaign to spec out more and more of Parrot,
Dan set to work on defining and documenting Parrot's handling of slices and iterators.
It appears that array slicing syntax is one of those topics where you can't please everyone; Dan's post generated a good deal of discussion.</p>

<p>Dan added more in a later post and,
in later post still,
threw up his hands and asked for a volunteer to define the iterator protocol.</p>

<p><a href='http://groups.google.com/groups?selm=a06110409bcf382d914cc@[10.0.1.3]'>http://groups.google.com/groups?selm=a06110409bcf382d914cc@[10.0.1.3]</a></p>

<p><a href='http://groups.google.com/groups?selm=a06110409bcf4cf7b179c@[172.24.18.98]'>http://groups.google.com/groups?selm=a06110409bcf4cf7b179c@[172.24.18.98]</a></p>

<p><a href='http://groups.google.com/groups?selm=a0611040bbcf4ecb9f27f@[172.24.18.98]'>http://groups.google.com/groups?selm=a0611040bbcf4ecb9f27f@[172.24.18.98]</a></p>

<h4><a name="Iterator_semantics">Iterator semantics</a></h4>

<p>Having a syntax is all very well,
but you need to define what it <i>means</i> too.
So Dan did.</p>

<p><a href='http://groups.google.com/groups?selm=a0611040abcf38b01fe20@[10.0.1.3]'>http://groups.google.com/groups?selm=a0611040abcf38b01fe20@[10.0.1.3]</a></p>

<h4><a name="Some_rationale_for_Parrot's_mixed_encoding_scheme">Some rationale for Parrot's mixed encoding scheme</a></h4>

<p>Argh!
Unicode!
Run away!</p>

<p>Dan posted the rationale for his design for Parrot's strings,
in particular the decision to defer conversion of strings to Unicode.
Amazingly,
there was no argument.</p>

<p><a href='http://groups.google.com/groups?selm=a0611041bbcf3f6bd3ee8@[10.0.1.3]'>http://groups.google.com/groups?selm=a0611041bbcf3f6bd3ee8@[10.0.1.3]</a></p>

<h4><a name="Strings._Finally.">Strings. Finally.</a></h4>

<p>Dan posted &quot;the official,
1.0,
final version&quot; of the Parrot Strings document.
Modulo a caveat about the use of 'grapheme' it looks like this one might stick.</p>

<p><a href='http://groups.google.com/groups?selm=a06110418bcf3bff76821@[10.0.1.3]'>http://groups.google.com/groups?selm=a06110418bcf3bff76821@[10.0.1.3]</a></p>

<h4><a name="Strings_internals">Strings' Internals</a></h4>

<p>Having got a Strings spec that people seemed to agree on,
Dan went on to discuss how parrot's strings should work internally.
He and Mark A Biggar ironed out a few wrinkles.</p>

<p><a href='http://groups.google.com/groups?selm=a06110403bcf61a2185f0@[10.0.1.3]'>http://groups.google.com/groups?selm=a06110403bcf61a2185f0@[10.0.1.3]</a></p>

<h4><a name="Fixing_pbc2c.pl">Fixing pbc2c.pl</a></h4>

<p>Dan asked for volunteers to get <em>build_tools/pbc2c.pl</em> working and/or write a test suite for it.</p>

<p><a href='http://groups.google.com/groups?selm=a06110402bcf79fccdc91@[10.0.1.3]'>http://groups.google.com/groups?selm=a06110402bcf79fccdc91@[10.0.1.3]</a></p>

<h4><a name="PIO_unix_pipe">PIO_unix_pipe</a></h4>

<p>Leo's extended Parrot's <code lang='und' xml:lang='und'>open</code> opcode to allow for opening a unix pipe rather than simply a file.
There were issues with passing arguments to the the program being piped to/from,
but Dan came up with a suggested <code lang='und' xml:lang='und'>backtick</code> opcode whose semantics were liked,
but whose necessity and name were called into question.
Leo pointed out that the major credit for the functionality belongs to Melvin Smith; Leo merely implemented a means to get at the functionality from parrot code.</p>

<p><a href='http://groups.google.com/groups?selm=200406071207.i57C7bh27980@thu8.leo.home'>http://groups.google.com/groups?selm=200406071207.i57C7bh27980@thu8.leo.home</a></p>

<h4><a name="Teapots!">Teapots!</a></h4>

<p>Nick Glencross wants us all to look at his shiny SDL teapots; the poor man's wife is apparently underwhelmed,
so let's all make with the &quot;Wooo!
Well done that man!&quot;.</p>

<h4><a name="Simple_trinary_ops">Simple Trinary Ops</a></h4>

<p>Dan toyed with adding a couple of non-flowcontrol min/max ops along the lines of</p>

<pre><code>    min $P1, $P2, $P2 # Sets $P1 to the lesser of $P2 and $P3</code></pre>

<p>He noted that such ops would make some of the code he was generating much simpler, but wasn't sure if that particular itch needed to be scratched with a new op. He was rapidly convinced that it wasn't a good idea (I wouldn't be surprised to discover that he was convinced of this about 10 seconds after he hit the 'send' button for the thread's root message).</p>

<p>Steve Fink attempted to resurrect the idea by proposing a single <code lang='und' xml:lang='und'>choose</code> operator, which looks rather neat, but is probably still unnecessary.</p>

<p><a href='http://groups.google.com/groups?selm=a06110404bcf6254d244e@[10.0.1.3]'>http://groups.google.com/groups?selm=a06110404bcf6254d244e@[10.0.1.3]</a></p>

<h3><a name="Meanwhile,_in_perl6-language">Meanwhile, in perl6-language</a></h3>

<h4><a name="Cawley's_Corollary_to_Godwin's_Law">Cawley's Corollary to Godwin's Law</a></h4>

<p>Given enough time, any thread on perl6-language will end up arguing the toss about Unicode operators.</p>

<p>Perl 6 will have Unicode operators. It will also have ASCII equivalents. You're highly unlikely to convince Larry to change his mind on this.</p>

<h4><a name="IDs_of_subroutine_wrappers_should_be_objects">IDs of Subroutine Wrappers Should be Objects</a></h4>

<p>Ingo Blechschmidt made a convincing argument for making the subroutine wrappers discussed in Apocalypse 6 into first class objects. (Well, I was convinced.)</p>

<p>Later in the thread, Dan invoked &quot;our Quantum Ninjas&quot;.</p>

<p><a href='http://groups.google.com/groups?selm=20040608130813.23788.qmail@onion.perl.org'>http://groups.google.com/groups?selm=20040608130813.23788.qmail@onion.perl.org</a></p>

<h4><a name="Simple_grammar_example">Simple Grammar Example</a></h4>

<p>Aldo Calpini asked for assistance in coming up with a simple, yet impressive, example of Perl 6 grammars. I'm not sure anyone's come up with a suitably satisfactory example yet, but Garrett Goebel pointed out that Damian has released Perl6::Rules. And there was much rejoicing (well, in this summarizer's head there was).</p>

<p><a href='http://groups.google.com/groups?selm=40C71BFD.1050105@perl.it'>http://groups.google.com/groups?selm=40C71BFD.1050105@perl.it</a></p>

<p><a href='http://search.cpan.org/~dconway/Perl6-Rules-0.03/Rules.pm'>http://search.cpan.org/~dconway/Perl6-Rules-0.03/Rules.pm</a></p>

<h4><a name="Messages_are_not_guaranteed_to_arrive_in_the_order_sent">Messages Not Guaranteed to Arrive in the Order Sent</a></h4>

<p>In a message dated 28th of January 2004, Damian Conway addressed the issue of junctive lvalues.</p>

<p><a href='http://groups.google.com/groups?selm=40171197.6070401@conway.org'>http://groups.google.com/groups?selm=40171197.6070401@conway.org</a></p>

<h3><a name="Apologies,_Acknowledgements,_Announcements">Apologies, Acknowledgements, Announcements</a></h3>

<p>This summary would have been a great deal trickier to write it if weren't for the efforts of Jeffrey Dik, Sebastian Riedel, Brent Royal-Gorden and Robert Spier, all of whom helped me fill in my message archive while my main server is away being fettled.</p>

<p>Computer menders and British Telecom willing, next week's summary will actually happen. If it doesn't, I'll be along in a fortnight.</p>

<p>If you find these summaries useful or enjoyable, you can show your appreciation by contributing to the Perl Foundataion to help support the ongoing development of Perl. Money and time are both appreciated. Or you could drop me a line at <a href='mailto:p6summarizer@bofh.org.uk'>mailto:p6summarizer@bofh.org.uk</a>; I'm always happy to get feedback.</p>

<p><a href='http://donate.perlfoundation.org/'>http://donate.perlfoundation.org/</a> -- The Perl Foundation</p>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-946" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/06/25/profiling.html" rel="bookmark">Profiling Perl</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2004-06-24T00:00:00-08:00">June 24, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p><strong>Update:</strong> <a href="http://www.perl.org/about/whitepapers/perl-profiling.html">Perl Profiling</a> has evolved since this article was written, please see <a href="http://www.perl.org/about/whitepapers/perl-profiling.html">http://www.perl.org/about/whitepapers/perl-profiling.html</a> for the latest information.
</p>

<p>Everyone wants their Perl code to run faster.
Unfortunately,
without understanding why the code is taking so long to start with,
it's impossible to know where to start optimizing it.
This is where "profiling" comes in; it lets us know what our programs are doing.</p>

<p>We'll look at why and how to profile programs,
and then what to do with the profiling information once we've got it.</p>

<h3><a name="Why_Profile?">Why Profile?</a></h3>

<p>There's nothing worse than setting off a long-running Perl program and then not knowing what it's doing.
I've recently been working on a new, mail-archiving program for the <code>perl.org</code> mailing lists,
and so I've had to import a load of old email into the database.
Here's the code I used to do this:</p>

<pre><code>    use File::Slurp;
    use Email::Store &quot;dbi:SQLite:dbname=mailstore.db&quot;;
    use File::Find::Rule;

    for (File::Find::Rule-&gt;file-&gt;name(qr/\d+/)-&gt;in(&quot;perl6-language&quot;)) {
        Email::Store::Mail-&gt;store(scalar read_file($_));
    }</code></pre>

<p>It's an innocent little program -- it looks for all the files in the <em>perl6-language</em> directory whose names are purely numeric (this is how messages are stored in an ezmlm archive), reads the contents of the files into memory with <code>File::Slurp::read_file</code>, and then uses <a href="http://search.cpan.org/perldoc?Email::Store"><code>Email::Store</code></a> to put them into a database. You start it running, and come back a few hours later and it's done.</p>

<p>All through, though, you have this nervous suspicion that it's not doing the right thing; or at least, not doing it very quickly. Sure there's a lot of mail, but should it really be taking this long? What's it actually spending its time doing? We can add some <code>print</code> statements to help us feel more at ease:</p>

<pre><code>    use File::Slurp;
    use Email::Store &quot;dbi:SQLite:dbname=mailstore.db&quot;;
    use File::Find::Rule;

    print &quot;Starting run...\n&quot;;
    $|++;
    for (File::Find::Rule-&gt;file-&gt;name(qr/\d+/)-&gt;in(&quot;perl6-language&quot;)) {
        print &quot;Indexing $_...&quot;;
        Email::Store::Mail-&gt;store(scalar read_file($_));
        print &quot; done\n&quot;;
    }</code></pre>

<p>Now we can at least see more progress, but we still don't know if this program is working to full efficiency, and the reason for this is that there's an awful lot going on in the underlying modules that we can't immediately see. Is it the <code>File::Find::Rule</code> that's taking up all the time? Is it the storing process? Which part of the storing process? By profiling the code we'll identify, and hopefully smooth over, some of the bottlenecks.</p>

<h3><a name="Simple_Profiling">Simple Profiling</a></h3>

<csperl file="grab" domain="on" record="b/512" template="b/article_sidebar.view">

<p>The granddaddy of Perl profiling tools is <a href="http://search.cpan.org/perldoc?Devel::DProf"><code>Devel::DProf</code></a>. To profile a code run, add the <code>-d:DProf</code> argument to your Perl command line and let it go:</p>

<pre><code>    % perl -d:DProf store_archive</code></pre>

<p>The run will now take slightly longer than normal as Perl collects and writes out information on your program's subroutine calls and exits, and at the end of your job, you'll find a file called <em>tmon.out</em> in the current directory; this contains all the profiling information.</p>

<p>A couple of notes about this:</p>

<ul>
<li>It's important to control the length of the run; in this case, I'd probably ensure that the mail archive contained about ten or fifteen mails to store. (I used seven in this example.) If your run goes on too long, you will end up processing a vast amount of profiling data, and not only will it take a lot time to read back in, it'll take far too long for you to wade through all the statistics. On the other hand, if the run's too short, the main body of the processing will be obscured by startup and other &quot;fixed costs.&quot;</li>

<li>The other problem you might face is that <code>Devel::DProf</code>, being somewhat venerable, occasionally has problems keeping up on certain recent Perls, (particularly the 5.6.x series) and may end up segfaulting all over the place. If this affects you, download the <a href="http://search.cpan.org/perldoc?Devel::Profiler"><code>Devel::Profiler</code></a> module from CPAN, which is a pure-Perl replacement for it.</li>
</ul>

<p>The next step is to run the preprocessor for the profiler output, <code>dprofpp</code>. This will produce a table of where our time has been spent:</p>

<pre><code>  Total Elapsed Time = 13.89525 Seconds
    User+System Time = 9.765255 Seconds
  Exclusive Times
  %Time ExclSec CumulS #Calls sec/call Csec/c  Name
   24.1   2.355  4.822     38   0.0620 0.1269  File::Find::_find_dir
   20.5   2.011  2.467  17852   0.0001 0.0001  File::Find::Rule::__ANON__
   7.82   0.764  0.764    531   0.0014 0.0014  DBI::st::execute
   4.73   0.462  0.462  18166   0.0000 0.0000  File::Spec::Unix::splitdir
   2.92   0.285  0.769    109   0.0026 0.0071  base::import
   2.26   0.221  0.402    531   0.0004 0.0008  Class::DBI::transform_sql
   2.09   0.204  0.203   8742   0.0000 0.0000  Class::Data::Inheritable::__ANON__
   1.72   0.168  0.359  18017   0.0000 0.0000  Class::DBI::Column::name_lc
   1.57   0.153  0.153  18101   0.0000 0.0000  Class::Accessor::get
   1.42   0.139  0.139     76   0.0018 0.0018  Cwd::abs_path</code></pre>

<p>The first two lines tell us how long the program ran for: around 14 seconds, but it was actually only running for about 10 of those -- the rest of the time other programs on the system were in the foreground.</p>

<p>Next we have a table of subroutines, in descending order of time spent; perhaps surprisingly, we find that <code>File::Find</code> and <code>File::Find::Rule</code> are the culprits for eating up 20% of running time each. We're also told the number of &quot;exclusive seconds,&quot; which is the amount of time spent in one particular subroutine, and &quot;cumulative seconds.&quot; This might better be called &quot;inclusive seconds,&quot; since it's the amount of time the program spent in a particular subroutine and all the other routines called from it.</p>

<p>From the statistics above, we can guess that <code>File::Find::_find_dir</code> itself took up 2 seconds of time, but during its execution, it called an anonymous subroutine created by <code>File::Find::Rule</code>, and this subroutine also took up 2 seconds, making a cumulative time of 4 seconds. We also notice that we're making an awful lot of calls to <code>File::Find::Rule</code>, <code>splitdir</code>, and some <code>Class::DBI</code> and <code>Class::Accessor</code> routines.</p>

<h3><a name="What_to_do_now">What to Do Now</a></h3>

<p>Now we have some profiling information, and we see a problem with <code>File::Find::Rule</code>. &quot;Aha,&quot; we might think, &quot;Let's replace our use of <code>File::Find::Rule</code> with a simple globbing operation, and we can shave 4 seconds off our runtime!&quot;. So, just for an experiment, we try it:</p>

<pre><code>    use File::Slurp;
    use Email::Store &quot;dbi:SQLite:dbname=mailstore.db&quot;;
    $|=1;
    for (&#60;perl6-language/archive/0/*&gt;) {
        next unless /\d+/;
        print &quot;$_ ...&quot;;
        Email::Store::Mail-&gt;store(scalar read_file($_));
        print &quot;\n&quot;;
    }</code></pre>

<p>Now this looks a bit better:</p>

<pre><code> Total Elapsed Time = 9.559537 Seconds
   User+System Time = 5.329537 Seconds
 Exclusive Times
 %Time ExclSec CumulS #Calls sec/call Csec/c  Name
  13.1   0.703  0.703    531   0.0013 0.0013  DBI::st::execute
  5.54   0.295  0.726    109   0.0027 0.0067  base::import
  5.52   0.294  0.294  18101   0.0000 0.0000  Class::Accessor::get
  3.45   0.184  1.930  19443   0.0000 0.0001  Class::Accessor::__ANON__
  3.13   0.167  0.970    531   0.0003 0.0018  DBIx::ContextualFetch::st::_untain
                                              t_execute
  3.10   0.165  1.324   1364   0.0001 0.0010  Class::DBI::get
  2.98   0.159  0.376    531   0.0003 0.0007  Class::DBI::transform_sql
  2.61   0.139  0.139     74   0.0019 0.0019  Cwd::abs_path
  2.23   0.119  0.119   8742   0.0000 0.0000  Class::Data::Inheritable::__ANON__
  2.06   0.110  0.744   2841   0.0000 0.0003  Class::DBI::__ANON__
  1.95   0.104  0.159   2669   0.0000 0.0001  Class::DBI::ColumnGrouper::group_cols</code></pre>

<p>Now to be honest, I would never have guessed that removing <code>File::Find::Rule</code> would shave 4 seconds off my code run. This is the first rule of profiling: You actually need to profile before optimizing, because <b>you never know where the hotspots are going to turn out to be.</b> We've also exercised the second rule of profiling: <b>Review what you're using.</b> By using another technique instead of <code>File::Find::Rule</code>, we've reduced our running time by a significant amount.</p>

<p>This time, it looks as though we're doing reasonably well -- the busiest thing is writing to a database, and that's basically what this application does, so that's fair enough. There's also a lot of busy calls that are to do with <code>Class::DBI</code>, and we know that we use <code>Class::DBI</code> as a deliberate tradeoff between convenience and efficiency. If we were being ruthlessly determined to make this program faster, we'd start looking at using plain <code>DBI</code> instead of <code>Class::DBI</code>, but that's a tradeoff I don't think is worth making at the moment.</p>

<p>This is the third rule of profiling: <b>Hotspots happen.</b> If you got rid of all the hotspots in your code, it wouldn't do anything. There are a certain reasonable number of things that your program should be doing for it to be useful, and you simply can't get rid of them; additionally there are any number of tradeoffs that we deliberately or subconsciously make in order to make our lives easier at some potential speed cost -- for instance, writing in Perl or C instead of machine code.</p>

<h3><a name="From_exclusive_to_inclusive">From Exclusive to Inclusive</a></h3>

<p>The default report produced by <em>dprofpp</em> is sorted by exclusive subroutine time, and is therefore good at telling us about individual subroutines that are called a lot and take up disproportionate amounts of time. This can be useful, but it doesn't actually give us an overall view of what our code is doing. If we want to do that, we need to move from looking at exclusive to looking at inclusive times, and we do this by adding the <code>-I</code> option to <em>dprofpp</em>. This produces something like this:</p>

<pre><code> Total Elapsed Time = 9.559537 Seconds
   User+System Time = 5.329537 Seconds
 Inclusive Times
 %Time ExclSec CumulS #Calls sec/call Csec/c  Name
  83.8   0.009  4.468      7   0.0013 0.6383  Email::Store::Mail::store
  80.8   0.061  4.308     35   0.0017 0.1231  Module::Pluggable::Ordered::__ANON
                                              __
  46.3       -  2.472      3        - 0.8239  main::BEGIN
  43.4       -  2.314      7        - 0.3306  Mail::Thread::thread
  43.4       -  2.314      7        - 0.3305  Email::Store::Thread::on_store
  36.2   0.184  1.930  19443   0.0000 0.0001  Class::Accessor::__ANON__
  28.9   0.006  1.543    531   0.0000 0.0029  Email::Store::Thread::Container::_
                                              _ANON__
  27.3   0.068  1.455    105   0.0006 0.0139  UNIVERSAL::require</code></pre>

<p>This tells us a number of useful facts. First, we find that 84% of the program's runtime is spent in the <code>Email::Store::Mail::store</code> subroutine and its descendants, which is the main, tight loop of the program. This means, quite logically, that 16% is not spent in the main loop, and that's a good sign -- this means that we have a 1-second fixed cost in starting up and loading the appropriate modules, and this will amortize nicely against a longer run than 10 seconds. After all, if processing a massive amount of mail takes 20 minutes, the first 1-second startup becomes insignificant. It means we can pretty much ignore everything outside the main loop.</p>

<p>We also find that threading the emails is costly; threading involves a lot of manipulation of <code>Email::Store::Thread::Container</code> objects, which are database backed. This means that a lot of the database stores and executes that we saw in the previous, exclusive report are probably something to do with threading. After all, we now spend 2 seconds out of our 4 seconds of processing time on threading in <code>Mail::Thread::thread</code>, and even though we only call this seven times, we do 531 things with the container objects. This is bad.</p>

<p>Now, I happen to know (because I wrote the module) that <code>Email::Store::Thread::Container</code> uses a feature of <code>Class::DBI</code> called <code>autoupdate</code>. This means that while we do a lot of fetches and stores that we could conceivably do in memory and commit to the database once we're done, we instead hit the database every single time.</p>

<p>So, just as an experiment, we do two things to optimize <code>Email::Store::Thread::Container</code>. First, we know that we're going to be doing a lot of database fetches, sometimes of the same container multiple times, so we cache the fetch. We turn this:</p>

<pre><code>    sub new { 
        my ($class, $id) = @_;
        $class-&gt;find_or_create({ message =&gt; $id });
    }</code></pre>

<p>Into this:</p>

<pre><code>    my %container_cache = ();
    sub new {
        my ($class, $id) = @_;
        $container_cache{$id} 
            ||= $class-&gt;find_or_create({ message =&gt; $id });
    }</code></pre>

<p>This is a standard caching technique, and will produce another tradeoff: we trade memory (in filling up <code>%container_cache</code> with a bunch of objects) for speed (in not having to do as many costly database fetches).</p>

<p>Then we turn <code>autoupdate</code> off, and provide a way of updating the database manually. The reason we wanted to turn off <code>autoupdate</code> is that because all these containers form a tree structure (since they represent mails in a thread which, naturally, form a tree structure), it's a pain to traverse the tree and update all the containers once we're done.</p>

<p>However, with this cache in place, we know that we already have a way to get at all the containers in one go: we just look at the values of <code>%container_hash</code>, and there are all the objects we've used. So we can now add a <code>flush</code> method:</p>

<pre><code>    sub flush {
        (delete $container_cache{$_})-&gt;update for keys %container_cache;
    }</code></pre>

<p>This both empties the cache and updates the database. The only remaining problem is working out where to call <code>flush</code>. If we're dealing with absolutely thousands of emails, it might be worth calling <code>flush</code> after every <code>store</code>, or else <code>%container_hash</code> will get huge. However, since we're not, we just call <code>flush</code> in an <code>END</code> block to catch the container objects before they get destroyed by the garbage collector:</p>

<pre><code>    END { Email::Store::Thread::Container-&gt;flush; }</code></pre>

<p>Running <em>dprofpp</em> again:</p>

<pre><code> Total Elapsed Time = 7.741969 Seconds
   User+System Time = 3.911969 Seconds
 Inclusive Times
 %Time ExclSec CumulS #Calls sec/call Csec/c  Name
  65.4       -  2.559      7        - 0.3656  Email::Store::Mail::store
  62.9   0.014  2.461     35   0.0004 0.0703  Module::Pluggable::Ordered::__ANON
                                              __
  56.2   0.020  2.202      3   0.0065 0.7341  main::BEGIN
  31.8   0.028  1.247    105   0.0003 0.0119  UNIVERSAL::require
  29.4   0.004  1.150      7   0.0006 0.1642  Email::Store::Entity::on_store
  22.7   0.025  0.890    100   0.0003 0.0089  Class::DBI::create
  21.0   0.031  0.824    100   0.0003 0.0082  Class::DBI::_create
  18.3   0.235  0.716    109   0.0022 0.0066  base::import
  15.1       -  0.594    274        - 0.0022  DBIx::ContextualFetch::st::execute
  15.1       -  0.592      7        - 0.0846  Mail::Thread::thread
  15.1       -  0.592      7        - 0.0845  Email::Store::Thread::on_store</code></pre>

<p>We find that we've managed to shave another second-and-a-half off, and we've also swapped a per-mail cost (of updating the threading containers every time) to a once-per-run fixed cost (of updating them all at the end of the run). This has taken the business of threading down from two-and-a-half seconds per run to half a second per run, and it means that 35% of our running time is outside the main loop; again, this will amortize nicely on large runs.</p>

<p>We started with a program that runs for 10 seconds, and now it runs for 4. Through judicious use of the profiler, we've identified the hotspots and eliminated the most troublesome ones. We've looked at both exclusive and inclusive views of the profiling data, but there are still a few other things that <em>dprofpp</em> can tell us. For instance, the <code>-S</code> option gives us a call tree, showing what gets called from what. These trees can be incredibly long and tedious, but if the two views we've already looked at haven't identified potential trouble spots, then wading through the tree might be your only option.</p>

<h3><a name="Writing_your_own_profiler">Writing your Own Profiler</a></h3>

<p>At least, that is, if you want to use <em>dprofpp</em>; until yesterday, that was the only way of reading profiling data. Yesterday, however, I released <a href="http://search.cpan.org/perldoc?Devel::DProfPP"><code>Devel::DProfPP</code></a>, which provides an event-driven interface to reading <em>tmon.out</em> files. I intended to use it to write a new version of <em>dprofpp</em> because I find the current profiler intolerably slow; ironically, though, I haven't profiled it yet.</p>

<p>Anyway, <code>Devel::DProfPP</code> allows you to specify callbacks to be run every time the profiling data shows Perl entering or exiting a subroutine, and provides access to the same timing and call stack information used by <em>dprofpp</em>.</p>

<p>So, for instance, I like visualization of complicated data. I'd prefer to see what's calling what as a graph that I can print out and pore over, rather than as a listing. So, I pull together <code>Devel::DProfPP</code> and the trusty <a href="http://search.cpan.org/perldoc?Graphviz"><code>Graphviz</code></a> module, and create my own profiler:</p>

<pre><code> use GraphViz;
 use Devel::DProfPP;
 
 my $graph = GraphViz-&gt;new();
 my %edges = ();
 Devel::DProfPP-&gt;new(enter =&gt; sub {
     my $pp = shift;
     my @stack = $pp-&gt;stack;
     my $to = $stack[-1]-&gt;sub_name;
     my $from = @stack &gt; 1 ? $stack[-2]-&gt;sub_name : &quot;MAIN BODY&quot;;
     $graph-&gt;add_edge($from =&gt; $to) unless $edges{$from.&quot; -&gt; &quot;.$to}++;
 })-&gt;parse;
 
 print $graph-&gt;as_png;</code></pre>

<p>Every time we enter a subroutine, we look at the call stack so far. We pick the top frame of the stack, and ask for its subroutine name. If there's another subroutine on the stack, we take that off too; otherwise we're being called from the main body of the code. Then we add an edge on our graph between the two subroutines, unless we've already got one. Finally, we print out the graph as a PNG file for me to print out and stick on the wall.</p>

<p>There are any number of other things you can do with <code>Devel::DProfPP</code> if the ordinary profiler doesn't suit your needs for some reason; but as we've seen, just judicious application of profiling and highlighting hotspots in your code can cut the running time of a long-running Perl program by 50% or so, and can also help you to understand what your code is spending all its time doing.</p>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-944" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/06/18/variables.html" rel="bookmark">Perl's Special Variables</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <abbr class="published" title="2004-06-18T00:00:00-08:00">June 18, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->


<p>One of the best ways to make your Perl code look more like ... well, like Perl code -- and not like C or BASIC or whatever you used before you were introduced to Perl -- is to get to know the internal variables that Perl uses to control various aspects of your program's execution.</p>

<p>In this article we'll take a look at a number of variables that give you finer control over your file input and output.</p>

<h3><a name="Counting_Lines">Counting Lines</a></h3>

<p>I decided to write this article because I am constantly amazed by the number of people who don't know about the existence of <code>$.</code>.
I still see people producing code that looks like this:</p>

<pre><code>  my $line_no = 0;

  while (&lt;FILE&gt;) {
    ++$line_no;
    unless (/some regex/) {
      warn &quot;Error in line $line_no\n&quot;;
      next;
    }

    # process the record in some way
  }</code></pre>

<p>For some reason, many people seem to completely miss the existence of <code>$.</code>, which is Perl's internal variable that keeps track of your current record number. The code above can be rewritten as:</p>

<pre><code>  while (&lt;FILE&gt;) {
    unless (/some regex/) {
      warn &quot;Error in line $.\n&quot;;
      next;
    }

    # process the record in some way
  }</code></pre>

<p>I know that it doesn't actually save you very much typing, but why create a new variable if you don't have to?</p>

<p>One other nice way to use <code>$.</code> is in conjunction with Perl's &quot;flip-flop&quot; operator (<code>..</code>). When used in list context, <code>..</code> is the list construction operator. It builds a list of elements by calculating all of the items between given start and end values like this:</p>

<pre><code>  my @numbers = (1 .. 1000);</code></pre>

<p>But when you use this operator in a scalar context (like, for example, as the condition of an <code>if</code> statement), its behavior changes completely. The first operand (the left-hand expression) is evaluated to see if it is true or false. If it is false then the operator returns false and nothing happens. If it is true, however, the operator returns true and <i>continues</i> to return true on subsequent calls until the second operand (the right-hand expression) returns true.</p>

<p>An example will hopefully make this clearer. Suppose you have a file and you only want to process certain sections of it. The sections that you want to print are clearly marked with the string &quot;!! START !!&quot; at the start and &quot;!! END !!&quot; at the end. Using the flip-flop operator you can write code like this:</p>

<pre><code>  while (&lt;FILE&gt;) {
    if (/!! START !!/ .. /!! END !!/) {
      # process line
    }
  }</code></pre>

<p>Each time around the loop, the current line is checked by the flip-flop operator. If the line doesn't match <code>/!! START !!/</code> then the operator returns false and the loop continues. When we reach the first line that matches <code>/!! START !!/</code> then the flip-flop operator returns true and the code in the <code>if</code> block is executed. On subsequent iterations of the <code>while</code> loop, the flip-flop operator checks for matches again <code>/!! END !!/</code>, but it continues to return true until it finds a match. This means that all of the lines between the &quot;!! START !!&quot; and &quot;!! END !!&quot; markers are processed. When a line matches <code>/!! END !!/</code> then the flip-flop operator returns false and starts checking against the first regex again.</p>

<p>So what does all this have to do with <code>$.</code>? Well, there's another piece of magic coded into the flip-flop operator. If either of its operands are constant values then they are converted to integers and matched against <code>$.</code>. So to print out just the first 10 lines of a file you can write code like this:</p>

<pre><code>  while (&lt;FILE&gt;) {
    print if 1 .. 10;
  }</code></pre>

<p>One final point on <code>$.</code>, there is only one <code>$.</code> variable. If you are reading from multiple filehandles then <code>$.</code> contains the current record number from the most recently read filehandle. If you want anything more complex then you can use something like IO::File objects for your filehandle. These objects all have an <code>input_line_number</code> method.</p>

<h3><a name="The_Field_Record_Separators">The Field Record Separators</a></h3>

<p>Next, we'll look at <code>$/</code> and <code>$\</code> which are the input and output record separators respectively. They control what defines a &quot;record&quot; when you are reading or writing data.</p>

<p>Let me explain that in a bit more detail. Remember when you were first learning Perl and you were introduced to the file input operator. Almost certainly you were told that <code>&lt;FILE&gt;</code> read data from the file up to and including the next newline character. Well that's not true. Well, it is, but it's only a specialized case. Actually it reads data up to and including the next occurrence of whatever is currently in <code>$/</code> - the file input separator. Let's look at an example.</p>

<p>Imagine you have a text file which contains amusing quotes. Or lyrics from songs. Or whatever it is that you like to put in your randomly generated signature. The file might look something like this.</p>

<pre><code>    This is the definition of my life
  %%
    We are far too young and clever
  %%
    Stab a sorry heart
    With your favorite finger</code></pre>

<p>Here we have three quotes separated by a line containing just the string <code>%%</code>. How would you go about reading in that file a quote at a time?</p>

<p>One solution would be to read the file a line at a time, checking to see if the new line is just the string <code>%%</code>. You'd need to keep a variable that contains current quote that you are building up and process a completed quote when you find the termination string. Oh, and you'd need to remember to process the last quote in the file as that doesn't have a termination string (although, it might!)</p>

<p>A simpler solution would be to change Perl's idea of what constitutes a record. We do that by changing the value of <code>$/</code>. The default value is a newline character - which is why <code>&lt;...&gt;</code> usually reads in a line at a time. But we can set it to any value we like. We can do something like this</p>

<pre><code>  $/ = &quot;%%\n&quot;;

  while (&lt;QUOTE&gt;) {
    chomp;
    print;
  }</code></pre>

<p>Now each time we call the file input operator, Perl reads data from
the filehandle until it finds <code>%%\n</code> (or the end of file
marker). A newline is no longer seen as a special character. Notice,
however, that the file input operator always returns the next record
with the file input separator still attached. When <code>$/</code> has
its default value of a newline character, you know that you can remove
the newline character by calling <code>chomp</code>. Well it works
exactly the same way when <code>$/</code> has other values. It turns out
that <code>chomp</code> doesn't just remove a newline character (that's
another &quot;simplification&quot; that you find in beginners books) it
actually removes whatever is the current value of <code>$/</code>. So in our sample code above, the call to <code>chomp</code> is removing the whole string <code>%%\n</code>.</p>

<h3><a name="Changing_Perl's_Special_Variables">Changing Perl's Special Variables</a></h3>

<p>Before we go on I just need to alert you to one possible repercussion of changing these variables whenever you want. The problem is that most of these variables are forced into the <code>main</code> package. This means that when you change one of these variables, you are altering the value everywhere in your program. This includes any modules that you use in your program. The reverse is also true. If you're writing a module that other people will use in their programs and you change the value of <code>$/</code> inside it, then you have changed the value for all of the remaining program execution. I hope you can seen why changing variables like <code>$/</code> in one part of your program can potentially lead to hard to find bugs in another part.</p>

<p>So we need to do what we can to avoid this. Your first approach might be to reset the value of <code>$/</code> after you have finished with it. So you'd write code like this.</p>

<pre><code>  $/ = &quot;%%\n&quot;;

  while (&lt;QUOTE&gt;) {
    chomp;
    print;
  }

  $/ = &quot;\n&quot;;</code></pre>

<p>The problem with this is you can't be sure that <code>$/</code> contained <code>\n</code> before you started fiddling with it. Someone else might have changed it before your code was reached. So the next attempt might look like this.</p>

<pre><code>  $old_input_rec_sep = $/;
  $/ = &quot;%%\n&quot;;

  while (&lt;QUOTE&gt;) {
    chomp;
    print;
  }

  $/ = $old_input_rec_sep;</code></pre>

<p>This code works and doesn't have the bug that we're trying to avoid but there's another way that looks cleaner. Remember the <code>local</code> function that you used to declare local variables until someone told you that you should use <code>my</code> instead? Well this is one of the few places where you can use <code>local</code> to great effect.</p>

<p>It's generally acknowledged that <code>local</code> is badly named. The name doesn't describe what the function does. In Perl 6 the function is likely to be renamed to <code>temp</code> as that's a far better description of what it does - it creates a temporary variable with the same name as an existing variable and restores the original variable when the program leaves the innermost enclosing block. This means that we can write our code like this.</p>

<pre><code>  {
    local $/ = &quot;%%\n&quot;;

    while (&lt;QUOTE&gt;) {
      chomp;
      print;
    }
  }</code></pre>

<p>We've enclosed all of the code in another pair of braces to create a <i>naked block</i>. Code blocks are usually associated with loops, conditionals or subroutines, but in Perl they don't need to be. You can introduce a new block whenever you want. Here, we've introduced a block purely to delimit the area where we want <code>$/</code> to have a new value. We then use <code>local</code> to store the old <code>$/</code> variable somewhere where it can't be disturbed and set our new version of the variable to <code>%%\n</code>. We can then do whatever we want in the code block and when we exit from the block, Perl automatically restores the original copy of <code>$/</code> and we never needed to know what it was set to.</p>

<p>For all this reason, it's good practice to never change one of Perl's internal variables unless it is localized in a block.</p>

<h4><a name="Other_Values_For_$/">Other Values For $/</a></h4>

<p>There are a few special values that you can give <code>$/</code> which turn on interesting behaviours. The first of these is setting it to <code>undef</code>. This turns on &quot;slurp mode&quot; and the next time you read from a filehandle you will get all of the remaining data right up to the end of file marker. This means that you can read a whole file in using code like this.</p>

<pre><code>  my $file = do { local $/; &lt;FILE&gt; };</code></pre>

<p>A <code>do</code> block returns the value of the last expression evaluated within it, which in this case is the file input operator. And as <code>$/</code> has been set to <code>undef</code> it returns the whole file. Notice that we don't even need to explicitly set <code>$/</code> to <code>undef</code> as all Perl variables are initialized to <code>undef</code> when they are created.</p>

<p>There is a big difference between setting <code>$/</code> to <code>undef</code> and setting it to an empty string. Setting it to an empty string turns on &quot;paragraph&quot; mode. In this mode each record is a paragraph of text terminated by one or more empty lines. You might think that this effect can be mimicked by setting <code>$/</code> to <code>\n\n</code>, but the subtle difference is that paragraph mode acts as thought <code>$/</code> had been set to <code>\n\n+</code> (although you can't actually set <code>$/</code> equal to a regular expression.)</p>

<p>The final special value is to set <code>$/</code> to either a reference to a scalar variable that holds an integer, or to a reference to an integer constant. In these cases the next read from a filehandle will read up to that number of bytes (I say &quot;up to&quot; because at the end of the file there might not be enough data left to give you). So you read a file 2Kb at a time and you can do this.</p>

<pre><code>  {
    local $/ = \2048;

    while (&lt;FILE&gt;) {
      # $_ contains the next 2048 bytes from FILE
    }
  }</code></pre>

<h4><a name="$/_and_$.">$/ and $.</a></h4>

<p>Note that changing <code>$/</code> alters Perl's definition of a record and therefore it alters the behavior of <code>$.</code>. <code>$.</code> doesn't actually contain the current line number, it contains the current <i>record</i> number. So in our quotes example above, <code>$.</code> will be incremented for each quote that you read from the filehandle.</p>

<h4><a name="What_About_$\?">What About $\?</a></h4>

<p>Many paragraphs back I mentioned both <code>$/</code> and <code>$\</code> as being the input and output record separators. But since then I've just gone on about <code>$/</code>. What happened to <code>$\</code>?</p>

<p>Well, to be honest, <code>$\</code> isn't anywhere near as useful as <code>$/</code>. It contains a string that is printed at the end of every call to <code>print</code>. Its default value is the empty string, so nothing gets added to data that you display with <code>print</code>. But if, for example, you longed for the days of Pascal you could write a <code>println</code> function like this.</p>

<pre><code>  sub println {
    local $\ = &quot;\n&quot;;
    print @_;
  }</code></pre>

<p>Then every time you called <code>println</code>, all of the arguments would be printed followed by a newline.</p>

<h3><a name="Other_Print_Variables">Other Print Variables</a></h3>

<p>The next two variables that I want to discuss are very easily confused although they do completely different things. To illustrate them, consider the following code.</p>

<pre><code>  my @arr = (1, 2, 3);

  print @arr;
  print &quot;@arr&quot;;</code></pre>

<p>Now, without looking it up do you know what the difference is between the output from the two calls to <code>print</code>?</p>

<p>The answer is that the first one prints the three elements of the array with nothing separating them (like this - <code>123</code>) whereas the second one prints the elements separated by spaces (like this - <code>1 2 3</code>). Why is there a difference?</p>

<p>The key to understanding it is to look at exactly what is being passed to <code>print</code> in each case. In the first case <code>print</code> is passed an array. Perl unrolls that array into a list and <code>print</code> actually sees the three elements of the array as separate arguments. In the second case, the array is interpolated into a double quoted string before <code>print</code> sees it. That interpolation has nothing at all to do with the call to <code>print</code>. Exactly the same process would take place if, for example, we did something like this.</p>

<pre><code>  my $string = &quot;@arr&quot;;
  print $string;</code></pre>

<p>So in the second case, the <code>print</code> function only sees one argument. The fact that it is the results of interpolating an array in double quotes has no effect on how <code>print</code> treats the string.</p>

<p>We therefore have two cases. When <code>print</code> receives a number of arguments it prints them out with no spaces between them. And when an array is interpolated in double quotes it is expanded with spaces between the individual elements. These two cases are completely unrelated, but from our first example above it's easy to see how people can get them confused.</p>

<p>Of course, Perl allows us to change these behaviors if we want to. The string that is printed between the arguments passed to <code>print</code> is stored in a variable called <code>$,</code> (because you use a comma to separate arguments). As we've seen, the default value for that is an empty string but it can, of course, be changed.</p>

<pre><code>  my @arr = (1, 2, 3);
  {
    local $, = ',';

    print @arr;
  }</code></pre>

<p>This code prints the string <code>1,2,3</code>.</p>

<p>The string that separates the elements of an array when expanded in a double quoted string is stored in <code>$&quot;</code>. Once again, it's simple to change it to a different value.</p>

<pre><code>  my @arr = (1, 2, 3);
  {
    local $&quot; = '+';

    print &quot;@arr&quot;;
  }</code></pre>

<p>This code prints <code>1+2+3&quot;</code>.</p>

<p>Of course, <code>$&quot;</code> doesn't necessarily have to used in conjunction with a print statement. You can use it anywhere that you have an array in a doubled quoted string. And it doesn't just work for arrays. Array and hash slices work just as well.</p>

<pre><code>  my %hash = (one =&gt; 1, two =&gt; 2, three =&gt; 3);

  {
    local $&quot; = ' &lt; ';

    print &quot;@hash{qw(one two three)}&quot;;
  }</code></pre>

<p>This displays <code>1 &lt; 2 &lt; 3</code>.</p>

<h3><a name="Conclusion">Conclusion</a></h3>

<p>In this article we've just scratched the surface of what you can do by changing the values in Perl's internal variables. If this makes you want to look at this subject in more detail, then you should read the <code>perlvar</code> manual page.</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-942" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/06/10/email.html" rel="bookmark">The Evolution of Perl Email Handling</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2004-06-10T00:00:00-08:00">June 10, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>I spend the vast majority of my time at a computer working with email, whether it's working through the ones I send and receive each day,
or working on my interest in analyzing,
indexing,
organizing, and mining email content.
Naturally,
Perl helps out with this.</p>

<p>There are many modules on the CPAN for slicing and dicing email,
and we're going to take a whistlestop tour of the major ones. We'll also concentrate on an effort started by myself,
Richard Clamp,
Simon Wistow, and others,
called the Perl Email Project,
to produce simple,
efficient and accurate mail handling modules.</p>

<h3><a name="Message_handling">Message Handling</a></h3>

<p>We'll begin with those modules that represent an individual message,
giving you access to the headers and body,
and usually allowing you to modify these.</p>

<p>The granddaddy of these modules is <a href="http://search.cpan.org/perldoc?Mail::Internet"><code>Mail::Internet</code></a>,
originally created by Graham Barr and now maintained by Mark Overmeer.
This module offers a constructor that takes either an array of lines or a filehandle,
reads a message, and returns a <code>Mail::Internet</code> object representing the message.
Throughout these examples,
we'll use the variable <code>$rfc2822</code> to represent a mail message as a string.</p>

<pre><code>    my $obj = Mail::Internet-&gt;new( [ split /\n/, $rfc2822 ] );</code></pre>

<p><code>Mail::Internet</code> splits a message into a header object in the <a href="http://search.cpan.org/perldoc?Mail::Header"><code>Mail::Header</code></a> class, plus a body. You can get and set individual headers through this object:</p>

<pre><code>    my $subject = $obj-&gt;head-&gt;get(&quot;Subject&quot;);
    $obj-&gt;head-&gt;replace(&quot;Subject&quot;, &quot;New subject&quot;);</code></pre>

<p>Reading and editing the body is done through the <code>body</code> method:</p>

<pre><code>    my $old_body = $obj-&gt;body;
    $obj-&gt;body(&quot;Wasn't worth reading anyway.&quot;);</code></pre>

<p>I've not said anything about MIME yet. <code>Mail::Internet</code> is reasonably handy for simple tasks, but it doesn't handle MIME at all. Thankfully, <a href="http://search.cpan.org/perldoc?MIME::Entity"><code>MIME::Entity</code></a> is a MIME-aware subclass of <code>Mail::Internet</code>; it allows you to read individual parts of a MIME message:</p>

<pre><code>    my $num_parts = $obj-&gt;parts;
    for (0..$num_parts) {
        my $part = $obj-&gt;parts($_);
        ...
    }</code></pre>

<p>If <code>Mail::Internet</code> and <code>MIME::Entity</code> don't cut it for you, you can try Mark Overmeer's own <a href="http://search.cpan.org/perldoc?Mail::Message"><code>Mail::Message</code></a>, part of the impressive <a href="http://search.cpan.org/perldoc?Mail::Box"><code>Mail::Box</code></a> suite. <code>Mail::Message</code> is extremely featureful and comprehensive, but that is not always meant as a compliment.</p>

<p><code>Mail::Message</code> objects are usually constructed by <code>Mail::Box</code> as part of reading in an email folder, but can also be generated from an email using the <code>read</code> method:</p>

<pre><code>    $obj = Mail::Message-&gt;read($rfc2822);</code></pre>

<p>Like <code>Mail::Internet</code>, messages are split into headers and bodies; unlike <code>Mail::Internet</code>, the body of a <code>Mail::Message</code> object is also an object. We read headers like so:</p>

<pre><code>    $obj-&gt;head-&gt;get(&quot;Subject&quot;);</code></pre>

<p>Or, for <code>Subject</code> and other common headers:</p>

<pre><code>    $obj-&gt;subject;</code></pre>

<p>I couldn't find a way to set headers directly, and ended up doing this:</p>

<pre><code>    $obj-&gt;head-&gt;delete($header);
    $obj-&gt;head-&gt;add($header, $_) for @data;</code></pre>

<p>Reading the body as a string is only marginally more difficult:</p>

<pre><code>    $obj-&gt;decoded-&gt;string</code></pre>

<p>While setting the body is an absolute nightmare--we have to create a new <code>Mail::Message::Body</code> object and replace our current one with it.</p>

<pre><code>    $obj-&gt;body(Mail::Message::Body-&gt;new(data =&gt; [split /\n/, $body]));</code></pre>

<p><code>Mail::Message</code> may be slow, but it's certainly hard to use. It's also rather complex; the operations we've looked at so far involved the use of 16 classes (<code>Mail::Address</code>, <code>Mail::Box::Parser</code>, <code>Mail::Box::Parser::Perl</code>, <code>Mail::Message</code>, <code>Mail::Message::Body</code>, <code>Mail::Message::Body::File</code>, <code>Mail::Message::Body::Lines</code>, <code>Mail::Message::Body::Multipart</code>, <code>Mail::Message::Body::Nested</code>, <code>Mail::Message::Construct</code>, <code>Mail::Message::Field</code>, <code>Mail::Message::Field::Fast</code>, <code>Mail::Message::Head</code>, <code>Mail::Message::Head::Complete</code>, <code>Mail::Message::Part</code>, and <code>Mail::Reporter</code>) and 4400 lines of code. It does have a lot of features, though.</p>

<p>Foolishly, I thought that email parsing shouldn't be so complex, and so I sat down to write the simplest possible functional mail handling library. The result is <a href="http://search.cpan.org/perldoc?Email::Simple"><code>Email::Simple</code></a>, and its interface looks like this:</p>

<pre><code>    my $obj = Email::Simple-&gt;new($rfc2822);
    my $subject = $obj-&gt;header(&quot;Subject&quot;);
    $obj-&gt;header_set(&quot;Subject&quot;, &quot;A new subject&quot;);
    my $old_body = $obj-&gt;body;
    $obj-&gt;body_set(&quot;A new body\n&quot;);
    print $obj-&gt;as_string;</code></pre>

<p>It doesn't do a lot, but it does it simply and efficiently. If you need MIME handling, there's a subclass called <a href="http://search.cpan.org/perldoc?Email::MIME"><code>Email::MIME</code></a>, which adds the <code>parts</code> method.</p>

<p>Realistically, the choice of which mail handling library to use ought to be up to you, the end user, but this isn't always true. Auxilliary modules, which mess about with email at a higher level, can ask for the mail to be presented in a particular representation. For instance, until recently, the wonderful <code>Mail::ListDetector</code> module, which we'll examine later, required mails passed in to it to be <code>Mail::Internet</code> objects, since this gave it a known API to work with the objects. I don't want to work with <code>Mail::Internet</code> objects, but I want to use <code>Mail::ListDetector</code>'s functionality. What can I do?</p>

<p>In order to enable the user to have the choice again, I wrote an abstraction layer across all of the above modules, called <a href="http://search.cpan.org/perldoc?Email::Abstract"><code>Email::Abstract</code></a>. Given any of the above objects, we can say:</p>

<pre><code>     my $subject = Email::Abstract-&gt;get_header($obj, &quot;Subject&quot;);
     Email::Abstract-&gt;set_header($obj, &quot;Subject&quot;, &quot;My new subject&quot;);
     my $body = Email::Abstract-&gt;get_body($obj);
     Email::Abstract-&gt;set_body($message, &quot;Hello\nTest message\n&quot;);
     $rfc2822 = Email::Abstract-&gt;as_string($obj);</code></pre>

<p><code>Email::Abstract</code> knows how to perform these operations on the major types of mail representation objects. It also abstracts out the process of constructing a message, and allows you to change the interface of a message using the <code>cast</code> class method:</p>

<pre><code>    my $obj = Email::Abstract-&gt;cast($rfc2822, &quot;Mail::Internet&quot;);
    my $mm = Email::Abstract-&gt;cast($obj, &quot;Mail::Message&quot;);</code></pre>

<p>This allows module authors to write their mail handling libraries in an interface-agnostic way, and I'm grateful to Michael Stevens for taking up <code>Email::Abstract</code> in <code>Mail::ListDetector</code> so quickly. Now I can pass in <code>Email::Simple</code> objects to <code>Mail::ListDetector</code> and it will work fine.</p>

<p><code>Email::Abstract</code> also gives us the opportunity to create some benchmarks for all of the above modules. Here was the benchmarking code I used:</p>

<pre><code>    use Email::Abstract;
    my $message = do { local $/; &lt;DATA&gt;; };
    my @classes =
        qw(Email::MIME Email::Simple MIME::Entity Mail::Internet Mail::Message);

    eval &quot;require $_&quot; or die $@ for @classes;

    use Benchmark;
    my %h;
    for my $class (@classes) {
        $h{$class} = sub {
            my $obj = Email::Abstract-&gt;cast($message, $class);
            Email::Abstract-&gt;get_header($obj, &quot;Subject&quot;);
            Email::Abstract-&gt;get_body($obj);
            Email::Abstract-&gt;set_header($obj, &quot;Subject&quot;, &quot;New Subject&quot;);
            Email::Abstract-&gt;set_body($obj, &quot;A completely new body&quot;);
            Email::Abstract-&gt;as_string($obj);
        }
    }
    timethese(1000, \%h);

    __DATA__
    ...</code></pre>

<p>I put a short email in the <code>DATA</code> section and ran the same simple operations a thousand times: construct a message, read a header, read the body, set the header, set the body, and return the message as a string.</p>

<pre><code>    Benchmark: timing 1000 iterations of Email::MIME, Email::Simple, 
    MIME::Entity, Mail::Internet, Mail::Message...
    Email::MIME: 10 wallclock secs ( 7.97 usr +  0.24 sys =  8.21 CPU) 
        @ 121.80/s (n=1000)
    Email::Simple:  9 wallclock secs ( 7.49 usr +  0.05 sys =  7.54 CPU) 
        @ 132.63/s (n=1000)
    MIME::Entity: 33 wallclock secs (23.76 usr +  0.35 sys = 24.11 CPU) 
        @ 41.48/s (n=1000)
    Mail::Internet: 24 wallclock secs (17.34 usr +  0.30 sys = 17.64 CPU) 
        @ 56.69/s (n=1000)
    Mail::Message: 20 wallclock secs (17.12 usr +  0.27 sys = 17.39 CPU) 
        @ 57.50/s (n=1000)</code></pre>

<p>The Perl Email Project was a success: <code>Email::MIME</code> and <code>Email::Simple</code> were twice as fast as their nearest competitors. However, it should be stressed that they're both very low level; if you're doing anything more complex than the operations we've seen, you might consider one of the older <code>Mail::</code> modules.</p>













<h3><a name="Mailbox_handling">Mailbox Handling</a></h3>

<p>So much for individual messages; let's move on to handling groups of messages, or folders. We've mentioned <code>Mail::Box</code> already, and this is truly the king of folder handling, supporting local and remote folders, editing folders, and all sorts of other things besides. To use it, we first need a <code>Mail::Box::Manager</code>, which is a factory object for creating <code>Mail::Box</code>es.</p>

<pre><code>    use Mail::Box::Manager
    my $mgr = Mail::Box::Manager-&gt;new;</code></pre>

<p>Next, we need to open the folder using the manager:</p>

<pre><code>    my $folder = $mgr-&gt;open(folder =&gt; $folder_file);</code></pre>

<p>And now we can get at the individual messages as <code>Mail::Message</code> objects:</p>

<pre><code>    for ($folder-&gt;messages) {
        print $_-&gt;subject,&quot;\n&quot;;
    }</code></pre>

<p>With its more minimalist approach, my favorite mail box manager until recently was <code>Mail::Util</code>'s <code>read_mbox</code> function, which takes the name of a Unix <code>mbox</code> file, and returns a list of array references; each reference is the array of lines of a message, suitable for feeding to <code>Mail::Internet-&gt;new</code> or similar:</p>

<pre><code>    for (read_mbox($folder_file)) {
        my $obj = Mail::Internet-&gt;new($_);
        print $_-&gt;head-&gt;get(&quot;Subject&quot;),&quot;\n&quot;;
    }</code></pre>

<p>These two are both really handy, but there seemed to be room for something in between the simplicity of <code>Mail::Util</code> and the functionality of <code>Mail::Box</code>, and so the Email Project struck again with <a href="http://search.cpan.org/perldoc?Email::Folder"><code>Email::Folder</code></a> and <a href="http://search.cpan.org/perldoc?Email::LocalDelivery"><code>Email::LocalDelivery</code></a>. <code>Email::Folder</code> handles mbox and maildir folders, with more types planned, and has a reasonably simple interface:</p>

<pre><code>    my $folder = Email::Folder-&gt;new($folder_file);
    for ($folder-&gt;messages) {
        print $_-&gt;header(&quot;Subject&quot;),&quot;\n&quot;;
    }</code></pre>

<p>By default it returns <code>Email::Simple</code> objects for the messages, but this can be changed by subclassing. For instance, if we want raw RFC2822 strings, we can do this:</p>

<pre><code>    package Email::Folder::Raw; use base 'Email::Folder';
    sub bless_message { my ($self, $rfc2822) = @_; return $rfc2822; }</code></pre>

<p>Perhaps in the future, we will change <code>bless_message</code> to use <code>Email::Abstract-&gt;cast</code> to make the representation of messages easier to select without necessarily having to subclass.</p>

<p>The other side of folder handling is writing to a folder, or &quot;local delivery&quot;. <a href="http://search.cpan.org/perldoc?Email::LocalDelivery"><code>Email::LocalDelivery</code></a> was written to assist <code>Email::Filter</code>, of which more later. The problem is harder than it sounds, as it has to deal with locking, escaping mail bodies, and specific problems due to mailbox and maildir formats. <code>LocalDelivery</code> hides all of these things beneath a simple interface:</p>

<pre><code>    Email::LocalDelivery-&gt;deliver($rfc2822, @mailboxes);</code></pre>

<p>Both <code>Email::LocalDelivery</code> and <code>Email::Folder</code> use the <a href="http://search.cpan.org/perldoc?Email::FolderType"><code>Email::FolderType</code></a> helper module to determine the type of a folder based on its filename.</p>

<h3><a name="Address_handling">Address Handling</a></h3>

<p>To come down to a lower level of abstraction again, there are a number of modules for handling email addresses. The old favorite is <a href="http://search.cpan.org/perldoc?Mail::Address"><code>Mail::Address</code></a>. A mail address appearing in the fields of an email can be made up of several elements: the actual address, a phrase or name, and a comment. For instance:</p>

<pre><code>    Example user &lt;example@example.com&gt; (Not a real user)</code></pre>

<p><code>Mail::Address</code> parses these addresses, separating out the phrase and comments, allowing you to get at the individual components:</p>

<pre><code>    for (Mail::Address-&gt;parse($from_line)) {
        print $_-&gt;name, &quot;\t&quot;, $_-&gt;address, &quot;\n&quot;;
    }</code></pre>

<p>Unfortunately, like many of the mail modules, it tries really hard to be helpful.</p>

<pre><code>    my ($addr) = Mail::Address-&gt;parse('&quot;eBay, Inc.&quot; &lt;support@ebay.com&gt;');
    print $addr-&gt;name # Inc. eBay</code></pre>

<p>Which, while better than the &quot;Inc Ebay&quot; that previous versions would produce, isn't really acceptable. Casey West joined our merry band of renegades and produced <a href="http://search.cpan.org/perldoc?Email::Address"><code>Email::Address</code></a>. It has exactly the same interface as <code>Mail::Address</code>, but it works, and is about twice to three times as fast.</p>

<p>One thing we often want to do when handling mail addresses is to make sure that they're valid. If, for instance, a user is registering for content at a web site, we need to check that the address they've given is capable of receiving mail. <a href="http://search.cpan.org/perldoc?Email::Valid"><code>Email::Valid</code></a>, the original inhabitant of the <code>Email::</code> namespace before our bunch of disaffected squatters moved in, does just this. In its most simple use, we can say:</p>

<pre><code>    if (not Email::Valid-&gt;address('test@example.com')) {
        die &quot;Not a valid address&quot;
    }</code></pre>

<p>You can turn on additional checks, such as ensuring there's a valid MX record for the domain, correcting common AOL and Compuserve addressing mistakes, on so on:</p>

<pre><code>    if (not Email::Valid-&gt;address(-address =&gt; 'test@example.com',
                                  -mxcheck =&gt; 1)) {
        die &quot;Not a valid address&quot;
    }</code></pre>

<h3><a name="Mail_munging">Mail Munging</a></h3>

<p>Once we have our emails, what are we going to do with them? A lot of what I've been looking at has been textual analysis of email, and there are three modules that particularly help with this.</p>

<p>This first is <code>Text::Quoted</code>; it takes the body text of an email message, or any other text really, and tries to figure out which parts of the message are quotations from other messages. It then separates these out into a nested data structure. For instance, if we have</p>

<pre><code>    $message = &lt;&lt;EOF
    &gt; foo
    &gt; # Bar
    &gt; baz

    quux
    EOF</code></pre>

<p>Then running <code>extract($message)</code> will return a data structure like this:</p>

<pre><code>    [
      [
        { text =&gt; 'foo', quoter =&gt; '&gt;', raw =&gt; '&gt; foo' },
        [ 
            { text =&gt; 'Bar', quoter =&gt; '&gt; #', raw =&gt; '&gt; # Bar' } 
        ],
        { text =&gt; 'baz', quoter =&gt; '&gt;', raw =&gt; '&gt; baz' }
      ],

      { empty =&gt; 1 },
      { text =&gt; 'quux', quoter =&gt; '', raw =&gt; 'quux' }
    ];</code></pre>

<p>This is extremely useful for highlighting different levels of quoting in different colors when displaying a message. A similar concept is <a href="http://search.cpan.org/perldoc?Text::Original"><code>Text::Original</code></a>, which looks for the start of original, non-quoted content in an email. It knows about many kinds of attribution lines, so with:</p>

<pre><code>    $message = &lt;&lt;EOF
    You wrote:
    &gt; Why are there so many different mail modules?

    There's more than one way to do it! Different modules have different
    focuses, and operate at different levels; some lower, some higher.
    EOF</code></pre>

<p>the <code>first_sentence($message)</code> would be <code>There's more than one way to do it!</code>. The Mariachi mailing list archiver uses this technique to give a &quot;prompt&quot; for each message in a thread.</p>

<p>And speaking of threads, the <a href="http://search.cpan.org/perldoc?Mail::Thread"><code>Mail::Thread</code></a> module is a Perl implementation of Jamie Zawinski's mail threading algorithm, as used by Mozilla as well as many other mail clients since then. It's also used by Mariachi, and has recently been updated to use <code>Email::Abstract</code> to handle any kind of mail object you want to throw at it:</p>

<pre><code>    my $threader = Mail::Thread-&gt;new(@mails);
    $threader-&gt;thread; # Compute threads
    for ($threader-&gt;rootset) { # Original mails in a thread
        dump_thread($_);
    }</code></pre>

<h3><a name="Mail_filtering">Mail Filtering</a></h3>

<p>The classic Perl mail filtering tool is <a href="http://search.cpan.org/perldoc?Mail::Audit"><code>Mail::Audit</code></a>, and I've written articles here about using Mail::Audit on its own (<a href='http://www.perl.com/pub/a/2001/07/17/mailfiltering.html'>http://www.perl.com/pub/a/2001/07/17/mailfiltering.html</a>) and using it in conjunction with <a href="http://search.cpan.org/perldoc?Mail::SpamAssassin"><code>Mail::SpamAssassin</code></a> (<a href='http://www.perl.com/pub/a/2002/03/06/spam.html'>http://www.perl.com/pub/a/2002/03/06/spam.html</a>).</p>

<p>We've mentioned <a href="http://search.cpan.org/perldoc?Mail::ListDetector"><code>Mail::ListDetector</code></a> a couple of times already, and I use this with <code>Mail::Audit</code> to do most of the filtering automatically for me. The <code>Mail::Audit::List</code> plugin uses <code>ListDetector</code> to look for mailing list headers in a message; these are things like <code>List-Id</code>, <code>X-Mailman-Version</code>, and the like, which identify a mail as having come through a mailing list. This means I can filter out all mailing list posts to their own folders, like so:</p>

<pre><code>    my $list = Mail::ListDetector-&gt;new($obj);
    if ($list) {
        my $name = $list-&gt;listname;
        $item-&gt;accept(&quot;mail/$name.-$date&quot;);
    }</code></pre>

<p>However, <code>Mail::Audit</code> itself is getting a little long in the tooth, and so new installations are encouraged to use the Email Project's <a href="http://search.cpan.org/perldoc?Email::Filter"><code>Email::Filter</code></a> instead; it has the same interface for the most part, although not all of the same features, and it uses the new-fangled <code>Email::Simple</code> mail representation for speed and cleanliness.</p>

<h3><a name="Mail_mining">Mail Mining</a></h3>

<p>Finally, the most high-level thing I do with email is develop frameworks to automatically categorize, organize, and index mail into a database, and attempt to analyze it for interesting nuggets of information.</p>

<p>My first module to do this with was <a href="http://search.cpan.org/perldoc?Mail::Miner"><code>Mail::Miner</code></a>, which consists of three major parts. The first part takes an email, removes any attachments, and stores the lot in a database. The second looks over the email and runs a set of &quot;Recogniser&quot; modules on it; these find addresses, phone numbers, keywords and phrases, and so on, and store them in a separate database table. The third part is a command-line tool to query the database for mail and information.</p>

<p>For instance, if I need to find Tim O'Reilly's postal address, I ask the query tool, <code>mm</code>, to find addresses in emails from him:</p>

<pre><code> % mm --from &quot;Tim O&quot; --address              
 Address found in message 1835 from &quot;Tim O'Reilly&quot; &lt;tim@oreilly.com&gt;:
 Tim O'Reilly @ O'Reilly &amp; Associates, Inc.
 1005 Gravenstein Highway North, Sebastopol, CA 95472</code></pre>

<p>To retrieve the whole email, I'd say</p>

<pre><code> % mm --id 1835</code></pre>

<p>And if it originally contained an attachment, we'd see something like this as part of the email:</p>

<pre><code> [ text/xml attachment something.xml detached - use
   mm --detach 208
   to recover ]</code></pre>

<p>I paste that middle line <code>mm --detach 208</code> into a shell, and hey presto, <em>something.xml</em> is written to disk.</p>

<p>Now <code>Mail::Miner</code> is all very well, but having the three ideas in one tight package--filing mail, mining mail, and interfacing to the database--makes it difficult to develop and extend any one of them. And of course, it uses the old-school <code>Mail::</code> modules.</p>

<p>This brings us to our final module on the mail modules tour, and the most recently released: <a href="http://search.cpan.org/perldoc?Email::Store"><code>Email::Store</code></a>. This is a framework, based on <a href="http://search.cpan.org/perldoc?Class::DBI"><code>Class::DBI</code></a>, for storing email in a database and indexing it in various ways:</p>

<pre><code>   use Email::Store 'dbi:SQLite:mail.db';
   Email::Store-&gt;setup;
   Email::Store::Mail-&gt;store($rfc2822);</code></pre>

<p>And then later...</p>

<pre><code>   my ($name) = Email::Store::Name-&gt;search( name =&gt; &quot;Simon Cozens&quot; )
   @mails_from_simon = $name-&gt;addressings( role =&gt; &quot;From&quot; )-&gt;mails;</code></pre>

<p>It can be used to build a mailing list archive tool such as Mariachi, or a data mining setup like <code>Mail::Miner</code>. It's still very much in development, and makes use of a new idea in module extensibility.</p>

<p>I'll be bringing more information when we've written the first mail archiving and searching tool using <code>Email::Store</code>, which I'm going to be doing as a new interface to the Perl mailing lists at <code>perl.org</code>.</p>

<h3><a name="Conclusion">Conclusion</a></h3>

<p>We've looked at the major modules for mail handling on CPAN, and there are many more. I am obviously biased towards those which I wrote, and particularly the Perl Email Project modules in the <code>Email::*</code> namespace. These modules are specifically designed to be simple, efficient, and correct, but may not always be a good substitute for the more thorough <code>Mail::*</code> modules, particularly <code>Mail::Box</code>. However, I hope you're now a little more aware of the diversity of mail handling tools out there, and know where to look next time you need to manipulate email with Perl.</p>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-948" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/06/p6pdigest/20040606.html" rel="bookmark">This Week on Perl 6, Fortnight Ending 2004-06-06</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-06-09T00:00:00-08:00">June  9, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
             <p>Whee! There's a new graphics card in the G5, which means I can type this 
  at the big screen again, which makes me happy. Well, it would make me far happier 
  if the new card didn't leave horrible artifacts all over the screen like 
  some kind of incontinent puppy attempting to fulfil OpenGL draw instructions. 
  Maybe next week will see a third card in the box.</p>
<p>Dang! It looks like the G5 will be off receiving some TLC from an Apple service 
  centre while I'm on holiday next week. Which means that the 'weekly' 
  summaries will continue on their fortnightly summer holiday schedule for at 
  least one more summary. But then the lists themselves appear to be on summer 
  footing anyway.</p>
<p>Ahem.</p>
<p>As you will probably have worked out by now, we start with perl6-internals.</p>
<h4><a name="Library_loading">Library loading</a></h4>
<p>Jens Rieks is working on library loading code that does all the nice things 
  we've come to expect from other languages. The plan being that you'll 
  be able to write (say)</p>
<pre><code>    use('some_library')</code></pre>
<p>and Parrot will go off and search it's include paths for <em lang='und' xml:lang='und'>some_library.(pbc|imc|pasm|whatever)</em> 
  and load it. As he noted, if you're going to implement that kind of code 
  in parrot assembler (or PIR, or whatever), you need some way of loading the 
  loading code. It's also a good idea to have a working <code>stat</code>. 
  Jens added a <code>Parrot_load_bytecode_direct</code> function to the parrot 
  core to support the first part. His please for a functional (if not complete) 
  <code>stat</code> were answered by Dan who set about implementing the <code>stat</code> 
  API he outlined a few weeks ago.</p>
<p><a href='http://groups.google.com/groups?selm=200405211333.22233.parrot@jensbeimsurfen.de'>http://groups.google.com/groups?selm=200405211333.22233.parrot@jensbeimsurfen.de</a></p>
<h4><a name="Embedding_Parrot">Embedding Parrot</a></h4>
<p>Leo T&ouml;tsch and chromatic answered Paul Querna's questions from 
  last week about embedding Parrot.</p>
<p><a href='http://groups.google.com/groups?selm=200405241043.i4OAh7a01618@thu8.leo.home'>http://groups.google.com/groups?selm=200405241043.i4OAh7a01618@thu8.leo.home</a></p>
<h4><a name="Using_PMCs_as_PerlHash_keys">Using PMCs as PerlHash keys</a></h4>
<p>TOGoS wanted to know how he could use a PMC as a key in a PerlHash. Leo replied 
  that it was as simple as doing</p>
<pre><code>    $P2 = new Key
    $P2 = &#34;key_string&#34;
    $P0 = $P1[$P2]</code></pre>
<p>Piers Cawley did some naive translation into PASM and got himself horribly 
  confused. Leo and TOGoS corrected him.</p>
<p><a href='http://groups.google.com/groups?selm=20040520190352.46387.qmail@web41410.mail.yahoo.com'>http://groups.google.com/groups?selm=20040520190352.46387.qmail@web41410.mail.yahoo.com</a></p>
<h4><a name="First_draft_of_IO_and_event_design">First draft of IO and event design</a></h4>

<csperl file="grab" domain="on" record="b/1424" template="b/article_sidebar.view">

<p>Remarking that events and IO are &#34;(kinda, sorta)&#34; the same thing, Dan 
  posted his first draft of a unified IO and events design and asked for comments. 
  This being p6i, he got several (though not as many as usual, maybe everyone 
  likes it).</p>
<p><a href='http://groups.google.com/groups?selm=a0611040abcd7faf9492e@[10.0.1.3]'>http://groups.google.com/groups?selm=a0611040abcd7faf9492e@[10.0.1.3]</a></p>
<h4><a name="Freeze,_objects,_crash,_boom">Freeze, objects, crash, boom</a></h4>
<p>Will Coleda tried to get freezing and objects to play well together and failed. 
  So he asked a bunch of questions. Leo didn't solve the problem, but he did 
  have some pointers to where it was coming from.</p>
<p><a href='http://groups.google.com/groups?selm=40B4D76B.5060306@coleda.com'>http://groups.google.com/groups?selm=40B4D76B.5060306@coleda.com</a></p>
<h4><a name="MMD_table_setup_semantics">MMD table setup semantics</a></h4>
<p>Possibly winning an award for the oldest rejuvenated thread, Nicholas Clark 
  had some questions about a post Dan made about MMD at the end of April. He made 
  a suggesting about how to calculate 'distance' for multi dispatch. Dan 
  pointed out that Larry had decreed that the 'distance' would be the 
  'Manhattan Distance'. (Google has several definitions).</p>
<p><a href='http://groups.google.com/groups?selm=20040527143518.GD1129@plum.flirble.org'>http://groups.google.com/groups?selm=20040527143518.GD1129@plum.flirble.org</a></p>
<h4><a name="Compiler_FAQ_entry">Compiler FAQ entry</a></h4>
<p>Will Coleda posted a possible set of entries for the compiler writers' 
  FAQ. Leo had a few quibbles. Sterling Hughes suggested that having small, runnable 
  source code examples would be really helpful.</p>
<p><a href='http://groups.google.com/groups?selm=40B7ECCF.6030205@coleda.com'>http://groups.google.com/groups?selm=40B7ECCF.6030205@coleda.com</a></p>
<h4><a name="Layering_PMCs">Layering PMCs</a></h4>
<p>Dan kicked off a discussion on how to go about layering PMCs. The usual suspects 
  offered suggestions. The aim is to be able to layer behaviours on top of PMCs 
  without massive overhead or combinatorial explosion problems. As usual with 
  these things, there's several possible ways of doing it, the debate is about 
  choosing the best one.</p>
<p><a href='http://groups.google.com/groups?selm=a06110404bcde7bf18ebd@[172.24.18.98]'>http://groups.google.com/groups?selm=a06110404bcde7bf18ebd@[172.24.18.98]</a></p>
<h4><a name="IO_Layers">IO Layers</a></h4>
<p>Leo had some questions about the (not fully implemented) ParrotIOLayerAPI. 
  He laid out a proposal for implementing things. Uri Guttman and Dan joined in 
  a discussion of the issues. (Simple summary of the issues: Asynchronous IO is 
  hard. Possibly more accurate summary of the issues: Asynchronous IO is *not* 
  synchronous)</p>
<p><a href='http://groups.google.com/groups?selm=40B71F53.8000001@toetsch.at'>http://groups.google.com/groups?selm=40B71F53.8000001@toetsch.at</a></p>
<h4><a name="PIO_unix_pipe()"><code>PIO_unix_pipe()</code></a></h4>
<p>Leo's implemented a <code>PIO_unix_pipe()</code> method which allows you 
  to run an external program and capture the results with a Parrot IO handle. 
  He doctored the <code>open</code> opcode to use it</p>
<pre><code>    pipe = open &#34;/bin/ls -l&#34;, &#34;-|&#34; </code></pre>
<p>Dan liked it, but proposed also adding a <code>backtick</code> operator.</p>
<p><a href='http://groups.google.com/groups?selm=40C1C64D.5080105@toetsch.at'>http://groups.google.com/groups?selm=40C1C64D.5080105@toetsch.at</a></p>
<h4><a name="Register_spilling">Register spilling</a></h4>
<p>Dan noted that it's possible to get the register allocator caught up in 
  an infinite loop (or as near infinite as makes no difference) as it tries to 
  work out a register spilling strategy. He proposed there be a 'slow but 
  working' fallback method to use if the normal method goes through too many 
  iterations. Leo suggested an delightfully brute force approach with some possible 
  elaborations that Dan didn't think would be that useful in the cases he 
  was seeing.</p>
<p><a href='http://groups.google.com/groups?selm=rt-3.0.9-29837-88076.5.39698439413385@perl.org'>http://groups.google.com/groups?selm=rt-3.0.9-29837-88076.5.39698439413385@perl.org</a></p>
<h4><a name="Stat">Stat</a></h4>
<p>Dan implemented a simple <code>stat</code> function that should be enough for 
  Jens Rieks to get a library path based loading system to work. Leo patched his 
  first attempt and most things in the garden were lovely (with a couple of rather 
  less pretty spots that are being worked on as I type).</p>
<p><a href='http://groups.google.com/groups?selm=a06110401bcd836c94dd7@[172.24.18.98]'>http://groups.google.com/groups?selm=a06110401bcd836c94dd7@[172.24.18.98]</a></p>
<h4><a name="Bit_ops_on_strings">Bit ops on strings</a></h4>
<p>Argh! The character encoding discussion! Run away!</p>
<p>Nicholas Clark and Dan discussed Parrots Unicode handling.</p>
<p><a href='http://groups.google.com/groups?selm=20040525113008.GC1129@plum.flirble.org'>http://groups.google.com/groups?selm=20040525113008.GC1129@plum.flirble.org</a></p>
<h4><a name="Standard_Library_behaviour">Standard Library behaviour</a></h4>
<p>Dan commented that now Jens was working the architecture of the standard library, 
  the time had come to discuss how things should work. He outlined the options, 
  asked for comments, and got promptly Warnocked.</p>
<p><a href='http://groups.google.com/groups?selm=a06110407bcd924533939@[10.0.1.3]'>http://groups.google.com/groups?selm=a06110407bcd924533939@[10.0.1.3]</a></p>
<h3><a name="Meanwhile,_in_perl6-language">Meanwhile, in perl6-language</a></h3>
<h4><a name="The_Periodic_Table_of_the_Operators">The Periodic Table of the Operators</a></h4>
<p>Mark Lentczner announced that he'd put together a periodic table of Perl 
  6 operators. Everyone liked it, though several amendments were proposed and 
  made. Check it out, it's very lovely (and anyone who references the great 
  Edward Tufte in his explanation of the design is likely to be all right in my 
  book).</p>
<p>There will be T-shirts.</p>
<p><a href='http://groups.google.com/groups?selm=486B658A-AF64-11D8-8F60-000393A56BB6@glyphic.com'>http://groups.google.com/groups?selm=486B658A-AF64-11D8-8F60-000393A56BB6@glyphic.com</a></p>
<p><a href='http://www.ozonehouse.com/mark/blog/code/PeriodicTable.html'>http://www.ozonehouse.com/mark/blog/code/PeriodicTable.html</a></p>
<h4><a name="Announcements,_Apologies,_Acknowledgements">Announcements, Apologies, 
  Acknowledgements</a></h4>
<p>Ah well, if you can't beat the system, roll with it and pretend it's 
  deliberate. Next week's summary definitely won't be next week, but there 
  will be another fortnightly summary covering the fortnight ending 2004-06-20. 
  And the next summary will almost certainly be on a fortnightly schedule too, 
  unless BT work some miracle and sort out my ADSL transfer promptly.</p>
<p>If you find these summaries useful or enjoyable, please consider contributing 
  to the Perl Foundation to help support the development of Perl. You might also 
  like to send me feedback at <a href='mailto:pdcawley@bofh.org.uk'>mailto:pdcawley@bofh.org.uk</a></p>
<p><a href='http://donate.perl-foundation.org/'>http://donate.perl-foundation.org/</a> 
  -- The Perl Foundation</p>
<p><a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> -- Perl 
  6 Development site</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-940" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/06/04/recorder.html" rel="bookmark">Web Testing with HTTP::Recorder</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Linda Julien</span> on <abbr class="published" title="2004-06-04T00:00:00-08:00">June  4, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p><code>HTTP::Recorder</code> is a browser-independent recorder that
records interactions with web sites and produces scripts for
automated playback.  Recorder produces <code>WWW::Mechanize</code>
scripts by default (see <a href="http://search.cpan.org/search?query=www%3A%3Amechanize&mode=all"><code>WWW::Mechanize</code></a> by Andy Lester),
but provides functionality to use your own custom logger.</p>

<h3>Why Use <code>HTTP::Recorder</code>?</h3>

<p>Simply speaking, <code>HTTP::Recorder</code> removes a great deal
of the tedium from writing scripts for web automation.  If you're like
me, you'd rather spend your time writing code that's interesting and
challenging, rather than digging through HTML files, looking for the
names of forms an fields, so that you can write your automation
scripts.  <code>HTTP::Recorder</code> records what you do as you do
it, so that you can focus on the things you care about.</p>

<h4>Automated Testing</h4>

<p>We all know that testing our code is good, and that writing
automated tests that can be run again and again to check for
regressions is even better.  However, writing test scripts by hand can
be tedious and prone to errors.  You're more likely to write tests if
it's easy to do so.  The biggest obstacle to testing shouldn't be the
mechanics of getting the tests written &mdash; it should be figuring
out what needs to be tested, and how best to test it.</p>

<p>Part of your test suite should be devoted to testing things the way
the user uses them, and <code>HTTP::Recorder</code> makes it easy to
produce automation to do that, which allows you to put your energy
into the parts of your code that need your attention and your
expertise.</p>

<h4>Automate Repetitive Tasks</h4>

<p>When you think about web automation, the first thing you think of
may be automated testing, but there are other uses for automation as
well:</p>

<ul>
<li>Check your bank balance.</li>
<li>Check airline fares.</li>
<li>Check movie times.</li>
</ul>

<h3>How to Set It Up</h3>

<h4>Use It with a Web Proxy</h4>

<p>One way to use <code>HTTP::Recorder</code> (as recommended in the
POD) is to set it as the user agent of a web proxy (see <a href="http://search.cpan.org/search?query=http%3A%3Aproxy&mode=all"><code>HTTP::Proxy</code></a>
by Phillipe "BooK" Bruhat).  Start the proxy running like this:</p>

<pre><code>
    #!/usr/bin/perl

    use <code>HTTP::Proxy</code>;
    use <code>HTTP::Recorder</code>;

    my $proxy = HTTP::Proxy->new();

    # create a new HTTP::Recorder object
    my $agent = new HTTP::Recorder;

    # set the log file (optional)
    $agent->file("/tmp/myfile");

    # set HTTP::Recorder as the agent for the proxy
    $proxy->agent( $agent );

    # start the proxy
    $proxy->start();

    1;
</code></pre>

<p>Then, instruct your favorite web browser to use your new proxy for
HTTP traffic.</p>

<h4>Other Ways to Use It</h4>

<p>Since <code>HTTP::Recorder</code> is a subclass of LWP::UserAgent,
so you can use it in any way that you can use its parent class.</p>

<h3>How to Use It</h3>

<p>Once you've set up <code>HTTP::Recorder</code>, just navigate to
web pages, follow links, and fill in forms the way you normally do,
with the web browser of your choice.  <code>HTTP::Recorder</code> will
record your actions and produce a <code>WWW::Mechanize</code> script
that you can use to replay those actions.</p>

<p>The script is written to a logfile.  By default, this file is
<code>/tmp/scriptfile</code>, but you can specify another pathname
when you set things up.  See <a href="#config">Configuration
Options</a> for information about configuring the logfile.</p>

<h4><a name="control_panel"><code>HTTP::Recorder</code> Control Panel</a></h4>

<p>The <code>HTTP::Recorder</code> control panel allows you to use to
view and edit scripts as you create them.  By default, you can access
the control panel by using the <code>HTTP::Recorder</code> UserAgent
to access the control URL.  By default, the control URL is
<code>http://http-recorder/</code>, but this address is configurable.
See <a href="#config">Configuration Options</a> for more information
about setting the control URL.</p>

<p>The control panel won't automatically refresh , but if you create
<code>HTTP::Recorder</code> with <code>showwindow => 1</code>, a
JavaScript popup window will be opened and refreshed every time
something is recorded.</p>

<p><img src="/pub/2004/06/04/graphics/control.jpg" border="0" width="400" height="425" alt="" /></p>

<p><b>Goto Page.</b> You can enter a URL in the control panel to begin
a recording session.  For SSL sessions, the initial URL must be
entered into this field rather than into the browser.</p>

<p><b>Current Script.</b> The current script is displayed in a
textfield, which you can edit as you create it.  Changes you make in
the control panel won't be saved until you click the Update button.</p>

<p><b>Update.</b> Saves changes made the script via the control panel.
If you prefer to edit your script as you create it, you can save your
changes as you make them.</p>

<p><b>Clear.</b> Deletes the current script and clears the text field.</p>

<p><b>Reset.</b> Reverts the text field to the currently saved version
of the script.  Any changes you've made to the script won't be applied
if you haven't clicked Update.</p>

<p><b>Download.</b> Displays a plain text version of the script,
suitable for saving.</p>

<p><b>Close.</b>  Closes the window (using JavaScript).</p>













<h4>Updating Scripts as They're Recorded</h4>

<p>You can record many things, and then turn the recordings into
scripts later, or you can make changes and additions as you go by
editing the script in the <a href="/pub/a/2004/06/04/recorder.html?page=1#control_panel">Control Panel</a>.</p>

<p>For example, if you record filling in this form and clicking the
Submit button:</p>

<p><img src="/pub/2004/06/04/graphics/form1.jpg" width="271" height="36" alt="" /></p>

<p><code>HTTP::Recorder</code> produces the following lines of code:</p>

<pre><code>    $agent->form_name("form1");
    $agent->field("name", "Linda Julien");
    $agent->submit_form(form_name => "form1");
</code></pre>

<p>However, if you're writing automated tests, you probably don't want
to enter hard-coded values into the form.  You may want to re-write
these lines of code so that they'll accept a variable for the value of
the <code>name</code> field.</p>

<p>You can change the code to look like this:</p>

<pre><code>    my $name = "Linda Julien";

    $agent->form_name("form1");
    $agent->field("name", $name);
    $agent->submit_form(form_name => "form1");
</code></pre>

<p>Or even this:</p>

<pre><code>    sub fill_in_name {
      my $name = shift;

      $agent->form_name("form1");
      $agent->field("name", $name);
      $agent->submit_form(form_name => "form1");
    }

    fill_in_name("Linda Julien");
</code></pre>

<p>Then click the Update button.  <code>HTTP::Recorder</code> will
save your changes, and you can continue recording as before.</p>

<p>You may also want to add tests as you go, making sure that the
results of submitting the form were what you expected:</p>

<p><img src="/pub/2004/06/04/graphics/form2.jpg" width="242" height="69" alt="" /></p>

<p>You can add tests to the script like this:</p>

<pre><code>    sub fill_in_name {
      my $name = shift;

      $agent->form_name("form1");
      $agent->field("name", $name);
      $agent->submit_form(form_name => "form1");
    }

    my $entry = "Linda Julien";
    fill_in_name($entry);

    $agent->content =~ /You entered this name: (.*)/;
    is ($1, $entry);
</code></pre>

<h4>Using <code>HTTP::Recorder</code> with SSL</h4>

<p>In order to do what it does, <code>HTTP::Recorder</code> relies on
the ability to see and modify the contents of requests and their
resulting responses...and the whole point of SSL is to make sure you
can't easily do that.  <code>HTTP::Recorder</code> works around this,
however, by handling the SSL connection to the server itself, and and
communicating with your browser via plain HTTP.</p>

<p><i><b>Caution:</b> Keep in mind that communication between your
browser and <code>HTTP::Recorder</code> isn't encrypted, so take care
when recording sensitive information, like passwords or credit card
numbers.  If you're running the Recorder as a proxy on your local
machine, you have less to worry about than if you're running it as a
proxy on a remote machine.  The resulting script for playback
will be encrypted as usual.</i></p>

<p>If you want to record SSL sessions, here's how you do it:</p>

<p>Start at the control panel, and enter the initial URL there rather
than in your browser.  Then interact with the web site as you normally
would.  <code>HTTP::Recorder</code> will record form submissions,
following links, etc.</p>

<h4>Replaying your Scripts</h4>

<p><code>HTTP::Recorder</code> getting pages, following links, filling
in fields and submitting forms, etc., but it doesn't (at this point)
generate a complete perl script.  Remember that you'll need to add
standard script headers and initialize the <code>WWW::Mechanize</code>
agent, with something like this:</p>

<pre><code>#!/usr/bin/perl

    use strict;
    use warnings;
    use WWW::Mechanize;
    use Test::More qw(no_plan);

    my $agent = WWW::Mechanize->new();
</code></pre>

<h4><a name="config">Configuration Options</a></h4>

<p><b>Output file.</b>  You can change the filename for the scripts
that <code>HTTP::Recorder</code> generates with the
<code>$recorder->file([$value])</code> method.  The default output
file is '/tmp/scriptfile'.</p>

<p><b>Prefix.</b> <code>HTTP::Recorder</code> adds parameters to link
URLs and adds fields to forms.  By default, its parameters begin with
"rec-", but you can change this prefix with the
<code>$recorder->prefix([$value])</code> method.</p>

<p><b>Logger.</b> The <code>HTTP::Recorder</code> distribution
includes a default logging module, which outputs
<code>WWW::Mechanize</code> scripts.  You can change the logger with
the <code>$recorder->logger([$value])</code> method, replacing it with
a logger that:</p>

<ul>

<li>subclasses the standard logger to provice special functionality
unique to your site</li>

<li>outputs an entirely different type of script</li>

</ul>

<p>RT (Request Tracker) 3.1 by <a href="http://www.bestpractical.com/">Best Practical Solutions</a> has
a Query Builder that's a good example of a page that benefits from a
custom logger:</p>

<p><img src="/pub/2004/06/04/graphics/BuildQuery.jpg" width="400" height="312" alt="" /></p>













<p>This page has several Field/Operator/Value groupings.  Left to its
own devices, the default <code>HTTP::Recorder::Logger</code> will
record every field for which a value has been set:</p>

<pre><code>    $agent->form_name("BuildQuery");
    $agent->field("ActorOp", "=");
    $agent->field("AndOr", "AND");
    $agent->field("TimeOp", "&lt;");
    $agent->field("WatcherOp", "LIKE");
    $agent->field("QueueOp", "=");
    $agent->field("PriorityOp", "&lt;");
    $agent->field("LinksOp", "=");
    $agent->field("idOp", "&lt;");
    $agent->field("AttachmentField", "Subject");
    $agent->field("ActorField", "Owner");
    $agent->field("PriorityField", "Priority");
    $agent->field("StatusOp", "=");
    $agent->field("DateField", "Created");
    $agent->field("TimeField", "TimeWorked");
    $agent->field("LinksField", "HasMember");
    $agent->field("WatcherField", "Requestor.EmailAddress");
    $agent->field("AttachmentOp", "LIKE");
    $agent->field("ValueOfAttachment", "foo");
    $agent->field("DateOp", "&lt;");
    $agent->submit_form(form_name => "BuildQuery");
</code></pre>

<p>But on this page, there's no need to record setting the values of
fields (XField) and operators (XOp) unless a value (ValueOfX) has
actually been set.  We can do this with a custom logger that checks
for the presence of a value, and only records the value of the
field and operator fields if the value field has been set:</p>

<pre><code>    package HTTP::Recorder::RTLogger;

    use strict;
    use warnings;
    use HTTP::Recorder::Logger;
    our @ISA = qw( HTTP::Recorder::Logger );

    sub SetFieldsAndSubmit {
        my $self = shift;
        my %args = (
		    name => "",
		    number => undef,
		    fields => {},
		    button_name => {},
		    button_value => {},
		    button_number => {},
		    @_
		    );

	$self->SetForm(name => $args{name}, number => $args{number});
	my %fields = %{$args{fields}};
	foreach my $field (sort keys %fields) {
	    if ( $args{name} eq 'BuildQuery' &amp;&amp;
		 ($field =~ /(.*)Op$/ || $field =~ /(.*)Field$/) &amp;&amp;
		 !exists ($fields{'ValueOf' . $1})) {
		next;
	    }
	    $self->SetField(name => $field, 
			    value => $args{fields}->{$field});
	}
	$self->Submit(name => $args{name}, 
		      number => $args{number},
		      button_name => $args{button_name},
		      button_value => $args{button_value},
		      button_number => $args{button_number},
		      );
    }

    1;
</code></pre>

<p>Tell <code>HTTP::Recorder</code> to use the custom logger like
this:</p>

<pre><code>    my $logger = new HTTP::Recorder::RTLogger;
    $agent->logger($logger);
</code></pre>

<p>And it will record a much more reasonable number of things:</p>

<pre><code>    $agent->form_name("BuildQuery");
    $agent->field("AndOr", "AND");
    $agent->field("AttachmentField", "Subject");
    $agent->field("AttachmentOp", "LIKE");
    $agent->field("ValueOfAttachment", "foo");
    $agent->submit_form(form_name => "BuildQuery");
</code></pre>

<p><b>Control panel.</b> By default, you can access the
<code>HTTP::Recorder</code> control panel by using the Recorder to get
<code>http://http-recorder</code>.  You can change this URL with the
<code>$recorder->control([$value])</code> method.</p>

<h5>Logger Options</h5>

<p><b>Agent name.</b> By default, <code>HTTP::Recorder::Logger</code>
outputs scripts with the agent name <code>$agent</code>:</p>

<pre>
     $agent->follow_link(text => "Foo", n => 1);
</pre>

<p>However, if you prefer a different agent name (in order to drop
recorded lines into existing scripts, conform to company conventions,
etc.), you can change that with the
<code>$logger->agentname([value])</code> method:</p>

<pre>
     $recorder->agentname("mech");
</pre>

<p>will produce the following:</p>

<pre>
     $mech->follow_link(text => "Foo", n => 1);
</pre>

<h3>How <code>HTTP::Recorder</code> Works</h3>

<p>The biggest challenge to writing a web recorder is knowing what the
user is doing, so that it can be recorded.  A proxy can watch requests
and responses go by, the only thing you'll learn is the URL that was
requested and its parameters.  <code>HTTP::Recorder</code> solves this
problem by rewriting HTTP responses as they come through, and adding
additional information to the page's links and forms, so that it can
extract that information again when the next request comes through.</p>

<p>As an example, a page might contain a link like this:</p>

<pre><code>    &lt;a href="http://www.cpan.org/"&gt;CPAN&lt;/a&gt;</code></pre>

<p>If the user follows the link, and we want to record it, we need to
know all of the relevant information about the action, so that we can
produce a line of code that will replay the action.  This includes:</p>

<ul>
<li>the fact that a link was followed.</li>
<li>the text of the link.</li>
<li>the URL of the link.</li>
<li>the index (in case there are multiple links on the page of the
same name).</li>
</ul>

<p><code>HTTP::Recorder</code> overloads LWP::UserAgent's
<code>send_request</code> method, so that it can see requests and
responses as they come through, and modify them as needed.</p>

<p><code>HTTP::Recorder</code> rewrites the link so that it looks like this:</p>

<p><code>&lt;a href="http://www.cpan.org/?rec-url=http%3A%2F%2Fwww.cpan.org%2F&amp;rec-action=follow&amp;rec-text=CPAN&amp;rec-index=1"&gt;CPAN&lt;/a&gt;
</code></p>

<p>So, with the rewritten page, if the user follows this link, the
request will contain all of the information needed to record the
action.</p>

<p>Forms are handled likewise, with additional fields being added to
the form so that the information can be extracted later.
<code>HTTP::Recorder</code> then removes the added parameters from the
resulting request, and forwards the request along in something close
to its originally intended state.</p>

<h3>Looking Ahead</h3>

<p><code>HTTP::Recorder</code> won't record 100% of every script you
need to write, and while future versions will undoubtedly have more
features, they still won't write your scripts for you.  However, it
will record the simple things, and it will give you example code that
you can cut, paste, and modify to write the scripts that you need.</p>

<p>Some ideas for the future include:</p>

<ul>

<li>Choosing from a list of simple tests based on the fields on the
page and their current values.</li>

<li>"Threaded" recording, so that multiple sessions won't be recorded
in the same file, overlapped with each other.</li>

<li>"Add script header" feature.</li>

<li>Supporting more configuration options from the control panel.</li>

<li>Other loggers.</li>

<li>JavaScript support.</li>

</ul>

<h3>Where to Get <code>HTTP::Recorder</code></h3>

<p>The latest released version of <code>HTTP::Recorder</code> is available at <a href="http://search.cpan.org/search?query=http%3A%3Arecorder&mode=all">CPAN</a>.</p>

<h3>Contributions, Requests, and Bugs</h3>

<p>Patches, feature requests, and problem reports are welcomed at
<a href="http://rt.cpan.org">http://rt.cpan.org</a>.</p>

<p>You can subscribe to the mailing list for users and developers of
HTTP::Recorder at <a href="http://lists.fsck.com/mailman/listinfo/http-recorder">http://lists.fsck.com/mailman/listinfo/http-recorder</a>,
or by sending email to http-recorder-request@lists.fsck.com with the
subject "subscribe".</p>

<p>The mailing list archives can be found at
<a href="http://lists.fsck.com/piper-mail/http-recorder">http://lists.fsck.com/piper-mail/http-recorder</a>.</p>


<h3>See Also</h3>

<p><a href="http://search.cpan.org/search?query=www%3A%3Amechanize&mode=all"><code>WWW::Mechanize</code></a> by Andy Lester.</p>

<p><a href="http://search.cpan.org/search?query=http%3A%3Aproxy&mode=all"><code>HTTP::Proxy</code></a> by Phillipe "BooK" Bruhat.</p>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2004/05/">&laquo; May 2004</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2004/07/">July 2004 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
