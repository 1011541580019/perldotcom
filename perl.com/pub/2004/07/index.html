<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: July 2004 Archives</title>


    <link rel="prev" href="/pub/2004/06/" title="June 2004" />
    <link rel="next" href="/pub/2004/08/" title="August 2004" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">July 2004 Archives</h1>





                            
                            <div id="entry-960" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/07/30/lightningtalk.html" rel="bookmark">Giving Lightning Talks</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mark Fowler</span> on <abbr class="published" title="2004-07-30T00:00:00-08:00">July 30, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>After the keynotes, the most popular sessions at most Perl conferences tend
to be the lightning talks. Each session consists of about 10 to 15
lightning talks &mdash; talks typically lasting individually no more than five
minutes &mdash; back to back. As well as being tremendously interesting and
entertaining for attendees, the conference organizers recognize that they offer
an unequalled opportunity for new speakers to present for the first time
without going to the lengths required for a longer talk.</p>

<p>Which is why I was surprised that at this year's YAPC someone raised the
point in the town hall meeting that there's no document that stands as a basic
guide for pointing out the common pitfalls to new speakers. Armed with my
experiences of YAPCs and organizing many, many London Perl Monger tech meets I
thought I'd have a go at explaining what you need to know.</p>

<p>Lightning talks are a great way to start speaking, but they do come with
their own potential problems. Even the seasoned presenter makes mistakes when
presenting and has had lightning talks go horribly, horribly wrong. Luckily,
Perl audiences are very forgiving when this happens &mdash; after all, it's
happened to half the audience at sometime too, so it's nothing to get too worked
up about.  However, there are a few things you can consider when writing your
talk that will prevent you from sabotaging your own talk before it even
begins.</p>

<h3>Make your Point</h3>

<p>First of all, let's look at the point of a lightning talk. The point is to
make a point, and explain it as quickly as possible.  That's it.
Understand?</p>

<p>Too many lightning talks forget this. They get caught up in the whole idea
of providing background information or explaining other issues. They've got a full
five minutes, damn it, and they're gonna <em>use</em> them.</p>

<p>Here's the secret; No one cares if your lightning talk only lasts four
minutes. No one cares if it lasts three. I've seen talks that last two minutes
and the crowd loved it. But <em>everyone</em> cares if it lasts six &mdash;
especially if the important point you need to make happens at five minutes and
10 seconds. At a YAPC or other event with strict time keeping you'll be cut
off at five, and no one will hear what you were actually trying to say.</p>

<p>One of the best tactics is to make your point as early in the talk as
humanly possible. You might need to set up the problem space, explain why you
were doing what you were doing before you can explain your point. Fine, but do
it quickly. You really shouldn't spend more than a minute explaining the
background before you make your first point. If you haven't explained the main
point by minute three you're probably up the proverbial creek without the
paddle.</p>

<p>Actually, that bit about not explaining much before your first point isn't
really true. You see, if you're explaining the background to the problem, that
<em>itself</em> has to be your first point. You must carry your audience along,
keeping them interested until you hit what you consider to be the <em>actual</em>
point of the presentation. You know how to do this &mdash; you know to
generalize your problem into the larger problem that everyone has and therefore
cares about, right?</p>

<h3>Most Details Don't Matter</h3>

<p>This brings me nicely to the bane of most lightning talks. The details.
Here's the rub; No one cares, and even if they do, certainly no one will
remember the little details 10 minutes after your talk has ended. This means
that unless those details are absolutely necessary to explain the point you're trying to make, then they're just sucking up time. Even if they're
necessary, stop and think, can you replace these with a shorter summary,
something that you can explain easier?  Remember, you're talking to an
intelligent crowd here who can normally move from A to B without having to be
handled through each and every step.</p>

<p>One of the biggest mistakes people make about the details is misunderstanding that just because they've put something on the slides it means
that they have to explain it. For example, you might need to show slides to
demonstrate that one of the things your spiffy new function allows you to do is
rewrite a huge chunk of code into a much smaller piece of code. This means that
you probably need a before and after slide with one slide containing a mountain
of code and one containing very little, but it doesn't mean you <em>have</em>
to explain <em>how</em> they're different in great detail. That should be self-evident (or if it's not, your new function isn't nearly spiffy enough.) Someone
can always download your slides later if they really want to read the example
carefully.</p>

<h3>Practice</h3>

<p>When it comes down to it there's only one way to make sure that your talk
will fit in the time-slot, and that's to practice it.  Read it out aloud
several times. Present it to the cat. Try to convince your
colleague/flatmate/significant other to listen to it. If you're presenting at a
conference, see if you can present it at your local Perl Monger meeting beforehand as a dry run. Not only will this give you the most accurate
understanding of how long it'll take to say everything (and believe me, you'll
be surprised at what bits go quickly and what bits drag), but it'll also help
you realize what bits can be cut and replaced. It'll also give you confidence
and experience in the talk, so you can actually present it slightly
quicker.</p>

<p>Having covered the contents of your talk, let's move onto the practicalities
of <em>how</em> you'll do it.</p>

<h3>Slides</h3>

<p>Let's talk about slides. Firstly, do you actually need slides at all? You'll
only talk for five minutes. Crib notes on paper work well. One of my favorite
lightning talks had someone just talking from a bunch of index cards, each with
one word on it to remind him what he was going to talk about next,. And each one
he'd theatrically throw over his shoulder after he was done with it.  Remember,
the slides are to show things to the audience, not to help you remember what
you're talking about. Think of the lightning talk as a narrative with visual
aids &mdash; someone once told me presenting a lightning talk is just like
having a conversation with the audience where they don't speak for five
minutes.</p>

<h3>Prepare your Slides</h3>

<p>All this said, let's assume you've decided that you need slides.  Remember,
you have five minutes. This means that you have zero time to faff about with
your slides, setting up your computer, or otherwise doing anything that isn't
entertaining your audience. Preparation is everything.</p>

<p>The audience bores easily so it's important that you don't keep them waiting
before you start speaking.  If you have your slides on your laptop make sure
everything is set up so you can start talking as soon as it's plugged in.
Set up and load all the apps you're going to use first &mdash; no one wants to
be caught on stage in an awkward silence with nothing to say while they wait
the 20 seconds it takes Mozilla to load. While you're at it don't forget to
close down instant-messenger clients, calendaring apps, and anything else that
might randomly pop up dialogs when you're trying to speak.</p>

<p>It's absolutely critical that you take the time to check that your laptop
works with the projector before the lightning talk session. Make sure that you
don't have to do anything other than plug the projector in, that you don't
have to remember some weird key combo to make the external display work, and
that you have enough power to last the entire talk (including the time your
laptop will be switched on while you're waiting your turn).</p>

<p>Of course, the best way to get around this faffing about with switching laptops is
to work out who's talking before you and arrange to use their computer. One of
the major drawbacks to this is, of course, that you might not be familiar with
their setup. This means that you should, at the very least, run through your
presentation. Don't assume that one web browser is like any other &mdash; they
all have slightly different ways of laying out pages and having plugins installed. Try
it first to find problems while no one is watching, rather than trying to debug
your presentation setup on stage. Have your own laptop ready in case theirs
suddenly fails for some unknown reason.</p>

<h3>Presentation Software</h3>

<p>When it comes to actually writing a lightning talk, there are many choices
of presentation software.  Although there isn't one right piece of software for
everyone, there are definitely wrong choices.  That wrong choice is anything
that requires any thought on your part while you're presenting. It's
stupidly hard to operate a computer and talk at the same time &mdash;
especially when you're not sitting in front of the machine but standing at a
weird angle that makes it almost impossible to operate a mouse or track pad.
During a lightning talk it's vital that you keep your rapport with the audience, rather than diverting your attention to the computer every slide change. Unlike
a 40-minute talk, you don't have time to take breaks between slides.</p>

<p>For this reason I prefer software that you just hit one key or click the
mouse to go to the next slide &mdash; I follow the rule that anything that
requires you to move the mouse is probably a failure.  So if you <em>must</em>
present from a web browser make sure that the links to move between places are
in the same physical location on the page, preferably in the top left corner.
And make sure that you don't have to scroll your slides. Remember kids, HTML
isn't a presentation language so the only way to ensure that it doesn't give
you unexpected surprises &mdash; suddenly scrolling, missing graphics, crazy
fonts &mdash; is to run through the presentation with the web browser you'll use
on the machine you want to use beforehand. All web browsers do <em>not</em>
render the same.</p>

<h3>Unexpected Problems</h3>

<p>Even when you take every precaution, you'll still encounter unexpected
problems. Your demo won't work. You'll discover you're using a slightly older
version of the slides. Your software will use the wrong font. The computer will
burst into flames and burn down the venue. Remember that you don't have time to
recover from any of these problems. Even if it takes you 30 seconds to
locate a new version of the slides and remember where you were, that's a tenth
of your talk gone.  More importantly, the audience has lost interest while
you're doing this and has slipped into their daydream world where you'll have
to work really hard to reacquire their attention.</p>

<p>If something goes wrong, you really have no choice but to move on and skip
over it. As I said, the audience is normally a forgiving bunch so tell them
something has gone wrong and take them into your confidence; explain what the
demo would have shown and press on regardless.</p>

<h3>Concluding your Talk</h3>

<p>In an ideal world you'd be able to complete your lightning talk with time to
spare, take a few questions, and clear up anything you didn't manage to cover.
In reality, that's probably won't happen. So it's important to put something in
your slide to allow people to find out more about what you're talking about and
provide a way of contacting you once you're done speaking.  The biggest mistake
I've made in my talks in the past is putting this information on the last
slide, which of course only appears for 10 seconds and no one has time
to copy down. Now I place a simple URL in the bottom corner of every slide.</p>

<p>This just goes to show that I'm still learning and finding ways of improving
my lightning talks.  Remember that in the end, it doesn't really matter if it
all goes well or not; it's all a learning experience.  Good luck with your
talk.</p>

<h3><a name="see_also" id="see_also">See Also</a></h3>

<p><a href="http://perl.plover.com/yak/presentation/">Conference Presentation Judo</a></p>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-966" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/07/p6pdigest/20040718.html" rel="bookmark">This Week on Perl 6, Week Ending 2004-07-18</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-07-23T00:00:00-08:00">July 23, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Following last week's bizarrely dated summary (I misplaced a day) we're back with the correct week-ending date,
but I'm ashamed to admit that I've slipped to writing on a Tuesday again.
My head hangs in shame and I am filled with the direst remorse.</p>

<p>It will probably happen again though; life's like that.</p>

<h4><a name="Pie-thon!">Pie-thon!</a></h4>

<p>Anyone would think that the possibility of not even being able to run the Piethon benchmark (let alone getting a pie in the face for running it too slowly) weighs heavily on Dan.</p>

<p>The bulk of the week's traffic related to getting to the point where we can at least run all the tests.</p>

<p>Python::Bytecode,
the module that parses,
well,
python bytecode,
shot up in version numbers; I think it reached 2.7 by the end of the week.</p>

<p>Dan released a Piethon translator,
a tool that uses Python::Bytecode to translate Python to Parrot.
So has Leo.
Dan's is on his web site (see the link below);
you'll find Leo's in <em lang='und' xml:lang='und'>languages/python/pie-thon.pl</em>.</p>

<p><a href='http://groups.google.com/groups?threadm=40F26AD7.40000@toetsch.at'>http://groups.google.com/groups?threadm=40F26AD7.40000@toetsch.at</a> -- Parrot runs a Python lambda</p>

<p><a href='http://groups.google.com/groups?threadm=a06110407bd1c65dd4c0e@[10.0.1.3]'>http://groups.google.com/groups?threadm=a06110407bd1c65dd4c0e@[10.0.1.3]</a> -- Notes on pie-thon.pl</p>

<p><a href='http://groups.google.com/groups?threadm=a06110400bd1cf1d2b965@[10.0.1.3]'>http://groups.google.com/groups?threadm=a06110400bd1cf1d2b965@[10.0.1.3]</a> -- Namespaces for built-ins</p>

<p><a href='http://www.sidhe.org/~dan/piethon/translator.pl'>http://www.sidhe.org/~dan/piethon/translator.pl</a> -- Dan's translator</p>

<h4><a name="Semi-stack_code">Semi-Stack Code</a></h4>

<p>In a quest for speed when emulating python's stack manipulation ops,
Dan outlined a plan for manipulating a pseudo-stack using some of Parrot's PMC register (18-29,
with P31 used for overflow).
Leo wasn't convinced it was needed.</p>

<p><a href='http://groups.google.com/groups?threadm=a06110402bd1ae870b2ad@[10.0.1.3]'>http://groups.google.com/groups?threadm=a06110402bd1ae870b2ad@[10.0.1.3]</a></p>

<h4><a name="string_to_num_precision"><code lang='und' xml:lang='und'>string_to_num</code> Precision</a></h4>

<csperl file="grab" domain="on" record="b/1424" template="b/article_sidebar.view">

<p>Leo's got some problems with the precision of the <code lang='und' xml:lang='und'>string_to_num</code> function found in <em lang='und' xml:lang='und'>string.c</em>.
He doctored things to use <code lang='und' xml:lang='und'>atof</code>,
but Dan's not so keen on that idea because <code lang='und' xml:lang='und'>atof</code> doesn't have standard behavior across platforms.
He recommended grabbing Perl 5's string_to_num code (which he thought we'd already done).
Nicholas Clark wasn't convinced that this was a good idea; he reckoned that Perl 5's code wasn't good enough.
I think Nicholas convinced Dan that <code lang='und' xml:lang='und'>atof</code> is actually the right thing to use (with a little preprocessing to deal with C99's <code lang='und' xml:lang='und'>atof</code> being incompatible with C89's -- Parrot expects C89 behavior).</p>

<p><a href='http://groups.google.com/groups?threadm=40F28C82.3010904@toetsch.at'>http://groups.google.com/groups?threadm=40F28C82.3010904@toetsch.at</a></p>

<h4><a name="GMP_Licensing">GMP Licensing</a></h4>

<p>Armin Obersteiner reported his investigations into the licensing requirements of the GMP maths library.
It appears that the FSF's 'GPL Compliance Engineer' reckons we won't need to include the GMP's source code with binary distributions.
We just have to make it available from the same source as the distribution.
Which is handy.</p>

<p><a href='http://groups.google.com/groups?threadm=20040713210952.GC2452@elch.elche'>http://groups.google.com/groups?threadm=20040713210952.GC2452@elch.elche</a></p>

<h4><a name="Parrot_configuration_--_a_small_perl_task">Parrot Configuration -- A Small Perl Task</a></h4>

<p>Leo asked for volunteers to fix up Configure.pl in order to make it less dependent on the host Perl's configuration.
Brent Royal-Gordon provided a teeny-tiny patch that's actually shorter than Leo's description of the problem.</p>

<p><a href='http://groups.google.com/groups?threadm=40F76AE3.4000506@toetsch.at'>http://groups.google.com/groups?threadm=40F76AE3.4000506@toetsch.at</a></p>

<h3><a name="Meanwhile,_in_perl6-language">Meanwhile,
in perl6-language</a></h3>

<h4><a name="Scalar_subscripting">Scalar Subscripting</a></h4>

<p>Remember Guatam Gopalakrishnan's question about subscripting scalars?
Discussion continued.
One Piers Cawley (who he?) suggested that it should be possible to specify a <code lang='und' xml:lang='und'>postcircumfix:[] is rw</code> method in the String class to make string subscripting behave in a helpful fashion.
He also suggested pulling this (and other similar behaviors) out into a Sequence trait.
Juerd thought the proposed method name was a little verbose compared to Ruby's syntax for doing the same thing and showed off some rather pretty Ruby metaphors.</p>

<p>Another sub-thread discussed interpolation in strings.
Larry's changed his mind so that <code lang='und' xml:lang='und'>&quot;$file.ext&quot;</code> is now interpreted as <code lang='und' xml:lang='und'>&quot;$object.method&quot;</code>.
You need to do <code lang='und' xml:lang='und'>&quot;${file}.ext&quot;</code> or <code lang='und' xml:lang='und'>&quot;$( $file ).ext&quot;</code>.
Or maybe <code lang='und' xml:lang='und'>&quot;$&#171;file&#187;.ext&quot;</code> by analogy with <code lang='und' xml:lang='und'>%foo&#171;bar&#187;</code>.
James Mastros pointed out that <code lang='und' xml:lang='und'>.</code> is rather ambiguous in a literal string; sometimes a full stop is just a full stop.</p>

<p><a href='http://groups.google.com/groups?threadm=a3ada2d104070804124184a442@mail.gmail.com'>http://groups.google.com/groups?threadm=a3ada2d104070804124184a442@mail.gmail.com</a></p>

<h4><a name="Pushing_lazy_lists">Pushing Lazy Lists</a></h4>

<p>This thread continues to resemble the lists it is nominally discussing: Infinitely long and possibly endless.</p>

<p><a href='http://groups.google.com/groups?threadm=200407121213.12812.philipp.marek@bmlv.gv.at'>http://groups.google.com/groups?threadm=200407121213.12812.philipp.marek@bmlv.gv.at</a></p>

<h4><a name="Perl_6_and_Parrot_Essentials,_2nd_Edition">Perl 6 and Parrot Essentials,
2nd Edition</a></h4>

<p>Leo pointed us at an O'Reilly press release announcing that the second edition of <i>Perl 6 and Parrot Essentials</i> is available.
Huzzah!
Let joy be unconfined.</p>

<p><a href='http://groups.google.com/groups?threadm=40F26C12.6030704@toetsch.at'>http://groups.google.com/groups?threadm=40F26C12.6030704@toetsch.at</a></p>

<h4><a name="Rules_to_match_abbreviations">Rules to Match Abbreviations</a></h4>

<p>Hans Ginzel wondered wondered about adding something to the rules system to easily match specified abbreviations of a string.
Luke Palmer came up with a (pretty ugly) solution that he then wrapped very neatly in a rule.</p>

<p><a href='http://groups.google.com/groups?threadm=20040713071222.GC338@matfyz.cz'>http://groups.google.com/groups?threadm=20040713071222.GC338@matfyz.cz</a></p>

<h4><a name="Enhancing_open">Enhancing <code lang='und' xml:lang='und'>open</code></a></h4>

<p>There's a good deal of mileage to be had talking about how to improve the <code lang='und' xml:lang='und'>open</code> function it seems.</p>

<p>Larry continues to come up with new and interesting ways of designing the language in such a way that almost every decision about how to do something can be deferred.
Speaking as someone who wishes he could just write <code lang='und' xml:lang='und'>Application.new.run</code> and then debug his way to working code,
I'm all for this kind of late binding.</p>

<p>It's also amazing how much use Larry's getting out of his colon.
(The character,
obviously).</p>

<p><a href='http://groups.google.com/groups?threadm=20040713132455.GC27097@babylonia.flatirons.org'>http://groups.google.com/groups?threadm=20040713132455.GC27097@babylonia.flatirons.org</a></p>

<h4><a name="Cartesian_products_and_iterations">Cartesian Products and Iterations</a></h4>

<p>Michele Dondi wondered whether Perl 6 will support Cartesian products between lists.
Short answer: Yes.
It's probably called <code lang='und' xml:lang='und'>outer</code>.</p>

<p><a href='http://groups.google.com/groups?threadm=Pine.LNX.4.58.0407131513280.30821@q.pcteor1.mi.infn.it'>http://groups.google.com/groups?threadm=Pine.LNX.4.58.0407131513280.30821@q.pcteor1.mi.infn.it</a></p>

<h4><a name="Do_we_really_need_filehandles?">Do We Really Need Filehandles?</a></h4>

<p>Dave Whipp thought the unthinkable (but in a good way) and wondered if we actually <i>need</i> user-visible filehandles, given the tools we have for slicing and dicing strings,
manipulating lazy data structures,
etc.
He proposed being able to write:</p>

<pre><code>    my $text is TextFile(&quot;/tmp/foo.txt&quot;);
    for $text.lines -&gt; {
        ...
    }</code></pre>

<p>Which is rather neat, isn't it? Personally I'm not sure we can get rid of filehandles, but I do like the idea of a library that implements something like this. Alex Shitov pointed out that there would still be a need for methods like <code lang='und' xml:lang='und'>$text.flush()</code> or <code lang='und' xml:lang='und'>$text.close()</code>.</p>

<p><a href='http://groups.google.com/groups?threadm=20040718172834.89363.qmail@onion.perl.org'>http://groups.google.com/groups?threadm=20040718172834.89363.qmail@onion.perl.org</a></p>

<h3><a name="Announcements,_Apologies,_Acknowledgements">Announcements, Apologies, Acknowledgements</a></h3>

<p>OK, so the interview was on Tuesday the 13th of July. It went well; I'm going to be a maths teacher.</p>

<p>If you find these summaries useful or enjoyable, please consider contributing to the Perl Foundation to help support the development of Perl. You might also like to send me feedback at <a href='mailto:pdcawley@bofh.org.uk'>mailto:pdcawley@bofh.org.uk</a></p>

<p><a href='http://donate.perl-foundation.org/'>http://donate.perl-foundation.org/</a> -- The Perl Foundation</p>

<p><a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> -- Perl 6 Development site</p>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-958" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/07/22/poe.html" rel="bookmark">Building Applications with POE</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Matt Cashner</span> on <abbr class="published" title="2004-07-23T00:00:00-08:00">July 23, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Earlier,
we talked about the <a href=http://www.perl.com/pub/a/2004/07/02/poeintro.html>fundamental principles</a> of application design with POE.
Now it's time to put my money where my mouth is and build some actual working code.</p>

<p>To make life a bit easier,
let's lay out a very simple problem.
Let's say we would like accept and parse data that resembles CGI query strings.
This data will be key value pairs in which the key and value are separated by <code lang='und' xml:lang='und'>=</code>'s and the pairs themselves are delimited by <code lang='und' xml:lang='und'>&#38;</code>.
An example string we'll use throughout this article is as follows:</p>

<pre><code>  foo=bar&#38;baz=1&#38;bat=2</code></pre>

<p>By the time we're done, we will have a working Filter and Component to handle this incoming data.</p>

<h3>Step 1: A Filter</h3>

<p>The first step is building a simple filter to parse this incoming data. As we discussed earlier, filters are much easier to deal with because they are unaware of their environment and the POE context in which they are run. Our filter is made even easier since we are just parsing incoming data and not generating an outgoing datastream.</p>

<p>First off, we need the basics of any good module.</p>

<pre><code>  package POE::Filter::SimpleQueryString;

  use warnings;
  use strict;

  use Carp qw(carp croak);</code></pre>

<p>Next we need a constructor.</p>

<pre><code>  sub new { 
    my $class = shift;
    my $self = bless {}, $class;
    return $self;
  }</code></pre>

<csperl file="grab" domain="on" record="b/936" template="b/article_sidebar.view">

<p>This is about the simplest constructor possible. This very simple filter requires no parameters to operate. It is perfectly reasonable, however, to demand parameters of filter users. For instance, if the filter could <code>rot13</code> the incoming data before parsing, and a parameter could turn that feature on.</p>

<h4>get()</h4>

<p>Now we need the ability to parse data. We will be using the newer and much simpler <code lang='und' xml:lang='und'>get</code>/<code lang='und' xml:lang='und'>put</code> version of the Filter API. This version of the standard POE Filter API requires <code lang='und' xml:lang='und'>get()</code> and <code lang='und' xml:lang='und'>put()</code> methods with the ability to transform multiple record sets per invocation.</p>

<p><code lang='und' xml:lang='und'>get()</code>'s job is transform raw data into cooked record sets. The example string above (<code lang='und' xml:lang='und'>foo=bar&#38;baz=1&#38;bat=2</code>) will become a hash:</p>

<pre><code>  $VAR1 = {
    'foo' =&gt; 'bar',
    'baz  =&gt; '1',
    'bat  =&gt; '2',
  };</code></pre>

<p>A POE Filter is just a normal Perl object with a defined interface.</p>

<pre><code>  sub get {
    my $self = shift;
    my $buffer = shift;</code></pre>

<p>The buffer can and probably will contain multiple records. The size of the buffer is determined by the POE Driver being used and the operating system in question. <code lang='und' xml:lang='und'>$buffer</code> will always be an array reference. While it is generally sensible to test <code lang='und' xml:lang='und'>$buffer</code> to make sure it conforms to the standard interface, for the purpose of this exercise, we will just trust POE.</p>

<p>In our super-easy format, an individual record is terminated by a <code lang='und' xml:lang='und'>\n</code>. Key value pairs are delimited by <code lang='und' xml:lang='und'>&#38;</code> and key and value themselves are separated by an <code lang='und' xml:lang='und'>=</code>. Note that we aren't dealing with issues like character escaping or data taint. Production quality code will need to deal with these issues.</p>

<pre><code>    my @chunks; </code></pre>

<p>Each parsed line makes up a chunk of data. We want to represent each record as a distinct entity to the user.</p>

<pre><code>    foreach my $record (@$buffer) { 
      $record =~ s/\x0d\x0a$//;
      my @pairs = split(/&#38;/, $record);
    
      my %chunk;
      foreach my $pair (@pairs) {
        my ($key, $value) = split(/=/, $pair, 2);</code></pre>

<p>So what happens if there is more than one instance of a given key in a record? Simple. We make an array reference. The user will need to inspect the value of each key to determine if they have more than one value:</p>

<pre><code>        if(defined $chunk{$key}) {
          if(ref $chunk{$key} eq 'ARRAY') {
            push @{ $chunk{$key} }, $value;
          } else {
            $chunk{$key} = [ $chunk{$key}, $value ],
          }
        } else {
          $chunk{$key} = $value;
        }
      }
      push @chunks, \%chunk;
    }
    return \@chunks;
  }</code></pre>

<h4>put()</h4>

<p>We now have a simple query-string-like data parser. This is fine for read-only servers but it makes sense to allow our users to send data back and forth in the same format. To allow for that, we need a <code lang='und' xml:lang='und'>put()</code> method. <code lang='und' xml:lang='und'>put()</code>'s job is take the cooked form of our records and translate it to the raw form. In this case we will be taking a hash reference that looks like:</p>

<pre><code>  $VAR1 = {
    'foo' =&gt; 'bar',
    'baz' =&gt; '1',
    'bat' =&gt; '2',
  };</code></pre>

<p>And transforming it into:</p>

<pre><code>  foo=bar&#38;baz=1&#38;bat=2</code></pre>

<p>So that whatever Wheel our user has chosen can put the data onto the wire. Like <code lang='und' xml:lang='und'>get()</code>, <code lang='und' xml:lang='und'>put()</code> is a normal method call on a normal perl object.</p>

<pre><code>  sub put { 
    my $self = shift;
    my $records = shift;</code></pre>

<p>Like <code lang='und' xml:lang='und'>get()</code>, the data to act on is passed in as a parameter to the method call. It is always an array reference of records to translate.</p>

<p>Basically, our <code lang='und' xml:lang='und'>put()</code> method performs an exact reversal of the <code lang='und' xml:lang='und'>get()</code> algorithm. Take each key/value pair and concatenate them with an <code lang='und' xml:lang='und'>=</code>. Each pair is then joined with a <code lang='und' xml:lang='und'>&#38;</code>.</p>

<p>The only real error condition we are checking for is the presence of non-array data. Since we haven't defined behavior for this condition, we warn the user about the data and skip it:</p>

<pre><code>    my @raw;
    foreach my $record (@$records) {
      my @chunks;
      foreach my $key (sort keys %$record) {
        if(ref $record-&gt;{$key}) {
          if(ref $record-&gt;{$key} eq 'ARRAY') {
            foreach my $value ( @{ $record-&gt;{$key} } ) {
              push @chunks, $key.&quot;=&quot;.$value;
            }
          } else {
            carp __PACKAGE__.&quot; cannot handle data of type 
            &quot;.ref $record-&gt;{$key};
          }
        } else {
          push @chunks, $key.&quot;=&quot;.$record-&gt;{$key};
        }
      }
      push @raw, join('&#38;',@chunks).&quot;\x0d\x0a&quot;;
    }
    return \@raw;
  }</code></pre>

<p>The raw data is returned to the caller as an array reference of data chunks. The caller has the responsibility of putting the data on the wire in the appropriate fashion.</p>













<h3>Step 2: A Wheel</h3>

<p>Chances are that our users want to send data in one of the standard UNIX methods -- sockets, pipes, and so on. Lucky for us, POE already has Wheels to deal with just about any methodology of data transfer you can imagine. Let's work with a method that should work just about anywhere, TCP sockets. <code lang='und' xml:lang='und'>POE::Wheel::SocketFactory</code> provides the functionality we need. First, we need a session to plug the wheel into. (Remember that wheels <b>mutate</b> sessions to provide new functionality.)</p>

<pre><code>  POE::Session-&gt;create(
    inline_states =&gt; {
      _start      =&gt; \&#38;start,
      factory_success =&gt; \&#38;factory_success,
      
      client_input  =&gt; \&#38;client_input,
      client_error  =&gt; \&#38;client_error,

      fatal_error   =&gt; sub { die &quot;A fatal error occurred&quot; },
      _stop       =&gt; sub {},
    },
  );

  POE::Kernel-&gt;run();</code></pre>

<p>This session will be our controller for the wheels we need to perform socket operations. Each wheel-based event provides a unique identifier so it is possible to handle more than one client per session.</p>

<p>When the session starts up, we spin up the SocketFactory wheel. With the Reuse flag on, SocketFactory will continuously listen on the specified port and address, handing us events for each client. The unique id passed to the SuccessEvent identifies each client.</p>

<pre><code>  sub start {
    $_[HEAP]-&gt;{factory} = POE::Wheel::SocketFactory-&gt;new(
      BindAddress   =&gt; '127.0.0.1',
      BindPort    =&gt; '31337',
      SuccessEvent  =&gt; 'factory_success',
      FailureEvent  =&gt; 'fatal_error',
      SocketProtocol  =&gt; 'tcp',
      Reuse       =&gt; 'on',
    );
  }</code></pre>

<p>When a client makes a connection, the SocketFactory lets us know. It is our job to figure out what to do with the filehandle SocketFactory built for us. In this case, we want read/write functionality using the filter we built above. <code lang='und' xml:lang='und'>POE::Wheel::ReadWrite</code> provides this functionality, including the ability to plug in our filter.</p>

<pre><code>  sub factory_success {
    my( $handle, $wheel_id ) = @_[ARG0, ARG1];
    $_[HEAP]-&gt;{clients}-&gt;{ $wheel_id }  =
      POE::Wheel::ReadWrite-&gt;new(
        Handle    =&gt; $handle,
        Driver    =&gt; POE::Driver::SysRW-&gt;new(),
        Filter    =&gt; POE::Filter::SimpleQueryString-&gt;new(),
        InputEvent  =&gt; 'client_input',
      );
  }</code></pre>

<p>Now the data path is set up. We have the ability for programs to connect to a port and provide data in our simple format. What to do with the data though? Let's simply print it out and echo it back to the client.</p>

<pre><code>  sub client_input {
    my ($input, $wheel_id) = @_[ARG0, ARG1];

    use Data::Dumper;
    print Dumper $input;

    $_[HEAP]-&gt;{clients}-&gt;{ $wheel_id }-&gt;put( $input );
  }</code></pre>

<p><code lang='und' xml:lang='und'>Data::Dumper</code> handles printing out the structure for us. The <code lang='und' xml:lang='und'>put()</code> call puts the structure back out onto the wire. If our algorithms are correct, we should get the same data back that we put in.</p>

<pre><code>  sungo@cthulu% telnet localhost 31337
  Trying 127.0.0.1...
  Connected to localhost.
  Escape character is '^]'.
  foo=bar</code></pre>

<p>The server prints out:</p>

<pre><code>  sungo@cthulu% perl -Ilib examples/server.pl
  $VAR1 = { 
    'foo' =&gt; 'bar'
  };</code></pre>

<p>And then echoes back to us:</p>

<pre><code>  foo=bar</code></pre>

<p>We're in business.</p>

<h3>Step 3: A Component</h3>

<p>Man, that was a lot of code to get a simple TCP server up and running. Surely this can be simplified. Again, POE itself comes to the rescue. POE ships with a component specifically designed to simplify TCP server creation. We can replace all that code above with a simple call to the component's constructor.</p>

<pre><code>  POE::Component::Server::TCP-&gt;new(
    Address =&gt; '127.0.0.1',
    Port  =&gt; '31337',

    ClientFilter =&gt; &quot;POE::Filter::SimpleQueryString&quot;,
    ClientInput =&gt; sub {
      my $input = $_[ARG0];
      use Data::Dumper;
      print Dumper $input;

      $_[HEAP]-&gt;{client}-&gt;put($input);
    }</code></pre>

<p>And we're done. The downside is that <code lang='und' xml:lang='und'>Server::TCP</code> doesn't allow for argument passing to the filter's constructor and we lose the flexibility of doing things by hand. For a lot of problems, however, this component does the trick quite nicely.</p>

<p>We can make this even easier for our users by making our own component. For the purpose of this example, we're going to wrap the smaller code above instead of the larger wheel based example. There is no reason why you couldn't use the wheel-based code in your component, however.</p>

<pre><code>  package POE::Component::SimpleQueryString;

  use warnings;
  use strict;

  use POE;
  use POE::Component::Server::TCP;

  use POE::Filter::SimpleQueryString;

  use Carp qw(croak carp);

  sub new {
    my $class = shift;
    my %args = @_;

    my $addr = delete $args{ListenAddr} || croak &quot;ListenAddr required&quot;;
    my $port = delete $args{ListenPort} || croak &quot;ListenPort required&quot;;
    my $input_event = delete $args{InputEvent} || 
      croak &quot;InputEvent required&quot;;

    my $server = POE::Component::Server::TCP-&gt;new(
            Address =&gt; $addr,
            Port =&gt; $port,

            ClientInput =&gt; $input_event,
            ClientFilter =&gt; &quot;POE::Filter::SimpleQueryString&quot;,
           );
    
    return $server;
  }

  1;</code></pre>

<p>Now our users can just load up the component like so:</p>

<pre><code>  POE::Component::SimpleQueryString-&gt;new(
    ListenAddr =&gt; '127.0.0.1',
    ListenPort =&gt; '31337',
    InputEvent =&gt; sub {
      my $input = $_[ARG0];
      use Data::Dumper;
      print Dumper $input;

      $_[HEAP]-&gt;{client}-&gt;put($input);       
    },
  );</code></pre>

<h3>Conclusion</h3>

<p>We have seen how to build POE filters and components and combine them with wheels and custom code to create flexible and maintainable programs. The code examples provided above may be <a href="/2004/07/22/examples/poe_examples.tar.gz">downloaded</a> under the BSD License.</p>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-956" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/07/14/accessibility.html" rel="bookmark">Accessible Software</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Jouke Visser</span> on <abbr class="published" title="2004-07-15T00:00:00-08:00">July 15, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p> Last year Perl.com published an <a href="/pub/a/2003/08/28/pvoice.html">article about pVoice</a>. You learned what pVoice is, why it was built, and where it was supposed to go. Maybe you wanted to do something for disabled people yourself, by writing something like a mail client, a simple game like memory, or an instant-messaging client, but you didn't implement it because you felt it was too much work. In that case there's news for you.</p>

<p>Part of pVoice was a set of modules that was actually the engine for the user interface. A few months ago I pulled those modules from the pVoice project and made them into a CPAN distribution. This distribution is called AAC::Pvoice. And no, they have nothing to do with Apple's digital audio format. They're all about Augmentative and Alternative Communication. Although, I like to think that the "C" stands for "Computing," which makes it into a better description of what those modules are for.</p>

<p>You can use the AAC::Pvoice modules to create GUI applications for people who have difficulty using conventional input devices like a mouse or a keyboard. Instead, those people can use your applications using only one or two keystrokes, mouse buttons, or switches on a wheelchair. You can also enhance the use of a conventional mouse or touch screen by highlighting objects on the screen as the mouse cursor hovers over them. AAC::Pvoice does not only handle the input for you, but it also provides an accessible graphical user interface.</p>

<p>Think of the possibilities: there are so many modules on CPAN that in conjunction with AAC::Pvoice can result in simple, accessible applications. For example, a module like Games::Battleship allows you to create a battleship game, AAC::Pvoice allows you to create the GUI and takes care of the input for you, so with very little effort you can create a game accessible for people who can't play regular games that need full control over a mouse and/or keyboard.</p>

<p>This article will explain how to use the AAC::Pvoice modules step by step. It's up to you what kind of functionality will go into the application you build.
</p>
<p>
The API of the AAC::Pvoice modules is still subject to changes, but you can trust me when I tell you that the behavior of existing methods won't change too much, because I don't like to go over my own code over and over again to adjust it to a new version of an API.
</p>

<h3>The Concept</h3>

<p>The graphical user interface of AAC::Pvoice is based upon wxPerl classes, so it won't hurt if you already know a bit about wxPerl. But since the modules handle most of the GUI for you, as you can see below, it's much simpler to write AAC::Pvoice applications than using plain wxPerl.</p>

<p>Basically an AAC::Pvoice-based application consists of three entities: a Panel, a Row and a Button. A panel is a subclass of a Wx::Panel, on which one or more rows, or in fact any other Wx::Window subclass, can be placed. A row is also a subclass of a Wx::Panel, but a row can contain multiple Wx::BitmapButton objects. Those Wx::BitmapButtons however are created from a data structure you feed to the row's constructor. These buttons don't respond to mouse clicks on them like you're used to, but will be invoked when the user generates a 'Select' event, unless of course you use a normal mouse to control the GUI. The 'Select' event will be discussed later.</p>

<csperl file="grab" domain="on" record="b/936" template="b/article_sidebar.view">

<p>There is a special class called AAC::Pvoice::Input. You normally won't call any of this class' methods directly. Instead, it's called from the AAC::Pvoice::Panel. The Input class checks for 'normal' mouse, mouse buttons, keyboard or parallel port input (depending on the selected device) and calls whatever the Panel defined it to do when a 'Next' or 'Select' event occurs. If only one switch is used, that switch will only generate a 'Select' event, and a 'Next' event will automatically happen every n milliseconds, depending on your settings.
To understand what those events are, you need to understand how the so called 'row/column scanning' mechanism works. Since we've got multiple rows of buttons, and we have only two switches to indicate what we want to do, we can't move the mouse cursor over the screen. Instead, we'll use one switch to indicate 'go to next row' and one to indicate 'select this row'. When we've selected a row, again we need the same two switches to indicate 'go to next button in this row' and 'select this button'.</p>

<p>As you will see in the demo application below, you don't have to worry about row/column scanning when you're creating your application. The AAC::Pvoice::Panel takes care of that. You only have to define what your script will do when a certain button is invoked.</p>

<h3>Creating a Demo</h3>

<p>To demonstrate how you can use AAC::Pvoice to create your own pVoice-like applications, I'll show you how to build a simple demo application. This application will use the Microsoft Agent (using the Win32::MSAgent module) to move the Merlin character over the screen and let it pronounce a phrase. It's a very simple, silly example, but then again, it's only to demonstrate how the AAC::Pvoice modules work. You'll see how easy it is.</p>

<p>First of all, because an AAC::Pvoice based application is actually a wxPerl-based application, we have to start with a standard wxPerl framework, where we define the application and the frame, and start a main loop. This can be something like this:</p>

<pre><code>
use strict;
use warnings;

# Create a wxApp object and start the mainloop
my $obj = pMerlin-&gt;new();
$obj-&gt;MainLoop;

#----------------------------------------------------------------------
# the pMerlin package implements the Wx::App subclass
package pMerlin;
use Wx;
use base 'Wx::App';

sub OnInit
{
    my $self = shift;
    # Set an AppName and VendorName
    $self-&gt;SetAppName('Fun With Merlin');
    $self-&gt;SetVendorName(&quot;pVoice Applications - Jouke Visser&quot;);
    
    # Create a frame and show it
    my $frame = pMerlinFrame-&gt;new( undef, -1, 'pMerlin');
    $frame-&gt;Show(1);
}

#----------------------------------------------------------------------
# the pMerlinFrame package implements the Wx::Frame subclass
package pMerlinFrame;
use Wx qw(:everything);
use AAC::Pvoice;
use base 'Wx::Frame';

sub new
{
    my $class = shift;
    # Call the superclass' constructor
    my $self = $class-&gt;SUPER::new(@_);
    
    # Set the white background colour
    $self-&gt;SetBackgroundColour(wxWHITE);
    
    return $self;
}
</code></pre>

<p>So far, nothing special. I only used a few calls that aren't really necessary for a default wxPerl script: I'm setting the AppName, VendorName, and I'm telling the frame to have a white background. The reason for setting the AppName and VendorName will be explained later.</p>













<h3>Using AAC::Pvoice</h3>

<p>Like I said, so far everything looks normal, if you're used to wxPerl programming. But in fact this is where the actual work begins. We now need to add some code to the new() subroutine of pMerlinFrame. The first thing we need to do now is to maximize the pMerlinFrame we just defined and get the dimensions of that maximized state. We need to do this to pass the correct width and height of the frame to the AAC::Pvoice::Panel we want to create. We can define a margin around the AAC::Pvoice::Panel, which looks nicer, but it's not necessary. In this example I'm using a margin of 50 pixels on each side of the panel.</p>

<pre><code>
# Get the dimensions of the maximized window
$self->Show(1);
$self->Maximize(1);
my ($width, $height) = ($self->GetClientSize->GetWidth,
                        $self->GetClientSize->GetHeight);
$self->Show(0);

# define the margin
my $margin = 50;

# define the itemspacing
my $itemspacing = 4;

# And create a pVoice panel
$self->{panel} = AAC::Pvoice::Panel->new(
                         $self,              # parent
                         -1,                 # id
                         [$margin, $margin], # position
                         [$width-2*$margin, $height-2*$margin],
                                             # size
                         wxNO_3D,            # style
                         1,                  # hide textrow
                         $itemspacing,       # spacing between items
                         3);                 # selectionborderwidth
# The grey background for the panel
my $panelbackground = Wx::Colour->new(220,220,220);
$self->{panel}->BackgroundColour($panelbackground);

# A title at the top of the panel
$self->{panel}->AddTitle(&quot;Fun with Merlin&quot;);
</code></pre>

<p>As you can see I've also defined a background colour for the panel and a title on top of it. Let's take a closer look at the parameters of the AAC::Pvoice::Panel constructor. The first parameters look exactly like those used for Wx::Panel. The AAC::Pvoice::Panel, however, needs three new parameters. The first indicates if we should hide the (default) text row (a Wx::TextCtrl) at the bottom of the panel. For an application like pVoice, where you create phrases, this text row is of course needed. For our demo we don't need a text row. Furthermore, we need to define the spacing between items on the panel. Effectively this is the spacing between the rows, since those will be placed directly upon this panel. Finally we need to define the width of the border around a selected row or item. It's a good idea to make this value lower than the item spacing, otherwise the border will not be fully visible.</p>

<p>The next step is to create the bitmaps we want to display. For this purpose we can use AAC::Pvoice::Bitmap. This class provides an easy way to create a bitmap of a certain size, put a caption underneath it, and has some other useful features. Before we create the bitmaps, we calculate the maximum X and Y size they can use by dividing the useable X and Y size of the panel by the number of buttons per row and the number of rows respectively. I'll also subtract twice the item spacing used in the application because otherwise the buttons will be a little bit too large.</p>

<pre><code>
# The maximum dimensions of a button
my $maxX = int(($self->{panel}->xsize)/4)-2*$itemspacing;
my $maxY = int(($self->{panel}->ysize)/3)-2*$itemspacing; 

# Define the bitmaps. 
# The parameters are the filename, maxX and maxY size and the caption
my $leftbutton     = AAC::Pvoice::Bitmap->new('img/left.png',
                                              $maxX, $maxY, 'left');
my $rightbutton    = AAC::Pvoice::Bitmap->new('img/right.png',
                                              $maxX, $maxY, 'right');
my $upbutton       = AAC::Pvoice::Bitmap->new('img/up.png',
                                              $maxX, $maxY, 'up');
my $downbutton     = AAC::Pvoice::Bitmap->new('img/down.png',
                                              $maxX, $maxY, 'down');
my $questionbutton = AAC::Pvoice::Bitmap->new('img/question.png',
                                              $maxX, $maxY, 'question');
my $rowselbutton   = AAC::Pvoice::Bitmap->new('img/rowsel.png',
                                              $maxX, $maxY, 'rowsel');
</code></pre>

<p>Now that we've got those bitmaps, we can create the AAC::Pvoice::Rows that will use those bitmaps, and know what coderefs to invoke when the user selects one of the buttons. We don't need to create individual Wx::BitmapButtons. The AAC::Pvoice::Row takes care of that, and attaches the correct actions to the BitmapButtons in such a way that they can be invoked using any of the available input methods.
</p>
<p>Before define the rows, we create a listref for every button, containing the button ID, the bitmap and the callback. These listrefs we put in another list of lists. That LoL defines the whole panel, and every list inside it defines the layout of each every row. Let's see how we achieve this:</p>

<pre><code>
# Define the buttons on the pVoice rows
#               the id,      the bitmap,     the callback
my $left     = [Wx::NewId(), $leftbutton,    sub {$self->MoveLeft}];
my $right    = [Wx::NewId(), $rightbutton,   sub {$self->MoveRight}];
my $up       = [Wx::NewId(), $upbutton,      sub {$self->MoveUp}];
my $down     = [Wx::NewId(), $downbutton,    sub {$self->MoveDown}];
my $question = [Wx::NewId(), $questionbutton,sub {$self->Speak}];
my $rowsel   = [Wx::NewId(), $rowselbutton,
                sub {$self->{panel}->ToRowSelection}];

# The definition of the screenlayout
my $content = [ [ $rowsel,    undef,    $up,       undef  ],
                [ $rowsel,    $left,    $question, $right ],
                [ $rowsel,    undef,    $down,     undef  ] ];
</code></pre>

<p>You can see that the callbacks actually invoke some methods of pMerlinFrame that I haven't discussed yet. That's because they have nothing to do with the AAC::Pvoice modules themselves. I'm trying to keep this demo as simple as possible. At the bottom of this article you'll find a link to a zip file that contains the complete source and images used in this demo. 
</p>
<p>The final step in creating the panel is creating the rows based upon our data structure, and then add those rows to the panel. After that there is a magic method called 'Finalize' we need to call on the panel, and the panel is done. First the code, then an explanation:</p>

<pre><code>
# Add the buttons to the rows and the rows to the panel
foreach my $row (@$content)
{
  $self->{panel}->Append(AAC::Pvoice::Row->new(
                                 $self->{panel},     # parent
                                 scalar(@$row),      # max
                                 $row,               # items
                                 wxDefaultPosition,  # pos
                                 wxDefaultSize,      # size
                                 $maxX,              # X-size
                                 $maxY,              # Y-size
                                 $itemspacing,       # spacing
                                 $panelbackground)); # background
}
# Finish the panel
$self->{panel}->Finalize();
</code></pre>

<p>The constructor of a row has a few unusual parameters. The first parameter is the parent, like almost every wxPerl class needs to know the parent window. The second parameter however, is the maximum number of items in a row. The row will add empty Wx::BitmapButtons to the end of a row if the third parameter (the items we want to put on the row) contains less items than the defined maximum. This ensures an even sized row. In our case we have rows with 4 items each, including some undefined items, so passing scalar($@row) is enough here.
</p>
<p>The $row parameter contains the list of items we want to have in our row. We also have to pass the $maxX, $maxY and $itemspacing to this row, since it has to use the correct spacing between the buttons, and the empty buttons it needs to create (for the undef values in the row) need to have the correct size. The final parameter, $panelbackground, is the background color for this row, which we define to be the same as the panel background to let it look like there's no difference between the rows and the panel.</p>

<p><img src="/pub/2004/07/14/graphics/pmerlin.jpg" width="450" height="393" alt="" /></p>

<p>The final thing we have to do is to define how the user can use the application. Are we going to use keystrokes, mouse buttons, the Adremo wheelchair, or normal mouse input? We can define this by setting the registry-key Device to respectively keys, icon, adremo, or mouse. This needs to be set before the AAC::Pvoice::Panel is created. I usually set this in the OnInit method of my Wx::App subclass like this:</p>

<pre><code>
# Set the device we use to 'icon' (left and right mouse buttons)
# other possibilities are 'keys' (keystrokes, where the space 
#                           and enter key are the default keys)
#                         'adremo' (electrical wheelchair) and
#                         'mouse' (normal mouse, touch screen, etc.)
my $config = Wx::ConfigBase::Get;
my $Device = $config->Read('Device', 'icon');
$config->Write('Device',   $Device);
</code></pre>

<p>If we do this after we define the AppName and the VendorName, the key will appear under HKEY_CURRENT_USER\Software\&lt;VendorName&gt;\&lt;AppName&gt;\Device. There are more possible keys to define, like Buttons (either 1 or 2, defining the number of switches). You can find more information on this in the documentation of AAC::Pvoice::Input.</p>

<p>This is all there is to it. We now have a simple demo of an application that almost everyone is able to use. The screenshot you see on this page is the result of these simple pieces of code. As you could see, the API is extremely simple, so you can concentrate on the actual functionality you want to put in your application.</p>

<h3>Platform Issues</h3>

<p>The AAC::Pvoice modules can be installed on Windows as well as on Linux. However, it doesn't look too well on Linux. If someone is interested in making the modules work correctly on Linux: patches are welcome! I would also like to see someone trying to port everything to OS X. wxPerl runs on a lot of different platforms, but in the AAC::Pvoice modules I've used some Win32-specific options that may have some workarounds for other platforms. I just haven't had the opportunity to make it work on those.</p>

<p>Hopefully this short article inspires you to build something for people who can't quite accomplish everything you can. After all, this is what programming should really be about -- making useful applications for people who can't build it themselves.</p>

<p>You can download the <a href="/2004/07/14/examples/pmerlin.zip">zipfile containing the complete script and images here</a>.</p>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-954" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/07/09/xplane.html" rel="bookmark">Autopilots in Perl</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Jeffrey Goff</span> on <abbr class="published" title="2004-07-12T00:00:00-08:00">July 12, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p><a href="http://www.x-plane.com">X-Plane</a> is an ultra-realistic flight 
  simulator used by aviation pioneers like Burt Rutan, who uses it in his <a href="http://www.popsci.com/popsci/aviation/article/0,12543,463052%2D3,00.html">simulator</a> 
  for SpaceShipOne. The latest revision sports a flight model so accurate that the FAA has decided that your time spent in the simulator can count toward 
  a pilot's license.</p>
<p>We'll learn how to monitor and control our virtual plane, and display our 
  virtual aircraft's status in real-time in a <code>Curses</code> window. Our 
  display will be data-driven so that adding a single entry to a hash reference 
  is all you need to display a new data element.</p>
<h3><a name="Software_Requirements">Software Requirements</a></h3>
<h4><a name="Curses_on_OS_X">Curses on OS X</a></h4>
<p>Curses v1.06 seems to have some issues building on the author's 
  machine running OS X 10.3. Replacing <code>Perl_sv_isa</code> with <code>sv_isa</code> 
  on line 275 of <code>Curses.c</code>, along with commenting out <code>#define 
  C_LONGNAME</code> and <code>#define C_TOUCHLINE</code> in <code>c-config.h</code> 
  lets <code>Curses</code> compile with enough functionality to run the monitor 
  program.</p>
<h4><a name="Configuring_the_Sim">Configuring the Sim</a></h4>
<p>Throughout this article, we assume that you're using X-Plane version 
  7.41 or higher (the demo version has all the functionality we need), and you're 
  flying the standard Boeing 777. This has retractable landing gears and brakes, 
  two features we'll eventually control from inside the monitor program, <a href="/2004/07/09/examples/X-Plane.pl"><i>X-Plane.pl</i></a>.</p>
<p>Once you're settled in your airplane's cockpit, choose the Settings 
  menu at the top of the screen and choose Data Input &amp; Output under 
  that menu. A window should open to the default tab, Data Set. This 
  is where we tell the simulator which channels of data to transmit over the network 
  where our monitor can listen for them.</p>
<p>Currently, <i>X-Plane.pl</i> displays gear up/down status, throttle 
  percentage, latitude and longitude, pitch and roll, and the simulation frame 
  rate. To enable these channels for display, click the checkboxes just to the 
  right of rows 12, 23, 18, 16, and 0 (respectively).</p>
<p>If you like, you can also click the checkboxes on the far right of each column 
  to display the channel data on the plane's windshield, as well. This is handy 
  for debugging, especially if you're attempting to monitor new data and don't 
  know what the values look like. Also, the channel numbers seem to change version 
  to version, and if you're using a version other than 7.41, you may need to 
  change the code to correspond to the simulator.</p>
<p>Finally, the simulator has to be told where to send the monitoring packets. 
  Choose the Inet2 tab, and click on the checkbox next to IP address 
  of data receiver. Fill in the left-hand box with the IP address of 
  the machine you're running <i>X-Plane.pl</i> on, and fill in the 
  right-hand box with 49999, the UDP port on which <i>X-Plane.pl</i> listens.</p>
<p>Incidentally, even though the monitor program acts as an instruction console, 
  you don't need to turn on the Instructor Console option listed 
  here. It may be necessary, should you want to deal with more advanced communication 
  such as triggering system failures, but for current purposes all we need to 
  configure is the data receiver.</p>
<p>By default, <i>X-Plane.pl</i> listens to packets sent to 127.0.0.1 
  over port 49999, and sends packets to the same host on port 49000. Passing command-line 
  parameters to <i>X-Plane.pl</i> can override these settings, but the 
  documentation for the simulator seems to indicate that it's hardcoded to 
  listen on port 49000 for its commands, so be warned if you try to change this 
  particular default.</p>
<h3><a name="Running_the_monitor">Running the Monitor</a></h3>
<p>Communicating at the UDP layer is a different, and much simpler, world than 
  dealing with a full TCP/IP packet. The main differences here are that we don't 
  get any acknowledgement that a UDP packet is sent, and can't even guarantee 
  that the packet was sent at all. The practical upshot of this is that we can 
  start and stop <i>X-Plane.pl</i> at any time, without the need for 
  fancy socket tear-down protocols, and we don't need to stop the simulator 
  every time we change <i>X-Plane.pl</i>'s code.</p>
<p>Once we've started the simulator and <i>X-Plane.pl</i> it should 
  start displaying the plane's position (longitude/latitude), orientation 
  (pitch/roll), speed, and current throttle settings. If it doesn't, switch 
  back to the simulator window and make sure the cockpit is being displayed. The 
  gear display mimics an indicator lamp, with <code>[#]</code> representing 
  a lit lamp, and <code>[ ]</code> being a dark lamp.</p>
<p>The simulator will only send out UDP packets when the cockpit is being displayed, 
  and if you're running in demo mode, it decides to interrupt your flight six 
  minutes in with two dialog boxes that effectively stop packet transmission. 
  If it's still displaying the cockpit, make sure that the simulator is transmitting 
  data to the right port on the right machine, and if all else fails, watch the 
  network with a utility such as <code>tcpdump</code> to make sure UDP packets 
  are being sent out. Press the <code>G</code> key to raise and lower 
  the gear and the <code>I</code> and <code>K</code> keys 
  to advance and retard the throttles, even on the runway. Note that the gear 
  indicator lamp on the monitor will change before the gear handle does. Also, 
  if running the simulator on the same machine as the monitor, you may need to 
  bring the window with the simulator to the foreground before changes are registered.</p>
<p>By the way, the Boeing 777 is equipped with thrust reversers, so negative throttle 
  settings actually make sense. Also, the flight profile dictates running the 
  engines up to 110% of rated power on takeoff, so throttle settings beyond 100% 
  are also legitimate.</p>
<h3><a name="Talking_to_X-Plane">Talking to X-Plane</a></h3>
<p>Communicating with the simulator is done entirely via UDP packets. While the 
  simulator can send and receive various types of packets, we'll focus on 
  one type of packet in particular, the <code>DATA</code> packet. The 
  simulator communicates using packets like that described in Figure 1. The first 
  4 bytes of the header are the ASCII characters naming the type of packet, and 
  the actual data is surrounded by a zero byte on both ends.</p>
<p><img src="/pub/2004/07/09/graphics/Figure_1.jpg" width="311" height="104" alt=""/> </p>
<p>In between the zero bytes, we get one 36-byte chunk for every channel the 
  simulator sends out. Each 36-byte chunk is broken down into two sections. 
  The first section is a four-byte index corresponding to the channel number 
  on the "Data Set" screen, and the rest of the chunk contains eight four-byte 
  elements.</p>
<p><img src="/pub/2004/07/09/graphics/Figure_2.jpg" width="401" height="248" alt=""/> </p>
<p>The actual data types of the individual elements has changed from version to 
  version, but 7.41 seems to have settled on one layout for inbound, and a different 
  one for outbound. When transmitting data, the simulator sends all elements as 
  floating-point types, but receives a mixture of floating-point and long 
  integers.</p>
<h4><a name="Sending_data">Sending Data</a></h4>
<p>Handling the mixture of data types is largely the job of the core data structure 
  in <i>X-Plane.pl</i>, the <code>$DATA_packet</code> hash reference. 
  Starting on line 92, this data structure encapsulates everything we want to 
  know about the simulator packet.</p>
<p>Given that there are currently 113 channels of data that the simulator 
  can send out, and that the author is lazy, we're not going to type in all 
  113 channels' worth of data. Instead, we'll store just the channels 
  we want to display in what computer scientists call a "sparse array," 
  but Perl programmers call it a "hash reference."</p>
<p>One useful feature the monitoring program doesn't have is controlling the 
  brakes. In the simulator, brakes can be applied with a variable pressure, but 
  for our purposes they only have two settings: &#34;Screeching halt&#34; and 
  &#34;Let it roll.&#34; The first order of business is to find out what channel 
  brakes are displayed on.</p>
<p>Going back to the "Data Set" tab in the simulator, we look for "brakes" 
  on the list. In version 7.41 they're on channel 12, "gear/brakes." 
  Conveniently enough, we're already displaying the gear setting, so it shouldn't 
  be much work to add brakes to the list.</p>
<p>Now that we know what channel brakes are on, we need to know where in the channel 
  they're stored. After all, we have eight elements to look through. So, click 
  on the checkbox on the far right of row 12 to display that channel's contents 
  on the windshield and close the window.</p>
<p>At the upper right-hand corner we should see the channel contents being 
  displayed. We're mostly curious about the <code>wbrak</code> setting, which 
  is element number 1 (counting from zero, of course.) The simulator also tells 
  us that it's of <code>part</code> type, which means that it's a floating 
  point value.</p>
<p>We'll first need to display the brake setting. We do this at line 112, 
  duplicating the block for the gear status and creating the following entry, 
  which specifies that element 1 of channel 12 is a floating-point number 
  representing brakes:</p>
<pre><code>    1 =&#62; { type =&#62; 'f', label =&#62; 'Brakes',
           label_x =&#62; 0, label_y =&#62; 4,
           x =&#62; 7, y =&#62; 4 },</code></pre>
<p>Restart the monitor program, and you should have a new entry for "Brakes" 
  followed by a 0 or 1. Clicking on the "BRAKES" light in the cockpit 
  should toggle the value. Once you've verified that the new brake display 
  works, it's time to add the code that actually sets/releases the brakes. 
  On line 270, insert the code that transmits the new brake status to the simulator, 
  that looks roughly like this:</p>
<pre><code>  elsif($ch eq 'b') {
    transmit_DATA(
          $socket,
          12,
          -999,
          $DATA_buffer-&#62;{12}{1} ? 0 : 1,
          (-999) x 6);
  }</code></pre>
<p>Since the gear and brakes are on the same channel, we have to tell the simulator 
  to ignore the gear while letting us set the brake value, so we use the placeholder 
  value of -999. The old brake value is saved in <code>$DATA_buffer-</code>{12}{1}&#62;, 
  so we set the opposite of whatever was there before.</p>
<p>Rerun the monitor program, and pressing "b" should clear and set the 
  "brake" light on the simulator's indicator panel. When the light 
  is out, the aircraft should naturally start rolling, and the simulated light 
  on the <code>Curses</code> window should go out.</p>
<p>Of course, not all types of variable are as simple to deal with as the brakes 
  and gears. The throttle settings should give you an idea of how to work with 
  more advanced data types, and of course you're not restricted to a <code>Curses</code> 
  display. It just happens that <code>Curses</code> is fairly convenient and low-bandwidth, 
  but nothing is preventing you from transplanting the code into a <code>GTK</code> event loop.</p>
<p>While you can change values in every channel, the simulator may not react to 
  those changes. For instance, you can't change the latitude and longitude 
  of the plane and expect it to teleport to the new location.</p>
<p>The values for latitude and longitude are actually computed from the values 
  in channel 19, the X, Y and Z coordinates. Changing these will actually affect 
  the plane's position in space. However, there doesn't appear to be a 
  simple reference that will describe what values are considered read-only.</p>
<p>The official UDP documentation doesn't contain this, and the only UDP FAQ 
  on the 'net for X-Plane appears not to have been updated since version 
  6. Of course, some of the channels make no sense on certain aircraft. For instance, 
  the Cessna 172 (which the author has several hours' experience in) doesn't 
  have retractable gear.</p>
<h4><a name="Receiving_data">Receiving Data</a></h4>
<p>Receiving data is also done through the <code>$DATA_packet</code> sparse array. 
  In this case, the element type is just used for display purposes, as the channel 
  is transmitted in floating point, and not the mixed format. The entry for "True 
  Speed", which is displayed in miles per hour, looks like this:</p>
<pre><code> 104 2 =&#62; {
 105   0 =&#62; { type =&#62; 'mph', label =&#62; 'True Speed',
 106          label_x =&#62; 0, label_y =&#62; 1,
 107          x =&#62; 12, y =&#62; 1 },
 108 },</code></pre>
<p>When time comes to walk the <code>DATA</code> packet, this entry 
  tells us to see if we've received data channel 2 (line 104). If we have, 
  look at element 0, and display the element at (12,1) in the window (line 107.) 
  Since the type is "mph" (line 105), we know that we have to format that 
  specially.</p>
  











  
<p>Special types like "mph" and "deg" are stored in another hash 
  reference, back on lines 81-85. When the time comes to display the actual 
  data, we look into this hash reference to pull out the format string to use 
  when <code>sprintf()</code>'ing the data. The <code>len</code> 
  hash key gets used as well at this time, to create a mask of space characters 
  that we use to erase the old value completely before displaying the new value.</p>
<pre><code>  81 my $typedef = {
  82   deg =&#62; { format =&#62; &#34;%+03.3f&#34;, len =&#62; 8 },
  83   mph =&#62; { format =&#62; &#34;%03.3f&#34;, len =&#62; 7 },
  84   pct =&#62; { format =&#62; &#34;%+01.3f&#34;, len =&#62; 6 },
  85 };</code></pre>
<p>A special type <code>bool</code> is used for indicator lamps (since indicator 
  lamps are either on or off), but is handled specially. The pseudo-types 
  <code>l</code> and <code>f</code> aren't represented here, but are used when we 
  need to return data to the simulator. While the simulator sends out only floating-point 
  numbers, it receives a mixture of floating-point and integer values, and 
  the mixture changes on a per-channel basis.</p>
<p>Instead of making the programmer create the format strings that we'll use 
  later on to <code>pack()</code> and <code>unpack()</code> packets, we pre-compute 
  them in the function <code>create_pack_strings()</code>. Since the individual 
  elements may occur anywhere in the eight-element array, we may need to skip 
  over elements, and that's done with liberal use of <code>x4</code> 
  in the format, which tells <code>pack()</code> and <code>unpack()</code> to 
  ignore 4 bytes' worth of data.</p>
<pre><code> 164 sub create_pack_strings {
 165   for my $row (values %$DATA_packet) {
 166     $row-&#62;{unpack} = 'x4';
 167     $row-&#62;{pack} = 'l';
 168     for my $j (0..DATA_max_element) {
 169       if(exists $row-&#62;{$j}) {
 170         my $col = $row-&#62;{$j};
 171         $row-&#62;{pack} .=
 172           (grep { $col-&#62;{type} eq $_ } @float_formats) ? 'f' : 'l';
 173         $row-&#62;{unpack} .= 'f';
 174       }
 175       else {
 176         $row-&#62;{pack} .= 'f';
 177         $row-&#62;{unpack} .= 'x4';
 ...</code></pre>
<p>Starting at line 164, <code>create_pack_strings()</code> handles this tedious 
  job for us, by walking the two-dimensional hash reference <code>$DATA_packet</code>. 
  Line 166 starts the unpack() string with <code>x4</code>, which tells 
  the <code>unpack()</code> function to skip over the index long in the packet. 
  We have to unpack the index beforehand in order to know how to deal with the 
  data, so we just ignore that.</p>
<p>Line 167 starts the <code>pack()</code> string with a long, <code>l</code> 
  for the inbound index. Lines 168 onward create the individual elements. The 
  <code>unpack()</code> strings are <code>f</code> if the element is 
  in use, <code>x4</code> if it's not. This means that the format 
  strings only extract the data we need, which makes it easier later on when time 
  comes to actually call <code>unpack()</code> on the actual data.</p>
<p>Lines 171-2 and 176 create the <code>pack()</code> format string, using 
  <code>f</code> for floating-point formats and <code>l</code> 
  for integer types. Since there's no special way to tell the simulator what 
  elements we're updating, we have to send back every element. Unused elements 
  are filled with a sentinel value of -999 to say &#34;Do not update this 
  value.&#34;</p>
<p>In the end, we've added <code>pack</code> and <code>unpack</code> hash keys to 
  every channel in our <code>$DATA_packet</code> structure. Unpacking a channel 
  structure with this format returns to us only the data we're interested 
  in, and skips over unused elements so we don't have to account for empty 
  elements in the array that <code>pack()</code> returns to us.</p>
<p>Likewise, the <code>pack</code> hash key gives us a string to create an entire 
  channel's worth of data, with the proper data types. This is important, 
  even in what should be a simple channel like the gear and brake display. While 
  gears get set to an integer 1 or 0, brakes have to be set to a float from 0 
  through 1, to account for variable pressure.</p>
<h4><a name="Pulling_apart_the_packet">Pulling Apart the Packet</a></h4>
<p>All of the heavy lifting gets done in the <code>receive_DATA()</code> function, 
  from lines 193-234. This function accepts the message sent over the UDP 
  port and breaks it into individual channel-sized packets. The adventure 
  starts on line 196, after clearing a small internal buffer we use to record 
  the last packet received.</p>
<pre><code>  196   for (my $i = 0;
  197        $i &#60; (length($message)-&#38;DATA_header_size-1) / DATA_element_size;
  198        $i++) {
  199    my $channel = substr($message,
  200                         $i * DATA_element_size + DATA_header_size,
  201                         DATA_element_size);</code></pre>
<p>Line 197 computes the number of channels this particular message contains (we're 
  doing this on-the-fly in case you want to change the channel selection 
  while the simulator is running.) The <code>substr()</code> call breaks the message 
  into chunks of <code>DATA_element_size</code> bytes, and gives us back a channel's 
  worth of data.</p>
<pre><code>  203    my $index = unpack &#34;l&#34;, $channel;
  204    next unless exists $DATA_packet-&#62;{$index};</code></pre>
<p>Next, we extract the index (the first byte) of the channel so that we can unpack 
  the data appropriately. If we don't know anything about this channel (i.e.,  if it isn't present in the <code>$DATA_packet</code> hashref), we reject 
  it and move on. This makes us somewhat immune to changes in format.</p>
<pre><code>  206    my $row = $DATA_packet-&#62;{$index};
  207    my @element = unpack $row-&#62;{unpack}, $channel;</code></pre>
<p>Next, we get back the elements we're interested in here by <code>unpack</code>ing 
  with the format string that got calculated in <code>create_pack_strings()</code>. 
  The format string skips the index and unpacks just the elements we wanted. So, 
  now we walk our proffered hash and extract the individual elements:</p>
<pre><code>  208     my $ctr = 0;
  209     for my $j (0..DATA_max_element) {
  210       next unless exists $row-&#62;{$j};
  211       my $col = $row-&#62;{$j};
  212       $DATA_buffer-&#62;{$index}{$j} = $element[$ctr];</code></pre>
<p>Line 208 initializes a counter so that we can keep track of which element we've 
  extracted. Line 209 loops through each possible element in order, so we take 
  into account the possibility that we haven't used a data element.</p>
<p>Lines 210-212 skip unused elements in the sparse array, and saves the content 
  in <code>$DATA_buffer</code>, so we can have keys like <code>g</code> toggle the 
  gear setting, rather than having one key to raise the gear and one key to lower 
  them.</p>
<p>Finally, we display each element based on its type. Boolean types are displayed 
  as either <code>[#]</code> or <code>[ ]</code> depending 
  upon whether the element is a floating one or zero. They're still written 
  out as an integer, but displayed as floating.</p>
<p>Types such as <code>deg</code> and <code>mph</code> with 
  a registered format are handled specially. We first wipe out the old data completely 
  by overwriting with spaces. This prevents a potential issue with the old value 
  being "3.14159", and the new value being "2.7". If we didn't 
  overwrite the old value, it would be displayed as "2.74159", with the 
  extra digits remaining from the old display.</p>
<p>If we've not been told what to do with this (which is the case with Frame Rate), simply print the value and go onward.</p>
<h3><a name="Data-Driven_design">Data-Driven Design</a></h3>
<p>In the current monitor program, each channel in a <code>DATA</code> 
  packet corresponds to a set of fields onscreen. Instead of creating a function 
  to display the onscreen labels and another one to extract the information 
  from the packets, we've elected to combine the label information with the 
  channel and field, in one easy-to-use format.</p>
<p>Since the number of channels and their layout varies between versions of the 
  simulator, we've chosen to represent the channels in a two-tiered hash 
  reference. The outer tier represents a channel, and the inner tier represents 
  the fields inside that channel.</p>
<p>This means that if a channel changes index number (as the pitch and roll channel 
  did from version 7.1 to 7.4), we simply update the channel number in the hashref 
  rather than cutting out a block of code and repositioning it in an array, making 
  maintenance easier.</p>
<p>Since this data likely won't change over the lifetime of the program, we'll 
  store it in a global hash reference, <code>$DATA_packet</code> starting at line 
  92. We can reference a given element in an arbitrary channel with the code fragment 
  <code>$DATA_packet-</code>{$channel}{$element}&#62;, but the code usually 
  ends up iterating by channel and by element.</p>
<p>The sample for the gear display starts at line 109, and the entire channel/element 
  reference looks like:</p>
<pre><code>  109  12 =&#62; {
  110    0 =&#62; { type =&#62; 'bool', label =&#62; 'Gear',
  111           label_x =&#62; 0, label_y =&#62; 3,
  112           x =&#62; 6, y =&#62; 3 },
  113  },</code></pre>
<p>This is the only element in channel 12, and sits at element 0. Boolean types 
  are displayed with <code>[#]</code> and <code>[ ]</code> 
  representing indicator lamps, and it specifies the screen coordinates of the 
  label (<code>label_x</code> and <code>label_y</code>) and where the actual indicator 
  goes (<code>x</code> and <code>y</code>).</p>
<p>After <code>Curses</code> initializes, the <code>setup_display()</code> function 
  iterates over this two-tiered hash and draws the label strings that won't 
  change. Lines 148-156 take care of this, and show how to iterate over the 
  data structure:</p>
<pre><code>  148 sub setup_display {
  149   for my $channel (values %$DATA_packet) {
  150     for my $element (values %$channel) {
  151       $win-&#62;addstr($element-&#62;{label_y},
  152                    $element-&#62;{label_x},
  153                    $element-&#62;{label}) if $element-&#62;{label};
  ...</code></pre>
<p>Note that <code>$win-</code>addstr()&#62; takes the Y coordinate followed 
  by the X coordinate, in accordance with long-standing tradition. Later on, 
  we'll use the <code>type</code> hash key to tell us how to display this 
  data, but that's handled when we receive a message.</p>
<h3><a name="Initialization_and_Shutdown">Initialization and Shutdown</a></h3>
<p>We start by handling the usual command-line options on lines 24-32, 
  including a <code>-h</code> option to display usage. <code>-x</code> 
  sets the X-Plane IP address to something other than the default of "127.0.0.1," <code>-r</code> changes the port the monitor listens on from 49999 
  to something else.</p>
<p>Incidentally, the listening port cannot be 49000, as that's where the simulator 
  listens for its commands. <code>-t</code> tells the monitor to 
  transmit on a different port than 49000, although the simulator is documented 
  to listen to only port 49000. <code>-d</code> is there in case 
  this gets run with earlier versions than 7.4, where the packet format varied 
  depending upon the operating system the simulator was running on.</p>
<p>After command-line configuration is processed and defaults overridden, 
  we create the UDP sockets, on lines 48-65. Instead of the usual TCP 
  protocol, we open UDP ports as that's what the simulator communicates with. 
  If we did this after initializing <code>Curses</code>, our error text would 
  be eaten by the terminal, so we place this first.</p>
<h4><a name="Startup_and_shutdown_of_Curses">Startup and Shutdown of Curses</a></h4>
<p>The Curses startup proceeds fairly normally starting on line 314, with the call 
  to <code>noecho()</code> and <code>cbreak()</code> stopping the terminal from 
  echoing key presses and suppressing carriage returns. <code>$win-&gt;timeout(1);</code> 
  lets us read key presses without blocking, so we can display packets as they 
  come in real-time without having to wait for key presses.</p>
<h4><a name="Displaying_text">Displaying Text</a></h4>
<p>Since Curses implementations vary widely in functionality, we 
  limit ourselves to making <code>addstr()</code> and <code>getch()</code> calls 
  to ensure maximum compatibility across platforms. Inside <code>setup_display()</code> 
  we draw the static labels such as "Gear" and "Pitch," and do 
  the job of displaying the actual values inside <code>receive_DATA()</code>.</p>
<h4><a name="The_main_loop">The Main Loop</a></h4>
<p>This makes the main loop on lines 301-311 pretty straightforward. We poll 
  the keyboard, and display the latest data packet if there isn't one. Otherwise, 
  check to see if the user pressed "q", in which case we quit. UDP sockets 
  don't require any special tear down, so all that's left is to call <code>endwin();</code>. 
  If the user pressed a command key, create an appropriate packet and send that 
  out.</p>
<p>With just the <code>DATA</code> packet, you can create your own customized 
  cockpit display, even take this sample source and turn it into a <code>Gtk</code> 
  application that lets you monitor your plane graphically. The <code>VEHA</code> 
  packet type adds even more possibilities. You could read a friend's virtual 
  location and add his plane as traffic in your virtual world.</p>
<p>Even better, scrape HTML from a flight-tracker service and add real traffic 
  to your virtual world! The <code>FAIL</code> and <code>RECO</code> 
  packet types can cause simulated system failures, so you can create your own 
  in-flight emergencies in Perl! You can even go all the way, and use the 
  <code>SNAP</code> packet type to completely override X-Plane's 
  flight model, telling X-Plane how you think the aircraft should fly.</p>
<p>Hopefully now that I've demystified some of X-Plane's internal 
  workings you'll be inspired to create your own tools, maybe even design 
  and build your own fly-by-wire plane, all in Perl.</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-964" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/07/p6pdigest/20040704.html" rel="bookmark">This Week on Perl 6, Week Ending 2004-07-04</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-07-09T00:00:00-08:00">July  9, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Another week, another Perl 6 Summary. This is becoming a habit.</p>
<p>Let's do perl6-internals first, shall we?</p>
<h4><a name="Japhy's_Perl_6_rules_parser">Japhy's Perl 6 Rules Parser</a></h4>
<p>Last week Jeff 'Japhy' Pinyan announced that he'd be working on 
  a Perl 6 rules parser once he'd finished his Perl 5 regex parser. This week 
  saw a deal of discussion on how his parser worked. The answer seemed to be, 
  &quot;It works the Right Way.&quot; Which is good. With any luck Steve Fink will 
  be able to get this parser and the current (sketchy) Perl 6 compiler playing 
  well together.</p>
<p><a href='http://groups.google.com/groups?selm=Pine.LNX.4.44.0406262313030.28219-100000@perlmonk.org'>http://groups.google.com/groups?selm=Pine.LNX.4.44.0406262313030.28219-100000@perlmonk.org</a></p>
<h4><a name="Complexities">Complexities</a></h4>
<p>Last week Leo pointed out that we'd need support for complex numbers in 
  order to get the Piethon stuff running properly. This week there was some discussion 
  of what was actually needed.</p>
<p>Later in the week Ion Alexandru Morega posted a patch implementing them. I 
  think Leo spoke for us all when he said, &quot;Whee, great, thanks -- applied.&quot;</p>
<p><a href='http://groups.google.com/groups?selm=20040627215622.37698.qmail@onion.perl.org'>http://groups.google.com/groups?selm=20040627215622.37698.qmail@onion.perl.org</a></p>
<h4><a name="New_mailing_lists">New Mailing Lists</a></h4>
<p>There was some discussion of how perl6-internals should be broken up. It 
  looks like we'll see new lists called parrot-internals, parrot-compilers, 
  and parrot-library (for internals hackers, compiler implementers, and library 
  builders respectively). The original perl6-internals will carry on, but 
  will be focused on the actual internals of Perl 6.</p>
<p>Some, or all, of these lists will be covered in these summaries for as long 
  as I can keep up.</p>
<p><a href='http://groups.google.com/groups?selm=Pine.LNX.4.58.0406280851280.16872@sprite.sidhe.org'>http://groups.google.com/groups?selm=Pine.LNX.4.58.0406280851280.16872@sprite.sidhe.org</a></p>

<csperl file="grab" domain="on" record="b/1424" template="b/article_sidebar2.view">

<h4><a name="Stack_language_for_Parrot">Stack Language for Parrot</a></h4>
<p>In as impressive a delurk as I've seen in some time, Michael Pelletier 
  announced that he'd been lurking for a while, playing with Parrot, and had 
  implemented a little stack language not entirely unrelated to Forth, which he'd 
  christened Parakeet. He posted his implementation and got promptly Warnocked.</p>
<p><a href='http://groups.google.com/groups?selm=1088570711.2678.648.camel@heinlein'>http://groups.google.com/groups?selm=1088570711.2678.648.camel@heinlein</a></p>
<h4><a name="GMP_and_licensing_issues">GMP and Licensing Issues</a></h4>
<p>Scott Bronson announced that he'd taken a look at GMP's license and 
  he didn't think it was incompatible with Parrot's licenses. Dan wasn't 
  convinced. Scott's still trying to convince him though.</p>
<p>Robert Spier attempted to resolve the problem by pointing everyone at another 
  possibly suitable library called IMath.</p>
<p><a href='http://groups.google.com/groups?selm=1088572790.3306.100.camel@lea.rinspin.com'>http://groups.google.com/groups?selm=1088572790.3306.100.camel@lea.rinspin.com</a></p>
<p><a href='http://groups.google.com/groups?selm=m3wu1o8cb1.wl_rspier@pobox.com'>http://groups.google.com/groups?selm=m3wu1o8cb1.wl_rspier@pobox.com</a></p>
<h3><a name="Meanwhile,_in_perl6-language">Meanwhile, in perl6-language</a></h3>
<h4><a name="Argh!_Strings!">Argh! Strings!</a></h4>
<p>Discussion of the various ways of slicing and dicing strings in Perl 6 continued. 
  The issue is that, especially in a Unicode world, there are many ways of looking 
  at a string, all of which are useful in different contexts. However, because 
  you can look at a string as a sequence of bytes, code points, graphemes, or 
  whatever, then functions like <code>substr</code> 
  get a little weird. If you were to say:</p>
<pre><code>    $substring = $a_string, 5</code></pre>
<p>Then what does the '5' mean?</p>
<p>And that's just one example of where conceptual problems can arise.</p>
<p>I confess that, whenever Unicode comes up, my gut reaction is to keep my head 
  down and trust that Larry's going to get it right. Certainly the current 
  formulation seems decently sane; things only get problematic if you're trying 
  to do something well out of the ordinary.</p>
<p><a href='http://groups.google.com/groups?selm=20040626202059.GA1747@wall.org'>http://groups.google.com/groups?selm=20040626202059.GA1747@wall.org</a></p>
<h4><a name="if,_loop,_and_lexical_scope"><code>if</code>, <code>loop</code>, 
  and Lexical Scope</a></h4>
<p>Discussion of Perl 6's new scoping rules (things are generally more consistent 
  than they are in Perl 5; if a variable is declared inside a block, or in that 
  block's signature in the case of <code>-&#62; 
  $a, $b {...}</code> type blocks, then that block is its scope) continued. Some 
  people like the new rules, others don't.</p>
<p><a href='http://groups.google.com/groups?selm=20040627211611.GB3013@babylonia.flatirons.org'>http://groups.google.com/groups?selm=20040627211611.GB3013@babylonia.flatirons.org</a></p>
<h4><a name="Different_OO_models">Different OO Models</a></h4>
<p>Jonadab the Unsightly One had wondered about having objects inheriting behavior 
  from objects rather than classes in Perl 6. The gist of the answers he received 
  was that it wouldn't be in the core of the language, but neither should 
  it be too hard to implement something that worked how he wants.</p>
<p><a href='http://groups.google.com/groups?selm=n02nraxl.fsf@jonadab.homeip.net'>http://groups.google.com/groups?selm=n02nraxl.fsf@jonadab.homeip.net</a></p>
<h4><a name="Undo?">Undo?</a></h4>
<p>Michele Dondi wondered if Perl 6 would have a built-in <code>undo</code> 
  function for rolling back the history of a scalar (say). Rafael Garcia-Suarez 
  pointed out that the concept wasn't as simple as it first appeared, especially 
  in the context of threads, closures, side effects. He suggested that a better 
  approach would be to implement a suitable transaction/rollback library that 
  handled such things in an application-appropriate fashion rather than using 
  a &quot;half-baked kludge built into the base language.&quot; Mark Biggar pointed 
  out that the language already had hypothetical values, which did pretty much 
  the right thing.</p>
<p>Elsewhere in the thread, Luke Palmer attempted to explain continuations again. 
  A sandwich was involved.</p>
<p><a href='http://groups.google.com/groups?selm=Pine.LNX.4.56L0.0406291740180.10615@worf.pcteor1.mi.infn.it'>http://groups.google.com/groups?selm=Pine.LNX.4.56L0.0406291740180.10615@worf.pcteor1.mi.infn.it</a></p>
<p>Luke makes a continuation sandwich --<br />
  <a href='http://groups.google.com/groups?selm=20040629233129.GA3979@babylonia.flatirons.org'>http://groups.google.com/groups?selm=20040629233129.GA3979@babylonia.flatirons.org</a> 
</p>
<h4><a name="If_not_,_then_what">If Not <code>,</code> Then What?</a></h4>
<p>Alexey Trofimenko triggered your Summarizer's sense of <i>d&eacute;j&agrave; vu</i> when 
  he asked what was happening to the C-style comma (we're keeping it, 
  more or less) and proposing a <code>then</code> keyword 
  for use in the contexts where Perl 6's new <code>,</code> 
  didn't quite work the same way as in Perl 5. Which is pretty much the same 
  as the proposal Luke Palmer made some months ago and which Larry rejected.</p>
<p>Jonathan Lang pointed out how you'd implement <code>then</code> 
  if you needed it, though.</p>
<p>The thread got slightly silly after this (Sideways semicolons! I ask you!). 
  I'm not sure what chromatic was driving at when he suggested a <code>meh</code> 
  operator, though.</p>
<p><a href='http://groups.google.com/groups?selm=opsafpwqtgsspxk8@s'>http://groups.google.com/groups?selm=opsafpwqtgsspxk8@s</a></p>
<h4><a name="map,_grep_and_laziness"><code>map</code>, <code>grep</code> 
  and Laziness</a></h4>
<p>That man Alexey also had some questions about lazy evaluation. Luke Palmer 
  attempted to allay his fears by saying that Perl 6 would be essentially lazy 
  unless you told it otherwise.</p>
<p><a href='http://groups.google.com/groups?selm=opsajn0im2sspxk8@s'>http://groups.google.com/groups?selm=opsajn0im2sspxk8@s</a></p>
<h3><a name="Announcements,_Apologies,_Acknowledgements">Announcements, Apologies, Acknowledgements</a></h3>
<p>Woohoo! Another weekly summary.</p>
<p>If you find these summaries useful or enjoyable, please consider contributing 
  to the Perl Foundation to help support the development of Perl. You might also 
  like to send me feedback at <a href='mailto:pdcawley@bofh.org.uk'>mailto:pdcawley@bofh.org.uk</a></p>
<p><a href='http://donate.perl-foundation.org/'>http://donate.perl-foundation.org/</a> 
  -- The Perl Foundation</p>
<p><a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> -- 
  Perl 6 Development site</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-962" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/07/p6pdigest/20040702.html" rel="bookmark">This Week on Perl 6, Week Ending 2004-06-27</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-07-02T00:00:00-08:00">July  2, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>What's this? No! It can't be! It's a <i>weekly</i> Perl 6 Summary. 
  What is the world coming to?</p>
<p>Sorry, I can't answer that one, so I'll tell you what's been happening 
  this week in perl6-internals.</p>
<h4><a name="Bignums,_licenses,_pie">Bignums, licenses, pie</a></h4>
<p>As you are no doubt aware, Python has bignums. And that means that, unless 
  we want Dan to get a face full of Pie at OSCON this year, Parrot needs bignums 
  too. Work on several fronts continued towards getting a bignum implementation 
  for Parrot. Ideally, we'd like to just include GMP, but the license seems 
  to require that the full source of GMP sip with any Parrot binary. Which isn't 
  good when you're writing a VM that you'd like to be able to install 
  on, say, a Palm.</p>
  
<p>Scott Bronson suggested getting in touch with the GMP developers to see if 
  there was anything that could be done about it. He volunteered to be the liaison, 
  assuming Dan was cool with it.</p>
<p>Meanwhile, Uri Guttman offered his 'stillborn' bignum implementation 
  as a basis for our own bignum library. Leo commented that it might be a good 
  idea in the medium to long term, but the Pie-thon is looming...</p>
<p><a href='http://groups.google.com/groups?selm=a0611040bbcefb9fb77e6@[10.0.1.3]'>http://groups.google.com/groups?selm=a0611040bbcefb9fb77e6@[10.0.1.3]</a></p>
<p><a href='http://groups.google.com/groups?selm=Pine.LNX.4.58.0406231105390.10311@sprite.sidhe.org'>http://groups.google.com/groups?selm=Pine.LNX.4.58.0406231105390.10311@sprite.sidhe.org</a></p>
<h4><a name="Ion's_Strings">Ion's Strings</a></h4>

<csperl file="grab" domain="on" record="b/1424" template="b/article_sidebar.view">

<p>Remember Ion Alexandru Morega's string pmc that got Warnocked? Well, it 
  got un-Warnocked this week. Dan liked it, so he checked it in. Congratulations 
  Ion, don't forget to send in a patch to the <em lang='und' xml:lang='und'>CREDITS</em> 
  file.</p>
<p><a href='http://groups.google.com/groups?selm=20040620075716.37958.qmail@onion.perl.org'>http://groups.google.com/groups?selm=20040620075716.37958.qmail@onion.perl.org</a></p>
<h4><a name="Mmm..._Pie-thon">Mmm... Pie-thon</a></h4>
<p>Dan reminded everyone of the URL of the benchmark that's going to be run 
  for the Pie-thon. If Parrot doesn't run it faster than the C implementation 
  of Python, then Dan's going to get a pie in the face and he'll have 
  to spring for a round of drinks for the Python Cabal (is there one? Could be 
  a cheap round...). Of course, the plan is to have Parrot be faster than Python 
  so Dan'll get to chuck a Pie at Guido. Either way, if you're at OSCON 
  this year it should be fun.</p>
<p>Right now, Parrot is some way from, well, running it.</p>
<p>Leo announced that he will start a series of postings discussing the main features 
  (and requirements) of the various benchmarks. He started with some notes on 
  <em lang='und' xml:lang='und'>b6.py</em>.</p>
<p><a href='http://groups.google.com/groups?selm=Pine.LNX.4.58.0406210949440.10788@sprite.sidhe.org'>http://groups.google.com/groups?selm=Pine.LNX.4.58.0406210949440.10788@sprite.sidhe.org</a></p>
<p><a href='http://groups.google.com/groups?selm=40D82C8F.1010903@toetsch.at'>http://groups.google.com/groups?selm=40D82C8F.1010903@toetsch.at</a> 
  -- Python needs exception objects</p>
<p><a href='http://groups.google.com/groups?selm=40D84647.40407@toetsch.at'>http://groups.google.com/groups?selm=40D84647.40407@toetsch.at</a> 
  -- Pie-thon and the recursion limit</p>
<h4><a name="Class_name_hashes">Class name hashes</a></h4>
<p>Leo wondered about the current implementation of class name hashes. We have 
  two such hashes, one for PMC base classes and one for dynamic PMCs. Leo thought 
  this was suboptimal (and liable to make one of the Pie-thon benchmarks problematic.) 
  Dan agreed that unifying the hashes (and renaming PMC classes to have Parrot 
  prefixes (ParrotFixedSizeArray anyone?)) was the way to go.</p>
<p><a href='http://groups.google.com/groups?selm=40D85C12.8010502@toetsch.at'>http://groups.google.com/groups?selm=40D85C12.8010502@toetsch.at</a></p>
<h4><a name="Confusing_parameter_order">Confusing parameter order</a></h4>
<p>Nicholas Clark was somewhat bemused by the choice of parameter order for the 
  <code>Parrot_PMC_set_intval_intkey</code> function, 
  which reverses the order of some parameters from the vtable version. He suggested 
  unifying the two. Leo agreed that changing things round was the best bet and 
  suggested that Nicholas go ahead and make the change to the <em lang='und' xml:lang='und'>extend.h</em> 
  interface. Dan didn't pipe up to say it was a bad idea. In fact, Dan didn't 
  pipe up at all.</p>
<p><a href='http://groups.google.com/groups?selm=20040624140935.GH81272@plum.flirble.org'>http://groups.google.com/groups?selm=20040624140935.GH81272@plum.flirble.org</a></p>
<h4><a name="Perl_6_regex_parser">Perl 6 regex parser</a></h4>
<p>Jeff 'japhy' Pinyan announced that he was currently completing work 
  on an extensible, regex-specific, parsing module. Once it's finished, 
  he's going to start work on writing a subclass that parses Perl 6 rules. 
  He thought it might come in handy for people implementing Perl 6.</p>
<p>Luke Palmer thought it would be too; the grammar of Perl 6 is being specified 
  in Perl 6 patterns. Initially it was hoped that Damian's Perl6::Rules module 
  would be what was needed to bootstrap us, but 'serious bugs in the Perl 
  5 regex engine having to do with executing code within regexes' meant that 
  Perl6::Rules can't do the job for us.</p>
<p>So, good luck Japhy, we're depending on you.</p>
<p>But, you know, no pressure mate.</p>
<p><a href='http://groups.google.com/groups?selm=Pine.LNX.4.44.0406262313030.28219-100000@perlmonk.org'>http://groups.google.com/groups?selm=Pine.LNX.4.44.0406262313030.28219-100000@perlmonk.org</a></p>
<h4><a name="Leo's_tasks_for_the_interested">Leo's tasks for the interested</a></h4>
<p>Leo asked for volunteers to implement a class to handle complex numbers (needed 
  for Python) and to implement sort method(s) for the various *Array PMCs.</p>
<p><a href='http://groups.google.com/groups?selm=40DEF36A.3080101@toetsch.at'>http://groups.google.com/groups?selm=40DEF36A.3080101@toetsch.at</a></p>
<h3><a name="Meanwhile,_in_perl6-language">Meanwhile, in perl6-language</a></h3>
<h4><a name="Command_line_like_switches_for_functions_and_operators">Command line like switches for functions and operators</a></h4>
<p>Michele Dondi proposed syntax for adding 'command line' type switches 
  to functions and methods which look almost, but not quite, entirely unlike Perl 
  6's named parameters. Brent Royal-Gordon pointed out that Michele's 
  proposed</p>
<pre><code>    rename -v =&gt; 1, $orig, $new;</code></pre>
<p>could be written, rather more Perl6ishly as:</p>
<pre><code>    rename $orig, $new :verbose;</code></pre>
<p>Luke Palmer pointed out that wrappers could be used to add such extra named 
  arguments to built ins, so the proposed behaviour for <code>rename</code> 
  could be implemented as:</p>
<pre><code>    &#38;*rename.wrap -&gt; $orig, $new, *%opt {
        say &#34;Renaming '$orig' to '$new'&#34; if %opt{'verbose' | 'v'};
        call;
    }</code></pre>
<p>It turns out that neither of these were what Michele was driving at; it wasn't 
  so much that new syntax was wanted, but that every built in have some kind of 
  verbose version.</p>
<p>Meanwhile, as the discussion drifted in typical perl6-language style, Larry 
  talked about 'allowing (at least) a single closure parameter to come at 
  the end after the list parameter'. Simon Cozens doesn't seem to be maintaining 
  his Ruby-o-meter any more, but if Larry were to make this change, the 
  needle would definitely swing further in Ruby's direction.</p>
<p><a href='http://groups.google.com/groups?selm=Pine.LNX.4.56L0.0406221118150.1885@worf.pcteor1.mi.infn.it'>http://groups.google.com/groups?selm=Pine.LNX.4.56L0.0406221118150.1885@worf.pcteor1.mi.infn.it</a></p>
<h4><a name="User_defined_operators">User defined operators</a></h4>
<p>Michele Dondi wondered if Perl 6 would have a way of defining infix operators. 
  Answer: Yes. The discussion pointed up some interesting scoping issues to do 
  with macros too. But macros do that (as a look at any text on Common Lisp macros 
  will show you).</p>
<p><a href='http://groups.google.com/groups?selm=Pine.LNX.4.56L0.0406241206170.2865@q.pcteor1.mi.infn.it'>http://groups.google.com/groups?selm=Pine.LNX.4.56L0.0406241206170.2865@q.pcteor1.mi.infn.it</a></p>
<h4><a name="Definitions_of_truth">Definitions of truth</a></h4>
<p>Paul Hodges doesn't like the fact that a null character (<code>&#34;\0&#34;</code>) 
  is has a boolean 'true' value in Perl 5. He hoped that Perl 6 would 
  change this. It appears his hopes are in vain. The consensus appeared to be 
  that this kind of thinking is a (potentially) dangerous fossil from C type thinking. 
  Jonadab the Unsightly One muttered something about 'comparing apples and 
  orange leotards'.</p>
<p>The actually discussion was a little more discursive, of course.</p>
<p><a href='http://groups.google.com/groups?selm=2820B295B95836498EED98D7A065C4F104DBD5D4@bremocmg-55'>http://groups.google.com/groups?selm=2820B295B95836498EED98D7A065C4F104DBD5D4@bremocmg-55</a></p>
<h4><a name="Slicing">Slicing</a></h4>
<p>Rod Adams wondered how hash slicing will work in 'the glorious age of Perl 
  6'.</p>
<p>So do we all Rod. We hope it'll work really well. Apocalypse N will have 
  detailed answers.</p>
<p><a href='http://groups.google.com/groups?selm=40DB63D1.4070804@rodadams.net'>http://groups.google.com/groups?selm=40DB63D1.4070804@rodadams.net</a></p>
<h4><a name="Postfix_modifiers">Postfix modifiers</a></h4>
<p>The core Perl 6 language will allow one, and only one, postfix modifier per 
  statement. Larry has said this several times. If you want more, modify the grammar 
  yourself.</p>
<p>If that was the last time I find myself having to say this before we get a 
  Perl 6 beta then I'll gladly eat a hat at the appropriate OSCON. You can 
  hold me to this (but you'll have to pay my travelling expenses).</p>
<h4><a name="The_.bytes/.codepoints/.graphemes_methods">The <code>.bytes</code>/<code>.codepoints</code>/<code>.graphemes</code> 
  methods</a></h4>
<p>Argh! Unicode! But for once it's not moaning about Unicode operators, so 
  that's a result.</p>
<p>Brent Royal-Gordon wondered about the behaviour of the <code>.bytes</code>, 
  <code>.codepoints</code>, and <code>.graphemes</code> 
  methods on the String object. He suggested that, in a list context, they return 
  a list of the appropriate things in the string. Larry looked upon Brent's 
  proposal and saw that it was good.</p>
<p><a href='http://groups.google.com/groups?selm=40DDCE2A.1080806@brentdax.com'>http://groups.google.com/groups?selm=40DDCE2A.1080806@brentdax.com</a></p>
<h4><a name="if,_loop_and_lexical_scope"><code>if</code>, <code>loop</code> 
  and lexical scope</a></h4>
<p>Alexey Trofimenko wondered about the lexical scoping rules associated with 
  Perl 6's various control structures.</p>
<p>If you're unsure about them yourself, Luke Palmer's reply is an excellent 
  overview of how such scoping works and of some of the rationale behind it.</p>
<p><a href='http://groups.google.com/groups?selm=opr99iqr0esspxk8@s'>http://groups.google.com/groups?selm=opr99iqr0esspxk8@s</a></p>
<h3><a name="Announcements,_Apologies,_Acknowledgements">Announcements, Apologies, Acknowledgements</a></h3>
<p>Hopefully this summary marks a return to the good old days of weekly summaries, 
  posted to the mailing lists near the beginning of the week.</p>
<p>Well, we can always hope can't we?</p>
<p>If you find these summaries useful or enjoyable, please consider contributing 
  to the Perl Foundation to help support the development of Perl. You might also 
  like to send me feedback at <a href='mailto:pdcawley@bofh.org.uk'>mailto:pdcawley@bofh.org.uk</a></p>
<p><a href='http://donate.perl-foundation.org/'>http://donate.perl-foundation.org/</a> 
  -- The Perl Foundation</p>
<p><a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> -- 
  Perl 6 Development site</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-952" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/07/02/poeintro.html" rel="bookmark">Application Design with POE</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Matt Cashner</span> on <abbr class="published" title="2004-07-02T00:00:00-08:00">July  2, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Day in and day out, I write large applications in perl. I'm cursed I tell 
  you. While large scale, long-running applications in pure perl may sound 
  fairly easy to write, they are not. Perl, beyond a certain size and complexity, 
  gets really difficult to manage if one is not extremely careful. The proper 
  choice of an application framework helps to minimize this difficulty. For many 
  applications, apache and mod_perl make a lot of sense. This is an excellent 
  choice for user interface applications and data display systems. However, HTML 
  and the WWW simply don't make sense for many forms of long-running applications, 
  particularly network based servers. Apache certainly isn't the right choice 
  for syslog monitoring or edge host traffic analysis.</p>
<p>My framework of choice is POE. POE is a single-threaded, event driven, 
  cooperative multitasking environment for perl. Basically, POE is an application 
  framework in which a single threaded perl process waits for events to occur 
  so it can act accordingly. This event loop comprises the core of a POE process.</p>
<p>If all POE offered was an event loop, there would not be much to talk about 
  though. Nor would POE be particularly special. Several event loop modules already 
  exist on CPAN. Event, Coro, IO::Events, and IO::Poll all offer similar functionality. 
  However, any worthwhile application demands more than a simple set of actions.</p>
<h3><a name="SESSIONS">SESSIONS</a></h3>
<p>POE programs begin with a 'session'. Each session represents a cooperatively 
  multi-tasked state machine.</p>
<pre><code>    POE::Session-&gt;create(
        inline_states =&gt; {
            _start =&gt; \&amp;start,
            _stop =&gt; \&amp;stop,

            do_something =&gt; \&amp;do_something,
        },
        heap =&gt; {
            'some' =&gt; 'data',
        },
    );</code></pre>
	
<csperl file="grab" domain="on" record="b/936" template="b/article_sidebar.view">	
	
<p>Sessions are slightly analogous to threads in that they have a unique runtime 
  context and a semi-private data store (called the &#34;heap&#34;). Each 
  session operates independently from other sessions, receiving time-slices 
  from the POE kernel. It is important to remember that, despite the similarity 
  to threads, all POE sessions run in the same single-threaded process.</p>
<p>Sessions provide very simple, easy to understand building blocks on which to 
  build more complex applications. POE provides a way to give sessions names, 
  called <i>aliases</i>, which uniquely address the session from outside the session 
  itself. <code>$poe_kernel-&gt;alias_set($alias)</code> sets an alias for 
  the current session. Any POE session in the process can then send events to 
  that session using the named identifier.</p>
<pre><code>    if($door_bell) {
        $poe_kernel-&gt;post( $alias =&gt; 'pizza' );
    }</code></pre>
<p>Remote addressing provides the ability to have a service-like model inside 
  an application. Different sessions provide different services to the application. 
  One session may provide DNS resolution while another provides data storage. 
  Using commonly known names, perhaps stored in a config file, the central application 
  becomes much smaller and easier to manage.</p>
<h3><a name="COMPONENTS">COMPONENTS</a></h3>
<p>POE components provide an abstract api to service-like POE sessions. Rather 
  than duplicating the session construction call and the accompanying subroutines 
  every time you find a new use for your sessions, it is a better idea to roll 
  all that code into a perl module.</p>
<pre><code>    package POE::Component::MyService;

    sub create {
        POE::Session-&gt;create(
            # ...
        );
    }

    sub start {
        $poe_kernel-&gt;alias_set(__PACKAGE__);
    }
    
    
    ####
    
    
    #!/usr/bin/perl
    use POE;
    use POE::Component::MyService;

    POE::Component::MyService-&gt;create();
    POE::Kernel-&gt;run();</code></pre>
<p>The POE community has created a standard namespace of <code>POE::Component</code> 
  for these modules. Typically they have a constructor called <code>create()</code> 
  or <code>spawn()</code> and provide a service to the POE application via a session. 
  Apart from these few simple rules, components are free to do whatever is necessary 
  to fulfill their purpose. <code>POE::Component::Server::Syslog</code>, for instance, 
  spawns a UDP listener and provides syslog data via callbacks. <code>POE::Component::RSS</code> 
  accepts RSS content via an alias and calls specially named events to deliver 
  data. <code>POE::Component::IRC</code> follows a similar model.</p>
<h3><a name="WHEELS">WHEELS</a></h3>
<p>For some tasks, a full session is unnecessary. Sometimes, it makes more sense 
  to alter the abilities of an existing session to provide the desired functionality. 
  POE has a special namespace called <code>POE::Wheel</code> for modules which 
  mutate or alter the abilities of the current session to provide some new functionality.</p>
<pre><code>    package POE::Wheel::MyFunction;

    sub new {
        # ...
    }

    ####

    #!/usr/bin/perl
    use POE;
    use POE::Wheel::MyFunction;

    POE::Session-&gt;create(
        #...
        foo =&gt; \&amp;foo,
    );

    POE::Kernel-&gt;run();

    sub start {
        POE::Wheel::MyFunction-&gt;new(
            FooState =&gt; 'foo'
        );
    }</code></pre>
<p>Where components often use subroutine callbacks in the same way as <code>POE::Session</code>, 
  wheels use local event names to provide functionality. Internally, they create 
  wrappers around calls to these events which build the context necessary for 
  a POE event to occur.</p>
<p>Wheels are much more complex to create, for good reason. Wheels share their 
  entire operating context with the user's session but share very little of 
  the niceties. Wheels do not have their own heap and cannot create aliases for 
  themselves. In many ways, they are like a parasite clinging to the side of the 
  user's code. As long as they don't get in the way and they provide a 
  useful function, they are allowed to exist.</p>
<p>The development overhead is made up for, however, by the loss of internal POE 
  overhead. Sessions require a certain amount of maintenance to keep running. 
  POE checks sessions to see if they still have work to do, if there are timers 
  or alarms outstanding for them, if they should be garbage collected, etc etc. 
  The more sessions that exist in a system, the more that overhead grows. This 
  overhead is especially noticeable in time sensitive applications. Wheels have 
  none of this overhead. They piggyback on top of the user's session so, apart 
  from any events they may trigger as part of their normal operation, there is 
  no inherent internal POE overhead in using a wheel.</p>
<h3><a name="FILTERS">FILTERS</a></h3>
<p>Many wheels handle incoming and outgoing data. They exist to help the user 
  get data from some strange source (say, HTTP) into a format the user can analyze 
  or take apart in perlish ways. <code>POE::Wheel::SocketFactory</code>, for instance, 
  handles all the scariness of nonblocking socket creation and maintenance. For 
  most of us, however, SocketFactory doesn't go far enough. I don't want 
  to have to worry about pack calls or http headers or whatever other nonsense 
  is necessary to take a transaction off the wire and make it palatable. Special 
  modules in the <code>POE::Filter</code> namespace handle this drudgery.</p>
<pre><code>    package POE::Filter::MyData;

    sub new {
        # ...
    }
    
    sub put {
        # ...
    }

    sub get {
        # ...
    }</code></pre>
<p>Filters are very simple data parsing modules. Most POE filters are limited 
  enough to be used outside of a POE environment. They know nothing of POE or 
  of the running POE environment. The standard interface requires three methods: 
  <code>new()</code>, the constructor; <code>get()</code>, the input parser; and 
  <code>put()</code> the output generator. <code>get()</code> takes a stream of 
  data and returns parsed records, which may be hashes, arrays, objects, or anything 
  else one might desire. <code>put()</code> takes user generated records and converts 
  them to raw data.</p>
<h1><a name="Design">Design</a></h1>
<p>With these four simple building blocks, POE applications can grow to meet almost 
  any need while still being maintainable. The key is to break the application 
  up into small chunks. This is beneficial for two main reasons: 1) the individual 
  chunks are more easily understood by a new staff member or someone else looking 
  at the code six months from now. 2) Smaller blocks of code spend less time ... 
  well, blocking.</p>
<p>As noted above, a POE application is a single-threaded process that pretends 
  to perform asynchronous actions through a technique called cooperative multitasking. 
  At any given time, only one subroutine inside a POE application is executing. 
  If that one subroutine has a <code>sleep 60;</code> inside of it, the entire 
  application will sleep for 60 seconds. No alarms will be triggered; no actions 
  will occur. Smaller blocks of code mean that POE gets a chance to do other actions 
  like cleaning up sessions that are shutting down or executing another event.</p>
<p>Even long-running for-loops can be broken down into small POE events.</p>
<pre><code>    while(@data) {
        # ... process, process
    }</code></pre>
<p>can become</p>
<pre><code>    $poe_kernel-&gt;yield('process_data' =&gt; $_) for @data;</code></pre>
<p>This gives POE time to read from sockets, do internal housekeeping, and so 
  on,between each bit of processing time. If <code>@data</code> is large enough, 
  however, this method can lead to resource depletion - spewing out 5000 events 
  to process <code>@data</code> may get the job done and allow POE to do housekeeping, 
  but it means that for the next 5000 event invocations, POE is doing nothing 
  but processing that array.</p>
<p>POE's event queue is a FIFO (First In First Out). Events are processed 
  in the order they are invoked. There are two major exceptions to this. Signals 
  can trigger immediate event processing, and using <code>call()</code> instead 
  of <code>yield()</code> or <code>post()</code> will cause immediate event processing. 
  Beyond those two exceptions, every event happens in order, all of the time.</p>
<p>In the example above, we asked POE to push a large number of events on the 
  queue. While POE can still read off whatever socket we're getting data from 
  inbetween those <code>yield</code>s, the events triggered by that socket read 
  will not be invoked until after we're done processing our giant array. We 
  can break that pattern out very easily.</p>
<p>If we don't need to process <code>@data</code> in any timely fashion, we 
  can stagger the processing out further:</p>
<pre><code>    $poe_kernel-&gt;delay_add('process_data' =&gt; $hence++ =&gt; $_) for @data;</code></pre>
<p>This will process one chunk of <code>@data</code> every second. Not very efficient 
  or timely but other events can take place between invocations. One second is 
  by no means the smallest time value accepted by <code>delay_add()</code>. Use 
  of <code>Time::HiRes</code> allows for microsecond delay values:</p>
<pre><code>    use Time::HiRes;
    use POE;</code></pre>
<p>The use of <code>Time::HiRes</code> before importing <code>POE</code> causes 
  POE to use <code>Time::HiRes</code>' <code>time()</code> instead of perl's 
  built-in <code>time()</code>. While <code>Time::HiRes</code> has much greater 
  resolution on time values, it may or may not be the most accurate time keeper 
  on your particular platform. Do your homework and make the choice that best 
  suits your situation and needs.</p>
<h1><a name="Conclusion">Conclusion</a></h1>
<p>POE is a flexible application framework appropriate for long-running large-scale 
  perl applications. It provides standard interfaces for task abstraction and 
  forces the coder to think about their software in smaller, more maintainable 
  chunks.</p>
<p>POE is available on CPAN (<a href='http://search.cpan.org/dist/POE'>http://search.cpan.org/dist/POE</a>) 
  and has a rich, community-maintained website (<a href='http://poe.perl.org'>http://poe.perl.org</a>).</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2004/06/">&laquo; June 2004</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2004/08/">August 2004 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
