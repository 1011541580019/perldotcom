<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: March 2004 Archives</title>


    <link rel="prev" href="/pub/2004/02/" title="February 2004" />
    <link rel="next" href="/pub/2004/04/" title="April 2004" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">March 2004 Archives</h1>





                            
                            <div id="entry-904" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/03/p6pdigest/20040328.html" rel="bookmark">This week on Perl 6, week ending 2004-03-28</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-03-28T00:00:00-08:00">March 28, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>...
and we're back!
Another interesting week in Perl 6.
Your Summarizer even wrote some [parrot] code and it's been simply ages since he did that.
In accordance with ancient custom,
we'll start the summary with perl6-internals.</p>

<h4><a name="Building_with_miniparrot">Building with miniparrot</a></h4>

<p>Back in the early days Dan proposed,
and it was generally agreed that the Parrot build process wouldn't be Perl dependent,
but instead there would be a few OS specific 'bootstrap' scripts,
enough to get <em lang='und' xml:lang='und'>miniparrot</em> up and running.
Miniparrot would have just enough smarts to be able to complete the configuration and build the final full parrot.</p>

<p>After last week's discussion about reinventing metaconfig,
I wondered if the miniparrot plan was still in place.
It seems I'd missed the discussion of <code lang='und' xml:lang='und'>stat</code> that ended up talking about how miniparrot would be able to do its job.
I find myself wondering what else is needed to get miniparrot to the point where it can start doing configuration work.</p>

<p><a href='http://groups.google.com/groups?selm=a06010202bc74cd596e93@[10.0.1.2]'>http://groups.google.com</a></p>

<h4><a name="Continuations_continued_(and_fun_with_stacks)">Continuations continued (and fun with stacks)</a></h4>

<p>Warning: The following discussion of the Continuation discussions is irrevocably biased; I find it very hard to be objective about discussions I participate in,
and I was rather loud mouthed in this one.</p>

<p>The previous discussions of the uses and semantics of continuations carried over into this week.
Piers Cawley argued that the current stack architecture seemed to be optimized for the wrong thing,
with the special case RetContinuations being symptoms.
He argued that current architecture (where a single stack frame can accommodate multiple pushes,
with copy on write semantics being used to handle full continuations) should be replaced with a 'na&#239;ve' architecture using linked lists of immutable,
simple stack frames,
one frame per push.
Switching to this approach,
he argued,
would do away with a great deal of code complexity,
and issues of high object creation overhead could be offset by using free lists and preallocation to reuse stack frames.
Oh yes,
and there'd be no difference between a RetContinuation and a full Continuation with this scheme.</p>

<csperl file="grab" domain="on" record="b/940" template="b/article_sidebar.view">

<p>Leo T&#246;tsch wasn't convinced.
Dan was though,
and made the decision to switch to single item per frame,
immutable,
non COW stacks.
Leo implemented it.
His first cut was rather slow; later refinements added freelists and other handy stuff to start pulling the performance back up.
I'm sure there's more refinement to come though.</p>

<p><a href='http://groups.google.com/groups?selm=200403171746.i2HHkon26793@thu8.leo.home'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=m2llluszax.fsf@obelisk.bofh.org.uk'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=a0601024ebc84a9496605@[10.0.1.2]'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=406020C3.9040904@toetsch.at'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=rt-3.0.8-27904-82629.6.64105174468546@perl.org'>http://groups.google.com</a></p>

<h4><a name="Variadic_functions">Variadic functions</a></h4>

<p>Ilya Martynov had some questions about how to handle variadic functions.
Leo clarified some things and pointed Ilya at the <code lang='und' xml:lang='und'>foldup</code> op.
Jens Rieks suggested aliasing the registers <code lang='und' xml:lang='und'>I[1-4]</code> to <code lang='und' xml:lang='und'>argc[ISPN]</code>,
which Leo liked.
I'm not sure he's implemented it yet though.</p>

<p><a href='http://groups.google.com/groups?selm=87zna9z04w.fsf@moto.localhost'>http://groups.google.com</a></p>

<h4><a name="GCC_compiling_to_Parrot">GCC compiling to Parrot</a></h4>

<p>In previous weeks Gerard Butler had posted wondering about getting GCC to target Parrot.
The initial response was rather negative,
pointing out that GCC and Parrot saw memory <i>very</i> differently,
to the extent that there would probably be a need have special PMCs for GCC managed memory,
which would make communication between GCC implemented languages and Parrot implemented ones rather tricky.</p>

<p>Undeterred,
Gerald mapped out a way forward and asked for opinions.
Dan thought the scheme looked reasonable,
but fenced that with the caveat that he knows nothing about GCC's internals.</p>

<p><a href='http://groups.google.com/groups?selm=FE6307104985D611A92A0002A5F3AB00B9D867@exch1.Sterling.COM'>http://groups.google.com</a></p>

<h4><a name="Safe_execution_core_and_ops_classification">Safe execution core and ops classification</a></h4>

<p>Leo checked in some patches from Jens Rieks to allow classification of ops.
He thought that this meant we were a good way along the road to providing a 'Safe' run-core option,
though there was still a lot to do.
He outlined a road map and asked for comments (and implementations).
Comments were forthcoming,
and Dan eventually bundled his comments up into a single post with some design in it.
For some reason this induced some industrial hand waving about Proof Carrying Code from Steve Fink (he accused himself of hand waving,
not me).</p>

<p>Jarkko Hietaniemi (Emacs' dynamic completion suggested 'Jarkko Himself' for that one.
Well,
it made <i>me</i> smile) offered the pathological</p>

<pre><code>    eval 'while(push@a,0){}'</code></pre>

<p>as an example of the kind of bad things that can happen if you allow <code lang='und' xml:lang='und'>eval EXPR</code> in your 'safe' code, even with strict rules on what it's allowed to compile (Dan pointed out that quotas would help in this particular case...)</p>

<p>If there's one lesson to take from the discussion it's this: Code Safety is Hard. Whether it's AI Hard or not is left as an exercise for the interested reader.</p>

<p><a href='http://groups.google.com/groups?selm=405FE432.1010607@toetsch.at'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=59D9DAFBB46CD51184170002A513650E0A23EF01@rosnt76.ets.org'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=a06010200bc8638b16f58@[172.24.18.98]'>http://groups.google.com</a> 
    -- Dan's big(gish) post</p>

<h4><a name="UNO_(Universal_Network_Objects)_interface_for_Parrot?">UNO (Universal Network Objects) interface for Parrot?</a></h4>

<p>Tim Bunce pointed everyone at OpenOffice's Universal Network Objects and wondered if anyone had had a look to see what is needed to plug Parrot into them. And was promptly Warnocked.</p>

<p><a href='http://groups.google.com/groups?selm=20040324004749.GD26716@dansat.data-plan.com'>http://groups.google.com</a></p>

<p><a href='http://udk.openoffice.org/'>http://udk.openoffice.org/</a> -- More on UNO</p>

<h4><a name="Load_paths">Load paths</a></h4>

<p>In Perl, it's possible to write <code lang='und' xml:lang='und'>require Some::Module</code>, and Perl will go off and hunt for the appropriate file in the various directories in its <code lang='und' xml:lang='und'>@INC</code>. You can do something similar in most languages.</p>

<p>Right now, you can't do it in Parrot though; Parrot's <code lang='und' xml:lang='und'>load_bytecode</code> and other such ops take filesystem paths so, if things aren't set up exactly as the programmer expects, Bad Things can happen.</p>

<p>As Dan (and others on IRC and elsewhere I'm sure) points out, this is sub optimal. He posted an overview of the issue and a few possible ways forward and asked for comments. There were several. Mostly along the lines of 'core support for full over the net URIs for bytecode loading would be unutterably Bad'.</p>

<p><a href='http://groups.google.com/groups?selm=a06010208bc87749f2ab5@[10.0.1.2]'>http://groups.google.com</a></p>

<h4><a name="Tcl,_looking_for_a_few_good_people">Tcl, looking for a few good people</a></h4>

<p>Will Coleda's Tcl implementation has apparently reached the point where he'd appreciate assistance. He said as much on the list. If you're interested in helping getting a full Tcl implementation that targets Parrot up and running then drop him a line.</p>

<p><a href='http://groups.google.com/groups?selm=B74E9D35-7DF9-11D8-984D-000A95909DD0@coleda.com'>http://groups.google.com</a></p>

<h4><a name="Ulterior_Reference_Counting_for_DoD">Ulterior Reference Counting for DoD</a></h4>

<p>Andre Pang pointed the list at a paper on yet another Garbage Collection strategy called 'Ulterior Reference Counting' that looks potentially interesting. However, it turns out that it doesn't quite work that well with Parrot since Parrot guarantees that objects don't move around.</p>

<p><a href='http://groups.google.com/groups?selm=3F38CC08-7E1F-11D8-AC03-000A95BAC4AE@algorithm.com.au'>http://groups.google.com</a></p>

<h4><a name="Multi_Method_Dispatch_vtable_functions_in_bytecode">Multi Method Dispatch vtable functions in bytecode</a></h4>

<p>Dan announced that he'd started adding opcode support for multimethod dispatch. Leo had a bunch of questions with no answers so far.</p>

<p><a href='http://groups.google.com/groups?selm=a06010203bc88de42bcc6@[172.24.18.98]'>http://groups.google.com</a></p>

<h4><a name="So_that's_where_J&uuml;rgen's_been">So that's where J&uuml;rgen's been</a></h4>

<p>After a long absence, J&#252;rgen B&#246;mmels appeared on the list and explained that he'd got a new job, moved to a new town and had had no connection to the Internet. He's currently working through a huge backlog of mail and trying to get familiar with the current state of Parrot. It sounds like it might be a while before he starts contributing patches to ParrotIO again. Still, welcome back J&#252;rgen.</p>

<p><a href='http://groups.google.com/groups?selm=m23c7vrh9p.fsf@helium.physik.uni-kl.de'>http://groups.google.com</a></p>

<h4><a name="ParrotUnit">ParrotUnit</a></h4>

<p>Piers Cawley posted his initial version of ParrotUnit, a port of the xUnit OO testing framework. Warnock applies.</p>

<p><a href='http://groups.google.com/groups?selm=m2vfksje9m.fsf@obelisk.bofh.org.uk'>http://groups.google.com</a></p>

<h4><a name="Behaviour_of_PMCs_on_assignment">Behaviour of PMCs on assignment</a></h4>

<p>Dan noted that, right now, binary vtable functions take three arguments, the destination, the left hand side and the right hand side, which allows them to either take the type of the destination into account, or simply to replace it with a new value. The advantage of this approach is that vtable functions have the potential to be more efficient when, say, the left hand side is the same as the destination. The disadvantage is that you have to make a PMC to receive the results of the operation before you can actually do the operation, which can be a pain (and suboptimal). Dan offered 3 different options and asked for opinions.</p>

<p>TOGoS argued that the 3 argument form was actually the Wrong Thing in general and that vtable methods should simply create a new PMC and replace the destination with it. He argued that this behaviour is what most HLLs expect, and having it would make the compiler's life a great deal easier.</p>

<p><a href='http://groups.google.com/groups?selm=a0601021cbc8a43044906@[172.24.18.98]'>http://groups.google.com</a></p>

<h3><a name="Meanwhile,_in_perl6-language">Meanwhile, in perl6-language</a></h3>

<p>They talked about Unicode a good deal, but (per my announcement a few weeks back) I won't be covering those bits.</p>

<h4><a name="Outer_product_considered_useful">Outer product considered useful</a></h4>

<p>Luke Palmer proposed an <code lang='und' xml:lang='und'>outer(*@ranges)</code> function to allow for what he called 'dynamically nested loops'. He even provided an implementation for it which used a coroutine. As Simon Cozens pointed out, the fact that something as powerful as Luke's proposal can be implemented in (initially buggy) pure Perl 6 with no need for any additions to the language itself is very nice, but really more of a side issue for the time being.</p>

<p><a href='http://groups.google.com/groups?selm=20040323000731.GA21533%luke@luqui.org'>http://groups.google.com</a></p>

<h4><a name="Announcements,_Acknowledgements,_Apologies">Announcements, Acknowledgements, Apologies</a></h4>

<p>No announcements (apart from &quot;Look! ParrotUnit! It's jolly good! You should use it and send me patches!&quot;) this week. And if you think I'm apologizing...</p>

<p>If you find these summaries useful or enjoyable, please consider contributing to the Perl Foundation to help support the development of Perl. You might also like to send me feedback at <csperl file="mailmunge" arg_email="p6summarizer@bofh.org.uk">, or drop by my website, maybe I'll <i>really</i> add some content to it this week.</p>

<p><a href='http://donate.perl-foundation.org/'>http://donate.perl-foundation.org/</a> -- The Perl Foundation</p>

<p><a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> -- Perl 6 Development site</p>

<p><a href='http://www.bofh.org.uk/'>http://www.bofh.org.uk/</a> -- My website, &quot;Just a Summary&quot;</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-896" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/03/25/dictionaries.html" rel="bookmark">Making Dictionaries with Perl</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Sean M. Burke</span> on <abbr class="published" title="2004-03-25T00:00:00-08:00">March 25, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>When you woke up this morning,
the last thing you are likely to have thought is "If only I had a <i>dictionary!</i>"
But there are thousands of languages on Earth that many people want to learn,
but they can't,
because there are little or no materials to start with: no <i>Pocket Mohawk-English Dictionary</i>, no <i>Cherokee Poetry Reader</i>,
no <i>Everyday Otomi: Second Year</i>.
Only in the past few years have people realized that these languages are not just curiosities,
but are basic indispensable, untranslatable parts of local cultures -- and they're disappearing in droves.</p>

<p>As I was learning Perl,
the long arm of coincidence put me in contact with a good number of linguists who work on producing materials to help the study of these endangered languages.
These folks work on producing textbooks and other "language materials,"
which is mostly straightforward, since the 1980s gave us "desktop publishing."
But there was one real trouble spot: dictionaries.
Writing a dictionary of any real size using just a word processor is maddening,
like writing a novel on Post-Its.
So they started using database programs,
but had no way to turn this into anything you could print and call a dictionary.
They had no way to take this:</p>

<pre><code>  Headword: dagiisl&#225;ng
  Citation: HSD
  Part of speech: verb
  English: wave a piece of cloth
  Example:  D&#225;ayaangwaay hal dagiisl&#225;nggan. | He was waving a flag.</code></pre>

<p>And turn it into this:</p>

<p><img src="/pub/2004/03/25/graphics/dagislang.gif" width="416" height="52" alt="" /></p>

<p>"Well," I said and have been saying ever since, "This is no big deal, for you see, <i>I</i> am a <i>programmer</i>! Just export your database as CSV or something, email it to me, and I'll write a program that reads that and writes out a word-processor file with everything formatted all nice just like you want."</p>

<p>"A mere <i>person,</i> you, can <i>program</i> something that writes a word-processing document? But how can this <i>be?!</i> Surely this would require a year's work, a million lines of C++, and a bajillion dollars!"</p>

<p>"Yes. But instead I'll just use Perl, where I can do it in a few dozen lines of code, taking me just a few minutes." Because, you see, a conventionally formatted dictionary is just a glorified version of what people with business degrees would call a "database report", and people who work in cubicles generate such things all the time. And now I'll show you how it's done.</p>

<h3><a name="Reading_The_Input">Reading the Input</a></h3>

<p>Of course you'll need Perl, and that's not hard to come by. Then, at most, you just need a module for the input format and a module for the output format. And you don't even need that if the input and/or output formats are simple enough. In this case, the input format I'm often given is simple enough. It's called Shoebox Standard Format, and it looks like this:</p>

<pre><code>  \hw dagiisl&#225;ng
  \cit hsd
  \pos verb
  \engl wave a piece of cloth
  \ex D&#225;ayaangwaay hal dagiisl&#225;nggan. | He was waving a flag.

  \hw an&#225;a
  \cit hsd; led-285
  \pos adverb
  \engl inside a house; at home
  
  \hw s&#250;ut hlgitl'&#225;a
  \cit hsd; led-149; led-411
  \engl speak harshly to someone; insult
  \ex 'L&#225;a hal s&#250;ut hlgitl'g&#225;n. | She said harsh words to her.
  
  \hw tlak'al&#225;ang
  \cit led-398
  \pos noun
  \engl the shelter of a tree</code></pre>

<p>Namely, <code>\<i>fieldname</i> <i>fieldvalue</i></code>, each record ("entry") starting with a \hw field, and the records and fields being in no particular order. (And the data, incidentally, is vocabulary from Haida, an endangered language spoken in the Southeast Alaskan islands, where I live.)</p>

<p>Now, one could parse this with a <code>regexp</code> and a bit of <code>while(&#60;IN&#62;) {...}</code>, but there's already a module for this that will read in a whole file as a big data list-of-lists <!--(see <a href='TODO'>perllol</a>)--> data structure. After just a glance at the module's documentation, we can write this simple program to read in the lexicon as an object, and dump it to make sure that it's getting well filled in:</p>

<pre><code>  use Text::Shoebox::Lexicon;
  my $lex = Text::Shoebox::Lexicon-&#62;read_file( "haida.sf" );
  $lex-&#62;dump;</code></pre>

<p>And that prints this:</p>

<pre><code> Lexicon Text::Shoebox::Lexicon=HASH(0x15550f0) contains 4 entries:
 
 Entry Text::Shoebox::Entry=ARRAY(0x1559104) contains:
   hw = "dagiisl&#225;ng"
   cit = "hsd"
   pos = "verb"
   engl = "wave a piece of cloth"
   ex = "D&#225;ayaangwaay hal dagiisl&#225;nggan. | He was waving a flag."
 
 Entry Text::Shoebox::Entry=ARRAY(0x1559194) contains:
   hw = "an&#225;a"
   cit = "hsd; led-285"
   pos = "adverb"
   engl = "inside a house; at home"
 
 Entry Text::Shoebox::Entry=ARRAY(0x155920c) contains:
   hw = "s&#250;ut hlgitl'&#225;a"
   cit = "hsd; led-149; led-411"
   engl = "speak harshly to someone; insult"
   ex = "'L&#225;a hal s&#250;ut hlgitl'g&#225;n. | She said harsh words to her."
 
 Entry Text::Shoebox::Entry=ARRAY(0x1559284) contains:
   hw = "tlak'al&#225;ang"
   cit = "led-398"
   pos = "noun"
   engl = "the shelter of a tree"</code></pre>

<p>A further glance shows that <code>$lexicon-&#62;entries</code> returns a list of the entry objects, and that <code>$entry-&#62;as_list</code> returns the entry's contents as a list <code>(key1, value1, key2, value2)</code> -- exactly the kind of list that is ripe for dumping into a Perl hash. So:</p>

<pre><code>  foreach my $entry ($lex-&#62;entries) {
    my %e = $entry-&#62;as_list;
  }</code></pre>

<p>And that works perfectly, assuming we never have an entry like this:</p>

<pre><code>  \hw s&#250;ut hlgitl'&#225;a
  \cit hsd; led-149; led-411
  \engl speak harshly to someone
  \engl insult
  \ex 'L&#225;a hal s&#250;ut hlgitl'g&#225;n. | She said harsh words to her.</code></pre>

<p>In that case, because there's two "engl" fields, <code>$entry-&#62;as_list</code> would return this:</p>

<pre><code> (
  'hw'   =&#62; "s&#250;ut hlgitl'&#225;a",
  'cit'  =&#62; "hsd; led-149; led-411",
  'engl' =&#62; "speak harshly to someone",
  'engl' =&#62; "insult",
  'ex'   =&#62; "'L&#225;a hal s&#250;ut hlgitl'g&#225;n. | She said harsh words to her.",
 )</code></pre>

<p>And once we dump that into the hash %e, we would end up with just this:</p>

<pre><code> (
  'hw'   =&#62; "s&#250;ut hlgitl'&#225;a",
  'cit'  =&#62; "hsd; led-149; led-411",
  'engl' =&#62; "insult",
  'ex'   =&#62; "'L&#225;a hal s&#250;ut hlgitl'g&#225;n. | She said harsh words to her.",
 )</code></pre>

<p>...since, of course, hash keys have to be unique in Perl hashes. If you needed to deal with a lexicon that had such entries, there are various methods in the Text::Shoebox::Entry class, but for a simple lexicon where each field comes up just once per entry, you can just use a hash -- and you can even check that that's the case by calling with <code>$entry-&#62;assert_keys_unique;</code>, which normally does nothing -- unless it sees duplicate field names in that given entry, in which case it will abort the program and print a helpful error message about the offending entry.</p>

<p>But for our data, with its unique keys, a hash works just fine:</p>

<pre><code>  foreach my $entry ($lex-&#62;entries) {
    my %e = $entry-&#62;as_list;
  }</code></pre>

<p>We would then do things with the contents of $e in that loop: either generating output right there, or putting it into Perl variables whose contents will later be output by other subroutines of ours.</p>

<h3><a name="Making_The_Output">Making the Output</a></h3>

<csperl file="grab" domain="on" record="b/909" template="b/article_sidebar.view">

<p>Since we've got the basic input code squared away, now we get to think about how to output data. Once we know that, we'll know better how to write the code to make the formats meet in the middle.</p>

<p>As output formats go, HTML is good for many purposes; practically all
programmers can code in it pretty well, and just about everyone can hardcopy HTML with their browser or word processor. However, even after all these years, there are still some basic problems with HTML: as a typesetting language, there's still no reliable support for control of page-layout options like headers and page-numbering, page breaks, newspaper columns, and the like. More importantly, WYSIWYG HTML editors all seem to be harmless at best or disastrous at worst. In my experience, that has ruled out HTML as an output format for the many lexicons where the output file still needs various kinds of manual touching-up in a word processor.</p>

<p>Because of these problems with HTML, I have generally chosen RTF as my output format. RTF is technically a Microsoft format, but somehow, <i>somehow</i>, it avoided most of the lunacy that that usually entails. Moreover, just about every word processor supports it. And Microsoft Word both prints and edits RTF pretty much flawlessly. (After all, it had to be good at <i>something</i>.) And finally, there's good Perl support for generating RTF, via the CPAN modules RTF::Writer and RTF::Document, so you can almost completely insulate yourself from dealing directly with the language. I'll use RTF::Writer, simply because I'm more familiar with it. (This may be due to the fact that it was written by the author of the delightful O'Reilly book <i>RTF Pocket Guide</i>, a handsome and charming man whose modesty forbids him from revealing that he is me.)</p>

<p>With a bit of skimming the RTF::Writer documentation, we can see that to send output to an RTF file, you create a sort of file handle for it, and then send data to it via its <code>print</code> or <code>paragraph</code> methods, like so:</p>

<pre><code>  use RTF::Writer;
  my $rtf = RTF::Writer-&#62;new_to_file( "sample.rtf" );
  $rtf-&#62;prolog();  # sets up sane defaults

  $rtf-&#62;paragraph( "Hello world!" );
  $rtf-&#62;close;</code></pre>

<p>That writes an RTF document consisting of just a sane header and then basically the text, "Hello world!":</p>

<pre><code>  {\rtf1\ansi\deff0{\fonttbl
  {\f0 \froman Times New Roman;}}
  {\colortbl;\red255\green0\blue0;\red0\green0\blue255;}
  {\pard
  Hello world!
  \par}
  }</code></pre>

<p>The RTF::Writer documentation comes with a list of some basic escape codes that are basically all we need to format our lexicon. The notables are:</p>

<pre><code>  \b     for bold
  \i     for italic
  \f2    switch to font #2 (i.e., the second font we declare for this document)
  \fs40  switch text size to 20-point (40 = how many half-points)</code></pre>

<p>RTF::Writer's interface is designed so that normal text passed to it will get escaped before being written to the RTF output file, and clearly you don't want that to happen to these codes -- you want the <code>\b</code> to be written as is, not escaped so that it'd show a literal backslash and a literal b in the document. To signal this to the RTF::Writer interface, you pass references to these strings, like so:</p>

<pre><code>  $rtf-&#62;paragraph( \'\i', "Hello world!" );</code></pre>

<p>You can also limit the effect of a code by wrapping it in an arrayref, i.e., with <code>[<i>code, text</i>]</code>, like so:</p>

<pre><code>  $rtf-&#62;paragraph(
    "And ",
    [ \'\i', "Hello world!" ],
    " is what I say."
  );</code></pre>

<p>That'll produce a document saying: And <i>Hello world!</i> is what I say.</p>

<p>That's just about all the RTF we'd need to know to produce some simple lexicon output. We can exercise this with some literal text:</p>

<pre><code>  use RTF::Writer;
  my $rtf = RTF::Writer-&#62;new_to_file( "lex.rtf" );
  $rtf-&#62;prolog();  # sets up sane defaults

  $rtf-&#62;paragraph(
    [ \'\b',    "tlak'al&#225;ang: " ],
    [ \'\b\i',  "n." ],
    " the shelter of a tree"
  );
  $rtf-&#62;paragraph(
    [ \'\b',    "an&#225;a: " ],
    [ \'\b\i',  "adv." ],
    " inside a house; at home"
  );

  $rtf-&#62;close;</code></pre>

<p>And that gets us something very close to the kind of formatting you'd find in a typical fancy dictionary:</p>

<p><img src="/pub/2004/03/25/graphics/two_entries.gif" width="481" height="69" alt="" /></p>

<p>Of course, we'd like to tweak spacing and fonts a bit, but that can be left for later as just minor additions to the code. Knowing just as much as we do now, we can see the output code taking shape. It would be something like:</p>

<pre><code>  foreach my $entry (...) {
    ...
    $rtf-&#62;paragraph(
      [ \'\b',    $headword, ": " ],
      [ \'\b\i',  $part_of_speech ],
      " ", $english,
      ...and something to drop the example sentences, if any...
    );
  }</code></pre>

<p>In fact, we can already cobble this together with our earlier input-reading code, to make a clunky but working prototype:</p>

<pre><code>  use strict;
  use Text::Shoebox::Lexicon;
  my $lex = Text::Shoebox::Lexicon-&#62;read_file( "haida.sf" );

  use RTF::Writer;
  my $rtf = RTF::Writer-&#62;new_to_file( "lex.rtf" );
  $rtf-&#62;prolog();  # sets up sane defaults

  foreach my $entry ($lex-&#62;entries) {
    my %e = $entry-&#62;as_list;
    $rtf-&#62;paragraph(
      [ \'\b',    $e{'hw'}  || "?hw?", ": " ],
      [ \'\b\i',  $e{'pos'} || "?pos?" ],
      " ", $e{'engl'} || "?english?"
    );
  }
  $rtf-&#62;close;</code></pre>

<p>And that produces this:</p>

<p><img src="/pub/2004/03/25/graphics/four_entries.gif" width="486" height="103" alt="" /></p>

<p>Now, sure, the entries aren't in alphabetical order, we see "noun" instead of "n.", and the example sentences aren't in there yet. But consider that with not even twenty lines of Perl, we've got a working dictionary renderer. It's downhill from here.</p>














<h3><a name="Sorting_and_Duplicate_Headwords">Sorting and Duplicate Headwords</a></h3>

<p>So how do we take entries in whatever order, and put them into alphabetical order? A first hack is something like this:</p>

<pre><code>  my %headword2entry;
  foreach my $entry ($lex-&#62;entries) {
    my %e = $entry-&#62;as_list;
    $headword2entry{ $e{'hw'} } = \%e;
  }
  
  foreach my $headword (sort keys %headword2entry) {
    my %e = %{ $headword2entry{$headword} };
    ...and print it here...
  }</code></pre>

<p>And that indeed works fine. But suppose one of the linguists comes by and adds these three entries into our little database:</p>

<pre><code>  \hw g&#237;i
  \pos auxiliary verb
  \engl already; always; often
  
  \hw gu
  \pos postposition
  \engl there
  
  \hw g&#237;i
  \pos verb
  \engl swim away [of fish]</code></pre>

<p>When we run our program, there's trouble with the output:</p>

<p><img src="/pub/2004/03/25/graphics/six_entries_sorted1.gif" width="487" height="153" alt="" /></p>

<p>First off, the second "g&#237;i" (the verb for fish swimming away) was stored as <code>$headword2entry{'g&#237;i'}</code> and that overwrote the first "g&#237;i" entry (the one that means already, always, or often). And secondly, "g&#237;i" got sorted <i>after</i> "gu"!</p>

<p>The first problem can be solved by changing from the current data structure, which is like this:</p>

<pre><code>  $headword2entry{ 'g&#237;i' } = ...one_entry...;</code></pre>

<p>over to a new data structure, which is like this:</p>

<pre><code>  $headword2entries{ 'g&#237;i' } =
    [ ...one_entry... , ...another_entry..., ...maybe_even_another... ];</code></pre>

<p>...even though in most cases that list will hold just one entry.</p>

<p>That's simple to graft into our program, even if the syntax for dereferencing gets a bit thick:</p>

<pre><code>  my %headword2entries;
  foreach my $entry ($lex-&#62;entries) {
    my %e = $entry-&#62;as_list;
    push @{ $headword2entries{ $e{'hw'} } },  \%e;
  }
  
  foreach my $headword (sort keys %headword2entries) {
    foreach my $entry ( @{ $headword2entries{$headword} } ) {
      ...code to print the entry...
    }
  }</code></pre>

<p>And that works just right: both "g&#237;i" entries show up.</p>

<p>Now how to get <code>sort keys %headword2entries</code> to sort "g&#237;i" <i>before</i> "gu"? The default <code>sort()</code> that Perl uses just sorts ASCIIbetically, where "&#237;" comes not just after "u", but actually after all the unaccented letters. We can get Perl to use a smarter <code>sort()</code> if we add a "use locale;" line and see about changing our current locale to French or German or something that'd know that "&#237;" sorts before "u". This approach works in some cases, but suppose that you're dealing with a language that uses "dh" as a combined letter that comes after "d". You'd be out of luck, since there aren't any existing locales that (as far as I know) that have "dh" as a letter after "d", and since under most operating systems you can't define you own locales.</p>

<p>But CPAN, once again, comes to the rescue. The CPAN module Sort::ArbBiLex lets you state a sort order and get back a function that sorts according to that order. We can just pull this example from the docs:</p>

<pre><code>  use Sort::ArbBiLex (
    'custom_sort' =&#62;    # that's the function name to define
    "
     a A &#224; &#192; &#225; &#193; &#226; &#194; &#227; &#195; &#228; &#196; &#229; &#197; &#230; &#198;
     b B
     c C &#231; &#199;
     d D &#240; &#208;
     e E &#232; &#200; &#233; &#201; &#234; &#202; &#235; &#203;
     f F
     g G
     h H
     i I &#236; &#204; &#237; &#205; &#238; &#206; &#239; &#207;
     j J
     k K
     l L
     m M
     n N &#241; &#209;
     o O &#242; &#210; &#243; &#211; &#244; &#212; &#245; &#213; &#246; &#214; &#248; &#216;
     p P
     q Q
     r R
     s S &#223;
     t T &#254; &#222;
     u U &#249; &#217; &#250; &#218; &#251; &#219; &#252; &#220;
     v V
     w W
     x X
     y Y &#253; &#221; &#255;
     z Z
    "
  );</code></pre>

<p>And if we need that "dh" to be a new letter between "d" and "e", it's a simple matter of adding a line to the above code:</p>

<pre><code>     ...
     d D &#240; &#208;
     dh Dh
     e E &#232; &#200; &#233; &#201; &#234; &#202; &#235; &#203;
     ...</code></pre>

<p>And if the above sort order isn't right, we can fix this by just moving things around. For example, a few Haida words use an x-circumflex character for an odd pharyngeal sound, and since that character isn't in Latin-1, the folks working on Haida use a special font that replaces the Latin-1 &#254; character with the x-circumflex. To have that sort as a letter after x, we'd rearrange the end of the above sort-order to read like this:</p>

<pre><code>     ...
     t T
     u U &#249; &#217; &#250; &#218; &#251; &#219; &#252; &#220;
     v V
     w W
     x X
     &#254; &#222;
     y Y &#253; &#221; &#255;
     z Z</code></pre>

<p>Once we get the big <code>use Sort::ArbBiLex (...);</code> statement set up just the way we like it, we can just replace the "sort" in our "sort keys" with "custom_sort", like so:</p>

<pre><code>  foreach my $headword (custom_sort keys %headword2entries) {
    foreach my $entry ( @{ $headword2entries{$headword} } ) {
      ...code to print the entry...
    }
  }</code></pre>

<p>With that in place, our entries sort just right:</p>

<p><img src="/pub/2004/03/25/graphics/seven_entries_sorted1.gif" width="485" height="173" alt="" /></p>

<h3><a name="Reverse_Indexing">Reverse Indexing</a></h3>

<p>The last thing anyone wants to do when they've finished working on a dictionary, is to turn right around and write another one -- but that's exactly the problem that comes up in lexicography: you've been compiling a Haida-to-English dictionary, and then someone says "Gee, it'd be really handy to have an English-to-Haida one, too!"</p>

<p>In the bad old days before people used databases for their lexicons, this process of "reversing the dictionary" was manual. Now that we have databases, we just need a way to see the entry that expresses "gu" = "there" in our main lexicon, and then make an entry in a reverse lexicon that expresses "there" = "gu".</p>

<p>The reverse lexicon could be just <code>%english2native</code> with entries like:</p>

<pre><code>  $english2native{'there'} = "gu";</code></pre>

<p>But there could be several words that mean "there" -- like "gyaasd&#225;an" -- so we'd have to use an array here, just as we did in <code>%headword2entries</code>, like this:</p>

<pre><code>  $english2native{'there'} = [ "gu", "gyaasd&#225;an" ];</code></pre>

<p>We can implement this by changing our initial lexicon-scanning routine to add a line to push to <code>@{$english2native{<i>each_english_bit</i>}}</code>, like so:</p>

<pre><code>  foreach my $entry ($lex-&#62;entries) {
    my %e = $entry-&#62;as_list;
    push @{ $headword2entries{ $e{'hw'} } },  \%e;
    foreach my $engl ( reversables( $e{'engl'} ) ) {
      push @{ $english2native{ $engl } }, $e{'hw'}
    }
  }</code></pre>

<p>And later on, we can spit out the contents of <code>%english2native</code> after the main dictionary:</p>

<pre><code>  $rtf-&#62;paragraph( "\n\nEnglish to Haida Index\n" );

  foreach my $engl ( custom_sort keys %english2native) {
    my $n = join "; ", custom_sort @{ $english2native{ $engl } };
    $rtf-&#62;paragraph( "$engl: $n" );
  }</code></pre>

<p>All we need now is a routine, <code>reversables()</code>, that can take the string "already; always; often" (from the <i>g&#237;i</i> entry) and turn it into the list ("already," "always," "often"), and to take the string "the shelter of a tree" and turn it into the one-item list <code>("shelter of a tree")</code>. (If we left the "the" on there, we'd have a huge bunch of entries under "the"!)</p>

<p>This function is a decent first hack:</p>

<pre><code>  sub reversables {
    my $in = shift || return();
    my @english;
    foreach my $term ( split /\s*;\s*/, $in ) {
      $term =~ s/^(a|an|the|to)\s+//i;
       # Take the "to" off of "to swim away [of fish]",
       # and the "the" off of "the shelter of a tree"
      push @english, $term;
    }
    return @english;
  }</code></pre>

<p>However, consider the entry <b>an&#225;a:</b> "inside a house; at home" -- our <code>reversables()</code> function will return this as the list <code>("inside a house", "at home")</code>. That seems passable, but if I were looking for a word like this in the English end of the dictionary, I'd probably want it to be under "home" and "house" as well.</p>

<p>Now, there are four alternatives here for how to have finer control over the reversing:</p>

<dl>
<dt><a
>Just don't bother, and instead just do this all manually in the editing of the final draft.</a></dt>

<dd>This is a bad approach because, in my experience, the people working on the lexicon get so used to the just-passable reversing algorithm that they end up thinking it's no big deal, and so in the end its effects never get fixed.</dd>

<dt>Don't do automatic reversing, but have a mandatory field in each entry that says what English headword(s) should point to this native entry.</a></dt>

<dd>For example, if we call the field "ehw" (for "English headword"), then for "at home; inside a house" could say something like: "\ehw home, at; house, inside a". However, having this be mandatory is a real drag for simple entries like "gu," where you'd have to do:

<pre><code>        \hw gu
        \engl there
        \ehw there</code></pre>
</dd>
<dt><a name="*_Make_an_"ehw"_field_optional,_and_when_it's_absent,_use_a_smart_reversing_algorithm.">* Make an "ehw" field optional, and when it's absent, use a smart reversing algorithm.</a></dt>

<dd>So when we have an entry like "\hw gu \engl there", of course the reversing algorithm would know to infer a "\ehw there." And it would somehow be smart enough to know to index "wave a piece of cloth" under "wave" and "cloth" but not under "a," "piece," or "of." The problem with very smart fallback algorithms like this is that people have to understand them completely, so that they can know whether the result is good enough or whether it should be overridden with a default "\ehw" field. But since nobody can remember all the hacks that get built into the smart algorithm, they either err on the side of doubt by <i>always</i> putting a "\ehw" field (thus making the whole algorithm pointless), or by <i>never</i> putting a "\ehw" field, or, worse some unpredictable and headachy mix of the two. So ironically, a smart fallback algorithm is often a <i>bad</i> idea. That leads us to the final alternative:</dd>

<dt><a name="*_Make_an_"ehw"_field_optional,_and_when_it's_absent,_use_a_dumb_reversing_algorithm.">* Make an "ehw" field optional, and when it's absent, use a <i>dumb</i> reversing algorithm.</a></dt>

<dd>By "dumb," I mean a maximum of two rules -- if it's any more complex than that, people will forget how it works and won't know when they should key in an explicit "\ehw" field.</dd>
</dl>

<p>So while we could add more and more things to our <code>reversables()</code> algorithm, it seems wisest to refrain from doing this, to be content with our one <i>s/^(a|an|the|to)\s+//i</i> rule, and instead just add support for an "\ehw" field. We can do that simply by changing the call to <code>reversables()</code>, from this:</p>

<pre><code>    foreach my $engl ( reversables( $e{'engl'} ) ) {
      push @{ $english2native{ $engl } }, $e{'hw'}
    }</code></pre>

<p>to this:</p>

<pre><code>    my @reversed = $e{'ehw'} ? split( m/\s*;\s*/, $e{'ehw'} )
                             : reversables( $e{'engl'} );
    foreach my $engl ( @reversed ) {
      push @{ $english2native{ $engl } }, $e{'hw'}
    }</code></pre>

<p>With that in place (and with a "\ehw home, at; house, inside a" line in the "an&#225;a" entry just to get the ball rolling), our program runs and spits out an English index after the Haida dictionary:</p>

<p><img src="/pub/2004/03/25/graphics/reversed_index.gif" width="347" height="318" alt="" /></p>













<h3><a name="Conditional_Output,_and_Example_Sentences">Conditional Output and Example Sentences</a></h3>

<p>There's two optional parts of the entries that we haven't used yet: the citation fields, like "\cit hsd; led-149; led-411", and the example sentences field, like "\ex 'L&#225;a hal s&#250;ut hlgitl'g&#225;n. | She said harsh words to her.". The citation fields are typically only of importance to the editors, who might want to spot-check words against the places in the text where they were found. (And typically the editors are the only ones who would be fluent with the abbreviations, e.g., would know that "led-149" is short for "page 149 of the Leer-Edenso Dictionary of Haida".)</p>

<p>Ideally our program should produce output for the editors with the citations, and output for normal users (without the citations). We can do this my having a <code>$For_Editors</code> variable that's set early on in the program:</p>

<pre><code>  my $For_Editors = 0; # set to 1 to add citations</code></pre>

<p>And then later on we have code that uses that variable:</p>

<pre><code>  foreach my $headword ( custom_sort keys %headword2entries) {
    foreach my $entry ( @{ $headword2entries{$headword} } ) {
      print_entry( $entry );
    }
  }

  sub print_entry {
    my %e = %{$_[0]};
    $rtf-&#62;paragraph(
      [ \'\b',    $e{'hw'}  || "?hw?", ": " ],
      [ \'\b\i',  $e{'pos'} || "?pos?" ],
      " ", $e{'engl'} || "?english?", ".", 
      $For_Editors &#38;&#38; $e{'cit'} ? " [$e{'cit'}]" : (),
    );
  }</code></pre>

<p>Our new and punctuation-rich <code>$For_Editors &#38;&#38;
$e{'cit'}</code> line is just a concise way of saying "if this is for
the editors and if there's a citation in this entry, then print a space
and a bracket before it, and a bracket after it -- otherwise don't add
anything".</p>

<p>Our example sentences ("\ex 'L&#225;a hal s&#250;ut hlgitl'g&#225;n. | She said harsh words to her".) should probably end up in any normal dictionary, but of course we wouldn't want to try adding the contents of <code>$e{'ex'}</code> with formatting codes around it if it weren't actually present in this entry. We can use the same sort of <code>$value ? "...$value..." : ()</code> idiom we used before -- except that this time we need to first take out the "|" that separates the Haida part from the English translation. That's simple, though:</p>

<pre><code>    my($ex, $ex_eng);
    ($ex, $ex_eng) = split m/\|/, $e{'ex'} if $e{'ex'};
    $rtf-&#62;paragraph(
      ...
      $ex_eng ? (" $ex = $ex_eng") : (),
    );</code></pre>

<p>With that code in place, our entries that have example sentences, show them, like this:</p>

<p><img src="/pub/2004/03/25/graphics/suut.gif" width="479" height="50" alt="" /></p>

<h3><a name="Fancier_Formatting">Fancier Formatting</a></h3>

<p>Now that basically everything else about our program is working, how about we polish it off with some formatting codes to make it look just right. We've already got some simple bold and italic codes, so the next thing is certainly to use different fonts. We could use, say, Bookman for the main headword and Times for the rest of the entry -- except for in the example sentence, we can use Bookman again for the Haida text, and Arial for the English translation.</p>

<p>However, a glance at the RTF Pocket Guide shows no RTF code that means "change to the font 'Arial'" -- just a code that means "change to font number N [i.e., the second font we declare for this document]", This declaring is just a matter of adding a parameter <code>'fonts' =</code> [ ...<i>font names</i>...],&#62; to that dull <code>$rtf-&#62;prolog()</code> method we called back when we created <code>$rtf</code>. As the RTF::Writer documentation notes, "You should be sure to declare all fonts that you switch to in your document (as with \'\f3', to change the current font to what's declared in entry 3 (counting from 0) in the font table)." So if we just change our <code>prolog</code> call to this...</p>

<pre><code>  $rtf-&#62;prolog( 'fonts' =&#62; [ "Times New Roman", "Bookman", "Arial" ] );</code></pre>

<p>... Then we can use a <code>\f0</code> to switch to Times New Roman (which is the default, incidentally, since it's the first declared font), and <code>\f1</code> to switch to Bookman, and <code>\f2</code> to switch to Arial.</p>

<p>And suppose we want everything to be in 10-point, except for the Arial part, which we want in specifically 9-point Arial so it won't steal attention from the rest of the text, as sans-serif fonts often do. That's just a matter of a <code>\fs20</code> and <code>\fs18</code> code -- "fs" for "font size", plus the desired font size, in <i>half-</i>points. (Odd, I know.)</p>

<p>With these extra codes in place, our <code>print_entry</code> routine now looks like this:</p>

<pre><code>  sub print_entry {
    my %e = %{$_[0]};
    my($ex, $ex_eng);
    ($ex, $ex_eng) = split m/\|/, $e{'ex'} if $e{'ex'};
    $rtf-&#62;paragraph(  \'\fs20',  # Start out in ten-point
      [ \'\f1\b', $e{'hw'}  || "?hw?", ": " ],
      [ \'\b\i',  $e{'pos'} || "?pos?" ],
      " ", $e{'engl'} || "?english?", ".", 
      $For_Editors &#38;&#38; $e{'cit'} ? " [$e{'cit'}]" : (),
      $ex_eng ? (" ", \'\f1', $ex, \'\f2\fs18', $ex_eng) : (),
    );
  }</code></pre>

<p>It's dense, but then it does a lot of work! And that work comes out looking like this:</p>

<p><img src="/pub/2004/03/25/graphics/all_pretty2.gif" width="479" height="218" alt="" /></p>

<p>As to adding fancier formatting, this is usually best done by just flipping through the <i>RTF Pocket Guide</i> and looking for a mention of the effect you want. For example, in a lexicon we might be particularly interested in hanging indents (<code>\fi-300</code>), two-column pages (<code>\col2</code>), and page numbering (<code>{\header \pard\ql\plain p.\chpgn \par}</code>).</p>

<p>Now suppose that you're trying to make the most of your xeroxing budget, trading off nice large readable point size against how many people get copies. One way to squeeze as much content into as small a space is to use abbreviations for the most repeated text in the dictionary -- the part-of-speech tags. So we can turn "noun" into just "n.", "verb" into "v.", and so on. Each time, we save only a little space, but it adds up quick. And doing this (or at least trying it out to see how it looks) is straightforward. We need only change one line in <code>print_entry()</code>, from this</p>

<pre><code>      [ \'\b\i',  $e{'pos'} || "?pos?" ],</code></pre>

<p>To this:</p>

<pre><code>      [ \'\b\i',  $Abbrev{$e{'pos'}||''} || $e{'pos'} || "?pos?" ],</code></pre>

<p>And earlier we'll have to define what should be in <code>%Abbrev</code>:</p>

<pre><code>  my %Abbrev = (
   'auxiliary verb' =&#62; 'aux.',
   qw(noun n. verb v. adverb adv.),
  );</code></pre>

<p>But that's all it takes to change our output to look like this:</p>

<p><img src="/pub/2004/03/25/graphics/all_pretty3.gif" width="462" height="216" alt="" /></p>

<p>That continues to print "?pos?" when an entry is erroneously missing the part-of-speech field. And it doesn't abbreviate the term "postposition". (If we did so, it'd probably be "pp.", which people would probably think was "participle" or something.) But the most common terms, "noun" and "verb", got shrunk down, saving a few characters per entry, which could add up to a dozen pages in a large printout.</p>

<h3><a name="Other_Formats">Other Formats</a></h3>

<p>I've just been talking about producing conventionally formatted dictionaries, but the same database and the same kinds of Perl could be used to instead produce different output formats. Use a bit of fancy page layout and a double-sided printer (or copier) and the same data can be turned into readymade flashcards. Or if you have a subject field in entries (like "plant", "color", "body part", "food"), it's easy to re-sort entries by topic, and produce a "topical dictionary", which language teachers find very useful in planning classroom exercises.</p>

<h3><a name="World_Enough_and_Time">World Enough and Time</a></h3>

<p>As A. N. Whitehead's famous quote goes, "Civilization advances by extending the number of important operations which we can perform without thinking about them. Operations of thought are like cavalry charges in a battle - they are strictly limited in number, they require fresh horses, and must only be made at decisive moments." I've found this to be personally and critically true in dealing with endangered languages: it takes man-years of time to produce a dictionary of any useful size, both on the part of linguists and of members of the community. And with most of North America's native languages, the most fluent speakers are over 65, so there's no great surplus of man-years.</p>

<p>Whitehead was more right than he knew: saving time and effort doesn't just advance civilizations, it can help save them.</p>

<p>So when Perl helps us glue together a database program, a printer, and a word processor so that the typesetting phase of a dictionary takes not months, but minutes, this frees up the linguists and teachers and elders to spend scarce time and "decisive moments" working on preserving the language through study and teaching. We need every minute to work on revitalizing these languages that are the foundation of endangered cultures and civilizations -- with all their stories, poems, songs, sayings, proverbs, figures of speech, jokes, liturgy, and heaps of specialized jargon from botany and agriculture and healing and just plain ways of relating to people and the world, very little of which would survive mere translation to English.</p>

<p>We're in a hurry, and so we really appreciate Perl.</p>

<h4><a name="Finished_Code_for_Sample_Haida_Dictionary">Finished Code for Sample Haida Dictionary</a></h4>

<pre><code>  use strict;
  use warnings;

  my $For_Editors = 0; # set to 1 to add citations

  use RTF::Writer;
  use Text::Shoebox::Lexicon;
  my $lex = Text::Shoebox::Lexicon-&#62;read_file( "haida.sf" );

  my $rtf = RTF::Writer-&#62;new_to_file( "lex.rtf" );
  $rtf-&#62;prolog( 'fonts' =&#62; [ "Times New Roman", "Bookman", "Arial" ] );

  use Sort::ArbBiLex (
    'custom_sort' =&#62;
    "
     a A &#224; &#192; &#225; &#193; &#226; &#194; &#227; &#195; &#228; &#196; &#229; &#197; &#230; &#198;
     b B
     c C &#231; &#199;
     d D &#240; &#208;
     e E &#232; &#200; &#233; &#201; &#234; &#202; &#235; &#203;
     f F
     g G
     h H
     i I &#236; &#204; &#237; &#205; &#238; &#206; &#239; &#207;
     j J
     k K
     l L
     m M
     n N &#241; &#209;
     o O &#242; &#210; &#243; &#211; &#244; &#212; &#245; &#213; &#246; &#214; &#248; &#216;
     p P
     q Q
     r R
     s S &#223;
     t T &#254; &#222;
     u U &#249; &#217; &#250; &#218; &#251; &#219; &#252; &#220;
     v V
     w W
     x X
     y Y &#253; &#221; &#255;
     z Z
    "
  );
  my %headword2entries;
  my %english2native;

  my %Abbrev = (
   'auxiliary verb' =&#62; 'aux.',
   qw(noun n. verb v. adverb adv.),
  );

  foreach my $entry ($lex-&#62;entries) {
    my(%e) = $entry-&#62;as_list;
    push @{ $headword2entries{ $e{'hw'} } },  \%e;
    my @reversed = $e{'ehw'} ? split( m/\s*;\s*/, $e{'ehw'} )
                             : reversables( $e{'engl'} );
    foreach my $engl ( @reversed ) {
      push @{ $english2native{ $engl } }, $e{'hw'}
    }
  }

  $rtf-&#62;paragraph( "Haida to English Dictionary\n\n" );

  foreach my $headword ( custom_sort keys %headword2entries) {
    foreach my $entry ( @{ $headword2entries{$headword} } ) {
      print_entry( $entry );
    }
  }

  $rtf-&#62;paragraph( "\n\nEnglish to Haida Index\n" );

  foreach my $engl ( custom_sort keys %english2native) {
    my $native = join "; ", custom_sort @{ $english2native{ $engl } };
    $rtf-&#62;paragraph( "$engl: $native" );
  }

  $rtf-&#62;close;
  exit;


  sub reversables {
    my $in = shift || return;
    my @english;
    foreach my $term ( grep $_, split /\s*;\s*/, $in ) {
      $term =~ s/^(a|an|the|to)\s+//;
      push @english, $term;
    }
    return @english;
  }


  sub print_entry {
    my %e = %{$_[0]};
    my($ex, $ex_eng);
    ($ex, $ex_eng) = split m/\|/, $e{'ex'} if $e{'ex'};
    $rtf-&#62;paragraph(  \'\fs20',  # Start out in ten-point
      [ \'\f1\b', $e{'hw'}  || "?hw?", ": " ],
      [ \'\b\i',  $Abbrev{$e{'pos'}||''} || $e{'pos'} || "?pos?" ],
      " ", $e{'engl'} || "?english?", ".", 
      $For_Editors &#38;&#38; $e{'cit'} ? " [$e{'cit'}]" : (),
      $ex_eng ? (" ", \'\f1', $ex, \'\f2\fs18', $ex_eng) : (),
    );
  }</code></pre>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-902" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/03/p6pdigest/20040321.html" rel="bookmark">This week on Perl 6, week ending 2004-03-21</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-03-21T00:00:00-08:00">March 21, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Spring is sprung,
the Equinoctal gales seem to have blown themselves out,
I&#39;m a proud step grandfather and life is generally grand.</p>

<p>&#34;So,
what&#39;s been going on in perl6&#45;internals?&#34; I hear you ask.
Let&#39;s find out shall we?</p>

<h4><a name="Parrot_grabs_SIGINT">Parrot grabs SIGINT</a></h4>

<p>It appears that embedded Parrot tries to do too much.
In particular,
it grabs signals that its embedder may not want it to deal with.
Dan declared that at some point Parrot would have to treat signals as something the embedding environment controls (And the standalone Parrot interpreter becomes just another place where the Parrot core is embedded).</p>

<p><a href='http://groups.google.com/groups?selm=609A6A46&#45;7420&#45;11D8&#45;8D57&#45;000A95A2734C@fotango.com'>http://groups.google.com</a></p>

<h4><a name="Unprefixed_global_symbols">Unprefixed global symbols</a></h4>

<p>Unhygenic namespaces are bad,
mm&#39;kay?</p>

<p>Mitchell N Charity posted the results of doing</p>

<pre><code>    $ nm ./blib/lib/libparrot.a | egrep &#39; [TDRC] |\.o:&#39; | grep &#45;v
    Parrot_</code></pre>

<p>and the results are rather embarrassing. Parrot exports a bunch of symbols that have no Parrot specific prefix, and which have the potential to clash with symbols that the embedder is using for something else. Arthur Bergman agreed that doing something about this would be a jolly good idea and proposed prefixing all externally visible macros, types and functions with <code>Parrot_</code>.</p>

<p>There followed some discussion of the prefices that are currently in use within Parrot (there are several); Arthur pointed out that many of them are still worryingly generic and proposed expanding most of the &#39;P&#39;s in them to a full &#39;Parrot&#39;. Jeff Clites suggested that it would be a good idea to get the linker to only expose external entry points in the first place, though there are issues of cross platform compatibility to deal with in order to implement that. Dan announced that, despite the potential pain, this would be the way forward.</p>

<p><a href='http://groups.google.com/groups?selm=200403141711.i2EHBcN09607@vendian.org'>http://groups.google.com</a></p>

<h4><a name="FAQs?">FAQs?</a></h4>
<csperl file="grab" domain="on" record="b/940" template="b/article_sidebar.view">
<p>Tim Bunce wondered if anyone was tracking the mailing list and adding questions and (good) answers to the FAQ. Apparently, chromatic has taken this job upon himself, but he confessed that he hadn&#39;t actually been doing recently. He&#39;s on it though.</p>

<p><a href='http://groups.google.com/groups?selm=20040315122604.GA6170@dansat.data&#45;plan.com'>http://groups.google.com</a></p>

<h4><a name="What_does_&#45;0.0_mean_to_you?">What does <code>&#45;0.0</code> mean to you?</a></h4>

<p>Mitchell N Charity pointed out that PerlNum didn&#39;t appear to retaining the sign of zero. (Which, frankly, does my head in every time I think about it; minus zero? What&#39;s that then?). Apparently retaining the sign is the Right Thing and, when Mitchell pointed it out, PerlNums were doing the intuitive thing (zero is zero is zero, and the sign&#39;s irrelevant). It&#39;s what the floating point standard mandates though, so things were changed.</p>

<p><a href='http://groups.google.com/groups?selm=200403151648.i2FGm5A04234@vendian.org'>http://groups.google.com</a></p>

<h4><a name="GC_issues">GC issues</a></h4>

<p>Jens Rieks continues to stress the object stuff (he&#39;s working on writing an EBNF parser). He posted a test to the list that led Leo T&#246;tsch to find and fix 3 bugs in the Garbage Collector&#39;s DOD phase.</p>

<p><a href='http://groups.google.com/groups?selm=200403151937.19883.parrot@jensbeimsurfen.de'>http://groups.google.com</a></p>

<h4><a name="Will&#39;s_questions">Will&#39;s questions</a></h4>

<p>Will Coleda, who&#39;s working on implementing Tcl for Parrot had a few questions. My particular favourite one was &#34;Unicode?&#34;, which seems to echo a lot of people&#39;s feelings on that particular issue.</p>

<p>Leo answered his questions (the answer to the Unicode one being &#34;Needs a lot of work still.&#34;).</p>

<p>In the thread that followed, Gay, Jerry (Or should that be Jerry Gay? What&#39;s a Summarizer to do eh?) wondered why you wrote <code>store_global &#34;global&#34;, Pn</code>, but <code>find_global Pn, &#34;global&#34;</code>, which he thought was inconsistent. My rule of thumb for this is that the target always comes first on the opcode argument list. Jens Rieks pointed out that opcode arguments are always ordered so that any <code>OUT</code> arguments come first.</p>

<p><a href='http://groups.google.com/groups?selm=915CEC7F&#45;7707&#45;11D8&#45;A312&#45;000A95909DD0@coleda.com'>http://groups.google.com</a></p>

<h4><a name="New_Tcl_release">New Tcl release</a></h4>

<p>Will Coleda announced the latest version of his Tcl interpreter. Judging by the Changelog extract he posted, things are looking very good. You&#39;ll find it in the latest Parrots from CVS.</p>

<p><a href='http://groups.google.com/groups?selm=2ED6F516&#45;76F4&#45;11D8&#45;A312&#45;000A95909DD0@coleda.com'>http://groups.google.com</a></p>

<h4><a name="Classes_and_metaclasses">Classes and metaclasses</a></h4>

<p>Larry, Dan and chromatic had a discussion about what&#39;s responsible for dispatch and whether Roles are inherited or acquired by some other means. It got rather philosophical (I like philosophy). Dan got the last word.</p>

<p><a href='http://groups.google.com/groups?selm=20040316035325.GA4008@wall.org'>http://groups.google.com</a></p>

<h4><a name="Numeric_weirdness">Numeric weirdness</a></h4>

<p>Simon Glover found a bug in Parrot&#39;s string&#45;&#62;number handling. It turns out that the route from <code>&#45;1.2</code> to a number is different to that from <code>&#34;&#45;1.2&#34;</code> to a number. Which means that the two resulting numbers don&#39;t have the same value. Which is bad.</p>

<p>It turned out to be down to hysterical reasons from when IMCC just generated parrot assembly and then called parrot to do the actual execution; then parrot would use the same string conversion routines at compile and run time.</p>

<p>Leo fixed it.</p>

<p><a href='http://groups.google.com/groups?selm=rt&#45;3.0.8&#45;27690&#45;82131.12.435030891164@perl.org'>http://groups.google.com</a></p>

<h4><a name="Configure.pl_and_the_history_of_the_world">Configure.pl and the history of the world</a></h4>

<p>Dan pointed out that, as the Ponie work goes on, integrating Parrot with Perl 5, we need to get the embedding interface fixed up so that it plays well with others.</p>

<p>He was also concerned that we seemed to be reinventing perl&#39;s <em lang='und' xml:lang='und'>Configure.SH</em> in a horribly piecemeal fashion and suggested that we should just dig all the stuff out in one swell foop. Larry pointed everyone at metaconfig and discussion ensued.</p>

<p>Quite how metaconfig sits with the <em lang='und' xml:lang='und'>miniparrot</em> based configuration/build plan that Dan&#39;s talked about was left as an exercise for the interested reader.</p>

<p><a href='http://groups.google.com/groups?selm=a0601020bbc7d3b29374b@[10.0.1.2]'>http://groups.google.com</a></p>

<h4><a name="Method_caching">Method caching</a></h4>

<p>Work continued on making objects more efficient. The object PMC had a good deal of fat/indirection removed, and work started on implementing a method cache. Dan reckoned that the two most useful avenues for exploration were method caching and thunked vtable lookups.</p>

<p>Zellyn Hunter suggested people take a look at papers on Smalltalk&#39;s dispatch system by Googling for [smalltalk cache].</p>

<p>Mitchell N Charity suggested a couple of possible optimizations (and benchmarks to see if they&#39;re worth trying).</p>

<p>There was some discussion of the costs of creating return continuations. (My personal view is that the current continuation and stacks implementation isn&#39;t the Right Thing, but I don&#39;t have the C skills to implement what I perceive to be the Right Thing. Which sucks.)</p>

<p>Leo reckons that, with a method cache and continuation recycling, he&#39;s seeing a 300% improvement in speed on the object oriented Fibonacci benchmark.</p>

<p><a href='http://groups.google.com/groups?selm=a06010208bc7e332acc5c@[10.0.1.2]'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=a06010206bc7e29eca1e5@[10.0.1.2]'>http://groups.google.com</a></p>

<h4><a name="ICU_incorporation">ICU incorporation</a></h4>

<p>Jeff Clites gave everyone a heads up about the work he&#39;s doing on a patch to incorporate the use of ICU (the Unicode library Parrot will be using) and some changes to our internal representation of strings. Apparently the changes give us a simpler and faster internal representation, which can&#39;t be bad.</p>

<p><a href='http://groups.google.com/groups?selm=FB17458A&#45;783C&#45;11D8&#45;8121&#45;000393A6B9DA@mac.com'>http://groups.google.com</a></p>

<h4><a name="Continuation_usage">Continuation usage</a></h4>

<p>Jens Rieks and Piers Cawley both had problems with continuations. Leo T&#246;tsch tried explain what they were doing wrong. There seemed to be a fair amount of talking past each other going on (at least, that&#39;s how it felt from my point of view) but I think communication has been established now. Hopefully this will lead to a better set of tests for continuation usage and a better understanding of what they&#39;re for and how to use them.</p>

<p><a href='http://groups.google.com/groups?selm=200403181844.29274.parrot@jensbeimsurfen.de'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=m2znaata3d.fsf@obelisk.bofh.org.uk'>http://groups.google.com</a></p>

<h4><a name="Optimization_in_context">Optimization in context</a></h4>

<p>Mitchell Charity argued that we should think carefully before doing too much more optimization of Parrot until we&#39;ve got stuff working correctly. Leo agreed, up to a point, but pointed out that optimizing for speed is lot of fun. Brent Royal&#45;Gordon thought that it was a balancing act, some things are painfully slow and need optimizing, at other times, things are painfully none existent and need to be implemented. Objects were both of those things for a while.</p>

<p>Piers Cawley said that, for all that objects were slow (getting faster), he thought they were rather lovely.</p>

<p><a href='http://groups.google.com/groups?selm=200403211713.i2LHDDK12504@vendian.org'>http://groups.google.com</a></p>

<h3><a name="Meanwhile,_in_perl6&#45;language">Meanwhile, in perl6&#45;language</a></h3>

<h4><a name="Hash_subscriptor">Hash subscriptor</a></h4>

<p>At the back end of the previous week, Larry introduced the idea of
subscripting hashes with 
<code>%hash&#171;baz&#187;</code> 
when you mean 
<code>%hash{&#39;baz&#39;}</code>. 
This surprised John Williams (and others I&#39;m sure, it certainly
surprised me, but it&#39;s one of those &#34;What? Oh... that makes a
lot of sense&#34; type surprises.) Larry explained his thinking on the
issue. 

Apparently it arose because 
<code>:foo(&#39;bar&#39;)</code> 
was too ugly to live, but too useful to die, so 
<code>:foo&#171;bar&#187;</code> was invented, and 
once you have that, it is but a short step to 
<code>%foo&#171;bar&#187;</code>. 

(If you&#39;ve not read Exegesis 7, you probably don&#39;t know that
<code>:foo&#171;bar&#187;</code> is equivalent
to <code>foo =&#62; &#39;bar&#39;</code>, but
you do now.) John wasn&#39;t convinced though. It remains to be seen if
he&#39;s convinced Larry.</p>

<p>Larry: unfortunately it&#39;s an unavoidable part of my job description to decide how people should be surprised.</p>

<p><a href='http://groups.google.com/groups?selm=Pine.LNX.4.33.0403151143160.10623&#45;100000@sharkey.morinda.com'>http://groups.google.com</a></p>

<h4><a name="Mutating_methods">Mutating methods</a></h4>

<p>Oh lord... I&#39;m really not following this particular thread. The mutating methods thread branched out in different directions that made my head hurt. I *think* we&#39;re still getting</p>

<pre><code>    $aString.lc;  # None mutating, returns a new lower case string
    $aString.=lc; # Mutating, makes $aString lower case</code></pre>

<p>I&#39;m going to bottle out of summarizing the rest of the thread. Hopefully subthread perpetrators will be kind to an ageing Summarizer and change subject lines to reflect the content of a given subthread. Ta.</p>

<h4><a name="Some_questions_about_operators">Some questions about operators</a></h4>

<p>Joe Gottman has been reading Synopsis 3 and had a bunch of questions. Much of the ensuing discussion covered the use of the &#39;broken bar&#39; glyph as an infix form of the <code>zip</code> operator. Which I didn&#39;t quite realise as I skimmed the thread during the week because courier doesn&#39;t seem to distinguish between the broken bar and the standard bar. Larry later suggested using the yen (&#165;) symbol instead, which has the advantage of looking a little like a zipper. I really hope that firms up from suggestion to design call.</p>

<p><a href='http://groups.google.com/groups?selm=200403200148.i2K1mJkG001378@ms&#45;smtp&#45;02&#45;eri0.southeast.rr.com'>http://groups.google.com</a></p>

<h4><a name="Announcements,_Acknowledgements,_Apologies">Announcements, Acknowledgements, Apologies</a></h4>

<p>Whee! I have an announcement! This summary is dedicated to my step grandson, Isaac Stamper, born 2004&#45;03&#45;17T13:13GMT at the RVI in Newcastle. There are (of course) photos online at <a href='http://www.bofh.org.uk/photos/Isaac/'>http://www.bofh.org.uk/photos/Isaac/</a>, but you don&#39;t have to go and look at them.</p>

<p>I&#39;d also like to apologise to everyone on perl6&#45;internals for my complete inability to post attachments to the list. I hope that those who are interested got to see my first cut at a Parrot implementation of xUnit in the end.</p>

<p>If you find these summaries useful or enjoyable, please consider contributing to the Perl Foundation to help support the development of Perl. You might also like to send me feedback at <a href='mailto:p6summarizer@bofh.org.uk'>mailto:p6summarizer@bofh.org.uk</a>, or drop by my website, maybe I&#39;ll add some content to it this week.</p>

<p><a href='http://donate.perl&#45;foundation.org/'>http://donate.perl&#45;foundation.org/</a> &#45;&#45; The Perl Foundation</p>

<p><a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> &#45;&#45; Perl 6 Development site</p>

<p><a href='http://www.bofh.org.uk/'>http://www.bofh.org.uk/</a> &#45;&#45; My website, &#34;Just a Summary&#34;</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-894" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/03/18/synopsis3.html" rel="bookmark">Synopsis 3</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Luke Palmer</span> on <abbr class="published" title="2004-03-18T00:00:00-08:00">March 18, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <h3><a name="Operator_renaming">Operator Renaming</a></h3>

<p>Several operators have been given new names to increase clarity and better Huffman&#45;code the language:</p>

<ul>
<li><code>&#45;&#62;</code> becomes <code>.</code>,
like the rest of the world uses.</li>

<li>The string concatenation <code>.</code> becomes <code>~</code>.
Think of it as &#34;stitching&#34; the two ends of its arguments together.</li>

<li>Unary <code>~</code> now imposes a string context on its argument,
and <code>+</code> imposes a numeric context (as opposed to being a no&#45;op in Perl 5).
Along the same lines,
<code>?</code> imposes a Boolean context.</li>

<li>Bitwise operators get a data type prefix: <code>+</code>,
<code>~</code>,
or <code>?</code>.
For example,
<code>|</code> becomes either <code>+|</code> or <code>~|</code> or <code>?|</code>,
depending on whether the operands are to be treated as numbers,
strings,
or Boolean values.
Left shift <code> &#60;&#60; </code> becomes <code> +&#60; </code>,
and correspondingly with right shift.
Unary <code>~</code> becomes either <code>+^</code> or <code>~^</code> or <code>?^</code>,
since a bitwise NOT is like an exclusive&#45;or against solid ones.
Note that <code>?^</code> is functionally identical to <code>!</code>.
<code>?|</code> differs from <code>||</code> in that <code>?|</code> always returns a standard Boolean value (either 1 or 0),
whereas <code>||</code> returns the actual value of the first of its arguments that is true.</li>

<li><code>x</code> splits into two operators: <code>x</code> (which concatenates repetitions of a string to produce a single string),
and <code>xx</code> (which creates a list of repetitions of a list or scalar).</li>

<li>Trinary <code>?
:</code> becomes <code>??
::</code>.</li>

<li><code>qw{ ...
}</code> gets a synonym: <code> &#171; ...
&#187; </code>.
For those still living without the blessings of Unicode,
that can also be written: <code>&#60;&#60; ... &#62;&#62;</code>.</li>

<li>The scalar comma <code>,</code> now constructs a list reference of its operands.
You have to use a [&#45;1] subscript to get the last one.</li>
</ul>

<h3><a name="New_operators">New Operators</a></h3>

<ul>
<li>Binary <code>//</code> is just like <code>||</code>,
except that it tests its left side for definedness instead of truth.
There is a low&#45;precedence form,
too: <code>err</code>.</li>

<li>Binary <code>=&#62;</code> is no longer just a &#34;fancy comma.&#34; it now constructs a <code>Pair</code> object that can,
among other things,
be used to pass named arguments to functions.</li>

<li><code>^^</code> is the high&#45;precedence version of <code>xor</code>.</li>

<li>Unary <code>.</code> calls its single argument (which must be a method,
or an de-referencer for a hash or array) on $_.</li>

<li><code>...</code> is a unary postfix operator that constructs a semi&#45;infinite (and lazily evaluated) list,
starting at the value of its single argument.</li>

<li>However,
<code>...</code> as a term is the &#34;yada, yada, yada&#34; operator,
which is used as the body in function prototypes.
It dies if it is ever executed.</li>

<li><code>$(...)</code> imposes a scalar context on whatever it encloses.
Similarly,
<code>@(...)</code> and <code>%(...)</code> impose a list and hash context,
respectively.
These can be interpolated into strings.</li>
</ul>

<h3><a name="Hyperoperators">Hyperoperators</a></h3>

<p>The Unicode characters <code>&#187;</code> (<code>\x[BB]</code>) and 
<code>&#171;</code> (<code>\x[AB]</code>) and their ASCII digraphs 
<code>&#62;&#62;</code> and <code>&#60;&#60;</code> are used to denote 
&#34;hyperoperations&#34; &ndash; "list" or "vector" or "SIMD" operations
that are applied pairwise between corresponding elements of two lists (or 
arrays) and which return a list (or array) of the results.
For example:</p>

<pre><code>     (1,1,2,3,5) &raquo;+&laquo; (1,2,3,5,8);  # 
(2,3,5,8,13)</code></pre>

<p>If one argument is insufficiently dimensioned, Perl &#34;upgrades&#34; it:</p>

<pre><code>     (3,8,2,9,3,8) &#62;&#62;&#45;&#60;&#60; 1;          # 
(2,7,1,8,2,7)</code></pre>

<p>This can even be done with method calls:</p>

<pre><code>     (&#34;f&#34;,&#34;oo&#34;,&#34;bar&#34;)&raquo;.&laquo;length; 
   # (1,2,3)</code></pre>

<p>When using a unary operator, only put it on the operand's side:</p>

<pre><code>     @negatives = &#45;&laquo; @positives;

      @positions&raquo;++;            # Increment all positions

      @objects&raquo;.run();</code></pre>


<h3><a name="Junctive_operators">Junctive Operators</a></h3>

<p><code>|</code>, <code>&#38;</code>, and <code>^</code> are no longer bitwise operators (see <a href='#Operator_Renaming'>Operator Renaming</a>) but now serve a much higher cause: they are now the junction constructors.</p>

<p>A junction is a single value that is equivalent to multiple values. They thread through operations, returning another junction representing the result:</p>

<pre><code>     1|2|3 + 4;                              # 5|6|7
     1|2 + 3&#38;4;                              # (4|5) &#38; (5|6)</code></pre>

<p>Note how when two junctions are applied through an operator, the result is a junction representing the operator applied to each combination of values.</p>

<p>Junctions come with the functional variants <code>any</code>, <code>all</code>, <code>one</code>, and <code>none</code>.</p>

<p>This opens doors for constructions like:</p>

<pre><code>     unless $roll == any(1..6) { print &#34;Invalid roll&#34; }

     if $roll == 1|2|3 { print &#34;Low roll&#34; }</code></pre>

<h3><a name="Chained_comparisons">Chained Comparisons</a></h3>

<p>Perl 6 supports the natural extension to the comparison operators, allowing multiple operands.</p>

<pre><code>     if 3 &#60; $roll &#60;= 6              { print &#34;High roll&#34; }
     
     if 1 &#60;= $roll1 == $roll2 &#60;= 6  { print &#34;Doubles!&#34; }</code></pre>

<h3><a name="Binding">Binding</a></h3>

<p>A new form of assignment is present in Perl 6, called &#34;binding,&#34; used in place of typeglob assignment. It is performed with the <code>:=</code> operator. Instead of replacing the value in a container like normal assignment, it replaces the container itself. For instance:</p>

<pre><code>    my $x = &#39;Just Another&#39;;
    my $y := $x;
    $y = &#39;Perl Hacker&#39;;</code></pre>

<p>After this, both <code>$x</code> and <code>$y</code> contain the string &#34;Perl Hacker,&#34; since they are really just two different names for the same variable.</p>

<p>There is another variant, spelled <code>::=</code>, that does the same thing at compile time.</p>

<p>There is also an identity test, <code>=:=</code>, which tests whether two names are bound to the same underlying variable. <code>$x =:= $y</code> would return true in the above example.</p>

<h3><a name="List_flattening">List Flattening</a></h3>

<p>Since typeglobs are being removed, unary <code>*</code> may now serve as a list-flattening operator. It is used to &#34;flatten&#34; an array into a list, usually to allow the array's contents to be used as the arguments of a subroutine call. Note that those arguments still must comply with the subroutine's signature, but the presence of <code>*</code> defers that test until runtime.</p>

<pre><code>    my @args = (\@foo, @bar);
    push *@args;</code></pre>

<p>Is equivalent to:</p>

<pre><code>    push @foo, @bar;</code></pre>

<h3><a name="Piping_operators">Piping Operators</a></h3>

<p>The new operators <code>==&#62;</code> and <code>&#60;==</code> are akin to UNIX pipes, but work with functions that accept and return lists. For example,</p>

<pre><code>     @result = map { floor($^x / 2) }
                 grep { /^ \d+ $/ }
                   @data;</code></pre>

<p>Can also now be written:</p>

<pre><code>     @data ==&#62; grep { /^ \d+ $/ }
           ==&#62; map { floor($^x / 2) }
           ==&#62; @result;</code></pre>

<p>Or:</p>

<pre><code>     @result &#60;== map { floor($^x / 2) }
             &#60;== grep { /^ \d+ $/ }
             &#60;== @data;</code></pre>

<p>Either form more clearly indicates the flow of data. See <a href="/pub/a/2003/04/09/synopsis.html">Synopsis 6</a> for more of the (less-than-obvious) details on these two operators.</p>

<h3><a name="Invocant_marker">Invocant Marker</a></h3>

<p>An appended <code>:</code> marks the invocant when using the indirect-object syntax for Perl 6 method calls. The following two statements are equivalent:</p>

<pre><code>    $hacker.feed(&#39;Pizza and cola&#39;);
    feed $hacker: &#39;Pizza and cola&#39;;</code></pre>

<h3><a name="zip"><code>zip</code></a></h3>

<p>In order to support parallel iteration over multiple arrays, Perl 6 has a <code>zip</code> function that interleaves the elements of two or more arrays.</p>

<pre><code>    for zip(@names, @codes) &#45;&#62; $name, $zip {
        print &#34;Name: $name;   Zip code: $zip\n&#34;;
    }</code></pre>

<p><code>zip</code> has an infix synonym, the Unicode operator <code>&#166;</code>.</p>

<h3><a name="Minimal_whitespace_DWIMmery">Minimal Whitespace DWIMmery</a></h3>

<p>Whitespace is no longer allowed before the opening bracket of an array or hash accessor. That is:</p>

<pre><code>    %monsters{&#39;cookie&#39;} = Monster.new;  # Valid Perl 6
    %people  {&#39;john&#39;}   = Person.new;   # Not valid Perl 6</code></pre>

<p>One of the several useful side-effects of this restriction is that parentheses are no longer required around the condition of control constructs:</p>

<pre><code>    if $value eq $target {
        print &#34;Bullseye!&#34;;
    }
    while 0 &#60; $i { $i++ }</code></pre>

<p>It is, however, still possible to align accessors by explicitly using the <code>.</code> operator:</p>

<pre><code>     %monsters.{&#39;cookie&#39;} = Monster.new;
     %people  .{&#39;john&#39;}   = Person .new;
     %cats    .{&#39;fluffy&#39;} = Cat    .new;</code></pre>

<csperl file="grab" domain="on" record="b/940" template="b/article_sidebar2.view">



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-900" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/03/p6pdigest/20040314.html" rel="bookmark">This week on Perl 6, week ending 2004-03-14</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-03-14T00:00:00-08:00">March 14, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Another week,
another summary.
It&#39;s been a pretty active week so,
with a cunningly mixed metaphor,
we&#39;ll dive straight into the hive of activity that is perl6&#45;internals.</p>

<h4><a name="Benchmarking">Benchmarking</a></h4>

<p>Discussion and development of Sebastien Riedel&#39;s nifty Parrot comparative benchmarking script continued.
Leo suggested a handy config file approach which would allow for adding benchmarks in other languages without having to change the script itself.</p>

<p>The initial results don&#39;t look good if you&#39;re name&#39;s Dan and you want to avoid getting a pie in the face at OSCON though,
as Dan pointed out,
there&#39;s a few tricks still to be played in this area.
Anyway,
<em>benchmark.pl</em> is now in the CVS tree if you want to play with it.</p>

<p><a href='http://groups.google.com/groups?selm=200403080924.i289OAe19538@thu8.leo.home'>http://groups.google.com</a></p>

<h4><a name="Speeling_mistacks">Speeling mistacks</a></h4>

<p>The ever helpful chromatic applied Bernhard Schmalhofer&#39;s patch to fix up an endemic speling mostake in some tests.
Apparently DESCRIPTION isn&#39;t spelt &#34;DECSRIPTION&#34;.</p>

<p><a href='http://groups.google.com/groups?selm=1078705129.15254.0.camel@localhost'>http://groups.google.com</a></p>

<h4><a name="Dates_and_Times">Dates and Times</a></h4>

<p>Discussion of parrot&#39;s handling of dates and times continued this week too.
Joshua Hoblitt who works on DateTime.pm (a very handy base for doing date/time handling in Perl 5,
you should check it out) said that the DateTime people really,
really want is &#34;an epoch that&#39;s <i>absolutely</i> fixed across all platforms.&#34;</p>

<p>There was also some discussion of where the opcode/library boundary should be placed,
with some arguing that the likes of <code lang='und' xml:lang='und'>strftime</code> should be implemented as opcodes.
Melvin Smith responded to this with what seems to me to be a very telling point: &#34;If we cannot provide a decently performing VM that makes people want to write stuff in bytecode (or compiled to bytecode) we have failed anyway&#34;.</p>

<p>Toward the end of the week,
Dan announced some decisions and questions.
Larry had a few quibbles,
but otherwise there have been no other comments.
Personally,
if I never hear the phrase &#34;leap second&#34; again,
I&#39;ll not be unhappy.</p>

<p><a href='http://groups.google.com/groups?selm=8765dh4voe.wl@badger.wordzoo.com'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=a06010202bc74cd596e93@[10.0.1.2]'>http://groups.google.com</a> 
    &#45;&#45; Dan&#39;s decisions</p>

<h4><a name="Alternate_function_calling_scheme">Alternate function calling scheme</a></h4>

<p>Dan has come to the view that we need an alternative,
light weight,
calling convention for calling vtable opcode functions; the idea being that this should speed up objects a tad.
He asked for suggestions.</p>

<p>Leo T&#246;tsch wasn&#39;t convinced that we really need special calling conventions,
arguing (with numbers) that it would be best to concentrate on speeding up object instantiation by optimizing object layout.
Simon Glover agreed with him,
noting that simply changing the Array that used to store class,
classname and attributes gave him a speedup of around 15% on the object benchmarks.</p>

<p><a href='http://groups.google.com/groups?selm=a0601020cbc72593ac4bb@[10.0.1.2]'>http://groups.google.com</a></p>

<h4><a name="Summary_Correction">Summary Correction</a></h4>
<csperl file="grab" domain="on" record="b/940" template="b/article_sidebar.view">
<p>Last week I said that we can&#39;t yet do delegated method calls for vtable functions with objects.
Leo pointed out that,
actually,
we can now.
Leo also disclaimed any responsibility for helping Brent Royal&#45;Gordon (n&#233; Dax?) fix up the support functions for Parrot::Config,
though Brent later claimed that he was merely the person doing the typing...</p>

<p>Jerome Quelin noted that <em>parrotbug</em> has already reached version 0.2.1 (I wonder what its version will be when Parrot 1.0.0 gets released).</p>

<p><a href='http://groups.google.com/groups?selm=200403082309.i28N9ac17099@thu8.leo.home'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=200403091942.29818.jquelin@mongueurs.net'>http://groups.google.com</a></p>

<h4><a name="Dead_Object_Detection_improved">Dead Object Detection improved</a></h4>

<p>Not content with his work on everything else this week,
Leo has revisited the Garbage Collector and tracked down a couple of bugs including a really nasty sounding one that caused disappearing continuations.
He even isolated the problem with a test.</p>

<p><a href='http://groups.google.com/groups?selm=404D8D7E.4050306@toetsch.at'>http://groups.google.com</a></p>

<h4><a name="Rejigging_trace_output">Rejigging trace output</a></h4>

<p>Leo&#39;s rearranged the output of <code lang='und' xml:lang='und'>parrot &#45;t</code> slightly in an effort to make it more readable.
Jens Rieks was impressed and pointed out a couple of issues,
which Leo quickly fixed.</p>

<p><a href='http://groups.google.com/groups?selm=404DDAE7.8030403@toetsch.at'>http://groups.google.com</a></p>

<h4><a name="Namespaces_in_IMCC">Namespaces in IMCC</a></h4>

<p>Dan&#39;s day job continues to be a handy driver of Parrot development.
This time he needs to make use of namespaces and,
whilst namespaces themselves aren&#39;t completely nailed down yet,
there&#39;s enough there that the time has come to work out the syntax for working with them in IMCC.
He proposed</p>

<pre><code>    .namespace [foo; bar; baz]</code></pre>

<p>as a way of setting the current namespace to <code lang='und' xml:lang='und'>foo::bar::baz</code> (in Perl style, your language may vary). Leo was okay with that as far as it went, but pointed out that things were slightly more complicated than Dan&#39;s proposal implied. He suggested that the time was right to sort out the duties of the PIR assembler towards variable names, name mangling, lexical scopes, namespaces, globals and all that good stuff. Dan punted slightly on this latter part, saying that, in general it shouldn&#39;t be the assembler&#39;s job to track them. The current namespace would simply be used as the namespace in which to place any subsequently defined functions. There was the sound of a hand slapping a forehead from Austria, and Leo went off and implemented it.</p>

<p><a href='http://groups.google.com/groups?selm=a06010201bc73817cf36b@[10.0.1.2]'>http://groups.google.com</a></p>

<h4><a name="New_library,_objecthacks.imc">New library, <em>objecthacks.imc</em></a></h4>

<p>In the process of redoing the Parrot Data::Dumper to use objects, Jens Rieks built a library of helper functions to make object usage easier, so he submitted it to the list as a standalone library. Leo checked it in, you can find it at <code lang='und' xml:lang='und'>library/objecthacks.imc</code></p>

<p><a href='http://groups.google.com/groups?selm=200403091934.50795.parrot@jensbeimsurfen.de'>http://groups.google.com</a></p>

<h4><a name="Implementing_stat?">Implementing <code lang='und' xml:lang='und'>stat</code>?</a></h4>

<p>Leo T&#246;tsch proposed a <code lang='und' xml:lang='und'>stat</code> opcode for finding out about things in the filesystem. He outlined a proposed interface. Dan agreed that we&#39;d need something, but that Leo&#39;s proposal was far too unix&#45;centric to work for a cross platform platform like Parrot. He suggested going back to first principles and working out what information would be needed (and possibly available). He also said that one of his guiding principles for Parrot was that he would &#34;rather not re&#45;implement and expose 35 years worth of &#39;Whoops, that turned out to be a bad idea&#39; crud.&#34;</p>

<p>Josh Wilmes took this opportunity to remind everyone of the proposed <em>miniparrot</em> and pointed out that, if we want it to work again, there needs to be a smooth way to exclude opcodes or PMCs that won&#39;t work in miniparrot&#39;s environment. Dan agreed strongly, reminding everyone that miniparrot is intended to be the basis of Parrot&#39;s eventual build system. (The process will go: Platform specific shell script &#45;&#62; miniparrot &#45;&#62; parrot).</p>

<p><a href='http://groups.google.com/groups?selm=404EF075.8040506@toetsch.at'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=200403101753.i2AHrGYe020044@galactic.hitchhiker.org'>http://groups.google.com</a> 
    &#45;&#45; Don&#39;t forget the miniparrot!</p>

<h4><a name="IMCC_and_method_calls">IMCC and method calls</a></h4>

<p>Leo announced that he&#39;d expanded IMCC&#39;s PIR parser a bit, allowing you to write:</p>

<pre><code>    obj.method(args)
    ret = obj.method(...)
    (retvals) = obj.method(...)</code></pre>

<p>where <code lang='und' xml:lang='und'>method</code> is a label.</p>

<p>A couple of hours later Dan posted a design spec for how he wanted method calls to work in IMCC:</p>

<pre><code>    object.variable(params)
    object.&#34;literal name&#34;(params)</code></pre>

<p>Methods would be declared like:</p>

<pre><code>    .pcc_sub foo prototyped, method
        .param pmc foo
        .param pmc bar
        ...
    .end</code></pre>

<p>Declaring a method in this way would also create a local <code lang='und' xml:lang='und'>self</code> which points to the object PMC register. What do you know, Leo implemented it all. There is also a more &#39;explicit&#39; way of making method calls for those occasions when you need more control. Check the docs/examples for details.</p>

<p><a href='http://groups.google.com/groups?selm=404F3777.9040005@toetsch.at'>http://groups.google.com</a>&#45;&#45; 
    Leo implements at 3pm</p>

<p><a href='http://groups.google.com/groups?selm=a06010206bc74fab20f4d@[10.0.1.2]'>http://groups.google.com</a> 
    &#45;&#45; Dan designs at 5pm</p>

<h4><a name="Data::Dumper_test_version">Data::Dumper test version</a></h4>

<p>The excellent Jens Rieks posted a test version of his object oriented version of <code lang='und' xml:lang='und'>library/dumper.imc</code> and asked for comments. (Mine was &#34;Wow!&#34; but I didn&#39;t post it to the list &#39;til now). Leo wondered if he should add it to the repository or wait for it to get rejigged to take account of all the improved object syntax changes that had gone into IMCC. Jens told him to hold fire until he&#39;d converted everything to the new syntax.</p>

<p><a href='http://groups.google.com/groups?selm=200403101412.58065.parrot@jensbeimsurfen.de'>http://groups.google.com</a></p>

<h4><a name="Months_that_Do_The_Right_Thing">Months that Do The Right Thing</a></h4>

<p>Dan&#39;s rejigged the date decoding logic to return months in the range 1&#45;12 instead of 0&#45;11. And there was some rejoicing.</p>

<p><a href='http://groups.google.com/groups?selm=a06010205bc7637281889@[10.222.20.224]'>http://groups.google.com</a></p>

<h4><a name="Problems_calling_methods_on_self">Problems calling methods on <code lang='und' xml:lang='und'>self</code></a></h4>

<p>Jens Rieks discovered that he couldn&#39;t call <code lang='und' xml:lang='und'>self.&#34;method&#34;(...)</code>, or even compile it for that matter. It turned out to be a problem with the grammar. Steve Fink provided a grammar fix, Leo tracked down a problem with registers not getting preserved properly, and there followed some discussion about the ambiguity of <code lang='und' xml:lang='und'>.</code> being used for both method calls and string concatenation. Luke Palmer suggested (and Melvin Smith agreed) that it was probably better style to use the <code lang='und' xml:lang='und'>concat</code> op anyway.</p>

<p><a href='http://groups.google.com/groups?selm=200403111634.23237.parrot@jensbeimsurfen.de'>http://groups.google.com</a></p>

<h4><a name="Object_instantiation/initialization">Object instantiation/initialization</a></h4>

<p>Dan&#39;s currently seesawing about how to customize object creation by passing arguments to the constructor function. At present, you create an object by calling the class&#39;s <code lang='und' xml:lang='und'>init</code> method, which doesn&#39;t take any arguments, and then call an object method with appropriate arguments to do any other setup that&#39;s dependent on the arguments if you want to. Dan outlined three ways forward and asked for opinions.</p>

<p><a href='http://groups.google.com/groups?selm=a06010200bc7566408dbf@[10.222.20.224]'>http://groups.google.com</a></p>

<h4><a name="Ponie_problems">Ponie problems</a></h4>

<p>Nicholas Clark posted to say that Ponie was having problems when built using Parrot&#39;s garbage collection. After some encouragement from Leo, he managed to write a short test case that showed the issue in a few lines of C. Leo proposed a solution, but Nicholas and Arthur Bergman (Ponie&#39;s core team) weren&#39;t happy with either option. This hadn&#39;t been resolved by the end of the week.</p>

<p><a href='http://groups.google.com/groups?selm=20040311203553.GF12395@plum.flirble.org'>http://groups.google.com</a></p>

<h4><a name="Why_does_Parrot_have_so_many_opcodes?">Why does Parrot have so many opcodes?</a></h4>

<p>Matt Greenwood wondered why Parrot had so many opcodes, and what the criteria are for adding or deleting ops. Various rationales were offered. Dan&#39;s explanation was probably the most comprehensive though. Apparently, Parrot has opcode explosion issues because there&#39;s no runtime op variance and if you want to know what that means, read Dan&#39;s post.</p>

<p><a href='http://groups.google.com/groups?selm=DB30501EDA9FE34CB686A124032C127E02956E01@mxgbl1.twosigma.com'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=a06010202bc77666a3dc0@[172.24.18.98]'>http://groups.google.com</a> 
    &#45;&#45; Dan explains it all</p>

<h4><a name="Parrot_grabs_SIGINT">Parrot grabs SIGINT</a></h4>

<p>Arthur &#34;Poniemaster&#34; Bergman noticed that Parrot grabs SIGINT, which makes some of Ponie&#39;s signal handling code break. He wondered if this was something that needed fixing, or a deliberate design decision. Dan says that, eventually and by design, Parrot will grab all the signals, though not necessarily in the embedded case (which is what Arthur is using of course.)</p>

<p><a href='http://groups.google.com/groups?selm=609A6A46&#45;7420&#45;11D8&#45;8D57&#45;000A95A2734C@fotango.com'>http://groups.google.com</a></p>

<h4><a name="Ponie_gets_a_development_release">Ponie gets a development release</a></h4>

<p>Arthur Bergman has made the second development release of Ponie, the Perl5/Parrot hybrid. The initial response was positive.</p>

<p><a href='http://groups.google.com/groups?selm=EBE5CF35&#45;7445&#45;11D8&#45;8D57&#45;000A95A2734C@nanisky.com'>http://groups.google.com</a></p>

<h4><a name="Per&#45;class_attribute_offsets">Per&#45;class attribute offsets</a></h4>

<p>Peter Haworth had a bunch of questions and worries about using numeric offsets to get at class attributes. Dan tried to reassure him, but Oli came up with a worrying corner case. Dan didn&#39;t think it was that big an issue, but confessed that it&#39;s still a worry.</p>

<p><a href='http://groups.google.com/groups?selm=PGM.20040312181417.1806.4266@edison.ioppublishing.com'>http://groups.google.com</a></p>

<h4><a name="Using_Ruby_Objects_with_Parrot">Using Ruby Objects with Parrot</a></h4>

<p>Poor old Dan; once you&#39;ve got some bits of objects done, it just means everyone wants more from you. Mark Sparshatt wondered how to handle languages like Ruby, where a class is also an object, which seems to run counter to Parrot&#39;s scheme using ParrotClass and ParrotObject PMCs where a ParrotClass isn&#39;t a ParrotObject. He suggested three ways forward.</p>

<p>Summarizing this stuff is Hard. One one level you can reduce the issue to a couple of sentences, but understanding those sentences involves rather a lot of underpinning knowledge that I&#39;m not sure I have. I just know that life&#39;s an awful lot easier if I can treat classes as objects.</p>

<p>Dan tried to wrap his head &#39;round things and posted a summary of his initial understanding of what a metaclass is. He wondered if we&#39;d need to have a &#39;call class method&#39; operation. Paolo Molaro pointed out that most of this stuff only becomes a real issue when you have to deal with objects implemented in one language calling methods on objects implemented in a different one. Leo T&#246;tsch explained Parrot&#39;s current (somewhat confusing to these eyes) hierarchy where:</p>

<ul>
<li>A ParrotClass isa delegate PMC</li><p class="pad"></p>

<li>A ParrotObject isa ParrotClass</li><p class="pad"></p>

<li>A HLL class isa ParrotClass and a low&#45;level PMC object</li><p class="pad"></p>

<li>A HLL object isa all of above</li><p class="pad"></p>
</ul>

<p>Piers Cawley thought that having ParrotObject inherit from ParrotClass rather than vice versa seemed somewhat perverse. He also argued that method dispatch should be decoupled from method lookup. I think he and Leo failed to communicate.</p>

<p>Mitchell N Charity was good value on all this as well; definitely worth reading if you&#39;re into the theory behind OO should work.</p>

<p><a href='http://groups.google.com/groups?selm=4052382E.30108@yahoo.co.uk'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=a06010211bc78efbdadc4@[172.24.18.98]'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=200403141936.i2EJaog10368@vendian.org'>http://groups.google.com</a> 
    &#45;&#45; Mitchell N Charity on Objects, Classes and MetaClasses</p>

<h4><a name="Configure_changes">Configure changes</a></h4>

<p>Brent announced that he&#39;s been making some significant changes to Configure in the last week or so. He posted a big list. Leo liked what had been done so far, but thought the process needed more steps to probe for more stuff.</p>

<p><a href='http://groups.google.com/groups?selm=4052638F.9020806@brentdax.com'>http://groups.google.com</a></p>

<h4><a name="PIR_changes">PIR changes</a></h4>
<p>Leo announced that he&#39;s added some syntactic sugar to PIR; you can now write:</p>

<pre><code>    $N0 = sin 0
    $I0 = can $P0, &#34;puts&#34;
    $I0 = isa $P0, &#34;scalar&#34;</code></pre>

<p>etc, and they&#39;ll be magically converted to</p>

<pre><code>    PARROT_OP lhs[, args]</code></pre>

<p>which is rather handy (with some ugly cases: <code lang='und' xml:lang='und'>P1 = invoke</code> being the example Leo came up with).</p>

<p><a href='http://groups.google.com/groups?selm=405428FD.60608@toetsch.at'>http://groups.google.com</a></p>

<h4><a name="OO_version_of_Data::Dumper">OO version of Data::Dumper</a></h4>

<p>On Sunday, Jens Rieks released his OO version of Data::Dumper, along with a couple of helper libraries, including a rewritten <em>objecthacks.imc</em>, now called <em>objects.imc</em>. Leo committed it (and a followup bugfix) promptly and Parrot now has its first OO application/library. Yay Jens!</p>

<p><a href='http://groups.google.com/groups?selm=200403141744.41872.parrot@jensbeimsurfen.de'>http://groups.google.com</a></p>

<h3><a name="Meanwhile,_in_perl6&#45;language">Meanwhile, in perl6&#45;language</a></h3>

<h4><a name="Magic_blocks">Magic blocks</a></h4>

<p>Remember last week I implied that magic UPPERCASE blocks for things like <code lang='und' xml:lang='und'>BEGIN</code>, <code lang='und' xml:lang='und'>CHECK</code>, <code lang='und' xml:lang='und'>INIT</code> etc were being replaced by properties on variables? Well, I was wrong. We keep magic blocks but we also get handy properties for attaching actions to variables.</p>

<p>In fact, the handy properties were first discussed in April last year, as Larry pointed out.</p>

<p><a href='http://groups.google.com/groups?selm=20040309002351.GA10938@wall.org'>http://groups.google.com</a></p>

<h4><a name="Mutating_methods">Mutating methods</a></h4>

<p>Juerd wondered about the possibility of mutating and non mutating methods in Perl 6. Consider the Perl 5 functions <code lang='und' xml:lang='und'>chomp</code> and <code lang='und' xml:lang='und'>lc</code>. <code lang='und' xml:lang='und'>chomp</code> potentially modifies its argument, whereas <code lang='und' xml:lang='und'>lc</code> returns a new string. Juerd liked the idea of having mutating and non mutating versions of both <code lang='und' xml:lang='und'>chomp</code> and <code lang='und' xml:lang='und'>lc</code> (and other such string methods). He proposed using</p>

<pre><code>    $aString.lc; # Non&#45;mutating
    $aString.=lc; # Mutating</code></pre>

<p>The general response to this was favourable.</p>

<p>The thread sparked a discussion of Perl 6 Rules and hypothetical variables (which just makes me hope Damian gets Perl6::Rules written really soon).</p>

<p>Larry posted a chunk of stuff from the forthcoming Apocalypse 12 that looks rather neat. Then he and Simon Cozens started talking Japanese and my head started spinning.</p>

<p><a href='http://groups.google.com/groups?selm=20040310163933.GB10971@c4.convolution.nl'>http://groups.google.com</a></p>

<p><a href='http://groups.google.com/groups?selm=20040312200110.GA2793@wall.org'>http://groups.google.com</a> 
    &#45;&#45; Larry tells us more about A12</p>

<h4><a name="Operators_that_keep_going_and_going...">Operators that keep going and going...</a></h4>

<p>Carissa wondered if Perl 6 would have what she called &#39;persistent&#39; operators, so that you could do:</p>

<pre><code>    my $a = 10;
    my $b = 5;

    my $c = $b + $a;
   
    print $c; # 15
   
    $a = 8;

    print $c; # 13</code></pre>

<p>Several people pointed out that it&#39;s already possible to do this sort of thing in Perl 5 so it&#39;d be a big surprise if you couldn&#39;t do the same thing in Perl 6. (See perldoc overload in the section &#34;Really symbolic calculator&#34; for details).</p>

<p><a href='http://groups.google.com/groups?selm=KKEPICKEKBFIGENPCEJIIEKDCAAA.c_nikkel@shaw.ca'>http://groups.google.com</a></p>

<h3><a name="Announcements,_Apologies,_Acknowledgements">Announcements, Apologies, Acknowledgements</a></h3>

<p>I&#39;ve had it with discussions of whether Unicode&#39;s a good idea or not, and from this summary onwards I&#39;ll not be including any such discussions unless Larry does an implausible <i>volte face</i>. That is all.</p>

<p>Now I can go back to being anxious about my stepdaughter who&#39;s been in labour for rather a long time.</p>

<p>If you find these summaries useful or enjoyable, please consider contributing to the Perl Foundation to help support the development of Perl. You might also like to send me feedback at <a href='mailto:p6summarizer@bofh.org.uk'>mailto:p6summarizer@bofh.org.uk</a>, or drop by my website, maybe I&#39;ll add some content to it this week.</p>

<p><a href='http://donate.perl&#45;foundation.org/'>http://donate.perl&#45;foundation.org/</a> &#45;&#45; The Perl Foundation</p>

<p><a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> &#45;&#45; Perl 6 Development site</p>

<p><a href='http://www.bofh.org.uk/'>http://www.bofh.org.uk/</a> &#45;&#45; My website, &#34;Just a Summary&#34;</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-892" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/03/12/ioall.html" rel="bookmark">Simple IO Handling with IO::All</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Brian Ingerson</span> on <abbr class="published" title="2004-03-11T00:00:00-08:00">March 11, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>One of my favorite things about Perl is how flexible it is. When I don't 
    like something about the language, I don't let it get me down. I just 
    change the language!</p>
<p>The secret to doing this lies in Perl modules. Modules make this easy. 
    Let's say you have a Perl idiom that you use everyday in your programming, 
    but it just seems clumsier than it needs to be. Usually, with a little 
    cleverness, you can simply hide a few hundred lines of code inside a 
    module, thereby turning your 3-line idiom into a 2-line one!</p>
<p>I'm joking here, but at the same time I'm not joking. While it may seem 
    like a recipe for scratching your itch with a backhoe, if you share 
    your module on CPAN, you end up potentially scratching a million itches 
    simultaneously. So perhaps the backhoe is the appropriate solution. 
    Let me give you an example.</p>
<h3><a name="Slurp_Me_Up_Scotty">Slurp Me Up, Scotty</a></h3>
<p>One of the most common idioms in my day-to-day programming is to read 
    the contents of a file into a single scalar. This is often referred 
    to by Perl geeks as a <b>slurp</b> operation. Usually it looks something 
    like this:</p>
<pre><code>    open my $file_handle, './Scotty'
      or die &#34;Scotty can't be slurped:\n$!&#34;;
    local $/;   # Set input to &#34;slurp&#34; mode.
    my $big_string = &#60;$file_handle&#62;;
    close $file_handle;</code></pre>

<p>So it would seem that slurping is a big deal. I mean, it took me 5 lines 
    of code to do. Five lines is a <b>lot</b> in Perl. Surely, there could 
    be an easier way. If I had my druthers, I would be able to just do this:</p>

<pre><code>    my $big_string &#60;&#60; './Scotty';</code></pre>

<p>And be done with it. Unfortunately, this doesn't work the way I want 
    it to, even though it is valid (albeit useless) Perl. How do I know 
    it's useless? Perl told me so when I turned on warnings: &#34;Useless 
    use of left bitshift (<code>&#60;&#60;</code>) in void context.&#34;</p>
<p>Now even though I could write a source filter to make the above code 
    do what I wanted, it wouldn't be the right approach. Surely there is 
    something just as simple, that uses valid Perl constructs. After thinking 
    about it for a couple hours, I came up with this:</p>
<pre><code>    my $big_string = io('./Scotty')&#45;&#62;slurp;</code></pre>

<p>Being quite satisfied with my new idiom, I sat down for a few more weeks, 
    and wrote a few hundred lines of code, and hid it in a module called 
    <code>IO::All</code> and uploaded it to CPAN. Now I can do my 5-line 
    slurp in 1 line. Phew!</p>
<h3><a name="Extreme_Simplicity">Extreme Simplicity</a></h3>

<csperl file="grab" domain="on" record="b/941" template="b/article_sidebar.view">

<p>How on earth could a module to perform the slurp idiom be several hundred 
    lines long? Well, <code>IO::All</code> does slurping and a whole lot 
    more. The motivating idea behind this module is to simplify all of the 
    Perl IO idioms as much as possible, and also to create new idioms for common-use cases that weren't really idiomatic to begin with.</p>
<p>In recent years, I've become a fan and student of Extreme Programming 
    (XP). One of the principles of XP is to constantly refactor your code 
    to make it simpler, easier to read, and ultimately more maintainable. 
    In striving to do so I found that as my code became as clean as I could 
    make it, the parts that still looked <i>dirty</i> were constructs imposed 
    on me by the Perl language itself; especially the IO stuff. I didn't 
    let it get me down. I changed the language!</p>
<h4><a name="What's_Going_On_Here?">What's Going on Here?</a></h4>
<p>The basic idea of <code>IO::All</code> is that it exports a function 
    called <code>io</code>, which returns a new <code>IO::All</code> object. 
    For example:</p>
<pre><code>    use IO::All;

    my $io = io('file1');
    # Is the same thing as:
    my $io = IO::All&#45;&#62;new('file1');</code></pre>
<p>Another principle of IO::All is that it takes as many cues as possible 
    from its context. Consider the following example:</p>
<pre><code>    my @lines = io('stuff')&#45;&#62;slurp;
    my @good_lines = grep {not /bad/} @lines;
    io('good&#45;stuff')&#45;&#62;print(@good_lines);</code></pre>

<p>Here we are basically censoring a file, removing all the <i>bad</i> lines. 
    The first statement slurps up the file, but since it is called in list 
    context, it returns all the lines instead of one long string. The second 
    statement weeds out any filth, and the third statement writes the good 
    lines to a new file.</p>
<p>But the question arises, &#34;How did <code>IO::All</code> know to open 
    the output file for output?&#34;</p>

<p>The answer is that <code>IO::All</code> 
    delays the open until the first IO operation and uses the operation 
    to determine the context. The opening and closing of files happens automatically 
    and you almost never need to indicate the file mode, although you can 
    do all of this manually if you really want to.</p>
<h3><a name="Directory_Assistance">Directory Assistance</a></h3>
<p>I never really liked the directory commands in Perl. You know, <code>opendir</code>, 
    <code>readdir</code>, and <code>closedir</code>. I thought, well why 
    not let an IO::All object act as a directory in addition to a file? 
    How would IO::All know the difference? Context, of course!</p>

<pre><code>    my $dir = io('mydir');
    while (my $io = $dir&#45;&#62;read) {
        print $io&#45;&#62;name, &#34;\n&#34;
          if $io&#45;&#62;is_file;
    }</code></pre>
<p>In this example, IO::All opens a directory for reading and returns one 
    entry at a time, much like <code>readdir</code>. The difference is that 
    instead of a file or subdirectory name, you get back another IO::All 
    object. This is really cool, because you can immediately perform actions 
    on the new objects. In the above code, we print the filename (returned 
    by an IO::All method) if the object represents a file rather than a 
    subdirectory (which is also returned by an IO::All Method).</p>
<h4><a name="File::Find">File::Find</a></h4>
<p>Ask any experienced Perl programmer which core module has the most abysmal 
    interface, and they'd probably say <code>File::Find</code>. Rather than 
    explain how <code>File::Find</code> works (which would take me an hour 
    of research to figure out again), here's an easy way to roll your own 
    search.</p>
<pre><code>    my @wanted_file_names = map {
        $_&#45;&#62;name
    } grep {
        $_&#45;&#62;name =~ /\.\w{3}/ &#38;&#38;
        $_&#45;&#62;slurp =~ /ingy/
    } io('my/directory')&#45;&#62;all_files;</code></pre>
<p>This search finds all the file names in a directory that have a three-character 
    extension and contain the string 'ingy'. The <code>all_files</code> 
    method is a shortcut that returns only the files. There are also <code>all_dirs</code>, 
    <code>all_links</code>, and simply <code>all</code> methods.</p>
<h4><a name="A_Poor_Man's_tar">A Poor Man's tar</a></h4>
<p>This example reads all the files under a directory, and dumps them into 
    one big file, separated by a line containing the file's name and size. 
    This is analogous to what the Unix <code>tar</code> command does.</p>
<pre><code>    use IO::All;
    for my $file (io('mydir')&#45;&#62;all_files('&#45;r')) {
        my $output = sprintf(&#34;&#45;&#45;&#45; %s (%s)\n&#34;, $file&#45;&#62;name, &#45;s $file&#45;&#62;name)
                     . $file&#45;&#62;slurp;
        io('tar_like')&#45;&#62;append($output);
    }</code></pre>
<p>In this usage, we pass a special flag, <code>&#45;r</code>, that tells 
    <code>all_files</code> to be recursive. That is, to find all files in 
    all subdirectories. Also notice the <code>append</code> method. This 
    is the same as <code>print</code>, but the file is opened for concatenation.</p>
<h3><a name="Double_STanDards,_String_Cheese_and_Temporary_Insanity">Double 
    STanDards, String Cheese, and Temporary Insanity</a></h3>
<p>IO::All has some handy shortcut names. In the Unix tradition, it uses 
    a dash to mean STDIN, but it also uses it to mean STDOUT. Check out 
    this one liner:</p>
<pre><code>    io('&#45;')&#45;&#62;print(io('&#45;')&#45;&#62;slurp);</code></pre>

<p>This just prints everything on STDIN to STDOUT. Once again context is 
    used to determine which file handle the dash is actually referring to. 
    A potentially more efficient way to write this is:</p>
<pre><code>    my $stdin = io('&#45;');
    my $stdout = io('&#45;');
    $stdout&#45;&#62;buffer($stdin&#45;&#62;buffer);
    $stdout&#45;&#62;write while $stdin&#45;&#62;read;</code></pre>
<p>The <code>read</code> and <code>write</code> methods work from an internal 
    buffer, which defaults to 1k in size. What we've done in this example 
    is to set the two objects to use the same buffer. Since the write method 
    clears the buffer after writing it, the above idiom works nicely.</p>
<p>Another special character is the dollar sign. This means that the IO::All 
    object will read/write to a Perl scalar rather than a file. This can 
    be useful when you have a code base that writes to a file, but you want 
    to fake it out and capture all the output in a string without changing 
    the code base.</p>
<p>Finally, if you pass no arguments at all to the <code>io</code> function 
    it will work as a temporary or nameless file. This is somewhat similar 
    in effect to writing to a string, except that the data is actually going 
    to your disk. The temporary file is opened for both read and write modes.</p>
<p>Here is a somewhat contrived example using all of these special cases.</p>
<pre><code>    my $temp = io;
    $temp&#45;&#62;print(io('&#45;')&#45;&#62;slurp);
    $temp&#45;&#62;seek(0, 0);
    my $str = io('$');
    $str&#45;&#62;print($_) for $temp&#45;&#62;getline;
    my $data = ${$str&#45;&#62;string_ref};
    $data =~ s/hate/love/;
    io('&#45;')&#45;&#62;print($data);</code></pre>
<p>OK, listen up and repeat after me:</p>
<blockquote>
    <p>We slurp up all of STDIN, and slam it in a temp. We seek back to 
        the start of it, and shove it a string. We suck the soul right out 
        of string and save it from its sin. Then ship the lot to STDOUT, 
        and sing it once again.</p>
</blockquote>
<h3><a name="Socket_To_Me">Socket to Me</a></h3>
<p>If IO::All objects can represent files, directories, streams, and strings 
    then they can surely do the same for sockets. This example prints the 
    header lines from an HTTP GET call:</p>
<pre><code>    my $io = io('www.google.com:80');
    $io&#45;&#62;print(&#34;GET / HTTP/1.1\n\n&#34;);
    print while ($_ = $io&#45;&#62;getline) ne &#34;\r\n&#34;;</code></pre>
<p>Again, the context comes into play. Since <code>www.google.com:80</code> 
    looks like a socket address, the IO::All object does the right thing. 
    It is worth noting that if you really wanted to open a <b>file</b> called 
    <code>'www.google.com:80'</code> or <code>'&#45;'</code> or <code>'$'</code>, 
    you can explicitly override the IO::All heuristics like such:</p>
<pre><code>    my $io1 = io(&#45;filename =&#62; 'www.google.com:80');
    my $io2 = io(&#45;filename =&#62; '&#45;');
    my $io3 = io(&#45;filename =&#62; '$');</code></pre>

<h4><a name="For_Fork's_Sake">For Fork's Sake</a></h4>
<p>The one thing I always use O'Reilly's <i>Perl Cookbook</i> for is 
    creating a forking socket server. Not because it's that hard, but it's 
    just something I don't keep in my head. With IO::All I have no problem 
    remembering how to do it because it's been made dead simple:</p>
<pre><code>    use IO::All;
    my $server = io(':12345')&#45;&#62;accept('&#45;fork');
    $server&#45;&#62;print($_) while &#60;DATA&#62;;
    $server&#45;&#62;close;
    __DATA__
    One File, Two File
    Red File, Blue File</code></pre>
<p>This server sits and listens for connections on port 12345. When it gets 
    a connection, it forks off a sub-process and sends two lines to the receiver.</p>
<p>The client code to call this server might look like this:</p>
<pre><code>    use IO::All;
    my $io = io('localhost:12345');
    print while $_ = $io&#45;&#62;getline;</code></pre>
<h3><a name="IO::All_Of_It_To_Graham">IO::All of It to Graham</a></h3>
<p>It may strike you as silly, vain, or even foolish for someone to rewrite 
    all of the Perl IO functions as a new module when older, more mature 
    modules exist. But therein lies the beauty of IO::All: it <b>doesn't</b> 
    rewrite anything. It simply provides a keen new interface to <code>IO::File</code>, 
    <code>IO::Directory</code>, <code>IO::Socket</code>, <code>IO::String</code>, 
    <code>IO::Handle</code>, and others. It ties all of these robust modules 
    together into one cohesive unit. So even though <code>IO::All</code> 
    is relatively new, it hopefully inherits well from this legacy of stability.</p>
<p>As far as I know, almost all of these modules we're written by Perl superhero 
    Graham Barr. I've met Graham personally and I don't think it would be 
    too forward of me to suggest that you send him a beer to thank him for 
    making Perl so great. Unfortunately I don't know his address.</p>
<h3><a name="Tie_Me_Up_and_Lock_Me">Tie Me Up and Lock Me</a></h3>
<p>I learned a neat trick from Gisle Aas by reading the code of his <code>IO::String</code> 
    module. The trick is that you can tie an object to itself. This is especially 
    handy when the object is IO handle. It means that you can use the object 
    as a regular file handle with all Perl built-in IO functions. And you 
    can <i>also</i> use it as a regular object by calling methods on it. 
    It's TMTOWTDI at its finest.</p>
<pre><code>    use IO::All '&#45;tie';
    my $file = io('myfile');
    my $line1 = $file&#45;&#62;getline;
    my $line2 = &#60;$file&#62;;</code></pre>
<p>Pretty nifty, eh? Note that you need to request that IO::All perform the 
    tie with the <code>&#45;tie</code> option. That's because a bug in Perl 
    5.8.0 caused things tied to themselves to not go out of scope.</p>
<p>Here's another nifty feature: <i>automatic file locking</i>. If you specify 
    the <code>&#45;lock</code> option, IO::All will call flock after every 
    file open. You still have to worry about things like deadlock, but at 
    least the mechanism is simple. Here is a sample where all messages 
    written to a log file then lock the file:</p>
<pre><code>    use IO::All '&#45;lock';
    io('log')&#45;&#62;appendln(localtime() . &#34; &#45; I'm still here&#34;);</code></pre>
<p>The <code>appendln</code> method is a cousin of the <code>println</code> 
    method. Both print a new line after your output. Note that the above 
    code is the same as the following:</p>
<pre><code>    use IO::All;
    io(&#45;lock =&#62; 'log')&#45;&#62;appendln(localtime() . &#34; &#45; I'm still here&#34;);</code></pre>
<p>That's because any parameters that are passed to IO::All are simply passed 
    along to all invocations of the <code>io</code> function.</p>
<h3><a name="The_Methods_in_My_Madness">The Methods in My Madness</a></h3>
<p>IO::All has over 60 methods that you can call to perform various IO-related 
    actions. Not all methods make sense in all contexts for all flavors 
    of IO. Most of the methods are simply direct proxies for methods found 
    in the core modules that IO::All is built upon.</p>
<p>Some of the methods have been enhanced to be more flexible than their 
    ancestors. Take the <code>getline</code> function, for example. The IO::Handle 
    version simply gets the next line. The IO::All version takes an optional 
    argument that is used as the record separator. To read a paragraph of 
    text you could do this:</p>
<pre><code>    my $paragraph = io('myfile')&#45;&#62;getline('');</code></pre>
<p>Lots of the methods have been presented in this article. For complete 
    information on all the available IO::All methods, see the IO::All documentation.</p>
<h3><a name="It's_Not_Just_Keen,_It's_Spiffy">It's Not Just Keen, It's Spiffy</a></h3>
<p>IO::All is a little bit different from most Perl modules in that it <i>exports</i> 
    the <code>io</code> function. As I said before, the <code>io</code> 
    function acts as an object constructor, returning a new IO::All object 
    for each invocation. This property is gained from IO::All's base class, 
    <code>Spiffy.pm</code>.</p>
<p><code>Spiffy</code> is a new kind of generic base class. Its primary 
    magic trick is that it supports a unique feature that I call <b>inheritable 
    exporting</b>. Normally if you use a module as a base class, it is strictly 
    an object-oriented thing. You don't also export functions. Furthermore, 
    if you were to export some functions, your subclasses would need to 
    manually export those functions to its subclasses.</p>
<p><code>Spiffy</code> is set up so that all of the <code>@EXPORT</code> 
    arrays in all the modules in the <code>@ISA</code> tree of a class, 
    are combined together to act as one big export list. The magic is then 
    taken one step further. Functions like <code>io</code> that act as an 
    object constructor are <i>smart</i> enough to return an object of a 
    subclass; not just an IO::All object.</p>
<p>This is demonstrated in the next section. See the Spiffy documentation 
    for details on this and other exciting features.</p>
<h3><a name="EIE::IO">EIE::IO</a></h3>
<p>Let's write an extension of IO::All that adds a new method called <code>pruls</code>, which is <code>slurp</code> backwards. Its purpose will be to return 
    the whole file with its lines in reverse order. Here is the code:</p>
<pre><code>    package EIE::IO;
    use IO::All '&#45;base';
    sub pruls {
        my $self = shift;
        my @lines = reverse $self&#45;&#62;slurp;
        wantarray ? @lines : join '', @lines;
    }
    1;</code></pre>
<p>That's all there is to it. This module will act just like <code>IO::All</code>, 
    except with one more method. You would use it just like this:</p>
<pre><code>    use EIE::IO;
    print io('mystuff')&#45;&#62;pruls;</code></pre>
<p>Note that the <code>io</code> function is still exported, but it returns 
    a new <b>EIE::IO</b> object. That's Spiffy!</p>
<h3><a name="Conclusion">Conclusion</a></h3>
<p><code>IO::All</code> is still quite a young module. There is room for 
    many, many more idioms. There is also the possibility of including even 
    more types of IO, like shared memory, IPC, and Unix sockets. If you have 
    a use case that you think would make a nice addition to this Swiss Army 
    Light Sabre of Perl IO, please <csperl file="mailmunge" arg_email="INGY@cpan.org" arg_display="drop me a line" arg_ending=". ">Let's change the Perl 
    language for the better.</p>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-898" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/03/p6pdigest/20040307.html" rel="bookmark">This week on Perl 6, week ending 2004-03-07</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2004-03-07T00:00:00-08:00">March  7, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>Time marches on, and another summary gets written, sure as eggs are eggs 
    and chromatic is a chap with whom I will never start a sentence. We 
    start, as always, with perl6-internals.</p>
<h4><a name="Platform_games">Platform games</a></h4>
<p>Work continued this week on expanding the number of known (and preferably 
    known good) platforms in the <em lang='und' xml:lang='und'>PLATFORMS</em> 
    file.</p>
<h4><a name="Languages_tests">Languages tests</a></h4>
<p>Dan reckons it's time to be a little more aggressive with tests for ancillary 
    stuff, in particular the contents of the <em lang='und' xml:lang='und'>languages</em> 
    subdirectory. He called for language maintainers (and any other interested 
    parties) to at least get minimal tests written for all the languages 
    in the languages directory, and to get those welded to the <code>languages-test</code> 
    makefile target.</p>
<p><a href='http://groups.google.com/groups?selm=a06010201bc68ee3f3f3c@[10.0.1.2]'>http://groups.google.com</a></p>
<h4><a name="IMCC_and_objects/methods">IMCC and objects/methods</a></h4>

<csperl file="grab" domain="on" record="b/940" template="b/article_sidebar.view">

<p>Tim Bunce congratulated everyone on Parrot 0.1.0 before asking about 
    where we stood with IMCC and objects/methods. Leo confirmed Tim's supposition 
    that there is no syntactic support for objects and methods in IMCC, 
    at least in part because there's been no discussion of how such syntax 
    should look.</p>
	
<p><a href='http://groups.google.com/groups?selm=20040301110726.GF20958@dansat.data-plan.com'>http://groups.google.com</a></p>
<h4><a name="Parrotbug_reaches_0.0.1">Parrotbug reaches 0.0.1</a></h4>
<p>Jerome Quelin responded to Dan's otherwise ignored request for a parrot 
    equivalent of <em lang='und' xml:lang='und'>perlbug</em> when he offered 
    an implementation of <em lang='und' xml:lang='und'>parrotbug</em> for 
    everyone's perusal, but didn't go so far to add it to the distribution. 
    I don't think it's been checked into the repository yet, but it'll probably 
    go in <em lang='und' xml:lang='und'>tools/dev/</em> when it does.</p>
<p>Later in the week, he actually got it working, sending mail to the appropriate 
    mailing lists. With any luck the mailing lists themselves will be up 
    and running by the time you read this.</p>
<p><a href='http://groups.google.com/groups?selm=200403012028.13070.jquelin@mongueurs.net'>http://groups.google.com</a></p>
<h4><a name="Subclassing_bug">Subclassing bug</a></h4>
<p>Jens Rieks found what looked like a problem with subclassing, which turned 
    out to be a problem with <code>clone</code> not going deep enough. Simon 
    Glover tracked it to its den and Dan Sugalski fixed it.</p>
<p><a href='http://groups.google.com/groups?selm=200403022220.20499.parrot@jensbeimsurfen.de'>http://groups.google.com</a></p>
<h4><a name="Good_news!_Bad_news!">Good news! Bad news!</a></h4>
<p>Good news! Dan says the infrastructure is in place to do delegated method 
    calls for vtable functions with objects. Bad news! It doesn't actually 
    work because it's impossible to inherit from <em lang='und' xml:lang='und'>delegate.pmc</em> 
    properly. Dan pleaded for someone to take a look at <em lang='und' xml:lang='und'>pmc2c2.pl</em> 
    and or <em lang='und' xml:lang='und'>lib/Parrot/Pmc2c.pm</em> and fix 
    things so that the generated code is heritable.</p>
<p><a href='http://groups.google.com/groups?selm=a06010201bc6a51c938a5@[10.254.6.39]'>http://groups.google.com</a></p>
<h4><a name="Parrot_m4_updated">Parrot m4 updated</a></h4>
<p>Bernhard Schmalhofer posted a patch to improve the Parrot implementation 
    of the m4 macro language.</p>
<p><a href='http://groups.google.com/groups?selm=rt-3.0.8-27316-80413.12.8637727827157@perl.org'>http://groups.google.com</a></p>
<h4><a name="Use_vim?">Use vim?</a></h4>
<p>I don't use vim, but it seems that Leo T&#246;tsch does. He's added some 
    handy dandy vim syntax files for IMC code. If you're a vim user you 
    might like to check it out. Leo points out that the syntax tables might 
    well be handy if you don't know all 1384 opcode variants by heart.</p>
<p><a href='http://groups.google.com/groups?selm=404450D6.6080306@toetsch.at'>http://groups.google.com</a></p>
<h4><a name="Parrotris">Parrotris</a></h4>
<p>Sadly, Jens Rieks' Parrot and SDL implementation of tetris didn't quite 
    make it under the wire for the 0.1.0 release. However, Leo has got round 
    to trying it and is impressed, though he did spot a few bugs (it doesn't 
    spot that the game is over for instance). Jens is working on fixing 
    those (and on adding new features), which he reckons will go a deal 
    faster when IMCC has better syntactic support for OO techniques.</p>
<p><a href='http://groups.google.com/groups?selm=200403020948.i229mof18163@thu8.leo.home'>http://groups.google.com</a></p>
<h4><a name="Dates_and_Times">Dates and Times</a></h4>
<p>To paraphrase Barbie: Dates and Times are Hard. Not that hardness has 
    ever stopped Dashing Dan Sugalski before. This time he waded into the 
    swamp that is Parrot's handling of dates, times, intervals and all that 
    other jazz. He started by soliciting opinions. He got quite a few.</p>
<p>The discussion can probably be divided into two camps: KISS (Keep it 
    Simple) people, and DTRT (Do The Right Thing) people. But KISS still 
    has it's complexities (which Epoch do we want? Should time be a floating 
    point value?) and what, exactly, is the Right Thing? The catch is, time 
    is a messily human thing, and computers are really bad at messy humanity.</p>
<p>Larry said that Dan could do what he wants with Parrot, but he wants 
    Perl 6's standard interface to be a floating point seconds since 2000. 
    He argues that &quot;floating point will almost always have enough precision 
    for the task at hand, and by the time it doesn't, it will. :-)&quot;. 
    He also argued that normal users &quot;should <i>never</i> have to remember 
    the units of the fractional seconds&quot;.</p>
<p>Zellyn Hunter pointed everyone at Dave Rolsky's excellent article on 
    the complexities of handling dates and times with a computer.</p>
<p>Discussion is ongoing, but it seems that Larry and Dan are leaning towards 
    the KISS approach.</p>
<p><a href='http://groups.google.com/groups?selm=a06010204bc6bb752bc7c@[10.0.1.2]'>http://groups.google.com</a></p>
<p><a href='http://www.perl.com/pub/a/2003/03/13/datetime.html'>http://www.perl.com/pub/a/2003/03/13/datetime.html</a></p>
<h4><a name="Initializers,_finalizers_and_fallbacks">Initializers, finalizers 
    and fallbacks</a></h4>
<p>Anyone who has been reading the internals list for any length of time, 
    or who has chatted to Dan about Parrot on the #parrot irc channel will 
    be only too aware that Dan isn't the greatest fan of the OO silver bullet. 
    So, getting the initial objects implementation out there was the sort 
    of thing he probably hoped would mean he didn't have to come back to 
    objects for a while. Except, once you've got part of an object implementation, 
    the need for the rest of it just seems to become more pressing.</p>
<p>So, poor Dan's been doing more OO stuff. This time he sketched out where 
    he was going with initialization, finalization and fallback method location. 
    The basic idea is that, instead of mandating particular method names 
    for different tasks (which seems like the easy approach, but doesn't 
    work across languages), we mandate particular properties which tag various 
    methods as being initializers/finalizers/fallbacks. He outlined his 
    initial set of standard properties and asked for comments.</p>
<p>Leo liked the basic idea, but suggested that, in the absence of any such 
    properties on a class's methods, Parrot should fall back to some methods 
    on a delegate PMC.</p>
<p><a href='http://groups.google.com/groups?selm=a06010205bc6bc09fea71@[10.0.1.2]'>http://groups.google.com</a></p>
<h4><a name="OO_Benchmarks">OO Benchmarks</a></h4>
<p>Leo posted the results of a couple of benchmarks. They weren't very encouraging. 
    It seems there was a memory leak. And some inefficiencies in object 
    creation. And some more inefficiencies in object creation. By the end 
    of the mini thread, things had got a good deal faster. Quite where it 
    puts us against Perl 5 and Python wasn't mentioned.</p>
<p><a href='http://groups.google.com/groups?selm=40473F09.8050505@toetsch.at'>http://groups.google.com</a></p>
<h4><a name="Parrot_dependencies">Parrot dependencies</a></h4>
<p>Michael Scott, who has been doing sterling work on Parrot's documentation 
    wanted to remove some non-modified, non-parrot Perl modules from the 
    Parrot distribution and have people install them from CPAN. Dan disagreed 
    quite strongly. The current rule of thumb is that Parrot is allowed 
    to depend on finding a Perl 5.005_0x distribution and a C compiler. 
    Any Perl modules it needs that can't be found in that distribution should 
    be provided as part of the Parrot distribution.</p>
<p>Larry argued that we should separate the notion of the developer distribution 
    from the user distribution. The developer codebase is allowed to have 
    any number of external dependencies (&quot;dependencies out the wazoo&quot; 
    was Larry's chosen phrase), and the (for plural values of 'the') comes 
    with all the bells and whistles a distributer sees fit to include. He 
    argued that the developer codebase should be completely unusable by 
    anyone but developers to prevent ISPs from installing that and then 
    claiming to &quot;support Perl&quot;.</p>
<p><a href='http://groups.google.com/groups?selm=E11D5C7F-6DE9-11D8-869E-000A95C50226@mac.com'>http://groups.google.com</a></p>
<h4><a name="Vtables_as_collectible_objects">Vtables as collectible objects</a></h4>
<p>Dan wondered whether we were going to need to treat vtables as garbage 
    collectible objects, and if we did, what kind of hit that would entail. 
    He and Leo discussed it, and Leo reinvented refcounting as being a possible 
    way to go rather than full DOD type collection.</p>
<p><a href='http://groups.google.com/groups?selm=a06010205bc6cf5235fe9@[10.0.1.2]'>http://groups.google.com</a></p>
<h4><a name="Continuing_dumper_improvement">Continuing dumper improvement</a></h4>
<p>Jens Rieks added ParrotObject support to his Parrot data dumper. Dan 
    applied it. Go Jens.</p>
<p><a href='http://groups.google.com/groups?selm=200403041914.23770.parrot@jensbeimsurfen.de'>http://groups.google.com</a></p>
<h4><a name="Freezing_strings">Freezing strings</a></h4>
<p>Brent Dax is working on writing a parrot implementation of Parrot::Config. 
    His initial idea for implementation involves generating a PerlHash of 
    configuration info and then freezing it to disk. However, when he tried 
    it he had problems with freezing strings, so he asked for help. It turned 
    out to be a simple matter of unimplemented functions, which he and Leo 
    rapidly implemented. A patch with Brent's implementation appeared shortly 
    afterwards.</p>
<p><a href='http://groups.google.com/groups?selm=40492BAD.5070001@brentdax.com'>http://groups.google.com</a></p>
<h4><a name="A_Perl_task_-_Benchmarking">A Perl task - Benchmarking</a></h4>
<p>Leo wondered if anyone could implement an equivalent of perlbench for 
    parrot's benchmarks to do speed comparisons of Parrot, Perl, Python 
    etc implementations. Sebastien Riedel delivered the goods.</p>
<p><a href='http://groups.google.com/groups?selm=4049C44F.3000803@toetsch.at'>http://groups.google.com</a></p>
<h3><a name="Meanwhile,_in_perl6-language">Meanwhile, in perl6-language</a></h3>
<h4><a name="Exegesis_7">Exegesis 7</a></h4>
<p>Everyone carried on discussing Damian's Exegesis 7 on Perl6::Format, 
    there was even a surprise appearance by Tom Christiansen, who demonstrated 
    a novel, if computationally intractable, approach to generating fully 
    justified text.</p>
<h4><a name="Multi_matching">Multi matching</a></h4>
<p>Remember last week, Larry had proposed using <code>&#38;</code> in Perl 
    6 rules as a way of matching multiple rules at the same point in the 
    string. Damian liked it a lot and said he'd be delighted to add support 
    for it to the semi mythical Perl6::Rules module. So, Larry said the 
    word (&quot;Execute!&quot;, which wasn't quite the word everyone expected) 
    so Damian tugged his forelock and added it to his todo list. Questions 
    like &quot;What are the precedence rules for <code>&#38;</code> and 
    <code>|</code> in regular expressions then?&quot; haven't been asked 
    yet.</p>
<p><a href='http://groups.google.com/groups?selm=4044228E.9000702@conway.org'>http://groups.google.com</a></p>
<h4><a name="Compile-time_undefined_sub_detection">Compile-time undefined 
    sub detection</a></h4>
<p>Nigel Sandever wondered if Perl 6 will be able to detect undefined subs 
    at compile time. Larry thought it would be in theory, if you ask it 
    to check in a <code>CHECK</code> block, and you're prepared to assume 
    that no <code>eval</code> or <code>INIT</code> block will fill in the 
    blank later, and there's no <code>AUTOLOAD</code> that might catch it. 
    Sounds rather a like &quot;Not in the general case, no&quot; to me.</p>
<p>Bringing <code>CHECK</code> and <code>INIT</code> up prompted Rafael 
    Garcia-Suarez to ask what the rules would be for them in Perl 6 because 
    they're pretty broken in Perl 5. (Sometimes you want <code>CHECK</code> 
    and <code>INIT</code> semantics to work well when you're loading a module 
    at runtime, and Perl 5 doesn't do that). It looks like he's going to 
    get his heart's desire on this (A big &quot;Yay!&quot; from the direction 
    of Gateshead). Dan Sugalski popped over from perl6-internals to point 
    out that Parrot would be using properties rather than specifically named 
    blocks for this sort of stuff.</p>
<p>Larry eventually made a ruling which uses properties in a rather cunning 
    fashion. Check his message for the details.</p>
<p><a href='http://groups.google.com/groups?selm=1103_1078441478@nntp.perl.org'>http://groups.google.com</a></p>
<p><a href='http://groups.google.com/groups?selm=20040307023944.GA27527@wall.org'>http://groups.google.com</a> 
    -- Larry on magic blocks</p>
<h3><a name="Announcements,_Apologies,_Acknowledgements">Announcements, 
    Apologies, Acknowledgements</a></h3>
<p>Crumbs, another Monday night, another summary finished. I've got to be 
    careful here, it might by habit forming.</p>
<p>If you find these summaries useful or enjoyable, please consider contributing 
    to the Perl Foundation to help support the development of Perl. You 
    might also like to send me feedback at <a href='mailto:p6summarizer@bofh.org.uk'>mailto:p6summarizer@bofh.org.uk</a>, 
    or drop by my website.</p>
<p><a href='http://donate.perl-foundation.org/'>http://donate.perl-foundation.org/</a> 
    -- The Perl Foundation</p>
<p><a href='http://dev.perl.org/perl6/'>http://dev.perl.org/perl6/</a> -- 
    Perl 6 Development site</p>
<p><a href='http://www.bofh.org.uk/'>http://www.bofh.org.uk/</a> -- My website, 
    &quot;Just a Summary&quot;</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-890" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2004/03/03/svk.html" rel="bookmark">Distributed Version Control with svk</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Chia-liang Kao</span> on <abbr class="published" title="2004-03-04T00:00:00-08:00">March  4, 2004 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->
<p>
I started to use <a href="http://subversion.tigris.org/">Subversion</a> one year ago and liked the elegant file-system design a lot.  Soon it became impossible for me to go back to
CVS. This means that I felt uncomfortable whenever I was working on projects
using CVS, and I wanted to see a tool to keep my Subversion repository
in sync with a CVS repository.  This would not only save me time
importing snapshots into vendor branches, but it would also give me the
whole history when I'm not online.
</p>

<p>
I found Barrie's <a href="http://public.perforce.com/public/revml/index.html">VCP</a> and wrote a Subversion driver.  Then I
understood why people said Subversion was slow.  My driver invoked the
<code>svn</code> command, and it took something like 30 hours to convert from a CVS
repository that resulted in 3000 revisions in the Subversion
repository.
</p>

<p>
Fortunately the Subversion developers made the code easy and ready for
wrapping into different languages using SWIG.  At that time, only Python
bindings were implemented, so I had to do the Perl bindings myself.
With the Perl bindings implemented rapidly, VCP gets much faster, and I
also started writing <a href="http://search.cpan.org/perldoc?SVN::Mirror/"><code>SVN::Mirror</code></a>, 
a module that enables mirroring
between Subversion repositories.  When I felt bored, I would add
Subversion back-end support to tools like Bloxsom and Kwiki.
</p>

<p>
Then the season for traveling came. As I'm far more productive and
creative while disconnected from the Internet, I realized I need a
distributed version control system, and decided to give myself a year
break to develop such a tool to enable me to be even more productive in
the future. <a href="http://svk.elixus.org/">svk</a> was born soon after my birthday in September 2003.
</p>
<h3> Why? </h3>
<csperl file="grab" domain="on" record="b/881" template="b/article_sidebar.view">
<p>
There are other distributed version control systems available: Arch,
<code>monotone</code>, <code>darcs</code>.  The functionalities they offer are more or less
equivalent.
</p>

<p>
<code>svk</code>, however, is written in Perl, and so might be more hackable by a
large community.  <code>svk</code> also has a set of commands similar to those of <code>cvs</code>. On
top of this, <code>svk</code> plans to implement transparent interpolation between
different version-control systems.
</p>

<p>
As I don't see any strong argument suggesting one system over another,
it's really up to you to try and decide.
</p>

<h3> Design Decisions </h3>

<p>
Subversion has a layered design:
</p>

<ul>
<li> <code>fs</code>: Underlying versioned tree library using <code>bdb</code>.</li>
<li> <code>repos</code>: Higher-level support for the <code>fs</code>, like log messages.</li>
<li> <code>ra</code>: Repository access.  Abstracted protocol handlers.</li>
<li> <code>wc</code>: Working copy handling.</li>
<li> <code>client</code>: Implements the commands for clients.</li>
</ul>

<p>
The first design decision was to drop the <code>wc</code> and
<code>ra</code> layers.  Elaborating the Subversion design mentality:
"Bandwidth is expensive, disks are cheap," we should really keep a
local copy for every revision -- and <code>SVN::Mirror</code> is
already available for such purposes.
    </p>

<p>
Having everything in a local repository, we don't need anything like
the bloated <code>wc</code> implementation at all.  The
<code>wc</code> library not only has the <code>.svn</code> metadata directory
to confuse your favorite utilities like <code>diff</code> and <code>grep</code>, but also stores
a text-base that makes your checkout twice the size of the actual
content.  XD (which is the character-wise increment of <code>wc</code>) was written
to maintain checkout copies in a lightweight manner.
    </p>

<p>
Next, I found the most important component of Subversion is not on the
above list.  It's the delta library that defines the API for
describing tree deltas; this is definitely the core thing in
tree-based version control systems.  It's called "Delta Editor."  
    </p>

<p>
For example, running a delta between revision 1 and revision 3 will
generate a series of method calls (<code>add_directory</code>,
<code>open_file</code>, <code>apply_textdelta</code>,
<code>close_file</code>, <code>close_directory</code>, etc.), to the
targeted editor object. These method calls describe the changes made
from revision 1 to revision 3.
    </p>

<p>
While <code>svk</code> was self-hosting within two months of development, I started to
refactor the existing code to center around this interface.  With Perl,
I could easily stack the editors together, making each editor do its own
job, adding arbitrary callbacks as extension to the API, and all of the fun
things you know you can do with Perl. Much of the functionality is
abstracted and it resulted in the following core components of <code>svk</code>:
    </p>

<ul>
<li> An editor that receives delta calls to modify the checkout copy.</li>

<li> A function to generate delta calls for describing the modification
  done to the checkout copy.</li>

<li> An editor that takes delta calls and merges them with a tree to generate
  non-conflicting calls.
      </li>
    </ul>

<p>
Together with these, the logic behind most of the commands became just
a question of gluing together a delta generator and the appropriate editors.
    </p>

<p>
Additionally, with Perl's flexible PerlIO layers system, keyword
expansion (like <code>$Id$</code> in <code>cvs</code>) was done within one
hour. The reusable part of this was abstracted out to the
<a href="http://search.cpan.org/perldoc?PerlIO::via::dynamic"><code>PerlIO::via::dynamic</code></a> module on CPAN.
    </p>
<p>
Now let's see <code>svk</code> in action.
    </p>

<h3>A First Look</h3>

<p>
I hate typing those long URLs when using Subversion.  So mapping repositories
to shorter names is a must:
    </p>

<pre><code>
    $ svk depotmap
</code></pre>

<p>
This will help you create a default repository at
<code>~/.svk/local</code>, and you could refer to it by
<code>//</code> in the future.  If you have a Subversion repository
on the disk, you could add another line: <code>test:
'/path/to/repos'</code>. Then you have immediate access to the
existing repository -- only with the shorter name <code>/test/</code>
instead of
<code>file:///long-path-plus-auto-complete-wont-work</code>.
    </p>

<p>
Now let's put something in it:
    </p>

<pre><code>
$ svk import //project/vendor /path/to/project-0.01
</code></pre>

<p>
This will do what you think: import things into
<code>//project/vendor</code>.  Repeat the command with a newer version
of this project, say 0.02, you'll have a vendor branch tracked on the
path.
    </p>

<p>
Like Subversion, branches and tags are implemented as cheap file
system copies:
    </p>

<pre><code>
$ svk cp -m 'development trunk for project' //project/vendor //project/trunk
</code></pre>

<p>
Now let's check it out:
    </p>

<pre><code>
$ svk checkout //project/trunk ~/work/project
</code></pre>

<p>
If you have experience with <code>cvs</code> or Subversion, you'll find it
familiar when trying to add, modify, remove, or commit files. <code>svk log</code>
will give a change history of files or directories.
    </p>

<p>
Suppose you import project-0.02 after branching trunk, and want to
merge the changes from the vendor branch. You just need to:
    </p>

<pre><code>
$ svk smerge //project/vendor //project/trunk
</code></pre>

<p>
<code>svk</code> remembers branch and merge history, so it does things
automatically for you.  If there are conflicts, just replace
<code>//project/trunk</code> with a checkout path such as
<code>~/project/trunk</code>.  You will be able to see the
conflicts. Resolve them and commit once done.  Merging is no more
painful.
    </p>

<p>
Once merged, you could bring the checkout copy of your trunk to the latest
revision with <code>svk update</code>.
    </p>

<h3>Working with Remote Repositories</h3>

<p>
As mentioned earlier, <code>svk</code> uses <code>SVN::Mirror</code> to handle
remote repository access.  You need to mirror them before you can
use them:
    </p>

<pre><code>
$ svk mirror //project/trunk https://svn.somewhere.org/repos/trunk
$ svk sync //project/trunk
</code></pre>

<p>
Currently you need to set up a Subversion server (either using Apache2
or <code>svnserve</code>). See relevant articles or tutorials about it.
    </p>

<p>
Now create a local branch, and prepare for traveling:
    </p>

<pre><code>
$ svk cp -m 'create a local branch' //project/trunk //project/local
</code></pre>

<p>
You could now check out <code>//project/local</code> and work on it
just as above.  Of course you could still create your own branch
with <code>cp //project/local //project/new-feature</code>.
    </p>

<p>
Use <code>svk sync</code> to sync the latest trunk when connected.  Merging the new
changes from trunk to your local branch works just like the previous
example of merging from a vendor branch.  How about merging your local
changes back to the remote repository?
</p>

<pre><code>
$ svk smerge //project/local //project/trunk
</code></pre>

<p>
Transparent, isn't it?
    </p>

<p>
You should use <code>smerge -C</code> in advance to check if there are conflicts.
Even if your local branch is not merged from the latest trunk, <code>svk</code> will
merge the changes for you and commit to the remote repository directly,
provided there's no conflicts.  But be sure to sync the latest trunk first.
    </p>

<p>
In fact, if you are online and about to commit a minor change, you
could forget about the process "modify on local branch, then merge
back." Just do:
    </p>

<pre><code>
$ svk switch //project/trunk
$ svk commit
</code></pre>

<p>
This first line means we now switch from the local branch to trunk,
which is the path containing the mirrored archive.  The switch command
will keep your local change and apply it to trunk as if those
modifications are done to a checkout of trunk.  Then the <code>svk
commit</code> on the mirrored path will just commit the changes
directly to the remote server and then sync the path for you.  If
the server is temporarily unavailable, just switch back to local and
merge back later.
    </p>
<p>
You could also merge individual changes. Find the change number you
want with <code>svk log</code>, and use:
    </p>

<pre><code>
$ svk cmerge -c 113,125-128,130 //project/trunk //project/stable
</code></pre>

<p>
Now if you are working on projects where you don't have the permission to
commit, you could easily generate a <code>diff</code> and submit it to the author:
    </p>
<pre><code>
$ svk diff //project/trunk //project/local
</code></pre>

<h3>Working with Multiple Repositories</h3>

<p>
Many people track development of several projects. Once you use <code>svk</code>
to mirror the projects, you can run <code>svk sync -a</code> to sync all of
them.
    </p>

<p>
Now suppose another hacker uses <code>svk</code> and adds a feature to the project
and publishes his own branch, and you wish to experiment with or utilize
his feature:
    </p>

<pre><code>
$ svk mirror //project/new-feature http://svn.somewhere.else/repos/trunk
$ svk sync //project/new-feature
</code></pre>

<p>
Then you could merge the changes from him:
    </p>

<pre><code>
$ svk smerge //project/new-feature ~/work/project
</code></pre>

<p>
Or you might decide to merge that branch to trunk directly:
    </p>

<pre><code>
$ svk smerge //project/new-feature //project/trunk
</code></pre>

<p>
You could also use the <code>cmerge</code> command described above to merge
specific changes only from that new-feature branch.
    </p>

<p>
This is the minimum case of the distributed development model.  The
idea is that everyone could create his private branch of the product
and then to be merged back by the maintainer.  There have been <a href="http://web.mit.edu/ghudson/thoughts/bitkeeper.whynot">arguments
against</a> such model, but I am not going into them
here. Although tools somehow promote certain models to solve problems,
we change the model or just use another tool when we have to.
    </p>

<p>
There are several features planned in the near future:
    </p>

    <dl>
<dt> Changeset signing and verification</dt>
      <dd>
  Signing the modified file in a commit with <code>gpg</code>. This is
  already done; it's just that the <code>SVN::Mirror</code> side
  hasn't been able to propagate and verify the signatures.
</dd>

<dt> VCP integration</dt>
<dd>
<p>  This would enable mirroring (and thus branching) from alien version
  control systems, like <code>cvs</code> or <code>perforce</code>.  Imagine:
</p>
<pre><code> $ svk mirror //foo/fromcvs cvs://cvs.server/foo@trunk</code></pre>

<p>  This will make me (and perhaps other people) more comfortable
  when working with projects which use other version control systems,
  and also less confused when switching between different command sets
  for working with different projects.</p>
      </dd>

<dt> Patch manager</dt>
<dd>
  Non-committers can already easily generate the <code>diff</code> as shown
  above.  While it would be good to register a merge history with the
  patch manager, large projects that need to merge many
  developer-submitted patches would find it handy to
  have a feature which allowed a review, then test, then click-to-apply
  for a particular change.
    </dd>
</dl>

<p>
The development of <code>svk</code> is rather rapid, so expect them coming soon!
    </p>

<h3>Conclusion</h3>
<p>
Five months after the birth of <code>svk</code>, it had become a fast,
full-featured distributed version control system. This is possible
mainly because the flexibility of Perl and the spirit of Perl -- use
something that exists to create new things.  Besides, the commands are
designed to DWIM!
    </p>

<p>
If you find it interesting, get a copy from the home page and install it
just like any other Perl module. Hopefully I'll then receive your
complaints, make <code>svk</code> better, and make the open source world more
productive.
    </p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2004/02/">&laquo; February 2004</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2004/04/">April 2004 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
