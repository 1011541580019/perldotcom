<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: January 2001 Archives</title>


    <link rel="prev" href="/pub/2000/12/" title="December 2000" />
    <link rel="next" href="/pub/2001/02/" title="February 2001" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">January 2001 Archives</h1>





                            
                            <div id="entry-1440" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/01/p5pdigest/THISWEEK-20010128.html" rel="bookmark">This Week on p5p 2001/01/28</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2001-01-30T00:00:00-08:00">January 30, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- This week on perl5-porters (22-28 Jan 2001) -->

<br />
<br />
      <h3><a name="Notes">Notes</a></h3>

</p>

<p>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></p>

<p>
Please send corrections and additions to 
<code>perl-thisweek-YYYYMM@simon-cozens.org</code> where 
<code>YYYYMM</code> is the current year and month.
</p>

<p>
There were 317 messages this week, not including test results.
<h3><a name="56x_delayed">5.6.x delayed</a></h3>

</p>

<p>

People seemed to think that this was monumental and catastrophic; it's
not, but I mention it anyway: Alan asked what was happening to 5.6.1 -
we've seen one trial release, and another one is eagerly expected.
Sarathy replied that he probably won't have time to do anything much
with it for the next few weeks, and offered to hand over maintainance of
5.6.x to anyone who wants it. People get busy; it's not the end of the
world.
</p>

<p>
Still, it does look like 5.6.1 is going to take a while to get out
there. Hold on tight, though; my crystal ball tells me that Jarkko's
been doing some work merging bleadperl patches into the 5.6 maintainance
branch.
<h3><a name="TestHarness_again">Test::Harness again</a></h3>

</p>

<p>

Michael Schwern's 
<a href="/pub/2001/01/p5pdigest/THISWEEK-20010121.html#TestHarness_Megapatch">valiant efforts with Test::Harness</a> are beginning to bear fruit, as he produced another 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg01428.html">megapatch</a> this week. This seemed to make a lot of people happier, but there were still 
some small problems with it; notably that it would choke if some output
arrived before the first &quot;ok&quot; or &quot;1..N&quot;, and that it failed its own test 
suite. The irony! But it's looking a lot closer to going in, and it's
looking a lot cleaner code. Nicholas Clark also noticed that you can
overwrite the 
<code>runtests</code> function to build several different perls and runs the tests on each o
of them. 
<h3><a name="Lots_of_test_results">Lots of test results</a></h3>

</p>

<p>

But this process - building Perl with lots of different options and
sending in the results - is one that a few people (Notably Alan, Merijn
and Abigail) have already been doing, and P5P has been near innundated
with OK and Not OK reports. Jarkko suggested that some kind of
summarizing program should be run over the results, and  
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg01619.html">Merijn provided one</a>. (The link is actually to an updated version he posted later in the
week.) It tests Perl in lots of different configurations in all of the
different possible IO subsystems. If you've got any kind of non-obvious
operating system, lots of spare cycles, and you're following the rsync Perl, 
it would be great if you could play with it!
<h3><a name="The_hashing_function">The hashing function</a></h3>

</p>

<p>

When Perl stores an element in a hash, it creates a ``hash value'' for
the key, and then does the moral equivalent of
</p>

</p><pre>
    $hashvalue = hash_it($key);
    push @{$hash[$hashvalue % 8]}, {key => $key, value => $element};
</pre>

<p>
distributing the keys over 8 ``buckets''. The key, if you'll pardon the
pun, to good hashing is to get the elements evenly distributed in the
buckets. If you get eight elements in eight different buckets, your
element is guaranteed to be the first thing in the bucket, and you can
fetch it back quickly - if you get them all in the same bucket, you may
have to skip over seven other elements to find yours. Hence a good
hashing function is essential for efficient hash access.
</p>

<p>
The one Perl uses at the moment looks like this:
</p>

</p><pre>
        while (i_PeRlHaSh--)
             hash_PeRlHaSh = hash_PeRlHaSh * 33 + *s_PeRlHaSh++;
        (hash) = hash_PeRlHaSh + (hash_PeRlHaSh>>5);
</pre>

<p>
(In Perl, that would be something like
</p>

</p><pre>
    $hash = $hash * 33 + ord($_) for split //, $key;
    $hash += $hash >> 5;
</pre>

<p>
)
</p>

<p>
Nick Clark found that by applying 
<a href="http://www.lysator.liu.se/c/duffs-device.html#duffs-device">Duff's device </a> to the hashing function he could get a 2% speedup; this led to Yet
Another Benchmarking Argument, and Nick Ing-Simmons rightly pointing out
that you can usually get a 2% speedup in the test suite merely by
running the test suite again with no changes. Still, it was fun while
it lasted - Nick's implementation is
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg01262.html">here</a>.
</p>

<p>
Next up was Mark Leighton Fisher, who provided a patch to make Perl use 
Bob Jenkins' 
<a href="http://burtleburtle.net/bob/hash/doobs.html">``One-at-a-time''</a> hash function. There was no noticable speedup in the Perl benchmarking
suite, but it did cause a lot of otherwise sensible programmers to write
a lot of assembly code for no apparent reason.
<h3><a name="chop_examples">chop examples</a></h3>

</p>

<p>

Michael Schwern has been cleaning up the perlfunc documentation, and
putting in useful examples; unfortunately, he's stuck on finding useful
examples for 
<code>chop</code>. Some people have surmised that this is because 
<code>chop</code> is fundamentally useless, and there's a proposal 
<!-- from someone who really ought to know better -->  that it should be 
<a href="http://dev.perl.org/rfc/195.html">outlawed in Perl 6</a>. Well, who knows, but we all certainly had a hard time thinking of
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg01503.html">handy things to do with it</a>. Can you come up with anything better?
<h3><a name="PerlIO_programming_documentation">PerlIO programming documentation</a></h3>

</p>

<p>

Thanks to Nick Ing-Simmons, PerlIO (remember that?) has now got some
documentation about how to program it; the original 
<code>perlapio.pod</code> (which has actually been there for years but nobody reads it) has been
updated, and if you look in snapshots from now on, you'll find 
<code>perliol.pod</code> which is all about how IO layers work.
</p>

<p>
By the way, the module authors amongst you out there are using the
PerlIO abstraction layer instead of assuming 
<code>FILE*</code>, right? Good.
<h3><a name="ltltlt_and_gtgtgt_ops">&lt;&lt;&lt; and &gt;&gt;&gt; ops</a></h3>

</p>

<p>

<!-- Crack-headed suggestion of the week came from --> John Allen <!-- who -->suggested that Perl should have two new bit-twiddling operators:
<code>>>></code> would be a right shift without sign extension under 
<code>use integer</code>, and 
<code><<<</code> would be a left roll.
</p>

<p>
Several people pointed out that this was horribly assymetrical, that it
made evil assumptions about integer size, and that it probably wouldn't
win that much anyway. Which is a shame, because we all do so much
low-level bit-twiddling in Perl...
<h3><a name="Feature_testing_and_our">Feature testing and <code>our()</code></a></h3>

</p>

<p>

MJD inquired as to why 
<code>h2xs</code> was producing code that wanted Perl 5.005_62. It transpired that this
was when 
<code>our</code> variables were introduced, and now 
<code>h2xs</code> declares variables like 
<code>$VERSION</code> to be 
<code>our</code> variables.
</p>

<p>
Jarkko said it would be a lot cleaner to be able to say 
<code>use feature 'our'</code> to defend against people doing things like backporting 
<code>our</code> to earlier Perls. Tom Hughes provided a sample implementation of the
pragma that wasn't quite right, and further discussion was needed as to
what Jarkko intended. One way of doing it would be to have a module
which has a hash of feature names and the version numbers in which they
were introduced, and checks that the program requesting a given set of features
is running on a Perl that can supply them. I don't know if that'd be a
good idea, but if it's your idea of fun, by all means implement it and
send it in...
<h3><a name="Win32_and_ActiveState_Perl_Configuration">Win32 and ActiveState Perl Configuration</a></h3>

</p>

<p>

Indy Singh noted that the defaults you get when you're building your own
perl on Win32 don't allow you to use pre-compiled binary modules from
the various repositories such as ActiveState's, and sent in a patch to
correct this by making the defaults the same as AS use. 
</p>

<p>
Sarathy objected, on the grounds that the current options
are a lot faster and ask less of compilers, and that:
<blockquote></p>

<p>

I think 99% of the people relying on module repositories don't build
their own perl, and the ones that do are smart enough to enable the
options they need.  OTOH, I suspect most people building perl on
their own on Windows need maximal efficiency and compatibility with
Unix.
</p>

<p>
So I think the older defaults make more sense than the newer ones.
</blockquote></p>

<p>

His compromise would be an `ActiveState compatibility flag' that people
building their own perls could set, which would turn on the same options
that ActiveState use at a stroke. Indy objected to Sarathy's objection,
but Sarathy pointed out that he did not actually want people to pessimize
the default Win32 configuration:
<blockquote></p>

<p>
Wearing my ActiveState hat, I'd be more than happy if the defaults
set all the options to what ActiveState uses now or will be using in
future, but I thought I should point out the downsides regardless.
</blockquote><!-- So much for the conspiracy theories. --></p>

<p>

Tim Jenness then raised another ActiveState config point: ActiveState's
build of Perl on Solaris uses Perl's own implementation of 
<code>malloc</code>. People had reported problems using this in conjunction with PDL, and
there have been other known `issues' with Perl's 
<code>malloc</code>, especially when dealing with 64-bit systems. Sarathy said that it
should be considered for 5.7.x, but not in the 5.6.x builds to avoid breaking 
binary compatibility.
<h3><a name="Various">Various</a></h3>

</p>

<p>

Ilya's mad patch of the week was to allow 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg01380.html">overloading of int()</a>; shame he didn't look at 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg01600.html">lvalue overloading</a> while he was at it. Peter Prymmer provided MVS users with 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg01381.html">dynamic loading on OS/390</a>. (as well as lots of other useful OS/390 fixes.) There was another
debate about the meaninglessness of benchmarking.
Yes, floating point arithmetic is still imprecise. We know. 
<!-- However, thanks to Nick Clark, integer arithmetic can be imprecise too. --></p>

<p>
Unicode. There, I've mentioned it.
</p>

<p>
Until next week I remain, your humble and obedient servant,
</p>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Cozens</a>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1422" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/01/soap.html" rel="bookmark">Quick Start with SOAP</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Paul Kulchenko</span> on <abbr class="published" title="2001-01-29T00:00:00-08:00">January 29, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- <a name="quick start with soap">Quick Start with SOAP</a> -->

<br />
 <p> 
<table align="right" border="1" cellpadding="4" cellspacing="0" width="180"> <tbody> <tr> 
<td align="middle" bgcolor="#6699cc" valign=top><font color=#ffffff>Table of Contents</font></td></tr> 
<tr> 
<td> 
<p class="fine">&#149;<a href="#quick start with soap">Quick Start with SOAP</a><br />&#149;<a href="#writing a cgibased server">Writing a CGI-based 
      Server</a><br />&#149;<a href="#client">Client</a><br />&#149;<a 
      href="#passing values">Passing Values</a><br />&#149;<a 
      href="#autodispatching">Autodispatching</a><br />&#149;<a 
      href="#objects access">Objects access</a><br />&#149;<a 
      href="#error handling">Error handling</a><br />&#149;<a 
      href="#service dispatch (different services on one server)">Service 
      dispatch (different services on one server)</a><br />&#149;<a 
      href="#types and names">Types and Names</a><br />&#149;<a 
      href="#conclusion">Conclusion</a><br /><br />
	  
	  <b><a href="/pub/2001/04/24/soap.html">Part 2 of this series</b></p></td></tr> 
	  </table> <p>SOAP (Simple Object Access Protocol) is a way for you to remotely make method 
calls upon classes and objects that exist on a remote server. It's the latest in 
a long series of similar projects like CORBA, DCOM, and XML-RPC.</p> <p>SOAP specifies a standard way to encode parameters and return values in XML, 
and standard ways to pass them over some common network protocols like HTTP 
(web) and SMTP (email). This article, however, is merely intended as a quick 
guide to writing SOAP servers and clients. We will hardly scratch the surface of 
what's possible.</p> <p>We'll be using the <strong>SOAP::Lite</strong> module from CPAN. Don't be 
mislead by the "Lite" suffix--this refers to the effort it takes to use the 
module, not its capabilities. </p>
<h3><a name="writing a cgibased server">Writing a CGI-based Server</a></h3>

<p><a href="/2001/01/files/SOAP-Lite-guide.tar.gz">Download source files mentioned in this article here.</a>
 <p>Here's a simple CGI-based SOAP server (hibye.cgi):</p>
<pre> #!perl -w

  use SOAP::Transport::HTTP;

  SOAP::Transport::HTTP::CGI   
    -&gt; dispatch_to('Demo')     
    -&gt; handle;

  package Demo;

  sub hi {                     
    return "hello, world";     
  }

  sub bye {                    
    return "goodbye, cruel world";
  }
</pre> 

<!--cs_ora_nc-->
<table width="170" border="0" cellspacing="0" cellpadding="20" align="right">
<tr>
<td width="170" valign="top" bgcolor="#ffffff">
<hr size="1" color="#6699cc"><br />
<font size="-1" color="#6699cc"><b><p>
<a href="/pub/au/Kulchenko_Paul">Paul Kulchenko</a></b> is a featured speaker at the upcoming O'Reilly Open
Source Convention in San Diego, CA, July 23 - 27, 2001. Take this
opportunity to rub elbows with open source leaders while relaxing in the
beautiful setting of the beach-front Sheraton San Diego Hotel and Marina.
For more information, visit our <a
href="http://conferences.oreilly.com/oscon/">conference home page</a>. You
can register online.</p></b></font><hr size="1" color="#6699cc"><br /></td>
</tr>
</table>
<!--/cs_ora_nc-->

<p>There are basically two parts to this: the first four lines set up a SOAP 
wrapper around a class. Everything from 'package Demo' onward is the class being 
wrapped.</p> <p>In the previous version of specification (1.0), SOAP over HTTP was supposed 
to use a new HTTP method, M-POST. Now it's common to try a normal POST first, 
and then use M-POST if the server needs it. If you don't understand the 
difference between POST and M-POST, don't worry, you don't need to know all the 
specific details to be able to use the module.</p> <p> <h3><a name=client>Client</a></h3> <p>This client prints the results of the <code>hi()</code> method call (hibye.pl):</p><pre> #!perl -w
  
  use SOAP::Lite;

  print SOAP::Lite                                             
    -&gt; uri('<a href="http://www.soaplite.com/Demo">http://www.soaplite.com/Demo</a>')                                             
    -&gt; proxy('<a href="http://services.soaplite.com/hibye.cgi">http://services.soaplite.com/hibye.cgi</a>')
    -&gt; hi()                                                    
    -&gt; result;</pre> <p>The <a href="#item_uri"><code>uri()</code></a> identifies the class to the 
server, and the <a href="#item_proxy"><code>proxy()</code></a> identifies the 
location of the server itself. Since both look like URLs, I'll take a minute to 
explain the difference, as it's <strong>quite important</strong>.</p> <dl> <dt><strong><a name=item_proxy><code>proxy()</code></a></strong><br /> <dd><a href="#item_proxy"><code>proxy()</code></a> is simply the address of 
  the server to contact that provides the methods. You can use http:, mailto:, 
  even ftp: URLs here. 
  <p></p> <dt><strong><a name=item_uri><code>uri()</code></a></strong><br /> <dd>Each server can offer many different services through the one proxy() URL. 
  Each service has a unique URI-like identifier, which you specify to SOAP::Lite 
  through the uri() method. If you get caught up in the gripping saga of the 
  SOAP documentation, the "namespace" corresponds to the uri() method. 
  <p></p></dd></dl> <dl></dl> <p>If you're connected to the Internet, you can run your client, and you should 
see:</p><pre> hello, world

</pre> <p>That's it!</p> <p>If your method returns multiple values (hibye.cgi):</p><pre> #!perl -w

  use SOAP::Transport::HTTP;

  SOAP::Transport::HTTP::CGI      
    -&gt; dispatch_to('Demo')        
    -&gt; handle;

  package Demo;

  sub hi {                        
    return "hello, world";        
  }

  sub bye {                       
    return "goodbye, cruel world";
  }

  sub languages {                 
    return ("Perl", "C", "sh");   
  }</pre> <p>Then the <code>result()</code> method will only return the first. To access 
the rest, use the <code>paramsout()</code> method (hibyeout.pl):&gt;</p><pre> #!perl -w

  use SOAP::Lite;

  $soap_response = SOAP::Lite                                  
    -&gt; uri('<a href="http://www.soaplite.com/Demo">http://www.soaplite.com/Demo</a>')                                             
    -&gt; proxy('<a href="http://services.soaplite.com/hibye.cgi">http://services.soaplite.com/hibye.cgi</a>')
    -&gt; languages();

  @res = $soap_response-&gt;paramsout;

  $res = $soap_response-&gt;result;                               
  print "Result is $res, outparams are @res\n";</pre> <p>This code will produce:</p><pre> Result is Perl, outparams are Perl C sh

</pre> <h3><a name="passing values">Passing Values</a></h3> <p>Methods can take arguments. Here's a SOAP server that translates between 
Fahrenheit and Celsius (temper.cgi):</p><pre> #!perl -w

  use SOAP::Transport::HTTP;

  SOAP::Transport::HTTP::CGI
    -&gt; dispatch_to('Temperatures')
    -&gt; handle;

  package Temperatures;

  sub f2c {
      my ($class, $f) = @_;
      return 5 / 9 * ($f - 32);
  }

  sub c2f {
      my ($class, $c) = @_;
      return 32 + $c * 9 / 5;
  }</pre> <p>And here's a sample query (temp.pl):</p><pre> #!perl -w

  use SOAP::Lite;

  print SOAP::Lite                                            
    -&gt; uri('<a href="http://www.soaplite.com/Temperatures">http://www.soaplite.com/Temperatures</a>')                                    
    -&gt; proxy('<a href="http://services.soaplite.com/temper.cgi">http://services.soaplite.com/temper.cgi</a>')
    -&gt; c2f(37.5)                                              
    -&gt; result;

</pre> <p>You can also create an object representing the remote class, and then make 
method calls on it (tempmod.pl):</p><pre> #!perl -w

  use SOAP::Lite;

  my $soap = SOAP::Lite                                        
    -&gt; uri('<a href="http://www.soaplite.com/Temperatures">http://www.soaplite.com/Temperatures</a>')                                     
    -&gt; proxy('<a href="http://services.soaplite.com/temper.cgi">http://services.soaplite.com/temper.cgi</a>');

  print $soap                                                  
    -&gt; c2f(37.5)                                               
    -&gt; result;

</pre> <h3><a name=autodispatching>Autodispatching</a></h3> <p>This being Perl, there's more than one way to do it: SOAP::Lite provides an 
alternative client syntax (tempauto.pl).</p><pre> #!perl -w

  use SOAP::Lite +autodispatch =&gt;

    uri =&gt; '<a href="http://www.soaplite.com/Temperatures">http://www.soaplite.com/Temperatures</a>',
    proxy =&gt; '<a href="http://services.soaplite.com/temper.cgi">http://services.soaplite.com/temper.cgi</a>';

  print c2f(37.5);

</pre> <p>After you specify the uri and proxy parameters, you are able to call remote 
functions with the same syntax as local ones (e.g., c2f). This is done with 
UNIVERSAL::AUTOLOAD, which catches all unknown method calls. Be warned that 
<strong>all</strong> calls to undefined methods will result in an attempt to use 
SOAP.</p> <h3><a name="objects access">Objects access (it's 'Simple <b>Object</b> access 
protocol', isn't it?)</a></h3> <p>Methods can also return real objects. Let's extend our 
<code>Temperatures</code> class with an object-oriented interface (temper.cgi):</p><pre> #!perl -w

  use SOAP::Transport::HTTP;

  SOAP::Transport::HTTP::CGI
    -&gt; dispatch_to('Temperatures')
    -&gt; handle;

  package Temperatures;

  sub f2c {
      my ($class, $f) = @_;
      return 5/9*($f-32);
  }

  sub c2f {
      my ($class, $c) = @_;
      return 32+$c*9/5;
  }

  sub new {
      my $self = shift;
      my $class = ref($self) || $self;
      bless {_temperature =&gt; shift} =&gt; $class;
  }

  sub as_fahrenheit {
      return shift-&gt;{_temperature};
  }

  sub as_celsius {
      my $self = shift;
      return $self-&gt;f2c( $self-&gt;{_temperature} );
  }

</pre> <p>Here is a client that accesses this class (tempobj.pl):</p><pre> #!perl -w
  
  use SOAP::Lite;

  my $soap = SOAP::Lite
    -&gt; uri('<a href="http://www.soaplite.com/Temperatures">http://www.soaplite.com/Temperatures</a>')
    -&gt; proxy('<a href="http://services.soaplite.com/temper.cgi">http://services.soaplite.com/temper.cgi</a>');

  my $temperatures = $soap
    -&gt; call(new =&gt; 100) # accept Fahrenheit  
    -&gt; result;

  print $soap
    -&gt; as_celsius($temperatures)
    -&gt; result;</pre> <p>Similar code with autodispatch is shorter and easier to read (tempobja.pl):</p><pre> #!perl -w

  use SOAP::Lite +autodispatch =&gt;
    uri =&gt; '<a href="http://www.soaplite.com/Temperatures">http://www.soaplite.com/Temperatures</a>',
    proxy =&gt; '<a href="http://services.soaplite.com/temper.cgi">http://services.soaplite.com/temper.cgi</a>';

  my $temperatures = Temperatures-&gt;new(100);
  print $temperatures-&gt;as_fahrenheit();
</pre> <h3><a name="error handling">Error handling</a></h3> <p>A SOAP call may fail for numerous reasons, such as transport error, incorrect 
parameters, or an error on the server. Transport errors (which may occur if, for 
example, there is a network break between the client and the server) are dealt 
with below. All other errors are indicated by the <code>fault()</code> method 
(temperr.pl):</p><pre> #!perl -w

  use SOAP::Lite;

  my $soap = SOAP::Lite
    -&gt; uri('<a href="http://www.soaplite.com/Temperatures">http://www.soaplite.com/Temperatures</a>')
    -&gt; proxy('<a href="http://services.soaplite.com/temper.cgi">http://services.soaplite.com/temper.cgi</a>');</pre><pre> my $result = $soap-&gt;c2f(37.5);

  unless ($result-&gt;fault) {
    print $result-&gt;result();
  } else {
    print join ', ', 
      $result-&gt;faultcode, 
      $result-&gt;faultstring, 
      $result-&gt;faultdetail;
  }

</pre> <p><code>faultcode()</code> gives you information about the main reason for the 
error. Possible values may be:</p> <dl> <dt><strong><a 
  name=item_client%3a_you_provided_incorrect_information_in_th>Client: you 
  provided incorrect information in the request.</a></strong><br /> <dd>This error may occur when parameters for the remote call are incorrect. 
  Parameters may be out-of-bounds, such as negative numbers, when positive 
  integers are expected; or of an incorrect type, for example, a string is 
  provided where a number was expected. 
  <p></p> <dt><strong><a 
  name=item_server%3a_something_is_wrong_on_the_server_side%2e>Server: something 
  is wrong on the server side.</a></strong><br /> <dd>This means that provided information is correct, but the server couldn't 
  handle the request because of temporary difficulties, for example, an 
  unavailable database. 
  <p></p> <dt><strong><a 
  name=item_mustunderstand%3a_header_elements_has_mustundersta>MustUnderstand: 
  Header elements has mustUnderstand attribute, but wasn't understood by 
  server.</a></strong><br /> <dd>The server was able to parse the request, but the client is requesting 
  functionality that can't be provided. For example, suppose that a request 
  requires execution of SQL statement, and the client wants to be sure that 
  several requests will be executed in one database transaction. This could be 
  implemented as three different calls with one common TransactionID. 
  <p>In this case, the SOAP header may be extended with a new header element 
  called, say, 'TransactionID', which carries a common identifier across the 3 
  separate invocations. However, if server does not understand the provided 
  TransactionID header, it probably won't be able to maintain transactional 
  integrity across invocations. To guard against this, the client may indicate 
  that the server 'mustUnderstand' the element 'TransactionID'. If the server 
  sees this and does NOT understand the meaning of the element, it will not try 
  and process the requests in the first place. 
  <p>This functionality makes services more reliable and distributed systems 
  more robust.</p> <dt><strong><a 
  name=item_versionmismatch%3a_the_server_can%27t_understand_t>VersionMismatch: 
  the server can't understand the version of SOAP used by the 
  client.</a></strong><br /> <dd>This is provided for (possible) future extensions, when new versions of 
  SOAP may have different functionality, and only clients that are knowledgeable 
  about it will be able to properly use it. 
  <p></p> <dt><strong><a name=item_other_errors>Other errors</a></strong><br /> <dd>The server is allowed to create its own errors, like 
  <strong>Client.Authentication</strong>. 
  <p></p></dd></dl> <p><code>faultstring()</code> provides a readable explanation, whereas 
<code>faultdetail()</code> gives access to more detailed information, which may 
be a string, object, or more complex structure.</p> <p>For example, if you change <strong>uri</strong> to something else (let's try 
with <code>'Test'</code> instead of <code>'Temperatures'</code>), this code will 
generate:</p><pre> Client, Bad Class Name, Failed to access class (Test)

</pre> <p>By default client will <strong>die with diagnostic</strong> on <em>transport 
errors</em> and <strong>do nothing</strong> for <em>faulted calls</em>, so, 
you'll be able to get fault info from result. You can alter this behavior with 
<code>on_fault()</code> handler either per object, so it will die on both 
transport errors and SOAP faults (temperrh.pl):</p><pre> #!perl -w

  use SOAP::Lite;

  my $soap = SOAP::Lite
    -&gt; uri('<a href="http://www.soaplite.com/Temperatures">http://www.soaplite.com/Temperatures</a>')
    -&gt; proxy('<a href="http://services.soaplite.com/temper.cgi">http://services.soaplite.com/temper.cgi</a>')

    -&gt; on_fault(sub { my($soap, $res) = @_; 
         die ref $res ? $res-&gt;faultdetail : $soap-&gt;transport-&gt;status, "\n";
       });</pre> <p>Or you can set it globally (temperrg.pl):</p><pre> #!perl -w

  use SOAP::Lite

    on_fault =&gt; sub { my($soap, $res) = @_; 
      die ref $res ? $res-&gt;faultdetail : $soap-&gt;transport-&gt;status, "\n";
    };

  my $soap = SOAP::Lite
    -&gt; uri('<a href="http://www.soaplite.com/Temperatures">http://www.soaplite.com/Temperatures</a>')
    -&gt; proxy('<a href="http://services.soaplite.com/temper.cgi">http://services.soaplite.com/temper.cgi</a>');</pre> <p>Now, wrap your SOAP call into an <code>eval {}</code> block, and catch both 
transport errors and SOAP faults (temperrg.pl):</p><pre> #!perl -w

  use SOAP::Lite

    on_fault =&gt; sub { my($soap, $res) = @_; 
      die ref $res ? $res-&gt;faultdetail : $soap-&gt;transport-&gt;status, "\n";
    };

  my $soap = SOAP::Lite
    -&gt; uri('<a href="http://www.soaplite.com/Temperatures">http://www.soaplite.com/Temperatures</a>')
    -&gt; proxy('<a href="http://services.soaplite.com/temper.cgi">http://services.soaplite.com/temper.cgi</a>');

  eval { 
    print $soap-&gt;c2f(37.5)-&gt;result; 
  1 } or die;

</pre> <p>You may also consider this variant that will return <code>undef</code> and 
setup <code>$!</code> on failure, just like many Perl functions do (temperrv.pl):</p><pre> #!perl -w

  use SOAP::Lite
    on_fault =&gt; sub { my($soap, $res) = @_; 
      eval { die ref $res ? $res-&gt;faultdetail : $soap-&gt;transport-&gt;status };
      return ref $res ? $res : new SOAP::SOM;
    };

  my $soap = SOAP::Lite
    -&gt; uri('<a href="http://www.soaplite.com/Temperatures">http://www.soaplite.com/Temperatures</a>')
    -&gt; proxy('<a href="http://services.soaplite.com/temper.cgi">http://services.soaplite.com/temper.cgi</a>');

  defined (my $temp = $soap-&gt;c2f(37.5)-&gt;result) or die;

  print $temp;

</pre> <p>And finally, if you want to ignore errors (however, you can still check for 
them with the <code>fault()</code> method call):</p><pre> use SOAP::Lite
    on_fault =&gt; sub {};

</pre> <p>or</p><pre> my $soap = SOAP::Lite
    -&gt; on_fault(sub{})
    ..... other parameters

</pre> <h3><a name="service dispatch (different services on one server)">Service 
dispatch (different services on one server)</a></h3> <p>So far our CGI programs have had a single class to handle incoming SOAP 
calls. But we might have one CGI program that dispatches SOAP calls to many 
classes. </p> <p>What exactly is <strong>SOAP dispatch</strong>? When a SOAP request is 
recieved by a server, it gets bound to the class specified in the request. The 
class could be already loaded on server side (on server startup, or as a result 
of previous calls), or might be loaded on demand, according to server 
configuration. <strong>Dispatching</strong> is the process of determining of 
which class should handle a given request, and loading that class, if necessary. 
<strong>Static</strong> dispatch means that name of the class is specified in 
configuration, whereas <strong>dynamic</strong> means that only a pool of 
classes is specified, in, say, a particular directory, and that any class from 
this directory can be accessed.</p> <p>Imagine that you want to give access to two different classes on the server 
side, and want to provide the same 'proxy' address for both. What should you do? 
Several options are available:</p> <dl> <dt><strong><a name=item_static_internal>Static internal</a></strong><br /> <dd>... Which you are already familiar with (hibye.cgi): <pre>  use SOAP::Transport::HTTP;

  SOAP::Transport::HTTP::CGI   
    -&gt; dispatch_to('Demo')     
    -&gt; handle;

  package Demo;

  sub hi {                     
    return "hello, world";     
  }

  sub bye {                    
    return "goodbye, cruel world";
  }

  1;

</pre> <p></p> <dt><strong><a name=item_static_external>Static external</a></strong><br /> <dd>Similar to <a href="#item_Static_internal"><code>Static 
  internal</code></a>, but the module is somewhere outside of server code (hibyeout.cgi): <pre>  use SOAP::Transport::HTTP;

  use Demo;

  SOAP::Transport::HTTP::CGI   
    -&gt; dispatch_to('Demo')     
    -&gt; handle;

</pre> <p>The following module should, of course, be somewhere in a directory listed 
  in @INC (Demo.pm):</p><pre> package Demo;

  sub hi {                     
    return "hello, world";     
  }

  sub bye {                    
    return "goodbye, cruel world";
  }

  1;
</pre> <dt><strong><a name=item_dynamic>Dynamic</a></strong><br /> <dd>As you can see in both <a href="#item_Static_internal"><code>Static 
  internal</code></a> and <a href="#item_Static_external"><code>Static 
  external</code></a> modes, the module name is hardcoded in the server code. 
  But what if you want to be able to add new modules dynamically without 
  altering the server? Dynamic dispatch allows you to do it. Specify a 
  directory, and any module in this directory becomes available for dispatching 
  (hibyedyn.cgi): <pre> #!perl -w

  use SOAP::Transport::HTTP;

  SOAP::Transport::HTTP::CGI

    -&gt; dispatch_to('/home/soaplite/modules')

    -&gt; handle;

</pre> <p>Then put <code>Demo.pm</code> in <code>/home/soaplite/modules</code> directory (Demo.pm):</p><pre> package Demo;

  sub hi {                     
    return "hello, world";     
  }

  sub bye {                    
    return "goodbye, cruel world";
  }

  1;

</pre> <p>That's it. <strong>Any</strong> module you put in 
  <code>/home/soaplite/modules</code> is available now, but don't forget that 
  the URI specified on the client side should match module/class name you want 
  to dispatch your call to.</p> <dt><strong><a name=item_mixed>Mixed</a></strong><br /> <dd>What do we need this for? Unfortunately, dynamic dispatch also has a 
  significant disadvantage: Access to @INC is disabled for the purposes of 
  dynamic dispatch, for security reasons. To work around this, you can combine 
  dynamic and static approaches. All you need to do is this (hibyemix.cgi):
  <p></p><pre> #!perl -w

  use SOAP::Transport::HTTP;

  SOAP::Transport::HTTP::CGI

    -&gt; dispatch_to('/home/soaplite/modules', 'Demo', 'Demo1', 'Demo2')

    -&gt; handle;

</pre> <p>Now Demo, Demo1, and Demo2 are pre-loaded from anywhere in @INC, but 
  dynamic access is enabled for any modules in 
  <code>/home/soaplite/modules</code>, and they'll be loaded on 
demand.</p></dd></dl> <h3><a name="types and names">Types and Names</a></h3> <p>So far as Perl is typeless language (in a sense that there is no difference 
between integer <code>123</code> and string <code>'123'</code>), it greatly 
simplifies the transformation process from SOAP message to Perl data. For most 
simple data, we can just ignore typing at this stage. However, this approach has 
drawbacks also: we need to provide additional information during generation of 
our SOAP message, because the other server or client may expect type 
information. SOAP::Lite doesn't force you to type every parameter explicitly, 
but instead tries to guess each data type based on actual values in question 
(according to another of Perl's mottos, DWIM, or 'Do What I Mean').</p> <p>For example, a variable that has the value <code>123</code> becomes an 
element of type <code>int</code> in a SOAP message, and a variable that has the 
value <code>'abc'</code> becomes type <code>string</code>. However, there are 
more complex cases, such as variables that contain binary data, which must be 
Base64-encoded, or objects (blessed references), as another example, which are 
given type and name (unless specified) according to their Perl package.</p> <p>The autotyping may not work in all cases, though. There is no default way to 
make an element with type <code>string</code> or type <code>long</code> from a 
value of <code>123</code>, for example. You may alter this behavior in several 
ways. First, you may disable autotyping completely (by calling the 
<code>autotype()</code> with a value of 0), or change autotyping for different 
types.</p> <p>Alternately, you may use objects from the SOAP::Data class to explicitly 
specify a type for a particular variable:</p><pre> my $var = SOAP::Data-&gt;type( string =&gt; 123 );

</pre> <p><code>$var</code> becomes an element with type <code>string</code> and value 
<code>123</code>. You may use this variable in ANY place where you use ordinary 
Perl variables in SOAP calls. This also allows you to provide not only specific 
<strong>data types</strong>, but also specific <strong>name</strong> and 
<strong>attributes</strong>.</p> <p>Since many services count on <strong>names</strong> of parameters (instead of 
<strong>positions</strong>) you may specify names for request parameters using 
the same syntax. To add a name to <code>$var</code> variable, call 
<code>$var-&gt;name('myvar')</code>, or even chain calls with the 
<code>type()</code> method: <pre> my $var = SOAP::Data-&gt;type(string =&gt; 123)-&gt;name('myvar');

  # -- OR --
  my $var = SOAP::Data-&gt;type('string')-&gt;name(myvar =&gt; 123);

  # -- OR --
  my $var = SOAP::Data-&gt;type('string')-&gt;name('myvar')-&gt;value(123);

</pre> <p>You may always get or set the value of a variable with <code>value()</code> method:</p><pre> $var-&gt;value(321);            # set new value

  my $realvalue = $var-&gt;value; # store it in variable

</pre> <h3><a name=conclusion>Conclusion</a></h3> 

<p>This should be enough to get you started building SOAP applications. 
You can read the manpages (or even the source, if you're brave!) to
learn more, and don't forget to keep checking <a
href="http://www.soaplite.com/">www.soaplite.com</a> for more
documentation, examples, and SOAP-y fun.</p>

<p><b>Part 2 of this article can be found <a href="/pub/2001/04/24/soap.html">here</a></b>

<hr noshade size=1>  <p>Major contributors:</p> <dl> <dt><strong><a name=item_nathan_torkington>Nathan Torkington</a></strong><br /> <dd>Basically started this work and pushed the whole process. 
  <p></p> <dt><strong><a name=item_tony_hong>Tony Hong</a></strong><br /> <dd>Invaluable comments and input help me keep this material fresh and simple. 

<p>This piece continues <a href="/pub/2001/04/24/soap.html">here</a>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1438" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/01/p5pdigest/THISWEEK-20010121.html" rel="bookmark">This Week on p5p 2001/01/21</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2001-01-24T00:00:00-08:00">January 24, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- This week on perl5-porters (15-21 Jan 2001) -->

<br />
<br />
      <H3><a name="Notes">Notes</a></H3>


<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#sigsetjmp_wrangling_continues">sigsetjmp wrangling continues</a>
  <li><a href="#Safe_Signals">Safe Signals</a>
  <li><a href="#Large_file_support_wrangling_continues">Large file support wrangling continues</a>
  <li><a href="#Multiple_Pre_Incrementing">Multiple Pre-Incrementing</a>
  <li><a href="#TestHarness_Megapatch">Test::Harness Megapatch</a>
  <li><a href="#Tokeniser_reporting_and_pretty_printing">Tokeniser reporting and pretty-printing</a>
  <li><a href="#Unicode">Unicode </a>
  <li><a href="#Various">Various</a>
</ul>

</P>

<P>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>perl-thisweek-YYYYMM@simon-cozens.org</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
<H3><a name="sigsetjmp_wrangling_continues">sigsetjmp wrangling continues</a></H3>

</P>

<P>

Last week, there was some discussion about whether Perl ought to use 
<CODE>sigsetjmp</CODE> to jump out of 
<CODE>eval</CODE>s and to 
<CODE>die</CODE>. Part of the problem is that 
<CODE>sigsetjmp</CODE> is quite a lot slower than 
<CODE>setjmp</CODE>, so if we can get by without it, we ought to. Nick Ing-Simmons has
removed 
<CODE>sigsetjmp</CODE> from the current sources, but now Nick Clark has found that this can
sometimes cause a slowdown due to bizarre optimizing.
</P>

<P>
The discussion then veered onto the problems of using any sort of
non-local jump with threads. Alan pointed out that neither 
<CODE>sigjmp</CODE> nor 
<CODE>sigsetjmp</CODE> were thread-safe at all, and since Perl uses them, Perl's threading
implementation is horrifically broken.
<!-- well, tell us something we didn't already know. -->There were no good suggestions <!-- but a couple of bad ones --> about how to get around this, or to getaway without non-local jumps for trapping exceptions. Alan declared Perl
5 beyond hope, but said:
<blockquote></P>

<P>
If perl6 has 
something akin to the perl5 stack, eval/die will have to be implemented  
so that that it rolls back up the stack on die, rather than the current   
longjmp hack.
</blockquote></P>

<P>
Alan also suggested that we would need to roll our own threading model
in Perl 6 to have full control over exception handling; the discussion
carried on about Perl 6 over on the 
<CODE>perl6-internals</CODE> mailing list.
</P>

<P>
The part where it gets interesting this week starts
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg01023.html">here</a>.
<H3><a name="Safe_Signals">Safe Signals</a></H3>

</P>

<P>

Nick came up with a program for people to try to confirm his suspicions
about signal handling. His plan was to have C set a flag in the signal
handler which is checked after each op is performed, which seems the
most obvious way of doing it, but he was worried about systems with
signal handlers where 
<CODE>SIGCHLD</CODE> didn't call 
<CODE>wait</CODE>, meaning there would be still outstanding children when the signal
handler returned, meaning a 
<CODE>SIGCHLD</CODE> would be delivered, meaning the handler would get called, rince and
repeat.
</P>

<P>
However, every platform that was tested worked sensibly, so it looks
like Nick is going to go ahead and try and implement safe signals.
<H3><a name="Large_file_support_wrangling_continues">Large file support wrangling continues</a></H3>

</P>

<P>

The discussion last week about Linux's large file support continued this
week. The problem is that we need to find the right preprocessor
directive to get the most use out of the system; most of the ones which
look useful (
<CODE>_GNU_SOURCE</CODE>, for instance) also expose other things that we don't necessarily want. 
It would also throw up problems in programs embedding Perl. Russ
Allbery had been through all this with both INN and 
<CODE>autoconf</CODE>. His advice:
<blockquote></P>

<P>
 Eventually, the autoconf folks decided to give up on glibc 2.1 as
 broken for large files and just recommend people upgrade to glibc 2.2
 or add -D_GNU_SOURCE manually if it works for their application.
</blockquote><H3><a name="Multiple_Pre_Incrementing">Multiple Pre-Incrementing</a></H3>

</P>

<P>

I decided to throw a spaniel in the works by submitting a patch to make
</P>

</P><PRE>
    print (++$i, ++$i, ++$i)
</PRE>

<P>
work as John Vromans would like; currently, Perl reserves the right to
do, well, pretty much anything it wants in that situation, but the
&quot;obvious&quot; thing for it to print would be (assuming 
<CODE>$i</CODE> was undefined before hand) &quot;123&quot;. There were some arguments as to why
this would be a bad idea - firstly, defining behaviour that is currently
undefined robs us of the right to make clever optimizations in the future, 
and also that the fix slows down the behaviour of pre-increment and
pre-decrement for everyone, not just those
<!-- complete sickos and obviously dangerous lunatics -->doing multiple pre-increments in a single statement.
</P>

<P>
I also wondered whether the confusion at seeing Perl output &quot;333&quot; in the
above code would be offset by the confusion required to try something
like that in a serious program anyway.
<H3><a name="TestHarness_Megapatch">Test::Harness Megapatch</a></H3>

</P>

<P>

Michael Schwern did his usual trick of popping up out of nowhere with a
40K patch - this time he rewrote 
<CODE>Test::Harness</CODE> to support a lot of sensible things, like the trick of having comments
after your message, like this:
</P>

</P><PRE>
    ok 123 - Testing the frobnicator
</PRE>

<P>
so that when tests fail you can can search for that string. He went back
and forth with Andreas about some of the new features - Andreas felt
that, for instance, allowing upper case output creates additional noise
and distraction. Jarkko agreed, and the patch got fried. 
</P>

<P>
Not put off, Schwern then went on to unify the 
<CODE>skip</CODE> and
<CODE>todo</CODE> interfaces. Unfortunately, that couldn't be done without breaking
existing code, especially CPAN modules, so that patch died the death
too. Oh, the embarrassment.
<H3><a name="Tokeniser_reporting_and_pretty_printing">Tokeniser reporting and pretty-printing</a></H3>

</P>

<P>

I did something evil again. After hearing a talk by Knuth about Literate
Programming, I went back to bemoaning the lack of a Perl pretty-printer,
and the depressing words in the FAQ:
<blockquote></P>

<P>
There is no program that will reformat Perl as much as indent(1)
will do for C.  The complex feedback between the scanner and the
parser (this feedback is what confuses the vgrind and emacs
programs) makes it challenging at best to write a stand-alone
Perl parser.
</blockquote></P>

<P>
So if I couldn't build a stand-alone parser, I'd use the one we've got - 
<CODE>perl</CODE>. By adding a call to a reporting function every time Perl makes a
decision about what a token is, you can generate a listing of all the
tokens in a program and their types. Implementation of a robust
pretty-printer is 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg00833.html">left as an exercise for the reader</a>; answers on a postcard, please.
</P>

<P>
(PS: I've since been alerted to the existence of Tim Maher's
<a href="http://www.consultix-inc.com/perl_beautifier.html">Perl beautifier</a>, which is an equally cool hack.)
<H3><a name="Unicode">Unicode </a></H3>

</P>

<P>

How could I go a week without mentioning Unicode? Hiroto's 
<CODE>qu</CODE> operator is in, and someone's obviously using it, because Nick Clark
found that it was turning up a bug in UTF8 hashes - 
<CODE>$foo{something}</CODE> and
<CODE>$foo{qu/something/}</CODE> were being seen as two different keys. Hiroto said he was aware of it
and meant to send a patch but hasn't managed to yet.
</P>

<P>
UTF8 support on EBCDIC is starting to work, but it's being done in a
bit of a bizarre way - we're actually using UTF8 to encode 
<B>EBCDIC itself</B>, rather than Unicode. This means that whileEBCDIC and non-EBCDIC platforms now both &quot;support&quot; UTF8 and all the code
(on the whole) works, Weird Things(TM) might happen if EBCDIC people
start playing with character classes or other Unicode features.
<H3><a name="Various">Various</a></H3>

</P>

<P>

IV preservation is still buggy.
</P>

<P>
I'll leave you with the news that several people reported problems with
the bug-reporting system; Perl is so great, even its bugs have bugs.
</P>

<P>
Until next week I remain, your humble and obedient servant,
</P>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Couzens</a>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1428" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/01/tt2.html" rel="bookmark">Creating Data Output Files Using the Template Toolkit</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <abbr class="published" title="2001-01-23T00:00:00-08:00">January 23, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- Creating Data Output Files Using the Template Toolkit -->

<br />

<p> 
<table width="180" cellspacing="0" cellpadding="4" align="right" border="1">
<tr>
<td align="center" valign="top" bgcolor="#6699cc">
<font color="#ffffff">Table of Contents</td>
</tr>

<tr>
<td>
<p class="fine">
&#149;<a href="#a more complex example">A more complex example</a><br /><br />
&#149;<a href="#producing xml">Producing XML</a><br /><br />
&#149;<a href="#multiple formats">Multiple Formats</a><br />

</td>
</tr>
</p>
</table>

<h3><a name="introducing the template toolkit">Introducing the Template Toolkit</a></h3>

<p>There are a number of Perl modules that are universally recognised as The
Right Thing To Use for certain tasks. If you accessed a database without
using DBI, pulled data from the WWW without using on of the LWP modules
or parsed XML without using XML::Parser or one of its subclasses then you'd
run the risk of being shunned by polite Perl society.</p>

<p>I believe that the year 2000 saw the emergence of another 'must have'
Perl module - the Template Toolkit. I don't think I'm alone in this 
belief as the Template Toolkit won the 'Best New Module' award at the
Perl Conference last summer. Version 2.0 of the Template Toolkit
(known as TT2 to its friends) was recently released to the CPAN.</p>

<p>TT2 was designed and written by Andy Wardley &lt;<a href="mailto:abw@cre.canon.co.uk">abw@cre.canon.co.uk</a>&gt;. It was 
born out of Andy's previous templating module, Text::Metatext, in best Fred 
Brooks 'plan to throw one away' manner; and aims to be the most useful (or, 
at least, the most <em>used</em>) Perl templating system.</p>
<p>TT2 provides a way to take a file of fixed boilerplate text (the template) 
and embed variable data within it. One obvious use of this is in the creation 
of dynamic web pages and this is where a lot of the attention that TT2 has
received has been focussed. In this article, I hope to demonstrate that
TT2 is just as useful in non-web applications.</p>

<h3><a name="using the template toolkit">Using the Template Toolkit</a></h3>
<p>Let's look at how we'd use TT2 to process a simple data file. TT2 is an
object oriented Perl module. Having downloaded it from CPAN and installed 
it in the usual manner, using it in your program is as easy as putting the 
lines</p>
<pre>
    use Template;</pre>
<pre>
    my $tt = Template-&gt;new;</pre>
<p>in your code. The constructor function, <code>new</code>, takes a number of optional
parameters which are documented in the copious manual pages that come with 
the module, but for the purposes of this article we'll keep things as
simple as possible.</p>
<p>To process the template, you would call the <code>process</code> method like this</p>
<pre>
    $tt-&gt;process('my_template', \%data)
      || die $tt-&gt;error;</pre>
<p>We pass two parameters to <code>process</code>, the first is the name of the file
containing the template to process (in this case, my_template) and the 
second is a reference to a hash which contains the data items that you
want to use in the template. If processing the template gives  any kind 
of error, the program will die with a (hopefully) useful error message.</p>
<p>So what kinds of things can go in <code>%data</code>? The answer is just about
anything. Here's an example showing data about English Premier League
football teams.</p>
<pre>
    my @teams = ({ name =&gt; 'Man Utd',
                   played =&gt; 16,
                   won =&gt; 12,
                   drawn =&gt; 3,
                   lost =&gt; 1 },
                 { name =&gt; 'Bradford',
                   played =&gt; 16,
                   won =&gt; 2,
                   drawn =&gt; 5,
                   lost =&gt; 9 });</pre>
<pre>
    my %data = ( name =&gt; 'English Premier League',
                 season =&gt; '2000/01',
                 teams =&gt; \@teams );</pre>
<p>This creates three data items which can be accessed within the template,
called <code>name</code>, <code>season</code> and <code>teams</code>. Notice that <code>teams</code> is a complex
data structure.</p>
<p>Here is a template that we might use to process this data.</p>
<pre>
    League Standings</pre>
<pre>
    League Name: [% name %]
    Season     : [% season %]</pre>
<pre>
    Teams:
    [% FOREACH team = teams -%]
    [% team.name %] [% team.played -%] 
     [% team.won %] [% team.drawn %] [% team.lost %]
    [% END %]</pre>
<p>Running this template with this data gives us the following output</p>
<pre>
    League Standings</pre>
<pre>
    League Name: English Premier League
    Season     : 2000/01</pre>
<pre>
    Teams:
    Man Utd 16 12 3 1
    Bradford 16 2 5 9</pre>
<p>Hopefully the syntax of the template is simple enough to follow. There are
a few points to note.</p>
<ul>
<li>
Template processing directives are written using a simple language which
is not Perl.
</li>
<li>
The keys of the <code>%data</code> have become the names of the data variables within
the template.
</li>
<li>
Template processing directives are surrounded by <code>[%</code> and <code>%]</code> 
sequences.
</li>
<li>
If these tags are replaced with <code>[%-</code> <code>-%]</code> then the preceding or 
following linefeed is suppressed.
</li>
<li>
In the <code>FOREACH</code> loop, each element of the <code>teams</code> list was assigned,
in turn, to the temporary variable <code>team</code>.
</li>
<li>
Each item assigned to the <code>team</code> variable is a Perl hash. Individual
values within the hash are accessed using a dot notation.
</li></ul>

<p>It's probably the first and last of these points which are the most
important. The first point emphasises the separation of the data 
acquisition logic from the presentation logic. The person creating
the presentation template doesn't need to know Perl, they only need
to know the data items which will be passed into the template.</p>

<p>The last point demonstrates the way that TT2 protects the template
designer from the implementation of the data structures. The data objects
passed to the template processor can be scalars, arrays, hashes, objects
or even subroutines. The template processor will just interpret your
data correctly and Do The Right Thing to return the correct value to
you. In this example each team was a hash, but in a larger system
each team might be an object, in which case <code>name</code>, <code>played</code>, etc. would
be accessor methods to the underlying object attributes. No changes would
be required to the template as the template processor would realise that
it needed to call methods rather than access hash values.</p>

<h3><a name="a more complex example">A more complex example</a></h3>

<p>Stats about the English Football League are usually presented in a slightly
more complex format that the one we used above. A full set of stats will
show the number of games that a team has won, lost or drawn, the number
of goals scored for and against the team and the number of points that
the team therefore has. Teams gain three points for a win and one point
for a draw. When teams have the same number of points they are separated
by the goal difference, that is the number of goals the team has scored
minus the number of team scored against them. To complicate things
even further, the games won, drawn and lost and the goals for and 
against are often split between home and away games.</p>
<p>Therefore if you have a data source which lists the team name togther with
the games won, drawn and lost and the goals for and against split into
home and away (a total of eleven data items) you can calculate all of the
other items (goal difference, points awarded and even position in the 
league). Let's take such a file, but we'll only look at the top three 
teams. It will look something like this:</p>
<pre>
  Man Utd,7,1,0,26,4,5,2,1,15,6
  Arsenal,7,1,0,17,4,2,3,3,7,9
  Leicester,4,3,1,10,8,4,2,2,7,4</pre>
<p>A simple script to read this data into an array of hashes will look
something like this (I've simplified the names of the data columns -
w, d, and l are games won, drawn and lost and f and a are goals scored
for and against; h and a at the front of a data item name indicates
whether it's a home or away statistic):</p>
<pre>
  my @cols = qw(name hw hd hl hf ha aw ad al af aa);</pre>
<pre>
  my @teams;
  while (&lt;&gt;) {
    chomp;</pre>
<pre>
    my %team;</pre>
<pre>
    @team{@cols} = split /,/;</pre>
<pre>
    push @teams, \%team;
  }</pre>
<p>We can then go thru the teams again and calculate all of the derived
data items:</p>
<pre>
  foreach (@teams) {
    $_-&gt;{w} = $_-&gt;{hw} + $_-&gt;{aw};
    $_-&gt;{d} = $_-&gt;{hd} + $_-&gt;{ad};
    $_-&gt;{l} = $_-&gt;{hl} + $_-&gt;{al};</pre>
<pre>
    $_-&gt;{pl} = $_-&gt;{w} + $_-&gt;{d} + $_-&gt;{l};
</pre>
<pre>

    $_-&gt;{f} = $_-&gt;{hf} + $_-&gt;{af};
    $_-&gt;{a} = $_-&gt;{ha} + $_-&gt;{aa};</pre>
<pre>
    $_-&gt;{gd} = $_-&gt;{f} - $_-&gt;{a};</pre>
<pre>
    $_-&gt;{pt} = (3 * $_-&gt;{w}) + $_-&gt;{d};
  }</pre>
<p>And then produce a list sorted in descending order:</p>
<pre>
  @teams 
    = sort { $b-&gt;{pt} &lt;=&gt; $b-&gt;{pt}
             || $b-&gt;{gd} &lt;=&gt; $a-&gt;{gd} } @teams;</pre>
<p>And finally add the league position data item:</p>
<pre>
  $teams[$_]-&gt;{pos} = $_ + 1 
    foreach 0 .. $#teams;</pre>
<p>Having pulled all of our data into an internal data structure we can start
to produce output using out templates. A template to create a CSV file 
containing the data split between home and away stats would look like this:</p>
<pre>
  [% FOREACH team = teams -%]
  [% team.pos %],[% team.name %],[% team.pl %],[% team.hw %],
  [%- team.hd %],[% team.hl %],[% team.hf %],[% team.ha %],
  [%- team.aw %],[% team.ad %],[% team.al %],[% team.af %],
  [%- team.aa %],[% team.gd %],[% team.pt %]
  [%- END %]</pre>
<p>And processing it like this:</p>
<pre>
  $tt-&gt;process('split.tt', { teams =&gt; \@teams }, 'split.csv')
    || die $tt-&gt;error;</pre>
<p>produces the following output:</p>
<pre>
  1,Man Utd,16,7,1,0,26,4,5,2,1,15,6,31,39
  2,Arsenal,16,7,1,0,17,4,2,3,3,7,9,11,31
  3,Leicester,16,4,3,1,10,8,4,2,2,7,4,5,29</pre>
<p>Notice that we've introduced the third parameter to <code>process</code>. If this
parameter is missing then the TT2 sends its output to <code>STDOUT</code>. If this
parameter is a scalar then it is taken as the name of a file to write the
output to. This parameter can also be (amongst other things) a filehandle
or a reference to an object which is assumed to implement a <code>print</code>
method.</p>
<p>If we weren't interested in the split between home and away games, then
we could use a simpler template like this:</p>
<pre>
  [% FOREACH team = teams -%]
  [% team.pos %],[% team.name %],[% team.pl %],[% team.w %],
  [%- team.d %],[% team.l %],[% team.f %],[% team.a %],
  [%- team.aa %],[% team.gd %],[% team.pt %]
  [% END -%]</pre>
<p>Which would produce output like this:</p>
<pre>
  1,Man Utd,16,12,3,1,41,10,6,31,39
  2,Arsenal,16,9,4,3,24,13,9,11,31
  3,Leicester,16,8,5,3,17,12,4,5,29</pre>

<h3><a name="producing xml">Producing XML</a></h3>
<p>This is starting to show some of the power and flexibility of TT2, but
you may be thinking that you could just as easily produce this output
with a <code>foreach</code> loop and a couple of <code>print</code> statements in your code.
This is, of course, true; but that's because I've chosen a deliberately
simple example to explain the concepts. What if we wanted to produce 
an XML file containing the data? And what if (as I mentioned earlier)
the league data was held in an object? The code would then look even
easier as most of the code we've written earlier would be hidden away 
in <code>FootballLeague.pm</code>.</p>
<pre>
  use FootballLeague;
  use Template;</pre>
<pre>
  my $league = FootballLeague-&gt;new(name =&gt; 'English Premier');</pre>
<pre>
  my $tt = Template-&gt;new;</pre>
<pre>
  $tt-&gt;process('league_xml.tt', { league =&gt; $league })
    || die $tt-&gt;error;</pre>
<p>And the template in <code>league_xml.tt</code> would look something like this:</p>
<pre>
  &lt;?xml version=&quot;1.0&quot;?&gt;
  &lt;!DOCTYPE LEAGUE SYSTEM &quot;league.dtd&quot;&gt;</pre>
<pre>
  &lt;league name=&quot;[% league.name %]&quot; season=&quot;[% league.season %]&quot;&gt;
  [% FOREACH team = league.teams -%]
    &lt;team name=&quot;[% team.name %]&quot;
          pos=&quot;[% team.pos %]&quot;
          played=&quot;[% team.pl %]&quot;
          goal_diff=&quot;[% team.gd %]&quot;
          points=&quot;[% team.pt %]&quot;&gt;
       &lt;stats type=&quot;home&quot;&gt;
              win=&quot;[% team.hw %]&quot;
              draw=&quot;[%- team.hd %]&quot;
              lose=&quot;[% team.hl %]&quot;
              for=&quot;[% team.hf %]&quot;
              against=&quot;[% team.ha %]&quot; /&gt;
       &lt;stats type=&quot;away&quot;&gt;
              win=&quot;[% team.aw %]&quot;
              draw=&quot;[%- team.ad %]&quot;
              lose=&quot;[% team.al %]&quot;
              for=&quot;[% team.af %]&quot;
              against=&quot;[% team.aa %]&quot; /&gt;
    &lt;/team&gt;
  [% END -%]
  &lt;/league&gt;</pre>
<p>Notice that as we've passed the whole object into <code>process</code> then we
need to put an extra level of indirection on our template variables
- everything is now a component of the <code>league</code> variable. Other 
than that, everything in the template is very similar to what we've
used before. Presumably now <code>team.name</code> calls an accessor function 
rather than carrying out a hash lookup, but all of this is transparent
to our template designer.</p>

<h3><a name="multiple formats">Multiple Formats</a></h3>
<p>As a final example, let's suppose that we need to create out football
league tables in a number of formats. Perhaps we are passing this
data on to other people and they can't all use the same format.
Some of our users need CSV files and others need XML. Some require
data split between home and away matches and other just want the
totals. In total, then, we'll need four different templates, but the
good news is that they can use the same data object. All the script
needs to do is to establish which template is required and process
it.</p>
<pre>
  use FootballLeague;
  use Template;</pre>
<pre>
  my ($name, $type, $stats) = @_;</pre>
<pre>
  my $league = FootballLeague-&gt;new(name =&gt; $name);</pre>
<pre>
  my $tt = Template-&gt;new;</pre>
<pre>
  $tt-&gt;process(&quot;league_${type}_$stats.tt&quot;, 
               { league =&gt; $league }
               &quot;league_$stats.$type&quot;)
    || die $tt-&gt;error;</pre>
<p>For example, calling this script as</p>
<pre>
  league.pl 'English Premier' xml split</pre>
<p>This will process a template called <code>league_xml_split.tt</code> and put the 
results in a file called <code>league_split.xml</code>.</p>
<p>This starts to show the true strength of the Template Toolkit. If we
later wanted to add another file format - perhaps we wanted to create
a league table HTML page or even a LaTeX document - then we would just 
need to create the appropriate template and name it according to our
existing naming convention. We would need to make no changes to the 
code.</p>
<p>I hope you can now see why the Template Toolkit is fast becoming
an essential part of many people's Perl installation.</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1420" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/01/poe.html" rel="bookmark">A Beginner's Introduction to POE</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Jeffrey Goff</span> on <abbr class="published" title="2001-01-17T00:00:00-08:00">January 17, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- <a name="a beginner's introduction to poe">A Beginner's Introduction to POE</a> -->
<p>
<p>By Dennis Taylor, with Jeff Goff<br />
<!- :field::date::></p>

<h3><a name="what is poe, and why should i use it">What Is POE, And Why Should I Use It?</a></h3>


<p><table width="180" cellspacing="0" cellpadding="4" align="right" border="1">
<tr>
<td align="center" valign="top" bgcolor="#6699cc">
<font color="#ffffff">Table of Contents</td>
</tr>

<tr>
<td>
<span class="secondary">
&#149;<a href="#poe design">POE Design</a><br /><br />

&#149;<a href="#a simple example">A Simple Example</a><br />
<br />
&#149;<a href="#that's all for today">That's All For Today</a><br />
<br />
&#149;<a href="#related links">Related Links</a><br />
</span>
</td>
</tr>
</p>
</table>
<p>Most of the programs we write every day have the same basic blueprint:
they start up, they perform a series of actions, and then they exit.
This works fine for programs that don't need much interaction with their
users or their data, but for more complicated tasks, you need a more
expressive program structure.</p>
<p>That's where POE (Perl Object Environment) comes in. POE is a framework
for building Perl programs that lends itself naturally to tasks which
involve reacting to external data, such as network communications or
user interfaces. Programs written in POE are completely non-linear; you
set up a bunch of small subroutines and define how they all call each
other, and POE will automatically switch between them while it's
handling your program's input and output. It can be confusing at first,
if you're used to procedural programming, but with a little practice it
becomes second nature.</p>

<h3><a name="poe design">POE Design</a></h3>
<p>It's not much of an exaggeration to say that POE is a small operating
system written in Perl, with its own kernel, processes, interprocess
communication (IPC), drivers, and so on. In practice, however, it just
boils down to a simple system for assembling state machines. Here's a
brief description of each of the pieces that make up the POE
environment:</p>
<dl>
<dt><strong><a name="item_States">States</a></strong><br>
<dd>
The basic building block of the POE program is the <strong>state</strong>, which is a
piece of code that gets executed when some event occurs -- when incoming
data arrives, for instance, or when a session runs out of things to do,
or when one session sends a message to another. Everything in POE is
based around receiving and handling these events.

<dt><strong><a name="item_The_Kernel">The Kernel</a></strong><br>
<dd>
POE's <strong>kernel</strong> is much like an operating system's kernel: it keeps
track of all your processes and data behind the scenes, and schedules
when each piece of your code gets to run. You can use the kernel to set
alarms for your POE processes, queue up states that you want to run, and
perform various other low-level services, but most of the time you don't
interact with it directly.

<dt><strong><a name="item_Sessions">Sessions</a></strong><br>
<dd>
<strong>Sessions</strong> are the POE equivalent to processes in a real operating
system. A session is just a POE program which switches from state to
state as it runs. It can create ``child'' sessions, send POE events to
other sessions, and so on. Each session can store session-specific data
in a hash called the <strong>heap</strong>, which is accessible from every state in
that session.
<p>POE has a very simple cooperative multitasking model; every
session executes in the same OS process without threads or forking. For
this reason, you should beware of using blocking system calls in POE
programs.</p>
</dl>
<p>Those are the basic pieces of the Perl Object Environment, although
there are a few slightly more advanced parts that we ought to explain
before we go on to the actual code:</p>
<dl>
<dt><strong><a name="item_Drivers">Drivers</a></strong><br>
<dd>
<strong>Drivers</strong> are the lowest level of POE's I/O layer. Currently, there's only
one driver included with the POE distribution -- <code>POE::Driver::SysRW</code>,
which reads and writes data from a filehandle -- so there's not much to
say about them. You'll never actually use a driver directly, anyhow.

<dt><strong><a name="item_Filters">Filters</a></strong><br>
<dd>
<strong>Filters</strong>, on the other hand, are inordinately useful. A filter is a
simple interface for converting chunks of formatted data into another
format. For example, <code>POE::Filter::HTTPD</code> converts HTTP 1.0 requests
into <code>HTTP::Request</code> objects and back, and <code>POE::Filter::Line</code>
converts a raw stream of data into a series of lines (much like Perl's
&lt;&gt; operator).

<dt><strong><a name="item_Wheels">Wheels</a></strong><br>
<dd>
<strong>Wheels</strong> contain reusable pieces of high-level logic for accomplishing
everyday tasks. They're the POE way to encapsulate useful code. Common
things you'll do with wheels in POE include handling event-driven input
and output and easily creating network connections. Wheels often use
Filters and Drivers to massage and send off data. I know this is a vague
description, but the code below will provide some concrete examples.

<dt><strong><a name="item_Components">Components</a></strong><br>
<dd>
A <strong>Component</strong> is a session that's designed to be controlled by other
sessions. Your sessions can issue commands to and receive events from
them, much like processes communicating via IPC in a real operating
system. Some examples of Components include <code>POE::Component::IRC</code>, an
interface for creating POE-based IRC clients, or
<code>POE::Component::Client::HTTP</code>, an event-driven HTTP user agent in
Perl. We won't be using any Components in this article, but they're a
very useful part of POE nevertheless.
</dl>

<h3><a name="a simple example">A Simple Example</a></h3>
<p>For this simple example, we're going to make a server daemon which
accepts TCP connections and prints the answers to simple arithmetic
problems posed by its clients. When someone connects to it on port
31008, it will print ``Hello, client!''. The client can then send it an
arithmetic expression, terminated by a newline (such as ``<code>6 + 3\n</code>'' or
``<code>50 / (7 - 2)\n</code>'', and the server will send back the answer. Easy
enough, right?</p>
<p>Writing such a program in POE isn't terribly different from the
traditional method of writing daemons in Unix. We'll have a server
session which listens for incoming TCP connections on port 31008. Each
time a connection arrives, it'll create a new child session to handle
the connection. Each child session will interact with the user, and then
quietly die when the connection is closed. And best of all, it'll only
take 74 lines of modular, simple Perl.</p>
<p>The program begins innocently enough:</p>
<pre>
   1  #!/usr/bin/perl -w
   2  use strict;
   3  use Socket qw(inet_ntoa);
   4  use POE qw( Wheel::SocketFactory  Wheel::ReadWrite
   5              Filter::Line          Driver::SysRW );
   6  use constant PORT =&gt; 31008;</pre>
<p>Here, we import the modules and functions which the script will use, and
define a constant value for the listening port. The odd-looking <code>qw()</code>
statement after the ``<code>use POE</code>'' is just POE's shorthand way for pulling
in a lot of <code>POE::</code> modules at once. It's equivalent to the more
verbose:</p>
<pre>
        use POE;
        use POE::Wheel::SocketFactory;
        use POE::Wheel:ReadWrite;
        use POE::Filter::Line;
        use POE::Driver::SysRW;</pre>
<p>Now for a truly cool part:</p>
<pre>
   7  new POE::Session (
   8      _start =&gt; \&amp;server_start,
   9      _stop  =&gt; \&amp;server_stop,
  10  );
  11  $poe_kernel-&gt;run();
  12  exit;</pre>
<p>That's the entire program! We set up the main server session, tell the
POE kernel to start processing events, and then exit when it's done.
(The kernel is considered ``done'' when it has no more sessions left to
manage, but since we're going to put the server session in an infinite
loop, it'll never actually exit that way in this script.) POE 
automatically exports the $poe_kernel variable into your namespace when
you write ``<code>use POE;</code>''.</p>
<p>The <code>new POE::Session</code> call needs a word of explanation. When you
create a session, you give the kernel a list of the events it will
accept. In the code above, we're saying that the new session will handle
the <code>_start</code> and <code>_stop</code> events by calling the <code>&amp;server_start</code> and
<code>&amp;server_stop</code> functions. Any other events which this session receives
will be ignored. <code>_start</code> and <code>_stop</code> are special events to a POE
session: the <code>_start</code> state is the first thing the session executes
when it's created, and the session is put into the <code>_stop</code> state by the
kernel when it's about to be destroyed. Basically, they're a constructor
and a destructor.</p>
<p>Now that we've written the entire program, we have to write the code for
the states which our sessions will execute while it runs. Let's start
with (appropriately enough) <code>&amp;server_start</code>, which is called when the
main server session is created at the beginning of the program:</p>
<pre>
  13  sub server_start {
  14      $_[HEAP]-&gt;{listener} = new POE::Wheel::SocketFactory
  15        ( BindPort     =&gt; PORT,
  16          Reuse        =&gt; 'yes',
  17          SuccessState =&gt; \&amp;accept_new_client,
  18          FailureState =&gt; \&amp;accept_failed
  19        );
  20      print &quot;SERVER: Started listening on port &quot;, PORT, &quot;.\n&quot;;
  21  }</pre>
<p>This is a good example of a POE state. First things first: Note the
variable called <code>$_[HEAP]</code>? POE has a special way of passing arguments
around. The <code>@_</code> array is packed with lots of extra arguments -- a
reference to the current kernel and session, the state name, a reference
to the heap, and other goodies. To access them, you index the <code>@_</code>
array with various special constants which POE exports, such as HEAP,
SESSION, KERNEL, STATE, and ARG0 through ARG9 to access the state's
user-supplied arguments. Like most design decisions in POE, the point of
this scheme is to maximize backwards compatibility without sacrificing
speed. The example above is storing a SocketFactory wheel in the heap
under the key '<code>listener</code>'.</p>
<p>The <code>POE::Wheel::SocketFactory</code> wheel is one of the coolest things
about POE. You can use it to create any sort of stream socket (sorry, no
UDP sockets yet) without worrying about the details. The statement above
will create a SocketFactory that listens on the specified TCP port (with
the SO_REUSE option set) for new connections. When a connection is
established, it will call the <code>&amp;accept_new_client</code> state to pass on the
new client socket; if something goes wrong, it'll call the
<code>&amp;accept_failed</code> state instead to let us handle the error. That's all
there is to networking in POE!</p>
<p>We store the wheel in the heap to keep Perl from accidentally
garbage-collecting it at the end of the state -- this way, it's
persistent across all states in this session. Now, onto the
<code>&amp;server_stop</code> state:</p>
<pre>
  22  sub server_stop {
  23      print &quot;SERVER: Stopped.\n&quot;;
  24  }</pre>
<p>Not much to it. I just put this state here to illustrate the flow of the
program when you run it. We could just as easily have had no <code>_stop</code>
state for the session at all, but it's more instructive (and easier to
debug) this way.</p>
<p>Here's where we create new sessions to handle each incoming connection:</p>
<pre>
  25  sub accept_new_client {
  26      my ($socket, $peeraddr, $peerport) = @_[ARG0 .. ARG2];
  27      $peeraddr = inet_ntoa($peeraddr);
  28      new POE::Session (
  29          _start =&gt; \&amp;child_start,
  30          _stop  =&gt; \&amp;child_stop,
  31          main   =&gt; [ 'child_input', 'child_done', 'child_error' ],
  32          [ $socket, $peeraddr, $peerport ]
  33      );
  34      print &quot;SERVER: Got connection from $peeraddr:$peerport.\n&quot;;
  35  }</pre>
<p>Our <code>POE::Wheel::SocketFactory</code> will call this subroutine whenever it
successfully establishes a connection to a client. We convert the
socket's address into a human-readable IP address (line 27) and then set
up a new session which will talk to the client. It's somewhat similar to
the previous <code>POE::Session</code> constructor we've seen, but a couple things
bear explaining:</p>
<p><code>@_[ARG0 .. ARG2]</code> is shorthand for <code>($_[ARG0], $_[ARG1], $_[ARG2])</code>.
You'll see array slices used like this a lot in POE programs.</p>
<p>What does line 31 mean? It's not like any other <code>event_name =</code> state&gt;
pair that we've seen yet. Actually, it's another clever abbreviation. If
we were to write it out the long way, it would be:</p>
<pre>
  new POE::Session (
      ...
      child_input =&gt; &amp;main::child_input,
      child_done  =&gt; &amp;main::child_done,
      child_error =&gt; &amp;main::child_error,
      ...
  );</pre>
<p>It's a handy way to write out a lot of state names when the state name
is the same as the event name -- you just pass a package name or object
as the key, and an array reference full of subroutine or method names,
and POE will just do the right thing. See the <code>POE::Session</code> docs for
more useful tricks like that.</p>
<p>Finally, the array reference at the end of the <code>POE::Session</code>
constructor's argument list (on line 32) is the list of arguments which
we're going to manually supply to the session's <code>_start</code> state.</p>
<p>If the <code>POE::Wheel::SocketFactory</code> had problems creating the listening
socket or accepting a connection, this happens:</p>
<pre>
  36  sub accept_failed {
  37      my ($function, $error) = @_[ARG0, ARG2];
  38      delete $_[HEAP]-&gt;{listener};
  39      print &quot;SERVER: call to $function() failed: $error.\n&quot;;
  40  }</pre>
<p>Printing the error message is normal enough, but why do we delete the
<code>SocketFactory</code> wheel from the heap? The answer lies in the way POE
manages session resources. Each session is considered ``alive'' so long as
it has some way of generating or receiving events. If it has no wheels
and no aliases (a nifty POE feature which we won't cover in this
article), the POE kernel realizes that the session is dead and
garbage-collects it.  The only way the server
session can get events is from its <code>SocketFactory</code> wheel -- if that's
destroyed, the POE kernel will wait until all its child sessions have
finished, and then garbage-collect the session. At this point, since
there are no remaining sessions to execute, the POE kernel will run out
of things to do and exit.</p>
<p>So, basically, this is just the normal way of getting rid of unwanted
POE sessions: dispose of all the session's resources and let the kernel
clean up. Now, onto the details of the child sessions:</p>
<pre>
  41  sub child_start {
  42      my ($heap, $socket) = @_[HEAP, ARG0];
  43      $heap-&gt;{readwrite} = new POE::Wheel::ReadWrite
  44        ( Handle =&gt; $socket,
  45          Driver =&gt; new POE::Driver::SysRW (),
  46          Filter =&gt; new POE::Filter::Line (),
  47          InputState =&gt; 'child_input',
  48          ErrorState =&gt; 'child_error',
  49        );
  50      $heap-&gt;{readwrite}-&gt;put( &quot;Hello, client!&quot; );
  51      $heap-&gt;{peername} = join ':', @_[ARG1, ARG2];
  52      print &quot;CHILD: Connected to $heap-&gt;{peername}.\n&quot;;
  53  }</pre>
<p>This gets called every time a new child session is created to handle a
newly connected client. We'll introduce a new sort of POE wheel here:
the <code>ReadWrite</code> wheel, which is an event-driven way to handle I/O
tasks. We pass it a filehandle, a driver which it'll use for I/O calls,
and a filter that it'll munge incoming and outgoing data with (in this

case, turning a raw stream of socket data into separate lines and vice
versa). In return, the wheel will send this session a <code>child_input</code> event
whenever new data arrives on the filehandle, and a <code>child_error</code> event
if any errors occur.</p>
<p>We immediately use the new wheel to output the string ``Hello, client!''
to the socket. (When you try out the code, note that the
<code>POE::Filter::Line</code> filter takes care of adding a line terminator to
the string for us.) Finally, we store the address and port of the
client in the heap, and print a success message.</p>
<p>We will omit discussion of the <code>child_stop</code> state, since it's only one
line long. Now for the real meat of the program: the <code>child_input</code>
state!</p>
<pre>
  57  sub child_input {
  58      my $data = $_[ARG0];
  59      $data =~ tr{0-9+*/()-}{}cd;
  60      return unless length $data;
  61      my $result = eval $data;
  62      chomp $@;
  63      $_[HEAP]-&gt;{readwrite}-&gt;put( $@ || $result );
  64      print &quot;CHILD: Got input from peer: \&quot;$data\&quot; = $result.\n&quot;;
  65  }</pre>
<p>When the client sends us a line of data, we strip it down to a simple
arithmetic expression and eval it, sending either the result or an error
message back to the client. Normally, passing untrusted user data
straight to <code>eval()</code> is a horribly dangerous thing to do, so we have to
make sure we remove every non-arithmetic character from the string
before it's evaled (line 59). The child session will happily keep
accepting new data until the client closes the connection. Run the code
yourself and give it a try!</p>
<p>The <code>child_done</code> and <code>child_error</code> states should be fairly
self-explanatory by now -- they each delete the child session's
<code>ReadWrite</code> wheel, thus causing the session to be garbage-collected,
and print an expository message explaining what happened. Easy enough.</p>

<h3><a name="that's all for today">That's All For Today</a></h3>
<p>And that's all there is to it! The longest subroutine in the entire
program is only 12 lines, and all the complicated parts of the
server-witing process have been offloaded to POE. Now, you could make
the argument that it could be done more easily as a procedural-style
program, like the examples in <code>man perlipc</code>. For a simple example
program like this, that would probably be true. But the beauty of POE is
that, as your program scales, it stays easy to modify. It's easier to
organize your program into discrete elements, and POE will provide all
the features you would otherwise have had to hackishly reinvent yourself
when the need arose.</p>
<p>So give POE a try on your next project. Anything that would ordinarily
use an event loop would be a good place to start using POE. Have fun!</p>
<p><a href="/2001/01/poe-math3.pl">Source Listing....</a></p>

<h3><a name="related links">Related Links</a></h3>
<dl>
<dt><strong><a name="item_http://poe.perl.org/"><a href="http://poe.perl.org/">http://poe.perl.org/</a></a></strong><br>
<dd>
The POE home page. All good things stem from here.
<p></p></dl>

</body>

</html>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1436" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/01/p5pdigest/THISWEEK-20010114.html" rel="bookmark">This Week on p5p 2001/01/14</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2001-01-15T00:00:00-08:00">January 15, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            

<!-- This week on perl5-porters (07-14 Jan 2001) -->
<!- :field::id-author::before=by+::>
<br />
<!- :field::date::>
<br />

<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#Excising_sigsetjmp">Excising sigsetjmp</a>
  <li><a href="#Benchmarking">Benchmarking</a>
  <li><a href="#UTF8_Heroism">UTF8 Heroism</a>
  <li><a href="#Cygwin_versus_Windows">Cygwin versus Windows</a>
  <li><a href="#Lvalue_lists">Lvalue lists</a>
  <li><a href="#Linux_large_file_support">Linux large file support</a>
  <li><a href="#Calls_for_papers">Calls for papers</a>
  <li><a href="#Various">Various</a>
</ul>


      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>perl-thisweek-YYYYMM@simon-cozens.org</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
<H3><a name="Excising_sigsetjmp">Excising sigsetjmp</a></H3>

</P>

<P>

Alan Burlison found that by telling Perl that Solaris didn't really have 
<CODE>sigsetjmp</CODE>, he could get a noticable improvement in speed - around 15%. He asked
if 
<CODE>sigsetjmp</CODE> could go, or whether there was a reason for it being there. Andy
said there was a reason, but he had forgotten what it was. Nick I-S
asked if there was anything that 
<CODE>sigsetjmp</CODE> was absolutely required for - the answer, from Alan, was that 
<CODE>sigsetjmp</CODE> restores the signal mask after a jump. In Perl terms, this means that
 if you 
<CODE>die</CODE> from a signal handler into an 
<CODE>eval</CODE> (something you'd be doing with 
<CODE>alarm</CODE>, for instance) then you'd be sure to get your signal handler
reinstalled. With ordinary 
<CODE>setjmp</CODE> you might get your signal mask restored, but you might not. There was
 some discussion as to whether it would be possible to only use 
<CODE>sigsetjmp</CODE> to jump into and out of a signal handler, but Nicholas Clark pointed out
 that since any Perl subroutine could be a signal handler, it's more or
 less impossible to make a distinction. The eventual consensus is that
 Perl's signal handling is currently so, uh, sub-optimal, that it
 probably wouldn't make that much of a difference if 
<CODE>sigsetjmp</CODE> was removed.
</P>

<P>
In the end, Nick Ing-Simmons came up with a patch which provided roughly 
<CODE>sigsetjmp</CODE>-like semantics with ordinary 
<CODE>setjmp</CODE>, so it looks like there might be a win there.
<H3><a name="Benchmarking">Benchmarking</a></H3>

</P>

<P>

Alan did some more fiddling with optimization and Solaris configuration,
and managed to get what he claimed was a 30% overall speedup - 18% due
to 
<CODE>setjmp</CODE> and 12% due to optimizer settings. Numbers like that immediately
sparked a debate on how you can conceivably benchmark a programming
language manually; it's well known that the test suites exercises Perl
in a number of non-standard ways, and really doesn't represent real
world use. Alan said that his tests had been done on a real XS module for
dealilng with Solaris accounting. 
</P>

<P>
Nicholas Clark asked what a sensible benchmark would be; he suggested
Gisle's
<a href="http://search.cpan.org/search?mode=dist&amp;query=perlbench">perlbench</a>, which was at least designed to try to be a fair test for Perl, but it
seemed there was some confusion as to how it was supposed to work. Doug
Bagley's 
<a href="http://www.bagley.org/~doug/shootout/">programming language shootout </a> was also mentioned.
</P>

<P>
Jarkko nailed the question, in the end : &quot;The problem with all
artificial benchmarks is that they are artificial.&quot; 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg00401.html">Read about it.</a></P>

<P>

<H3><a name="UTF8_Heroism">UTF8 Heroism</a></H3>

</P>

<P>
INABA Hiroto's been at it again. With his latest patches, the Unicode
torture test works fine, which is fantastic news - Unicode should now be
considered stable and usable. In fact,
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg00326.html">one of his patches</a> also fixes a couple of regular expression bugs as well. There was then
some disagreement over Unicode semantics (as usual) and whether or not 
<CODE>\x{XX}</CODE> should produce Unicode output; Hiroto came up with an excellent
suggestion: the 
<CODE>qu//</CODE> operator would work like a quoted string but would always produce UTF8.
And, dammit, he implemented it as well. In the words of Pete Townsend, I've 
gotta hand my Unicode crown to him. Or something.
</P>

<P>
All that's really left to do now is to reconcile EBCDIC support and UTF8
support - the suggested way to do this was to put in some conversion
tables between the two character encodings, so that anything that
created UTF8 data would have its EBCDIC input sent through a filter to
turn it into Latin 1, and anything which decoded UTF8 data would be sent
through a filter to turn it back into EBCDIC. There was some progress on
that this week, but a fundamental problem remains: some things, such as
version strings, want the UTF8 codepoints qua codepoints. That's to say,
the numbers in 
<CODE>v5.7.0</CODE> should NOT be transformed into their EBCDIC equivalents. This was
manifesting itself with weird errors like 
</P>

</P><PRE>
    Perl lib version (v5.7.0) doesn't match executable version (v5.7.0)
</PRE>

<P>
But it's being worked on.
<H3><a name="Cygwin_versus_Windows">Cygwin versus Windows</a></H3>

</P>

<P>

Some issues surfaced while Reini Urban was looking at Berkeley DB
support in Cygwin - not all of them were Perl related, but contained
useful information for porters.
</P>

<P>
Some code in Berkeley DB relied on the maximum path length; Reini wanted
to use an 
<CODE>#ifdef _WIN32</CODE> block to get at 
<CODE>MAX_PATH</CODE>, but Charles Wilson pointed out that Cygwin should NOT define 
<CODE>_WIN32</CODE>, which is a compatibility crutch for bad ports. Cygwin already defines 
<CODE>FILENAME_MAX</CODE> and 
<CODE>PATH_MAX</CODE> as ISO C and POSIX demand, so those should be used instead of 
<CODE>MAX_PATH</CODE> which is a strange beast from Windows-land. 
</P>

<P>
The more general lesson here for Perl porters is that you should code
for Cygwin as if it were a real, POSIX-compliant system, rather than as
if it were Windows.
</P>

<P>
Oxymoron of the thread award went to Ernie Boyd, who explained 
<CODE>MAX_PATH</CODE> as a &quot;MS Windows standard&quot;.
<H3><a name="Lvalue_lists">Lvalue lists</a></H3>

</P>

<P>

Continuing the lvalue saga, Stephen McCamant produced a full and
glorious lvalue subroutine patch, which Jarkko applied. Tim Bunce
wondered what would happen if you said 
</P>

</P><PRE>
        (sub_returning_lvalue_hash()) = 1;
</PRE>

<P>
Stephen explained that the rules for assigning things is exactly the
same as you'd expect from scalars, and that, for instance, you should
put brackets around the right hand side if you're doing anything clever:
</P>

</P><PRE>
        sub_returning_lvalue_array() = (1, 2);
</PRE>

<P>
Radu Greab fixed a problem where lvalue subs weren't properly imposing
list context on the assignment; this causes all sorts of problems when
you have 
</P>

</P><PRE>
    (lvalue1(), lvalue2()) = split ' ', '1 2 3 4';
</PRE>

<P>
as 
<CODE>split</CODE> doesn't see the right number of elements to populate. This led to a
discussion of the curious and undocumented 
<CODE>PL_modcount</CODE>. This variable tells Perl how many things to fill up - it's actually
only used in the case of 
<CODE>split</CODE>. However, it uses the number 
<CODE>10000</CODE> as a signifier for &quot;this is going to be in list context, so just keep
filling&quot;. Jarkko, after possibly one too many games of 
<CODE>wumpus</CODE> raised objection to this undocumented, unmacroified bizarre magic
number. However, both the magic number and the lvalue split bug got
tidied up. 
<H3><a name="Linux_large_file_support">Linux large file support</a></H3>

</P>

<P>

Richard Soderberg had a valiant crack at getting large file support
to work under Linux, and concluded that he had to include the file 
<CODE>features.h</CODE> to make things work; after a little more messing around, he found that
<CODE>-D_GNU_SOURCE</CODE> should also turn on the required 64-bit types. Russ Allbery piped up
saying that 
<CODE>-D_GNU_SOURCE</CODE> ought to be more than enough - if it wasn't, there was a bug in glibc.
(It looked for a fun moment that 
<CODE>features.h</CODE> was somewhat ironically named.)
</P>

<P>
Andreas said that his experience had been that upgrading his kernel,
making the kernel headers available and then rebuilding glibc had
magically given him large file support with no changes to Perl required
- just a reconfigure and recompile. Linux users take note!
<H3><a name="Calls_for_papers">Calls for papers</a></H3>

</P>

<P>

Nat Torkington reminded us that the Perl Conference
<a href="http://conferences.oreilly.com/perl5/">call for papers</a> has been published, and gave a few 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg00654.html">ideas for papers</a> that Perl porters could give. We're trying to press-gang someone into
giving a paper on how the regular expression engine actually works, but
the usual suspects have gone very quiet.
</P>

<P>
Rich Lafferty also remarked that the equally worthy
<a href="http://yapc.org/America/">Yet Another Perl Conference</a> was also seeking papers. 
<H3><a name="Various">Various</a></H3>

</P>

<P>

Thanks for all the work on the bugs reported last week!
</P>

<P>
Until next week I remain, your humble and obedient servant,
</P>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Cozens</a>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1434" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/01/p5pdigest/THISWEEK-20010107.html" rel="bookmark">This Fortnight on p5p 2000/12/31</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2001-01-09T00:00:00-08:00">January  9, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- This fortnight on perl5-porters (25 Dec 2000-7 Jan 2001) --><!- :field::id-author::before=by+::><BR><!- :field::date::><BR>
<P></P>
<P>
<UL>
  <LI><A 
  href="#Notes">Notes</A> 
  <LI><A 
  href="#Fix_for_gv_handler_segfault">Fix 
  for gv_handler segfault</A> 
  <LI><A 
  href="#rsync_needs_occasional_delete">rsync 
  needs occasional delete</A> 
  <LI><A 
  href="#Outstanding_Unicode_fix">Outstanding 
  Unicode fix</A> 
  <LI><A 
  href="#New_Solaris_hints_file">New 
  Solaris hints file</A> 
  <LI><A 
  href="#Lots_of_lvalue_hackery">Lots 
  of lvalue hackery</A> 
  <LI><A 
  href="#Stephen_McCamant_and_Doug_MacEachern_week">Stephen 
  McCamant and Doug MacEachern week</A> 
  <LI><A 
  href="#Things_to_investigate">Things 
  to investigate</A> 
  <LI><A 
  href="#Various">Various</A> 
  </LI></UL>
<H3><A name=Notes>Notes</A></H3>
<P></P>
<P>You can subscribe to an e-mail version of this summary by sending an empty 
message to <A 
href="mailto:p5p-digest-subscribe@plover.com"><TT>p5p-digest-subscribe@plover.com</TT>.</A></P>
<P>Please send corrections and additions to 
<CODE>perl-thisweek-YYYYMM@simon-cozens.org</CODE> where <CODE>YYYYMM</CODE> is 
the current year and month. </P>
<P>Allow me to apologize for there being no service last week, as I was 
traveling hither and thither for New Year's festivities. This is another 
special bumper edition covering last week and the week before. 
<H3><A name=Fix_for_gv_handler_segfault>Fix for gv_handler segfault</A></H3>
<P></P>
<P>Lupe Christoph found an ugly bug uncovered by Ilya's recent object 
destruction speedup patch: Basically, we had called a function ( 
<CODE>mg_find</CODE>) on a stash before actually making sure that the stash 
existed, causing a segfault. Lupe added a sanity check to the handler 
function and <CODE>mg_find</CODE>, just to be on the safe side. 
<H3><A name=rsync_needs_occasional_delete>rsync needs occasional delete</A></H3>
<P></P>
<P>Lupe also got bitten by a problem that could affect some of you if you're 
following the rsync mainline: Rsync won't, by default, delete files that have 
been deleted from the repository. This caused strange test failures, because the 
test that was failing doesn't exist any more ... . He passes on these words of wisdom: 
<BLOCKQUOTE>
  <P></P>
  <P>Note that this will not delete any files that were in '.' before the rsync. 
  Once you are sure that the rsync is running correctly, run it with the 
  --delete and the --dry-run options like this: </P>
  <P># rsync -avz --delete --dry-run 
  rsync://ftp.linux.activestate.com/perl-current/ . </P>
  <P>
  <P>This will <I>simulate</I> an rsync run that also deletes files not present 
  in the bleadperl master copy. Observe the results from this run closely. If you 
  are sure that the actual run would delete no files precious to you, you could 
  remove the '--dry-run' option.</P></BLOCKQUOTE>
<H3><A name=Outstanding_Unicode_fix>Outstanding Unicode fix</A></H3>
<P></P>
<P><!-- That's outstanding as in "very good," rather than "missing" --></P>
<P>This sneaked in just as I was writing the previous summary: INABA Hiroto came 
up with a 48k patch that fixed a few Unicode bugs. He also added a pragma 
<CODE>unicode::distinct</CODE>, which makes a Unicode-encoded string never equal 
to a nonencoded string. That's to say, if we have: </P>
<P></P><PRE>    $a = chr(50).chr(400); # Needs to be UTF8-encoded, because of chr(400)
    chop($a);              # Now we have chr(50), but it's still encoded.
    $b = chr(50)           # This isn't UTF8-encoded
</PRE>
<P>Under normal circumstances, <CODE>$a eq $b</CODE>. This is what we expect, 
because they represent the same character. But under 
<CODE>unicode::distinct</CODE>, they won't be equal because they are represented 
differently. </P>
<P>He also fixed a few other issues I should have been looking at, like Unicode 
<CODE>tr///</CODE>. <!-- which is great, because I really thought nobody cared -->
<H3><A name=New_Solaris_hints_file>New Solaris hints file</A></H3>
<P></P>
<P>Lupe Christoph (again; busy man) attempted to update the Solaris hints 
file; it looked pretty good, but produced weird errors (No, Solaris machines are 
<B>not</B> EBCDIC. Or at least, not normally.) that were traced to a problem 
with Configure calling another shell file to get more information (a "call back 
unit") but then getting confused as to where the source directory is. Robin 
Barker also found a similar problem when Configure sets <CODE>$src</CODE> using 
a relative path instead of an absolute one. The problem was eventually hunted 
down and shot, and the new hints file is now working properly. </P>
<P>Jarkko also re-wrote the DEC OSF hints file. 
<H3><A name=Lots_of_lvalue_hackery>Lots of lvalue hackery</A></H3>
<P></P>
<P>I got into a very strange mood and started looking at lvalue subroutines. 
These are things that allow you to return a variable or something modifiable 
from a subroutine, like this: </P>
<P></P><PRE> $a = 20;
 sub foo :lvalue { $a }
 foo() = 30; # Now $a is 30
</PRE>
<P>The first problem was that this didn't extend to <CODE>AUTOLOAD</CODE>, 
meaning you couldn't say </P>
<P></P><PRE> sub AUTOLOAD : lvalue { ${$AUTOLOAD} }
 foo() = 20;
</PRE>
<P>and have it set <CODE>$foo</CODE>. Perhaps that was meant to be a feature, 
but it was fixed anyway. Of course, the natural extension to that would be to 
let subs be called without the brackets, like this: </P>
<P></P><PRE> foo = 20;
</PRE>
<P>(Bare words in lvalue context are now interpreted as either subs or 
filehandles, depending on what you have declared or open.) </P>
<P>Unfortunately, you can't return arrays, hashes or slices of arrays or 
hashes. This is where the trouble started. The problem is that you need to be 
able to tell, for instance, that the operator that returns an array that you actually 
do want the array itself, rather than a list of its elements. Look at this: </P>
<P></P><PRE> @a = @b;
</PRE>
<P>Here, <CODE>@a</CODE> is being modified, and so the actual AV is put onto the 
stack. But in the case of <CODE>@b</CODE>, the list of its elements is put on 
the stack. The difference is that the op for <CODE>@a</CODE> knows it's being 
modified, and the one for <CODE>@b</CODE> doesn't. </P>
<P>Back to lvalue subs - we've got an operator in a subroutine that is going to 
be modified, so it needs to return the AV (the container) instead of the values. But which one? </P>
<P>There's nothing about an op that signifies that it's going to be used as a 
return value, so we don't know which op we need to tell that it's being 
modified. I had a go at a cheap way of doing it, but Stephen McCamant eventually persuaded me that it didn't really work, and he's now 
working on his own way of doing it, which looks quite nice. There followed a 
debate about what you ought to be able to return from an lvalue subroutine (Does 
<CODE>shift</CODE> constitute a modifiable value?) that is still going on. <A 
href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg00110.html">Read 
about it.</A></P>
<P>
<H3><A name=Stephen_McCamant_and_Doug_MacEachern_week>Stephen McCamant and Doug 
MacEachern week</A></H3>
<P></P>
<P>The second week of the report, the first week in January, was dominated by a 
lot of good stuff from Stephen and Doug. As well as picking up where I left off 
on lvalue subroutines, Stephen identified a problem with tests depending on 
modules that might not have been built, (which must be a tricky area, because 
three people tried to patch it and only one succeeeded ... ) and then came out 
with some really solid patches. He fixed a couple of problems with 
<CODE>B::Deparse</CODE> and also Perl's handling of <CODE>continue</CODE> 
blocks, and then a problem with all global variables looking like they'd been 
declared with <CODE>our</CODE>. (This is quite a complex one, so if you're 
interested, <A 
href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg00246.html">read 
the patch description</A>.) To cap it all, he produced a  useful tool 
that he believes is a replacement for <CODE>B::Terse</CODE>; it's called 
<CODE>B::Concise</CODE> and it allows you to control the output format through a 
pattern language, and you can get it from <A 
href="http://csua.berkeley.edu/~smcc/Concise.pm">http://csua.berkeley.edu/~smcc/Concise.pm</A>. 
</P>
<P>Not to be outdone, Doug noticed a conflict between two system header files, 
which could well be Linux being sloppy, and a conflict between PerlIO and stdio; 
he then patched the default XS typemap to use <CODE>Perl_croak</CODE> instead of 
the older, deprecated <CODE>croak</CODE>, tried to fix XSUBs to be declared 
static (but Nick I-S pointed out that wouldn't fly) but plumped for giving them 
an additional prototype to help with compiler warnings, and added a nice 
shortcut to the XS build process so you can say </P>
<P></P><PRE> make MyModule.i
</PRE>
<P>and get a pre-processed version of the C file. He also fixed some prototypes, 
and finished the week with a stroke of pure genius, allowing 
<CODE>AUTOLOAD</CODE> to be an XSUB. 
<H3><A name=Things_to_investigate>Things to investigate</A></H3>
<P></P>
<P>Here are some things that out-of-work porters can investigate: (in fact, it 
would be really nice if everyone who submitted bug reports got <B>some</B> kind 
of feedback from a human being, so if you see something that hasn't been dealt 
with, why not look into it?) 
<P><A 
href="http://bugs.perl.org/perlbug.cgi?req=bid&amp;amp;amp;amp;bid=20010102.004&amp;amp;amp;amp;range=15148&amp;amp;amp;amp;format=H">This 
bug </A>appears to require a strange set of conditions, but generates a 
segfault; perhaps someone could find out where it's segfaulting, try and narrow 
down the problem, and report back.</P>
<P>A bizarre one from <CODE>torsten@sotlx2.sot.de</CODE>: "When descending into 
a Joliet filesystem Find stops after the first level. Rockridge or ISO CDs are 
ok." (That's bug ID 20010103.001, if you're thinking of fixing it.) </P>
<P>For the scary and godlike, here's a <A 
href="http://bugs.perl.org/perlbug.cgi?req=bid&amp;amp;amp;amp;bid=20010104.011&amp;amp;amp;amp;range=15148&amp;amp;amp;amp;format=H">B::C 
bug</A> for you to chew on. Enjoy. 
<H3><A name=Various>Various</A></H3>
<P></P>
<P>There is little else to report this week; a couple of reports of bugs fixed in 
the latest snapshots - if you're reporting a bug, could you please try it out in 
at least 5.7.0, if not more freqent snapshots, because we could already have 
fixed it. In the second week, there were many little patches that didn't 
generate any discussion but were still good to see. Only four new 
IV-preservation bugs this time. </P>
<P>Some spam, many test results (Thanks, Alan!) and a couple of nonbugs. </P>
<P>Until next week I remain, your humble and obedient servant, </P>
<HR>
<A href="mailto:simon@brecon.co.uk">Simon Cozens</A> 

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1418" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/01/begperl6.html" rel="bookmark">Beginners Intro to Perl - Part 6</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Doug Sheppard</span> on <abbr class="published" title="2001-01-09T00:00:00-08:00">January  9, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p><em>Editor's note: this venerable series is undergoing updates.  You might be interested in the newer versions, available at:</em></p>

<ul>
<li><a href="/pub/a/2008/04/23/a-beginners-introduction-to-perl-510.html">A Beginner's Introduction to Perl 5.10</a>
<li><a href="/pub/a/2008/05/07/beginners-introduction-to-perl-510-part-2.html">A
Beginner's Introduction to Files and Strings with Perl 5.10</a>
<li><a href="http://news.oreilly.com/2008/06/a-beginners-introduction-to-pe.html">A
Beginner's Introduction to Regular Expressions with Perl 5.10</a></li>
<li><a href="http://broadcast.oreilly.com/2008/09/a-beginners-introduction-to-pe.html">A Beginner's Introduction to Perl Web Programming</a></li>

</ul>

<p><table width="180" cellspacing="0" cellpadding="4" align="right" border="1">

<tr>
<td align="center" valign="top" bgcolor="#6699cc">
<font color="#ffffff">Table of Contents</td>
</tr>

<tr>
<td>
<p class="fine">
&#149;<b><a href="/pub/2000/10/begperl1.html">Part 1 of this series</a></b><br />
&#149;<b><a href="/pub/2000/11/begperl2.html">Part 2 of this series</a></b><br />
&#149;<b><a href="/pub/2000/11/begperl3.html">Part 3 of this series</a></b><br />
&#149;<b><a href="/pub/2000/12/begperl4.html">Part 4 of this series</a></b><br />
&#149;<b><a href="/pub/2000/12/begperl5.html">Part 5 of this series</a></b><br /><br />

&#149;<a href="#doing it right the first time">Doing It Right the First Time</a><br />
&#149;<a href="#comments">Comments</a><br />
&#149;<a href="#warnings">Warnings</a><br />
&#149;<a href="#taint">Taint</a><br />
&#149;<a href="#stuff taint doesn't catch">Stuff Taint Doesn't Catch</a><br />
&#149;<a href="#use strict"><code>use strict</a></code><br />
&nbsp;&nbsp;&#149;<a href="#strict vars">Strict vars</a><br />
&nbsp;&nbsp;&#149;<a href="#strict subs">Strict subs</a><br />
&nbsp;&nbsp;&#149;<a href="#want a sub, get a string">Want a Sub, Get a String</a><br />
&nbsp;&nbsp;&#149;<a href="#the one exception">The One Exception</a><br />
&#149;<a href="#is this overkill">Is 
    This Overkill?</a><br />
&#149;<a href="#play around!">Play Around!</a><br />


</td>
</tr>
</p>
</table>

<h2><a name="doing it right the first time">Doing It Right the First 
Time</a></h2>

<br />

<p>Perl is a useful tool, which many people use to write some good software. 
But like all programming languages, Perl can also be used to create <em>bad</em> 
software. Bad software contains bugs, has security holes and is hard to fix or 
extend.</p>
<p>Fortunately, Perl offers you many ways to increase the quality of the 
programs you write. In this last installment in the Beginner's Intro series, 
we'll take a look at a few of them.</p>
<p>
<h3><a name=comments>Comments</a></h3>
<p>In the first part of this series, we looked at the lowly <code>#</code>, 
which indicates a comment. Comments are your first line of defense against bad 
software, because they help answer the two questions that people always have 
when they look at source code: What does this program do and how does it do it? 
Comments should <em>always</em> be part of any software you write. Complex code 
with no comments is not <em>automatically</em> evil, but bring some holy water 
just in case.</p>
<p>Good comments are short, but instructive. They tell you things that aren't 
clear from reading the code. For example, here's some obscure code that could 
use a comment or two:</p><pre>        for $i (@q) {
            my ($j) = fix($i);
            transmit($j);
        }</pre>
<p>Bad comments would look like this:</p><pre>        for $i (@q) { # @q is list from last sub
            my ($j) = fix($i);  # Gotta fix $j...
            transmit($j);  # ...and then it goes over the wire
        }</pre>
<p>Notice that you don't <em>learn</em> anything from these comments. <code>my 
($j) = fix($i); # Gotta fix $j...</code> is meaningless, the equivalent of a 
dictionary that contains a definition like <em>widget (n.): A widget</em>. 
<em>What</em> is <code>@q</code>? <em>Why</em> do you have to fix its values? 
That may be clear from the larger context of the program, but you don't want to 
skip all around a program to find out what one little line does!</p>
<p>Here's something a little clearer. Notice that we actually have 
<em>fewer</em> comments, but they're more instructive:</p><pre>       # Now that we've got prices from database, let's send them to the buyer
       for $i (@q) {
           my ($j) = fix($i);  # Add local taxes, perform currency exchange
           transmit($j);
       }</pre>
<p>Now it's obvious where <code>@q</code> comes from, and what 
<code>fix()</code> does.</p>
<p>
<h3><a name=warnings>Warnings</a></h3>
<p>Comments are good, but the most important tool for writing good Perl is the 
``warnings'' flag, the <code>-w</code> command line switch. You can turn on 
warnings by placing <code>-w</code> on the first line of your programs like 
so:</p><pre>         #!/usr/local/bin/perl -w</pre>
<p>Or, if you're running a program from the command line, you can use 
<code>-w</code> there, as in <code>perl -w myprogram.pl</code>.</p>
<p>Turning on warnings will make Perl yelp and complain at a <em>huge</em> 
variety of things that are almost always sources of bugs in your programs. Perl 
normally takes a relaxed attitude toward things that may be problems; it assumes 
that you know what you're doing, even when you don't.</p>
<p>Here's an example of a program that Perl will be perfectly happy to run 
without blinking, even though it has an error on almost every line! 
(See how many you can spot.)</p><pre>       #!/usr/local/bin/perl</pre><pre>       $filename = "./logfile.txt";
       open (LOG, $fn);
       print LOG "Test\n";
       close LOGFILE;</pre>
<p>Now, add the <code>-w</code> switch to the first line, and run it again. You 
should see something like this:</p>
<p>Name ``main::filename'' used only once: possible typo at ./a6-warn.pl line 3. 
Name ``main::LOGFILE'' used only once: possible typo at ./a6-warn.pl line 6. 
Name ``main::fn'' used only once: possible typo at ./a6-warn.pl line 4. Use of 
uninitialized value at ./a6-warn.pl line 4. print on closed filehandle main::LOG 
at ./a6-warn.pl line 5.</p>
<p>Here's what each of these errors means:</p>
<p>1. <em>Name ``main::filename'' used only once: possible typo at ./a6-warn.pl 
line 3.</em> and <em>Name ``main::fn'' used only once: possible typo at 
./a6-warn.pl line 4.</em> Perl notices that <code>$filename</code> and 
<code>$fn</code> both only get used once, and guesses that you've 
misspelled or misnamed one or the other. This is because this almost always 
happens because of typos or bugs in your code, like using <code>$filenmae</code> 
instead of <code>$filename</code>, or using <code>$filename</code> throughout 
your program except for one place where you use <code>$fn</code> (like in this 
program).</p>
<p>2. <em>Name ``main::LOGFILE'' used only once: possible typo at ./a6-warn.pl 
line 6.</em> In the same way that we made our <code>$filename</code> typo, we 
mixed up the names of our filehandles: We use <code>LOG</code> for the 
filehandle while we're writing the log entry, but we try to close 
<code>LOGFILE</code> instead.</p>
<p>3. <em>Use of uninitialized value at ./a6-warn.pl line 4.</em> This is one of 
Perl's more cryptic complaints, but it's not difficult to fix. This means that 
you're trying to use a variable before you've assigned a value to it, and that 
is almost always an error. When we first mentioned <code>$fn</code> in our 
program, it hadn't been given a value yet. You can avoid this type of warning by 
always setting a <em>default</em> value for a variable before you first use 
it.</p>
<p>4. <em>print on closed filehandle main::LOG at ./a6-warn.pl line 5.</em> We 
didn't successfully open <code>LOG</code>, because <code>$fn</code> was empty. 
When Perl sees that we are trying to print something to the <code>LOG</code> 
filehandle, it would normally just ignore it and assume that we know what we're 
doing. But when <code>-w</code> is enabled, Perl warns us that it suspects 
there's something afoot.</p>
<p>So, how do we fix these warnings? The first step, obviously, is to fix these 
problems in our script. (And while we're at it, I deliberately violated our rule 
of always checking if <code>open()</code> succeeded! Let's fix that, too.) This 
turns it into:</p><pre>        #!/usr/local/bin/perl -w</pre><pre>        $filename = "./logfile.txt";
        open (LOG, $filename) or die "Couldn't open $filename: $!";
        print LOG "Test\n";
        close LOG;</pre>
<p>Now, we run our corrected program, and get this back from it:</p>
<p><em>Filehandle main::LOG opened only for input at ./a6-warn2.pl line 
5.</em></p>
<p>Where did <em>this</em> error come from? Look at our <code>open()</code>. 
Since we're not preceding the filename with &gt; or &gt;&gt;, Perl opens the 
file for <em>reading</em>, but in the next line we're trying to 
<em>write</em> to it with a <code>print</code>. Perl will normally let this 
pass, but when warnings are in place, it alerts you to possible problems. 
Change line 4 to this instead and everything will be great:</p><pre>       open (LOG, "&gt;&gt;$filename") or die "Couldn't open $filename: $!";
</pre>
<p>
The <code>&lt;-w&gt;</code> flag is your friend.  Keep it on at all times.  You may also
want to read the <code>&lt;perldiag&gt;</code> man page, which contains a listing of all
the various messages (including warnings) Perl will spit out when it
encounters a problem.  Each message is accompanied by a detailed
description of what the message means and how to fix it.</pre>
<p>
<h3><a name=taint>Taint</a></h3>
<p>Using <code>-w</code> will help make your Perl programs correct, but it won't 
help make them <em>secure</em>. It's possible to write a program that doesn't 
emit a single warning, but is totally insecure!</p>
<p>For example, let's say that you are writing a CGI program that needs to write 
a user's comment to a user-specified file. You might use something like 
this:</p><pre>       #!/usr/local/bin/perl -w</pre><pre>       use CGI ':standard';</pre><pre>       $file = param('file');
       $comment = param('comment');</pre><pre>       unless ($file) { $file = 'file.txt'; }
       unless ($comment) { $comment = 'No comment'; }</pre><pre>       open (OUTPUT, "&gt;&gt;/etc/webstuff/storage/" . $file) or die "$!";
       print OUTPUT $comment . "\n";
       close OUTPUT;</pre><pre>       print header, start_html;
       print "&lt;P&gt;Thanks!&lt;/P&gt;\n";       
       print end_html;</pre>
<p>If you read the CGI programming installment, alarm bells are already ringing 
loud enough to deafen you. This program trusts the user to specify only a 
``correct'' filename, and you know better than to trust the user. But nothing in 
this program will cause <code>-w</code> to bat an eye; as far as warnings are 
concerned, this program is completely correct.</p>
<p>Fortunately, there's a way to block these types of bugs before they 
become a problem. Perl offers a mechanism called <em>taint</em> that marks any 
variable that the user can possibly control as being insecure. This includes 
user input, file input and environment variables. Anything that you set within 
your own program is considered safe:</p><pre>     $taint = &lt;STDIN&gt;;   # This came from user input, so it's tainted
     $taint2 = $ARGV[1]; # The @ARGV array is considered tainted too.
     $notaint = "Hi";    # But this is in your program... it's untainted</pre>
<p>You enable taint checking with the <code>-T</code> flag, which you can 
combine with <code>-w</code> like so:</p><pre>      #!/usr/local/bin/perl -Tw</pre>
<p><code>-T</code> will prevent Perl from running most code that may be 
insecure. If you try to do various dangerous things with tainted variables, like 
open a file for writing or use the <code>system()</code> or <code>exec()</code> 
functions to run external commands, Perl will stop right away and complain.</p>
<p>You <em>untaint</em> a variable by running it through a regex with matching 
subexpressions, and using the results from the subexpressions. Perl will 
consider <code>$1</code>, <code>$2</code> and so forth to be safe for your 
program.</p>
<p>For example, our file-writing CGI program may expect that ``sane'' filenames 
contain only the alphanumeric characters that are matched by the <code>\w</code> 
metacharacter (this would prevent a malicious user from passing a filename like 
<code>~/.bashrc</code>, or even <code>../test</code>). We'd use a filter like 
so:</p><pre>       $file = param('file');
       if ($file) {
           $file =~ /^(\w+)$/;
           $file = $1;
       }</pre><pre>       unless ($file) { $file = "file.txt"; }</pre>
<p>Now, <code>$file</code> is guaranteed to be untainted. If the user passed us 
a filename, we don't use it until we've made sure it matches only 
<code>\w+</code>. If there was no filename, then we specify a default in our 
program. As for <code>$comment</code>, we never actually do anything that would 
cause Perl's taint checking to worry, so it doesn't need to be checked to pass 
<code>-T</code>.</p>
<p>
<h3><a name="stuff taint doesn't catch">Stuff Taint Doesn't Catch</a></h3>
<p>Be careful! Even when you've turned on taint checking, you can still write an 
insecure program. Remember that taint only gets looked at when you try to 
<em>modify</em> the system, by opening a file or running a program. Reading from 
a file will not trigger taintedness! A <em>very</em> common breed of security 
hole exploits code that doesn't look very different from this small program:</p><pre>        #!/usr/local/bin/perl -Tw</pre><pre>        use CGI ':standard';</pre><pre>        $file = param('filename');
        unless ($file) { $file = 'file.txt'; }</pre><pre>        open (FILE, "&lt;/etc/webstuff/storage/" . $file) or die "$!";</pre><pre>        print header();
        while ($line = &lt;FILE&gt;) {
            print $line;
        }</pre><pre>        close FILE;</pre>
<p>Just imagine the joy when the ``filename'' parameter contains 
<code>../../../../../../etc/passwd</code>. (If you don't see the problem: On a 
Unix system, the <code>/etc/passwd</code> file contains a list of all the 
usernames on the system, and may also contain an encrypted list of their 
passwords. This is great information for crackers who want to get into a machine 
for further mischief.) Since you are only reading the file, Perl's taint 
checking doesn't kick in. Similarly, <code>print</code> doesn't trigger taint 
checking, so you'll have to write your own value-checking code when you write 
any user input to a file!</p>
<p>Taint is a good <em>first</em> step in security, but it's not the last.</p>
<p>
<h3><a name="use strict"><code>use strict</code></a></h3>
<p>Warnings and taint are two excellent tools for preventing your programs from 
doing bad things. If you want to go <em>further</em>, Perl offers <code>use 
strict</code>. These two simple words can be put at the beginning of any 
program:</p><pre>        #!/usr/local/bin/perl -wT</pre><pre>        use strict;</pre>
<p>A command like <code>use strict</code> is called a <em>pragma</em>. Pragmas 
are instructions to the Perl interpreter to do something special when it runs 
your program. <code>use strict</code> does two things that make it harder to 
write bad software: It makes you declare all your variables (``strict vars''), 
and it makes it harder for Perl to mistake your intentions when you are using 
subs (``strict subs'').</p>
<p>If you only want to use one or two types of strictness in your program, you 
can list them in the <code>use strict</code> pragma, or you can use a special 
<code>no strict</code> pragma to turn off any or all of the strictness you 
enabled earlier.</p><pre>        use strict 'vars';   # We want to require variables to be declared
        no strict 'vars';    # We'll go back to normal variable rules now</pre><pre>        use strict 'subs';   # We want Perl to distrust barewords (see below).</pre><pre>        no strict;           # Turn it off. Turn it all off. Go away, strict.</pre>
<p>(There's actually a third type of strictness - strict refs - which prevents you 
from using symbolic references. Since we haven't really dealt with references, 
we'll concentrate on the other two types of strictness.)</p>
<p>
<h3><a name="strict vars">Strict vars</a></h3>
<p>Perl is generally trusting about variables. It will alllow you to create them out 
of thin air, and that's what we've been doing in our programs so far. One way to 
make your programs more correct is to use <em>strict vars</em>, which means that 
you must always <em>declare</em> variables before you use them. You declare 
variables by using the <code>my</code> keyword, either when you assign values to 
them or before you first mention them:</p><pre>        my ($i, $j, @locations);
        my $filename = "./logfile.txt";
        $i = 5;</pre>
<p>This use of <code>my</code> doesn't interfere with using it elsewhere, like 
in subs, and remember that a <code>my</code> variable in a sub will be used 
instead of the one from the rest of your program:</p><pre>        my ($i, $j, @locations);
        # ... stuff skipped ...
        sub fix {
            my ($q, $i) = @_;  # This doesn't interfere with the program $i!
        }</pre>
<p>If you end up using a variable <em>without</em> declaring it, you'll see an 
error before your program runs:</p><pre>        use strict;
        $i = 5;
        print "The value is $i.\n";</pre>
<p>When you try to run this program, you see an error message similar to 
<em>Global symbol ``$i'' requires explicit package name at a6-my.pl line 3.</em> 
You fix this by declaring <code>$i</code> in your program:</p><pre>        use strict;
        my $i = 5;   # Or "my ($i); $i = 5;", if you prefer...
        print "The value is $i.\n";</pre>
<p>Keep in mind that <em>some</em> of what strict vars does will overlap with 
the <code>-w</code> flag, but not all of it. Using the two together makes it 
much more difficult, but not impossible, to use an incorrect variable name. For 
example, strict vars <em>won't</em> catch it if you accidentally use the 
<em>wrong</em> variable:</p><pre>         my ($i, $ii) = (1, 2);
         print 'The value of $ii is ', $i, "\n";</pre>
<p>This code has a bug, but neither strict vars nor the <code>-w</code> flag 
will catch it.</p>
<p>
<h3><a name="strict subs">Strict subs</a></h3>
<p>During the course of this series, I've deliberately avoided mentioning all 
sorts of tricks that allow you to write more <em>compact</em> Perl. This is because 
of a simple rule: <em>readability always wins</em>. Not only can compactness 
make it difficult to read code, it can sometimes have weird side effects! The 
way Perl looks up subs in your program is an example. Take a look at this pair 
of three-line programs:</p><pre>       $a = test_value;
       print "First program: ", $a, "\n";
       sub test_value { return "test passed"; }</pre><pre>       sub test_value { return "test passed"; }
       $a = test_value;
       print "Second program: ", $a, "\n";</pre>
<p>The same program with one little, insignificant line moved, right? In both 
cases we have a <code>test_value()</code> sub and we want to put its result into 
<code>$a</code>. And yet, when we run the two programs, we get two different 
results:</p><pre>       First program's result: test_value
       Second program's result: test passed</pre>
<p>The reason <em>why</em> we get two different results is a little 
convoluted.</p>
<p>In the first program, at the point we get to <code>$a = test_value;</code>, 
Perl doesn't know of any <code>test_value()</code> sub, because it hasn't gotten 
that far yet. This means that <code>test_value</code> is interpreted as if it 
were the string 'test_value'.</p>
<p>In the second program, the definition of <code>test_value()</code> comes 
<em>before</em> the <code>$a = test_value;</code> line. Since Perl has a 
<code>test_value()</code> sub to call, that's what it thinks 
<code>test_value</code> means.</p>
<p>The technical term for isolated words like <code>test_value</code> that might 
be subs and might be strings depending on context, by the way, is 
<em>bareword</em>. Perl's handling of barewords can be confusing, and it can 
cause two different types of bug.</p>
<p>
<h3><a name="want a sub, get a string">Want a Sub, Get a String</a></h3>
<p>The first type of bug is what we encountered in our first program, which I'll 
repeat here:</p><pre>        $a = test_value;
        print "First program: ", $a, "\n";
        sub test_value { return "test passed"; }</pre>
<p>Remember that Perl won't look forward to find <code>test_value()</code>, so 
since it hasn't <em>already</em> seen <code>test_value()</code>, it assumes that 
you want a string. Strict subs will cause this program to die with an error:</p><pre>        use strict;</pre><pre>        my $a = test_value;
        print "Third program: ", $a, "\n";
        sub test_value { "test passed"; }</pre>
<p>(Notice the <code>my</code> put in to make sure that strict vars 
won't complain about <code>$a</code>.)</p>
<p>Now you get an error message like <em>Bareword ``test_value'' not allowed 
while ``strict subs'' in use at ./a6-strictsubs.pl line 3.</em> This is easy to 
fix, and there are two ways to do it:</p>
<p>1. Use parentheses to make it clear you're calling a sub. If Perl sees 
<code>$a = test_value();</code>, it will assume that even if it hasn't seen 
<code>test_value()</code> defined yet, it will sometime between now and the end 
of the program. (If there isn't any <code>test_value()</code> in your program, 
Perl will die while it's running.) This is the easiest thing to do, and often 
the most readable.</p>
<p>2. Declare your sub before you first use it, like this:</p><pre>        use strict;</pre><pre>        sub test_value;  # Declares that there's a test_value() coming later ...
        my $a = test_value;  # ...so Perl will know this line is okay.
        print "Fourth program: ", $a, "\n";
        sub test_value { return "test_passed"; }</pre>
<p>Declaring your subs has the advantage of allowing you to maintain the <code>$a = 
test_value;</code> syntax if that's what you find more readable, but it's also a 
little obscure. Other programmers may not see why you have <code>sub 
test_value;</code> in your code.</p>
<p>Of course, you could always move the definition of your sub <em>before</em> 
the line where you want to call it. This isn't quite as good as either of the 
other two methods, because now you are moving code around instead of making your 
existing code clearer. Also, it can cause <em>other</em> problems, which we'll 
discuss now ...</p>
<p>
<h3><a name="want a string, get a sub">Want a String, Get a Sub</a></h3>
<p>We've seen how <code>use strict</code> can help prevent an error where 
you intend to call a sub, but instead get a string value. It also
helps prevent the opposite error: wanting a string value, but calling a sub instead. 
This is a more dangerous class of bug, because it can be <em>very</em> 
hard to trace, and it often pops up in the most unexpected places. Take a look 
at this excerpt from a long program:</p><pre>        #!/usr/local/bin/perl -Tw</pre><pre>        use strict;</pre><pre>        use SomeModule;
        use SomeOtherModule;
        use YetAnotherModule;</pre><pre>        # ... (and then there's hundreds of lines of code) ...</pre><pre>        # Now we get to line 400 of the program, which tests if we got an "OK"
        # before we act on a request from the user.
        if ($response_code eq OK) {
            act_on($request);
        } else {
            throw_away($request);
        }</pre>
<p>This program works without a hitch for a long time, because Perl sees the 
bareword <code>OK</code> and considers it to be a literal string. Then, two 
years later someone needs to add code to make this program understand HTTP 
status codes. They stick this in at line 2, or line 180, or line 399 (it doesn't 
matter <em>exactly</em> where, just that it comes before line 400):</p><pre>        sub OK { return 200; } # HTTP "request ok, response follows" code
        sub NOT_FOUND { return 404; } # "URL not found" code
        sub SERVER_ERROR { return 500; } # "Server can't handle request"</pre>
<p>Take a moment to guess what happens to our program now. Try to work the word 
``disaster'' into it.</p>
<p>Thanks to this tiny change, our program now throws away every request 
that comes in to it. The <code>if ($response eq OK)</code> test now calls the 
<code>OK()</code> sub, which returns a value of 200. The <code>if</code> now 
fails every time! The programmer, if they still have a job after this fiasco, 
must hunt through the entire program to find out exactly when the behavior of 
<code>if ($response eq OK)</code> changed, and why.</p>
<p>By the way, if the programmer is <em>really</em> unlucky, that new 
<code>OK()</code> sub wouldn't even be in <em>their</em> code at all, but 
defined somewhere in a new version of <code>SomeOtherModule.pm</code> that just 
got installed!</p>
<p>Barewords are dangerous because of this unpredictable behavior. <code>use 
strict</code> (or <code>use strict 'subs'</code>) makes them predictable, 
because barewords that might cause strange behavior in the future will make your 
program die before they can wreak havoc.</p>
<p>
<h3><a name="the one exception">The One Exception</a></h3>
<p>There's <em>one</em> place where it's OK to use barewords even when you've 
turned on strict subs: when you are assigning hash keys.</p><pre>        $hash{sample} = 6;   # Same as $hash{'sample'} = 6
        %other_hash = ( pie =&gt; 'apple' );</pre>
<p>Barewords in hash keys are always interpreted as strings, so there is no 
ambiguity.</p>
<p>
<h3><a name="is this overkill">Is This Overkill?</a></h3>
<p>There are times when using all of the quality enforcement functionality (or 
``correctness police,'' if you like to anthropmorphize) Perl offers seems like 
overkill. If you're just putting together a quick, three-line tool that you'll 
use once and then never touch again, you probably don't care about whether it'll 
run properly under <code>use strict</code>. When you're the only person who will 
run a program, you generally don't care if the <code>-T</code> flag will show 
that you're trying to do something unsafe with a piece of user input.</p>
<p>Still, it's a good idea to use every tool at your disposal to write good 
software. Here are three reasons to be concerned about correctness when you 
write just about <em>anything</em>:</p>
<p>1. <em>One-off programs aren't.</em> There are few programs worth writing 
that only get run once. Software tools tend to accumulate, and get used. You'll 
find that the more you use a program, the more you want it to do.</p>
<p>2. <em>Other people will read your code.</em> Whenever programmers write 
something really good, they tend to keep it around, and give it to friends who 
have the same problem. More importantly, most projects aren't one-person jobs; 
there are teams of programmers who need to work together, reading, fixing and 
extennding one another's code. Unless your plans for the future include always 
working alone and having no friends, you should expect that other people will 
someday read and modify your code.</p>
<p>3. <em><strong>You</strong> will read your code.</em> Don't think you have a 
special advantage in understanding your code just because you wrote it! Often 
you'll need to go back to software you wrote months or even years earlier to fix 
it or extend it. During that time you'll have forgotten all those clever little 
tricks you came up with during that caffeine-fueled all-nighter and all the 
little gotchas that you noticed but thought you would fix later.</p>
<p>These three points all have one thing in common: Your programs <em>will</em> 
be rewritten and enhanced by people who will appreciate every effort you make to 
make their job easier. When you make sure your code is readable and correct, it 
tends to start out much more secure and bug-free, and it tends to stay that way, 
too!</p>
<p>
<h3><a name="play around!">Play Around!</a></h3>
<p>During the course of this series, we've only scratched the surface of what Perl 
can do. Don't take these articles as being definitive - they're just an 
introduction! Read the <code>perlfunc</code> page to learn about all of Perl's 
built-in functions and see what ideas they inspire. My biography page tells you 
how to get in touch with me if you have any questions.</p></body></html>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2000/12/">&laquo; December 2000</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2001/02/">February 2001 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
