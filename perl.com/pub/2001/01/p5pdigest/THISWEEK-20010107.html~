<H2>This fortnight on perl5-porters (25 Dec 2000--7 Jan 2001)</H2><!- :field::id-author::before=by+::><BR><!- :field::date::><BR>
<P></P>
<P>
<UL>
  <LI><A 
  href="http://www.plover.com/~mjd/misc/THISWEEK-20001231.html#Notes">Notes</A> 
  <LI><A 
  href="http://www.plover.com/~mjd/misc/THISWEEK-20001231.html#Fix_for_gv_handler_segfault">Fix 
  for gv_handler segfault</A> 
  <LI><A 
  href="http://www.plover.com/~mjd/misc/THISWEEK-20001231.html#rsync_needs_occasional_delete">rsync 
  needs occasional delete</A> 
  <LI><A 
  href="http://www.plover.com/~mjd/misc/THISWEEK-20001231.html#Outstanding_Unicode_fix">Outstanding 
  Unicode fix</A> 
  <LI><A 
  href="http://www.plover.com/~mjd/misc/THISWEEK-20001231.html#New_Solaris_hints_file">New 
  Solaris hints file</A> 
  <LI><A 
  href="http://www.plover.com/~mjd/misc/THISWEEK-20001231.html#Lots_of_lvalue_hackery">Lots 
  of lvalue hackery</A> 
  <LI><A 
  href="http://www.plover.com/~mjd/misc/THISWEEK-20001231.html#Stephen_McCamant_and_Doug_MacEachern_week">Stephen 
  McCamant and Doug MacEachern week</A> 
  <LI><A 
  href="http://www.plover.com/~mjd/misc/THISWEEK-20001231.html#Things_to_investigate">Things 
  to investigate</A> 
  <LI><A 
  href="http://www.plover.com/~mjd/misc/THISWEEK-20001231.html#Various">Various</A> 
  </LI></UL>
<H3><A name=Notes>Notes</A></H3>
<P></P>
<P>You can subscribe to an e-mail version of this summary by sending an empty 
message to <A 
href="mailto:p5p-digest-subscribe@plover.com"><TT>p5p-digest-subscribe@plover.com</TT>.</A></P>
<P>Please send corrections and additions to 
<CODE>perl-thisweek-YYYYMM@simon-cozens.org</CODE> where <CODE>YYYYMM</CODE> is 
the current year and month. </P>
<P>Allow me to apologize for there being no service last week, as I was 
traveling hither and thither for New Year's festivities. This is another 
special bumper edition covering last week and the week before. 
<H3><A name=Fix_for_gv_handler_segfault>Fix for gv_handler segfault</A></H3>
<P></P>
<P>Lupe Christoph found an ugly bug uncovered by Ilya's recent object 
destruction speedup patch: Basically, we had called a function ( 
<CODE>mg_find</CODE>) on a stash before actually making sure that the stash 
existed, causing a segfault. Lupe added a sanity check to the handler 
function and <CODE>mg_find</CODE>, just to be on the safe side. 
<H3><A name=rsync_needs_occasional_delete>rsync needs occasional delete</A></H3>
<P></P>
<P>Lupe also got bitten by a problem that could affect some of you if you're 
following the rsync mainline: Rsync won't, by default, delete files that have 
been deleted from the repository. This caused strange test failures, because the 
test that was failing doesn't exist any more ... . He passes on these words of wisdom: 
<BLOCKQUOTE>
  <P></P>
  <P>Note that this will not delete any files that were in '.' before the rsync. 
  Once you are sure that the rsync is running correctly, run it with the 
  --delete and the --dry-run options like this: </P>
  <P># rsync -avz --delete --dry-run 
  rsync://ftp.linux.activestate.com/perl-current/ . </P>
  <P>
  <P>This will <I>simulate</I> an rsync run that also deletes files not present 
  in the bleadperl master copy. Observe the results from this run closely. If you 
  are sure that the actual run would delete no files precious to you, you could 
  remove the '--dry-run' option.</P></BLOCKQUOTE>
<H3><A name=Outstanding_Unicode_fix>Outstanding Unicode fix</A></H3>
<P></P>
<P><!-- That's outstanding as in "very good," rather than "missing" --></P>
<P>This sneaked in just as I was writing the previous summary: INABA Hiroto came 
up with a 48k patch that fixed a few Unicode bugs. He also added a pragma 
<CODE>unicode::distinct</CODE>, which makes a Unicode-encoded string never equal 
to a nonencoded string. That's to say, if we have: </P>
<P></P><PRE>    $a = chr(50).chr(400); # Needs to be UTF8-encoded, because of chr(400)
    chop($a);              # Now we have chr(50), but it's still encoded.
    $b = chr(50)           # This isn't UTF8-encoded
</PRE>
<P>Under normal circumstances, <CODE>$a eq $b</CODE>. This is what we expect, 
because they represent the same character. But under 
<CODE>unicode::distinct</CODE>, they won't be equal because they are represented 
differently. </P>
<P>He also fixed a few other issues I should have been looking at, like Unicode 
<CODE>tr///</CODE>. <!-- which is great, because I really thought nobody cared -->
<H3><A name=New_Solaris_hints_file>New Solaris hints file</A></H3>
<P></P>
<P>Lupe Christoph (again; busy man) attempted to update the Solaris hints 
file; it looked pretty good, but produced weird errors (No, Solaris machines are 
<B>not</B> EBCDIC. Or at least, not normally.) that were traced to a problem 
with Configure calling another shell file to get more information (a "call back 
unit") but then getting confused as to where the source directory is. Robin 
Barker also found a similar problem when Configure sets <CODE>$src</CODE> using 
a relative path instead of an absolute one. The problem was eventually hunted 
down and shot, and the new hints file is now working properly. </P>
<P>Jarkko also re-wrote the DEC OSF hints file. 
<H3><A name=Lots_of_lvalue_hackery>Lots of lvalue hackery</A></H3>
<P></P>
<P>I got into a very strange mood and started looking at lvalue subroutines. 
These are things that allow you to return a variable or something modifiable 
from a subroutine, like this: </P>
<P></P><PRE> $a = 20;
 sub foo :lvalue { $a }
 foo() = 30; # Now $a is 30
</PRE>
<P>The first problem was that this didn't extend to <CODE>AUTOLOAD</CODE>, 
meaning you couldn't say </P>
<P></P><PRE> sub AUTOLOAD : lvalue { ${$AUTOLOAD} }
 foo() = 20;
</PRE>
<P>and have it set <CODE>$foo</CODE>. Perhaps that was meant to be a feature, 
but it was fixed anyway. Of course, the natural extension to that would be to 
let subs be called without the brackets, like this: </P>
<P></P><PRE> foo = 20;
</PRE>
<P>(Bare words in lvalue context are now interpreted as either subs or 
filehandles, depending on what you have declared or open.) </P>
<P>Unfortunately, you can't return arrays, hashes or slices of arrays or 
hashes. This is where the trouble started. The problem is that you need to be 
able to tell, for instance, that the operator that returns an array that you actually 
do want the array itself, rather than a list of its elements. Look at this: </P>
<P></P><PRE> @a = @b;
</PRE>
<P>Here, <CODE>@a</CODE> is being modified, and so the actual AV is put onto the 
stack. But in the case of <CODE>@b</CODE>, the list of its elements is put on 
the stack. The difference is that the op for <CODE>@a</CODE> knows it's being 
modified, and the one for <CODE>@b</CODE> doesn't. </P>
<P>Back to lvalue subs - we've got an operator in a subroutine that is going to 
be modified, so it needs to return the AV (the container) instead of the values. But which one? </P>
<P>There's nothing about an op that signifies that it's going to be used as a 
return value, so we don't know which op we need to tell that it's being 
modified. I had a go at a cheap way of doing it, but Stephen McCamant eventually persuaded me that it didn't really work, and he's now 
working on his own way of doing it, which looks quite nice. There followed a 
debate about what you ought to be able to return from an lvalue subroutine (Does 
<CODE>shift</CODE> constitute a modifiable value?) that is still going on. <A 
href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg00110.html">Read 
about it.</A></P>
<P>
<H3><A name=Stephen_McCamant_and_Doug_MacEachern_week>Stephen McCamant and Doug 
MacEachern week</A></H3>
<P></P>
<P>The second week of the report, the first week in January, was dominated by a 
lot of good stuff from Stephen and Doug. As well as picking up where I left off 
on lvalue subroutines, Stephen identified a problem with tests depending on 
modules that might not have been built, (which must be a tricky area, because 
three people tried to patch it and only one succeeeded ... ) and then came out 
with some really solid patches. He fixed a couple of problems with 
<CODE>B::Deparse</CODE> and also Perl's handling of <CODE>continue</CODE> 
blocks, and then a problem with all global variables looking like they'd been 
declared with <CODE>our</CODE>. (This is quite a complex one, so if you're 
interested, <A 
href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg00246.html">read 
the patch description</A>.) To cap it all, he produced a  useful tool 
that he believes is a replacement for <CODE>B::Terse</CODE>; it's called 
<CODE>B::Concise</CODE> and it allows you to control the output format through a 
pattern language, and you can get it from <A 
href="http://csua.berkeley.edu/~smcc/Concise.pm">http://csua.berkeley.edu/~smcc/Concise.pm</A>. 
</P>
<P>Not to be outdone, Doug noticed a conflict between two system header files, 
which could well be Linux being sloppy, and a conflict between PerlIO and stdio; 
he then patched the default XS typemap to use <CODE>Perl_croak</CODE> instead of 
the older, deprecated <CODE>croak</CODE>, tried to fix XSUBs to be declared 
static (but Nick I-S pointed out that wouldn't fly) but plumped for giving them 
an additional prototype to help with compiler warnings, and added a nice 
shortcut to the XS build process so you can say </P>
<P></P><PRE> make MyModule.i
</PRE>
<P>and get a pre-processed version of the C file. He also fixed some prototypes, 
and finished the week with a stroke of pure genius, allowing 
<CODE>AUTOLOAD</CODE> to be an XSUB. 
<H3><A name=Things_to_investigate>Things to investigate</A></H3>
<P></P>
<P>Here are some things that out-of-work porters can investigate: (in fact, it 
would be really nice if everyone who submitted bug reports got <B>some</B> kind 
of feedback from a human being, so if you see something that hasn't been dealt 
with, why not look into it?) 
<P><A 
href="http://bugs.perl.org/perlbug.cgi?req=bid&amp;amp;amp;amp;bid=20010102.004&amp;amp;amp;amp;range=15148&amp;amp;amp;amp;format=H">This 
bug </A>appears to require a strange set of conditions, but generates a 
segfault; perhaps someone could find out where it's segfaulting, try and narrow 
down the problem, and report back.</P>
<P>A bizarre one from <CODE>torsten@sotlx2.sot.de</CODE>: "When descending into 
a Joliet filesystem Find stops after the first level. Rockridge or ISO CDs are 
ok." (That's bug ID 20010103.001, if you're thinking of fixing it.) </P>
<P>For the scary and godlike, here's a <A 
href="http://bugs.perl.org/perlbug.cgi?req=bid&amp;amp;amp;amp;bid=20010104.011&amp;amp;amp;amp;range=15148&amp;amp;amp;amp;format=H">B::C 
bug</A> for you to chew on. Enjoy. 
<H3><A name=Various>Various</A></H3>
<P></P>
<P>There is little else to report this week; a couple of reports of bugs fixed in 
the latest snapshots - if you're reporting a bug, could you please try it out in 
at least 5.7.0, if not more freqent snapshots, because we could already have 
fixed it. In the second week, there were many little patches that didn't 
generate any discussion but were still good to see. Only four new 
IV-preservation bugs this time. </P>
<P>Some spam, many test results (Thanks, Alan!) and a couple of nonbugs. </P>
<P>Until next week I remain, your humble and obedient servant, </P>
<HR>
<A href="mailto:simon@brecon.co.uk">Simon Cozens</A> 
