

<!-- This week on perl5-porters (07--14 Jan 2001) -->
<!- :field::id-author::before=by+::>
<br />
<!- :field::date::>
<br />

<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#Excising_sigsetjmp">Excising sigsetjmp</a>
  <li><a href="#Benchmarking">Benchmarking</a>
  <li><a href="#UTF8_Heroism">UTF8 Heroism</a>
  <li><a href="#Cygwin_versus_Windows">Cygwin versus Windows</a>
  <li><a href="#Lvalue_lists">Lvalue lists</a>
  <li><a href="#Linux_large_file_support">Linux large file support</a>
  <li><a href="#Calls_for_papers">Calls for papers</a>
  <li><a href="#Various">Various</a>
</ul>


      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>perl-thisweek-YYYYMM@simon-cozens.org</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
<H3><a name="Excising_sigsetjmp">Excising sigsetjmp</a></H3>

</P>

<P>

Alan Burlison found that by telling Perl that Solaris didn't really have 
<CODE>sigsetjmp</CODE>, he could get a noticable improvement in speed - around 15%. He asked
if 
<CODE>sigsetjmp</CODE> could go, or whether there was a reason for it being there. Andy
said there was a reason, but he had forgotten what it was. Nick I-S
asked if there was anything that 
<CODE>sigsetjmp</CODE> was absolutely required for - the answer, from Alan, was that 
<CODE>sigsetjmp</CODE> restores the signal mask after a jump. In Perl terms, this means that
 if you 
<CODE>die</CODE> from a signal handler into an 
<CODE>eval</CODE> (something you'd be doing with 
<CODE>alarm</CODE>, for instance) then you'd be sure to get your signal handler
reinstalled. With ordinary 
<CODE>setjmp</CODE> you might get your signal mask restored, but you might not. There was
 some discussion as to whether it would be possible to only use 
<CODE>sigsetjmp</CODE> to jump into and out of a signal handler, but Nicholas Clark pointed out
 that since any Perl subroutine could be a signal handler, it's more or
 less impossible to make a distinction. The eventual consensus is that
 Perl's signal handling is currently so, uh, sub-optimal, that it
 probably wouldn't make that much of a difference if 
<CODE>sigsetjmp</CODE> was removed.
</P>

<P>
In the end, Nick Ing-Simmons came up with a patch which provided roughly 
<CODE>sigsetjmp</CODE>-like semantics with ordinary 
<CODE>setjmp</CODE>, so it looks like there might be a win there.
<H3><a name="Benchmarking">Benchmarking</a></H3>

</P>

<P>

Alan did some more fiddling with optimization and Solaris configuration,
and managed to get what he claimed was a 30% overall speedup - 18% due
to 
<CODE>setjmp</CODE> and 12% due to optimizer settings. Numbers like that immediately
sparked a debate on how you can conceivably benchmark a programming
language manually; it's well known that the test suites exercises Perl
in a number of non-standard ways, and really doesn't represent real
world use. Alan said that his tests had been done on a real XS module for
dealilng with Solaris accounting. 
</P>

<P>
Nicholas Clark asked what a sensible benchmark would be; he suggested
Gisle's
<a href="http://search.cpan.org/search?mode=dist&amp;query=perlbench">perlbench</a>, which was at least designed to try to be a fair test for Perl, but it
seemed there was some confusion as to how it was supposed to work. Doug
Bagley's 
<a href="http://www.bagley.org/~doug/shootout/">programming language shootout </a> was also mentioned.
</P>

<P>
Jarkko nailed the question, in the end : &quot;The problem with all
artificial benchmarks is that they are artificial.&quot; 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg00401.html">Read about it.</a></P>

<P>

<H3><a name="UTF8_Heroism">UTF8 Heroism</a></H3>

</P>

<P>
INABA Hiroto's been at it again. With his latest patches, the Unicode
torture test works fine, which is fantastic news - Unicode should now be
considered stable and usable. In fact,
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg00326.html">one of his patches</a> also fixes a couple of regular expression bugs as well. There was then
some disagreement over Unicode semantics (as usual) and whether or not 
<CODE>\x{XX}</CODE> should produce Unicode output; Hiroto came up with an excellent
suggestion: the 
<CODE>qu//</CODE> operator would work like a quoted string but would always produce UTF8.
And, dammit, he implemented it as well. In the words of Pete Townsend, I've 
gotta hand my Unicode crown to him. Or something.
</P>

<P>
All that's really left to do now is to reconcile EBCDIC support and UTF8
support - the suggested way to do this was to put in some conversion
tables between the two character encodings, so that anything that
created UTF8 data would have its EBCDIC input sent through a filter to
turn it into Latin 1, and anything which decoded UTF8 data would be sent
through a filter to turn it back into EBCDIC. There was some progress on
that this week, but a fundamental problem remains: some things, such as
version strings, want the UTF8 codepoints qua codepoints. That's to say,
the numbers in 
<CODE>v5.7.0</CODE> should NOT be transformed into their EBCDIC equivalents. This was
manifesting itself with weird errors like 
</P>

</P><PRE>
    Perl lib version (v5.7.0) doesn't match executable version (v5.7.0)
</PRE>

<P>
But it's being worked on.
<H3><a name="Cygwin_versus_Windows">Cygwin versus Windows</a></H3>

</P>

<P>

Some issues surfaced while Reini Urban was looking at Berkeley DB
support in Cygwin - not all of them were Perl related, but contained
useful information for porters.
</P>

<P>
Some code in Berkeley DB relied on the maximum path length; Reini wanted
to use an 
<CODE>#ifdef _WIN32</CODE> block to get at 
<CODE>MAX_PATH</CODE>, but Charles Wilson pointed out that Cygwin should NOT define 
<CODE>_WIN32</CODE>, which is a compatibility crutch for bad ports. Cygwin already defines 
<CODE>FILENAME_MAX</CODE> and 
<CODE>PATH_MAX</CODE> as ISO C and POSIX demand, so those should be used instead of 
<CODE>MAX_PATH</CODE> which is a strange beast from Windows-land. 
</P>

<P>
The more general lesson here for Perl porters is that you should code
for Cygwin as if it were a real, POSIX-compliant system, rather than as
if it were Windows.
</P>

<P>
Oxymoron of the thread award went to Ernie Boyd, who explained 
<CODE>MAX_PATH</CODE> as a &quot;MS Windows standard&quot;.
<H3><a name="Lvalue_lists">Lvalue lists</a></H3>

</P>

<P>

Continuing the lvalue saga, Stephen McCamant produced a full and
glorious lvalue subroutine patch, which Jarkko applied. Tim Bunce
wondered what would happen if you said 
</P>

</P><PRE>
        (sub_returning_lvalue_hash()) = 1;
</PRE>

<P>
Stephen explained that the rules for assigning things is exactly the
same as you'd expect from scalars, and that, for instance, you should
put brackets around the right hand side if you're doing anything clever:
</P>

</P><PRE>
        sub_returning_lvalue_array() = (1, 2);
</PRE>

<P>
Radu Greab fixed a problem where lvalue subs weren't properly imposing
list context on the assignment; this causes all sorts of problems when
you have 
</P>

</P><PRE>
    (lvalue1(), lvalue2()) = split ' ', '1 2 3 4';
</PRE>

<P>
as 
<CODE>split</CODE> doesn't see the right number of elements to populate. This led to a
discussion of the curious and undocumented 
<CODE>PL_modcount</CODE>. This variable tells Perl how many things to fill up - it's actually
only used in the case of 
<CODE>split</CODE>. However, it uses the number 
<CODE>10000</CODE> as a signifier for &quot;this is going to be in list context, so just keep
filling&quot;. Jarkko, after possibly one too many games of 
<CODE>wumpus</CODE> raised objection to this undocumented, unmacroified bizarre magic
number. However, both the magic number and the lvalue split bug got
tidied up. 
<H3><a name="Linux_large_file_support">Linux large file support</a></H3>

</P>

<P>

Richard Soderberg had a valiant crack at getting large file support
to work under Linux, and concluded that he had to include the file 
<CODE>features.h</CODE> to make things work; after a little more messing around, he found that
<CODE>-D_GNU_SOURCE</CODE> should also turn on the required 64-bit types. Russ Allbery piped up
saying that 
<CODE>-D_GNU_SOURCE</CODE> ought to be more than enough - if it wasn't, there was a bug in glibc.
(It looked for a fun moment that 
<CODE>features.h</CODE> was somewhat ironically named.)
</P>

<P>
Andreas said that his experience had been that upgrading his kernel,
making the kernel headers available and then rebuilding glibc had
magically given him large file support with no changes to Perl required
- just a reconfigure and recompile. Linux users take note!
<H3><a name="Calls_for_papers">Calls for papers</a></H3>

</P>

<P>

Nat Torkington reminded us that the Perl Conference
<a href="http://conferences.oreilly.com/perl5/">call for papers</a> has been published, and gave a few 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg00654.html">ideas for papers</a> that Perl porters could give. We're trying to press-gang someone into
giving a paper on how the regular expression engine actually works, but
the usual suspects have gone very quiet.
</P>

<P>
Rich Lafferty also remarked that the equally worthy
<a href="http://yapc.org/America/">Yet Another Perl Conference</a> was also seeking papers. 
<H3><a name="Various">Various</a></H3>

</P>

<P>

Thanks for all the work on the bugs reported last week!
</P>

<P>
Until next week I remain, your humble and obedient servant,
</P>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Cozens</a>

