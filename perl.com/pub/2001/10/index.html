<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: October 2001 Archives</title>


    <link rel="prev" href="/pub/2001/09/" title="September 2001" />
    <link rel="next" href="/pub/2001/11/" title="November 2001" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">October 2001 Archives</h1>





                            
                            <div id="entry-1618" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/10/31/lighter.html" rel="bookmark">The Lighter Side of CPAN</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Alex Gough</span> on <abbr class="published" title="2001-10-31T00:00:00-08:00">October 31, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<p>Programming can be a stressful game.  We sit at our machines, day in,
day out, endlessly staring at a monitor fathoming where that last
devious bug has buried itself.  It's not surprising then that
sometimes it gets to be too much, and someone, somewhere, snaps.  The
strangest things become hilarious and valuable hours will be wasted
developing a strained play on words into a fully tested and highly
featured module.</p>
<p>Portions of this creative outpouring of humor often find their way
onto the CPAN.  There is even the special <code>Acme::*</code> name space set
aside for these bizarre freaks so they do not interfere with the
normal smooth running of that ever so special service.  It may seem a
little pointless for someone to release these into the wild, but you
may be surprised what you could learn from them.  A good joke is
usually marked out by being both funny and simple, and the same applies
to jokes told in Perl.  All unnecessary detail is stripped away,
leaving a short piece of code that makes a perfect example of how to
use, abuse or create a language feature.</p>
<p>There now follows a brief tour of some (but not all) of the more
amusing extensions to Perl, along with some hints on how you might
improve your programs by taking inspiration from the tricks they
use to implement their punch lines.  (Ba-boom tching!)</p>

<h3><a name="getting it wrong the wright way">Getting It Wrong the Wright Way</a></h3>
<p>Perl is a lazy language.  It appeals to the discerning man of leisure
who wants nothing more than a chance to get things done quickly.
There are some who would have Perl be more lazy but, until rescued by
Dave Cross and his band of visionaries, they were forced to work hard
making sure that every single keystroke they made was correct.
Dismayed by errors like:</p>
<pre>
 Undefined subroutine &amp;main::find_nexT called at frob.pl line 39.</pre>
<p>many turned away from Perl.  Now they return in droves, using
<code>Symbol::Approx::Sub</code>, their lives are made an order of magnitude
easier, leaving them more time to sip cocktails as they lounge in
deck chairs.  This module can even save you money; observe the simple
calculation of your fiscal dues after the careful application of a
couple of typos:</p>
<pre>
 #!/usr/bin/perl
 use Symbol::Approx::Sub;</pre>
<pre>
 sub milage  { 40_000   };
 sub taxipay {     10   };
 sub tax2pay {$_[0]*0.4 };
 sub myage   {     25   };
</pre>
<pre>

 # Sell car
 print &quot;For Sale: Very Good Car, only @{[ miage()]} on the clock\n&quot;;</pre>
<pre>

 # Cheque for tax man
 my $income = 40_000;
 print &quot;Must pay taxes, cheque for: @{[ taxpay($income) ]}\n&quot;;</pre>
<p>A calculation which could not be faulted by any government, but which
will leave you with a brand new car and, half the time, a whopping rebate:</p>
<pre>
 For Sale: Very Good Car, only 25 miles on the clock
 Must pay taxes, cheque for: 10</pre>
<p>How does this all work?  There are two major bits of magic going on:
installing a handler that intercepts calls to undefined subroutines
and a tool for divining the names of those routines that it can call
instead.</p>
<p>The handler is implemented by creating an <code>AUTOLOAD</code> function for the
module that <code>use</code>s <code>Symbol::Approx::Sub</code>.  When Perl is asked to
run a subroutine that it cannot locate, it will invoke <code>AUTOLOAD</code> in
the package where it was first told to look for the subroutine.  This
is handed the same arguments as the original function call and is told
which subroutine Perl was looking for in the global <code>$AUTOLOAD</code>
variable.  <code>AUTOLOAD</code> is mainly used to write lazy accessors for
object data, this example:</p>
<pre>
 sub AUTOLOAD {
    my ($self, $value) = @_;
    my ($field) = $AUTOLOAD =~ /.*::(.*)$/;
    return if $field eq 'DESTROY';
    return @_==1 ? $self-&gt;{$field} : $self-&gt;{$field} = $value;
 }</pre>
<p>provides simple get/set methods.  So that:</p>
<pre>
 $object-&gt;name('Harry');
 print $object-&gt;name, &quot;\n&quot;;</pre>
<p>prints <code>Harry</code> even though you haven't had to explicitly write a
<code>name</code> method for your object.</p>
<p>Perl stores all information about non-lexical variables, filehandles
and subroutine names in a massive hash.  You can inspect this yourself
but doing so requires code that is so close to spaghetti you could
plate it up and serve it to an Italian.  The easy way out, wisely
taken by the <code>Symbol::Approx::Sub</code> module, is to use the
<code>Devel::Symdump</code> module that provides a friendly and clean interface
to Perl's symbol table.  <code>Devel::Symdump</code> provides various useful
tools: If you are scratching your head trying to resolve an
inheritance tree, then the <code>isa_tree</code> method will help; if you want to find
exactly what a module exports into your namespace, then you'll find the
<code>diff</code> method a constant friend.</p>

<h3><a name="presently living in the past">Presently Living in the Past</a></h3>
<p>Ever since the ancients erected the huge lumps of stone that paved the
way for the digital watches that we hold so dear, mankind has needed
to know when he is.  Perl is no different and now has many -- although
some might say too many -- date- and time-related modules, around
80 of them in fact.  Simple statistics tell us that at least a few
of those should be so useless we couldn't possibly resist trying to
find something to do with them.</p>
<p><code>Date::Discordian</code>, although lacking in chicken references.  Gobble.</p>
<p>This could, in a limited set of circumstances, be helpful though.
Imagine the scene: a trusted client is on the phone demanding a
completion date for the project doomed to persist.  You reach for the
keyboard and, in a moment of divine inspiration, type:</p>
<pre>
 perl -MDate::Discordian -le'print discordian(time+rand(3e7))'</pre>
<p>You then soberly relate the result to your tormentor, ``Prickle
Prickle, Discord 16 YOLD 3168'' and, suddenly, everything is alright.
Well, they've put the phone down and left you in peace.  If you
prefer to provide a useful service, then you might be better off
investigating the <code>Time::Human</code> module by Simon Cozens.  This creates
person-friendly descriptions of a time, transforming the excessively
precise 00:23:12.00 into a positively laid-back ``coming up to
25 past midnight.''  The module is internationalized and could
be used in conjunction with a text-to-speech system, such as festival,
to build an aural interface to something like a ticket-booking system.</p>
<p>Moving swiftly on, we come to Date::Tolkien::Shire, a king amongst
date modules.  Most newspapers carry an ``on this day in history''
column -- where you find, for instance, that you were born on the same
day as the man who invented chili-paste -- but no broadsheet will
tell you what happened to Frodo and his valiant companions as they
fought to free Middle Earth from the scourge of the Dark Lord.  The
undeceptively simple:</p>
<pre>
 use Date::Tolkien::Shire;
 print Date::Tolkien::Shire-&gt;new(time)-&gt;on_date, &quot;\n&quot;;</pre>
<p>outputs (well, output a few days ago):</p>
<pre>
 Highday Winterfilth 30 7465
 The four Hobbits arrive at the Brandywine Bridge in the dark, 1419.</pre>
<p>What better task could there be for crontab but to run this in the wee
hours and update <code>/etc/motd</code> for our later enjoyment.  Implementing
this is, as ever, left as an exercise for the interested reader.</p>
<p>There is a more useful side to <code>Date::Tolkien::Shire</code> or, at the very
least, it does light the way for other modules.  As well as the
<code>on_date()</code> method it provides an overloaded interface to the dates it
returns.  This allows you to compare dates and times as if they were
normal numbers, so that:</p>
<pre>
 $date1 = Date::Tolkien::Shire-&gt;new(time);
 $date2 = Date::tolkien::Shire-&gt;new(time - 1e6);
</pre>
<pre>

 print 'time is '.( $date1 &gt; $date2  ? 'later':'earlier' ).
     &quot;than time -1e6\n&quot;;</pre>
<p>prints <code>time is later than time -1e6</code>, the more prosaic
<code>Date::Simple</code> module provides a similar interface for real dates and
ensures they stringify with ISO formatting.</p>














<h3><a name="from one date to another">From One Date to Another</a></h3>
<p>It is often said that computers and relationships don't mix well but
this isn't entirely true.  If you feel alone in the world and need to
find that special person, then Perl is there to help you.  Your first task
is to meet someone.  Perhaps by putting an advertisement on a dating service.
Of course, you want to find the very best match and, being fond of
concise notation, decide you will search for your companion with the
help of the geek code.  But how is your prospective mate to know what
all those funny sigils mean?  With the help of the <code>Convert::GeekCode</code>
module of course:</p>
<pre>
 use Convert::GeekCode;
</pre>
<pre>

 print join(&quot;\n&quot;,geek_decode(&lt;&lt;'ENDCODE'),&quot;\n&quot;);
 -----BEGIN GEEK CODE BLOCK-----
 GS d+ s:- a--a? C++&gt; UB++ P++++ !L E+ W+++ N++ K? w--() !M PS++ PE+
 Y PGP+ t+(-) 5++ !X R+ !tv b+++  DI++ D+++ G e* h y?
 ------END GEEK CODE BLOCK------
 ENDCODE</pre>
<p>Will tell you, amongst other things, that ``<em>I don't write Perl, I
speak it.  Perl has superseded all other programming languages.  I
firmly believe that all programs can be reduced to a Perl one-liner.</em>''</p>
<p>So, you've got a reply and someone wants to meet you.  This is a
worrying prospect though as you feel you'll need to brush up on your
conversation skills a little before meeting your date.  Again, Perl
comes to your aid with Chatbot::Eliza, which is especially useful if you want
to meet a simple-minded psychologist.  Fire her up with:</p>
<pre>
 perl -MChatbot::Eliza -e'Chatbot::Eliza-&gt;new-&gt;command_interface'</pre>
<p>and enjoy hours of elegant conversation:</p>
<pre>
 you:    I like pie
 Eliza:  That's quite interesting.</pre>
<p>If your wit and repartee fail to impress, then you may want to convince
your partner that you have a deep and lasting interest in some obscure
branch of mystical poetry.  Doing this requires some mastery of ZenPAN
combined with a careful study of Lee Goddard's <code>Poetry::Aum</code>.  More
than any other module, this teaches you that true understanding comes
from within: by inspecting the source of all your powers.  The source
code, that is.</p>
<p>If none of this works or you find you've arranged a date with a total
bore, don't despair.  There are ways to move the encounter toward an
interesting conclusion.  Simply let Michael Schwern's <code>Bone::Easy</code> take
the pain out of dumping your burden.</p>
<pre>
 perl -MBone::Easy -le'print pickup()'
</pre>
<pre>

 When are you going to drain that?</pre>
<p>How could all this be useful though?  <code>Convert::GeekCode</code> hints at
Perl's greatest strength: data transformation.  The remaining 20
or so <code>Convert::*</code> modules can sometimes be a Godsend.  If you are
having trouble with EBCDIC-encoded text or need to make your product
catalog acceptable to people who need whichever of metric and
Imperial units you haven't provided, then you'll find something to furnish
the answer.</p>
<p><code>Chatbot::Eliza</code> on the other hand is a shining example of code whose
behavior you can change easily.  Because it was written using Perl's
OO features and a bit of thought was applied while deconstructing the
problem it addresses, it is full of hooks from which you can dangle
your own bits of code, perhaps to use a different interface or a text
to speech system.  Can <code>Bone::Easy</code> teach you anything?  Who knows ...</p>

<h3><a name="a day at the races">A Day at the Races</a></h3>
<p>Having foolishly followed my dating advice above you will have a great
deal of time to yourself but do not fear, you can still keep yourself
amused.  If you have a sporting bent, then Jos Boumans's <code>ACME::Poe::Knee</code>
uses the wonderful <code>POE</code> framework to race ponies across your screen;
you could even make bets with yourself sure in the knowledge that
you'll end the day even.  One day <code>POE</code> may fulfill its original
purpose and morph into a multi-user dungeon (MUD), although at the
moment, alas, it is far too busy being useful.</p>
<p>If you get tired of watching <code>ACME::Poe::Knee</code>, then you can instead follow
Sean M Burke's <code>Games::Worms</code>, in combination with the cross-platform
Tk Perl bindings, as it draws pretty patterns on your screen.  Tk is
only one of many graphical toolkits for Perl that can be used to
quickly prototype an interface design or glue together a range of
command line applications with a common frontend.</p>

<h3><a name="when bugs attack">When Bugs Attack</a></h3>
<p>Every now and then, despite all your best efforts to program extremely
and extract the maximum of laziness from Perl, you will come across a
deeply buried, complicated and fatal bug in your code.  Your spirits
sink when you discover one, the next two days of your precious time
will be filled with cryptic error messages flashing all over your
terminal:</p>
<pre>
 Something is very wrong at Desiato.pl line 22.</pre>
<p>It needn't be like this though - there is a better way.  You'll still
have to fight this bug for days but you can keep your blood pressure
at bay with a little application of Damian Conway's <code>Coy</code>.  Simply
add:</p>
<pre>
 PERL5OPT=-MCoy</pre>
<p>to your environment (ideally somewhere global like <code>/etc/.cshrc</code>) so
that any time Perl explodes all over your hard disk you'll be greeted
by a soothing Haiku to take the edge off your pain:</p>
<pre>
        -----
        A woodpecker nesting 
        in a lemon tree. Ten 
        trout swim in a stream.
        -----</pre>
<pre>
                Tor Kin Tun's commentary...
</pre>
<pre>

                Something is very wrong</pre>
<pre>
                        (Analects of Desiato.pl: line 22.)</pre>
<p>Setting <code>PERL5OPT</code> can help you in normal circumstances.  Should you
be developing an existing library you will often want to switch from
the new to the old version, saying <code>export PERL5OPT=-Ipath/to/new</code> is
less hassle than fiddling with <code>use lib 'path/to/new'</code> within your
code.</p>
<p>These, along with a much larger host of useful modules, are available
from the CPAN.</p>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1616" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/10/23/damians.html" rel="bookmark">Perl 6 : Not Just For Damians</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Piers Cawley</span> on <abbr class="published" title="2001-10-23T00:00:00-08:00">October 23, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<p>London.pm technical meetings are always inspiring events with top
notch speakers. At our most recent gathering Richard Clamp and Mark
Fowler gave us "Wax::On, Wax::Off -- how to become a Perl sensei";
Paul Mison showed us how to make an infobot read the BBC news; Richard
Clamp and Michael Stevens explained "Pod::Coverage", their
contribution to Kwalitee assurance; and, for the first time ever, Leon
Brocard didn't talk about Graphing Perl.</p>
<p>However, the highlight of the evening was Simon Cozens's first public
demonstration of Parrot, the new virtual computer that will one
day run Perl 6.</p>
<p>After he'd finished the talk we expected, he pulled a crumpled piece
of paper from a secret pocket. This, he whispered, was an early draft
of Apocalypse 3 which he'd smuggled out at great personal risk from
under the very noses of the Design Team. An expectant hush fell as he
proceeded to reveal the highlights.</p>

<p>The reception his heroic effort received was... low key. Everyone
was pleased to get an early peek at what Larry was thinking, but there
were widespread mutterings about "all this needless complexity" and
"mere syntactic sugar". Almost everyone grumbled about the use of '<code>.</code>'
for dereferencing. Almost everyone groused about using '<code>_</code>' for
concatenation. And the reassurance that "It's only syntax" didn't seem
to appease the doubters.</p>
<p>And then we all went for beer and/or Chinese food.</p>
<p>Fast forward to last weekend. The Apocalypse was <a href="/pub/a/2001/10/02/apocalypse3.html">up on the website</a> and
Damian had just published his Exegesis when Simon Wistow (London.pm's
official scapegoat) warned the mailing list that he had:</p>
<blockquote><p>
   ... an impending sense of doom about Perl 6. The latest
   Apocalypse/Exegesis fill me with fear rather than wonder. I've got
   a horrible feeling that Perl 6 is trying to do too much at
   once.</p></blockquote>
<p>This provoked a firestorm of agreement. The general consensus was that
the latest Apocalypse was:</p>
<blockquote><p>
    reinventing wheels which we already have in abundance. And those
    new wheels have syntax that is only going to confuse those who are
    already experienced perl5 users</p></blockquote>
<p>It seems that what we have here is a failure to communicate.</p>
<p>Yes, Damian's efforts have been superb in providing examples of code
based on the Apocalypses, and I don't think anyone denies the sterling
work that Dan and his team are doing with Parrot. But people do seem
to be worried about Perl 6 being a rewrite for the Damians of this
world, not for the ordinary Joe.</p>
<p>Well, I'm here to tell you that this ordinary Piers doesn't have a
problem with Perl 6. In fact I'm excited and inspired by most of the
work that's been done so far, and I hope to convince you too.</p>
<h3><a name="perl6 doesn't look like perl">"Perl 6 doesn't look like Perl"</a></h3>
<p>Well, up to a point. The thing that you have to remember when reading
the sample code that Damian provides in his Exegeses is that he is
deliberately exercising all the new features in a condensed example.
The most recent code sample is initially scary because there's so
<em>much</em> stuff in Apocalypse 3. Admittedly, <code>$self.method()</code> looks
weird now, but then, <code>$self-&gt;method()</code> looked weird when Perl 5 was
introduced. And, on rereading Damian's example with an eye to what
<em>hasn't</em> changed, the whole thing still looks like Perl.</p>
<h3><a name="perl 6 just gives us syntax for stuff we can already do">"Perl 6 just gives us syntax for stuff we can already do"</a></h3>
<p>That's a mighty big 'just' there, partner. Consider the currying
syntax. Before this came along, currying was possible, but required an
unreasonable amount of manual work to implement. Just consider the
following, 'simple' example:</p>
<p>In perl 6 we have:</p>
<pre>
    $^_ + $^_</pre>
<p>In perl 5, if you didn't worry about currying you'd write:</p>
<pre>
    sub { $_[0] + $_[1] }</pre>
<p>If you <em>do</em> worry about currying, you'll have to write:</p>
<pre>
    do { 
        my $self;
        $self = sub {
            my ($arg1, $arg2) = @_;
            return $arg1 + $arg2             if @_==2;
            return sub { $self-&gt;($arg1,@_) } if @_==1;
            return $self;
        }
    }</pre>
<p>And I don't want to <em>think</em> about the hoops I'd have to jump through
in the case of a curried function with three arguments, or if I wanted
named arguments. Now, you could very well argue that you don't use
anonymous functions much anyway, so you're certainly not going to be
doing tricks with currying, and you may be right. But then, of course,
if you don't want to use them <em>you don't have to</em>.</p>
<p>However, I'm betting that before long it will be just another spanner
in your toolbox along with all the other gadgets and goodies that
Larry's shown us so far. Tools that you use without a second thought.</p>
<p>If you've ever done any academic computer science, you might have come
across Functional Programming, in which case an awful lot of what's
new in Perl 6 so far will be looking surprisingly familiar. The thing
is, until now, Functional Programming has been seen as only of concern
to academics and the kind of weirdoes who are daft enough to write
Emacs extensions and, dammit, Perl doesn't need it. There is even
<a href="http://dev.perl.org/rfc/28.html">an RFC</a> to this effect.</p>
<p>I remember saying almost exactly the same thing about another language
feature of 'purely academic interest' that got introduced with perl 5;
the closure.</p>
<p>I don't know about you, but closures are old friends now; another tool
that gets pulled out and used where appropriate, with hardly a second
thought.</p>
<h3><a name="perl 6 doesn't give us anything that perl 5 doesn't.">"Perl 6 doesn't give us anything that Perl 5 doesn't."</a></h3>
<p>Yeah, and Perl 5 doesn't give us anything that a Universal Turing
Machine, Intercal, or Python don't. We use it because it 'fits our
brains'. The Perl 6 redesign is all about improving that fit.</p>









<h3><a name="apocalypse 3 is mostly mere syntactic sugar">"<a href="/pub/a/2001/10/02/apocalypse3.html">Apocalypse 3</a> is mostly mere syntactic sugar"</a></h3>
<p>You say that like it's a <em>bad</em> thing. Perl's creed has always been to
make the easy things easy and the hard things possible. In many ways,
Perl 6 is going further than that: making hard things easy. And
Apocalypse 3 continues this trend.</p>
<p>Well chosen syntactic sugar is good voodoo. It's Laziness with a
capital L, and Laziness, as we all know, is a virtue.</p>
<p>Let's look at what we get in Apocalypse 3.</p>
<h4>
<a name="item_The_hyper_operator%2E">The hyper operator.</a></h4>
<p>
Well, this is just a <code>foreach</code> loop isn't it? Yes, but as Damian
subsequently pointed out, would you rather write and maintain:
<pre>
    my @relative;
    my $end = @max &gt; @min ? @max &gt; @mean ? $#max : $#mean
                          : @min &gt; @mean ? $#min : $#mean;
    foreach my $i ( 0 .. $end ) {
        $relative[$i] = $mean[$i]) / ($max[$i] - $min[$i]);
    }</pre>
<p>or</p>
<pre>
    my @relative = @mean ^/ (@max ^- @min);</pre>
<p>In the second case, the intent of the code is clear. In the first it's
obfuscated by the loop structure and set up code.</p>
<h4><a name="item_Chainable_file_test_ops">Chainable file test ops</a></h4>
<p>
Why hasn't it <em>always</em> worked like this? Ah yes, because the
internals of perl 5 wouldn't allow for it. This is an example of the
far reaching effects of some of the earlier Apocalypses giving us cool
stuff.
<p>Let's do the comparison again.</p>
<p>Perl 5:</p>
<pre>
    my @writable_files = grep {-f $_ &amp;&amp; -r _ &amp;&amp; -w _ &amp;&amp; -x _} @files;</pre>
<p>Perl 6:</p>
<pre>
    my @writable_files = grep { -r -w -x -f $_ } @files;</pre>
<p>Shorter and clearer. Huzzah.</p>
<h4><a name="item_Binary_%27%3B%27">Binary ';'</a></h4>
<p>
This one's a bit odd. We've not yet seen half of what's going to be
done with it, but I have the feeling that the multidimensional array
mongers are going to have a field day.
</p>
<h4><a name="item_%3D%3E_is_a_pair_builder">=&gt; is a pair builder</a></h4>
<p>Mmmm... pairs. Lisp flashbacks! Well, yes. But if hashes are to become
'bags' of pairs, then it seems that hash keys won't be restricted to
being simple strings. Which is brilliant. On more than several
occasions I've found myself wanting to do something along the
lines of
<pre>
    $hash{$object}++;</pre>
<p>and then later do</p>
<pre>
    @results = map  { $_.some_method }
               grep { $hash{$_} &gt; 1 }
                   keys %hash;</pre>
<p>Try doing that in Perl 5.</p>
<p>The use of pairs for named arguments to subroutines looks neat too,
and should avoid the tedious hash setup that goes at the top of any
subroutine that's going to accept named parameters in Perl 5.</p>
<h4><a name="item_Lazy_lists">Lazy lists</a></h4>
<p>
Lazy lists are cool, though I note that Damian couldn't squeeze a
compelling example of their usage in Exegesis 3. For some applications
they are a better mousetrap, and if you don't actually need them
they're not going to get in your way. I'm not sure if Larry has
confirmed it yet, but I do like the idea of being able to do:
<pre>
    my($first,$second,$third) = grep is_prime($_), 2 .. Inf;</pre>
<p>and have things stop when the first three primes have been found.</p>
<p>And having</p>
<pre>
    my($has_matches) = grep /.../ @big_long_list;</pre>
<p>stop at the first match would be even better.</p>
<h4><a name="item_Logical_operators_propagating_context">Logical operators propagating context</a></h4>
<p>
Where's the downside? This can only be a good thing. Multiway
comparison <code>0 &lt; $var &lt;= 10</code> is another example of unalloyed
goodness.
<p></p>
<h4><a name="item_Backtracking_operators">Backtracking operators</a></h4>
<p>
I'm not entirely sure I understand this yet. But it looks like it has
the potential to be a remarkably powerful way of programming (just
like regular expressions are, which do <em>loads</em> of backtracking). I
have the feeling that parser writers are going to love this, and
equation solvers, and...
<p>But again, if you don't need the functionality, don't use it. It'll
stay out of your way.</p>









<h4><a name="item_All_operators_get_%27proper%27_function_names%2E">All operators get 'proper' function names.</a></h4>
<p>
This one almost had me punching the air. It's brilliant. Especially
if, like me, you're the kind of person who goes slinging function
references around. (One of the things that I really like about Ruby is
its heady mix of functional style higher order functions and hard core
object orientation. It looks like Perl's getting this too.)
<p>Again, time to make with the examples. Consider the following perl
code from an Assertion package (this is in Perl 6, it's too hard to
write clearly in Perl 5).</p>
<pre>
    &amp;assert_with_comparator := {
        unless ($^comparator.($^a, $^b)) {
            throw Exception::FailedComparison :
                comparator =&gt; $^comparator,
                result     =&gt; $^a,
                target     =&gt; $^b
        }
    }</pre>
<pre>
    &amp;assert_string_equals := assert_with_comparator(&amp;operator:eq);
    &amp;assert_num_equals    := assert_with_comparator(&amp;operator:==);
    &amp;assert_greater_than  := assert_with_comparator(&amp;operator:&gt;);</pre>
<p>That's full strength Perl 6 that is, complete with currying, operators
as functions, <a href="#item_%3A%3D"><code>:=</code></a> binding, <code>:</code> used to disambiguate indirect object
syntax, the whole nine yards. And it is still obviously a Perl
program. The intent of the code is clear, even without comments, and
it took very little time to write. Of course, I am assuming an
Exception class, but we've already got that in Perl 5; take a look at
the lovely <code>Error.pm</code>.</p>
<p>I'm not going to rewrite <code>assert_with_comparator</code>, but just look at
the Perl 5 version of the last line of that example:</p>
<pre>
    *Assert::assert_greater_than =
        $assert_with_comparator-&gt;(sub { $_[0] &gt; $_[1] });</pre>
<p>Don't try and tell me that the intent is clearer in Perl 5 than in
Perl 6, because I'll be forced to laugh at you.</p>
<p></p>
<h4><a name="item_binary_and_unary_%27%2E%27">binary and unary '.'</a></h4>
<p>
I confess that I'm still not sure I see where binary '<code>.</code>' is a win over
'<code>-&gt;</code>', especially given that Larry has mandated that most of the time
you won't even need it.
<p>Unary '<code>.</code>' is looking really cool. If I read the Apocalypse right, this
means that, instead of writing object methods like:</p>
<pre>
    sub method {
        my $self = shift;
        ...
        $self-&gt;{attribute} = $self-&gt;other_method(...);
        ...
    }</pre>
<p>We can write:</p>
<pre>
    sub method {
        ...
        $.attribute = .other_method(...);
        ...
    }</pre>
<p>Which is, once more clean, clear and perl like. This is the kind of
notation I want Right Now. And, frankly, it'd just look silly if you
replaced those '.'s with '<code>-&gt;</code>' (and should one parse
<code>$-&gt;attribute</code> as an instance variable accessor, or as <code>$- &gt;
attribute</code>). Okay, I'm convinced. Replace '<code>-&gt;</code>' with '<code>.</code>' already.</p>
<p></p>
<h4><a name="item_Explicit_stringification_and_numification_operator">Explicit stringification and numification operators</a></h4>
<p>
Again, these have got to be good magic, especially with the <code>NaN</code> stuff
(though that's been the cause of some serious debate on perl6-language
and may not be the eventual name). In at least one of the modules I'm
involved in writing and maintaining, this would have been <em>so</em> useful:
<pre>
    # geq: Generic equals
    sub operator:geq is prec(\&amp;operator:eq($$)) ($expected, $got)
    {
        # Use numericness of $expected to determine which test to use
        if ( +$expected eq 'NaN') { return $expected eq $got }
        else                      { return $expected == $got }
    }</pre>
<pre>
    sub assert_equals ($expected, $got; $comment)
    {
        $comment //= &quot;Expected $expected, got $got&quot;;
        $expected geq $got or die $comment;
    }</pre>
<p>Hey! That looks just like Perl! (Except that, to do the same thing in
Perl 5, you have to jump through some splendidly non-obvious hoops.
Trust me, I've done that.)</p>
<p></p>
<h4><a name="item_%3A%3D">:=</a></h4>
<p>
This one had me scratching my head as I read the Apocalypse. On
reading the Exegesis, things become a good deal clearer. <a href="#item_%3A%3D"><code>:=</code></a> looks like
it's going to be an easy way to export symbols from a module, now that
typeglobs have gone away:
<pre>
    package Foo;
    sub import ($class, @args) {
        # This is an example, ignore the args
        &amp;{&quot;${class}::foo&quot;} := &amp;Foo::foo;
    }</pre>
<p>Of course, this isn't the only place where <a href="#item_%3A%3D"><code>:=</code></a> will be used. Thankfully
we'll be able to use it almost everywhere without having to remember
all the caveats that used to surround assigning to typeglobs. Here's
another example in Perl 6 of something that would be impossible in
Perl 5:</p>
<pre>
    $Sunnydale{ScoobyGang}{Willow}{Traits} = [qw/cute geeky/];</pre>
<pre>
    # Oooh Seasons 4 and 5 happened and I want
    # to use a trait object now</pre>
<pre>
    $traits := $Sunnydale{ScoobyGang}{Willow}{Traits};
    $traits = new TraitCollection: qw/sexy witch lesbian geek/;</pre>
<p>Nothing special there you say. Well, yes, but let's take a look at</p>
<pre>
    print $Sunnydale{ScoobyGang}{Willow}{Traits}
    # sexy witch lesbian geek
    # Or however a TraitCollection stringifies.</pre>
<p>You can <em>almost</em> do this in Perl 5, but only if you continue to use
an array:</p>
<pre>
    local *traits = $Sunnydale{ScoobyGang}{Willow}{Traits};
    @traits = qw/sexy witch lesbian geek/;</pre>
<p>If you want to switch to using a <code>TraitCollection</code>, you'll have to go
back and use the full specifier.</p>
<p>I think this is another of those bits of syntax that I'd like now,
please.</p>
<p></p>
<h4><a name="item_Binary_%3A">Binary :</a></h4>
<p>
This is going to make life so much easier for the parser if nothing
else. Right now, indirect object syntax can be very useful. However,
if you've ever tried to use it in anger, well, you've ended up using
it in anger because there are some subtle gotchas that will catch you
out. Binary : lets us disambiguate many of these cases and helps to
reclaim indirect object syntax as a useful way of working.
</p>
<p>And so on... What's not to like? The sugar is sweet, the consistency
is just right, and the old annoyances are going away.</p>









<h3><a name="perl 6 inspires fear.">"Perl 6 inspires fear."</a></h3>
<p>Well, maybe. But it also just flat out inspires. If you don't believe
me, take a look at the response to Perl 6 on CPAN. Damian's
<code>Attribute::Handlers</code> successfully attempts to graft some of Perl 6's
ease of manipulation of attributes back into Perl 5, and does a
remarkably good job of it. Just look at all the really cool new
modules that have sprung up around it. And that's just a small part of
what we're going to get with Perl 6.</p>
<p>There are many new modules that exist only to 'mutate' perl5 behaviour
-- <code>NEXT</code>, <code>Hook::LexWrap</code>, <code>Aspect</code>, <code>Switch</code>, <code>Coro</code> etc. I would argue that
many of these have arisen in response to discussions about making Perl
6 a far more mutable language than Perl 5. And, if nothing else, these
modules have gone some way to demonstrating that even now, Perl is
more flexible than we ever realised.</p>
<h3><a name="perl 6 is taking too long">Perl 6 is taking too long</a></h3>
<p>I'm not quoting anyone else here; that's me complaining. I want it all
and I want it now! But I also want a well thought out and coherent
design. The choice between doing it Right and doing it Now is not a
choice. Doing it Right is imperative.</p>
<p>The changes that Larry is making to the language will have far
reaching and probably unforeseen consequences. But that's no reason
for shying away from them. I've been programming in Perl for long
enough to remember the transition from Perl 4 to Perl 5, and I
remember delaying my own move to perl 5 for an embarrassingly long
time. I didn't understand the new stuff in 5 and I hadn't a clue why
anyone would want it, so I put off the move.</p>
<p>Eventually, I held my nose and jumped in. References were so cool. The
new, 'real', data structures meant an end to contortions like:</p>
<pre>
    $hash{key} = join &quot;\0&quot;, @list;</pre>
<pre>
    # and later...</pre>
<pre>
    @list = split /\0/, $hash{key};</pre>
<p>Within a remarkably short space of time almost everything that had
confused and scared me became almost second nature. Stuff that had
been a complete pain in Perl 4 was a breeze Perl 5 (who remembers
Oraperl now?) It seemed that all you had to remember was to change
<code>&quot;pdcawley@bofh.org.uk&quot;</code> to <code>&quot;pdcawley\@bofh.org.uk&quot;</code>.</p>

<p>The same thing is going to happen with Perl 6. Even if it doesn't, all
those perl 5 binaries aren't going to disappear from the face of the
earth.</p>
<p>What I'm most looking forward to are the gains we're going to see from
Perl becoming easier to parse. Over in the Smalltalk world they have
this almost magical thing called the 'Refactoring Browser' which is a
very smart tool for messing with your source code. Imagine being able
highlight a section of your code, then telling the browser to 'extract
method'.</p>
<p>The browser then goes away, works out what parameters the new method
will need, creates a brand new method which does the same thing as the
selected code and replaces the selected section with a method call.</p>
<p>This is Deep Magic. Right now it's an almost impossible trick to pull
off in Perl, because the only thing that knows how to parse Perl is
perl. It is my fond hope that, once we get Perl 6, it's going to be
possible to implement a Perl refactoring browser, and my work with
ugly old code bases will become far, far easier.</p>
<p>But even if that particular magic wand never appears, Perl 6 is still
going to give us new and powerful ways to do things, some of which
we'd never even have tried to do before. Internally it's going to be
fast and clean, and we're going to get real Garbage Collection at
last. If Parrot fulfils its early promise, we may well see Perl users
taking advantages of extensions written in Ruby, or Python, or
Smalltalk. World peace will ensue! The lion will lay down with the
lamb, and the camel shall abide with the serpent! Cats and dogs living
together! Ahem.</p>
<table width="150" border="0" cellspacing="0" cellpadding="4" align="right">
<tr> 
<td width="150" valign="top" height="4" bgcolor="#6699cc"></td></tr> 
<tr>
<td bgcolor="#efefef">
<p class="headline" align="center">Related Articles
</p>
<p class="smalltext">
&#149; <a href="/pub/a/2001/10/02/apocalypse3.html">Apocalypse 3</a><br /><br />
&#149; <a href="/pub/a/2001/10/03/exegesis3.html">Exegesis 3</a>
</td></tr> <tr><td width="150" valign="top" height="4" bgcolor="#6699cc"> </td></tr></table>
<p>It's been a long strange trip from perl 1.0 to where we are today.
Decisions have been taken that made sense at the time, which today see
us lost in a twisty little maze of backward compatibility (or should
that be a little twisty maze...). Anyone who looks at the source code
for Perl 5 will tell you it's scary, overly complex, and a complete
nightmare to maintain. And that's if they understand it.</p>
<p>Perl 6 is our chance to learn from Perl 5, but Perl 6 is also going to
be Perl remade. If everything goes to plan (and I see no reason why it
won't) we will arrive at Perl 6 with the crud jettisoned and the good
stuff improved. We'll be driven by a gleaming, modern engine
unfettered by the limitations of the old one. We'll have a shiny new
syntax that builds on the best traditions of the old to give us
something that is both brand new and comfortingly familiar.</p>
<p>And there, in the Captain's chair, you'll still find Larry, smiling
his quiet smile, comfortable in the knowledge that, even if he doesn't
know exactly where we're going, it'll be a lot of fun finding out.
Over there, at the science officer's station, Damian is doing strange
things with source filters, haikus and Quantum. A calm voice comes up
from engineering; it's Dan, telling us that the new engines <em>can</em>
take it. And at the helm Nat Torkington gently steers Perl 6 on her
continuing mission towards new code and new implementations.</p>
<p>And Ensign Cawley? Well... there's a strange alien device called a
refactoring browser. I'm going to be replicating one for Perl.</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1622" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/10/p5pdigest/20011021.html" rel="bookmark">This Week on p5p 2001/10/21</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Abhijit Menon-Sen</span> on <abbr class="published" title="2001-10-21T00:00:00-08:00">October 21, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<h3><a name="This_fortnight_on_perl5_porters_08_21_October_2001" id="This_fortnight_on_perl5_porters_08_21_October_2001">This fortnight on perl5-porters (08-21 October 2001)</a></h3>

<h3><a name="Notes" id="Notes">Notes</a></h3>


<table width="150" border="0" cellspacing="0" cellpadding="4" align="right">
<tr> 
<td width="150" valign="top" height="4" bgcolor="#6699cc"></td></tr> 
<tr>
<td bgcolor="#efefef">
<p class="headline" align="center">This Week on P5P
</p>
<p class="smalltext">
&#149; <a href="#580_TODO">5.8.0 TODO</a><br /><br />
&#149; <a href="#POD">POD</a><br /><br />
&#149; <a href="#Testing">Testing</a><br /><br />
&#149; <a href="#TAINT">${^TAINT}</a><br /><br />
&#149; <a href="#AUTOLOAD_and_packages">AUTOLOAD and packages</a><br /><br />
&#149; <a href="#BParrot">B::Parrot</a><br /><br />
&#149; <a href="#Miscellaneous">Miscellaneous</a>
</p>
</td></tr> <tr><td width="150" valign="top" height="4" bgcolor="#6699cc"> </td></tr></table>

<p>Please send corrections and additions to perl-thisweek-YYYYMM@simon-cozens.org 
  where YYYYMM is the current year and month. Changes and additions to the perl5-porters 
  biographies are particularly welcome. </p>
<h3><a name="580_TODO" id="580_TODO">5.8.0 TODO</a></h3>

<p> Jarkko posted a <a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00391.html">list 
  of things to do</a> before the 5.8.0 release (later, he posted another, <a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00971.html">shorter 
  TODO list</a>.) The main remaining issues are: </p>
<ul>
  <li><pre>PerlIO, Threading, and Multiplicity</pre></li>
  <li><pre>Attributes are Broken</pre></li>
  <li><pre>Basic Unicode Support</pre></li>
  <li><pre>FAQ Updates</pre></li>
</ul>

<p>
Nick Ing-Simmons, who was unable to work on Perl for a while because of
intellectual property restrictions at his new job, is back, and working
very hard on
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00887.html">fixing the PerlIO issues</a>. Arthur Bergman has quietly but steadily been making
<code>threads::shared</code> work well enough to be shipped with 5.8.0. Damian has suitably evil
plans for attributes, which Arthur and I plan to assimilate into the
core.
</p>

<p>
Jarkko, apparently working all alone, has made considerable progress
towards making Perl comply with &quot;Level 1 - Basic Unicode Support&quot;, as
defined by the Unicode standard,
<a href="http://www.unicode.org/unicode/reports/tr18/">TR#18 "Unicode Regular Expression Guidelines"</a>. Some features remain unimplemented, though, including character class
subtraction and end-of-line matching.
</p>

<p>
The Perl FAQ needs extensive updates, to remove obsolete material and
add new material where appropriate.
</p>

<p> Any volunteers? </p>
<h3><a name="POD" id="POD">POD</a></h3>

<p> In August, as he embarked on a rewrite of the POD documentation, Sean M. Burke 
  said: </p>
<blockquote>

  <p> A markup language without a clear specification simply invites everyone, including 
    implementors, to have their own shaky idea of what the language means. And 
    that, along with the general tendency for markup language parsing to produce 
    write-only code, explains much of the upsetting current state of Pod::* modules. 
  </p>
</blockquote>

<p>

After several revisions, Sean has now released the final draft of his
changes, which include a complete rewrite of the
<code>perlpod</code> manpage (a POD reference suitable for module authors), and the new
<code>perlpodspec</code> manpage (a more formal POD specification). The documents attempt to
formalise best current practice in parsing and rendering POD, without
introducing any radically new features. They were greeted with sighs of
relief, and have been incorporated into perl-current.
</p>

<p>
This is an excellent step towards alleviating the upsetting state of the
<code>Pod::*</code> modules, but there is still a lot of work to be done. Patches towards
making the core documentation comply with the new specification are
particularly welcome.
</p>

<p>
Brad Appleton (the author of
<code>Pod::Parser</code> and
<code>Pod::Checker</code>) may not be able to hack on his POD modules for a while, and welcomes
help. I am sure many of the other module authors could use a hand with
testing and updating their modules in light of
<code>perlpodspec</code>.
</p>

<p> If you want to help, or are interested in seeing what's going on, Sean recommends 
  that you join the <a href="http://lists.perl.org/showlist.cgi?name=pod-people">pod-people</a> 
  mailing list. </p>
<h3><a name="Testing" id="Testing">Testing</a></h3>

<p> Perl has been doing better and better in tests, and H. Merijn Brand sums up 
  the situation nicely: </p>
<blockquote>
<pre>
    **Lot's* of 'O's :))
</pre></blockquote>

<p>
We got a full set of 'O's (OK) for various AIX and HP-UX systems with
their native compilers (and later, with gcc 3 under HP-UX). Hal Morris
reports that perl passes all tests under Linux/390, while a few failures
remain under UTS and VMS.
</p>

<p> More test reports from weird platforms are most welcome. </p>
<h3><a name="TAINT" id="TAINT">${^TAINT}</a></h3>

<p> When Perl is running in taint mode (because it was started with the <code>-T</code> 
  switch), a global variable (in the core) named <code>PL_tainting</code> is set 
  to 1 (it is usually 0). Michael G. Schwern posted <a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00316.html">a 
  patch to make this value accessible to Perl programs</a> as <code>${^TAINT}</code>. 
  Jarkko said: </p>
<blockquote></p>

  <p> &lt;troll&gt;Why ${^TAINT} is read-only? It would be *so* convenient to ...&lt;/troll&gt; 
  </p>
</blockquote>

<p>

Of course, my HTML-hating email program stripped the &lt;troll&gt; tags, so I
had to post
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00347.html">a patch to make ${^TAINT} writable</a> (thereby making
<code>local ${^TAINT} = 0</code> work as expected). The patch made Jarkko go temporarily blind (but not
blind enough to accidentally apply it).
</p>

<p>
The
<code>magic_get()/set()</code> functions in
<code>mg.c</code> retrieve and set the values of special variables like
<code>${^TAINT}</code> and
<code>$^S</code> (where &quot;specialness&quot; is defined by the
<code>is_gv_magical()</code> function in
<code>gv.c</code>). Both functions are big
<code>switch</code> statements which try to recognise the name of a variable, and then take
some appropriate action. Schwern's patch made
<code>magic_get()</code> assign the value of
<code>PL_tainting</code> to
<code>${^TAINT}</code> and make it read-only; mine removed the read-only markings, and taught
<code>magic_set()</code> to update PL_tainting when
<code>${TAINT}</code> is assigned to.
</p>

<p> It might be an interesting exercise to pick a special variable (say, <code>$^W</code>) 
  and figure out what Perl does to get or set its value. Rusty grep skills can 
  be further polished by figuring out when and where the get and set functions 
  are called. If you're still bored, figure out how the value of <code>PL_tainting</code> 
  is computed and used. </p>
<h3><a name="AUTOLOAD_and_packages" id="AUTOLOAD_and_packages">AUTOLOAD and packages</a></h3>

<p> Paul Johnson posted a message about <a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00811.html">some 
  weird AUTOLOAD behaviour</a>. What should the following code do? </p>
<blockquote></p>

<p>

    package P1;
</p>

</p><pre>
    *P2::AUTOLOAD = sub {
        print "|$::AUTOLOAD|$P1::AUTOLOAD|$P2::AUTOLOAD|\n";
    };
</pre>

</p><pre>
    P2->foo();
</pre></blockquote>

<p> Nobody was very sure, but perl-current behaves differently from 5.6.1, so 
  something must be broken. </p>
<h3><a name="BParrot" id="BParrot">B::Parrot</a></h3>

<p> Will somebody please write a <code>B::Parrot</code> module and post it to 
  P5P, so that I can write about it in the summary? (Rather than just make things 
  up, as certain unscrupulous individuals suggest I should do.) </p>
<h3><a name="Miscellaneous" id="Miscellaneous">Miscellaneous</a></h3>


<p>

Michael G. Schwern released
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00612.html">Test::Simple 0.32</a>. In the process, he introduced
<code>$ENV{PERL_CORE}</code>, to enable modules distributed both in the core and on the CPAN to use
the same tests everywhere, thereby simplifying life greatly.
</p>

<p>
Johan Vromans released
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00846.html">Getopt::Long 2.26_02</a>, a prerelease of version 2.27. Its guts have been redesigned to make
room for expansion; testers and bug reports are particularly welcome.
</p>

<p>
Russ Allbery released
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00839.html">podlators 1.11</a>, with several bug-fixes and some new features. (Russ still has a pile
of mail to dig through, and he hopes to release another version soon.)
</p>

<p>
Jarkko promptly assimilated all three, and found the time to release no
less than seven snapshots.
</p>

<p>
Kirrily Robert also submitted final drafts of some new documentation:
<code>perlintro</code> (a Perl introduction for beginners), and
<code>perlmodstyle</code> (a discussion of the current &quot;best practices&quot; in writing modules).
</p>

<p>
Gisle Aas made a brief appearance to post
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00805.html">an ExtUtils::MakeMaker patch</a> which causes
<code>$ENV{PERL_MM_USE_DEFAULT}</code>, when set, to instruct
<code>ExtUtils::MakeMaker::prompt</code> to return the default answer to every question without waiting for
input.
</p>

<p>
Randolph Werner ported perl to 64-bit Windows (!).
</p>

<p>
Perl 5.6.1 is now installed by default with HP-UX 11.00.
</p>

<p>
The
<a href="http://lists.perl.org/showlist.cgi?name=perl5-changes">perl5-changes</a> mailing list records each patch to Perl when it is committed into the
repository. It is highly recommended (Pumpking approved! 100% signal!)
for people who want to keep in touch with perl-current. (Speaking of
lists, a passing remark that P5P mail should have a
<a href="http://www.unicom.com/pw/reply-to-harmful.html">munged Reply-To</a> fortunately did not elicit any, er... strong opinions.)
</p>

<p>
Charles Lane fixed some niggling problems under VMS, and Craig A. Berry
found some new ones. VMSperl now builds with PerlIO as the default, and
it is possible to
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00601.html">configure it for 64-bitness</a> (although this causes a colourful test failure, evidently due to bugs in
the system's
<code>gcvt()</code> function, used to stringify numbers).
</p>

<p>
Mikhail Zabaluev patched
<code>perldoc</code> to use
<code>File::Temp</code> instead of creating temporary files in an ad-hoc fashion. Tim Jenness
tried to convince him that he should fix
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00959.html">various other things</a> in
<code>perldoc</code>, but Mikhail didn't fall for it. Does anyone else want to try? (One of
the changes, to use
<code>Pod::Man</code> rather than the
<code>pod2man</code> program, is similar to Schwern's
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00823.html">recent change to installhtml</a>.)
</p>

<p>
Perlbug posted an intriguing, but somewhat hard-to-decipher
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00315.html">overview of the bug database</a>, before dying again. Several &quot;Hello, is this thing on?&quot; messages and a
flood of pent-up bug reports later, it is reported to be working again.
</p>

<p>
Perl 5 had its seventh birthday on October 17th, 2001.
</p>

<hr />
<a href="mailto:ams@wiw.org">Abhijit Menon-Sen</a> 
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1614" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/10/17/etoys.html" rel="bookmark">Building a Large-scale E-commerce Site with Apache and mod_perl</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Perrin Harkins</span> on <abbr class="published" title="2001-10-17T00:00:00-08:00">October 17, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars-->
<!-- sidebar ends -->

	
<h3><a name="common myths">Common Myths</a></h3>

<table width="200" border="0" cellspacing="0" cellpadding="4" align="right">
<tr> 
<td width="200" valign="top" height="4" bgcolor="#6699cc"></td></tr> 
<tr>
<td bgcolor="#efefef">
<p class="headline" align="center">Table of Contents
</p>
<p class="smalltext">

&#149; <a href="#roll your own application server">Roll Your Own Application Server</a><br /><br />
&#149; <a href="#case study: etoys.com">Case Study: eToys.com</a><br /><br />
&#149; <a href="#apache::perlrun to the rescue">Apache::PerlRun to the Rescue</a><br /><br />
&#149; <a href="#planning the new architecture">Planning the New Architecture</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=2#surviving christmas 2000">Surviving Christmas 2000</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=2#the architecture">The Architecture</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=2#proxy servers">Proxy Servers</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=2#application servers">Application Servers</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=2#search servers">Search Servers</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=2#load balancing and failover">Load Balancing and Failover</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=3#code structure">Code Structure</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=3#caching">Caching</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=3#session tracking">Session Tracking</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=3#security">Security</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=3#exception handling">Exception Handling</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=4#templates">Templates</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=4#controller example">Controller Example</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=4#performance tuning">Performance Tuning</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=5#trap: nested exceptions">Trap: Nested Exceptions</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=5#berkeley db">Berkeley DB</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=5#valuable tools">Valuable Tools</a><br /><br />
&#149; <a href="/pub/a/2001/10/17/etoys.html?page=5#an open source success story">An Open-Source Success Story</a>
</td></tr> <tr><td width="150" valign="top" height="4" bgcolor="#6699cc"> </td></tr></table>

<p>When it comes to building a large e-commerce Web site, everyone is full
of advice. Developers will tell you that only a site built in C++ or
Java (depending on which they prefer) can scale up to handle heavy
traffic. Application server vendors will insist that you need a
packaged all-in-one solution for the software. Hardware vendors will
tell you that you need the top-of-the-line mega-machines to run a large
site. This is a story about how we built a large e-commerce site using
mainly open-source software and commodity hardware. We did it, and you
can do it, too.</p>

<h3><a name="perl saves">Perl Saves</a></h3>
<p>Perl has long been the preferred language for developing CGI scripts.
It combines supreme flexibility with rapid development. <em>Programming Perl</em> 
is still O'Reilly's top-selling technical book, and community
support abounds. Lately though, Perl has come under attack from certain
quarters. Detractors claim that it's too slow for serious development
work and that code written in Perl is too hard to maintain.</p>
<p>The <code>mod_perl</code> Apache module changes the whole performance picture for
Perl. Embedding a Perl interpreter inside of Apache provides
performance equivalent to Java servlets, and makes it an excellent
choice for building large sites. Through the use of Perl's
object-oriented features and some basic coding rules, you can build a
set of code that is a pleasure to maintain, or at least no worse than
other languages.</p>
<p>
<h3><a name="roll your own application server">Roll Your Own Application Server</a></h3>

<p>When you combine Apache, <code>mod_perl</code> and open-source code available from
CPAN (the Comprehensive Perl Archive Network), you get a set of
features equivalent to a commercial application server:</p>
<ul>
<li>
Session handling
</li>
<li>
Load balancing
</li>
<li>
Persistent database connections
</li>
<li>
Advanced HTML templating
</li>
<li>
Security
</li></ul>

<p>You also get some things you won't get from a commercial product, such as
a direct line to the core development team through the appropriate
mailing list and the ability to fix problems yourself instead of
waiting for a patch. Moreover, each part of the system is under your
control, making you limited only by your team's abilities.</p>

<h3><a name="case study: etoys.com">Case Study: eToys.com</a></h3>



<p>When we first arrived at eToys in 1999, we found a situation that is
probably familiar to many who have joined a growing startup Internet
company. The system was based on CGI scripts talking to a MySQL
database. Static file serving and dynamic content generation were
sharing resources on the same machines. The CGI code was largely
written in a Perl4-ish style and not as modular as it could be; which
was not surprising since most of it was built as quickly as possible by
a small team.</p>
<p>Our major task was to figure out how to get this system to scale large
enough to handle the expected Christmas traffic. The toy business is
all about seasonality, and the difference between the peak selling
season and the rest of the year is enormous. The site had barely
survived the previous Christmas, and the MySQL database didn't look
like it could scale much further.</p>
<p>The call had already been made to switch to Oracle, and a DBA team was
in place. We didn't have enough time to do a redesign of the software,
so we had to scramble to put in place whatever performance improvements
we could finish by Christmas.</p>

<h4><a name="apache::perlrun to the rescue">Apache::PerlRun to the Rescue</a></h4>
<p><code>Apache::PerlRun</code> is a module that exists to smooth the transition
between basic CGI and <code>mod_perl</code>. It emulates a CGI environment, and
provides some (but not all) of the performance benefits associated with
code written for <code>mod_perl</code>. Using this module and the persistent
database connections provided by <code>Apache::DBI</code>, we were able to do a
basic port to <code>mod_perl</code> and Oracle in time for Christmas, and
combined with some new hardware we were ready to face the Christmas
rush.</p>
<p>The peak traffic lasted for eight weeks, most of which were spent
frantically fixing things or nervously waiting for something else to
break. Nevertheless, we made it through. During that time, we collected
the following statistics:</p>

<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->
<table cellspacing="12" cellpadding="0" border="0" align="right" width="200"><tr><td>
<center><img src="/images/pixel-hub.gif" width="200" height="2" hspace="0" vspace="10" border="0" alt=" " /><br />
<center><a href="http://conferences.oreilly.com/oscon/"><img src="/images/os2002/oscon-sidebar.gif" alt="O'Reilly Open Source Convention -- July 22-26, San Diego, CA." width="143" height="78" border="0" /></a></center>
<p class="smalllist"><strong>From the Frontiers of Research to the Heart of the Enterprise</strong></p>
</center>
<p class="secondary"><a href="http://conferences.oreillynet.com/cs/os2002/view/e_sess/2801">
Efficient Shared Data for mod_perl</a><br />Perrin Harkins discusses the performance and ease of use of different options for sharing data that are available on CPAN, from IPC::Shareable to Cache::Cache at the <a href="http://conferences.oreillynet.com/os2002/">O'Reilly Open Source Convention</a>, this July 22-26, in San Diego.</p>
<center><img src="/images/pixel-hub.gif" width="200" height="2" hspace="0" vspace="0" border="0" alt=" " /></center>
</td></tr></table>

<ul>
<li>
60 - 70,000 sessions/hour
</li>
<li>
800,000 page views/hour
</li>
<li>
7,000 orders/hour
</li></ul>
<p>According to Media Metrix, we were the third-most-heavily trafficked
e-commerce site, behind eBay and Amazon.</p>

<h3><a name="planning the new architecture">Planning the New Architecture</a></h3>

<p>It was clear that we would need to do a redesign for 2000. We had
reached the limits of the current system and needed to tackle some of
the harder problems that we had been holding off on.</p>
<p>Goals for the new system included moving away from offline page
generation. The old system had been building HTML pages for each
product and product category on the site in a batch job and dumping
them out as static files. This was effective when we had a small
database of products since the static files gave such good performance,
but we had recently added a children's bookstore to the site that
increased the size of our product database by an order of magnitude and
made the time required to generate each page prohibitive. We needed a
strategy that would only require us to build pages that customers were
actually interested in and would still provide solid performance.</p>
<p>We also wanted to re-do the database schema for more flexibility, and
structure the code in a more modular way that would make it easier for
a team to share the development work without stepping on one another. We
knew that the new codebase would have to be flexible enough to support
a continuously evolving set of features.</p>
<p>Not all of the team had significant experience with object-oriented
Perl, so we brought in Randal Schwartz and Damian Conway to do training
sessions with us. We created a set of coding standards, drafted a
design and built our system.</p>














<h3><a name="surviving christmas 2000">Surviving Christmas 2000</a></h3>
<p>Our capacity planning was for three times the traffic of the previous
peak. That's what we tested to, and that's about what we got:</p>
<ul>
<li>
200,000+ sessions/hour
</li>
<li>
2.5 million+ page views/hour
</li>
<li>
20,000+ orders/hour
</li></ul>
<p>The software survived, although one of the routers went up in smoke.
Once again, we were rated the third-most-highly trafficked e-commerce
site for the season.</p>

<h3><a name="the architecture">The Architecture</a></h3>
<p>The machine strategy for the system is a fairly common one: low-cost
Intel-based servers with a load-balancer in front of them, and big iron
for the database.</p>
<p>Like many commercial packages, we have separate systems for the
front-end Web servers (which we call proxy servers) and the application
servers that generate the dynamic content. Both the proxy servers and
the application servers are load-balanced using dedicated hardware from
f5 Networks. More details about each of the systems shown here is
provided below.</p>
<p>We chose to run Linux on our proxy and application servers, a common
platform for <code>mod_perl</code> sites. The ease of remote administration under
Linux made the clustered approach possible. Linux also provided solid
security features and automated build capabilities to help with adding
new servers.</p>
<p>The database servers are IBM NUMA-Q machines, which run <em>DYNIX/ptx</em>.</p>

<h4><a name="proxy servers">Proxy Servers</a></h4>
<p>The proxy servers run a slim build of Apache, without <code>mod_perl</code>. They
have several standard Apache modules installed, in addition to our own
customized version of <em>mod_session</em>, which assigns session cookies.
Because the processes are so small, we can run as many as 400 Apache
children per machine. These servers handle all image requests
themselves, and pass page requests on to the application servers. They
communicate with the app servers using standard HTTP requests, and
cache the page results when appropriate headers are sent from the app
servers. The cached pages are stored on a shared NFS partition of a
Network Appliance filer. Serving pages from the cache is nearly as fast
as serving static files, i.e. <em>very</em> fast.</p>

<p>This kind of reverse-proxy setup is a commonly recommended approach
when working with <code>mod_perl</code>, since it uses the lightweight proxy
processes to send the content to clients (who may be on slow
connections) and frees the resource-intensive <code>mod_perl</code> processes to
move to the next request. For more information on why this
configuration is helpful, see the <code>mod_perl</code> developer's guide at
<a href="http://perl.apache.org/guide/">http://perl.apache.org/guide/</a>.</p>

<h4><a name="application servers">Application Servers</a></h4>



<p>The application servers run <code>mod_perl</code>, and little else. They
have a local cache for Perl objects, using <em>Berkeley DB</em>. The Web
applications run here, and shared resources like HTML templates are
mounted over NFS from the NetApp filer. Because they do the heavy
lifting in this setup, these machines are somewhat beefy, with dual
CPUs and 1GB of RAM each.</p>

<h4><a name="search servers">Search Servers</a></h4>
<p>There is a third set of machines dedicated to handling searches. Since
searching was such a large percentage of overall traffic, it was
worthwhile to dedicate resources to it and take the load off the
application servers and database.</p>

<p>The software on these boxes is a multi-threaded daemon that we
developed in-house using C++. The application servers talk to the
search servers using a Perl module. The search daemon accepts a set of
search conditions and returns a sorted list of object IDs of the
products whose data fits those conditions. Then the application servers
look up the data to display these products from the database. The
search servers know nothing about HTML or the Web interface.</p>

<p>This approach of finding the IDs with the search server and then
retrieving the object data may sound like a performance hit, but in
practice the object data usually comes from the application server's
cache rather than the database. This design allows us to minimize the
duplicated data between the database and the search servers, making it
easier and faster to refresh the index. It also allows us to reuse the same
Perl code for retrieving product objects from the database, regardless
of how they were found.</p>

<p>The daemon uses a standard inverted word list approach to searching.
The index is periodically built from the relevant data in Oracle. If
you prefer an all-Perl solution, then there are modules on CPAN that
implement this approach, including <code>Search::InvertedIndex</code> and
<code>DBIx::FullTextSearch</code>. We chose to write our own because of the 
tight performance requirements on this part of the system, and because
we had an unusually complex set of sorting rules for the returned IDs.</p>

<h3><a name="load balancing and failover">Load Balancing and Failover</a></h3>

<p>We took pains to make sure that we would be able to provide
load-balancing among nodes of the cluster and fault-tolerance in case
one or more nodes failed. The proxy servers are balanced using a random
selection algorithm. A user might end up on a different one on each
request. These servers don't hold any state information, so the goal is
just to distribute the load evenly.</p>

<p>The application servers use "sticky" load balancing. That
means that once a user goes to a particular app server, all of her
subsequent requests during that session will also be passed to the same
app server. The f5 hardware accomplishes this using browser cookies.</p>
<p>The load balancers run a periodic service check on each server and
remove any servers that fail the check from rotation. When a server
fails, all users that were "stuck" to that machine are
moved to another one.</p>
<p>In order to ensure that no data is lost if an app server dies, all
updates are written to the database. As a result, user data like the
contents of a shopping cart is preserved even in cases of catastrophic
hardware failure on an app server. This is essential for a large
e-commerce site.</p>
<p>The database has a separate failover system, which we will not go into
here. It follows standard practices recommended by our vendors.</p>














<h3><a name="code structure">Code Structure</a></h3>
<p>The code is structured around the classic Model-View-Controller
pattern, originally from SmallTalk and now often applied to Web
applications. The MVC pattern is a way of splitting an application's
responsibilities into three distinct layers.</p>
<p>Classes in the Model layer represent business concepts and data, like
products or users. These have an API but no end-user interface. They
know nothing about HTTP or HTML and can be used in non-Web applications
like cron jobs. They talk to the database and other data sources, and
manage their own persistence.</p>
<p>The Controller layer translates Web requests into appropriate actions
on the Model layer. It handles parsing parameters, checking input,
fetching the appropriate Model objects, and calling methods on them.
Then it determines the appropriate View to use and sends the resulting
HTML to the user.</p>
<p>View objects are really HTML templates. The Controller passes data from
the Model objects to them and they generate a Web page. These are
implemented with the Template Toolkit, a powerful templating system
written in Perl. The templates have some basic conditional statements
and looping in them, but only enough to express the formatting logic.
No application control flow is embedded in the templates.</p>

<h3><a name="caching">Caching</a></h3>
<p>The core of the performance strategy is a multi-tier caching system. On
the application servers, data objects are cached in shared memory with
a backing store on local disk. Applications specify how long a data
object can be out of sync with the database, and all future accesses
during that time are served from the high-speed cache. This type of
cache control is known as ``time-to-live.'' The local cache is
implemented using a <em>Berkeley DB</em> database. Objects are serialized
with the standard <em>Storable</em> module from CPAN.</p>

<p>Data objects are divided into pieces when necessary to provide finer
granularity for expiration times. For example, product inventory is
updated more frequently than other product data. By splitting up the
product data, we can use a short expiration for inventory that keeps
it in tighter sync with the database, while still using a longer
expiration for the less volatile parts of the product data.</p>

<p>The application servers' object caches share product data between them
using the IP Multicast protocol and custom daemons written in C. When a
product is placed in the cache on one server, the data is replicated to
the cache on all other servers. This technique is successful
because of the high locality of access in product data. During the 2000
Christmas season this cache achieved a 99 percent hit ratio, thus taking a
large amount of work off the database.</p>
<p>In addition to caching the data objects, entire pages that are not
user-specific, like product detail pages, can be cached. The
application takes the shortest expiration time of the data objects used
in the pages and specifies that to the proxy servers as a page
expiration time, using standard <em>Expires</em> headers. The proxy servers
cache the generated page on a shared NFS partition. Pages served from
this cache have performance close to that of static pages.</p>
<p>To allow for emergency fixes, we added a hook to <code>mod_proxy</code> that
deletes the cached copy of a specified URL. This was used when a page
needed to be changed immediately to fix incorrect information.</p>
<p>An extra advantage of this <code>mod_proxy</code> cache is the automatic handling
of <em>If-Modified-Since</em> requests. We did not need to implement this
ourselves since <code>mod_proxy</code> already provides it.</p>

<h3><a name="session tracking">Session Tracking</a></h3>


<p>Users are assigned session IDs using HTTP cookies. This is done at the
proxy servers by our customized version of <code>mod_session</code>. Doing it at
the proxy ensures that users accessing cached pages will still get a
session ID assigned. The session ID is simply a key into data stored on
the server-side. User sessions are assigned to an application server
and continue to use that server unless it becomes unavailable. This is
called "sticky" load balancing. Session data and other data
modified by the user -- such as shopping cart contents -- is written to
both the object cache and the database. The double write carries a
slight performance penalty, but it allows for fast read access on
subsequent requests without going back to the database. If a server
failure causes a user to be moved to a different application server,
then the data is simply fetched from the database again.</p>

<h3><a name="security">Security</a></h3>
<p>A large e-commerce site is a popular target for all types of attacks.
When designing such a system, you have to assume that you will be
attacked and build with security in mind, at the application level as
well as the machine level.</p>
<p>The main rule of thumb is "don't trust the client!"
User-specific data sent to the client is protected using multiple
levels of encryption. SSL keeps sensitive data exchanges private from
anyone snooping on network traffic. To prevent "session
hijacking" (when someone tampers with their session ID in order
to gain access to another user's session), we include a Message
Authentication Code (MAC) as part of the session cookie. This is
generated using the standard <code>Digest::SHA1</code> module from CPAN, with a
seed phrase known only to our servers. By running the ID from the
session cookie through this MAC algorithm, we can verify that the data
being presented was generated by us and not tampered with.</p>
<p>In situations where we need to include some state information in an
HTML form or URL and don't want it to be obvious to the user, we use
the CPAN <code>Crypt::</code> modules to encrypt and decrypt it. The
<code>Crypt::CBC</code> module is a good place to start.</p>
<p>To protect against simple overload attacks, when someone uses a program
to send high volumes of requests at our servers hoping to make them
unavailable to customers, access to the application servers is
controlled by a throttling program. The code is based on some work by
Randal Schwartz in his <code>Stonehenge::Throttle</code> module. Accesses for
each user are tracked in compact logs written to an NFS partition. The
program enforces limits on how many requests a user can make within a
certain period of time.</p>
<p>For more information on Web security concerns including the use of MAC,
encryption and overload prevention, we recommend looking at the books
<em><a href="http://www.oreilly.com/catalog/cgi2/">CGI Programming with Perl, 2nd Edition</a></em> and 
<em><a href="http://www.oreilly.com/catalog/wrapmod/">Writing Apache Modules with Perl and C</a></em>, both from <a href="http://oreilly.com">O'Reilly</a>.</p>


<h3><a name="exception handling">Exception Handling</a></h3>
<p>When planning this system, we considered using Java as the
implementation language. We decided to go with Perl, but we really
missed Java's nice exception-handling features. Luckily, Graham Barr's
Error module from CPAN supplies similar capabilities in Perl.</p>
<p>Perl already has support for trapping runtime errors and passing
exception objects, but the Error module adds some nice syntactic sugar.
The following code sample is typical of how we used the module:</p>
<pre>
    try {
        do_some_stuff();
    } catch My::Exception with {
        my $E = shift;
        handle_exception($E);
    };</pre>
<p>The module allows you to create your own exception classes and trap for
specific types of exceptions.</p>
<p>One nice benefit of this is the way it works with <em>DBI</em>. If you turn
on <em>DBI's</em> <em>RaiseError</em> flag and use try blocks in places where you
want to trap exceptions, the <em>Error</em> module can turn <em>DBI</em> errors
into simple <em>Error</em> objects.</p>
<pre>
    try {
        $sth-&gt;execute();
    } catch Error with {
        # roll back and recover
        $dbh-&gt;rollback();
        # etc.
    };</pre>
<p>This code shows a condition where an error would indicate that we
should roll back a database transaction. In practice, most <code>DBI</code>
errors indicate something unexpected happened with the database and the
current action can't continue. Those exceptions are allowed to
propagate up to a top-level <code>try{}</code> block that encloses the whole
request. When errors are caught there, we log a stacktrace and send a
friendly error page back to the user.</p>














<h3><a name="templates">Templates</a></h3>

<p>Both the HTML and the formatting logic for merging application data
into it is stored in the templates. They use a CPAN module called
<em>Template Toolkit</em>, which provides a simple but powerful syntax for
accessing the Perl data structures passed to them by the application.
In addition to basics such as looping and conditional statements, it
provides extensive support for modularization, allowing the use of
includes and macros to simplify template maintenance and avoid
redundancy.</p>
<p>We found <em>Template Toolkit</em> to be an invaluable tool on this project.
Our HTML coders picked it up quickly and were able to do nearly
all of the templating work without help from the Perl coders. We
supplied them with documentation of what data would be passed to each
template and they did the rest. If you have never experienced the joy
of telling a project manager that the HTML team can handle his
requested changes without any help from you, then you are seriously missing
out!</p>
<p><em>Template Toolkit</em> compiles templates into Perl bytecode and caches
them in memory to improve efficiency. When template files change on
disk they are picked up and re-compiled. This is similar to how other
<code>mod_perl</code> systems like Mason and <code>Apache::Registry</code> work.</p>
<p>By varying the template search path, we made it possible to assign
templates to particular sections of the site, allowing a customized
look and feel for specific areas. For example, the page header template
in the bookstore section of the site can be different from the one in
the video game store section. It is even possible to serve the same
data with a different appearance in different parts of the site,
allowing for co-branding of content.</p>
<p>This is a sample of what a basic loop looks like when coded in
<em>Template Toolkit</em>:</p>
<pre>
    [% FOREACH item = cart.items %]
    name: [% item.name %]
    price: [% item.price %]
    [% END %]</pre>

<h3><a name="controller example">Controller Example</a></h3>
<p>Let's walk through a simple Hello World example that illustrates how
the Model-View-Controller pattern is used in our code. We'll start with
the controller code.</p>
<pre>
    package ESF::Control::Hello;
    use strict;
    use ESF::Control;
    @ESF::Control::Hello::ISA = qw(ESF::Control);
    use ESF::Util;
    sub handler {
        ### do some setup work
        my $class = shift;
        my $apr = ESF::Util-&gt;get_request();

        ### instantiate the model
        my $name = $apr-&gt;param('name');

        # we create a new Model::Hello object.
        my $hello = ESF::Model::Hello-E&lt;gt&gt;new(NAME =E&lt;gt&gt; $name);

        ### send out the view
        my $view_data{'hello'} = $hello-&gt;view();

        # the process_template() method is inherited
        # from the ESF::Control base class
        $class-&gt;process_template(
                TEMPLATE =&gt; 'hello.html',
                DATA     =&gt; \%view_data);
    }</pre>
<p>In addition to the things you see here, there are a few interesting
details about the <code>ESF::Control</code> base class. All requests are
dispatched to the <code>ESF::Control-&gt;run()</code> method first, wrapping
them in a <code>try{}</code> block before calling the appropriate <code>handler()</code>
method. It also provides the <code>process_template()</code> method, which runs
<code>Template Toolkit</code> and then sends the results with appropriate
HTTP headers. If the Controller specifies it, then the headers can include
<code>Last-Modified</code> and <code>Expires</code> for control of page caching by the
proxy servers.</p>
<p>Now let's look at the corresponding Model code.</p>
<pre>
    package ESF::Model::Hello;
    use strict;
    sub new {
        my $class = shift;
        my %args = @_;
        my $self = bless {}, $class;
        $self{'name'} = $args{'NAME'} || 'World';
        return $self;
    }

    sub view {
        # the object itself will work for the view
        return shift;
    }</pre>
<p>This is a simple Model object. Most Model objects would have some
database and cache interaction. They would include a <code>load()</code> method
that accepts an ID and loads the appropriate object state from the
database. Model objects that can be modified by the application would
also include a <code>save()</code> method.</p>



<p>Note that because of Perl's flexible OO style, it is not necessary to
call <code>new()</code> when loading an object from the database. The <code>load()</code>
and <code>new()</code> methods can both be constructors for use in different
circumstances, both returning a blessed reference.</p>
<p>The <code>load()</code> method typically handles cache management as well as
database access. Here's some pseudo-code showing a typical <code>load()</code>
method:</p>
<pre>
    sub load {
        my $class = shift;
        my %args = @_;
        my $id = $args{'ID'};
        $self = _fetch_from_cache($id) ||
                _fetch_from_database($id);
        return $self;
    }</pre>
<p>The save method would use the same approach in reverse, saving first to
the cache and then to the database.</p>
<p>One final thing to notice about our Model class is the <code>view()</code>
method. This method exists to give the object an opportunity to shuffle
it's data around or create a separate data structure that is easier for
use with a template. This can be used to hide a complex implementation
from the template coders. For example, remember the partitioning of the
product inventory data that we did to allow for separate cache
expiration times? The product Model object is really a fa&ccedil;ade
for several underlying implementation objects, but the <code>view()</code> method
on that class consolidates the data for use by the templates.</p>
<p>To finish our Hello World example, we need a template to render the
view. This one will do the job:</p>
<pre>
    &lt;HTML&gt;
    &lt;TITLE&gt;Hello, My Oyster&lt;/TITLE&gt;
    &lt;BODY&gt;
        [% PROCESS header.html %]
        Hello [% hello.name %]!
        [% PROCESS footer.html %]
    &lt;/BODY&gt;
    &lt;/HTML&gt;</pre>

<h3><a name="performance tuning">Performance Tuning</a></h3>
<p>Since Perl code executes so quickly under <code>mod_perl</code>, the performance
bottleneck is usually at the database. We applied all the documented
tricks for improving <code>DBD::Oracle</code> performance. We used bind
variables, <code>prepare_cached()</code>, <code>Apache::DBI</code>, and adjustments to the
<code>RowCache</code> buffer size.</p>
<p>The big win of course is avoiding going to the database in the first
place. The caching work we did had a huge impact on performance.
Fetching product data from the <em>Berkeley DB</em> cache was about 10 times
faster than fetching it from the database. Serving a product page from
the proxy cache was about 10 times faster than generating it on the
application server from cached data. Clearly, the site would never have
survived under heavy load without the caching.</p>
<p>Partitioning the data objects was also a big win. We identified several
different subsets of product data that could be loaded and cached
independently. When an application needed product data, it could
specify which subset was required and skip loading the unnecessary data
from the database.</p>
<p>Another standard performance technique we followed was avoiding
unnecessary object creation. The <code>Template</code> object is created the
first time it's used and then cached for the life of the Apache
process. Socket connections to search servers are cached in a way
similar to what <code>Apache::DBI</code> does for database connections. Resources
that are used frequently within the scope of a request, such as
database handles and session objects, were cached in <code>mod_perl</code>'s
<code>$r-&gt;pnotes()</code> until the end of the request.</p>














<h3><a name="trap: nested exceptions">Trap: Nested Exceptions</a></h3>
<p>When trying out a new technology like the <code>Error</code> module, there are
bound to be some things to watch out for. We found a certain code
structure that causes a memory leak every time it is executed. It
involves nested <code>try{}</code> blocks, and looks like this:</p>
<pre>
    my $foo;
    try {
        # some stuff...
        try {
            $foo++;
            # more stuff...
        } catch Error with {
            # handle error
        };

    } catch Error with {
        # handle other error
    };</pre>
<p>It's not Graham Barr's fault that this leaks; it is simply a byproduct
of the fact that the <code>try</code> and <code>catch</code> keywords are implemented using
anonymous subroutines. This code is equivalent to the following:</p>
<pre>
    my $foo;
    $subref1 = sub {
        $subref2 = sub {
            $foo++;
        };
    };</pre>
<p>This nested subroutine creates a closure for <code>$foo</code> and will make a
new copy of the variable each time it is executed. The situation is
easy to avoid once you know to watch out for it.</p>
<p>
<h4><a name="berkeley db">Berkeley DB</a></h4>
<p>One of the big wins in our architecture was the use of <code>Berkeley DB</code>.
Since most people are not familiar with it's more advanced features,
we'll give a brief overview here.</p>
<p>The <code>DB_File</code> module is part of the standard Perl distribution.
However, it only supports the interface of <em>Berkeley DB</em> version 1.85,
and doesn't include the interesting features of later releases. To get
those, you'll need the <code>BerkeleyDB.pm</code> module, available from CPAN.
This module can be tricky to build, but comprehensive instructions are
included.</p>
<p>Newer versions of <em>Berkeley DB</em> offer many features that help
performance in a <code>mod_perl</code> environment. To begin with, database files
can be opened once at the start of the program and kept open, rather
than opened and closed on each request. <em>Berkeley DB</em> will use a
shared memory buffer to improve data access speed for all processes
using the database. Concurrent access is directly supported with
locking handled for you by the database. This is a huge win over
<code>DB_File</code>, which requires you to do your own locking. Locks can be at
a database level, or at a memory page level to allow multiple
simultaneous writers. Transactions with rollback capability are also
supported.</p>
<p>This all sounds too good to be true, but there are some downsides. The
documentation is somewhat sparse, and you will probably need to refer
to the C API if you need to understand how to do anything complicated.</p>
<p>A more serious problem is database corruption. When an Apache process
using <em>Berkeley DB</em> dies from a hard kill or a segfault, it can
corrupt the database. A corrupted database will sometimes cause
subsequent opening attempts to hang. According to the people we talked
to at Sleepycat Software (which provides commercial support for
<em>Berkeley DB</em>), this can happen even with the transactional mode of
operation. They are working on a way to fix the problem. In our case,
none of the data stored in the cache was essential for operation so we
were able to simply clear it out when restarting an application server.</p>
<p>Another thing to watch out for is deadlocks. If you use the page-level
locking option, then you have to handle deadlocks. There is a daemon
included in the distribution that will watch for deadlocks and fix
them, or you can handle them yourself using the C API.</p>
<p>After trying a few different things, we recommend that you use
database-level locking. It's much simpler, and cured our problems. We
didn't see any significant performance hit from switching to this mode
of locking. The one thing you need to watch out for when using
exclusive database level write locks are long operations with cursors
that tie up the database. We split up some of our operations into
multiple writes in order to avoid this problem.</p>
<p>If you have a good C coder on your team, you may want to try the
alternate approach that we finally ended up with. You can write your
own daemon around <em>Berkeley DB</em> and use it in a client/server style
over Unix sockets. This allows you to catch signals and ensure a safe
shutdown. You can also write your own deadlock handling code this way.</p>

<h3><a name="valuable tools">Valuable Tools</a></h3>


<p>If you plan to do any serious Perl development, then you should really take
the time to become familiar with some of the available development
tools. The debugger in particular is a lifesaver, and it works with
<code>mod_perl</code>. There is a profiler called <code>Devel::DProf</code>, which also
works with <code>mod_perl</code>. It's definitely the place to start when
performance tuning your application.</p>
<p>We found the ability to run our complete system on individual's
workstations to be extremely useful. Everyone could develop on his own
machine, and coordinate changes using <em>CVS</em> source control.</p>
<p>For object modeling and design, we used the open-source <code>Dia</code> program
and <em>Rational Rose</em>. Both support working with UML and are great for
generating pretty class diagrams for your cubicle walls.</p>
<p>Do Try This at Home</p>
<p>Since we started this project, a number of development frameworks that
offer support for this kind of architecture have come out. We don't
have direct experience using these, but they have a similar design and
may prove useful to you if you want to take an MVC approach with your
system.</p>
<p><em>Apache::PageKit</em> is a <code>mod_perl</code> module available from CPAN that
provides a basic MVC structure for Web applications. It uses the
<em>HTML::Template</em> module for building views.</p>
<p><em>OpenInteract</em> is a recently released Web application framework in
Perl, which works together with the persistence layer <em>SPOPS</em>. Both
are available from CPAN.</p>
<p>The <em>Application Toolkit</em> from Extropia is a comprehensive set of Perl
classes for building Web apps. It has excellent documentation and takes
good advantage of existing CPAN modules. You can find it on
<a href="http://www.extropia.com/">http://www.extropia.com/</a>.</p>
<p>If you want a ready-to-use cache module, take a look at the Perl-cache
project on <a href="http://sourceforge.net/">http://sourceforge.net/</a>. This is the next generation of
the popular <code>File::Cache</code> module.</p>
<p>The Java world has many options as well. The <em>Struts</em> framework, part
of the <em>Jakarta</em> project, is a good open-source choice. There are also
commercial products from several vendors that follow this sort of
design. Top contenders include <em>ATG Dynamo</em>, <em>BEA WebLogic</em>, and
<em>IBM WebSphere</em>.</p>

<h3><a name="an open source success story">An Open-Source Success Story</a></h3>
<p>By building on the open-source software and community, we were able to
create a top-tier Web site with a minimum of cost and effort. The
system we ended up with is scalable to huge amounts of traffic. It runs
on mostly commodity hardware making it easy to grow when the need
arises. Perhaps best of all, it provided tremendous learning
opportunities for our developers, and made us a part of the larger
development community.</p>
<p>We've contributed patches from our work back to various open-source
projects, and provided help on mailing lists. We'd like to take this
opportunity to officially thank the open-source developers who
contributed to projects mentioned here. Without them, this would not
have been possible. We also have to thank the hardworking Web
developers at eToys. The store may be closed, but the talent that built
it lives on.</p>
<p>If you have questions about this material, you can contact us at the
following e-mail addresses:</p>
<p>Bill Hilf - <a href="mailto:bill@hilfworks.com">bill@hilfworks.com</a></p>
<p>Perrin Harkins - <a href="mailto:perrin@elem.com">perrin@elem.com</a></p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1624" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/10/p6pdigest/20011013.html" rel="bookmark">This Week on Perl 6 (7 - 13 October 2001)</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Bryan Warnock</span> on <abbr class="published" title="2001-10-13T00:00:00-08:00">October 13, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<h2>This Week In Perl 6 (7 - 13 Oct 2001)</h2>
<!::field::id-author::before=by+::>
<br />
<!::field::date::>
<br />
      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an email version of this summary by sending an empty
message to 
<a href="mailto:perl6-digest-subscribe@netthink.co.uk">perl6-digest-subscribe@netthink.co.uk</a>.
</P>

<P>
Please send corrections and additions to 
<a href="mailto:bwarnock@capita.com">bwarnock@capita.com</a>.
</P>

<P>
There were 419 messages across 92 threads, with 74 authors contributing.  
<H3><a name="NaN_is_Not_a_Number_and_Not_Not_a_Number">NaN is Not a Number, and Not Not a Number </a></H3>

</P>

<P>

(61 posts) Tim Conrow 
<a href="http://archive.develooper.com/perl6-language@perl.org/msg08451.html">pointed out</a> an inconsistency between Perl 6's proposed semantics of
<CODE>NaN</CODE> and the IEEE semantics found in other languages.  (The subsequent debate 
consisted mostly of each side trying to convince the other how Wrong it
was.) 
</P>

<P>
The non-identity of
<CODE>NaN</CODE> makes sense in strongly type languages where a numerical entity can only
hold a number.  There, the IEEE and mathematical notion of
<CODE>NaN</CODE> isn't so much that it isn't a number, but that it 
<I>is</I>  a number that just can't be represented.  (As an integer, floating point 
number, or +- infinity.) In this context, there's an infinitely small 
probability that some non-representable number is numerically equivalent to 
some other non-representable number, so the non-identity makes sense.
</P>

<P>
However, for languages (such as Perl) where numerics aren't a strongly-typed
unique entity, you've really two 
<CODE>NaN</CODE> properties to consider.
You've got, as above, two
<CODE>Nan</CODE>s-That-Really-Are-Numbers-But-Can't-Be-Represented-As-Such, but then you've
also got 
<CODE>NaN</CODE>s that aren't numbers because they simply aren't numbers.
</P>

<P>
In the latter case, it's less of the mathematical notion of 
<CODE>NaN</CODE>, with its associated non-identity, than with non-numeric strings having
a generic notion of
<CODE>NaN</CODE>.  (That's &quot;Not A Number&quot;, as in, &quot;That's Not a Number, It's a String.&quot;)
Given that notion, is makes sense for 
<CODE>NaN</CODE>s to have an identity.  Two non-numeric strings are equally Not A Number.
</P>

<P>
The confusion, as you can see, is how to merge these two rather orthogonal
definitions of What is Not a Number into one language, and discussion
continues.
<H3><a name="Numerical_Strings">Numerical Strings</a></H3>

</P>

<P>

(14 posts) A 
<a href="http://archive.develooper.com/perl6-language@perl.org/msg08599.html">spin-off</a> of the above thread mused about extending some of Perl's numerical
string recognition capabilities (such as 1_000_000 for one million) 
inside strings themselves, and perhaps extending them to handle 
standard metric suffixes.  Several syntaxes and ramifications were
discussed, and a couple apparently clean solutions proposed.
<H3><a name="Reduction">Reduction</a></H3>

</P>

<P>

(18 posts) John Williams
<a href="http://archive.develooper.com/perl6-language@perl.org/msg08527.html">asked</a> whether the hyperoperator (
<CODE>^</CODE> ) would handle reduction:
<BLOCKQUOTE></P>

<P>
I just read Apocalypse and Exegesis 3, and something stuck out at me
because of its omission, namely using hyper operators for reduction.
</P>

<P>
$a ^+= @list;  # should sum the elements of @list
</P>

<P>
Larry says @a ^+ 1 will replicate the scalar value for all a's, and Damian
talks about doing summation with the reduce function without mentioning
this compact syntax.
</P>

<P>
So am I overlooking some obvious reason why this won't work?
</BLOCKQUOTE></P>

<P>
Damian Conway replied that no, it should indeed work, but would require
the lvalue to force reduction, which 
<CODE>reduce</CODE> does not.  (Without the lvalue, the scalar value would be extended to match
the list.)
<H3><a name="Parroty_Bits">Parroty Bits</a></H3>

</P>

<P>

(16 posts) Dan Sugalski gave a 
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg05512.html">quick rundown</a> on 
<I>Parrot Magic Cookies</I> (PMCs) and how they work.
</P>

<P>
(18 posts) There was 
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg05633.html">some debate </a>about 
<CODE>jump</CODE> versus
<CODE>branch</CODE>, and what each instruction is supposed to accomplish.  Dan Sugalski:
<BLOCKQUOTE>Absolute addresses are, well, absolute addresses. Relative addresses are 
offsets from the current location.
</P>

<P>
I think the confusion's because the jump opcode's broken. When you say
</P>

<P>
   jump 12
</P>

<P>
It should jump to absolute address 12, not 12 bytes/words/opcodes from the 
current position.
</BLOCKQUOTE></P>

<P>
Subsequent discussion attempted to discern which absolute address - the
absolute &quot;virtual&quot; address, similar to what the 
<CODE>branch</CODE> operator uses, or the real machine address of an operator.  The current
inclinations are for the latter, as that allows Parrot to jump between
code segments.
<H4><a name="Code_Changes">Code Changes</a></H4>

</P>

<P>

<UL><LI>Tom Hughes added
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg05457.html">string transcoding</a> and
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg05553.html">string comparisons.</a></LI><LI>Dan Sugalski 
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg05663.html">provided</a> support for simple subroutines.
</LI><LI>Gregor Purdy 
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg05693.html">committed</a> a large cleanup to the op build architecture.
</LI></UL></P>

<P>

<H3><a name="Last_Words">Last Words</a></H3>

</P>

<P>
Work on Parrot 0.0.3 continues.  
</P>

<hr>

<a href="http://members.home.com/bcwarno/Perl6/">Bryan C. Warnock</a>


<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#NaN_is_Not_a_Number_and_Not_Not_a_Number">NaN is Not a Number, and Not Not a Number </a>
  <li><a href="#Numerical_Strings">Numerical Strings</a>
  <li><a href="#Reduction">Reduction</a>
  <li><a href="#Parroty_Bits">Parroty Bits</a>
  <li><a href="#Code_Changes">Code Changes</a>
  <li><a href="#Last_Words">Last Words</a>
</ul>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1620" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/10/p5pdigest/20011010.html" rel="bookmark">This Week on p5p 2001/10/07</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Abhijit Menon-Sen</span> on <abbr class="published" title="2001-10-10T00:00:00-08:00">October 10, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <h3><a name="Notes">Notes</a></h3>

<table width="150" border="0" cellspacing="0" cellpadding="4" align="right">
<tr> 
<td width="150" valign="top" height="4" bgcolor="#6699cc"><span class="headline"><font color="#ffffff"><center>This Week on P5P</center></font></span></td></tr> 
<tr>
<td bgcolor="#efefef">
<p class="smalltext">
&#149; <a href="#chromatic">chromatic</a><br /><br />
&#149; <a href="#Call_for_PerlIO_bugs">Call for PerlIO bugs</a><br /><br />
&#149; <a href="#Attributes_are_broken">Attributes are broken</a><br /><br />
&#149; <a href="#Multiple_FETCHes">Multiple FETCHes</a><br /><br />
&#149; <a href="#Code_cleanups">Code cleanups</a><br /><br />
&#149; <a href="#Various">Various</a><br /><br />
</td></tr> <tr><td width="150" valign="top" height="4" bgcolor="#6699cc"> </td></tr></table>

<p>

Please send corrections and additions to perl-thisweek-YYYYMM@simon-cozens.org
where YYYYMM is the current year and month. Changes and additions to the
perl5-porters biographies are particularly welcome.</p>

<h3><a name="chromatic">chromatic</a></h3>


<p>

P5P is in awe of the patience and test writing ability of chromatic, who
has, in a very short time, given us exhaustive new tests for 
<code>B::Terse</code>, 
<code>Dumpvalue</code>, 
<code>CGI::Fast</code>, 
<code>CGI::Push</code>, 
<code>CPAN::Nox</code>, 
<code>Term::Cap</code>, 
<code>Tie::Scalar</code>, 
<code>Term::Complete</code>, 
<code>ExtUtils::Command</code>, 
<code>less</code>, 
<code>open</code>, 
<code>filetest</code>, 
<code>sigtrap</code>, 
<code>warnings::register</code>, and a bunch of patches to older tests. Thank you!</p>
<h3><a name="Call_for_PerlIO_bugs">Call for PerlIO bugs</a></h3>



<p>

Nicholas Clark found some people at a London.pm meeting who knew of
unfixed PerlIO bugs, and suggested the following call-for-bugs:
<blockquote></p>

<p>

   If you are aware of a PerlIO bug that perl5-porters isn't aware of,
   please would you tell perl5-porters about it, preferably in the form
   of a regression test that will print &quot;ok\n&quot; once it is fixed.  Else
   don't be surprised if 5.8.0 ships with the bug still present.
</blockquote></p>

<p>

(While you're at it, report any other lurking bugs you know about.)</p>
<h3><a name="Attributes_are_broken">Attributes are broken</a></h3>


<p>

Arthur Bergman explained again why
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00051.html">attributes are broken </a>. The problem is that the
<code>MODIFY_*_ATTRIBUTE</code> subs (used to set attributes for a variable) are called at compile time.
Thus, in the following code:
<pre>
    sub MODIFY_SCALAR_ATTRIBUTE {
        ...
        tie $obj, $class;
    }

    for (1..10) {
        my $foo : bar = "BAZ";

        ...
    }
</pre>

<p>

The variable 
<code>$foo</code> would be tied only on the first iteration of the loop, after which the
scope cleanup mechanism would remove its magic, and the variable would
remain untied for the remaining iterations.
</p>

<h3><a name="Multiple_FETCHes">Multiple FETCHes</a></h3>



<p>

Jeff 'japhy' Pinyan attacked some instances of 
<code>FETCH</code> being called multiple times on tied variables (for 
<code>$tied++</code>, 
<code>$tied || $untied</code>), thus causing potentially undesirable side-effects (Read an 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00070.html">analysis of the problem</a> and
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00178.html">the proposed solution</a>). Several people pointed out the 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00190.html">problems with this approach</a>, but no better solution has been found yet.
</p>

<p>
Jeff also wanted to optimise 
<code>grep</code> when called in boolean context (
<code>if (grep EXPR, LIST)</code>) to avoid iterating over the entire LIST, and just return the first
time 
<code>EXPR</code> was true, but the 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00129.html">potentially desirable side-effects</a> of 
<code>EXPR</code> make this optimisation infeasible.
</p>

<h3><a name="Code_cleanups">Code cleanups</a></h3>

<p>

Casey West embarked on a 
<code>pod/*</code> cleanup, to make the example code use strict where appropriate, be
generally pleasing to the eye, and easy to understand. Despite this
noble goal, his patches were met with some suspicion.
</p>

<p>
Jeff Pinyan said the example shouldn't use 
<code>$a</code>, the 
<code>sort</code> variable, but Jarkko didn't want to encourage cargo-cult programming by
punishing the poor innocent 
<code>$a</code> for the vagaries of
<code>sort</code>. Abigail didn't think the patches accomplished anything useful, but
Jarkko said that consistency and following our own suggestions (in 
<code>perlstyle</code>) are obviously good things.
</p>

<p>
Casey posted an explanation:
<blockquote>

    I feel that my style is a generally acceptable one that everyone can
    understand. In that light, I don't think it's a bad thing if I make
    some minor changes (single versus double quotes) in the process of
    making a whole document better.
</blockquote></p>

<p>

Nobody said anything after that.
</p>

<h3><a name="Various">Various</a></h3>


<p>

Andy Dougherty suggested an optional 
<code>make torture_test</code> target to run tests which were not portable. (Schwern hasn't noticed
yet.)
</p>

<p>
Arthur Bergman is running the LXR cross referencing tools on the perl
source. The result: PXR, the 
<a href="http://pxr.perl.org/source/">Perl Cross Reference</a>. It will eventually contain cross references of perl-current, the
latest stable release, and the Parrot source.
</p>

<p>
Brian Ingerson (of Inline fame) posted his first P5P patch, implementing
the oft-requested 
<code>Data::Dumper</code> feature to allow hash keys to be sorted. He even got the indentation
right the first time!
</p>

<p>
Craig Berry provided a patch to fix 
<code>%ENV</code> tainting on VMS. (Only five tests fail on VMS now, and a couple of them
are bogus failures.)
</p>

<p>
Jarkko released two snapshots: 12307 and 12340. (The latest snapshot can
be retrieved via rsync from &quot;ftp.funet.fi::perlsnap&quot;.)
</p>

<p>
Michael Schwern sought a philosophical solution to the finding the path
to the running perl interpreter. Instead, he found that the contents of 
<code>$^X</code> are system dependent when perl is invoked by a #!-line.
</p>

<p>
Nicholas Clark continued to submit lots of little patches, one of which
became change #12345. This is entirely fitting, because Nick is a hoopy
frood who knows exactly where his towel is.
</p>

<p>
Paul Marquess and Robin Barker are investigating a 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00104.html">DB_File bug</a> involving filtered keys.
</p>

<p>
Stas Bekman is hunting down interesting 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00257.html">MakeMaker</a> (and 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00352.html">related</a>) bugs. He also found a 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-10/msg00209.html">scoping problem in the warnings pragma</a>.
</p>

<p>
Finally, P5P was specially selected to receive a free mini-vacation to
any of fifteen exciting destinations, along with several other people
whose email addresses contained "per."
</p>

<hr>

<a href="mailto:ams@wiw.org">Abhijit Menon-Sen</a>




        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1612" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/10/10/perlmx.html" rel="bookmark">Filtering Mail with PerlMx</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Mike DeGraw-Bertsch</span> on <abbr class="published" title="2001-10-10T00:00:00-08:00">October 10, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<h3>Introduction</h3>

<p>PerlMx is a utility by ActiveState that allows Perl programs to
interface with Sendmail connections. It's quite a powerful tool, and
once installed, it's very easy to use. This article will detail how
to install and setup PerlMx, and provide an overview both of what you
can do with PerlMx, and how to do it. This overview will be based on
spamNX, the anti-spam code I developed, available at
<a href="https://sourceforge.net/projects/spamnx">https://sourceforge.net/projects/spamnx</a>.
 My next PerlMx article will go through spamNX in depth, to
demonstrate how to harness the power of PerlMx.</p>
<h3>Prerequisites</h3>

<p>PerlMx is made possible by the excellent Milter code provided in
Sendmail versions 8.10.0 and higher. This code, when compiled into
Sendmail, allows external programs to hook into the Sendmail
connection process via C callbacks. PerlMx passes these C hooks to
the Perl interpreter, where you can access the information with a
simple <code>shift</code>.</p>
<p>Versions 8.12 and higher of Sendmail
enable Milter by default.  In prior versions, you must first enable
the code in Sendmail. To do so, go to the <code>devtools/site</code>
directory off of the Sendmail source code. Add the following lines to
your <code>site.config.m4</code> file:</p>

<pre>dnl Milter
APPENDDEF(`conf_sendmail_ENVDEF', `-D_FFR_MILTER=1')
APPENDDEF(`conf_libmilter_ENVDEF', `-D_FFR_MILTER=1')</pre>

<p>
Now compile and install Sendmail. Once installed, add the following
lines to your <code>config.mc</code> file (again, for Sendmail below version
8.12):</p>

<pre>
define(`_FFR_MILTER','1')dnl
INPUT_MAIL_FILTER(`&lt;filter_name&gt;', `S=inet:3366@localhost, F=T')</pre>



<p>Be warned that if you enable Milter in your configuration file,
all Sendmail connections will fail unless PerlMx is running. So wait
until your code is ready to go before you change your config file.</p>

<p>Your Sendmail installation is now ready to go. PerlMx also needs
Perl 5.6.0 or higher, with ithreads enabled, and cannot have big
integer (nor really big) support enabled.  Prior to 5.6.1, PerlMx
will also need the File-Temp module installed.  With Perl properly
configured, run the installation program provided by ActiveState.</p>

<p>Once PerlMx is installed and your code is ready to go, run:</p>
<pre>pmx &lt;package&gt; &amp;</pre>

<p>
To launch PerlMx. At this point, you can safely turn on the Milter
code in your Sendmail configuration. There are a few command-line
options available for PerlMx. Most are unnecessary, but I've found I
need to allow more than the default five threads. To do so, run:</p>
<pre>pmx -r &lt;# of threads&gt; &lt;package&gt; &amp;</pre>
<p>
You can read about all the available options by running <code>pmx -h</code>.</p>
<p><a href="http://aspn.activestate.com/ASPN/Reference/Products/PerlMx/FAQ.html">ActiveState
has an FAQ available</a> if you run into any trouble or have
questions that aren't covered here.</p>
<p>Sendmail, Perl, and PerlMx should now be installed and ready to
go.  The following section provides an overview of how to write
PerlMx code.</p>

<h3>Programming Overview</h3>
<p>PerlMx allows you to hook into the connection at many stages of
the connection, which are called by PerlMx from your code. I'll now
go through an outline of spamNX, to show how to start using PerlMx.</p>
<pre>package spamNX;
use strict;
use PerlMx;</pre>
<p>
The basic building blocks: give your package a name, and tell it to
use PerlMx.  Code executed here is only run once, so you can open a
database connection or perform similar operations here.</p>

<pre>sub new {
  return bless {
    NAME    =&gt; &quot;spamNX&quot;,
    CONNECT =&gt; \&amp;cb_connect,
    HELO    =&gt; \&amp;cb_helo,
    ENVFROM =&gt; \&amp;cb_from,
    ENVRCPT =&gt; \&amp;cb_rcpt,
    HEADER  =&gt; \&amp;cb_header,
    BODY    =&gt; \&amp;cb_body,
    EOM     =&gt; \&amp;cb_eom,
    ABORT   =&gt; \&amp;cb_abort,
    CLOSE   =&gt; \&amp;cb_close,
  }, shift;
}</pre>

<p>
This sub returns a blessed instance of your package's subroutines.
Each key in the hash relates to a specific point in the SMTP
connection, and the associated function is called at that point in
the connection. Your program may define any or all of the above
functions; if it isn't defined in your blessed return, PerlMx won't
try to run any code.</p>













<p>Upon each function call, an object reference and relevant
information are passed to the function via the argument list. The
object reference allows calls to various methods and is stateful,
allowing you to store information for use later in the connection. 
The information provided ranges from the name of the connecting host
to the body of the message. These functions, and their associated
arguments, are discussed below, in order of when they're called. The
<code>cb_helo</code> function, which is relatively simple, will be
discussed in detail to familiarize you with how a PerlMx function is
written.</p>
<p>The first function called is <code>cb_connect</code>. This
function is called for every Sendmail connection, and is passed the
standard object reference, the name that the connecting host claims
to be, and the real IP address of the host.</p>
<pre>sub cb_connect {
  # Standard object reference
  my $ctx = shift;
  # (Possibly faked) name of the connecting host
  my $host = shift;
  # IP address of the connectin host
  my $ip = shift;
}</pre>
<p>
This is followed by <code>cb_helo</code>:</p>
<pre>sub cb_helo {
  # Standard object reference
  my $ctx = shift;
  # Connecting host's HELO
  my $helo = shift;
  # Get the name of the host from the $ctx object reference
  my $host = $ctx-&gt;{host};
  # Store the HELO in the ctx object for any future reference
  $ctx-&gt;{helo} = $helo;

  # Compare the host's real name to what they provide in the HELO
  if ($host =~ /$helo/) {
    # Since the RFC spec's that the HELO should be the connecting 
    # host's domain name, reject the mail if the HELO doesn't at 
    # all match the hostname
    return SMFIS_REJECT;
  }

  # Continue with the connection, including any further function calls
  return SMFIS_CONTINUE;
}</pre>
<p>
The preceding code looks at the value the connecting host provides
for a HELO. If that value does not appear in the host's actual name,
then the mail is rejected. Otherwise, the connection continues. Note
that there are other possible return values. They are:</p>
<dl>
	<dd><code>SMFIS_ACCEPT</code> -- accept the message without perfoming any further
	PerlMx checks.</dd><dd>
	<code>SMFIS_TEMPFAIL</code> -- returns a temporary failure, for cases such as
	hostname lookup failure.</dd><dd>
	<code>SMFIS_DISCARD</code> -- accepts the message, but silently drops it in the
	bit bucket.  Not usually a good idea.</dd></dl>



<p>
Related to the SMFIS returns, the <code>$ctx-&gt;setreply($code,
$xcode, $message)</code> method is available to each callback, that
sets the response code to <code>$code</code>, the extended response
to <code>$xcode</code>, and the response message to <code>$message</code>.</p>
<p>The next function called is <code>cb_from</code>, which processes
the sender's <code>MAIL FROM</code>.</p>
<pre>sub cb_from {
  # Object ref
  my $ctx = shift;
  # MAIL FROM value
  my $from = shift
}</pre><p>
Next is <code>cb_rcpt</code>, which is called once per recipient.
Each call is passed the value of one <code>RCPT TO</code> call. To keep track of
every recipient, create an array in the <code>ctx</code> object
reference with each recipient's address.</p>
<pre>sub cb_rcpt {
  # Object ref
  my $ctx = shift;
  # Recipient, a la RCPT TO: line
  my $rcpt = shift;

  # Store the recipient's name
  push(@{$ctx-&gt;{rcpts}}, $rcpt);
}</pre><p>
The next code block, <code>cb_header</code>, is the first part of
code that doesn't deal directly with the connection or an SMTP
protocol field. This code is called during the <code>DATA</code> portion of the
SMTP connection, prior to the blank line that seperates headers from
body. This function is called once per header. As the <code>Received</code>
lines are often multi-lined, the value that you are passed may be
folded. You can use <code>Mail::Header</code>, by Graham Barr, to
unfold multi-lined headers into one line.</p>
<pre>sub cb_header {
  # Object ref
  my $ctx = shift;
  # The header name (e.g. &quot;Cc&quot; or &quot;Received&quot;)
  my $name = shift;
  # The header value (i.e. the latter half of XYZ: abc)
  my $value = shift;
}</pre><p>
We next come to <code>cb_body</code>, which is also called during the
DATA block, after the headers have finished. The code here processes
the actual text of the email message -- very useful for virus scanning
or natural language searches. <code>cb_body</code> may be called
repeatedly for large bodies of text. A caveat to keep in mind for the
future: the built-in <code>replacebody</code> function, which
replaces the text of a message, behaves similarly. On the first call,
the message body is replaced. On all following calls, the text is
appended to the new message. More on this potentially frustrating
feature in my second article.</p>
<pre>sub cb_body {
  # Object ref
  my $ctx = shift;
  # Message body
  my $body = shift;
}</pre><p>
After the text of the message is sent, the SMTP connection is
complete, and <code>cb_eom</code> is called. This block of code is
not passed any special variables outside of the standard object
reference, however there are a few functions available here that are
not available at any other point in the code -- the <code>replacebody</code>
function, for example. The special functions are:</p>
<dl>
	<dd><code>$ctx-&gt;replacebody($body)</code> -- Replaces the body of
	a message with given text. As noted above, can be called multiple
	times for large chunks of data.</dd><dd>
	<code>$ctx-&gt;addrcpt($recipient)</code> -- Adds a message
	recipient.</dd><dd>
	<code>$ctx-&gt;delrcpt($recipient)</code> -- Removes a message
	recipient.</dd><dd>
	<code>$ctx-&gt;addheader($name, $value)</code> -- Adds a header to
	the message.</dd><dd>
	<code>$ctx-&gt;chgheader($name, $index, $value)</code> -- Changes
	the (1-based) Nth occurence of the named header to the given value.</dd><dd>
	<br>
	</dd></dl>
<pre>sub cb_eom {
  # Object ref
  my $ctx = shift;
}</pre><p>
After the connection is completed, and <code>cb_eom</code> finishes,
the <code>cb_close</code> function is called. This call does not get
passed anything aside from the object ref, and simply provides a
means to clean up the <code>ctx</code> object reference and anything
else you may have done during the connection. <code>cb_close</code>
is virtually identical to <code>cb_abort</code> (which I won't
detail, since they're essentially the same); the only difference is
that <code>cb_abort</code> is called when a connection is prematurely
closed.</p>
<pre>sub cb_close {
  # Object ref
  my $ctx = shift;

  # Don't keep a reference to previous recipients
  undef $ctx-&gt;{rcpts};
}</pre>
<h3>
Conclusion</h3>
<p>We've now walked through an outline of a complete PerlMx program,
and seen how to configure Sendmail and Perl to use PerlMx. In my next
article, I'll walk through the interesting bits of my spamNX code, to
demonstrate the power of PerlMx and some tricks that are available to
programmers.</p>





        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1610" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/10/03/exegesis3.html" rel="bookmark">Exegesis 3</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Damian Conway</span> on <abbr class="published" title="2001-10-03T00:00:00-08:00">October  3, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            

<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S03.html">Synopsis 3</a> for the current design information.</p>

<blockquote>
<i>Diamond lives (context-aware);</i>
<br><i>Underscore space means concatenate; fat comma means pair;</i>
<br><i>A pre-star will flatten; colon-equals will bind;</i>
<br><i>And binary slash-slash yields left-most defined.</i>
<blockquote> -- Sade, "Smooth operator" (Perl 6 remix)</blockquote>
</blockquote>

</p><p>In <a href="/pub/a/2001/10/02/apocalypse3.html">Apocalypse 3</a>, Larry describes the changes that Perl 6 will make
to operators and their operations. As with all the Apocalypses, only the
new and different are presented -- just remember that the vast majority
of operator-related syntax and semantics will stay precisely as they are
in Perl 5.</p>

<h3>
<a name="for example..."></a>For example...</h3>


<p>
To better understand those new and different aspects of Perl 6 operators,
let's consider the following program. Suppose we wanted to locate a particular
data file in one or more directories, read the first four lines of each
such file, report and update their information, and write them back to
disk.
</p><p>We could do that with this:
<pre>    sub load_data ($filename ; $version, *@dirpath) {
        $version //= 1;
        @dirpath //= @last_dirpath // @std_dirpath // '.';
        @dirpath ^=~ s{([^/])$}{$1/};</pre>

<pre>        my %data;
        foreach my $prefix (@dirpath) {
            my $filepath = $prefix _ $filename;
            if (-w -r -e $filepath  and  100 &lt; -s $filepath &lt;= 1e6) {
                my $fh = open $filepath : mode=>'rw' 
                    or die "Something screwy with $filepath: $!";
                my ($name, $vers, $status, $costs) = &lt;$fh>;
                next if $vers &lt; $version;
                $costs = [split /\s+/, $costs];
                %data{$filepath}{qw(fh name vers stat costs)} =
                                ($fh, $name, $vers, $status, $costs);
            }
        }
        return %data;
    }</pre>

<pre>    my @StartOfFile is const = (0,0);</pre>

<pre>    sub save_data ( %data) {
        foreach my $data (values %data) {
            my $rest = &lt;$data.{fh}.irs(undef)>
            seek $data.{fh}: *@StartOfFile;
            truncate $data.{fh}: 0;
            $data.{fh}.ofs("\n");
            print $data.{fh}: $data.{qw(name vers stat)}, _@{$data.{costs}}, $rest;
         }
    }</pre>

<pre>    my %data = load_data(filename=>'weblog', version=>1);</pre>

<pre>    my $is_active_bit is const = 0x0080;</pre>

<pre>    foreach my $file (keys %data) {
        print "$file contains data on %data{$file}{name}\n";</pre>

<pre>        %data{$file}{stat} = %data{$file}{stat} ~ $is_active_bit;</pre>

<pre>        my @costs := @%data{$file}{costs};</pre>

<pre>        my $inflation;
        print "Inflation rate: " and $inflation = +&lt;>
            until $inflation != NaN;</pre>

<pre>        @costs = map  { $_.value }
                 sort { $a.key &lt;=> $b.key }
                 map  { amortize($_) => $_ }
                        @costs ^* $inflation;</pre>

<pre>        my sub operator:&sum; is prec(\&amp;operator:+($)) (*@list : $filter //= undef) {
               reduce {$^a+$^b}  ($filter ?? grep &amp;$filter, @list :: @list);
        }</pre>

<pre>        print "Total expenditure: $( &sum; @costs )\n";
        print "Major expenditure: $( &sum; @costs : {$^_ >= 1000} )\n";
        print "Minor expenditure: $( &sum; @costs : {$^_ &lt; 1000} )\n";</pre>

<pre>        print "Odd expenditures: @costs[1..Inf:2]\n"; 
    }</pre>

<pre>    save_data(%data, log => {name=>'metalog', vers=>1, costs=>[], stat=>0});</pre>

<h3>
<a name="i was bound under a flattening star"></a>I was bound under a flattening
star</h3>
<p>
The first subroutine takes a filename and (optionally) a version number
and a list of directories to search:
<pre>    sub load_data ($filename ; $version, *@dirpath) {</pre>
Note that the directory path parameter is declared as <tt>*@dirpath</tt>,
not
<tt>@dirpath</tt>. In Perl 6, declaring a parameter as an array (i.e
<tt>@dirpath</tt>)
causes Perl to expect the corresponding argument will be an actual array
(or an array reference), not just any old list of values. In other words,
a <tt>@</tt> parameter in Perl 6 is like a <tt>\@</tt> context specifier
in Perl 5.
</p><p>To allow <tt>@dirpath</tt> to accept a list of arguments, we have to
use the
<i>list context specifier</i> -- unary <tt>*</tt> -- to tell Perl
to "slurp up" any remaining arguments into the <tt>@dirpath</tt> parameter.
</p><p>This slurping-up process consists of flattening any arguments that are
arrays or hashes, and then assigning the resulting list of values, together
with any other scalar arguments, to the array (i.e. to
<tt>@dirpath</tt>
in this example). In other words, a <tt>*@</tt> parameter in Perl 6 is
like a <tt>@</tt> context specifier in Perl 5.
</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S03.html">Synopsis 3</a> for the current design information.</p>

<h3>
<a name="it's a setup"></a>It's a setup</h3>
</p><p>
In Perl 5, it's not uncommon to see people using the <tt>||=</tt> operator
to set up default values for subroutine parameters or input data:
<pre>    $offset ||= 1;
    $suffix ||= $last_suffix || $default_suffix || '.txt';
    # etc.</pre>

</p>

<table width="150" border="0" cellspacing="0" cellpadding="4" align="right">
<tr> 
<td width="150" valign="top" height="4" bgcolor="#6699cc"></td></tr> 
<tr>
<td bgcolor="#efefef">
<p class="headline" align="center">Related Articles
</p>
<p class="smalltext">
&#149; <a href="/pub/a/2001/04/02/wall.html">Apocalypse 1</a><br /><br />

&#149; <a href="/pub/a/2001/05/03/wall.html">Apocalypse 2</a><br /><br />

&#149; <a href="/pub/a/2001/05/08/exegesis2.html">Exegesis 2</a><br /><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html">Apocalypse 3</a><br /><br />

</td></tr> <tr><td width="150" valign="top" height="4" bgcolor="#6699cc"> </td></tr></table>

<p>Of course, unless you're sure of your range of values, this can go horribly
wrong -- specifically, if the variable being initialized already has a
valid value that Perl happens to consider false (i.e if
<tt>$suffix</tt>
or <tt>$last_suffix</tt> or <tt>$default_suffix</tt> contained an empty
string, or the offset really <i>was</i> meant to be zero).</p>

</p><p>So people have been forced to write default initializers like this:</p>
<pre>    $offset = 1 unless defined $offset;</pre>

</p><p>which is OK for a single alternative, but quickly becomes unwieldy when
there are several alternatives:</p>
<pre>    $suffix = $last_suffix    unless defined $suffix;
    $suffix = $default_suffix unless defined $suffix;
    $suffix = '.txt'          unless defined $suffix;</pre>
<p>
Perl 6 introduces a binary 'default' operator -- <tt>//</tt> -- that solves
this problem. The default operator evaluates to its left operand if that
operand is defined, otherwise it evaluates to its right operand. When chained
together, a sequence of <tt>//</tt> operators evaluates to the first operand
in the sequence that is defined. And, of course, the assignment variant
-- <tt>//=</tt> -- only assigns to its lvalue if that lvalue is currently
undefined.</p>
</p><p>The symbol for the operator was chosen to be reminiscent of a <tt>||</tt>, but
one that's taking a slightly different angle on things.
</p><p>So <tt>&amp;load_data</tt> ensures that its parameters have sensible
defaults like this:
<pre>    $version //= 1;
    @dirpath //= @last_dirpath // @std_dirpath // '.';</pre>
Note that it will also be possible to provide default values directly in
the specification of optional parameters, probably like this:
<pre>    sub load_data ($filename ; $version //= 1, *@dirpath //= @std_dirpath) {...}</pre>
</p><p>

<h3>
<a name="...and context for all"></a>...and context for all</h3>
As if it weren't broken enough already, there's another nasty problem with
using <tt>||</tt> to build default initializers in Perl 5. Namely, that
it doesn't work quite as one might expect for arrays or hashes either.
</p><p>If you write:
<pre>    @last_mailing_list = ('me', 'my@shadow');</pre>

<pre>    # and later...</pre>

<pre>    @mailing_list = @last_mailing_list || @std_mailing_list;</pre>
then you get a nasty surprise: In Perl 5, <tt>||</tt> (and <tt>&amp;&amp;</tt>,
for that matter) always evaluates its left argument in <i>scalar</i> context.
And in a scalar context an array evaluates to the number of elements it
contains, so
<tt>@last_mailing_list</tt> evaluates to <tt>2</tt>. And that's
what's assigned to
<tt>@mailing_list</tt> instead of the actual two elements.
</p><p>Perl 6 fixes that problem, too. In Perl 6, both sides of an <tt>||</tt>
(or a
<tt>&amp;&amp;</tt> or a <tt>//</tt>) are evaluated in the same context
as the complete expression. That means, in the example above, <tt>@last_mailing_list</tt>
is evaluated in list context, so its two elements are assigned to
<tt>@mailing_list</tt>,
as expected.
</p><p>

<h3>
<a name="substitute our vector, victor!"></a>Substitute our vector, Victor!</h3>
The next step in <tt>&amp;load_data</tt> is to ensure that each path in
<tt>@dirpath</tt>
ends in a directory separator. In Perl 5, we might do that with:
<pre>    s{([^/])$}{$1/} foreach @dirpath;</pre>
but Perl 6 gives us another alternative: hyper-operators.
</p><p>Normally, when an array is an operand of a unary or binary operator,
it is evaluated in the scalar context imposed by the operator and
yields a single result. For example, if we execute:
<pre>    $account_balance   = @credits + @debits;
    $biblical_metaphor = @sheep - @goats;</pre>
then <tt>$account_balance</tt> gets the total number of credits plus the
number of debits, and <tt>$biblical_metaphor</tt> gets the numerical difference
between the number of <tt>@sheep</tt> and <tt>@goats</tt>.
</p><p>That's fine, but this scalar coercion also happens when the operation
is in a list context:
<pre>    @account_balances   = @credits + @debits;
    @biblical_metaphors = @sheep - @goats;</pre>
Many people find it counter-intuitive that these statements each produce
the same scalar result as before and then assign it as the single element
of the respective lvalue arrays.
</p><p>It would be more reasonable to expect these to act like:
<pre>    # Perl 5 code...
    @account_balances   =
            map { $credits[$_] + $debits[$_] } 0..max($#credits,$#debits);
    @biblical_metaphors = 
            map { $sheep[$_] - $goats[$_] } 0..max($#sheep,$#goats);</pre>
That is, to apply the operation element-by-element, pairwise along the
two arrays.
</p>
<p>Perl 6 makes that possible, though <i>not</i> by changing the list context
behavior of the existing operators. Instead, Perl 6 provides a "vector"
version of each binary operator. Each uses the same symbol as the corresponding
scalar operator, but with a caret (<tt>^</tt>) dangled in front of it.
Hence to get the one-to-one addition of corresponding credits and debits,
and the list of differences between pairs of sheep and goats, we can write:
<pre>    @account_balances   = @credits ^+ @debits;
    @biblical_metaphors = @sheep ^- @goats;</pre>
	
	
	<p>
This works for <i>all</i> unary and binary operators, including those that
are user-defined. If the two arguments are of different lengths, the operator
Does What You Mean (which, depending on the operator, might involve padding
with ones, zeroes or <tt>undef</tt>'s,
or throwing an exception).
</p>

<p>If one of the arguments is a scalar, that operand is replicated as many
times as is necessary. For example:
<pre>    @interest = @account_balances ^* $interest_rate;</pre>
Which brings us back to the problem of appending those directory separators.
The "pattern association" operator (<tt>=~</tt>) can also be vectorized
by prepending a caret, so we can apply the necessary substitution to each
element in the <tt>@dirpath</tt> array like this:
<pre>    @dirpath ^=~ s{([^/])$}{$1/};</pre>


<h3>
<a name="(pre)fixing those filenames"></a>(Pre)fixing those filenames</h3>
Having ensured everything is set up correctly, <tt>&amp;load_data</tt>
then processes each candidate file in turn, accumulating data as it goes:
<pre>    my %data;
    foreach my $prefix (@dirpath) {</pre>
The first step is to create the full file path, by prefixing the current
directory path to the basic filename:
<pre>        my $filepath = $prefix _ $filename;</pre>
And here we see the new Perl 6 string concatenation operator: underscore.
And yes, we realize it's going to take time to get used to. It may help
to think of it as the old dot operator under extreme acceleration.
</p><p>Underscore is still a valid identifier character, so you need to be
careful about spacing it from a preceding or following identifier (just
as you've always have with the <tt>x</tt> or <tt>eq</tt> operators):
<pre>    # Perl 6 code                   # Meaning</pre>

<pre>    $name = getTitle _ getName;     # getTitle() . getName()
    $name = getTitle_ getName;      # getTitle_(getName())
    $name = getTitle _getName;      # getTitle(_getName())
    $name = getTitle_getName;       # getTitle_getName()</pre>
In Perl 6, there's also a unary form of <tt>_</tt>. We'll get to that <a href="/pub/a/2001/10/03/exegesis3.html?page=4#string 'em up together">a
little later</a>.
</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S03.html">Synopsis 3</a> for the current design information.</p>

<h3>
<a name="don't break the chain"></a>Don't break the chain</h3>
Of course, we only want to load the file's data if the file exists, is
readable and writable, and isn't too big or too small (say, no less than
100 bytes and no more than a million). In Perl 5 that would be:
<pre>    if (-e $filepath  &amp;&amp;  -r $filepath  &amp;&amp;  -w $filepath  and
        100 &lt; -s $filepath  &amp;&amp;  -s $filepath &lt;= 1e6) {...</pre>
which has far too many <tt>&amp;&amp;</tt>'s and <tt>$filepath</tt>'s for
its own good.
</p><p>In Perl 6, the same set of tests can be considerably abbreviated by
taking advantage of two new types of operator chaining:
<pre>    if (-w -r -e $filepath  and  100 &lt; -s $filepath &lt;= 1e6) {...</pre>
First, the <tt>-X</tt> file test operators now all return a special object
that evaluates true or false in a boolean context but is really an encapsulated
<tt>stat</tt>
buffer, to which subsequent file tests can be applied. So now you can put
as many file tests as you like in front of a single filename or filehandle
and they must all be true for the whole expression to be true. Note that
because these are really nested calls to the various file tests (i.e. <tt>-w(-r(-e($filepath)))</tt>),
the series of tests are effectively evaluated in right-to-left order.
</p><p>The test of the file size uses another new form of chaining that Perl
6 supports: multiway comparisons. An expression like <tt>100 &lt; -s $filepath
&lt;= 1e6</tt> isn't even legal Perl 5, but it
Does The Right Thing in Perl 6. More importantly, it short-circuits
if the first comparison fails and will evaluate each
operand only once.
</p><p>

<h3>
<a name="open for business"></a>Open for business</h3>
Having verified the file's suitability, we open it for reading and writing:
<pre>    my $fh = open $filepath : mode=>'rw' 
        or die "Something screwy with $filepath: $!";</pre>
The <tt>: mode=>'rw'</tt> is an <i>adverbial modifier</i> on the <tt>open</tt>.
We'll see more adverbs <a href="/pub/a/2001/10/03/exegesis3.html?page=7#would you like an adverb with that">shortly</a>.
</p><p>The <tt>$!</tt> variable is exactly what you think it
is: a container for the last system error message. It's also considerably
<i>more</i>
than you think it is, since it's also taken over the roles of
<tt>$?</tt>
and <tt>$@</tt>, to become the One True Error Variable.
</p><p>

<h3>
<a name="applied laziness 101"></a>Applied laziness 101</h3>
Contrary to earlier rumors, the "diamond" input operator is alive and
well and living in Perl 6 (yes, the Perl Ministry of Truth is even now
rewriting <a href="/pub/a/2001/05/03/wall.html">Apocalypse
2</a> to correct the ... err ... "printing error" ... that announced <tt>&lt;></tt>
would be purged from the language).
</p><p>So we can happily proceed to read in four lines of data:
<pre>    my ($name, $vers, $status, $costs) = &lt;$fh>;</pre>
Now, writing something like this is a common Perl 5 mistake -- the list
context imposed by the list of lvalues induces <tt>&lt;$fh></tt> to read
the entire file, create a list of (possibly hundreds of thousands of) lines,
assign the first four to the specified variables, and throw the rest away.
That's rarely the desired effect.
</p><p>In Perl 6, this statement works as it should. That is, it works out
how many values the lvalue list is actually expecting and then reads only
that many lines from the file.
</p><p>Of course, if we'd written:
<pre>    my ($name, $vers, $status, $costs, @and_the_rest) = &lt;$fh>;</pre>
then the entire file <i>would</i> have been read.
</p><p>

<h3>
<a name="and now for something completely the same (well, almost)"></a>And
now for something completely the same (well, almost)</h3>
Apart from the new sigil syntax (i.e. hashes now keep their <tt>%</tt>
signs no matter what they're doing), the remainder of <tt>&amp;load_data</tt>
is exactly as it would have been if we'd written it in Perl 5.
</p><p>We skip to the next file if the current file's version is wrong. Otherwise, we split the costs
line into an array of whitespace-delimited values, and then save everything
(including the still-open filehandle) in a nested hash within <tt>%data</tt>:
<pre>            next if $vers &lt; $version;
            $costs = [split /\s+/, $costs];
            %data{$filepath}{qw(fh name vers stat costs)} =
                          ($fh, $name, $vers, $status, $costs);
            }
        }</pre>
Then, once we've iterated over all the directories in <tt>@dirpath</tt>,
we return the accumulated data:
<pre>        return %data;
    }</pre>


<h3>
<a name="the virtue of constancy"></a>The virtue of constancy</h3>
Perl 6 variables can be used as constants:
<pre>    my @StartOfFile is const = (0,0);</pre>
which is a great way to give logical names to
literal values, but ensure that those named values
aren't accidentally changed in some other part of the code.</p><p>

<h3>
<a name="writing it back"></a>Writing it back</h3>
When the data is eventually saved, we'll be passing it to the
<tt>&amp;save_data</tt>
subroutine in a hash. If we expected the hash to be a real hash variable
(or a reference to one), we'd write:
<pre>    sub save_data (%data) {...</pre>
But since we want to allow for the possibility that the hash is created
on the fly (e.g. from a hash-like list of values), we need to use the slurp-it-all-up
list context asterisk again:
<pre>    sub save_data (*%data) {...</pre>


<h3>
<a name="from each according to its ability ... "></a>From each according
to its ability ...</h3>
We then grab each datum for each file with the usual <tt>foreach ... values ... </tt>
construct:
<pre>        foreach my $data (values %data) {</pre>
and go about saving the data to file.
</p>

<h3>
<a name="your allinone input supplier"></a>Your all-in-one input supplier</h3>
Because the Perl 6 "diamond" operator can take an arbitrary expression
as its argument, it's possible to set a filehandle to read an entire file
<i>and</i> do the actual reading, all in a single statement:
<pre>    my $rest = &lt;$data.{fh}.irs(undef)></pre>
The variable <tt>$data</tt> stores a reference to a hash, so to dereference
it and access the <tt>'fh'</tt> entry, we use the Perl 6 dereferencing
operator (dot) and write: <tt>$data.{fh}</tt>. In practice, we could leave
out the operator and just write <tt>$data{fh}</tt>, since Perl can infer
from the <tt>$</tt> sigil that we're accessing the hash through a reference
held in a scalar. In fact, in Perl 6 the only place you <i>must</i> use
an explicit <tt>.</tt> dereferencer is in a method call. But it never hurts
to say exactly what you mean, and there's certainly no difference in performance
if you do choose to use the dot.
</p><p>The <tt>.irs(undef)</tt> method call then sets the input record separator of the
filehandle (i.e. the Perl 6 equivalent of <tt>$/</tt>) to <tt>undef</tt>,
causing the next read operation to return the remaining contents of the
file. And because the filehandle's <tt>irs</tt> method returns its own
invocant -- i.e. the filehandle reference -- the entire expression can
be used within the angle brackets of the read.
</p><p>A variation on this technique allows a Perl program to do a shell-like
read-from-filename just as easily:
<pre>    my $next_line = &lt;open $filename or die>;</pre>
or, indeed, to read the whole file:
<pre>    my $all_lines = &lt; open $filename : irs=>undef >;</pre>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S03.html">Synopsis 3</a> for the current design information.</p>

<h3>
<a name="seek and ye shall flatten"></a>Seek and ye shall flatten</h3>
Having grabbed the entire file, we now rewind and truncate it, in preparation
for writing it back:
<pre>    seek $data.{fh}: *@StartOfFile;
    truncate $data.{fh}: 0;</pre>
You're probably wondering what's with the asterisk ... unless you've ever
tried to write:
<pre>    seek $filehandle, @where_and_whence;</pre>
in Perl 5 and gotten back the annoying <tt>"Not enough arguments for seek"</tt>
exception. The problem is that <tt>seek</tt> expects three distinct scalars
as arguments (as if it had a Perl 5 prototype of <tt>seek($$$)</tt>), and
it's too fastidious to flatten the proffered array in order to get them.
</p><p>It's handy to wrap the magical <tt>0,0</tt> arguments of the <tt>seek</tt>
in a single array (so we no longer have to remember this particular incantation),
but to use such an array in Perl 5 we would then have to write:
<pre>    seek $data->{fh}, $StartOfFile[0], $StartOfFile[1];    # Perl 5</pre>
In Perl 6 that's not a problem, because we have <tt>*</tt> -- the list
context specifier. When used in an argument list, it takes whatever you
give it (typically an array or hash) and flattens it. So:
<pre>    seek $data.{fh}: *@StartOfFile;                        # Perl 6</pre>
massages the single array into a list of two scalars, as <tt>seek</tt>
requires.
</p><p>Oh, and yes, that <i>is</i> the adverbial colon again. In Perl 6, <tt>seek</tt>
and <tt>truncate</tt> are both methods of filehandle objects. So we can either
call them as:
<pre>
    $data.{fh}.seek(*@StartOfFile);
    $data.{fh}.truncate(0);
</pre>
Or use the "indirect object" syntax:
<pre>
    seek $data.{fh}: *@StartOfFile;
    truncate $data.{fh}: 0;
</pre>
And that's where the colon comes in. Another of its many uses in Perl
6 is to separate "indirect object" arguments (e.g. filehandles) from
the rest of the argument list. The main place you'll see colons guarding indirect objects
is in <tt>print</tt> statements (as described in the next section).</p><p>

<h3>
<a name="it is written..."></a>It is written...</h3>



<p>
Finally, <tt>&amp;save_data</tt> has everything ready and can write the
four fields and the rest of the file back to disk. First, it sets the output
field separator for the filehandle (i.e. the equivalent of Perl 5's
<tt>$,</tt>
variable) to inject newlines between elements:
<pre>    $data.{fh}.ofs("\n");</pre>
Then it prints the fields to the filehandle:
<pre>    print $data.{fh}: $data.{qw(name vers stat)}, _@{$data.{costs}}, $rest;</pre>
</p><p>Note the use of the adverbial colon after <code>$data.{fh}</code> to separate the
filehandle argument from the items to be printed. The colon is required
because it's how Perl 6 eliminates the nasty ambiguity inherent in the
"indirect object" syntax. In Perl 5, something like:</p>
<pre>
    print foo bar;</pre>
</p><p>could conceivably mean:</p>
<pre>
    print {foo} (bar);    # Perl 5: print result of bar() to filehandle foo</pre>
</p><p>or</p>
<pre>
    print ( foo(bar) );   # Perl 5: print foo() of bar() to default filehandle</pre>
</p><p>or even:</p>
<pre>
    print ( bar-&gt;foo );   # Perl 5: call method foo() on object returned by
                          #         bar() and print result to default filehandle</pre>
</p><p>In Perl 6, there is no confusion, because each indirect object must
followed by a colon. So in Perl 6:</p>
<pre>
    print foo bar;</pre>
</p><p>can only mean:</p>
<pre>
    print ( foo(bar) );   # Perl 6: print foo() of bar() to default filehandle</pre>
</p><p>and to get the other two meanings we'd have to write:</p>
<pre>
    print foo: bar;       # Perl 6: print result of bar() to filehandle foo()
                          #         (foo() not foo, since there are no
                          #          bareword filehandles in Perl 6)</pre>
</p><p>and:</p>
<pre>
    print foo bar: ;      # Perl 6: call method foo() on object returned by
                          #         bar() and print result to default filehandle</pre>
</p><p>In fact, the colon has an even wider range of use, as a general-purpose
"adverb marker"; a notion we will explore more fully
<a href="#would you like an adverb with that">below</a>.</p>
</p>

<h3>
<a name="string 'em up together"></a>String 'em up together</h3>



<p>
The printed arguments are: a hash slice:
<pre>    $data.{qw(name vers stat)},</pre>
a stringified dereferenced nested array:
<pre>     _@{$data.{costs}},</pre>
and a scalar:
<pre>    $rest;</pre>
The new hash slice syntax was explained in the previous Apocalypse/Exegesis,
and the scalar is just a scalar, but what was the middle thing again?
</p><p>Well, <tt>$data.{costs}</tt> is just a regular Perl 6 access to the
<tt>'costs'</tt>
entry of the hash referred to by <tt>$data</tt>. That entry contains the
array reference that was the result of splitting <tt>$cost</tt>
<a href="/pub/a/2001/10/03/exegesis3.html?page=3#and now for something completely the same (well, almost)">in
<tt>&amp;load_data</tt></a>.
</p><p>So to get the actual array itself, we can prefix the array reference
with a <tt>@</tt> sigil (though, technically, we don't <i>have</i> to:
in Perl 6 arrays and array references are interchangeable in scalar
context).
</p><p>That gives us <tt>@{$data.{costs}}</tt>. The only remaining difficulty 
is that when we print the list of items produced by <tt>@{$data.{costs}}</tt>,
they are subject to the output field separator. Which we just set to newline.
</p><p>But what we want is for them to appear on the <i>same</i> line, with
a space between each.
</p><p>Well ... evaluating a list in a string context does precisely that, so
we could just write:
<pre>    "@{$data.{costs}}"    # evaluate array in string context</pre>
But Perl 6 has another alternative to offer us -- the unary underscore
operator. Binary underscore is <a href="/pub/a/2001/10/03/exegesis3.html?page=2#(pre)fixing those filenames">string
concatenation</a>, so it shouldn't be too surprising that unary underscore
is the stringification operator (think: concatenation with a null string).
Prefixing any expression with an underscore forces it to be evaluated in
string context:
<pre>    _@{$data{costs}}     # evaluate array in string context</pre>
Which, in this case, conveniently inserts the required spaces between the
elements of the costs array.
</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S03.html">Synopsis 3</a> for the current design information.</p>

<h3>
<a name="a parameter by any other name"></a>A parameter by any other name</h3>
Now that the I/O is organized, we can get down to the actual processing.
First, we load the data:
<pre>    my %data = load_data(filename=>'weblog', version=>1);</pre>
Note that we're using named arguments here. This attempt would blow up
badly in Perl 5, because we didn't set <tt>&amp;load_data</tt> up to expect
a hash-like list of arguments. But it works fine in Perl 6 for two reasons:
<ol>
<li>
Because we <i>did</i> set up <tt>&amp;load_data</tt> with named parameters;
and</li>

<li>
Because the <tt>=></tt> operator isn't in Kansas anymore.</li>
</ol>
In Perl 5, <tt>=></tt> is just an up-market comma with a single minor
talent: It stringifies its left operand if that operand is a bareword.
</p><p>In Perl 6, <tt>=></tt> is a fully-fledged anonymous object constructor
-- like <tt>[...]</tt> and <tt>{...}</tt>. The objects it constructs are
called "pairs" and they consist of a key (the left operand of the <tt>=></tt>),
and a value (the right operand). The key is still stringified if it's a
valid identifier, but both the key and the value can be <i>any</i> kind of Perl
data structure. They are accessed via the pair object's <tt>key</tt> and <tt>value</tt>
methods:
<pre>    my $pair_ref = [1..9] => "digit";</pre>

<pre>    print $pair_ref.value;      # prints "digit"
    print $pair_ref.key.[3];    # prints 4</pre>
So, rather than getting four arguments:
<pre>    load_data('filename', 'weblog', 'version', 1);    # Perl 5 semantics</pre>
<tt>&amp;load_data</tt> gets just two arguments, each of which is a reference
to a pair:
<pre>    load_data( $pair_ref1, $pair_ref2);               # Perl 6 semantics</pre>
When the subroutine dispatch mechanism detects one or more pairs as arguments
to a subroutine with named parameters, it examines the keys of the pairs
and binds their values to the correspondingly named parameters -- no matter
what order the paired arguments originally appeared in. Any remaining non-pair
arguments are then bound to the remaining parameters in left-to-right order.
</p><p>So we could call <tt>&amp;load_data</tt> in any of the following ways:
<pre>    load_data(filename=>'weblog', version=>1);  # named</pre>

<pre>    load_data(version=>1, filename=>'weblog');  # named (order doesn't matter)</pre>

<pre>    load_data('weblog', 1);                     # positional (order matters)</pre>
There are numerous other uses for pairs, one of which we'll see <a href="/pub/a/2001/10/03/exegesis3.html?page=6#schwartzian pairs">shortly</a>.
</p><p>

<h3>
<a name="please queue for processing"></a>Please queue for processing</h3>
Having loaded the data, we go into a loop and iterate over each file's
information. First, we announce the file and its internal name:
<pre>    foreach my $file (keys %data) {
        print "$file contains data on %data{$file}{name}\n";</pre>


<h3>
<a name="the xortwist"></a>The Xor-twist</h3>
Then we toggle the "is active" status bit (the eighth bit) for each file.
To flip that single bit without changing any of the other status bits,
we bitwise-xor the status bitset against the bitstring
<tt>0000000010000000</tt>.
Each bit xor'd against a zero stays as it is (0&nbsp;xor&nbsp;0&nbsp;-->&nbsp;0; 1&nbsp;xor&nbsp;0&nbsp;-->&nbsp;1),
while xor'ing the eighth bit against 1 complements it (0&nbsp;xor&nbsp;1&nbsp;-->&nbsp;1; 1&nbsp;xor&nbsp;1&nbsp;-->&nbsp;0).
</p><p>But because the caret has been appropriated as the Perl 6
<a href="/pub/a/2001/10/03/exegesis3.html?page=2#substitute our vector, victor!">hyper-operator
prefix</a>, it will no longer be used as bitwise xor. Instead, binary tilde
will be used:
<pre>    %data{$file}{stat} = %data{$file}{stat} ~ $is_active_bit;</pre>
This is actually an improvement in syntactic consistency since bitwise xor (now binary <tt>~</tt>)
and bitwise complement (still unary <tt>~</tt>) are mathematically related:
<tt>~x</tt>
is <tt>(-1~x)</tt>.
</p><p>Note that we <i>could</i> have used the assignment variant of binary
<tt>~</tt>:
<pre>    %data{$file}{stat} ~= $is_active_bit;     # flip only bit 8 of status bitset</pre>
but that's probably best avoided due to its confusability with the much
commoner "pattern association" operator:
<pre>    %data{$file}{stat} =~ $is_active_bit;     # match if status bitset is "128"</pre>
By the way, there is also a high precedence logical xor operator in
Perl 6. You guessed it: <tt>~~</tt>. This finally fills the strange
gap in Perl's logical operator set:
<pre>
        Binary (low) | Binary (high) |    Bitwise
       ______________|_______________|_____________
                     |               |
            or       |      ||       |      |
                     |               |
            and      |      &&       |      &
                     |               |
            xor      |      ~~       |      ~
                     |               |
</pre>
</p><p>And it will also help to reduce programmer
stress by allowing us to write:
<pre>    $make = $money ~~ $fast;</pre>
instead of (the clearly over-excited):
<pre>    $make = !$money != !$fast;</pre>


<h3>
<a name="bound for glory"></a>Bound for glory</h3>
In both Perl 5 and 6, it's possible to create an <i>alias</i> for a
variable. For example, the subroutine:
<pre>    sub increment { $_[0]++ }           # Perl 5
    sub increment { @_[0]++ }           # Perl 6</pre>
works because the elements of <tt>@_</tt> become aliases for whatever variable
is passed as their corresponding argument. Similarly, one can use a
<tt>for</tt>
to implement a Pascal-ish <tt>with</tt>:
<pre>    for my $age ( $person[$n]{data}{personal}{time_dependent}{age} ) {
        if    ($age &lt; 12) { print "Child" }
        elsif ($age &lt; 18) { print "Adolescent" }
        elsif ($age &lt; 25) { print "Junior citizen" }
        elsif ($age &lt; 65) { print "Citizen" }
        else              { print "Senior citizen" }
    }</pre>
Perl 6 provides a more direct mechanism for aliasing one variable
to another in this way: the <tt>:=</tt> (or "binding") operator. For
example, we could rewrite the previous example like so in Perl 6:
<pre>    my $age := $person[$n]{data}{personal}{time_dependent}{age};</pre>

<pre>    if    ($age &lt; 12) { print "Child" }
    elsif ($age &lt; 18) { print "Adolescent" }
    elsif ($age &lt; 25) { print "Junior citizen" }
    elsif ($age &lt; 65) { print "Citizen" }
    else              { print "Senior citizen" }</pre>
Bound aliases are particularly useful for temporarily giving a conveniently short 
identifier to a variable with a long or complex name. Scalars,
arrays, hashes and even subroutines may all be given less sequipedalian
names in this way:
<pre>        my   @list := @They::never::would::be::missed::No_never_would_be_missed;
        our  %plan := %{$planning.[$planner].{planned}.[$planet]};
        temp &amp;rule := &amp;FulfilMyGrandMegalomanicalDestinyBwahHaHaHaaaa;</pre>
In our example program, we use aliasing to avoid having to write <tt>@%data{$file}{costs}</tt>
everywhere:
<pre>    my @costs := @%data{$file}{costs};</pre>
An important feature of the binding operator is that the lvalue (or lvalues)
on the left side form a context specification for the rvalue (or rvalues)
on the right side. It's as if the lvalues were the parameters of an invisible
subroutine, and the rvalues were the corresponding arguments being passed
to it. So, for example, we could also have written:
<pre>    my @costs := %data{$file}{costs};</pre>
(i.e. without the <tt>@</tt> dereferencer) because the lvalue <i>expects</i>
an array as the corresponding rvalue, so Perl 6 automatically dereferences
the array reference in <tt>%data{$file}{costs}</tt> to provide that.
</p><p>More interestingly, if we have both lvalue and rvalue lists, then each
of the rvalues is evaluated in the context specified by its corresponding
lvalue. For example:
<pre>    (@x, @y) := (@a, @b);</pre>
aliases <tt>@x</tt> to <tt>@a</tt>, and <tt>@y</tt> to <tt>@b</tt>, because
<tt>@</tt>'s
on the left act like <tt>@</tt> parameters, which require -- and bind to
-- an unflattened array as their corresponding argument. Likewise:
<pre>    ($x, %y, @z) := (1, {b=>2}, %c{list});</pre>
binds <tt>$x</tt> to the value <tt>1</tt> (i.e. <tt>$x</tt> becomes a constant),
<tt>%y</tt>
to the anonymous hash constructed by <tt>{b=>2}</tt>, and <tt>@z</tt> to
the array referred to by <tt>%c{list}</tt>. In other words,
it's the same set of bindings we'd see if we wrote:
<pre>    sub foo($x, %y, @z) {...}</pre>

<pre>    foo(1, {b=>2}, %c{list});</pre>
except that the <tt>:=</tt> binding takes effect in the current scope.
</p><p>And because <tt>:=</tt> works that way, we can also use the flattening
operator (unary <tt>*</tt>) on either side of such bindings. For example:
<pre>    (@x, *@y) := (@a, $b, @c, %d);</pre>
aliases <tt>@x</tt> to <tt>@a</tt>, and causes <tt>@y</tt> to bind to the
remainder of the lvalues -- by flattening out <tt>$b</tt>, <tt>@c</tt>,
and <tt>%d</tt> into a list and then slurping up all their components together.
</p><p>Note that <tt>@y</tt> is still an <i>alias</i> for those various slurped components.
So
<tt>@y[0]</tt> is an alias for <tt>$b</tt>, <tt>@y[1..@c.length]</tt> are aliases
for the elements of <tt>@c</tt>, and the remaining elements of <tt>@y</tt>
are aliases for the interlaced keys and values of <tt>%d</tt>.
</p><p>When the star is on the other side of the binding, as in:
<pre>    ($x, $y) := (*@a);</pre>
then <tt>@a</tt> is flattened before it is bound, so <tt>$x</tt> becomes
an alias for <tt>@a[0]</tt> and <tt>$y</tt> becomes an alias for <tt>@a[1]</tt>.
</p><p>The binding operator will have many uses in Perl 6 (most of which we
probably haven't even thought of yet), but one of the commonest will almost
certainly be as an easy way to swap two arrays efficiently:
<pre>    (@x, @y) := (@y, @x);</pre>
Yet another way to think about the binding operator is to consider it as a
sanitized version of those dreaded Perl 5 typeglob assignments. That is:
<pre>    $age := $person[$n]{data}{personal}{time_dependent}{age};</pre>
is the same as Perl 5's:
<pre>    *age = \$person->[$n]{data}{personal}{time_dependent}{age};</pre>
except that it also works if <tt>$age</tt> is declared as a lexical.
</p><p>Oh, and binding is much safer than typeglobbing was, because it explicitly
requires that <tt>$person[$n]{data}{personal}{time_dependent}{age}</tt>
evaluate to a scalar, whereas the Perl 5 typeglob version would happily
(and silently!) replace <tt>@age</tt>, <tt>%age</tt>, or even <tt>&amp;age</tt>
if the rvalue happened to produce a reference to an array, hash, or subroutine
instead of a scalar.
</p><p>












<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S03.html">Synopsis 3</a> for the current design information.</p>

<h3>
<a name="better living through sigils"></a>Better living through sigils</h3>
We should also note that the binding of the <tt>@costs</tt> array:
<pre>    my @costs := @%data{$file}{costs};</pre>
shows yet another case where Perl 6's sigil semantics are much DWIM-mier
than those of Perl 5.
</p><p>In Perl 5 we would probably have written that as:
<pre>        local *costs = \ @$data{$file}{costs};</pre>
and then spent some considerable time puzzling out why it wasn't working,
before realising that we'd actually meant:
<pre>        local *costs = \ @{$data{$file}{costs}};</pre>
instead.
</p><p>That's because, in Perl 5, the precedence of a hash key is relatively
low, so:
<pre>    @$data{$file}{costs}    # means: @{$data}{$file}{costs}
                            # i.e. (invalid attempt to) access the 'costs'
                            # key of a one-element slice of the hash
                            # referred to by $data
                            # problem is: slices don't have hash keys</pre>
whereas:
<pre>    @{$data{$file}{costs}}  # means: @{ $data{$file}{costs} }
                            # i.e. dereference of array referred to by
                            # $data{$file}{costs}</pre>
The problem simply doesn't arise in Perl 6, where the two would be written
quite distinctly, as:
<pre>    %data{@($file)}{costs}  # means: (%data{@($file)}).{costs}
                            # (still an error in Perl 6)</pre>
and:
<pre>    @%data{$file}{costs}    # means: @{ %data{$file}{costs} }
                            # i.e. dereference of array referred to by
                            # %data{$file}{costs}</pre>
respectively.
</p><p>

<h3>
<a name="that's not a number...now that's a number!"></a>That's not a number...now
<i>that's</i>
a number!</h3>



<p>
One of the perennial problems with Perl 5 is how to read in a number. Or
rather, how to read in a string...and then be sure that it contains a valid
number. Currently, most people read in the string and then either just
assume it's a number (optimism) or use the regexes found in
<a href="http://search.cpan.org/doc/JHI/perl-5.7.2/pod/perlfaq4.pod#How_do_I_determine_whether_a_scalar_is_a_number_whole_integer_float_">perlfaq4</a>
or <a href="http://search.cpan.org/doc/DCONWAY/Regexp-Common-0.01/lib/Regexp/Common.pm">Regexp::Common</a>
to make sure (cynicism).
</p><p>Perl 6 offers a simpler, built-in mechanism.
</p><p>Just as the unary version of binary underscore (<tt>_</tt>) is Perl
6's explicit stringification specifier, so to the unary version of binary
plus is Perl 6's explicit numerifier. That is, prefixing an expression
with unary <tt>+</tt> evaluates that expression in a numeric context. Furthermore,
if the expression has to be coerced from a string and the string does not
begin with a valid number, the stringification operator returns <tt>NaN</tt>,
the not-a-number value.
</p><p>That makes it particularly easy to read in numeric data reliably:
<pre>    my $inflation;
    print "Inflation rate: " and $inflation = +&lt;>
        until $inflation != NaN;</pre>
The unary <tt>+</tt> takes the string returned by <tt>&lt;></tt> and converts
it to a number. Or, if the string can't be interpreted as a number, <tt>+</tt>
returns
<tt>NaN</tt>. Then we just go back and try again until we do get
a valid number.
</p><p>Note that these new semantics for unary <tt>+</tt> are a little different
from its role in Perl 5, where it is just the identity operator. In Perl
5 it's occasionally used to disambiguate constructs like:
<pre>    print  ($x + $y) * $z;        # in Perl 5 means: ( print($x+$y) ) * $z;
    print +($x + $y) * $z;        # in Perl 5 means: print( ($x+$y) * $z );</pre>
To get the same effect in Perl 6, we'd use the <a href="/pub/a/2001/10/03/exegesis3.html?page=4#it is written...">adverbial colon</a> instead:
<pre>    print   ($x + $y) * $z;        # in Perl 6 means: ( print($x+$y) ) * $z;
    print : ($x + $y) * $z;        # in Perl 6 means: print( ($x+$y) * $z );</pre>


<h3>
<a name="schwartzian pairs"></a>Schwartzian pairs</h3>
Another handy use for <a href="/pub/a/2001/10/03/exegesis3.html?page=5#a parameter by any other name">pairs</a>
is as a natural data structure for implementing
the Schwartzian Transform. This caching technique is used when sorting
a large list of values according to some expensive function on those values.
Rather than writing:
<pre>    my @sorted = sort { expensive($a) &lt;=> expensive($b) } @unsorted;</pre>
and recomputing the same expensive function every time each value is compared
during the sort, we can precompute the function on each value once. We
then pass both the original value and its computed value to <tt>sort</tt>,
use the computed value as the key on which to sort the list, but then return
the original value as the result. Like this:
<pre>    my @sorted =                        # step 4: store sorted originals
        map  { $_.[0] }                 # step 3: extract original
        sort { $a.[1] &lt;=> $b.[1] }      # step 2: sort on computed
        map  { [$_, expensive($_) ] }   # step 1: cache original and computed
            @unsorted;                  # step 0: take originals</pre>
The use of arrays can make such transforms hard to read (and to maintain), so people sometimes
use hashes instead:
<pre>    my @sorted =                        
        map  { $_.{original} }             
        sort { $a.{computed} &lt;=> $b.{computed} } 
        map  { {original=>$_, computed=>expensive($_)} }   
            @unsorted;</pre>
That improves the readability, but at the expense of performance. Pairs
are an ideal way to get the readability of hashes but with (probably) even
better performance than arrays:
<pre>    my @sorted =                        
        map  { $_.value }             
        sort { $a.key &lt;=> $b.key }  
        map  { expensive($_) => $_ }     
            @unsorted;</pre>
Or in the case of our example program:
<pre>    @costs = map  { $_.value }
             sort { $a.key &lt;=> $b.key }
             map  { amortize($_) => $_ }
                 @costs ^* $inflation;</pre>
Note that we also used a hyper-multiplication (<tt>^*</tt>) to multiply
each cost individually by the rate of inflation before sorting them. That's
equivalent to writing:
<pre>    @costs = map  { $_.value }
             sort { $a.key &lt;=> $b.key }
             map  { amortize($_) => $_ }
             map  { $_ * $inflation }
                 @costs;</pre>
but spares us from the burden of yet another <tt>map</tt>.
</p><p>More importantly, because <tt>@costs</tt> is an <a href="/pub/a/2001/10/03/exegesis3.html?page=5#bound for glory">alias</a>
for <tt>@%data{$file}{costs}</tt>, when we assign the sorted list back
to
<tt>@costs</tt>, we're actually assigning it back into the appropriate
sub-entry of <tt>%data</tt>.
</p><p>

<h3>
<a name="the sum of all our fears"></a>The &sum; of all our fears</h3>
Perl 6 will probably have a built-in <tt>sum</tt> operator, but we might
still prefer to build our own for a couple of reasons. Firstly <tt>sum</tt>
is obviously far too long a name for so fundamental an operation; it really
should be <tt>&sum;</tt>. Secondly, we may want to extend the basic summation
functionality somehow. For instance, by allowing the user to specify a
filter and only summing those arguments that the filter lets through.
</p><p>Perl 6 allows us to create our own operators. Their names can be any
combination of characters from the Unicode set. So it's relatively easy
to build ourselves a <tt>&sum;</tt> operator:
<pre>    my sub operator:&sum; is prec(\&amp;operator:+($)) (*@list) {
        reduce {$^a+$^b} @list;
    }</pre>
We declare the <tt>&sum;</tt> operator as a lexically scoped subroutine.
The lexical scoping eases the syntactic burden on the parser, the semantic
burden on other unrelated parts of the code, and the cognitive burden on
the programmer.
</p><p>The operator subroutine's name is always
<tt>operator:whatever_symbols_we_want</tt>.
In this case, that's
<tt>operator:&sum;</tt>, but it can be any sequence
of Unicode characters, including alphanumerics:
<pre>        my sub operator:*#@&amp; is prec(\&amp;operator:\)  (STR $x) {
                return "darn $x";
        }</pre>

<pre>        my sub operator:&dagger; is prec(\&amp;CORE::kill)  (*@tIHoH) {
                kill(9, @tIHoH) == @tIHoH or die "batlhHa'";
                return "Qapla!";
        }</pre>

<pre>        my sub operator:EQ is prec(\&amp;operator:eq)  ($a, $b) {
                return $a eq $b                 # stringishly equal strings
                    || $a == $b != NaN;         # numerically equal numbers
        }</pre>
<pre>
        # and then:</pre>
<pre>
        warn *#@&amp; &quot;QeH!&quot; unless E&lt;dagger&gt; $puq EQ &quot;Qapla!&quot;;</pre>
</p><p>Did you notice that cunning <code>$a == $b != NaN</code> test in <code>operator:EQ</code>?
This lovely Perl 6 idiom solves the problem of numerical comparisons
between non-numeric strings.</p>
</p><p>In Perl 5, a comparison like:</p>
<pre>
        $a = &quot;a string&quot;;
        $b = &quot;another string&quot;;
        print &quot;huh?&quot; if $a == $b;</pre>
</p><p>will unexpectedly succeed (and silently too, if you run without
warnings), because the non-numeric values of both the scalars are converted to zero in
the numeric context of the <code>==</code>.</p>
</p><p>But in Perl 6, non-numeric strings numerify to <code>NaN</code>. So, using Perl
6's multiway comparison feature, we can add an
extra <code>!= NaN</code> to the equality test to ensure that we compared genuine
numbers.</p>
</p><p>Meanwhile, we also have to specify a precedence for each new operator we
define. We do that with the <tt>is prec</tt> trait of the subroutine. The precedence is specified
in terms of the precedence of some existing operator; in this case, in
terms of Perl's built-in unary <tt>+</tt>:
<pre>    my sub operator:&sum; is prec( \&amp;operator:+($) )</pre>
To do this, we give the <tt>is prec</tt> trait a reference to teh existing operator.
Note that, because there are two overloaded forms of <tt>operator:+</tt>
(unary and binary) of different precedences, to get the reference to the
correct one we need to specify its complete <i>signature</i> (its name
and parameter types) as part of the enreferencing operation. The ability
to take references to signatures is a standard feature in Perl 6,
since ordinary subroutines can also be overloaded, and may need the same
kind of disambiguation when enreferenced.
</p><p>If the operator had been binary, we might also have had to specify its
associativity (<tt>left</tt>, <tt>right</tt>, or <tt>non</tt>), using the
<tt>is
assoc</tt> trait.
</p><p>Note too that we specified the parameter of <tt>operator:&sum;</tt> with
a flattening asterisk, since we want <tt>@list</tt> to slurp up any series
of values passed to it, rather than being restricted to accepting only
actual array variables as arguments.
</p><p>The implementation of <tt>operator:&sum;</tt> is very simple: we just
apply the built-in <tt>reduce</tt> function to the list, reducing each
successive pair of elements by adding them.
</p><p>Note that we used a higher-order function to specify the addition operation.
Larry has decided that the syntax for higher-order functions requires that
implicit parameters be specified with a <tt>$^</tt> sigil (or <tt>@^</tt>
or <tt>%^</tt>, as appropriate) and that the whole expression be enclosed
in braces.
</p><p>So now we have a <tt>&sum;</tt> operator:
<pre>    $result = &sum; $wins, $losses, $ties;</pre>
but it doesn't yet provide a way to filter its values. Normally, that would
present a difficulty with an operator like <tt>&sum;</tt>, whose
<tt>*@list</tt>
argument will gobble up every argument we give it, leaving no way -- except
convention -- to distinguish the filter from the data.
</p><p>But Perl 6 allows any subroutine -- not just built-ins like <tt><a href="/pub/a/2001/10/03/exegesis3.html?page=4#it is written...">print</a></tt>
-- to take one or more "adverbs" in addition to its normal arguments.
This provides a second channel by which to transmit information to a subroutine.
Typically that information will be used to modify the behaviour of the
subroutine (hence the name "adverb"). And that's exactly what we need
in order to pass a filter to <tt>&sum;</tt>.
</p><p>A subroutine's adverbs are specified as part of its normal parameter
list, but separated from its regular parameters by a colon:
<pre>    my sub operator:&sum; is prec(\&amp;operator:+($)) ( *@list : $filter //= undef) {...</pre>
This specifies that <tt>operator:&sum;</tt> can take a single scalar adverb,
which is bound to the parameter <tt>$filter</tt>. When there is no adverb
specified in the call, <tt>$filter</tt> is default-assigned the value <tt>undef</tt>.
</p><p>We then modify the body of the subroutine to pre-filter the list through
a <tt>grep</tt>, but only if a filter is provided:
<pre>        reduce {$^a+$^b}  ($filter ?? grep &amp;$filter, @list :: @list);
    }</pre>
The <tt>??</tt> and <tt>::</tt> are the new way we write the old <tt>?:</tt>
ternary operator in Perl 6. Larry had to change the spelling because he
needed the single colon for marking adverbs. But it's a change for the
better anyway --it was rather odd that all the other short-circuiting logical
operators (<tt>&amp;&amp;</tt> and <tt>||</tt> and <tt>//</tt>) used doubled
symbols, but the conditional operator didn't. Well, now it does. The doubling
also helps it stand out better in code, in part because it forces you to
put space around the <tt>::</tt> so that it's not confused with a package
name separator.
</p><p>You might also be wondering about the ambiguity of <tt>??</tt>, which
in Perl 5 already represents an empty regular expression with question-mark
delimiters. Fortunately, Perl 6 won't be riddled with the nasty <tt>?...?</tt>
regex construct, so there's no ambiguity at all.
</p><p>Adverbial semantics can be defined for <i>any</i> Perl 6 subroutine.
For example:
<pre>    sub mean (*@values : $type //= 'arithmetic') {
        given ($type) {
            when 'arithmetic': { return sum(@values) / @values; }
            when 'geometric':  { return product(@values) ** (1/@values) }
            when 'harmonic':   { return @values / sum( @values ^** -1 ) }
            when 'quadratic':  { return (sum(@values ^** 2) / @values) ** 0.5 }
        }
        croak "Unknown type of mean: '$type'";
    }</pre>
Adverbs will probably become widely used for passing this type of "out-of-band"
behavioural modifier to subroutines that take an unspecified number of
data arguments.
</p>













<p><em>Editor's note: this document is out of date and remains here for historic interest.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S03.html">Synopsis 3</a> for the current design information.</p>

<h3>
<a name="would you like an adverb with that"></a>Would you like an adverb
with that?</h3>
OK, so now our <tt>&sum;</tt> operator can take a modifying filter. How
exactly do we pass that filter to it?
</p><p>As described <a href="/pub/a/2001/10/03/exegesis3.html?page=4#it is written...">earlier</a>, the colon is used
to introduce adverbial arguments into the argument list of a subroutine
or operator. So to do a normal summation we write:
<pre>    $sum = &sum; @costs;</pre>
whilst to do a filtered summation we place the filter after a colon at
the end of the regular argument list:
<pre>    $sum = &sum; @costs : sub {$_ >= 1000};</pre>
or, more elegantly, using a higher-order function:
<pre>    $sum = &sum; @costs : {$^_ >= 1000};</pre>
Any arguments after the colon are bound to the parameters specified
by the subroutine's adverbial parameter list.
</p><p>Note that the example also demonstrates that we can interpolate the
results of the various summations directly into output strings. We do this
using Perl 6's scalar interpolation mechanism (<tt>$(...)</tt>), like so:
<pre>    print "Total expenditure: $( &sum; @costs )\n";
    print "Major expenditure: $( &sum; @costs : {$^_ >= 1000} )\n";
    print "Minor expenditure: $( &sum; @costs : {$^_ &lt; 1000} )\n";</pre>


<h3>
<a name="the odd lazy step"></a>The odd lazy step</h3>


<p>
Finally (and only because we <i>can</i>), we print out a list of every
second element of <tt>@costs</tt>. There are numerous ways to do that in
Perl 6, but the cutest is to use a lazy, infinite, stepped list of indices
in a regular slicing operation.
</p><p>In Perl 6, any list of values created with the <tt>..</tt> operator
is created lazily. That is, the <tt>..</tt> operator doesn't actually build
a list of all the values in the specified range, it creates an array object
that knows the boundaries of the range and can interpolate (and then cache)
any given value when it's actually needed. That's useful, because
it greatly speeds up the creation of a list like <tt>(1..Inf)</tt>.
</p><p><tt>Inf</tt> is Perl 6's standard numerical infinity value, so a list
that runs to <tt>Inf</tt> takes ... well ... forever to actually build. But
writing
<tt>1..Inf</tt> is OK in Perl 6, since the elements of the resulting
list are only ever computed on demand. Of course, if you were to
<tt>print(1..Inf)</tt>,
you'd have plenty of time to go and get a cup of coffee. And even then
(given the comparatively imminent heat death of the universe) that coffee
would be <i>really</i> cold before the output was complete.
So there will probably be a warning when you try to do that.
</p><p>But to get an infinite list of odd indices, we don't want every number
between 1 and infinity; we want every <i>second</i> number. Fortunately,
Perl 6's <tt>..</tt> operator can take an adverb that specifies a "step-size"
between the elements in the resulting list. So if we write <tt>(1..Inf
: 2)</tt>, we get <tt>(1,3,5,7,...)</tt>. Using that list, we can extract
the oddly indexed elements of an array of any size (e.g. <tt>@costs</tt>)
with an ordinary array slice:
<pre>    print @costs[1..Inf:2]</pre>
You might have expected another one of those "maximal-entropy coffee" delays whilst
<tt>print</tt>
patiently outputs the infinite number of <tt>undef</tt>'s that theoretically
exist after <tt>@costs</tt>' last element, but slices involving infinite
lists avoid that problem by returning only those elements that actually
exist in the list being sliced. That is, instead of iterating the requested
indices in a manner analogous to:
<pre>    sub slice is lvalue (@array, *@wanted_indices) {
        my @slice;
        foreach $wanted_index ( @wanted_indices ) {
            @slice[+@slice] := @array[$wanted_index];
        }
        return @slice;
    }</pre>
infinite slices iterate the available indices:
<pre>    sub slice is lvalue (@array, *@wanted_indices) {
        my @slice;
        foreach $actual_index ( 0..@array.last ) {
            @slice[+@slice] := @array[$actual_index]
                if any(@wanted_indices) == $actual_index;
        }
        return @slice;
    }</pre>
(Obviously, it's actually far more complicated -- and lazy -- than that.
It has to preserve the original ordering of the wanted indexes, as well
as cope with complex cases like infinite slices of infinite lists. But
from the programmer's point of view, it all just DWYMs).
</p><p>By the way, binding selected array elements to the elements of another
array (as in: <tt>@slice[+@slice] := @array[$actual_index]</tt>), and then
returning the bound array as an lvalue, is a neat Perl 6 idiom for
recreating any kind of slice-like semantics with user-defined subroutines.
</p><p>

<h3>
<a name="take that! and that!"></a>Take that! And that!</h3>
And so, lastly, we save the data back to disk:
<pre>    save_data(%data, log => {name=>'metalog', vers=>1, costs=>[], stat=>0});</pre>
Note that we're passing in both a hash and a pair, but that these still
get correctly folded into <tt>&amp;save_data</tt>'s single hash parameter,
courtesy of the flattening asterisk on the parameter definition:
<pre>    sub save_data (*%data) {...</pre>


<h3>
<a name="in a nutshell..."></a>In a nutshell...</h3>
It's okay if your head is spinning at this point.
</p><p>We just crammed a huge number of syntactic and semantic changes into
a comparatively small piece of example code. The changes may seem overwhelming,
but that's because we've been concentrating on <i>only</i> the changes.
Most of the syntax and semantics of Perl's operators don't change at
all in Perl 6.
</p><p>So, to conclude, here's a summary of what's new, what's
different, and (most of all) what stays the same.
<h4>
<a name="unchanged operators"></a>Unchanged operators</h4>

<ul>
<li>
prefix and postfix <tt>++</tt> and <tt>--</tt></li>

<li>
unary <tt>!</tt>, <tt>~</tt>, <tt>\</tt>, and <tt>-</tt></li>

<li>
binary <tt>**</tt></li>

<li>
binary <tt>=~</tt> and <tt>!~</tt></li>

<li>
binary <tt>*</tt>, <tt>/</tt>, and <tt>%</tt></li>

<li>
binary <tt>+</tt> and <tt>-</tt></li>

<li>
binary <tt>&lt;&lt;</tt> and <tt>>></tt></li>

<li>
binary <tt>&amp;</tt> and <tt>|</tt></li>

<li>
binary <tt>=</tt>, <tt>+=</tt>, <tt>-=</tt>, <tt>*=</tt>, etc.</li>

<li>
binary <tt>,</tt></li>

<li>
unary <tt>not</tt></li>

<li>
binary <tt>and</tt>, <tt>or</tt>, and <tt>xor</tt></li>
</ul>

<h4>
<a name="changes to existing operators"></a>Changes to existing operators</h4>

<ul>
<li>
binary <tt>-></tt> (dereference) becomes <tt>.</tt></li>

<li>
binary <tt>.</tt> (concatenate) becomes <tt>_</tt></li>

<li>
unary <tt>+</tt> (identity) now enforces numeric context on
its argument</li>

<li>
binary <tt>^</tt> (bitwise xor) becomes <tt>~</tt></li>

<li>
binary <tt>=></tt> becomes the "pair" constructor</li>

<li>
ternary <tt>? :</tt> bbeeccoommeess <tt>?? ::</tt></li>
</ul>

<h4>
<a name="enhancements to existing operators"></a>Enhancements to existing
operators</h4>

<ul>
<li>
binary <tt>..</tt> becomes even lazier</li>

<li>
binary <tt>&lt;</tt>, <tt>></tt>, <tt>lt</tt>, <tt>gt</tt>, <tt>==</tt>,
<tt>!=</tt>,
etc. become chainable</li>

<li>
Unary <tt>-r</tt>, <tt>-w</tt>, <tt>-x</tt>, etc. are nestable</li>

<li>
The <tt>&lt;></tt> input operator are more context-aware</li>

<li>
The logical <tt>&amp;&amp;</tt> and <tt>||</tt> operators propagate
their context to <i>both</i> their operands</li>

<li>
The <tt>x</tt> repetition operator no longer requires listifying parentheses
on its left argument in a list context.</li>
</ul>

<h4>
<a name="new operators:"></a>New operators:</h4>

<ul>
<li>
unary <tt>_</tt> is the explicit string context enforcer</li>

<li>
binary <tt>~~</tt> is high-precedence logical xor</li>

<li>
unary <tt>*</tt> is a list context specifier for parameters and a
array flattening operator for arguments</li>

<li>
unary <tt>^</tt> is a meta-operator for specifying vector operations</li>

<li>
unary <tt>:=</tt> is used to create aliased variables (a.k.a. binding)</li>

<li>
unary <tt>//</tt> is the logical 'default' operator</li>
</ul>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1608" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/10/02/apocalypse3.html" rel="bookmark">Apocalypse 3</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Larry Wall</span> on <abbr class="published" title="2001-10-02T00:00:00-08:00">October  2, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            

<p><em>Editor's Note: this Apocalypse is out of date and remains here for historic reasons.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S03.html">Synopsis 03</a> for the latest information.</em></p>

<!-- INDEX BEGIN -->
<table width="150" border="0" cellspacing="0" cellpadding="4" align="right">
<tr> 
<td width="150" valign="top" height="4" bgcolor="#6699cc"></td></tr> 
<tr>
<td bgcolor="#efefef">
<p class="headline" align="center">Table of Contents
</p>
<p class="smalltext">

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=2#rfc 025: operators: multiway comparisons">RFC 025: Operators: Multiway comparisons</a><br /><br />
&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=2#rfc 320: allow grouping of x file tests and add filetest builtin">RFC 320: Allow grouping of -X file tests and add <code>filetest</code> builtin</a><br /><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=2#rfc 290: better english names for x">RFC 290: Better english names for -X</a><br /><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=3#rfc 283: tr/// in array context should return a histogram">RFC 283: <code>tr///</code> in array context should return a histogram</a><br /><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=3#rfc 084: replace => (stringifying comma) with => (pair constructor)">RFC 084: Replace <code>=&gt;</code> (stringifying comma) with <code>=&gt;</code> (pair constructor)</a><br /><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=3#rfc 081: lazily evaluated list generation functions">RFC 081: Lazily evaluated list generation functions</a><br /><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=4#rfc 285: lazy input / contextsensitive input">RFC 285: Lazy Input / Context-sensitive Input</a><br /><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=4#rfc 082: arrays: apply operators elementwise in a list context">RFC 082: Arrays: Apply operators element-wise in a list context</a><br /><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=4#rfc 045: || and && should propagate result context to both sides">RFC 045: <code>||</code> and <code>&amp;&amp;</code> should propagate result context to both sides</a><br /><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=5#rfc 054: operators: polymorphic comparisons">RFC 054: Operators: Polymorphic comparisons</a><br /><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=5#rfc 104: backtracking">RFC 104: Backtracking</a><br /><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=5#rfc 143: case ignoring eq and cmp operators">RFC 143: Case ignoring <code>eq</code> and <code>cmp</code> operators</a><br /><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=5#rfc 170: generalize =~ to a special applyto assignment operator">RFC 170: Generalize <code>=~</code> to a special ``apply-to'' assignment operator</a><br /><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#nonrfc considerations">Non-RFC considerations</a>
</p>
<table border="0" width="100%" cellpadding="0" cellspacing="0">
<tr><td valign="top" bgcolor="#efefef" width="15">&nbsp;</td>
<td valign="top" bgcolor="#efefef">
<span class="tiny">
&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#binary . (dot)">Binary <code>.</code> (dot)</a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#unary . (dot)">Unary <code>.</code> (dot)</a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#binary _">Binary <code>_</code></a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#unary _">Unary <code>_</code></a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#unary + X">Unary <code>+</code></a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#binary := Y">Binary <code>:=</code></a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#unary * XX">Unary <code>*</code></a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#list context">List context</a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#binary : YY">Binary <code>:</code></a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#trinary ::">Trinary <code>??::</code></a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#binary // YYY">Binary <code>//</code></a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#binary ; YYYY">Binary <code>;</code></a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#unary ^ XXX">Unary <code>^</code></a>
<br />
&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#unary ">Unary <code>?</code></a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#binary ">Binary <code>?</code></a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#binary ~ YYYYY">Binary <code>~</code></a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#binary ~~ YYYYYY">Binary <code>~~</code></a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#user defined operators">User defined operators</a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#unicode operators">Unicode operators</a><br />

&#149; <a href="/pub/a/2001/10/02/apocalypse3.html?page=6#precedence">Precedence</a><br /></span>
</td></tr></table>

</td></tr> <tr><td width="150" valign="top" height="4" bgcolor="#6699cc"> </td></tr></table>
<!-- INDEX END -->

<p>To me, one of the most agonizing aspects of language design is coming
up with a useful system of operators.  To other language designers,
this may seem like a silly thing to agonize over.  After all, you can
view all operators as mere syntactic sugar -- operators are just funny
looking function calls.  Some languages make a feature of leveling all
function calls into one syntax.  As a result, the so-called functional
languages tend to wear out your parenthesis keys, while OO languages
tend to wear out your dot key.</p>

<p>But while your computer really likes it when everything looks the same,
most people don't think like computers.  People prefer different things to
look different.  They also prefer to have shortcuts for common tasks.
(Even the mathematicians don't go for complete orthogonality.  Many of
the shortcuts we typically use for operators were, in fact, invented
by mathematicians in the first place.)</p>

<p>So let me enumerate some of the principles that I weigh against each
other when designing a system of operators.</p>
<ul>
<li>
Different classes of operators should look different.  That's why
filetest operators look different from string or numeric operators.
</li>
<li>
Similar classes of operators should look similar.  That's why
the filetest operators look like each other.
</li>
<li>
Common operations should be ``Huffman coded.''  That is, frequently used
operators should be shorter than infrequently used ones.  For how
often it's used, the <code>scalar</code> operator of Perl 5 is too long, in
my estimation.
</li>
<li>
Preserving your culture is important.  So Perl borrowed many of its
operators from other familiar languages.  For instance, we used Fortran's
<code>**</code> operator for exponentiation.  As we go on to Perl 6, most of
the operators will be ``borrowed'' directly from Perl 5.
</li>
<li>
Breaking out of your culture is also important, because that is
how we understand other cultures.  As an explicitly multicultural
language, Perl has generally done OK in this area, though we can
always do better.  Examples of cross-cultural exchange among computer
cultures include XML and Unicode.  (Not surprisingly, these features
also enable better cross-cultural exchange among human cultures -- we
sincerely hope.)
</li>
<li>
Sometimes operators should respond to their context.  Perl has
many operators that do different but related things in scalar versus
list context.
</li>
<li>
Sometimes operators should propagate context to their arguments.  The
<code>x</code> operator currently does this for its left argument, while the
short-circuit operators do this for their right argument.
</li>
<li>
Sometimes operators should force context on their arguments.  Historically,
the scalar mathematical operators of Perl have forced scalar context on
their arguments.  One of the RFCs discussed below proposes to revise this.
</li>
<li>
Sometimes operators should respond polymorphically to the types of
their arguments.  Method calls and overloading work this way.
</li>
<li>
Operator precedence should be designed to minimize the need for
parentheses.  You can think of the precedence of operators as a
partial ordering of the operators such that it minimizes the number of
``unnatural'' pairings that require parentheses in typical code.
</li>
<li>
Operator precedence should be as simple as possible.  Perl's precedence
table currently has 24 levels in it.  This might or might not be too many.
We could probably reduce it to about 18 levels, if we abandon strict
C compatibility of the C-like operators.
</li>
<li>
People don't actually want to think about precedence much, so
precedence should be designed to match expectations.  Unfortunately,
the expectations of someone who knows the precedence table won't
match the expectations of someone who doesn't.  And Perl has always
catered to the expectations of C programmers, at least up till now.
There's not much one can do up front about differing cultural expectations.
</li></ul>
<p>It would be easy to drive any one of these principles into the ground,
at the expense of other principles.  In fact, various languages
have done precisely that.</p>

<p>My overriding design principle has always been that the complexity of
the solution space should map well onto the complexity of the problem
space.  Simplification good!  Oversimplification bad!  Placing
artificial constraints on the solution space produces an impedence
mismatch with the problem space, with the result that using a language
that is artificially simple induces artificial complexity in all
solutions written in that language.</p>

<p>One artificial constraint that all computer languages must deal with is
the number of symbols available on the keyboard, corresponding roughly
to the number of symbols in ASCII.  Most computer languages have
compensated by defining systems of operators that include digraphs,
trigraphs, and worse.  This works pretty well, up to a point.  But
it means that certain common unary operators cannot be used as the
end of a digraph operator.  Early versions of C had assignment operators
in the wrong order.  For instance, there used to be a <code>=-</code> operator.
Nowadays that's spelled <code>-=</code>, to avoid conflict with unary minus.</p>

<p>By the same token (no pun intended), you can't easily define a
unary <code>=</code> operator without requiring a space before it most of the time,
since so many binary operators end with the <code>=</code> character.</p>
<p>Perl gets around some of these problems by keeping track of whether
it is expecting an operator or a term.  As it happens, a unary operator
is simply one that occurs when Perl is expecting a term.  So Perl could
keep track of a unary <code>=</code> operator, even if the human programmer might
be confused.  So I'd place a unary <code>=</code> operator in the category
of ``OK, but don't use it for anything that will cause widespread
confusion.''  Mind you, I'm not proposing a specific use for a unary
<code>=</code> at this point.  I'm just telling you how I think.  If we ever do
get a unary <code>=</code> operator, we will hopefully have taken these issues
into account.</p>
<p>While we can disambiguate operators based on whether an operator or a
term is expected, this implies some syntactic constraints as well.  For
instance, you can't use the same symbol for both a postfix operator and
a binary operator.  So you'll never see a binary <code>++</code> operator in
Perl, because Perl wouldn't know whether to expect a term or operator
after that.  It also implies that we can't use the ``juxtaposition''
operator.  That is, you can't just put two terms next to each other,
and expect something to happen (such as string concatenation, as in
<em>awk</em>).  What if the second term started with something looked like an
operator?  It would be misconstrued as a binary operator.</p>

<p>Well, enough of these vague generalities.  On to the vague specifics.</p>


<p>The RFCs for this apocalypse are (as usual) all over the map, but
don't cover the map.  I'll talk first about what the RFCs do cover,
and then about what they don't.  Here are the RFCs that happened to get
themselves classified into chapter 3:</p>
<pre>
    RFC   PSA    Title
    ---   ---    -----
    024   rr     Data types: Semi-finite (lazy) lists
    025   dba    Operators: Multiway comparisons
    039   rr     Perl should have a print operator 
    045   bbb    C&lt;||&gt; and C&lt;&amp;&amp;&gt; should propagate result context to both sides
    054   cdr    Operators: Polymorphic comparisons
    081   abc    Lazily evaluated list generation functions
    082   abc    Arrays: Apply operators element-wise in a list context
    084   abb    Replace =&gt; (stringifying comma) with =&gt; (pair constructor)
    104   ccr    Backtracking
    138   rr     Eliminate =~ operator.
    143   dcr    Case ignoring eq and cmp operators
    170   ccr    Generalize =~ to a special &quot;apply-to&quot; assignment operator
    283   ccc    C&lt;tr///&gt; in array context should return a histogram
    285   acb    Lazy Input / Context-sensitive Input
    290   bbc    Better english names for -X
    320   ccc    Allow grouping of -X file tests and add C&lt;filetest&gt; builtin</pre>
<p>
Note that you can click on the following RFC titles to view a copy of the
RFC in question.  The discussion sometimes assumes that you've read the RFC.













<p><em>Editor's Note: this Apocalypse is out of date and remains here for historic reasons.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S03.html">Synopsis 03</a> for the latest information.</em></p>

<h3><a href="http://dev.perl.org/rfc/25.html" name="rfc 025: operators: multiway comparisons">RFC 025: Operators: Multiway comparisons</a></h3>

<table width="150" border="0" cellspacing="0" cellpadding="4" align="right">
<tr> 
<td width="150" valign="top" height="4" bgcolor="#6699cc"></td></tr> 
<tr>
<td bgcolor="#efefef">
<p class="headline" align="center">Previous Apocalypses
</p>
<p class="smalltext">
&#149; <a href="/pub/a/2001/04/02/wall.html">Apocalypse 1</a><br /><br />
&#149; <a href="/pub/a/2001/05/03/wall.html">Apocalypse 2</a><br /><br />
</td></tr> <tr><td width="150" valign="top" height="4" bgcolor="#6699cc"> </td></tr></table>
<p>This RFC proposes that expressions involving multiple chained comparisons
should act like mathematician would expect.  That is, if you say this:</p>
<pre>
    0 &lt;= $x &lt; 10</pre>
<p>it really means something like:</p>
<pre>
    0 &lt;= $x &amp;&amp; $x &lt; 10</pre>
<p>The <code>$x</code> would only be evaluated once, however.  (This is very much like
the rewrite rule we use to explain assignment operators such as <code>$x += 3</code>.)</p>
<p>I started with this RFC simply because it's not of any earthshaking
importance whether I accept it or not.  The tradeoff is whether to
put some slight complexity into the grammar in order to save some
slight complexity in some Perl programs.  The complexity in the grammar
is not much of a problem here, since it's amortized over all possible
uses of it, and it already matches the known psychology of a great
number of people.</p>
<p>There is a potential interaction with precedence levels, however.  If
we choose to allow an expression like:</p>
<pre>
    0 &lt;= $x == $y &lt; 20</pre>
<p>then we'll have to unify the precedence levels of the comparison
operators with the equality operators.  I don't see a great problem
with this, since the main reason for having them different was (I
believe) so that you could write an exclusive of two comparisons,
like this:</p>
<pre>
    $x &lt; 10 != $y &lt; 10</pre>
<p>However, Perl has a built-in <code>xor</code> operator, so this isn't
really much of an issue.  And there's a lot to be said for forcing
parentheses in that last expression anyway, just for clarity.  So
unless anyone comes up with a large objection that I'm not seeing, this
RFC is accepted.</p>

<h3><a href="http://dev.perl.org/rfc/320.html" name="rfc 320: allow grouping of x file tests and add filetest builtin">RFC 320: Allow grouping of -X file tests and add <code>filetest</code> builtin</a></h3>

<p>This RFC proposes to allow clustering of file test operators much like
some Unix utilities allow bundling of single character switches.  That
is, if you say:</p>
<pre>
    -drwx $file</pre>
<p>it really means something like:</p>
<pre>
    -d $file &amp;&amp; -r $file &amp;&amp; -w $file &amp;&amp; -x $file</pre>
<p>Unfortunately, as proposed, this syntax will simply be too confusing.
We have to be able to negate named operators and subroutines.  The
proposed workaround of putting a space after a unary minus is much too
onerous and counterintuitive, or at least countercultural.</p>



<p>The only way to rescue the proposal would be to say that such operators
are autoloaded in some fashion; any negated but <em>unrecognized</em>
operator would then be assumed to be a clustered filetest.  This would be
risky in that it would prevent Perl from catching misspelled
subroutine names at compile time when negated, and the error might
well not get caught at run time either, if all the characters in the
name are valid filetests, and if the argument can be interpreted
as a filename or filehandle (which is usually).  Perhaps it would
be naturally disallowed under <code>use strict</code>, since we'd basically
be treating <code>-xyz</code> as a bareword.  On the other hand, in Perl 5, <em>all</em>
method names are essentially in the unrecognized category until run
time, so it would be impossible to tell whether to parse the minus
sign as a real negation.  Optional type declarations in Perl 6 would
only help the compiler with variables that are actually declared to
have a type.  Fortunately, a negated 1 is still true, so even if we
parsed the negation as a real negation, it might still end up doing
the right thing.  But it's all very tacky.</p>
<p>So I'm thinking of a different tack.  Instead of bundling the letters:</p>
<pre>
    -drwx $file</pre>
<p>let's think about the trick of returning the value of <code>$file</code> for a true
value.  Then we'd write nested unary operators like this:</p>
<pre>
    -d -r -w -x $file</pre>
<p>One tricky thing about that is that the operators are applied right
to left.  And they don't really short circuit the way stacked <code>&amp;&amp;</code> would
(though the optimizer could probably fix that).  So I expect we could
do this for the default, and if you want the <code>-drwx</code> as an autoloaded
backstop, you can explicitly declare that.</p>
<p>In any event, the proposed <code>filetest</code> built-in need not be built in.
It can just be a universal method.  (Or maybe just common to strings
and filehandles?)</p>
<p>My one hesitation in making cascading operators work like that is that
people might be tempted to get cute with the returned filename:</p>
<pre>
    $handle = open -r -w -x $file or die;</pre>
<p>That might be terribly confusing to a lot of people.  The solution to
this conundrum is presented at the end of the next section.</p>

<h3><a href="http://dev.perl.org/rfc/290.html" name="rfc 290: better english names for x">RFC 290: Better english names for -X</a></h3>
<p>This RFC proposes long names as aliases for the various filetest operators,
so that instead of saying:</p>
<pre>
    -r $file</pre>
<p>you might say something like:</p>
<pre>
    use english;
    freadable($file)</pre>
<p>Actually, there's no need for the <code>use english</code>, I expect.  These names
could merely universal (or nearly universal) methods.  In any case, we
should start getting used to the idea that <code>mumble($foo)</code> is
equivalent to <code>$foo.mumble()</code>, at least in the absence of a local
subroutine definition to the contrary.  So I expect that we'll see
both:</p>
<pre>
    is_readable($file)</pre>
<p>and:</p>
<pre>
    $file.is_readable</pre>
<p>Similar to the cascaded filetest ops in the previous section,
one approach might be that the boolean methods return the object in
question for success so that method calls could be stacked without
repeating the object:</p>
<pre>
    if ($file.is_dir
             .is_readable
             .is_writable
             .is_executable) {</pre>
<p>But <code>-drwx $file</code> could still be construed as more readable,
for some definition of readability.  And cascading methods aren't
really short-circuited.  Plus, the value returned would have to be
something like ``$file is true,'' to prevent confusion over filename ``0.''</p>
<p>There is also the question of whether this really saves us anything
other than a little notational convenience.  If each of those methods
has to do a <em>stat</em> on the filename, it will be rather slow.  To fix
that, what we'd actually have to return would be not the filename,
but some object containing the stat buffer (represented in Perl 5 by
the <code>_</code> character).  If we did that, we wouldn't have to play
<code>$file is true</code> games, because a valid stat buffer object would
(presumably) always be true (at least until it's false).</p>
<p>The same argument would apply to cascaded filetest operators we talked
about earlier.  An autoloaded <code>-drwx</code> handler would presumably be
smart enough to do a single stat.  But we'd likely lose the speed gain
by invoking the autoload mechanism.  So cascaded operators
(either <code>-X</code> style or <code>.is_XXX</code> style) are the way to go.
They just return objects that know how to be either boolean or stat
buffer objects in context.  This implies you could even say</p>
<pre>
    $statbuf = -f $file or die &quot;Not a regular file: $file&quot;;
    if (-r -w $statbuf) { ... }</pre>
<p>This allows us to simplify the special case in Perl 5 represented by
the <code>_</code> token, which was always rather difficult to explain.   And
returning a stat buffer instead of <code>$file</code> prevents the confusing:</p>
<pre>
    $handle = open -r -w -x $file or die;</pre>
<p>Unless, of course, we decide to make a stat buffer object return the filename
in a string context.  <code>:-)</code></p>













<p><em>Editor's Note: this Apocalypse is out of date and remains here for historic reasons.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S03.html">Synopsis 03</a> for the latest information.</em></p>

<h3><a href="http://dev.perl.org/rfc/283.html" name="rfc 283: tr/// in array context should return a histogram">RFC 283: <code>tr///</code> in array context should return a histogram</a></h3>
<p>Yes, but ...</p>
<p>While it's true that I put that item into the Todo list ages ago, I
think that histograms should probably have their own interface, since
the histogram should probably be returned as a complete hash in scalar
context, but we can't guess that they'll want a histogram for an
ordinary scalar <code>tr///</code>.  On the other hand, it could just be a <code>/h</code>
modifier.  But we've already done violence to <code>tr///</code> to make it do
character counting without transliterating, so maybe this isn't so far
fetched.</p>
<p>One problem with this RFC is that it does the histogram over the input
rather than the output string.  The original Todo entry did not specify
this, but it was what I had intended.  But it's more useful to do it on
the resulting characters because then you can use the <code>tr///</code> itself to
categorize characters into, say, vowels and consonants, and then count
the resulting V's and C's.</p>



<p>On the other hand, I'm thinking that the <code>tr///</code> interface is really
rather lousy, and getting lousier every day.  The whole <code>tr///</code>
interface is kind of sucky for any sort of dynamically generated data.
But even without dynamic data, there are serious problems.  It was bad
enough when the character set was just ASCII.  The basic problem is
that the notation is inside out from what it should be, in the sense
that it doesn't actually show which characters correspond, so you have
to count characters.  We made some progress on that in Perl 5 when,
instead of:</p>
<pre>
    tr/abcdefghijklmnopqrstuvwxyz/VCCCVCCCVCCCCCVCCCCCVCCCCC/</pre>
<p>we allowed you to say:</p>
<pre>
    tr[abcdefghijklmnopqrstuvwxyz]
      [VCCCVCCCVCCCCCVCCCCCVCCCCC]</pre>
<p>There are also shenanigans you can play if you know that duplicates
on the left side prefer the first mention to subsequent mentions:</p>
<pre>
    tr/aeioua-z/VVVVVC/</pre>
<p>But you're still working against the notation. We need a more
explicit way to put character classes into correspondence.</p>
<p>More problems show up when we extend the character set beyond ASCII.
The use of <code>tr///</code> for case translations has long been semi-deprecated,
because a range like <code>tr/a-z/A-Z/</code> leaves out characters with
diacritics.  And now with Unicode, the whole notion of what is a
character is becoming more susceptible to interpretation, and the <code>tr///</code>
interface doesn't tell Perl whether to treat character modifiers as
part of the base character.  For some of the double-wide characters
it's even hard to just <em>look</em> at the character and tell if it's
one character or two.  Counted character lists are about as modern as
hollerith strings in Fortran.</p>
<p>So I suspect the <code>tr///</code> syntax will be relegated to being just one
quote-like interface to the actual transliteration module, whose main
interface will be specified in terms of translation pairs, the left
side of which will give a pattern to match (typically a character
class), and the right side will say what to translation anything
matching to.  Think of it as a series of coordinated parallel <code>s///</code>
operations.  Syntax is still open for negotiation till apocalypse 5.</p>
<p>But there can certainly be a histogram option in there somewhere.</p>


<h3><a href="http://dev.perl.org/rfc/84.html" name="rfc 084: replace => (stringifying comma) with => (pair constructor)">RFC 084: Replace <code>=&gt;</code> (stringifying comma) with <code>=&gt;</code> (pair constructor)</a></h3>
<p>I like the basic idea of pairs because it generalizes to more than just
hash values.  Named parameters will almost certainly be implemented using
pairs as well.</p>
<p>I do have some quibbles with the RFC.  The proposed <code>key</code> and <code>value</code>
built-ins should simply be lvalue methods on pair objects.  And if we
use pair objects to implement entries in hashes, the key must be
immutable, or there must be some way of re-hashing the key if it
changes.</p>
<p>The stuff about using pairs for mumble-but-false is bogus.  We'll use
properties for that sort of chicanery.  (And multiway comparisons
won't rely on such chicanery in any event.  See above.)</p>


<h3><a href="http://dev.perl.org/rfc/81.html" name="rfc 081: lazily evaluated list generation functions">RFC 081: Lazily evaluated list generation functions</a></h3>
<p>Sorry, you can't have the colon--at least, not without sharing it.
Colon will be a kind of ``supercomma'' that supplies an adverbial list to
some previous operator, which in this case would be the prior colon or
dotdot.</p>
<p>(We can't quite implement <code>?:</code> as a <code>:</code> modifier on <code>?</code>, because
the precedence would be screwey, unless we limit <code>:</code> to a single
argument, which would preclude its being used to disambiguate indirect
objects.  More on that later.)</p>
<p>The RFCs proposal concerning <code>attributes::get(@a)</code> stuff is superseded by
value properties.  So, <code>@a.method()</code> should just pull out the
variable's properties directly, if the variable is of a type that
supports the methods in question.  A lazy list object should certainly
have such methods.</p>
<p>Assignment of a lazy list to a tied array is a problem unless the tie
implementation handles laziness.  By default a tied array is likely to
enforce immediate list evaluation.  Immediate list evaluation doesn't
work on infinite lists.  That means it's gonna fill up your disk drive
if you try to say something like:</p>
<pre>
    @my_tied_file = 1..Inf;</pre>
<p>Laziness should be possible, but not necessarily the norm.  It's all very
well to delay the evaluation of ``pure'' functions in the realm of math, since
presumably you get the same result no matter when you evaluate.  But a
lot of Perl programming is done with real world data that changes over time.
Saying <code>somefunc($a .. $b)</code> can get terribly fouled up if <code>$b</code> can change, and
the lazy function still refers to the variable rather than its instantaneous
value.  On the other hand, there is overhead in taking snapshots of the
current state.</p>
<p>On the gripping hand, the lazy list object <em>is</em> the snapshot of the values,
that's not a problem in this case.  Forget I mentioned it.</p>
<p>The tricky thing about lazy lists is not the lazy lists themselves, but
how they interact with the rest of the language.  For instance, what
happens if you say:</p>
<pre>
    @lazy = 1..Inf;
    @lazy[5] = 42;</pre>
<p>Is <code>@lazy</code> still lazy after it is modified?  Do we remember the
<code>@lazy[5]</code> is an ``exception'', and continue to generate the rest of
the values by the original rule?  What if <code>@lazy</code> is going to be
generated by a recursive function?  Does it matter whether we've
already generated <code>@lazy[5]</code>?</p>
<p>And how do we explain this simply to people so that they can
understand?  We will have to be very clear about the distinction
between the abstraction and the concrete value.  I'm of the opinion
that a lazy list is a definition of the <em>default</em> values of an array,
and that the actual values of the array override any default values.
Assigning to a previously memoized element overrides the memoized value.</p>
<p>It would help the optimizer to have a way to declare ``pure'' array
definitions that can't be overridden.</p>
<p>Also consider this:</p>
<pre>
    @array = (1..100, 100..10000:100);</pre>
<p>A single flat array can have multiple lazy lists as part of it's
default definition.  We'll have to keep track of that, which could get
especially tricky if the definitions start overlapping via slice
definitions.</p>
<p>In practice, people will treat the default values as real values.  If
you pass a lazy list into a function as an array argument, the function
will probably not know or care whether the values it's getting from the
array are being generated on the fly or were there in the first place.</p>
<p>I can think of other cans of worms this opens, and I'm quite certain
I'm too stupid to think of them all.  Nevertheless, my gut feeling is
that we can make things work more like people expect rather than less.
And I was always a little bit jealous that REXX could have arrays
with default values.  <code>:-)</code></p>













<p><em>Editor's Note: this Apocalypse is out of date and remains here for historic reasons.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S03.html">Synopsis 03</a> for the latest information.</em></p>

<h3><a href="http://dev.perl.org/rfc/285.html" name="rfc 285: lazy input / contextsensitive input">RFC 285: Lazy Input / Context-sensitive Input</a></h3>
<p>Solving this with <code>want()</code> is the wrong approach, but I think the
basic idea is sound because it's what people expect.  And the <code>want()</code>
should in fact be unnecessary.  Essentially, if the right side of a
list assignment produces a lazy list, and the left side requests a
finite number of elements, the list generator will only produce enough
to satisy the demand.  It doesn't need to know how many in advance.
It just produces another scalar value when requested.  The generator
doesn't have to be smart about its context.  The motto of a lazy list
generator should be, ``Ours is not to question why, ours is but to do
(the next one) or die.''</p>
<p>It will be tricky to make this one work right:</p>
<pre>
    ($first, @rest) = 1 .. Inf;</pre>


<h3><a href="http://dev.perl.org/rfc/82.html" name="rfc 082: arrays: apply operators elementwise in a list context">RFC 082: Arrays: Apply operators element-wise in a list context</a></h3>
<p>APL, here we come...  :-)</p>
<p>This is by far the most difficult of these RFCs to decide, so I'm going
to be doing a lot of thinking out loud here.  This is research--or at
least, a search.  Please bear with me.</p>



<p>I expect that there are two classes of Perl programmers--those that
would find these ``hyper'' operators natural, and those that wouldn't.
Turning this feature on by default would cause a lot of heartburn for
people who (from Perl 5 experience) expect arrays to always return
their length under scalar operators even in list context.  It can
reasonably be argued that we need to make the scalar operators
default, but make it easy to turn on hyper operators within a
lexical scope.  In any event, both sets of operators need to be
visible from anywhere--we're just arguing over who gets the short,
traditional names.  All operators will presumably have longer names
for use as function calls anyway.  Instead of just naming an operator
with long names like:</p>
<pre>
    operator:+
    operator:/</pre>
<p>the longer names could distinguish ``hyperness'' like this:</p>
<pre>
    @a scalar:+ @b
    @a list:/ @b</pre>
<p>That implies they could also be called like this:</p>
<pre>
    scalar:+(@a, @b)
    list:/(@a, @b)</pre>
<p>We might find some short prefix character stands in for
``list'' or ``scalar''.  The obvious candidates are <code>@</code> and <code>$</code>:</p>
<pre>
    @a $+ @b
    @a @/ @b</pre>
<p>Unfortunately, in this case, ``obvious'' is synonymous with ``wrong''.
These operators would be completely confusing from a visual point
of view.  If the main psychological point of putting noun markers on
the nouns is so that they stand out from the verbs, then you don't
want to put the same markers on the verbs.  It would be like the
Germans starting to capitalize all their words instead of just their
nouns.</p>
<p>Instead, we could borrow a singular/plural memelet from shell
globbing, where <code>*</code> means multiple characters, and <code>?</code> means one
character:</p>
<pre>
    @a ?+ @b
    @a */ @b</pre>
<p>But that has a bad ambiguity.  How do you tell whether <code>**</code>
is an exponentiation or a list multiplication?  So if we went that
route, we'd probably have to say:</p>
<pre>
    @a ?:+ @b
    @a *:/ @b</pre>
<p>Or some such.  But if we're going that far in the direction of
gobbledygook, perhaps there are prefix characters that wouldn't be
so ambiguous.  The colon and the dot also have a visual singular/plural
value:</p>
<pre>
    @a .+ @b
    @a :/ @b</pre>
<p>We're already changing the old meaning of dot (and I'm planning to
rescue colon from the <code>?:</code> operator), so perhaps that could be made
to work.  You could almost think of dot and colon as complementary
method calls, where you could say:</p>
<pre>
    $len = @a.length;   # length as a scalar operator
    @len = @a:length;   # length as a list operator</pre>
<p>But that would interfere with other desirable uses of colon.  Plus,
it's actually going to be confusing to think of these as singular
and plural operators because, while we're specifying that we want a
``plural'' operator, we're not specifying how to treat the plurality.
Consider this:</p>
<pre>
    @len = list:length(@a);</pre>
<p>Anyone would naively think that returns the length of the list, not the
length of each element of the list.  To make it work in English, we'd
actually have to say something like this:</p>
<pre>
    @len = each:length(@a);
    $len = the:length(@a);</pre>
<p>That would be equivalent to the method calls:</p>
<pre>
    @len = @a.each:length;
    $len = @a.the:length;</pre>
<p>But does this really mean that there are two array methods with those
weird names?  I don't think so.  We've reached a result here that is
spectacularly close to a <em>reductio ad absurdum</em>.  It seems to me that
the whole point of this RFC is that the ``eachness'' is most simply
specified by the list context, together with the knowledge that
<code>length()</code> is a function/method that maps one scalar value to
another.  The distribution of that function over an array value is not
something the scalar function should be concerned with, except insofar
as it must make sure its type signature is correct.</p>
<p>And there's the rub.  We're really talking about enforced strong
typing for this to work right.  When we say:</p>
<pre>
    @foo = @bar.mumble</pre>
<p>How do we know whether <code>mumble</code> has the type signature that magically
enables iteration over <code>@bar</code>?  That definition is off in some other
file that we may not have memorized quite yet.  We need some
more explicit syntax that says that auto-interation is expected, regardless
of whether the definition of the operator is well specified.  Magical
auto-iteration is not going to work well in a language with optional
typing.</p>
<p>So the resolution of this is that the unmarked forms of operators will
force scalar context as they do in Perl 5, and we'll need a special
marker that says an operator is to be auto-iterated.  That special
marker turns out to be an uparrow, with a tip o' the hat to
higher-order functions.  That is, the hyper-operator:</p>
<pre>
    @a ^* @b</pre>
<p>is equivalent to this:</p>
<pre>
    parallel { $^a * $^b } @a, @b</pre>
<p>(where <code>parallel</code> is a hypothetical function that iterates through
multiple arrays in parallel.)</p>
<p>Hyper operators will also intuit where a dimension is missing from one
of its arguments, and replicate a scalar value to a list value in that
dimension.  That means you can say:</p>
<pre>
    @a ^+ 1</pre>
<p>to get a value with one added to each element of <code>@a</code>.  (<code>@a</code> is unchanged.)</p>
<p>I don't believe there are any insurmountable ambiguities with the uparrow
notation.  There is currently an uparrow operator meaning exclusive-or,
but that is rarely used in practice, and is not typically followed by
other operators when it is used.  We can represent
exclusive-or with <code>~</code> instead.  (I like that idea anyway, because
the unary <code>~</code> is a 1's complement, and the binary <code>~</code> would simply
be doing a 1's complement on the second argument of the set bits in
the first argument.  On the other hand, there's destructive interference
with other cultural meanings of tilde, so it's not completely obvious that
it's the right thing to do.  Nevertheless, that's what we're doing.)</p>
<p>Anyway, in essence, I'm rejecting the underlying premise of this RFC,
that we'll have strong enough typing to intuit the right behavior
without confusing people.  Nevertheless, we'll still have easy-to-use
(and more importantly, easy-to-recognize) hyper-operators.</p>
<p>This RFC also asks about how return values for functions like <code>abs()</code> might
be specified.  I expect sub declarations to (optionally) include a
return type, so this would be sufficient to figure out which functions
would know how to map a scalar to a scalar.  And we should point out again
that even though the base language will not try to intuit which operators
should be hyperoperators, there's no reason in principle that someone
couldn't invent a dialect that does.  All is fair if you predeclare.</p>


<h3><a href="http://dev.perl.org/rfc/45.html" name="rfc 045: || and && should propagate result context to both sides">RFC 045: <code>||</code> and <code>&amp;&amp;</code> should propagate result context to both sides</a></h3>
<p>Yes.  The thing that makes this work in Perl 6, where it was almost
impossible in Perl 5, is that in Perl 6, list context doesn't imply
immediate list flattening.  More precisely, it specifies immediate list
flattening in a notional sense, but the implementation is free to delay
that flattening until it's actually required.  Internally, a flattened
list is still an object.  So when <code>@a || @b</code> evaluates the arrays,
they're evaluated as objects that can return either a boolean value or
a list, depending on the context.  And it will be possible to apply
both contexts to the first argument simultaneously.  (Of course, the
computer actually looks at it in the boolean context first.)</p>
<p>There is no conflict with RFC 81 because the hyper versions of
these operators will be spelled:</p>
<pre>
    @a ^|| @b
    @a ^&amp;&amp; @b</pre>












<p><em>Editor's Note: this Apocalypse is out of date and remains here for historic reasons.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S03.html">Synopsis 03</a> for the latest information.</em></p>

<h3><a href="http://dev.perl.org/rfc/54.html" name="rfc 054: operators: polymorphic comparisons">RFC 054: Operators: Polymorphic comparisons</a></h3>
<p>I'm not sure of the performance hit of backstopping numeric equality
with string equality.  Maybe vtables help with this.  But I think this
RFC is proposing something that is too specific.  The more general
problem is how you allow variants of built-ins, not just for <code>==</code>,
but for other operators like <code>&lt;=&gt;</code> and <code>cmp</code>, not to mention
all the other operators that have scalar and list variants.</p>
<p>A generic equality operator could potentially be supplied by operator
definition.  I expect that a similar mechanism would allow us to define
how abstract a comparison <code>cmp</code> would do, so we could sort and collate
according to the various defined levels of Unicode.</p>
<p>The argument that you can't do generic programming is somewhat
specious. The problem in Perl 5 is that you can't name operators,
so you couldn't pass in a generic operator in place of a specific one
even if you wanted to.  I think it's more important to make sure all
operators have real function names in Perl 6:</p>
<pre>
    operator:+($a, $b);     # $a + $b
    operator:^+(@a, @b);    # @a ^+ @b</pre>
<pre>
    my sub operator:&lt;?&gt; ($a, $b) { ... }
    if ($a &lt;?&gt; $b) { ... }
    @sorted = collate \&amp;operator:&lt;?&gt;, @unicode;</pre>


<h3><a href="http://dev.perl.org/rfc/104.html" name="rfc 104: backtracking">RFC 104: Backtracking</a></h3>



<p>As proposed, this can easily be done with an operator definition to call
a sequence of closures.  I wonder whether the proposal is complete,
however.  There should probably be more make-it-didn't-happen semantics
to a backtracking engine.  If Prolog unification is emulated with an
assignment, how do you later unassign a variable if you backtrack past it?</p>
<p>Ordinarily, temporary values are scoped to a block, but we're using
blocks differently here, much like parens are used in a regex.  Later
parens don't undo the ``unifications'' of earlier parens.</p>
<p>In normal imperative programming these temporary determinations are
remembered in ordinary scoped variables and the current hypothesis is
extended via recursion.  An <code>andthen</code> operator would need to have a
way of keeping BLOCK1's scope around until BLOCK2 succeeds or fails.
That is, in terms of lexical scoping:</p>
<pre>
    {BLOCK1} andthen {BLOCK2}</pre>
<p>needs to work more like</p>
<pre>
    {BLOCK1 andthen {BLOCK2}}</pre>
<p>This might be difficult to arrange as a mere module.  However, with
rewriting rules it might be possible to install the requisite scoping
semantics within BLOCK1 to make it work like that.  So I don't think
this is a primitive in the same sense that continuations would be.  For
now let's assume we can build backtracking operators from continuations.
Those will be covered in a future apocalypse.</p>


<h3><a href="http://dev.perl.org/rfc/143.html" name="rfc 143: case ignoring eq and cmp operators">RFC 143: Case ignoring <code>eq</code> and <code>cmp</code> operators</a></h3>
<p>This is another RFC that proposes a specific feature that can
be handled by a more generic feature, in this case, an operator
definition:</p>
<pre>
    my sub operator:EQ { lc($^a) eq lc($^b) }</pre>
<p>Incidentally, I notice that the RFC normalizes to uppercase.  I suspect
it's better these days to normalize to lowercase, because Unicode
distinguishes titlecase from uppercase, and provides mappings for
both to lowercase.</p>


<h3><a href="http://dev.perl.org/rfc/170.html" name="rfc 170: generalize =~ to a special applyto assignment operator">RFC 170: Generalize <code>=~</code> to a special ``apply-to'' assignment operator</a></h3>
<p>I don't think the argument should come in on the right.  I think it would
be more natural to treat it as an object, since all Perl variables will
essentially be objects anyway, if you scratch them right.  Er, left.</p>
<p>I do wonder whether we could generalize <code>=~</code> to a list operator that
calls a given method on multiple objects, so that</p>
<pre>
    ($a, $b) =~ s/foo/bar/;</pre>
<p>would be equivalent to</p>
<pre>
    for ($a, $b) { s/foo/bar/ }</pre>
<p>But then maybe it's redundant, except that you could say</p>
<pre>
    @foo =~ s/foo/bar/</pre>
<p>in the middle of an expression.  But by and large, I think I'd rather see:</p>
<pre>
    @foo.grep {!m/\s/}</pre>
<p>instead of using <code>=~</code> for what is essentially a method call.  In line with
what we discussed before, the list version could be a hyperoperator:</p>
<pre>
    @foo . ^s/foo/bar/;</pre>
<p>or possibly:</p>
<pre>
    @foo ^. s/foo/bar/;</pre>
<p>Note that in the general case this all implies that there is some
interplay between how you declare method calls and how you declare
quote-like operators.  It seems as though it would be dangerous to
let a quote-like declaration out of a lexical scope, but then it's
also not clear how a method call declaration could be lexically
scoped.  So we probably can't do away with <code>=~</code> as an explicit marker
that the thing on the left is a string, and the thing on the right
is a quoted construct.  That means that a hypersubstitution
is really spelled:</p>
<pre>
    @foo ^=~ s/foo/bar/;</pre>
<p>Admittedly, that's not the prettiest thing in the world.</p>













<p><em>Editor's Note: this Apocalypse is out of date and remains here for historic reasons.  See <a href="http://dev.perl.org/perl6/doc/design/syn/S03.html">Synopsis 03</a> for the latest information.</em></p>

<h3><a name="nonrfc considerations">Non-RFC considerations</a></h3>
<p>The RFCs propose various specific features, but don't give a systematic
view of the operators as a whole.  In this section I'll try to give a
more cohesive picture of where I see things going.</p>
<p>
<h4><a name="binary . (dot)">Binary <code>.</code> (dot)</a></h4>
<p>This is now the method call operator, in line with industry-wide practice.
It also has ramifications for how we declare object attribute variables.
I'm anticipating that, within a class module, saying</p>
<pre>
    my int $.counter;</pre>
<p>would declare both a <code>$.counter</code> instance variable and a <code>counter</code>
accessor method for use within the class.  (If marked as public, it
would also declare a <code>counter</code> accessor method for use outside the
class.)</p>
<p>
<h4><a name="unary . (dot)">Unary <code>.</code> (dot)</a></h4>
<p>It's possible that a unary <code>.</code> would call a method on the current object
within a class.  That is, it would be the same as a binary <code>.</code> with
<code>$self</code> (or equivalent) on the left:</p>
<pre>
    method foowrapper ($a, $b) {
        .reallyfoo($a, $b, $c)
    }</pre>
<p>On the other hand, it might be considered better style to be explicit:</p>
<pre>
    method foowrapper ($self: $a, $b) {
        $self.reallyfoo($a, $b, $c)
    }</pre>
<p>(Don't take that declaration syntax as final just yet, however.)</p>
<p>
<h4><a name="binary _">Binary <code>_</code></a></h4>
<p>Since <code>.</code> is taken for method calls, we need a new way to concatenate
strings.  We'll use a solitary underscore for that.  So, instead of:</p>
<pre>
    $a . $b . $c</pre>
<p>you'll say:</p>
<pre>
    $a _ $b _ $c</pre>
<p>The only downside to that is the space between a variable name and the
operator is required.  This is to be construed as a feature.</p>
<p>
<h4><a name="unary _">Unary <code>_</code></a></h4>
<p>Since the <code>_</code> token indicating stat buffer is going away, a unary
underscore operator will force stringification, just
as interpolation does, only without the quotes.</p>
<p>
<h4><a name="unary + X">Unary <code>+</code></a></h4>
<p>Similarly, a unary <code>+</code> will force numification in Perl 6, unlike
in Perl 5.  If that fails, NaN (not a number) is returned.</p>
<p>
<h4><a name="binary := Y">Binary <code>:=</code></a></h4>
<p>We need to distinguish two different forms of assignment.  The standard
assignment operator, <code>=</code>, works just as it does Perl 5, as much as
possible.  That is, it tries to make it look like a value assignment.
This is our cultural heritage.</p>



<p>But we also need an operator that works like assignment but is more
definitional.  If you're familiar with Prolog, you can think of it as a
sort of unification operator (though without the implicit backtracking
semantics).  In human terms, it treats the left side as a set of formal
arguments exactly as if they were in the declaration of a function, and
binds a set of arguments on the right hand side as though they were
being passed to a function.  This is what the new <code>:=</code> operator does.
More below.</p>
<p>
<h4><a name="unary * XX">Unary <code>*</code></a></h4>
<p>Unary <code>*</code> is the list flattening operator.  (See Ruby
for prior art.) When used on an rvalue, it turns off function signature
matching for the rest of the arguments, so that, for instance:</p>
<pre>
    @args = (\@foo, @bar);
    push *@args;</pre>
<p>would be equivalent to:</p>
<pre>
    push @foo, @bar;</pre>
<p>In this respect, it serves as a replacement for the prototype-disabling
<code>&amp;foo(@bar)</code> syntax of Perl 5.  That would be translated to:</p>
<pre>
    foo(*@bar)</pre>
<p>In an lvalue, the unary <code>*</code> indicates that subsequent array names
slurp all the rest of the values.  So this would swap two arrays:</p>
<pre>
    (@a, @b) := (@b, @a);</pre>
<p>whereas this would assign all the array elements of <code>@c</code> and <code>@d</code> to <code>@a</code>.</p>
<pre>
    (*@a, @b) := (@c, @d);</pre>
<p>An ordinary flattening list assignment:</p>
<pre>
    @a = (@b, @c);</pre>
<p>is equivalent to:</p>
<pre>
    *@a := (@b, @c);</pre>
<p>That's not the same as</p>
<pre>
    @a := *(@b, @c);</pre>
<p>which would take the first element of <code>@b</code> as the new definition of
<code>@a</code>, and throw away the rest, exactly as if you passed too many
arguments to a function.  It could optionally be made to blow up
at run time.  (It can't be made to blow up at compile time, since we
don't know how many elements are in <code>@b</code> and <code>@c</code> combined.  There
could be exactly one element, which is what the left side wants.)</p>
<p>
<h4><a name="list context">List context</a></h4>
<p>The whole notion of list context is somewhat modified in Perl 6.
Since lists can be lazy, the interpretation of list flattening is
also by necessity lazy.  This means that, in the absence of the <code>*</code> list
flattening operator (or an equivalent old-fashioned list assignment),
lists in Perl 6 are object lists.  That is to say, they are parsed
as if they were a list of objects in scalar context.  When you see
a function call like:</p>
<pre>
    foo @a, @b, @c;</pre>
<p>you should generally assume that three discrete arrays are being passed
to the function, unless you happen to know that the signature of <code>foo</code>
includes a list flattening <code>*</code>.  (If a subroutine doesn't have a
signature, it is assumed to have a signature of <code>(*@_)</code> for old
times' sake.)  Note that this is really nothing new to Perl, which has always
made this distinction for builtins, and extended it to user-defined
functions in Perl 5 via prototypes like <code>\@</code> and <code>\%</code>.  We're just changing
the syntax in Perl 6 so that the unmarked form of formal argument expects
a scalar value, and you optionally declare the final formal argument
to expect a list.  It's a matter of Huffman coding again, not to mention
saving wear and tear on the backslash key.</p>
<p>
<h4><a name="binary : YY">Binary <code>:</code></a></h4>
<p>As I pointed out in an earlier apocalypse, the first rule of computer
language design is that everybody wants the colon.  I think that
means that we should do our best to give the colon to as many features
as possible.</p>
<p>Hence, this operator modifies a preceding operator adverbially.
That is, it can turn any operator into a trinary operator (provided a
suitable definition is declared).  It can be used to supply a ``step''
to a range operator, for instance.  It can also be used as a kind
of super-comma separating an indirect object from the subsequent
argument list:</p>
<pre>
    print $handle[2]: @args;</pre>
<p>Of course, this conflicts with the old definition of the <code>?:</code> operator.  See
below.</p>
<p>In a method type signature, this operator indicates that a previous
argument (or arguments) is to be considered the ``self'' of a method call.
(Putting it after multiple arguments could indicate a desire for multimethod
dispatch!)</p>
<p>
<h4><a name="trinary ::">Trinary <code>??::</code></a></h4>
<p>The old <code>?:</code> operator is now spelled <code>??::</code>.  That is to say, since it's
really a kind of short-circuit operator, we just double both characters
like the <code>&amp;&amp;</code> and <code>||</code> operator.  This makes it easy to remember for
C programmers.  Just change:</p>
<pre>
    $a ? $b : $c</pre>
<p>to</p>
<pre>
    $a ?? $b :: $c</pre>
<p>The basic problem is that the old <code>?:</code> operator wastes two very useful
single characters for an operator that is not used often enough to
justify the waste of two characters.  It's bad Huffman coding, in
other words.   Every proposed use of colon in the RFCs conflicted with
the <code>?:</code> operator.  I think that says something.</p>
<p>I can't list here all the possible spellings of <code>?:</code> that I considered.
I just think <code>??::</code> is the most visually appealing and mnemonic of the
lot of them.</p>
<p>
<h4><a name="binary // YYY">Binary <code>//</code></a></h4>
<p>A binary <code>//</code> operator is the defaulting operator.  That is:</p>
<pre>
    $a // $b</pre>
<p>is short for:</p>
<pre>
    defined($a) ?? $a :: $b</pre>
<p>except that the left side is evaluated only once.  It will work on
arrays and hashes as well as scalars.  It also has a corresponding
assignment operator, which only does the assignment if the left side
is undefined:</p>
<pre>
    $pi //= 3;</pre>
<p>
<h4><a name="binary ; YYYY">Binary <code>;</code></a></h4>
<p>The binary <code>;</code> operator separates two expressions in a list, much like
the expressions within a C-style <code>for</code> loop.  Obviously the
expressions need to be in some kind of bracketing structure to avoid
ambiguity with the end of the statement.  Depending on the context,
these expressions may be interpreted as arguments to a <code>for</code> loop, or
slices of a multi-dimensional array, or whatever.  In the absence of
other context, the default is simply to make a list of lists.  That is,</p>
<pre>
    [1,2,3;4,5,6]</pre>
<p>is a shorthand for:</p>
<pre>
    [[1,2,3],[4,5,6]]</pre>
<p>But usually there will be other context, such as a multidimension array
that wants to be sliced, or a syntactic construct that wants to emulate
some kind of control structure.  A construct emulating a 3-argument
<code>for</code> loop might force all the expressions to be closures, for
instance, so that they can be evaluated each time through the loop.
User-defined syntax will discussed in apocalypse 18, if not sooner.</p>
<p>
<h4><a name="unary ^ XXX">Unary <code>^</code></a></h4>
<p>Unary ^ is now reserved for hyper operators.  Note that it works on
assignment operators as well:</p>
<pre>
    @a ^+= 1;    # increment all elements of @a</pre>
<p>
<h4><a name="unary ">Unary <code>?</code></a></h4>
<p>Reserved for future use.</p>
<p>
<h4><a name="binary ">Binary <code>?</code></a></h4>
<p>Reserved for future use.</p>
<p>
<h4><a name="binary ~ YYYYY">Binary <code>~</code></a></h4>
<p>This is now the bitwise XOR operator.  Recall that unary
<code>~</code> (1's complement) is simply an XOR with a value containing all 1
bits.</p>
<p>
<h4><a name="binary ~~ YYYYYY">Binary <code>~~</code></a></h4>
<p>This is a logical XOR operator.  It's a high precedence version of the
low precedence <code>xor</code> operator.</p>
<p>
<h4><a name="user defined operators">User defined operators</a></h4>
<p>The declaration syntax of user-defined operators is still up for grabs,
but we can say a few things about it.  First, we can differentiate
unary from binary declarations simply by the number of arguments.
(Declaration of a return type may also be useful for disambiguating
subsequent parsing.  One place it won't be needed is for operators wanting
to know whether they should behave as hyperoperators.  The pressure to
do that is relieved by the explicit <code>^</code> hypermarker.)</p>
<p>We also need to think how these operator definitions relate to overloading.
We can treat an operator as a method on the first object, but sometimes
it's the second object that should control the action.  (Or with multimethod
dispatch, both objects.)  These will have to be thrashed out under
ordinary method dispatch policy.  The important thing is to realize
that an operator is just a funny looking method call.
When you say:</p>
<pre>
    $man bites $dog</pre>
<p>The infrastruture will need to untangle whether the man is biting the
dog or the dog is getting bitten by the man.  The actual biting could
be implement in either the <code>Man</code> class or the <code>Dog</code> class, or even
somewhere else, in the case of multimethods.</p>
<p>
<h4><a name="unicode operators">Unicode operators</a></h4>
<p>Rather than using longer and longer strings of ASCII characters to
represent user-defined operators, it will be much more readable to
allow the (judicious) use of Unicode operators.</p>
<p>In the short term, we won't see much of this.  As screen resolutions
increase over the next 20 years, we'll all become much more comfortable
with the richer symbol set.  I see no reason (other than fear of
obfuscation (and fear of fear of obfuscation))) why Unicode operators
should not be allowed.</p>
<p>Note that, unlike APL, we won't be hardware dependent, in the sense
that any Perl implementation will always be able to parse Unicode, even
if you can't display it very well.  (But note that Vim 6.0 just came
out with Unicode support.)</p>
<p>
<h4><a name="precedence">Precedence</a></h4>
<p>We will at least unify the precedence levels of the equality and
relational operators.  Other unifications are possible.  For instance,
the <code>not</code> logical operator could be combined with list operators in
precedence.  There's only so much simplification that you can do,
however, since you can't mix right association with left association.
By and large, the precedence table will be what you expect, if you
expect it to remain largely the same.</p>
<p>And that still goes for Perl 6 in general.  We talk a lot here about
what we're changing, but there's a lot more that we're not changing.
Perl 5 does a lot of things right, and we're not terribly interested in
``fixing'' that.</p>

</body>

</html>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2001/09/">&laquo; September 2001</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2001/11/">November 2001 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
