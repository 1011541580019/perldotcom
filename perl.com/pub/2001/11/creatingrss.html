<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.02" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
    
    <link rel="prev bookmark" href="/pub/2001/11/ooperl.html" title="Object-Oriented Perl" />
    <link rel="next bookmark" href="/pub/2001/11/perlbio2.html" title="Parsing Protein Domains with Perl" />
    
    
    <title>Create RSS channels from HTML news sites - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <div id="top_advert"> 
<!-- Put any landscape advert in here -->
<a href="http://www.perlfoundation.org/" target="_new">
<img src="/i/tpf_banner.png" width="468" height="60" /></a>
        </div> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description"></div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1628" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Create RSS channels from HTML news sites</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Chris Ball</span> on <abbr class="published" title="2001-11-15T00:00:00-08:00">November 15, 2001 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        


    <p>

      Even if you haven't heard of the RSS acronym before, you're likely

      to have used RSS in the past.  Whether through the slashboxes at

      <a href="http://slashdot.org">slashdot</a> or our own news summary

      at <a href="http://use.perl.org">use.perl.org</a>, the premise

      remains the same - RSS, or "Remote Site Summary" is a method used

      for providing an overview of the latest news to appear on a site.

    </p>



    <p>

      RSS is an XML-based format, where the the site's information is

      described in a format that simplifies the news down to a few key

      elements. In the example we're going to run through, we'll

      concentrate particularly on the <i>title</i> and <i>link</i> tags.

      If you're interested in specifics of RSS, you can read more

      about it and see the full specification at <a

      href="http://my.netscape.com/publish/formats/rss-spec-0.91.html">netscape.com</a>;

      for the purposes of this tutorial, though, I'm going to

      concentrate on how we can manipulate RSS with Perl and leave RSS

      internals alone.

    </P>

    <p>

      So, you have a news site requiring an RSS feed; or let's say

      there's a news site that you want to get into RSS

      format. O'Reilly's own <a

      href="http://meerkat.oreillynet.com">Meerkat</a> web site creates

      RSS descriptions of the news on other sites, and presents the

      latest news from all around the web as a news ticket.

      We're not going to use exactly the same method as Meerkat in

      this tutorial, but we'll use similar techniques to provide us

      with an RSS feed of the <a href="http://news.bbc.co.uk/">BBC

	News</A> web site.

    </p>

    <p>

      So, what does our perl script need to do in order to turn the

      headlines on the site into an RSS channel?  There are three main

      tasks that we'll be handling: 



      <ul> 

	<li>Downloading the page for our script to work with,</li>

	<li>Parsing the HTML on the page to give us meaningful summary

	  information, and </li>

	<li>Encoding the summary information in RSS.</li>

      </ul>

    </p>

    <p>



      For anyone who's used the huge CPAN network of modules before,

      it's not going to be a huge surprise to hear that there are

      modules to help us accomplish each of our tasks here.  We're

      going to be using <code>LWP::Simple</code> to handle downloading

      our page, <code>HTML::TokeParser</code> to parse our downloaded

      HTML into some meaningful English, and <code>XML::RSS</code> to

      create an RSS channel from our headlines and links.



    </P>



    <p>

      Let's jump in to the code.  After declaring our use of the

      modules we're going to be using...

    </p>

<pre>

use strict;

use LWP::Simple;

use HTML::TokeParser;

use XML::RSS;

</pre>



      <p>

      .. we're ready to create each of the objects we'll be using with

      each module.  Note that while <code>LWP::Simple</code> uses a

      procedural interface, both <code>HTML::TokeParser</code> and

      <code>XML::RSS</code> have Object-Oriented interfaces.  If you

      aren't used to OO in Perl, <a

      href="/pub/au/Cozens_Simon">Simon Cozens</a>'

      recent <a

      href="/pub/a/2001/11/07/ooperl.html">article</a>

      on Object-Oriented Perl might be a great help.

      </p>

<pre>

# First - LWP::Simple.  Download the page using get();.

my $content = get( "http://news.bbc.co.uk/" ) or die $!;



# Second - Create a TokeParser object, using our downloaded HTML.

my $stream = HTML::TokeParser->new( \$content ) or die $!;



# Finally - create the RSS object. 

my $rss = XML::RSS->new( version => '0.9' );

</pre>

    <p>

      Our next step in laying the foundations for our script is going

      to be to declare some variables and set the channel information

      on our RSS object.  Every RSS channel carries some metadata;

      that's to say, data which provides information about the data

      that it encodes. For instance, it usually carries at least the

      channel's name, description, and an URL link.  We're going to

      set up the metadata by calling the <code>channel</code> method

      on our object, like this:

    </p>

<pre>

# Prep the RSS.

$rss->channel(

	title        => "news.bbc.co.uk",

	link         => "http://news.bbc.co.uk/",

	description  => "news.bbc.co.uk - World News from the BBC.");



# Declare variables.

my ($tag, headline, $url);

</pre>



      <p>

	We now have all three of our modules primed and ready for use,

	and can move on to step two - obtaining plaintext information

	from our HTML page. This is where we need to apply our

	analytical skills to determine the layout of the web site

	we're looking at, and to find out how to find the headlines we

	wish to extract. The BBC's HTML layout is complex but

	predictable, and follows this routine:



      <ul>

	<li>A <CODE>&lt;div class="bodytext"&gt;</code> tag is present.</li>

	<li>An <CODE>&lt;a&gt;</code> tag is opened, and then

	  closed.</LI>

	

	<li>An <CODE>&lt;a&gt;</code> tag is opened, containing the

	URL we wish to grab, linking to the full text of the news

	  article.</li> 



	<li>The <CODE>&lt;a&gt;</code> tag is closed, and a

	<CODE>&lt;b class="h1"&gt;</code> or <CODE>&lt;b

	class="h2"&gt;</CODE> tag is opened.</li>  



	<li>Our headline lies between this <CODE>&lt;b&gt;</code> tag

	and a <CODE>&lt;/b&gt;</code> tag.

      </ul>

      

      At first glance, it seems like acquiring the url and headline in

      this situation is going to be awkward, but

      <code>HTML::TokeParser</code> makes light work of the page.  The

      two important methods we are given by

      <code>HTML::TokeParser</code> are <code>get_tag</code> and

      <code>get_trimmed_text</code>.

    </p>



    <p>

      <code>get_tag</code> skips forward in the HTML from our current

      position to the tag specified, and <Code>get_trimmed_text</code>

      will grab plaintext from the current position to the end

      position specified.  And so we can now translate our

      description of the BBC's layout into methods upon our

      <code>HTML::TokeParser</code> object, <code>$stream</code>.

    </p>



<pre>

# First indication of a headline - A &lt;div&gt; tag is present.

while ( $tag = $stream->get_tag("div") ) {



	# Inside this loop, $tag is at a &lt;div&gt; tag.

        # But do we have a "class="bodytext">" token, too? 

	if ($tag->[1]{class} and $tag->[1]{class} eq 'bodytext') {



		# We do! 

                # The next step is an &lt;a&gt;&lt;/a&gt; set, which we aren't interested in.  

                # Let's go past it to the next &lt;a&gt;.

		$tag = $stream->get_tag('a'); $tag = $stream->get_tag('a');

		

		# Now, we're at the &lt;a&gt; with the headline in.

                # We need to put the contents of the 'href' token in $url.

		$url = $tag->[1]{href} || "--";

		

		# That's $url done.  We can move on to $headline, and &lt;b&gt;

		$tag = $stream->get_tag('b');



		# Now we can grab $headline, by using <code>get_trimmed_text</code> 

                # up to the close of the &lt;b&gt; tag.

		# We want &lt;b class="h1"&gt; or &lt;b class="h2"&gt;.  

                # A regular expression will come in useful here. 

		$headline = $stream->get_trimmed_text('/b') \ 
                 if ($tag->[1]{class} =~ /^h[12]$/); 

</pre>



      <p>



      We're getting there.  We have the page downloaded, and we're

      inside a <code>while</code> loop that's going to grab every set

      of url and headline pairs on the page.  All that's left to do is

      add <code>$url</code> and <code>$headline</code> to our RSS

      channel; but first, some tidying up..

    </p>



    <pre>

		# We need to escape ampersands, as they start entity references in XML.

		$url =~ s/&/&amp;amp;/g;

	

		# The &lt;a&gt; tags contain relative URLs - we need to qualify these.

		$url = 'http://news.bbc.co.uk'.$url;

		

		# And that's it.  We can add our pair to the RSS channel. 

		$rss->add_item( title => $headline, link => $url);

	}

}

</pre>



    <p>

      By the end of each iteration through the

      <code>&lt;div&gt;</code> tags, our <code>$rss</code> object is

      going to contain every title and link from the page.  Now all we

      need to do is save it somewhere, and that's done with the

      <code>$rss->save</code> method.

    </p>



<pre>

$rss->save("bbcnews.rss");

</pre>



    <p>



      After executing our script, we get a '<code>bbcnews.rss</code>'

      file dumped in the current directory, and this can be processed

      by any RSS parser - for example, <a

      href="http://printf.net/evobbc.jpg">here</a>'s my current mail

      client, Evolution, adding our data to the 'Executive Summary'

      feature.

    </p>

    <p>

      If we make this accessible on the web, as all good RSS feeds

      are, we can even get at this from our Slashboxes or use.perl

      news boxes. If you do want to make it web accessible, however,

      it's probably better to periodically create the RSS file from a

      <code>cron</code> job or similar, rather than using CGI,

      especially if you think the RSS is going to be accessed more

      often than the target site will be updated.

    </p>

    <p>

      Of course, if you're creating an RSS feed for your own site, you

      have much greater control over the way you get your data. For

      instance, if you're using XML to produce your web site, you can

      use XML transformation techniques to produce RSS - but that's

      another tutorial for another time. For now, have fun, and happy

      spidering!

    </p>









                                    </div>


                                </div>
                                <div class="asset-footer">

    
                                    <div class="entry-categories">
                                        <h4>Categories<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="/pub/web-development/" rel="tag">Web Development</a></li>
                                        </ul>
                                    </div>
    


                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2010/07/">July 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.02" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
