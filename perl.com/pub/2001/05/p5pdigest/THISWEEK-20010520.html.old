<!-- This week on perl5-porters (14 May--20 May 2001) -->

<br />
<!::field::date::><br />
      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:perl5-porters-digest-subscribe@netthink.co.uk"><tt>perl5-porters-digest-subscribe@netthink.co.uk</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>perl-thisweek-YYYYMM@simon-cozens.org</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.  Changes and additions to the 
<a href="http://simon-cozens.org/writings/whos-who.html">perl5-porters</a> biographies are particularly welcome.
</P>

<P>
This was a fairly typical week with some large threads.
<H3><a name="Help_found">Help found</a></H3>

</P>

<P>

Simon Cozens, the usual summarizer, is currently having rather
important exams. Leon Brocard has stepped in to take the P5P
summary off his hands for a bit. Good luck, Simon!
<H3><a name="Internationalisation">Internationalisation</a></H3>

</P>

<P>

<a href="http://simon-cozens.org/writings/whos-who.html#BURLISON">Alan Burlison</a> started off by asking:
<blockquote>In amongst all the Unicode work, has any thought been given to
internationalising the perl interpreter itself?  At the moment all the error
and warning messages are english-only, AFAIK. This also applies to the
standard modules.
</blockquote></P>

<P>
A small thread discussed the huge amount of work involved in
translating every English part of the Perl source into multiple
languages, and the fact that the typical method of achieving this was
message catalogues which are, as
<a href="http://simon-cozens.org/writings/whos-who.html#HIETANIEMI">Jarkko</a> understatedly pointed out &quot;messy&quot;. Sean Burke's 
<CODE>Locale::Maketext</CODE> module was mentioned as a solution. The thread went dead, although it
 looks like at least the
<CODE>perldiag</CODE> documentation will be worked upon.
<H3><a name="Must_pseudo_hashes_die">Must pseudo-hashes die?</a></H3>

</P>

<P>

Pseudohashes are a long-lived and yet not much loved experimental
feature of Perl which aims to optimise a hash reference to an array
reference at compile time, helping speed and efficiency.
<a href="http://simon-cozens.org/writings/whos-who.html#SCHWERN">Michael Schwern</a> asked that pseudo-hashes should be removed from Perl 5.8 and onwards.
</P>

<P>
He found that pseudohashes are about 15% faster than hashes, but that
the current implementation is layered over the hash code so that:
<blockquote>Tearing out the pseudohash code gives an across the board 10-15% gain
in speed in basic benchmarks.  That means if we didn't have
pseudohashes, normal hashes would be just as fast as fully declared
pseudohashes!
</blockquote></P>

<P>
Removal of pseudohashes would need a clean implementation of 
<CODE>fields</CODE>. 
<a href="http://simon-cozens.org/writings/whos-who.html#BARR">Graham Barr</a> suggested moving the pseudohash code out of the hash code and making a
new PSEUDOHASH type.
</P>

<P>
In summary: it looks like current user-visible implementation of
pseudo-hashes (the weird use of the first array element) will be
deprecated starting from Perl 5.8.0 and will be removed in Perl 5.10.0. 
<a href="http://simon-cozens.org/writings/whos-who.html#HIETANIEMI">Jarkko</a> complained: &quot;Instead of too much implementation hand-waving how about some
real implementations, followed by some real benchmarks, and
discussion on some real tradeoffs?&quot;.
</P>

<P>
This brought upon another point: making experimental features Perl
compile time configuration options which default to OFF. Little
discussion ensued.
<H3><a name="More_Magic">More Magic</a></H3>

</P>

<P>

<a href="http://simon-cozens.org/writings/whos-who.html#COZENS">Simon Cozens</a> attempted to convince us of the utility of a generalised
magic for arrays and hashes:
<blockquote>The idea is simple. When you use a special scalar in Perl, like, say,
$/, (but not $_, because that's not only special, it's extra special)
Perl looks up the scalar in the symbol table and finds that it has
magic attached to it. This magic, called &quot;\0&quot; magic, means that
instead of getting the value from the SV structure, Perl calls a
function magic_get and returns the value from there. (It doesn't have
to be magic_get - there are lots of different types of magic, which
fire off different functions. Anyway, &quot;\0&quot; magic fires off magic_get.)
magic_get looks at the name of the scalar, and basically does a big
case statement to perform code appropriate for that scalar.
</P>

<P>
The end result is that if I want to add a new special variable - let's
say $} - then I can tell gv.c that it should have &quot;\0&quot; magic, and
insert the appropriate code to deal with it in magic_get.
</P>

<P>
For arrays and hashes, it's not that easy. Unfortunately, every single
special array and hash has its own magic - and not just its own, but
also a different type of magic that should be copied to the elements
of the array or hash. So if you want to add more special variables,
you have to cook up a new kind of magic and more virtual tables and
functions and it's just horrid.
</blockquote></P>

<P>
Simon and Sarathy want to make it easier to add magic to aggregates,
but suggested different approaches. Simon wants to introduce a new
once-and-for-all generic magic for aggregates and their elements
scalars; Sarathy wants to collapse everything into the &quot;P&quot; magic
which handles tied arrays and hashes.
<H3><a name="Legal_FAQ">Legal FAQ</a></H3>

</P>

<P>

A. C. Yardley proposed to develop a Legal FAQ to hopefully address
most of the important legal issues concerning Perl, the Perl
community, and Perl's Open Source efforts. This is a wonderful thing
to undertake, for as Jarkko pointed out: &quot;it's about time we get
something a little bit more than just educated guesses.&quot;
</P>

<P>
Proposed topics include: general discussion about lawyers and the
American legal system, copyright and trademark law and international
conventions, a review of the so-called Digital Millennium Copyright
Act, licensing issues about code on CPAN and names, liability issues,
and much more.
</P>

<P>
He also notes (unfortunately, but quite understandably) for a
distributed, world-wide development effort such as Perl:
<blockquote>Unfortunately, other the rather general remarks and
references, I must limit my review and analysis of the relevant
legal issues contained within the proposed FAQ to the domestic laws
of the United States.  It is unfortunate, but a review of the  
domestic laws of all of the applicable Nation States would be a
significantly, non-trivial undertaking.
</blockquote></P>

<P>

<H3><a name="Various">Various</a></H3>

<a href="http://simon-cozens.org/writings/whos-who.html#SUGALSKI">Dan Sugalski</a> dropped in a patch to speed up threaded perl
 on Alpha VMS systems by about 2-3 percent.
</P>

<P>
Doug MacEachern asked about optimising hash lookups with a constant
key by pre-calculating the hash of the key. Turns out this was already
in bleadperl, but disabled under ithreads.
</P>

<P>

<a href="http://simon-cozens.org/writings/whos-who.html#AAS">Gisle Aas</a> contributed a patch to stop
<CODE>chomp</CODE> always stringifying its argument (even if it leaves it alone) as well as a 
patch to fix 
<CODE>require $mod</CODE> where 
<CODE>$mod</CODE> has touched numeric context.
</P>

<P>

<a href="http://simon-cozens.org/writings/whos-who.html#ZAKHAREVICH">Ilya Zakharevich</a> provided 5 patches, including cleanups, both low- and
high-level API additions, and more convenient client-server debugging
in the Perl debugger, along with some OS/2 work.
</P>

<P>

<a href="http://simon-cozens.org/writings/whos-who.html#HOUSTON">Robin Houston</a> asked about
<CODE>CvFILE()</CODE> corruption under ithreads. 
<CODE>CvFILE()</CODE> returns the name of the
 file that the CV (sub, xsub or format) was declared in, and isn't
 used in core Perl but rather used by compiler backends such as
<CODE>B::C</CODE> and
<CODE>B::Deparse</CODE>. Robin supplied a patch but will rework it.
</P>

<P>
Dave Mitchell supplied a large patch that replaced magic char
constants with symbolic values.
</P>

<P>
Some bugs in pp_concat were noticed by Hugo and Jarkko took the blame
for previously cleaning it up rather too severely.
</P>

<P>
Until next week I remain, your temporarily-replaced humble and
obedient servant,
</P>

<a href="mailto:leon@iterative-software.com">Leon Brocard</a><br />
<a href="http://www.astray.com/">http://www.astray.com/
</a><br />
<a href="http://www.iterative-software.com/">Iterative Software</a>


<P>
... All things are green unless they are not
</P>

<hr>




<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#Help_found">Help found</a>
  <li><a href="#Internationalisation">Internationalisation</a>
  <li><a href="#Must_pseudo_hashes_die">Must pseudo-hashes die?</a>
  <li><a href="#More_Magic">More Magic</a>
  <li><a href="#Legal_FAQ">Legal FAQ</a>
  <li><a href="#Various">Various</a>
</ul>
