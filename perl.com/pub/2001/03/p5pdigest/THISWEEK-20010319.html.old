</p>

<p>


<!-- This week on perl5-porters (13--19 Mar 2001) -->

<br />
<!::field::date::><br />
      <h3><a name="Notes">Notes</a></h3>

</p>

<p>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:perl5-porters-digest-subscribe@netthink.co.uk"><tt>perl5-porters-digest-subscribe@netthink.co.uk</tt>.</a></p>

<p>
Please send corrections and additions to 
<code>perl-thisweek-YYYYMM@simon-cozens.org</code> where 
<code>YYYYMM</code> is the current year and month.  Changes and additions to the 
<a href="http://simon-cozens.org/writings/whos-who.html">perl5-porters</a> biographies are particularly welcome.
</p>

<p>
There were just under 300 messages this week.
<h3><a name="561_TRIAL3_is_out_there">5.6.1-TRIAL3 is out there</a></h3>

</p>

<p>

Just before going to press, 
<a href="http://simon-cozens.org/writings/whos-who.html#GURUSAMY">Sarathy</a> pushed trial 3 out of the door; get it from 
<a href="http://www.cpan.org/authors/id/G/GS/GSAR/perl-5.6.1-TRIAL3.tar.gz">$CPAN/authors/id/G/GS/GSAR/perl-5.6.1-TRIAL3.tar.gz</a>.
</p>

<p>
Please test it as widely as possible, run your favourite bugs through
it, and so on. If you're not one of the smoke testers, now would be a
good time to start; subscribe to 
<code>daily-build@perl.org</code> and get yourself a copy of 
<code>SmokingJacket</code> - that would be a great help for us. 
<h3><a name="Robin_Houston_vs_goto">Robin Houston vs. goto</a></h3>

</p>

<p>

Why anyone wants to maintain 
<code>goto</code> is quite beyond me, but Robin Houston's been doing it rather well this
week. The first bug he fixed was to do with lexical variables losing
their values when a 
<code>goto</code> happens in their scope:
</p>

</p><pre>
    for ($i=1; $i<=1; $i++) {
        my $var='val';
        print "before \$var='$var'\n";
        goto jump;
        jump:
        print  "after \$var='$var'\n";
    }
</pre>

<p>
Here's his analysis:
<blockquote>Wow! This is a venerable bug, dating at least back to 5.00404.
</p>

<p>
When a for(;;) is compiled, there's no nextstate immediately
before the enterloop, and so when pp_goto does this:
</p>

</p><pre>
            case CXt_LOOP:
                gotoprobe = cx->blk_oldcop->op_sibling;
                break;
</pre>

<p>
gotoprobe ends up pointing into a dead end.
</p>

<p>
That means that the label doesn't get found until the
next context up is searched; and so the loop context is
left and re-entered when the goto is executed.
</blockquote></p>

<p>
Next, he fixed a bug which meant that 
</p>

<p>
  eval { goto foo; }; die &quot;OK\n&quot;;
  foreach $i(1,2,3) { foo: die &quot;Inconclusive\n&quot;; }
</p>

<p>
would not get caught by the 
<code>eval</code>. This was because 
<code>goto</code> failed to pop the stack frames as it left an 
<code>eval</code>. 
</p>

<p>
For his hat-trick, he made 
<code>goto</code> work in nested 
<code>eval</code> structures. 
<h3><a name="my_foo_if_0">my $foo if 0</a></h3>

</p>

<p>

One of the (many) perl5-porters dirty secrets is that if you say
</p>

</p><pre>
    sub marine {
        my $scope = "up" if 0;
        return $scope++;
    }
    print marine(),"\n" for 0..10;
</pre>

<p>
you get the lexical variable 
<code>$scope</code> increasing from 0 to 10, instead of being reinitialised every time. In
effect, you get a static variable. Very nice.
</p>

<p>
Of course, this is completely undocumented and you'd be foolish to rely
on it, but it generates no warnings and passes 
<code>use strict</code> happily. It's come about completely by accident, since the optimiser
optimises away the initialisation. David Madison claimed it was a bug,
but most people seem to think of it as an unexploded feature. 
<a href="http://simon-cozens.org/writings/whos-who.html#HIETANIEMI">Jarkko </a> will be adding lexical warnings to mark it as deprecated.
<a href="http://simon-cozens.org/writings/whos-who.html#VROMANS">Johan</a> also pointed out that 
<code>open</code> with more than 3 arguments doesn't currently pass the later arguments
onto the program being called: his spectacular example was
</p>

</p><pre>
    open (FH, "-|", "deleteallfiles", "-tempfilesonly")
</pre>

<p>
which deletes all files, not just the temp files. 
<a href="http://simon-cozens.org/writings/whos-who.html#ING-SIMMONS">Nick</a> said it was on his list of things to do, and called for patches.
<h3><a name="More_POD_Nits">More POD Nits</a></h3>

</p>

<p>

Michael Stevens produced some more POD patches this week, and the
discussion about how strict 
<code>podchecker</code> can be continued from last week, spurred on by Jarkko sending Michael's
patched to the maintainers of core modules.
<a href="http://simon-cozens.org/writings/whos-who.html#ZACHAREVICH">Ilya</a>, Sarathy and others
grumbled about 
<code>podchecker</code>'s insistence on
</p>

</p><pre>
    =over 4
</pre>

<p>
instead of just `plain'
</p>

</p><pre>
    =over
</pre>

<p>
Michael patched 
<code>podchecker</code> to remove that warning, although Jarkko was impressed that
perl5-porters had managed to degenerate to squabbling over 2 bytes of
documentation. A new low. 
Not content, Ilya managed to get it down to 1 byte, by grouching about
</p>

</p><pre>
    L&lt;foo
     bar>
</pre>

<p>
being an error where
</p>

</p><pre>
    L&lt;foo bar>
</pre>

<p>
was not. Michael patched 
<code>podchecker</code> to remove that warning too, which has the nice result that you can
 reformat paragraphs in your POD (with Alt-Q or gqap, depending on
 religion) without worrying about it breaking the semantics.
<h3><a name="More_on_the_reset_bug">More on the reset bug</a></h3>

</p>

<p>

Jarkko reported that Sarathy's patch to fix the 
<a href="http://www.perl.com/pub/2001/03/p5pdigest/THISWEEK-20010305.html#Weird_Memory_Corruption">reset bug</a> of a couple of weeks ago still produced erratic results on various
platforms. 
<a href="http://simon-cozens.org/writings/whos-who.html#BURLISON">Alan </a> found the heap corruption in Purify, and reported that &quot;this bug is
unchanged since the last discussion of it on the list a couple of weeks
back.&quot; (But noted that the anon sub leak is finally fixed!) Jarkko
pointed out that this was because Sarathy's patch wasn't applied to the
repository, and that the problem was that the linked list of pattern
match operators was getting corrupted. That's to say, when you have a
regular expression like 
<code>/.a\d/</code> it contains a list of nodes: any character, a literal 
<code>a</code>, any digit. For some reason, when the regular expression was being
freed from memory, one of the nodes, let's say the literal 
<code>a</code>, was pointing not to an &quot;any digit&quot; node, but to West hyperspace. 
</p>

<p>
Radu Greab zeroed in on the problem: the regular expression was being
cleared twice. He provided the beginnings of a patch; Sarathy suggested
it was on the right lines, but wanted to reference count regular
expression nodes. His version of the patch caused all sorts of problems,
and Radu came up with something else to change the regular expression
node list into a doubly-linked list. That was still imperfect, and
Sarathy wanted to know why his patch caused all sorts of problems.
Jarkko unfortunately ran out of time to do some debugging on this.
</p>

<p>
So it's still out there, and a very, very weird bug it is too. Something
is going very wrong with the freeing of PMOPs. We've only seen it on
Linux and Tru64 when the 
<code>-DDEBUGGING</code> and 
<code>-g</code> flags are on, so far. Stranger and stranger.
<h3><a name="Distributive_arrow_operator">Distributive arrow operator</a></h3>

</p>

<p>

David Lloyd suggested that the arrow operator should be
distributive, so that:
</p>

</p><pre>
    ($foo, $bar)->baz();
</pre>

<p>
does
</p>

</p><pre>
    $foo->baz(); $bar->baz();
</pre>

<p>
Not a bad idea, although various people pulled out the old &quot;would break
old code&quot; mainstay.
</p>

<p>
He developed his idea, suggesting that
</p>

</p><pre>
    ([1,2], [3,4])->[0]
</pre>

<p>
should return 
<code>1,3</code>, and also that
</p>

</p><pre>
    ($arrayref)->[0..15]
</pre>

<p>
should return
</p>

</p><pre>
    map { $arrayref->[$_] } 0..15
</pre>

<p>
I thought this was beautiful, and tossed it over to the perl6-language
list, together with the natural extension of
</p>

</p><pre>
    @a = ($foo, $bar) . $baz     # @a = map { $_.$baz } ($foo, $baz)
</pre>

<p>
which reminded MJD of APL.
<h3><a name="Various">Various</a></h3>

</p>

<p>

I made a misattribution last week, saying that Philip Newton provided a
documentation patch for 
<code>use integer</code>. Although Philip does some storming work, that wasn't one of his - it
belonged to Robert Spier. Sorry, Robert. John Allen produced another one
this week.
</p>

<p>
Ilya made 
<code>perldoc</code> work on OS/2. John Allen suggested that we should use the subroutine
attribute syntax to extend builtins: 
<code>time :milli()</code> for hi-res time, for instance. Nothing happened. 
</p>

<p>
Charles Lane (he of the weird email address) produced a fix to tidy up
the test suite a little; tests should use 
<code>$^X</code> instead of 
<code>./perl</code> to keep VMS and other dinosaurs happy.
</p>

<p>
Kurt Starsinic has been patching up some of the standard utilities to be
warnings and strict clean; so far we've seen his patch to 
<code>h2ph</code>. 
</p>

<p>
Merijn found loads and loads of bugs in the 5.6.1 trials on AIX and
HP/UX, which Sarathy ran around cleaning up. Good work, both.
</p>

<p>
Brian Ingerson has, sadly, decided that his excellent 
<a href="http://search.cpan.org/search?dist=Inline">Inline</a> module is not going to be mature enough for 5.8.0. Still, I heartily
hope something like it ships with Perl 6. Have you played with 
<a href="http://search.cpan.org/search?dist=Inline">Inline</a> yet? No? Go and play with 
<a href="http://search.cpan.org/search?dist=Inline">Inline</a> immediately, and until next week I remain, your humble and obedient servant,
</p>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Cozens</a>


<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#561_TRIAL3_is_out_there">5.6.1-TRIAL3 is out there</a>
  <li><a href="#Robin_Houston_vs_goto">Robin Houston vs. goto</a>
  <li><a href="#my_foo_if_0">my $foo if 0</a>
  <li><a href="#More_POD_Nits">More POD Nits</a>
  <li><a href="#More_on_the_reset_bug">More on the reset bug</a>
  <li><a href="#Distributive_arrow_operator">Distributive arrow operator</a>
  <li><a href="#Various">Various</a>
</ul>
