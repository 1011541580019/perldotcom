<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.02" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
    
    <link rel="prev bookmark" href="/pub/2001/04/THISWEEK-20010422.html" title="This Week on p5p 2001/04/22" />
    <link rel="next bookmark" href="/pub/2001/04/THISWEEK-20010429.html" title="This Week on p5p 2001/04/29" />
    
    
    <title>Quick Start Guide with SOAP Part Two - Perl.com</title>
</head>
<body id="perl-com" class="mt-entry-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <div id="top_advert"> 
<!-- Put any landscape advert in here -->
<a href="http://www.perlfoundation.org/" target="_new">
<img src="/i/tpf_banner.png" width="468" height="60" /></a>
        </div> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description"></div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-1486" class="entry-asset asset hentry">
                                <div class="asset-header">
                                    <h1 id="page-title" class="asset-name entry-title">Quick Start Guide with SOAP Part Two</h1>
                                    <div class="asset-meta">
                                        <span class="byline">

                                            By <span class="vcard author">Paul Kulchenko</span> on <abbr class="published" title="2001-04-23T00:00:00-08:00">April 23, 2001 12:00 AM</abbr>

                                        </span>


                                    </div>
                                </div>
                                <div class="asset-content entry-content">

                                    <div class="asset-body">
                                        <!-- Quick Start Guide With SOAP and SOAP::Lite Part Two -->
<p><table width="180" cellspacing="0" cellpadding="4" align="right" border="1"> <tr> <td align="center" valign="top" bgcolor="#6699cc"> <font color="#ffffff">Table of Contents</td> </tr>  <tr> <td> <p class="fine"> &#149;<a href="/pub/2001/01/soap.html">Quick Start with SOAP Part I</a><br /><br /> &#149;<a href="#more complex server (daemon, mod_perl and mod_soap)">More Complex Server (daemon, mod_perl and mod_soap)</a><br /><br /> &#149;<a href="#access to remote services">Access to Remote Services</a><br /><br /> &#149;<a href="#access with service description (wsdl)">Access With Service Description (WSDL)</a><br /><br /> &#149;<a href="#security (ssl, basic/digest authentication, cookiebased authentication, ticketbased authentication, access control)">Security (SSL, basic/digest authentication, cookie-based authentication, ticket-based authentication, access control)</a><br /><br /> &#149;<a href="#handling lols (list of lists, structs, objects, or something else)">Handling LoLs (List of Lists, Structs, Objects, or something else)</a><br /> </td> </tr> </p> </table>  <h3><a name="more complex server (daemon, mod_perl and mod_soap)">More Complex Server (daemon, mod_perl and mod_soap)</a></h3>   <p>You shouldn't have many problems with the CGI-based SOAP server you created in the <a href="/pub/2001/01/soap.html">first part of this article</a>;
however, performance could be significantly better. The next logical step 
might be to implement SOAP services using accelerators (like PerlEx or 
VelociGen) or persistent technologies (like mod_perl). 
Another lightweight solution might be to implement the SOAP service as an HTTP 
daemon; in that case, you don't need to use a separate Web server. This might 
be useful in a situation where a client application accepts SOAP calls, or 
for internal usage.</p> <dl> <dt><strong><a name="item_HTTP_daemon">HTTP daemon</a></strong><br> <dd> The following code shows an example implementation for a HTTP daemon:
<p> 4.a. server   (HTTP daemon)                     
<pre> #!perl -w

  use SOAP::Transport::HTTP;

  use Demo;

  # don't want to die on 'Broken pipe' or Ctrl-C
  $SIG{PIPE} = $SIG{INT} = 'IGNORE';

  $daemon = SOAP::Transport::HTTP::Daemon
    -&gt; new (LocalPort =&gt; 80)
    -&gt; dispatch_to('/home/soaplite/modules')
  ;

  print &quot;Contact to SOAP server at &quot;, $daemon-&gt;url, &quot;\n&quot;;
  $daemon-&gt;handle;</pre> </div>  <p>Not much difference from the CGI server (<a href="/pub/2001/01/soap.html#item_Dynamic"><code>Dynamic</code></a>), huh? 
And it makes the same interface accessible, only through a different 
endpoint. This code is all you need to run the SOAP server on your computer 
without anything else.</p> <p></p> <dt><strong><a name="item_HTTP_daemon_in_VBScript">HTTP daemon in VBScript</a></strong><br> <dd> Similar code in VBScript may look like:
<p>4.b. server (HTTP daemon, VBScript)
<pre> call CreateObject(&quot;SOAP.Lite&quot;) _
   .server(&quot;SOAP::Transport::HTTP::Daemon&quot;, _
     &quot;LocalPort&quot;, 80) _
   .dispatch_to(&quot;/home/soaplite/modules&quot;) _
   .handle</pre>  <p>This is all you need to run SOAP server on a Microsoft platform (and it will
run on Win9x/Me/NT/2K as soon as you register Lite.dll with <code>regsvr32 Lite.dll</code>).</p>   <dt><strong><a name="item_ASP%2FVB">ASP/VB</a></strong><br> <dd> An ASP server could be created with VBScript or PerlScript code:

<p>4.c. server (ASP server, VBScript) 
<pre> &lt;%
    Response.ContentType = &quot;text/xml&quot;
    Response.Write(Server.CreateObject(&quot;SOAP.Lite&quot;) _
      .server(&quot;SOAP::Server&quot;) _ 
      .dispatch_to(&quot;/home/soaplite/modules&quot;) _
      .handle(Request.BinaryRead(Request.TotalBytes)) _
    )
  %&gt;</pre>  <dt><strong><a name="item_Apache%3A%3ARegistry">Apache::Registry</a></strong><br> <dd> One of the easiest ways to significantly speed up your CGI-based SOAP server 
is to wrap it with the mod_perl Apache::Registry module. You need to configure it 
in the httpd.conf file:
<p>4.d. server (Apache::Registry, httpd.conf) 
<pre> Alias /mod_perl/ &quot;/Apache/mod_perl/&quot;
  &lt;Location /mod_perl&gt;
    SetHandler perl-script
    PerlHandler Apache::Registry
    PerlSendHeader On
    Options +ExecCGI
  &lt;/Location&gt;</pre>  <p>Put the CGI
script <code>soap.mod_cgi</code> in the <em>/Apache/mod_perl/</em> directory mentioned above:</p>  <p>4.d. server (Apache::Registry, soap.mod_cgi) 
<pre> #!perl -w

  use SOAP::Transport::HTTP;
  
  SOAP::Transport::HTTP::CGI
    -&gt; dispatch_to('/home/soaplite/modules')
    -&gt; handle
  ;</pre>  <dt><strong><a name="item_mod_perl">mod_perl</a></strong><br> <dd> Let's consider a mod_perl-based server now. To run it you'll need to
put the SOAP::Apache module (<em>Apache.pm</em>) in any directory in <code>@INC</code>:
<p>4.e. server (mod_perl, Apache.pm) 
<pre> package SOAP::Apache;

  use SOAP::Transport::HTTP;
  
  my $server = SOAP::Transport::HTTP::Apache
    -&gt; dispatch_to('/home/soaplite/modules') 
	
  sub handler { $server-&gt;handler(@_) }

  1;</pre>  <p>Then modify your httpd.conf file:</p> <p>4.e. server (mod_perl, httpd.conf) 
<pre> &lt;Location /soap&gt;
    SetHandler perl-script
    PerlHandler SOAP::Apache
  &lt;/Location&gt;</pre>  <dt><strong><a name="item_mod_soap">mod_soap</a></strong><br> <dd> mod_soap allows you to create a SOAP server by simply configuring the
httpd.conf or .htaccess file.
<p> 4.f. server (mod_soap, httpd.conf) 
<pre> # directory-based access
  &lt;Location /mod_soap&gt;
    SetHandler perl-script
    PerlHandler Apache::SOAP
    PerlSetVar dispatch_to &quot;/home/soaplite/modules&quot;
    PerlSetVar options &quot;compress_threshold =&gt; 10000&quot;
  &lt;/Location&gt;

  # file-based access
  &lt;FilesMatch &quot;\.soap$&quot;&gt;
    SetHandler perl-script
    PerlHandler Apache::SOAP
    PerlSetVar dispatch_to &quot;/home/soaplite/modules&quot;
    PerlSetVar options &quot;compress_threshold =&gt; 10000&quot;
  &lt;/FilesMatch&gt;</pre>  <p>Directory-based
access turns a directory into a SOAP endpoint. For example,
you may point your request to <em>http://localhost/mod_soap</em> (there is no
need to create this directory).</p> <p>File-based access turns a file with a specified name (or mask) into a SOAP 
endpoint. For example, <em>http://localhost/somewhere/endpoint.soap</em>.</p> <p>Alternatively, you may turn an existing directory into a SOAP server
if you put an
<em>.htaccess</em> file inside it:</p>  <p> 4.g. server (mod_soap, .htaccess) 
<pre> SetHandler perl-script
  PerlHandler Apache::SOAP
  PerlSetVar dispatch_to &quot;/home/soaplite/modules&quot;
  PerlSetVar options &quot;compress_threshold =&gt; 10000&quot;</pre>  </dl>  <h3><a name="access to remote services">Access to Remote Services</a></h3> <p>It's time now to re-use what has already been done and to try to call
some services 
available on the Internet. After all, the most interesting part of SOAP is 
interoperability between systems where the communicating parts are 
created in different languages, running on different platforms or in 
different environments, and are providing interfaces with service descriptions 
or documentation. XMethods.net can be a perfect starting point.</p> <dl> <dt><strong><a name="item_number">Name of state based on state's number (in alphabetical order)</a></strong><br> <dd> Frontier implementation has a test server that returns the name of a state 
based on a number you provide. By default, SOAP::Lite generates a SOAPAction 
header with the structure of <code>[URI]#[method]</code>.  Frontier, however, expects 
SOAPAction to be just the URI, so we have to use on_action to modify it. In our example, we specify <code>on_action(sub { sprintf '&quot;%s&quot;', shift })</code>,
so the resulting SOAPAction will contain only the URI (and don't forget
the double quotes there).
<p> 5.a. client 
<pre> #!perl -w
  
  use SOAP::Lite;

  # Frontier <a href="http://www.userland.com/">http://www.userland.com/</a>  $s = SOAP::Lite 
    -&gt; uri('/examples')
    -&gt; on_action(sub { sprintf '&quot;%s&quot;', shift })
    -&gt; proxy('http://superhonker.userland.com/')
  ;

  print $s-&gt;getStateName(SOAP::Data-&gt;name(statenum =&gt; 25))-&gt;result;</pre>  <p>You should get the output:</p> <p> 5.a. result
<pre>Missouri</pre>  <table width="170" border="0" cellspacing="0" cellpadding="20" align="right"> <tr> <td width="170" valign="top" bgcolor="#ffffff"> <hr size="1" color="#6699cc"><br /> <font size="-1" color="#6699cc"><b><p> <a href="/pub/au/Kulchenko_Paul">Paul Kulchenko</a></b> is a featured speaker at the upcoming O'Reilly Open
Source Convention in San Diego, CA, July 23 - 27, 2001. Take this
opportunity to rub elbows with open source leaders while relaxing in the
beautiful setting of the beach-front Sheraton San Diego Hotel and Marina.
For more information, visit our <a
href="http://conferences.oreilly.com/oscon/">conference home page</a>. You
can register online.</p></b></font><hr size="1" color="#6699cc"><br /></td> </tr> </table>    <dt><strong><a name="item_Whois">Whois</a></strong><br> <dd> We will target services with different implementations. The following service
is running on a Windows platform:
<p> 5.b. client 
<pre> #!perl -w

  use SOAP::Lite;

  # 4s4c (aka Simon's SOAP Server Services For COM) <a href="http://www.4s4c.com/">http://www.4s4c.com/</a>  print SOAP::Lite 
    -&gt; uri('http://www.pocketsoap.com/whois')
    -&gt; proxy('http://soap.4s4c.com/whois/soap.asp')
    -&gt; whois(SOAP::Data-&gt;name('name' =&gt; 'yahoo'))
    -&gt; result;</pre>  <p>Nothing fancy here; <code>'name'</code> is the name of the field and <code>'yahoo'</code> is the value. That should give you the output:</p> <p>5.b. result 
<pre> The Data in Network Solutions' WHOIS database is provided by Network
  Solutions for information purposes, and to assist persons in obtaining
  information about or related to a domain-name registration record.
  Network Solutions does not guarantee its accuracy. By submitting a
  WHOIS query, you agree that you will use this Data only for lawful
  purposes and that, under no circumstances will you use this data to:
  (1) allow, enable or otherwise support the transmission of mass
  unsolicited, commercial advertising or solicitations via e-mail
  (spam); or  (2) enable high volume, automated, electronic processes
  that apply to Network Solutions (or its systems). Network Solutions
  reserves the right to modify these terms at any time. By submitting
  this query, you agree to abide by this policy.
  Yahoo (YAHOO-DOM)                                            YAHOO.COM
  Yahoo Inc. (YAHOO27-DOM)                                     YAHOO.ORG
  Yahoo! Inc. (YAHOO4-DOM)                                     YAHOO.NET

  To single out one record, look it up with &quot;!xxx&quot;, where xxx is the
  handle, shown in parenthesis following the name, which comes first.</pre>   <dt><strong><a name="item_Book_price_based_on_ISBN">Book price based on ISBN</a></strong><br> <dd> In many cases the SOAP interface is just a front end that requests information,
parses the response, formats it and returns according to your request. It may 
not be doing that much, but it saves you time on the client side and fixes 
this interface, so you don't need to update it each time your service 
provider changes format or content. 
In addition, the major players are moving quickly toward XML; 
for example, Google already has an XML-based interface for its search 
engine. Here is the service that returns the price of a book given its ISBN:
<p> 5.c. client 
<pre> #!perl -w

  use SOAP::Lite;

  # Apache SOAP <a href="http://xml.apache.org/soap/">http://xml.apache.org/soap/</a> (running on XMethods.net)

  $s = SOAP::Lite                             
    -&gt; uri('urn:xmethods-BNPriceCheck')                
    -&gt; proxy('http://services.xmethods.net/soap/servlet/rpcrouter');

  my $isbn = '0596000278'; # Programming Perl, 3rd Edition
  print $s-&gt;getPrice(SOAP::Data-&gt;type(string =&gt; $isbn))-&gt;result;</pre>  <p>Here is the result for 'Programming Perl, 3rd Edition':</p> <p> 5.c. result 
<pre> 39.96</pre>  <p>Note that we
explicitly specified the type to be <code>'string'</code>, because an
ISBN looks like
number and will be serialized by default as an integer. However, the
SOAP server we work 
with requires it to be a string.</p>  <dt><strong><a name="item_Currency_Exchange_rates">Currency exchange rates</a></strong><br> <dd> This service returns the value of one unit of country1's currency converted into 
country2's currency:
<P>5.d. client 
<pre> #!perl -w

  use SOAP::Lite;

  # GLUE <a href="http://www.themindelectric.com/">http://www.themindelectric.com/</a> (running on XMethods.net)

  my $s = SOAP::Lite                             
    -&gt; uri('urn:xmethods-CurrencyExchange')                
    -&gt; proxy('http://services.xmethods.net/soap');

  my $r = $s-&gt;getRate(SOAP::Data-&gt;name(country1 =&gt; 'England'), 
                      SOAP::Data-&gt;name(country2 =&gt; 'Japan'))
            -&gt;result;
  print &quot;Currency rate for England/Japan is $r\n&quot;;</pre>  <p>Which gives you (as of 2001/03/11):</p> <p> 5.d. result 
<pre> Currency rate for England/Japan is 175.4608</pre>  <dt><strong><a name="item_NASDAQ_quotes">NASDAQ quotes</a></strong><br> <dd> This service returns a delayed stock quote based on a stock symbol:
<p> 5.e. client 
<pre> #!perl -w

  use SOAP::Lite;

  # GLUE <a href="http://www.themindelectric.com/">http://www.themindelectric.com/</a> (running on XMethods.net)

  my $s = SOAP::Lite                             
    -&gt; uri('urn:xmethods-delayed-quotes')                
    -&gt; proxy('http://services.xmethods.net/soap');

  my $symbol = 'AMZN';
  my $r = $s-&gt;getQuote($symbol)-&gt;result;
  print &quot;Quote for $symbol symbol is $r\n&quot;;</pre>  <p>It may (or may not, depending on how Amazon is doing) give you:</p> <p>5.e. result 
<pre> Quote for AMZN symbol is 12.25</pre> </dl>  <h3><a name="access with service description (wsdl)">Access with service description (WSDL)</a></h3> <p>Although support for WSDL 1.1 is limited in SOAP::Lite for now (the service 
description may work in some cases, but hasn't been extensively 
tested), you can access services that don't have complex types in their 
description:</p> <p> 6.a. client 
<pre> #!perl -w

  use SOAP::Lite;
  
  print SOAP::Lite
    -&gt; service('http://www.xmethods.net/sd/StockQuoteService.wsdl')
    -&gt; getQuote('MSFT');</pre>  <p>If we take a
look under the hood we'll find that SOAP::Lite requests
a service description, parses it, builds the stub (a local
object that has
the same methods as the remote service) and returns it to you. 
As a result, you can run several requests using the same service 
description:</p> <p>6.b. client 
<pre> #!perl -w

  use SOAP::Lite;
  <div class="client-highlight"> my $service = SOAP::Lite
    -&gt; service('http://www.xmethods.net/sd/StockQuoteService.wsdl');</pre> </div> print 'MSFT + ORCL = ', 
        $service-&gt;getQuote('MSFT') + $service-&gt;getQuote('ORCL');</pre>  <p>The service description doesn't need to be on the Internet; you can access it 
from your local drive also:</p> <p>6.c. client 
<pre> #!perl -w

  use SOAP::Lite
    service =&gt; 'http://www.xmethods.net/sd/StockQuoteService.wsdl',
    # service =&gt; '<a href="file:/your/local/path/StockQuoteService.wsdl">file:/your/local/path/StockQuoteService.wsdl</a>',
    # service =&gt; '<a href="file:./StockQuoteService.wsdl">file:./StockQuoteService.wsdl</a>',
  ;

  print getQuote('MSFT'), &quot;\n&quot;;</pre>  <p>This code works similar to the previous example (in OO style), but 
loads the description and imports all the methods, so you can use the
functional interface.</p> <p>And finally, a couple of one-liners for those who like to do something short
and simple (albeit useful and powerful):</p>  <p>6.d. client 
<pre> # The following command is split for readability
  perl &quot;-MSOAP::Lite service=&gt;'http://www.xmethods.net/sd/StockQuoteService.wsdl'&quot; 
       -le &quot;print getQuote('MSFT')&quot;

  perl &quot;-MSOAP::Lite service=&gt;'<a href="file:./quote.wsdl">file:./quote.wsdl</a>'&quot; -le &quot;print getQuote('MSFT')&quot;</pre>  <p>The last
example (marked line) seems to be the shortest SOAP method invocation.</p>   <h3><a name="security (ssl, basic/digest authentication, cookiebased authentication, ticketbased authentication, access control)">Security (SSL, basic/digest authentication, cookie-based authentication, ticket-based authentication, access control)</a></h3> <p>Though SOAP doesn't impose any security mechanisms (unless you count
the SOAP Security Extensions: Digital Signature specification), the extensibility
of the protocol allows you to leverage many security methods that are available 
for different protocols, like SSL over HTTP or S/MIME. We'll consider how
SOAP can be used together with SSL, basic authentication, cookie-based
authorization and access control.</p> <dl> <dt><strong><a name="item_SSL">SSL</a></strong><br> <dd> Let's start with <strong>SSL</strong>. Surprisingly there is nothing SOAP-specific you 
need to do on the server side, and there is only a minor modification on 
the client side: just specify <code>https:</code> instead of <code>http:</code> as the protocol 
for your endpoint and everything else will be done for you. Obviously, 
both endpoints should support this functionality and the server should
be properly configured.
<p>7.a. client 

<pre> #!perl -w
  
  use SOAP::Lite +autodispatch =&gt; 
    uri =&gt; 'http://www.soaplite.com/My/Examples',

    proxy =&gt; 'https://localhost/cgi-bin/soap.cgi',

    on_fault =&gt; sub { my($soap, $res) = @_; 
      die ref $res ? $res-&gt;faultdetail : $soap-&gt;transport-&gt;status, &quot;\n&quot;;
    }
  ;

  print getStateName(21);</pre>  <dt><strong><a name="item_Basic_authentication">Basic authentication</a></strong><br> <dd> The situation gets even more interesting with <strong>authentication</strong>. Consider this 
code that accesses an endpoint that requires authentication.

<p>7.b. client 

<pre> #!perl -w

  use SOAP::Lite +autodispatch =&gt; 
    uri =&gt; 'http://www.soaplite.com/My/Examples', 
    proxy =&gt; 'http://services.soaplite.com/auth/examples.cgi', 
    on_fault =&gt; sub { my($soap, $res) = @_; 
      die ref $res ? $res-&gt;faultdetail : $soap-&gt;transport-&gt;status, &quot;\n&quot;;
    }
  ;

  print getStateName(21);</pre>  <p>Keep in mind that the password will be in clear text during the transfer 
(not exactly in clear text; it will be base64 encoded, but that's almost 
the same) unless the user uses https (i.e. authentication doesn't mean 
encryption).</p> <p>The server configuration for an Apache Web server with authentication 
can be specified in a .conf or in .htaccess file, and may look like this:</p> <p>7.b. server (.htaccess) 
<pre> AuthUserFile /path/to/users/file/created/with/htpasswd
  AuthType Basic
  AuthName &quot;SOAP::Lite authentication tests&quot;
  require valid-user</pre>  <p>If you run
example 7.b against this endpoint, you'll probably get the following error:</p> <p>7.b. result 
<pre> 401 Authorization Required</pre>  <p>You may provide
the required credentials on the client side (user <code>soaplite</code>,
and password <code>authtest</code>) overriding the function <code>get_basic_credentials()</code> in the class SOAP::Transport::HTTP::Client:</p>  <p>7.c. client 
<pre> #!perl -w
  
  use SOAP::Lite +autodispatch =&gt; 
    uri =&gt; 'http://www.soaplite.com/My/Examples', 
    proxy =&gt; 'http://services.soaplite.com/auth/examples.cgi', 
    on_fault =&gt; sub { my($soap, $res) = @_; 
      die ref $res ? $res-&gt;faultdetail : $soap-&gt;transport-&gt;status, &quot;\n&quot;;
    }
  ;

  sub SOAP::Transport::HTTP::Client::get_basic_credentials { 
    return 'soaplite' =&gt; 'authtest';
  }

  print getStateName(21);</pre>  <p>That gives you the correct result:</p> <p>7.c. result 
<pre>Massachusetts</pre>   <p>Alternatively
you may provide this information with a <code>credentials()</code> functions,
but you need to specify the host and realm also:</p>  <p>7.d. client 

<pre> #!perl -w

  use SOAP::Lite +autodispatch =&gt; 
    uri =&gt; 'http://www.soaplite.com/My/Examples',

    proxy =&gt; [
      'http://services.soaplite.com/auth/examples.cgi', 
      credentials =&gt; [
        'services.soaplite.com:80',        # host:port
        'SOAP::Lite authentication tests', # realm
        'soaplite' =&gt; 'authtest',          # user, password
      ]
    ],

    on_fault =&gt; sub { my($soap, $res) = @_; 
      die ref $res ? $res-&gt;faultdetail : $soap-&gt;transport-&gt;status, &quot;\n&quot;;
    }
  ;

  print SOAP-&gt;getStateName(21);</pre> <p>Under modern
Perl you <em>may</em> get a warning about ``deprecated usage of inherited 
AUTOLOAD''. To avoid it use the full syntax: <code>SOAP-&gt;getStateName(21)</code> instead of <code>getStateName(21)</code>.</p> <p>The simplest and most convenient way would probably be to provide the user and 
password embedded in a URL. Surprisingly, this works:</p>  <p>7.e. client
<pre> #!perl -w

  use SOAP::Lite;

  print SOAP::Lite
    -&gt; uri('http://www.soaplite.com/My/Examples')

    -&gt; proxy('http://soaplite:authtest@services.soaplite.com/auth/examples.cgi')

    -&gt; getStateName(21)
    -&gt; result;</pre>   <dt><strong><a name="item_Cookie%2Dbased_authentication">Cookie-based authentication</a></strong><br> <dd> <strong>Cookie-based authentication</strong> also doesn't require much work on 
the client side. Usually, it means that you need to provide credentials 
in some way, and if everything is OK, the server will return a cookie on 
success, and will then check it for all subsequent requests. 
Using available functionality you may not only
support this behavior on the client side in one session, but even store cookies
in a file and use the same server session for several runs. All you need to
do is:
<p>7.f. client 
<pre> #!perl -w

  use SOAP::Lite; 
  use HTTP::Cookies;

  my $soap = SOAP::Lite
    -&gt; uri('urn:xmethodsInterop')

    -&gt; proxy('http://services.xmethods.net/soap/servlet/rpcrouter', 
             cookie_jar =&gt; HTTP::Cookies-&gt;new(ignore_discard =&gt; 1));

  print $soap-&gt;echoString('Hello')-&gt;result;</pre>  <p>All the magic is in the cookie jar. You may even add or delete cookies 
between calls, but the underlying module does everything you need by default. 
Add the option <code>file =&gt; 'filename'</code> to the call to
<code>new()</code> to save and restore cookies
between sessions. Not much work, huh? Kudos to Gisle Aas on that!</p> <p></p> <dt><strong><a name="item_Ticket%2Dbased_authentication">Ticket-based authentication</a></strong><br> <dd> Ticket-based authentication is a bit more complex. The logic is similar 
to cookie-based authentication, but it is executed at the application level, 
instead of at the transport level. The advantage is that it works for any 
SOAP transport (not only for HTTP) and gives you a bit more flexibility. 
As a result, you won't get support from the Web server and you'll have to do 
everything manually. No big deal, right?
<p>The first step is the ticket generation. We'll build a ticket that contains
an e-mail address, a time and a signature.</p>  <p>7.g. server (TicketAuth) 
<pre> package TicketAuth;

  # we will need to manage Header information to get a ticket
  @TicketAuth::ISA = qw(SOAP::Server::Parameters);

  # ----------------------------------------------------------------------
  # private functions
  # ----------------------------------------------------------------------

  use Digest::MD5 qw(md5);

  my $calculateAuthInfo = sub {
    return md5(join '', 'something unique for your implementation', @_);
  };

  my $checkAuthInfo = sub {
    my $authInfo = shift;
    my $signature = $calculateAuthInfo-&gt;(@{$authInfo}{qw(email time)});
    die &quot;Authentication information is not valid\n&quot; 
      if $signature ne $authInfo-&gt;{signature};
    die &quot;Authentication information is expired\n&quot; 
      if time() &gt; $authInfo-&gt;{time};
    return $authInfo-&gt;{email};
  };

  my $makeAuthInfo = sub {
    my $email = shift;
    my $time = time()+20*60; # signature will be valid for 20 minutes
    my $signature = $calculateAuthInfo-&gt;($email, $time);
    return +{time =&gt; $time, email =&gt; $email, signature =&gt; $signature};
  };

  # ----------------------------------------------------------------------
  # public functions
  # ----------------------------------------------------------------------

  sub login { 
    my $self = shift;

    pop; # last parameter is envelope, don't count it
    die &quot;Wrong parameter(s): login(email, password)\n&quot; unless @_ == 2;
    my($email, $password) = @_;

    # check credentials, write your own is_valid() function
    die &quot;Credentials are wrong\n&quot; unless is_valid($email, $password);

    # create and return ticket if everything is ok
    return $makeAuthInfo-&gt;($email);

  }

  sub protected { 
    my $self = shift;

    # authInfo is passed inside the header
    my $email = $checkAuthInfo-&gt;(pop-&gt;valueof('//authInfo'));

    # do something, user is already authenticated 
    return;
  }</pre>  <p>It would be very careless (and insecure) to create <code>calculateAuthInfo()</code> as a normal, exposed function, because a client could invoke it
directly and 
generate a valid ticket without providing valid credentials (unless you 
forbid it in the SOAP server configuration, but we'll show another way). 
Therefore, we create <code>calculateAuthInfo()</code>, <code>checkAuthInfo()</code> and 
<code>makeAuthInfo()</code> as 'private' functions, so only other functions inside 
the same file can access it. It effectively prevents clients from accessing 
them directly.</p> <p>The <code>login()</code> function returns a hash that has an e-mail and time inside, as well
as an MD5 signature that prevents the user from altering this information.
Since the server used a secret string during signature generation, the user 
is not able to tamper with the resulting signature. To access protected 
methods, the client has to provide the obtained ticket in the header:</p>  <p>7.g. fragment 

<pre> # login
  my $authInfo = login(email =&gt; 'password');

  # convert it into the Header
  $authInfo = SOAP::Header-&gt;name(authInfo =&gt; $authInfo);

  # invoke protected method
  protected($authInfo, 'parameters');</pre>  <p>This is just a fragment, but it should give you some ideas on how to 
implement ticket-based authentication on application level. You could even
get the ticket in one place (via HTTP for example) and access a SOAP server
via SMTP providing this ticket (ideally you should use PKI [public key 
infrastructure] for that matter).</p>   <dt><strong><a name="item_Access_control">Access control</a></strong><br> <dd> Why would you need <strong>access control</strong>? Imagine you have a class and
want to give access to it selectively; for example, read access to one 
person and read/write access to another person or a list of people. 
At a low level, read and write access means access to specific 
functions/methods in class.
<p>You could put this check in at the application level (for example with 
ticket-based authentication), or you could split your class into two different 
classes and give one person access only to one of them. Neither of these
is optimal solutions. We consider a different approach, where you create two 
different endpoints that refer to the same class on the server side, but 
have different access options.</p>  <p>7.e. server (first endpoint)
<pre> use SOAP::Transport::HTTP;
  
  use Protected;
  SOAP::Transport::HTTP::CGI
    -&gt; dispatch_to('Protected::readonly')
    -&gt; handle
  ;</pre>  <p>This endpoint will have access only to <code>readonly()</code> method in <code>Protected</code> class.</p>  <p>7.e. server (second endpoint)
<pre> use SOAP::Transport::HTTP;

  use Protected;
  SOAP::Transport::HTTP::CGI
    -&gt; dispatch_to('Protected')
    -&gt; handle
  ;</pre>  <p>This endpoint will have unrestricted access to all methods/functions in 
<code>Protected</code> class. Now you can put it under basic, digest or some other 
kind of authentication to prevent unauthorized access.</p> <p>Thus, by combining the capabilities of a Web server with the SOAP server you 
can create an application that best suites your needs.</p></dd></dt></dl>  <h3><a name="handling lols (list of lists, structs, objects, or something else)">Handling LoLs (List of Lists, Structs, Objects, or something else)</a></h3> <p>Processing complex data structures isn't different in any aspect
from the usual processing in your programming language. The general rule is
simple: <strong>'Treat the result of a SOAP call as a variable of specified type'</strong>.</p> <p>The next example shows a service that works with array of structs:</p>  <p>8.a. client 
<pre> #!perl -w

  use SOAP::Lite;

  my $result = SOAP::Lite
        -&gt; uri('urn:xmethodsServicesManager')
        -&gt; proxy('http://www.xmethods.net/soap/servlet/rpcrouter')
        -&gt; getAllSOAPServices();

  if ($result-&gt;fault) {
    print $result-&gt;faultcode, &quot; &quot;, $result-&gt;faultstring, &quot;\n&quot;;
  } else {
    # reference to array of structs is returned
    my @listings = @{$result-&gt;result};

    # @listings is the array of structs
    foreach my $listing (@listings) {
      print &quot;-----------------------------------------\n&quot;;
      # print description for every listing
      foreach my $key (keys %{$listing}) {
        print $key, &quot;: &quot;, $listing-&gt;{$key} || '', &quot;\n&quot;;
      }        
    }
  }
</pre> <p>The same is true about structs inside other structs,
lists of objects, objects that have lists inside, etc. 'What you return 
on server side is what you get on client side, and let me know if you get
something else.'</p> <p>(OK, not always. You MAY get a blessed array even 
when you return a simple array on the other side and you MAY get a blessed 
hash when you return a simple one, but it won't change anything in your code,
just access it as you usually do).</p> <hr size="1" noshade> <p>Major contributors:</p> <dl> <dt><strong><a name="item_Nathan_Torkington">Nathan Torkington</a></strong><br> <dd> Basically started this work and pushed the whole process.
<p></p> <dt><strong><a name="item_Tony_Hong">Tony Hong</a></strong><br> <dd> Invaluable comments, fixes and input help me keep this material correct, 
fresh and simple.
<p></p></dl>


                                    </div>


                                </div>
                                <div class="asset-footer">

    
                                    <div class="entry-categories">
                                        <h4>Categories<span class="delimiter">:</span></h4>
                                        <ul>
                                            <li><a href="/pub/web-development/" rel="tag">Web Development</a></li>
                                        </ul>
                                    </div>
    


                                </div>
                            </div>


                    
                    


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2010/07/">July 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.02" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
